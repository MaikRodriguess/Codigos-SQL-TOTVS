APLICACAO;CODSENTENCA;TITULO;SENTENCA;TAMANHO;DISPONIVEL;IDGRUPO;NIVEL;DTULTALTERACAO;USRULTALTERACAO;CODCOLIGADA;DISPONIVELFILTRO;DISPONIVELRELATORIO;DISPONIVELVISAO;PODEALTERAR;PODEEXCLUIR;IDDBCONNECTION;DISPONIVELMENU;GUID;SEMSEGESTENDIDA;VERSAO;CONTROLE;RECCREATEDBY;RECCREATEDON;RECMODIFIEDBY;RECMODIFIEDON;SEMSEGCOLUNAS
A;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
A;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
A;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
B;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
B;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
B;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
B;FILTRO.001;Candidatos com Inscrição no ENEM;"SELECT
 /*SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO*/
 SPSUSUARIO.NOME
 
FROM
 SPSINSCRICAOAREAOFERTADA (NOLOCK)
 
 INNER JOIN SPSUSUARIO (NOLOCK)		ON SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
 
WHERE	SPSINSCRICAOAREAOFERTADA.ENEMNUMINSCRICAO <> '' ";279;;;;19/08/2021;mestre;0;1;1;1;;;;0;39c917de-e155-4f7e-9bad-432c4da25da2;0;;-28120;mestre;19/05/2021;mestre;19/08/2021;0
B;FILTRO.002;Candidatos sem Inscrição no ENEM;"SELECT
 /*SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO*/
 SPSUSUARIO.NOME
 
FROM
 SPSINSCRICAOAREAOFERTADA (NOLOCK)
 
 INNER JOIN SPSUSUARIO (NOLOCK)		ON SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
 
WHERE	SPSINSCRICAOAREAOFERTADA.ENEMNUMINSCRICAO = '' or SPSINSCRICAOAREAOFERTADA.ENEMNUMINSCRICAO is null";330;;;;19/08/2021;mestre;0;1;1;1;;;;0;39c917de-e155-4f7e-9bad-432c4da25da2;0;;7014;mestre;19/05/2021;mestre;19/08/2021;0
B;RBPO.WS.001;Consulta de categorias;"SELECT 
	CONCAT( A.CODCOLIGADA,'-', A.CODAREA) AS EXTERNO_ID,
	A.NOME AS CATEGORIA
FROM BAREA A (NOLOCK)
ORDER BY A.ID";122;;;;14/09/2021;wsrubeus;0;1;1;1;;;;0;c95ea173-19c8-47dc-a966-2fa597b0cdc8;;;-17220;wsrubeus;14/09/2021;wsrubeus;14/09/2021;
B;RBPO.WS.002;Consulta de subcategorias;"SELECT 
	M.CODAREA AS ID,
	CONCAT( M.CODCOLIGADA,'-', M.CODAREA,'-',M.CODMATERIA) AS EXTERNO_ID,
	M.NOME AS SUBCATEGORIA,
	CONCAT( M.CODCOLIGADA,'-', M.CODAREA) AS CATEGORIA_ID,
	A.NOME AS CATEGORIA
FROM BMATERIA M (NOLOCK) 
INNER JOIN BAREA A (NOLOCK)
ON A.CODAREA = M.CODAREA
ORDER BY M.ID;";301;;;;14/09/2021;wsrubeus;0;1;1;1;;;;0;dd4d0142-9d04-4187-8559-21a27b1efb1a;;;20452;wsrubeus;14/09/2021;wsrubeus;14/09/2021;
B;RBPO.WS.003;Consulta de questões;"SELECT 	
	CONCAT( Q.CODCOLIGADA,'-',  Q.CODQUESTAO,'-', Q.CODAREA,'-', Q.CODMATERIA) AS EXTERNO_ID,
	Q.ID AS ID,
	Q.TEXTO AS ENUNCIADO,	
	Q.PESO AS PONTOS,
	Q.TIPOQUESTAO AS TIPO,
	COALESCE(N.NOMENIVELDIF ,'--') AS DIFICULDADE,
	CONCAT( Q.CODCOLIGADA,'-', Q.CODAREA) AS CATEGORIA_ID,
	A.NOME AS CATEGORIA,
	CONCAT( Q.CODCOLIGADA,'-', Q.CODAREA,'-',Q.CODMATERIA) AS SUBCATEGORIA_ID,
	M.NOME AS SUBCATEGORIA
	
	FROM BQUESTAO Q (NOLOCK)
	LEFT JOIN BNIVELDIFICULDADE N ON N.CODNIVELDIF = Q.GRAUDIFICULDADE
	
	INNER JOIN BAREA A (NOLOCK) ON
	A.CODCOLIGADA = Q.CODCOLIGADA AND 	
	A.CODAREA     = Q.CODAREA 
	
	INNER JOIN BMATERIA M (NOLOCK) ON	
	M.CODAREA     = Q.CODAREA AND
	M.CODMATERIA  = Q.CODMATERIA
	
	ORDER BY Q.ID";739;;;;14/09/2021;wsrubeus;0;1;1;1;;;;0;8f90ac85-fd1e-44b1-a02c-2058dcefad6d;;;-32372;wsrubeus;14/09/2021;wsrubeus;14/09/2021;
B;RBPO.WS.004;Consulta de respostas;"SELECT 
	CONCAT( O.CODCOLIGADA,'-',  O.CODQUESTAO,'-', O.CODAREA,'-', O.CODMATERIA) AS QUESTAO_ID,	
	O.CODOPCAO ALTERNATIVA,
	O.TEXTO AS RESPOSTA,
	O.INDCORRETA AS CORRETA,
	CONCAT( O.CODCOLIGADA,'-', O.CODOPCAO,'-', O.CODQUESTAO,'-', O.CODAREA,'-', O.CODMATERIA) AS EXTERNO_ID
FROM BOPCAO O (NOLOCK) 
ORDER BY QUESTAO_ID, O.SEQORDEM";340;;;;14/09/2021;wsrubeus;0;1;1;1;;;;0;c37657e9-c2f8-4ae0-9847-d0ce723d1ca8;;;12922;wsrubeus;14/09/2021;wsrubeus;14/09/2021;
B;RBPO.WS.005;Consulta de provas;"SELECT DISTINCT CONVERT(VARCHAR, BPROVA.CODCOLIGADA) + '-' + CONVERT(VARCHAR, BPROVA.CODPROVA) AS EXTERNO_ID,
    BDEFQUESTAO.SEQQUESTAOPROVA AS ORDEM,
    BPROVA.NOME AS NOME,
    ISNULL(BPROVA.TEMPO, 0) AS TEMPO,
    ISNULL(BPROVA.NOTAMINIMA, 0) AS NOTA,
    ISNULL(
        CONVERT(VARCHAR, BDEFQUESTAO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, BDEFQUESTAO.CODQUESTAO) + '-' + CONVERT(VARCHAR, BDEFQUESTAO.CODAREA) + '-' + CONVERT(VARCHAR, BDEFQUESTAO.CODMATERIA),
        0
    ) AS CODQUESTAO,
    ISNULL(BDEFQUESTAO.QUESTAOOBRIGATORIA, 0) AS OBRIGATORIA,
    ISNULL(
        CONVERT(VARCHAR, SPSPROCESSOSELETIVO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSPROCESSOSELETIVO.IDPS),
        0
    ) AS CODPROCESSOSELETIVO,
    ISNULL(
        CONVERT(VARCHAR, SPSPROCESSOSELETIVO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSPROCESSOSELETIVO.IDPS) + '-' + CONVERT(VARCHAR, SPSPROVAETAPAAREA.IDAREAINTERESSE),
        0
    ) AS CODCURSO
FROM SPSPROCESSOSELETIVO (NOLOCK)
    INNER JOIN SPSPROVAETAPAAREA (NOLOCK) ON (
        SPSPROVAETAPAAREA.IDPS = SPSPROCESSOSELETIVO.IDPS
    )
    LEFT JOIN BPROVA (NOLOCK) ON (
        BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
        AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
    )
    LEFT JOIN BDEFQUESTAO (NOLOCK) ON (
        BDEFQUESTAO.CODCOLIGADA = BPROVA.CODCOLIGADA
        AND BDEFQUESTAO.CODPROVA = BPROVA.CODPROVA
    )
WHERE :CODCURSOS like '%' + ISNULL(
        CONVERT(VARCHAR, SPSPROCESSOSELETIVO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSPROCESSOSELETIVO.IDPS) + '-' + CONVERT(VARCHAR, SPSPROVAETAPAAREA.IDAREAINTERESSE),
        0
    ) + '%'
ORDER BY EXTERNO_ID,
    ORDEM";1674;;;;14/09/2021;wsrubeus;0;1;1;1;;;;0;265a2487-0023-4d43-8324-83c098125fb0;;;12281;wsrubeus;14/09/2021;wsrubeus;14/09/2021;
B;RBPO.WS.006;Consulta de execução da avaliação;"SELECT BEXECPROVA.CODCOLIGADA,
    BEXECPROVA.CODPROVA,
    BEXECPROVA.ID,
    BEXECPROVA.CODUSUARIOPS
FROM BEXECPROVA (NOLOCK)
WHERE BEXECPROVA.IDEXECPROVA = :IDEXECPROVA";176;;;;14/09/2021;wsrubeus;0;1;1;1;;;;0;86ff3ee0-3cc3-4e8e-bc82-b14823f4d875;;;12324;wsrubeus;14/09/2021;wsrubeus;14/09/2021;
C;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
C;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
C;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
C;PVT.004;CONSULTA LANÇAMENTOS CONTABEIS ;"SELECT CPARTIDA.DOCUMENTO
FROM   CPARTIDA (NOLOCK)
/*INNER JOIN CLANCAMENTO (NOLOCK)
        ON CLANCAMENTO.CODCOLIGADA = CPARTIDA.CODCOLIGADA
           AND CLANCAMENTO.IDLANCAMENTO = CPARTIDA.IDLANCAMENTO*/
WHERE  CPARTIDA.DOCUMENTO IN ( '94', '359', '360', '1896',
                               '3442', '4345', '4346', '4347',
                               '4348', '4352', '4353', '4354',
                               '4355', '4356', '4357', '4358',
                               '4359', '4360', '4361', '4362',
                               '4363', '4365', '4366', '4368',
                               '4369', '4371', '4372', '4373',
                               '4374', '4375', '4376', '4377',
                               '4378', '4379', '4380', '4381',
                               '4382', '4384', '4386', '4387',
                               '4388', '4389', '4390', '4391',
                               '4392', '4393', '4394', '4395',
                               '4396', '4397', '4398', '4399',
                               '4400', '4402', '4403', '4404',
                               '4405', '4406', '4407', '4408',
                               '4409', '4410', '4411', '4412',
                               '4414', '4415', '4416', '4417',
                               '4418', '4421', '4422', '4423',
                               '4424', '4425', '4426', '4427',
                               '4428', '4429', '4430', '4431',
                               '4432', '4433', '4434', '4435',
                               '4436', '4437', '4438', '4439',
                               '4440', '4442', '4443', '4445',
                               '4447', '4758', '4916', '5012',
                               '5037', '5043', '5107', '5108',
                               '5146', '5147', '5359', '5482',
                               '6464', '6465', '6466', '6467',
                               '7828', '8518', '8702', '10101',
                               '10324', '10511', '11001', '11007',
                               '12207', '19499', '19517', '19597',
                               '19822', '20168', '20314', '20389',
                               '20882', '21298', '21316', '21607',
                               '21777', '21912', '21923', '22241',
                               '22293', '22330', '22349', '22579',
                               '22597', '22640', '22819', '22924',
                               '23077', '23086', '23111', '23188',
                               '23222', '23428', '23467', '23575',
                               '23623', '23628', '23651', '24096',
                               '24112', '24619', '25864', '25869',
                               '25974', '26219', '26388', '26609',
                               '26629', '26703', '26704', '26735',
                               '26866', '27025', '27297', '27397',
                               '27405', '27412', '27421', '27427',
                               '27457', '27845', '27880', '27931',
                               '32799', '34412', '37576', '37577',
                               '37578', '37579', '37580', '37581',
                               '37582', '37583', '37584', '37585',
                               '37586', '37587', '37588', '37589',
                               '37590', '37591', '37592', '37593',
                               '37594', '37595', '37596', '37598',
                               '37599', '37600', '37601', '37603',
                               '37604', '37605', '37606', '37607',
                               '37608', '37610', '37611', '37612',
                               '37613', '37614', '37615', '37616',
                               '37617', '37619', '37621', '37622',
                               '37623', '37625', '37626', '37627',
                               '37628', '37629', '37630', '37631',
                               '37632', '37633', '37634', '37635',
                               '37637', '37638', '37639', '37640',
                               '37641', '37642', '37643', '37644',
                               '37645', '37646', '37647', '37648',
                               '37649', '37650', '37652', '37653',
                               '37654', '37655', '37656', '37658',
                               '37659', '37660', '37662', '37663',
                               '37664', '37665', '37666', '37667',
                               '37668', '37669', '37670', '37671',
                               '37672', '37673', '37675', '37676',
                               '37678', '37679', '37680', '37681',
                               '37683', '37684', '37686', '37688',
                               '37694', '37696', '37702', '37704',
                               '37707', '37709', '37711', '37713',
                               '37717', '37719', '37721', '37724',
                               '37729', '37734', '37737', '37743',
                               '37748', '37750', '37753', '37757',
                               '37759', '37762', '37764', '37766',
                               '37768', '37770', '37773', '37775',
                               '37777', '37782', '37788', '37790',
                               '37793', '37794', '37797', '37799',
                               '37801', '37804', '37805', '37808',
                               '37819', '37822', '37823', '37826',
                               '37828', '37830', '37833', '37838',
                               '37841', '37844', '37845', '37852',
                               '37853', '37856', '37857', '37859',
                               '37861', '37863', '37869', '37870',
                               '37872', '37874', '37877', '37882',
                               '37887', '37889', '37891', '37893',
                               '37895', '37897', '37899', '37901',
                               '37903', '37905', '37910', '37912',
                               '37914', '37916', '37918', '37920',
                               '37926', '37928', '37934', '37936',
                               '37943', '37945', '37947', '37949',
                               '37951', '37954', '37956', '37958',
                               '37961', '37963', '37967', '37969',
                               '37973', '37977', '37981', '37984',
                               '37990', '37992', '37994', '37996',
                               '37998', '38000', '38002', '38008',
                               '38013', '38018', '38020', '38022',
                               '38024', '38026', '38028', '38030',
                               '38033', '38035', '38037', '38042',
                               '38044', '38049', '38055', '38058',
                               '38061', '38062', '38069', '38072',
                               '38074', '38076', '38079', '38081',
                               '38083', '38085', '38088', '38090',
                               '38092', '38098', '38102', '38104',
                               '38106', '38108', '38112', '38113',
                               '38118', '38120', '38122', '38124',
                               '38127', '38129', '38134', '38140',
                               '38145', '38148', '38150', '38152',
                               '38155', '38157', '38162', '38164',
                               '38166', '38169', '38171', '38172',
                               '38174', '38176', '38179', '38181',
                               '38184', '38186', '38188', '38190',
                               '38195', '38197', '38199', '38201',
                               '38204', '38206', '38208', '38210',
                               '38215', '38221', '38223', '38225',
                               '38228', '38229', '38234', '38237',
                               '38239', '38246', '38251', '38253',
                               '38255', '38257', '38259', '38261',
                               '38267', '38269', '38271', '38273',
                               '38275', '38278', '38280', '38282',
                               '38284', '38286', '38288', '38298',
                               '38300', '38305', '38308', '38310',
                               '38312', '38318', '38320', '38322',
                               '38327', '38329', '38331', '38333',
                               '38335', '38337', '38342', '38345',
                               '38347', '38349', '38351', '38352',
                               '38353', '38355', '38356', '38357',
                               '38359', '38361', '38362', '38363',
                               '38364', '38366', '38367', '38368',
                               '38370', '38372', '38373', '38374',
                               '38375', '38377', '38378', '38379',
                               '38381', '38382', '38383', '38384',
                               '38386', '38387', '38389', '38391',
                               '38393', '38398', '38400', '38403',
                               '38410', '38415', '38418', '38420',
                               '38425', '38427', '38431', '38433',
                               '38435', '38438', '38440', '38444',
                               '38446', '38448', '38451', '38452',
                               '38454', '38456', '38458', '38460',
                               '38465', '38467', '38469', '38471',
                               '38473', '38475', '38477', '38480',
                               '38485', '38489', '38495', '38497',
                               '38499', '38501', '38503', '38506',
                               '38508', '38510', '38515', '38517',
                               '38519', '38521', '38523', '38525',
                               '38527', '38533', '38535', '38539',
                               '38541', '38545', '38549', '38551',
                               '38553', '38555', '38560', '38562',
                               '38564', '38566', '38568', '38570',
                               '38575', '38576', '38580', '38582',
                               '38584', '38591', '38593', '38595',
                               '38599', '38601', '38606', '38608',
                               '38613', '38616', '38618', '38620',
                               '38625', '38630', '38632', '38635',
                               '38637', '38642', '38644', '38646',
                               '38648', '38650', '38652', '38654',
                               '38658', '38661', '38666', '38670',
                               '38675', '38677', '38682', '38687',
                               '38689', '38691', '38693', '38696',
                               '38698', '38702', '38704', '38706',
                               '38711', '38713', '38715', '38717',
                               '38719', '38721', '38726', '38728',
                               '38730', '38732', '38734', '38735',
                               '38737', '38739', '38741', '38744',
                               '38748', '38752', '38754', '38756',
                               '38761', '38763', '38765', '38767',
                               '38769', '38774', '38781', '38785',
                               '38787', '38791', '38796', '38801',
                               '38804', '38806', '38808', '38812',
                               '38817', '38822', '38826', '38828',
                               '38835', '38837', '38839', '38841',
                               '38846', '38848', '38853', '38858',
                               '38860', '38863', '38865', '38867',
                               '38870', '38872', '38874', '38876',
                               '38878', '38883', '38887', '38889',
                               '38891', '38893', '38898', '38900',
                               '38907', '38909', '38911', '38915',
                               '38918', '38920', '38921', '38924',
                               '38927', '38929', '38930', '38931',
                               '38932', '38934', '38936', '38937',
                               '38939', '38940', '38942', '38943',
                               '38944', '38948', '38950', '38953',
                               '38957', '38960', '38964', '38967',
                               '38969', '38974', '38979', '38981',
                               '38983', '38986', '38990', '38995',
                               '38997', '38999', '39001', '39005',
                               '39006', '39008', '39010', '39012',
                               '39014', '39016', '39017', '39020',
                               '39021', '39022', '39023', '39025',
                               '39027', '39029', '39034', '39036',
                               '39038', '39040', '39044', '39046',
                               '39051', '39053', '39058', '39061',
                               '39063', '39068', '39070', '39072',
                               '39074', '39078', '39082', '39085',
                               '39087', '39091', '39095', '39097',
                               '39099', '39101', '39105', '39110',
                               '39112', '39114', '39123', '39125',
                               '39127', '39129', '39131', '39133',
                               '39143', '39148', '39150', '39152',
                               '39154', '39156', '39158', '39160',
                               '39162', '39164', '39168', '39172',
                               '39174', '39176', '39179', '39181',
                               '39185', '39190', '39192', '39194',
                               '39199', '39201', '39206', '39208',
                               '39210', '39212', '39217', '39219',
                               '39222', '39227', '39229', '39231',
                               '39233', '39235', '39237', '39239',
                               '39241', '39245', '39247', '39249',
                               '39250', '39255', '39256', '39258',
                               '39259', '39260', '39262', '39263',
                               '39266', '39267', '39269', '39271',
                               '39275', '39280', '39282', '39286',
                               '39288', '39290', '39294', '39296',
                               '39301', '39303', '39305', '39307',
                               '39312', '39314', '39319', '39321',
                               '39323', '39325', '39330', '39333',
                               '39335', '39340', '39342', '39344',
                               '39348', '39350', '39353', '39359',
                               '39361', '39365', '39367', '39369',
                               '39373', '39375', '39377', '39381',
                               '39383', '39385', '39387', '39390',
                               '39397', '39399', '39401', '39405',
                               '39410', '39415', '39417', '39421',
                               '39423', '39425', '39427', '39432',
                               '39434', '39436', '39438', '39443',
                               '39445', '39447', '39452', '39454',
                               '39459', '39461', '39464', '39468',
                               '39472', '39474', '39476', '39478',
                               '39480', '39482', '39484', '39486',
                               '39490', '39492', '39496', '39498',
                               '39500', '39502', '39504', '39506',
                               '39510', '39512', '39515', '39517',
                               '39519', '39521', '39523', '39531',
                               '39533', '39535', '39540', '39542',
                               '39544', '39546', '39548', '39550',
                               '39552', '39556', '39558', '39562',
                               '39564', '39566', '39568', '39570',
                               '39572', '39573', '39575', '39577',
                               '39579', '39581', '39588', '39593',
                               '39595', '39597', '39599', '39601',
                               '39607', '39609', '39611', '39613',
                               '39615', '39617', '39619', '39621',
                               '39623', '39627', '39628', '39630',
                               '39635', '39637', '39639', '39641',
                               '39643', '39645', '39647', '39649',
                               '39652', '39654', '39656', '39658',
                               '39660', '39662', '39667', '39669',
                               '39671', '39673', '39676', '39680',
                               '39682', '39684', '39686', '39688',
                               '39690', '39692', '39693', '39695',
                               '39696', '39697', '39699', '39700',
                               '39703', '39706', '39708', '39709',
                               '39711', '39712', '39713', '39716',
                               '39720', '39722', '39724', '39726',
                               '39728', '39730', '39734', '39737',
                               '39739', '39740', '39742', '39744',
                               '39746', '39749', '39753', '39755',
                               '39757', '39759', '39761', '39768',
                               '39774', '39776', '39782', '39784',
                               '39786', '39788', '39790', '39794',
                               '39796', '39801', '39803', '39805',
                               '39807', '39809', '39811', '39813',
                               '39817', '39822', '39826', '39831',
                               '39837', '39838', '39841', '39842',
                               '39845', '39847', '39849', '39852',
                               '39856', '39863', '39866', '39870',
                               '39872', '39874', '39876', '39878',
                               '39881', '39885', '39889', '39892',
                               '39894', '39896', '39900', '39902',
                               '39904', '39906', '39908', '39910',
                               '39912', '39914', '39915', '39918',
                               '39924', '39926', '39928', '39930',
                               '39932', '39934', '39936', '39938',
                               '39942', '39945', '39950', '39951',
                               '39955', '39957', '39959', '39961',
                               '39965', '39967', '39971', '39976',
                               '39978', '39980', '39982', '39985',
                               '39987', '39996', '40001', '40003',
                               '40008', '40010', '40012', '40016',
                               '40018', '40023', '40027', '40031',
                               '40033', '40035', '40039', '40041',
                               '40042', '40046', '40048', '40050',
                               '40052', '40056', '40058', '40062',
                               '40064', '40068', '40070', '40072',
                               '40073', '40075', '40076', '40078',
                               '40079', '40081', '40083', '40085',
                               '40087', '40089', '40091', '40093',
                               '40095', '40098', '40100', '40102',
                               '40105', '40107', '40110', '40112',
                               '40113', '40115', '40119', '40123',
                               '40125', '40127', '40129', '40131',
                               '40134', '40136', '40140', '40142',
                               '40144', '40148', '40150', '40154',
                               '40156', '40158', '40160', '40162',
                               '40164', '40166', '40168', '40170',
                               '40172', '40174', '40176', '40180',
                               '40182', '40184', '40186', '40188',
                               '40190', '40192', '40194', '40198',
                               '40200', '40204', '40206', '40210',
                               '40212', '40214', '40216', '40219',
                               '40221', '40223', '40225', '40227',
                               '40231', '41671', '41672', '41673',
                               '41675', '41676', '41677', '41678',
                               '41679', '41680', '41681', '41682',
                               '41683', '41685', '41686', '41687',
                               '41688', '41689', '41690', '41692',
                               '41693', '41694', '41695', '41696',
                               '41697', '41698', '41699', '41700',
                               '41701', '41702', '41703', '41704',
                               '41705', '41706', '41707', '41708',
                               '41709', '41710', '41711', '41712',
                               '41713', '41714', '41715', '41716',
                               '41717', '41718', '41719', '41721',
                               '41722', '41723', '41724', '41725',
                               '41726', '41727', '41728', '41729',
                               '41730', '41731', '41732', '41733',
                               '41734', '41735', '41736', '41737',
                               '41738', '41739', '41740', '41741',
                               '41742', '41743', '41744', '41745',
                               '41746', '41748', '41749', '41750',
                               '41751', '41752', '41754', '41755',
                               '41756', '41766', '41776', '41777',
                               '41785', '41786', '41787', '41788',
                               '41789', '41790', '41791', '41794',
                               '41795', '41796', '41797', '41798',
                               '41800', '41801', '41802', '41804',
                               '41805', '41806', '41807', '41808',
                               '41810', '41811', '41812', '41813',
                               '41814', '41815', '41816', '41819',
                               '41820', '41821', '41822', '41823',
                               '41824', '41825', '41826', '41827',
                               '41829', '41830', '41831', '41832',
                               '41833', '41834', '41836', '41837',
                               '41838', '41839', '41840', '41841',
                               '41843', '41844', '41846', '41847',
                               '41848', '41849', '41850', '41851',
                               '41852', '41854', '41855', '41856',
                               '41857', '41858', '41859', '41860',
                               '41861', '41862', '41863', '41864',
                               '41866', '41867', '41868', '41869',
                               '41870', '41873', '41874', '41875',
                               '41878', '41879', '41880', '41881',
                               '41882', '41883', '41884', '41885',
                               '41886', '41887', '41888', '41889',
                               '41890', '41891', '41892', '41893',
                               '41894', '41895', '41896', '41897',
                               '41898', '41900', '41901', '41902',
                               '41903', '41904', '41905', '41906',
                               '41907', '41908', '41910', '41911',
                               '41912', '41913', '41914', '41916',
                               '41917', '41918', '41920', '41921',
                               '41922', '41923', '41924', '41925',
                               '41926', '41927', '41928', '41929',
                               '41932', '41933', '41934', '41938',
                               '41939', '41940', '41941', '41946',
                               '41947', '41951', '41952', '41953',
                               '41954', '41955', '41956', '41957',
                               '41958', '41959', '41961', '41962',
                               '41963', '41964', '41966', '41967',
                               '41968', '41969', '41970', '41971',
                               '41972', '41973', '41975', '41976',
                               '41977', '42250', '43028', '43125',
                               '43132', '43187', '43228', '43267',
                               '43268', '43277', '43419', '43434',
                               '43439', '43441', '43443', '43612',
                               '43656', '43667', '43717', '43757',
                               '43760', '43761', '43762', '43773',
                               '43786', '43787', '43791', '43801',
                               '43813', '43817', '43839', '43844',
                               '43861', '43864', '43876', '43878',
                               '43883', '43892', '43893', '43900',
                               '43923', '43996', '44012', '44106',
                               '44115', '44136', '44137', '44142',
                               '44149', '44150', '44152', '44156',
                               '44174', '44197', '44239', '44242',
                               '44298', '44331', '44400', '44403',
                               '44557', '44583', '44591', '44592',
                               '44629', '44635', '44654', '44684',
                               '44711', '44712', '44713', '44780',
                               '44807', '44864', '44880', '44919',
                               '44924', '44955', '44956', '44959',
                               '44960', '44974', '44995', '44996',
                               '44997', '45046', '45047', '45054',
                               '45055', '45061', '45086', '45087',
                               '45094', '45095', '45102', '45103',
                               '45131', '45164', '45186', '45222',
                               '45223', '45270', '45288', '45298',
                               '45326', '45328', '45330', '45334',
                               '45336', '45374', '45383', '45386',
                               '45393', '45394', '45418', '45419',
                               '45515', '45557', '45558', '45569',
                               '45574', '45593', '45596', '45604',
                               '45608', '45622', '45624', '45640',
                               '45651', '45652', '45653', '45662',
                               '45676', '45677', '45682', '45717',
                               '45718', '45744', '45778', '45782',
                               '45793', '45797', '45798', '45832',
                               '45834', '45835', '45836', '45837',
                               '45852', '45861', '45864', '45866',
                               '45891', '45892', '45936', '45944',
                               '45945', '45946', '45947', '45948',
                               '45949', '45950', '45951', '45952',
                               '45953', '45954', '45955', '45956',
                               '45958', '45959', '45960', '45961',
                               '45962', '45963', '45964', '45965',
                               '45966', '45967', '45968', '45969',
                               '45973', '45974', '45975', '45976',
                               '45977', '45978', '45979', '45981',
                               '45982', '45983', '45984', '45985',
                               '45987', '45988', '45989', '45990',
                               '45991', '45992', '45993', '45994',
                               '45995', '45996', '45997', '46001',
                               '46002', '46003', '46004', '46005',
                               '46006', '46007', '46008', '46009',
                               '46010', '46011', '46012', '46013',
                               '46014', '46015', '46016', '46018',
                               '46019', '46021', '46022', '46026',
                               '46028', '46029', '46030', '46031',
                               '46032', '46033', '46034', '46035',
                               '46036', '46037', '46038', '46039',
                               '46040', '46041', '46042', '46043',
                               '46044', '46045', '46046', '46047',
                               '46048', '46049', '46050', '46053',
                               '46054', '46055', '46056', '46057',
                               '46058', '46059', '46060', '46061',
                               '46062', '46063', '46064', '46065',
                               '46066', '46067', '46068', '46069',
                               '46070', '46071', '46072', '46075',
                               '46076', '46077', '46078', '46079',
                               '46081', '46082', '46083', '46084',
                               '46087', '46088', '46089', '46091',
                               '46092', '46093', '46094', '46095',
                               '46096', '46097', '46098', '46099',
                               '46100', '46101', '46102', '46103',
                               '46104', '46105', '46106', '46108',
                               '46109', '46110', '46112', '46113',
                               '46114', '46115', '46117', '46119',
                               '46120', '46121', '46122', '46124',
                               '46125', '46126', '46127', '46128',
                               '46129', '46130', '46131', '46132',
                               '46133', '46134', '46135', '46136',
                               '46138', '46139', '46141', '46142',
                               '46143', '46145', '46147', '46148',
                               '46149', '46150', '46151', '46152',
                               '46153', '46154', '46155', '46156',
                               '46157', '46158', '46159', '46160',
                               '46161', '46162', '46163', '46164',
                               '46165', '46168', '46170', '46171',
                               '46172', '46173', '46174', '46175',
                               '46176', '46177', '46178', '46179',
                               '46180', '46181', '46182', '46183',
                               '46184', '46185', '46186', '46190',
                               '46191', '46192', '46196', '46197',
                               '46198', '46199', '46201', '46202',
                               '46203', '46204', '46205', '46206',
                               '46207', '46209', '46210', '46211',
                               '46212', '46213', '46214', '46215',
                               '46220', '46221', '46222', '46223',
                               '46224', '46225', '46226', '46227',
                               '46228', '46229', '46230', '46231',
                               '46232', '46234', '46235', '46237',
                               '46238', '46240', '46241', '46242',
                               '46243', '46244', '46245', '46247',
                               '46248', '46249', '46252', '46253',
                               '46254', '46256', '46257', '46258',
                               '46259', '46260', '46261', '46263',
                               '46264', '46265', '46266', '46267',
                               '46270', '46273', '46274', '46283',
                               '46284', '46287', '46288', '46289',
                               '46290', '46291', '46292', '46295',
                               '46296', '46297', '46299', '46300',
                               '46303', '46304', '46305', '46306',
                               '46307', '46308', '46309', '46310',
                               '46311', '46315', '46317', '46321',
                               '46322', '46323', '46324', '46329',
                               '46332', '46334', '46335', '46336',
                               '46337', '46338', '46343', '46344',
                               '46345', '46347', '46348', '46353',
                               '46355', '46356', '46358', '46360',
                               '46361', '46362', '46363', '46368',
                    ";;;;;;;;;;;;;;;;;;;;;;;
          '46369', '46370', '46372', '46373',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46374', '46376', '46377', '46378',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46379', '46380', '46382', '46383',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46384', '46385', '46386', '46387',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46388', '46389', '46390', '46391',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46392', '46393', '46394', '46395',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46396', '46397', '46399', '46400',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46401', '46402', '46403', '46405',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46406', '46407', '46408', '46409',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46410', '46411', '46415', '46416',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46417', '46419', '46420', '46422',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46423', '46424', '46426', '46427',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46428', '46431', '46432', '46433',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46434', '46435', '46436', '46437',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46438', '46439', '46440', '46441',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46442', '46445', '46446', '46447',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46448', '46449', '46450', '46451',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46452', '46453', '46455', '46456',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46457', '46458', '46459', '46460',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46461', '46463', '46464', '46465',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46467', '46468', '46469', '46470',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46471', '46472', '46473', '46475',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46476', '46477', '46481', '46482',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46483', '46485', '46486', '46487',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46488', '46489', '46490', '46492',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46493', '46495', '46496', '46497',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46498', '46499', '46500', '46511',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46516', '46520', '46535', '46536',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46537', '46538', '46539', '46540',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46541', '46543', '46544', '46589',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46592', '46597', '46719', '46720',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46729', '46779', '46780', '46990',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '46991', '47043', '47044', '47045',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '47046', '47066', '47096', '47098',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '47117', '47119', '47120', '47121',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '47122', '47123', '47130', '47198',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '47229', '47276', '47278', '47346',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '47611', '47612', '47613', '47634',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '47709', '47710', '47794', '47890',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '47891', '47968', '47969', '48006',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '48037', '48163', '48426', '48510',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '48511', '48512', '48513', '48514',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '48516', '48517', '48518', '48519',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '48520', '48521', '48596', '48813',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '48822', '48823', '48830', '48837',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '48838', '48839', '48840', '48841',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '48842', '48843', '48846', '48847',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '48858', '48859', '48862', '49098',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '49172', '49173', '49180', '49219',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '49220', '49321', '49330', '49331',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '49343', '49344', '49370', '49371',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '49405', '49406', '49413', '49414',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '49435', '49438', '49444', '49455',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '50196', '51191', '51200', '51201',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '51214', '51215', '51226', '51227',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '51240', '51241', '51744', '51746',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52297', '52299', '52685', '52686',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52806', '52814', '52882', '52899',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52900', '52908', '52909', '52912',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52913', '52914', '52915', '52919',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52921', '52942', '52943', '52964',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52965', '52966', '52976', '52978',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52979', '52981', '52983', '52984',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52986', '52987', '52992', '52993',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '52994', '52998', '53002', '53003',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '53004', '53005', '53008', '53012',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '53016', '53017', '53018', '53021',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '53022', '53023', '53026', '53033',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '53034', '53036', '53037', '53039',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '53043', '53045', '53046', '53047',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '53049', '53076', '53079', '53080',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '53082', '53083', '53084', '53090',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '53095', '53099', '53116', '53130',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '55834', '56023', '56026', '56028',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '56029', '56062', '56063', '56064',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '56065', '56094', '56119', '56120',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '56121', '56187', '57241', '57815',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '57818', '57822', '57824', '57825',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '57832', '58051', '62322', '62323',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '62334', '62337', '62338', '62478',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '62501', '62502', '64482', '64533',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '65465', '65466', '66174', '70400',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '71041', '71047', '71048', '71367',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '71374', '71494', '71548', '71549',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '71572', '71573', '71588', '71589',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '71623', '71624', '71819', '71820',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '72998', '74380', '75684', '76105',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '76708', '76709', '77434', '78128',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '79850', '79851', '79985', '80338',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '80548', '80920', '81399', '81400',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '81401', '81402', '81489', '81491',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '83996', '86843', '87082', '88858',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '90742', '90963', '90964', '90975',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '90976', '90987', '91164', '95107',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '95198', '95238', '95290', '95437',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '95623', '95624', '95728', '95737',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '96123', '96177', '96179', '96180',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '96289', '96302', '96304', '96306',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '96315', '96316', '96555', '96766',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '96776', '96777', '96789', '96790',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '96791', '96792', '96793', '96844',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '96845', '97006', '97483', '97580',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '97754', '97770', '98069', '99115',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '99192', '100357', '100702', '100711',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '100950', '101765', '101824', '101862',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '103291', '105075', '106735', '109741',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '110578', '110866', '111063', '111154',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '120127', '121177', '123157', '123158',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '128490', '128549', '130385', '133021',;;;;;;;;;;;;;;;;;;;;;;;;;;
                               '143982', '143983', '143985', '153073', '153622' ) ;;;;;;;;;;;;;;;;;;;;;;;;;;
";40258;;;;11/03/2022;marli.oliveira;0;1;1;1;;;;0;15b05897-235f-4be1-87d9-144bebdf0219;0;;3088;marli.oliveira;08/03/2022;marli.oliveira;11/03/2022;0
C;PVT.014;RELATORIO PROVISAO CONTABIL GRADUAÇÃO;SELECT ENTIDADE, ISNULL(SUM(PAGANTES), 0.0000) PAGANTES, ISNULL(SUM(FIES), 0.0000) FIES, ISNULL(SUM(PROUNI), 0.0000) PROUNI,  ISNULL(SUM(DESCONTO), 0.0000) DESCONTO, ISNULL(SUM(GRATUIDADE), 0.0000) GRATUIDADE, ISNULL(SUM(SEMIGRATUIDADE), 0.0000) SEMIGRATUIDADE, ISNULL(SUM(DESCONTOFUNCIONAL), 0.0000) DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
FROM (;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*################################################################";;;;;;;;;;;;;;;;;;;;;;;;;;
"				VALOR PAGANTES";;;;;;;;;;;;;;;;;;;;;;;;;;
"		################################################################*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Débito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS PAGANTES, 0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DEBITO = '3.1.41.201'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODHISTP <> 0010";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Crédito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS PAGANTES, 0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CREDITO = '3.1.41.201'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODHISTP <> 0010";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos de Saldo anterior na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, VALOR AS PAGANTES, 0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE, 0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CSALDOEXERCICIO S(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE IDEXERCICIO = (";;;;;;;;;;;;;;;;;;;;;;;;;;
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"					        )";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCONTA = '3.1.41.201'";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*################################################################";;;;;;;;;;;;;;;;;;;;;;;;;;
"				VALOR FIES";;;;;;;;;;;;;;;;;;;;;;;;;;
"		################################################################*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Débito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) FIES, 0.0000 PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DEBITO = '3.1.41.206'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Crédito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) FIES, 0.0000 PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CREDITO = '3.1.41.206'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos de Saldo anterior na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES, VALOR AS FIES, 0.0000 PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CSALDOEXERCICIO S(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE IDEXERCICIO = (";;;;;;;;;;;;;;;;;;;;;;;;;;
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"					        )";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCONTA = '3.1.41.206'";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"			UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*################################################################";;;;;;;;;;;;;;;;;;;;;;;;;;
"				VALOR PROUNI";;;;;;;;;;;;;;;;;;;;;;;;;;
"		################################################################*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Débito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DEBITO IN ('3.1.41.221', '3.1.41.222')";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Crédito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CREDITO IN ('3.1.41.221', '3.1.41.222')";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos de Saldo anterior na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES,  0.0000 FIES, VALOR AS PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE, 0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CSALDOEXERCICIO S(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE IDEXERCICIO = (";;;;;;;;;;;;;;;;;;;;;;;;;;
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"					        )";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCONTA IN ('3.1.41.221', '3.1.41.222')";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*################################################################";;;;;;;;;;;;;;;;;;;;;;;;;;
"				VALOR DESCONTO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		################################################################*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Débito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES, 0.0000 PROUNI, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTO,  0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DEBITO IN ('3.1.49.026', '3.1.49.028')";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*AND P.CODCCUSTO LIKE '1.202%'*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Crédito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES,  0.0000 PROUNI, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CREDITO IN ('3.1.49.026', '3.1.49.028')";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*AND P.CODCCUSTO LIKE '1.202%'*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos de Saldo anterior na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES,  0.0000 FIES, 0.0000 PROUNI, VALOR AS DESCONTO,  0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE, 0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CSALDOEXERCICIO S(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE IDEXERCICIO = (";;;;;;;;;;;;;;;;;;;;;;;;;;
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"					        )";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCONTA IN ('3.1.49.026', '3.1.49.028') ";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*################################################################";;;;;;;;;;;;;;;;;;;;;;;;;;
"				VALOR GRATUIDADE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		################################################################*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Débito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) GRATUIDADE,   0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DEBITO = '3.1.41.226'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Crédito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES,  0.0000 PROUNI, 0.0000 DESCONTO, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) GRATUIDADE,  0.0000 SEMIGRATUIDADE,  0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CREDITO = '3.1.41.226'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos de Saldo anterior na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES,  0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO, VALOR AS GRATUIDADE,   0.0000 SEMIGRATUIDADE, 0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CSALDOEXERCICIO S(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE IDEXERCICIO = (";;;;;;;;;;;;;;;;;;;;;;;;;;
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"					        )";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCONTA = '3.1.41.226'";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*################################################################";;;;;;;;;;;;;;;;;;;;;;;;;;
"				VALOR SEMIGRATUIDADE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		################################################################*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Débito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO,  0.0000 GRATUIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SEMIGRATUIDADE, 0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DEBITO = '3.1.41.227'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Crédito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES,  0.0000 PROUNI, 0.0000 DESCONTO,  0.0000 GRATUIDADE, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SEMIGRATUIDADE,   0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CREDITO = '3.1.41.227'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos de Saldo anterior na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES,  0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE, VALOR AS SEMIGRATUIDADE,    0.0000 DESCONTOFUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CSALDOEXERCICIO S(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE IDEXERCICIO = (";;;;;;;;;;;;;;;;;;;;;;;;;;
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"					        )";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCONTA = '3.1.41.227'";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*################################################################";;;;;;;;;;;;;;;;;;;;;;;;;;
"				VALOR DESCONTO FUNCIONAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		################################################################*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Débito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO,  0.0000 GRATUIDADE,   0.0000 SEMIGRATUIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTOFUNCIONAL  ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DEBITO IN ('3.1.41.212', '3.1.41.211', '3.1.41.214')";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos a Crédito na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 FIES,  0.0000 PROUNI, 0.0000 DESCONTO,  0.0000 GRATUIDADE,  0.0000 SEMIGRATUIDADE, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTOFUNCIONAL  ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CPARTIDA P(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE P.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CREDITO IN ('3.1.41.212', '3.1.41.211', '3.1.41.214')";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.DATA <= :Data_D";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND P.CODLOTE = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND G.CODFILIAL = :CODFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		UNION ALL";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"		/* Lançamentos de Saldo anterior na conta */";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SELECT";;;;;;;;;;;;;;;;;;;;;;;;;;
"			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES,  0.0000 FIES, 0.0000 PROUNI, 0.0000 DESCONTO, 0.0000 GRATUIDADE,  0.0000 SEMIGRATUIDADE, VALOR AS DESCONTOFUNCIONAL   ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FROM CSALDOEXERCICIO S(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		WHERE IDEXERCICIO = (";;;;;;;;;;;;;;;;;;;;;;;;;;
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"					        )";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCOLIGADA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND S.CODCONTA IN ('3.1.41.212', '3.1.41.211', '3.1.41.214')";;;;;;;;;;;;;;;;;;;;;;;;;;
"	) SALDO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	GROUP BY ENTIDADE""";14471;;;;25/10/2022;joel.silvano;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;-5285;marli.oliveira;10/05/2022;joel.silvano;25/10/2022;0;;;
C;PVT.015;RELATORIO PROVISAO CONTABIL PÓS-GRADUAÇÃO;"SELECT ENTIDADE, ISNULL(SUM(PAGANTES), 0.0000) PAGANTES, ISNULL(SUM(DESCONTO), 0.0000) DESCONTO, ISNULL(SUM(GRATUIDADE), 0.0000) GRATUIDADE, ISNULL(SUM(SEMIGRATUIDADE), 0.0000) SEMIGRATUIDADE
FROM (
		/*################################################################
				VALOR PAGANTES
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS PAGANTES, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.41.301'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL
		AND P.CODHISTP <> 0010
		
		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS PAGANTES, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.41.301'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL
		AND P.CODHISTP <> 0010

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS PAGANTES, 0.0000 DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.41.301'

		UNION ALL
		/*################################################################
				VALOR DESCONTO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTO,  0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO IN ('3.1.49.026', '3.1.49.028')
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND P.CODCCUSTO LIKE '1.203%'
		AND G.CODFILIAL = :CODFILIAL
		

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTO, 0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO IN ('3.1.49.026', '3.1.49.028')
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND P.CODCCUSTO LIKE '1.203%'
		AND G.CODFILIAL = :CODFILIAL
		

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES,  VALOR AS DESCONTO,  0.0000 GRATUIDADE, 0.0000 SEMIGRATUIDADE
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA IN ('3.1.49.026', '3.1.49.028') 

		UNION ALL
		/*################################################################
				VALOR GRATUIDADE
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 DESCONTO, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) GRATUIDADE,   0.0000 SEMIGRATUIDADE
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.41.314'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 DESCONTO, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) GRATUIDADE,  0.0000 SEMIGRATUIDADE 
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.41.314'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES,  0.0000 DESCONTO, VALOR AS GRATUIDADE,   0.0000 SEMIGRATUIDADE
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.41.314'

		UNION ALL
		/*################################################################
				VALOR SEMIGRATUIDADE
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 DESCONTO,  0.0000 GRATUIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SEMIGRATUIDADE
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.41.311'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PAGANTES, 0.0000 DESCONTO,  0.0000 GRATUIDADE, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SEMIGRATUIDADE
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.41.311'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PAGANTES,  0.0000 DESCONTO, 0.0000 GRATUIDADE, VALOR AS SEMIGRATUIDADE
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.41.311'
	) SALDO
	GROUP BY ENTIDADE";7628;;;;25/10/2022;joel.silvano;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;26107;marli.oliveira;12/05/2022;joel.silvano;25/10/2022;0
C;PVT.016;Relatorio: PVT003 - INDICE DE INADIMPLENCIA GERAL SIMPLIFICADO;"SELECT ENTIDADE, CODCONTA, 

(SELECT SUM(ARECEBER) FROM 
(       SELECT ISNULL(SUM(R.VALOR),0) AS ARECEBER

		FROM CPARTIDA R (NOLOCK)
		LEFT OUTER JOIN CHISTP H (NOLOCK) ON R.CODCOLIGADA = H.CODCOLIGADA AND R.CODHISTP = H.CODHISTP
		LEFT OUTER JOIN CLCOMPL C (NOLOCK) ON R.CODCOLIGADA = C.CODCOLIGADA AND R.IDPARTIDA = C.IDPARTIDA
			
		WHERE R.CODCOLIGADA = 1
		
		AND ((SUBSTRING(X.CODCONTA,1,10) = '1.1.32.021'
		AND R.CREDITO IN ('3.1.41.201','3.1.41.206','3.1.41.211','3.1.41.212','3.1.41.214','3.1.41.221','3.1.41.222','3.1.41.226',
                          '3.1.41.227','3.1.49.211','3.1.49.212','3.1.49.214','3.1.49.221','3.1.49.222','3.1.49.226','3.1.49.227'))
		
		OR (SUBSTRING(X.CODCONTA,1,10) = '1.1.32.031'
		AND R.CREDITO IN ('3.1.41.301','3.1.41.311','3.1.41.314','3.1.49.311','3.1.49.314'))

		OR (SUBSTRING(X.CODCONTA,1,10) = '1.1.32.099'
		AND R.CREDITO IN ('3.1.86.006','3.1.87.001','3.1.87.003','3.1.87.501','3.1.87.508','3.1.87.510','3.1.87.518')))


		AND (C.ANORECEITA = CAST(RIGHT(X.CODCONTA,4) AS VARCHAR(4)) OR
		    (C.ANORECEITA IS NULL AND CAST(RIGHT(X.CODCONTA,4) AS VARCHAR(4)) IN ('2021','2022') AND R.DATA<=:Data_Final_D 
		     AND CAST(RIGHT(X.CODCONTA,4) AS VARCHAR(4)) = YEAR(R.DATA)))
		AND R.CODFILIAL =:CODFILIAL
		AND (H.HISTFECHA=0 OR H.CODHISTP IN ('0010','0011'))
		
		
		UNION ALL
		
		SELECT -ISNULL(SUM(R.VALOR),0) AS ARECEBER

		FROM CPARTIDA R (NOLOCK)
		LEFT OUTER JOIN CHISTP H (NOLOCK) ON R.CODCOLIGADA = H.CODCOLIGADA AND R.CODHISTP = H.CODHISTP
		LEFT OUTER JOIN CLCOMPL C (NOLOCK) ON R.CODCOLIGADA = C.CODCOLIGADA AND R.IDPARTIDA = C.IDPARTIDA
			
		WHERE R.CODCOLIGADA = 1
		
		AND ((SUBSTRING(X.CODCONTA,1,10) = '1.1.32.021'
		AND R.DEBITO IN ('3.1.41.201','3.1.41.206','3.1.41.211','3.1.41.212','3.1.41.214','3.1.41.221','3.1.41.222','3.1.41.226',
                          '3.1.41.227','3.1.49.211','3.1.49.212','3.1.49.214','3.1.49.221','3.1.49.222','3.1.49.226','3.1.49.227'))
		
		OR (SUBSTRING(X.CODCONTA,1,10) = '1.1.32.031'
		AND R.DEBITO IN ('3.1.41.301','3.1.41.311','3.1.41.314','3.1.49.311','3.1.49.314'))

		OR (SUBSTRING(X.CODCONTA,1,10) = '1.1.32.099'
		AND R.DEBITO IN ('3.1.86.006','3.1.87.001','3.1.87.003','3.1.87.501','3.1.87.508','3.1.87.510','3.1.87.518')))


		AND (C.ANORECEITA = CAST(RIGHT(X.CODCONTA,4) AS VARCHAR(4)) OR
		    (C.ANORECEITA IS NULL AND CAST(RIGHT(X.CODCONTA,4) AS VARCHAR(4)) IN ('2021','2022') AND R.DATA<=:Data_Final_D 
		     AND CAST(RIGHT(X.CODCONTA,4) AS VARCHAR(4)) = YEAR(R.DATA)))
		AND R.CODFILIAL =:CODFILIAL
		AND (H.HISTFECHA=0 OR H.CODHISTP IN ('0010','0011'))
		
		) AS X ) AS ARECEBER,

SUM(RECEBIDOS) RECEBIDOS

FROM (

SELECT G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA CODCONTA, ISNULL(SUM(P.VALOR),0) AS RECEBIDOS
		
		FROM CPARTIDA P (NOLOCK)
		JOIN CCONTA C (NOLOCK) ON (P.CODCOLCREDITO = C.CODCOLIGADA AND P.CREDITO = C.CODCONTA)
		JOIN GFILIAL G (NOLOCK) ON (P.CODCOLIGADA = G.CODCOLIGADA AND P.CODFILIAL = G.CODFILIAL)
		
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO >=:Conta_Inicial
		AND P.CREDITO <=:Conta_Final
		AND P.DATA >=:Data_Inicial_D
		AND P.DATA <=:Data_Final_D
		AND G.CODFILIAL =:CODFILIAL
		
	
	GROUP BY G.NOMEFANTASIA, C.CODCONTA, P.CREDITO

	UNION ALL

	SELECT G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, -ISNULL(SUM(P.VALOR),0) AS RECEBIDOS
		
		FROM CPARTIDA P (NOLOCK)
		JOIN CCONTA C (NOLOCK) ON (P.CODCOLDEBITO = C.CODCOLIGADA AND P.DEBITO = C.CODCONTA)
		JOIN GFILIAL G (NOLOCK) ON (P.CODCOLIGADA = G.CODCOLIGADA AND P.CODFILIAL = G.CODFILIAL)
		
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO >=:Conta_Inicial
		AND P.DEBITO <=:Conta_Final
		AND P.DATA >=:Data_Inicial_D
		AND P.DATA <=:Data_Final_D
		AND G.CODFILIAL =:CODFILIAL
		
	
	GROUP BY G.NOMEFANTASIA, C.CODCONTA, P.DEBITO ) AS X

	GROUP BY X.ENTIDADE, X.CODCONTA
	
	ORDER BY X.CODCONTA";3878;;;;10/11/2022;carla.ozelo;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;23077;marli.oliveira;12/05/2022;carla.ozelo;10/11/2022;0
C;PVT.016.1;INDICE DE INADIMPLENCIA GERAL 1132031;"SELECT
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO), 0.0000) SALDO 
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.031%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL
		
		

		UNION ALL
		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS ARECEBER, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) RECEBIDOS, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.031%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.031%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.031%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,  0.0000 RECEBIDOS, VALOR AS SALDO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA LIKE '1.1.32.031%'
	) SALDO
	GROUP BY ENTIDADE
";3336;;;;26/10/2022;joel.silvano;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;-25881;marli.oliveira;12/05/2022;joel.silvano;26/10/2022;0
C;PVT.016.2;INDICE DE INADIMPLENCIA GERAL 1132099;"SELECT
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO), 0.0000) SALDO 
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.099%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS ARECEBER, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) RECEBIDOS, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.099%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.099%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.099%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,  0.0000 RECEBIDOS, VALOR AS SALDO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA LIKE '1.1.32.099%'
	) SALDO
	GROUP BY ENTIDADE
";3328;;;;12/05/2022;marli.oliveira;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;-27040;marli.oliveira;12/05/2022;marli.oliveira;12/05/2022;0
C;PVT.016.3;IIG1132031;"SELECT
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(ACAO), 0.0000) ACAO, 
ISNULL(SUM(ACORDO), 0.0000) ACORDO, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO), 0.0000) SALDO 
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.031%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACAO
		################################################################*/
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,(P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%112'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACORDO
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS ACORDO, 0.0000 RECEBIDO, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%113'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS RECEBIDOS, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.031%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.031%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.031%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,  0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, VALOR AS SALDO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA LIKE '1.1.32.031%'
	) SALDO
	GROUP BY ENTIDADE
";5026;;;;13/06/2022;marli.oliveira;0;1;1;1;;;;0;9cdffc22-a57b-487e-ac8c-b2348b02567a;;;4910;marli.oliveira;09/06/2022;marli.oliveira;13/06/2022;
C;PVT.016.4;IIG 1132099;"SELECT
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(ACAO), 0.0000) ACAO, 
ISNULL(SUM(ACORDO), 0.0000) ACORDO, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO), 0.0000) SALDO 
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.099%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACAO
		################################################################*/
		/* Lançamentos a Crédito na conta */
		SELECT 
		G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%112'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACORDO
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
		G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS ACORDO, 0.0000 RECEBIDO, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%113'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL
		
		UNION ALL

		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
		G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS RECEBIDOS, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.099%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.099%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.099%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,  0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, VALOR AS SALDO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA LIKE '1.1.32.099%'
	) SALDO
	GROUP BY ENTIDADE
";5056;;;;13/06/2022;marli.oliveira;0;1;1;1;;;;0;ba5f441c-eb9e-4f79-b458-fffd4bb2a74d;;;-4650;marli.oliveira;09/06/2022;marli.oliveira;13/06/2022;
C;PVT.016.5;IIG 1132021;"SELECT ENTIDADE,
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(ACAO), 0.0000) ACAO, 
ISNULL(SUM(ACORDO), 0.0000) ACORDO, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO), 0.0000) SALDO 
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.021%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACAO
		################################################################*/
		/* Lançamentos a Credito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,(P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%112'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/*################################################################
				ACORDO
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS ACORDO, 0.0000 RECEBIDO, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%113'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.021%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.021%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.021%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,  0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, VALOR AS SALDO
			FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA LIKE '1.1.32.021%'
	) SALDO
	GROUP BY ENTIDADE
";5071;;;;13/06/2022;marli.oliveira;0;1;1;1;;;;0;00702403-560a-4591-a92e-c20c7253b659;;;-4995;marli.oliveira;09/06/2022;marli.oliveira;13/06/2022;
C;PVT.016.6;Relatorio: PVT003.1 - INDICE DE INADIMPLENCIA GERAL POR CENTRO DE CUSTO;"SELECT ENTIDADE, CODCONTA, CODCCUSTO,
ISNULL(SUM(SALDO_ANTERIOR), 0.0000) SALDO_ANTERIOR,
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO_ATUAL), 0.0000) SALDO_ATUAL
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, P.CODCCUSTO, 0.0000 SALDO_ANTERIOR, P.VALOR AS ARECEBER, 0.0000 RECEBIDOS, 0.0000 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		
		
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO >=:CONTA_INICIAL
		AND P.DEBITO <=:CONTA_FINAL
		AND P.DATA >=:DATA_INICIAL_D
		AND P.DATA <=:DATA_FINAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			 G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, P.CODCCUSTO, 0.0000 SALDO_ANTERIOR, 0.0000 AS ARECEBER, P.VALOR * -1 RECEBIDOS, 0.0000 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO = C.CODCOLIGADA AND P.CREDITO = C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA = G.CODCOLIGADA AND P.CODFILIAL = G.CODFILIAL)
		
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO >=:CONTA_INICIAL
		AND P.CREDITO <=:CONTA_FINAL
		AND P.DATA >=:DATA_INICIAL_D
		AND P.DATA <=:DATA_FINAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, P.CODCCUSTO, 0.0000 SALDO_ANTERIOR, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, P.VALOR SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO >=:CONTA_INICIAL
		AND P.DEBITO <=:CONTA_FINAL
		AND P.DATA <=:DATA_FINAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, P.CODCCUSTO, 0.0000 SALDO_ANTERIOR, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, P.VALOR * -1 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO >=:CONTA_INICIAL
		AND P.CREDITO <=:CONTA_FINAL
		AND P.DATA <=:DATA_FINAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, P.CODCCUSTO, P.VALOR SALDO_ANTERIOR, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, 0.0000 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO >=:CONTA_INICIAL
		AND P.DEBITO <=:CONTA_FINAL
		AND P.DATA <:DATA_INICIAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, P.CODCCUSTO, P.VALOR * -1 SALDO_ANTERIOR, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, 0.0000 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO >=:CONTA_INICIAL
		AND P.CREDITO <=:CONTA_FINAL
		AND P.DATA <:DATA_INICIAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL
	
		
	) AS SALDO
	
	GROUP BY ENTIDADE, CODCONTA, CODCCUSTO
";4400;;;;21/10/2022;carla.ozelo;0;1;1;1;;;;0;51d1d5c1-0d61-44c7-a117-f368280c4f7a;0;;25749;carla.ozelo;21/10/2022;carla.ozelo;21/10/2022;0
C;PVT.017;RELATORIO DE DESCONTOS;"SELECT ENTIDADE, ISNULL(SUM(DESCONTOSFINANCEIRO), 0.0000) DESCONTOSFINANCEIRO, ISNULL(SUM(DESCONTOSINCONDICIONAIS), 0.0000) DESCONTOSINCONDICIONAIS, ISNULL(SUM(DESCONTOSCONDICIONAIS), 0.0000) DESCONTOSCONDICIONAIS
FROM (
		/*################################################################
				DESCONTOS FINANCEIRO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS DESCONTOSFINANCEIRO, 0.0000 DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '4.1.26.005'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS DESCONTOSFINANCEIRO, 0.0000 DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '4.1.26.005'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS DESCONTOSFINANCEIRO, 0.0000 DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '4.1.26.005'

		UNION ALL
		/*################################################################
				DESCONTOS INCONDICIONAIS
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS DESCONTOSFINANCEIRO, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.49.026'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS DESCONTOSFINANCEIRO, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.49.026'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 DESCONTOSFINANCEIRO, VALOR AS DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.49.026'

			UNION ALL
		/*################################################################
				DESCONTOS CONDICIONAIS
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS DESCONTOSFINANCEIRO, 0.0000 DESCONTOSINCONDICIONAIS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTOSCONDICIONAIS
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.49.028'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS DESCONTOSFINANCEIRO, 0.0000 DESCONTOSINCONDICIONAIS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTOSCONDICIONAIS
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.49.028'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 DESCONTOSFINANCEIRO,  0.0000 DESCONTOSINCONDICIONAIS, VALOR AS DESCONTOSCONDICIONAIS
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.49.028'

	) SALDO
	GROUP BY ENTIDADE";5795;;;;19/05/2022;marli.oliveira;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;12273;marli.oliveira;19/05/2022;marli.oliveira;19/05/2022;0
C;PVT.017.3;IIG1132031;"SELECT
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(ACAO), 0.0000) ACAO, 
ISNULL(SUM(ACORDO), 0.0000) ACORDO, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO), 0.0000) SALDO 
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.031%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACAO
		################################################################*/
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,(P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%112'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACORDO
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS ACORDO, 0.0000 RECEBIDO, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%113'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS RECEBIDOS, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.031%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.031%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.031%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,  0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, VALOR AS SALDO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA LIKE '1.1.32.031%'
	) SALDO
	GROUP BY ENTIDADE
";;;;;;;0;1;1;1;;;;;7ae522a0-219b-48ad-b9ab-4f75b405ecb9;;;3171;marli.oliveira;15/09/2022;marli.oliveira;15/09/2022;
C;PVT.017.4;IIG 1132099;"SELECT
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(ACAO), 0.0000) ACAO, 
ISNULL(SUM(ACORDO), 0.0000) ACORDO, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO), 0.0000) SALDO 
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.099%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACAO
		################################################################*/
		/* Lançamentos a Crédito na conta */
		SELECT 
		G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%112'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACORDO
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
		G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS ACORDO, 0.0000 RECEBIDO, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%113'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL
		
		UNION ALL

		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
		G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS RECEBIDOS, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.099%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.099%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.099%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,  0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, VALOR AS SALDO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA LIKE '1.1.32.099%'
	) SALDO
	GROUP BY ENTIDADE
";;;;;;;0;1;1;1;;;;;7210d625-5a52-4314-88cd-b303bbd002e6;;;21729;marli.oliveira;15/09/2022;marli.oliveira;15/09/2022;
C;PVT.017.5;IIG 1132021;"SELECT ENTIDADE,
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(ACAO), 0.0000) ACAO, 
ISNULL(SUM(ACORDO), 0.0000) ACORDO, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO), 0.0000) SALDO 
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.021%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				ACAO
		################################################################*/
		/* Lançamentos a Credito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,(P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%112'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/*################################################################
				ACORDO
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS ACORDO, 0.0000 RECEBIDO, 0.0000 SALDO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.39%113'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		
		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS RECEBIDOS, 0.0000 SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.021%'
		AND P.DATA >= :Data_Inicial_D
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO LIKE '1.1.32.021%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER, 0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) SALDO
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO LIKE '1.1.32.021%'
		AND P.DATA <= :Data_Final_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 ARECEBER,  0.0000 ACAO, 0.0000 ACORDO, 0.0000 RECEBIDOS, VALOR AS SALDO
			FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA LIKE '1.1.32.021%'
	) SALDO
	GROUP BY ENTIDADE
";;;;;;;0;1;1;1;;;;;cdb42ffa-12a7-498a-b5ff-e9bcb5e7a5ad;;;-6848;marli.oliveira;15/09/2022;marli.oliveira;15/09/2022;
C;PVT.018;RELATÓRIO RECEITA CURSO EXTRA CURRICULARES;"SELECT ENTIDADE, ISNULL(SUM(CURSOESPORTES), 0.0000) CURSOESPORTES, ISNULL(SUM(CURSOSIDIOMA), 0.0000) CURSOSIDIOMA
FROM (
		/*################################################################
				CURSO ESPORTES
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.01.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL
		AND P.CODHISTP <> 0010

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.01.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL
		AND P.CODHISTP <> 0010

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.01.00000000000102'

		UNION ALL
		/*################################################################
				CURSOS IDIOMA
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.01.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL
		AND P.CODHISTP <> 0010

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.01.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL
		AND P.CODHISTP <> 0010

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 CURSOESPORTES, VALOR AS CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.01.00000000000103'

	) SALDO
	GROUP BY ENTIDADE";3754;;;;25/10/2022;joel.silvano;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;9364;marli.oliveira;19/05/2022;joel.silvano;25/10/2022;0
C;PVT.018.EAD;RELATÓRIO RECEITA CURSO EXTRA CURRICULARES;"SELECT ENTIDADE, ISNULL(SUM(CURSOESPORTES), 0.0000) CURSOESPORTES, ISNULL(SUM(CURSOSIDIOMA), 0.0000) CURSOSIDIOMA
FROM (
		/*################################################################
				CURSO ESPORTES
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.04.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.04.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.04.00000000000102'

		UNION ALL
		/*################################################################
				CURSOS IDIOMA
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.04.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.04.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 CURSOESPORTES, VALOR AS CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.04.00000000000103'

	) SALDO
	GROUP BY ENTIDADE";3650;;;;09/06/2022;marli.oliveira;0;1;1;1;;;;0;9795470a-4fbc-4bf0-ac8a-9ec900ed36f2;;;-22645;marli.oliveira;09/06/2022;marli.oliveira;09/06/2022;
C;PVT.018.EC;RELATÓRIO RECEITA CURSO EXTRA CURRICULARES;"SELECT ENTIDADE, ISNULL(SUM(CURSOESPORTES), 0.0000) CURSOESPORTES, ISNULL(SUM(CURSOSIDIOMA), 0.0000) CURSOSIDIOMA
FROM (
		/*################################################################
				CURSO ESPORTES
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.02.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.02.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.02.00000000000102'

		UNION ALL
		/*################################################################
				CURSOS IDIOMA
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.02.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.02.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 CURSOESPORTES, VALOR AS CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.02.00000000000103'

	) SALDO
	GROUP BY ENTIDADE";3650;;;;09/06/2022;marli.oliveira;0;1;1;1;;;;0;9795470a-4fbc-4bf0-ac8a-9ec900ed36f2;;;-10759;marli.oliveira;09/06/2022;marli.oliveira;09/06/2022;
C;PVT.018.HT;RELATÓRIO RECEITA CURSO EXTRA CURRICULARES;"SELECT ENTIDADE, ISNULL(SUM(CURSOESPORTES), 0.0000) CURSOESPORTES, ISNULL(SUM(CURSOSIDIOMA), 0.0000) CURSOSIDIOMA
FROM (
		/*################################################################
				CURSO ESPORTES
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.03.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.03.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.03.00000000000102'

		UNION ALL
		/*################################################################
				CURSOS IDIOMA
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.03.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.03.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 CURSOESPORTES, VALOR AS CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.03.00000000000103'

	) SALDO
	GROUP BY ENTIDADE";3650;;;;09/06/2022;marli.oliveira;0;1;1;1;;;;0;9795470a-4fbc-4bf0-ac8a-9ec900ed36f2;;;-15634;marli.oliveira;09/06/2022;marli.oliveira;09/06/2022;
C;PVT.018.SP;RELATÓRIO RECEITA CURSO EXTRA CURRICULARES;"SELECT ENTIDADE, ISNULL(SUM(CURSOESPORTES), 0.0000) CURSOESPORTES, ISNULL(SUM(CURSOSIDIOMA), 0.0000) CURSOSIDIOMA
FROM (
		/*################################################################
				CURSO ESPORTES
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.01.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.01.00000000000102'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS CURSOESPORTES, 0.0000 CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.01.00000000000102'

		UNION ALL
		/*################################################################
				CURSOS IDIOMA
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.01.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOESPORTES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) CURSOSIDIOMA
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.01.00000000000103'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 CURSOESPORTES, VALOR AS CURSOSIDIOMA
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.01.00000000000103'

	) SALDO
	GROUP BY ENTIDADE";3650;;;;09/06/2022;marli.oliveira;0;1;1;1;;;;0;9795470a-4fbc-4bf0-ac8a-9ec900ed36f2;;;-4928;marli.oliveira;09/06/2022;marli.oliveira;09/06/2022;
C;PVT.019;RELATÓRIO PENSIONATO;"SELECT ENTIDADE, ISNULL(SUM(PENSIONATO), 0.0000) PENSIONATO, ISNULL(SUM(DESCONTOSPENSIONATO), 0.0000) DESCONTOSPENSIONATO
FROM (
		/*################################################################
				PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.001.01.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.001.01.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.001.01.00000000000101'

		UNION ALL
		/*################################################################
				DESCONTOS PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.501.01.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.501.01.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PENSIONATO, VALOR AS DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.501.01.00000000000201'

	) SALDO
	GROUP BY ENTIDADE";3685;;;;20/05/2022;marli.oliveira;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;-26979;marli.oliveira;19/05/2022;marli.oliveira;20/05/2022;0
C;PVT.019.EAD;RELATÓRIO PENSIONATO;"SELECT ENTIDADE, ISNULL(SUM(PENSIONATO), 0.0000) PENSIONATO, ISNULL(SUM(DESCONTOSPENSIONATO), 0.0000) DESCONTOSPENSIONATO
FROM (
		/*################################################################
				PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.001.04.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.001.04.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.001.04.00000000000101'

		UNION ALL
		/*################################################################
				DESCONTOS PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.501.04.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.501.04.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PENSIONATO, VALOR AS DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.501.04.00000000000201'

	) SALDO
	GROUP BY ENTIDADE";3685;;;;09/06/2022;marli.oliveira;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;6695;marli.oliveira;09/06/2022;marli.oliveira;09/06/2022;0
C;PVT.019.EC;RELATÓRIO PENSIONATO;"SELECT ENTIDADE, ISNULL(SUM(PENSIONATO), 0.0000) PENSIONATO, ISNULL(SUM(DESCONTOSPENSIONATO), 0.0000) DESCONTOSPENSIONATO
FROM (
		/*################################################################
				PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.001.02.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.001.02.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.001.02.00000000000101'

		UNION ALL
		/*################################################################
				DESCONTOS PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.501.02.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.501.02.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PENSIONATO, VALOR AS DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.501.02.00000000000201'

	) SALDO
	GROUP BY ENTIDADE";3685;;;;09/06/2022;marli.oliveira;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;-4853;marli.oliveira;09/06/2022;marli.oliveira;09/06/2022;0
C;PVT.019.HT;RELATÓRIO PENSIONATO;"SELECT ENTIDADE, ISNULL(SUM(PENSIONATO), 0.0000) PENSIONATO, ISNULL(SUM(DESCONTOSPENSIONATO), 0.0000) DESCONTOSPENSIONATO
FROM (
		/*################################################################
				PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.001.03.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.001.03.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.001.03.00000000000101'

		UNION ALL
		/*################################################################
				DESCONTOS PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.501.03.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.501.03.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PENSIONATO, VALOR AS DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.501.03.00000000000201'

	) SALDO
	GROUP BY ENTIDADE";3685;;;;09/06/2022;marli.oliveira;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;1144;marli.oliveira;09/06/2022;marli.oliveira;09/06/2022;0
C;PVT.019.SP;RELATÓRIO PENSIONATO;"SELECT ENTIDADE, ISNULL(SUM(PENSIONATO), 0.0000) PENSIONATO, ISNULL(SUM(DESCONTOSPENSIONATO), 0.0000) DESCONTOSPENSIONATO
FROM (
		/*################################################################
				PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.001.01.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.001.01.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS PENSIONATO, 0.0000 DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.001.01.00000000000101'

		UNION ALL
		/*################################################################
				DESCONTOS PENSIONATO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.501.01.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS PENSIONATO, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) DESCONTOSPENSIONATO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.501.01.00000000000201'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 PENSIONATO, VALOR AS DESCONTOSPENSIONATO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.501.01.00000000000201'

	) SALDO
	GROUP BY ENTIDADE";3685;;;;09/06/2022;marli.oliveira;0;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;-26979;marli.oliveira;09/06/2022;marli.oliveira;09/06/2022;0
C;PVT.021;CONSULTA LANÇAMENTOS;"SELECT IDLANCAMENTO
FROM   CLANCAMENTO
WHERE  IDLANCAMENTO IN ( 814905, 748269, 748270, 748271,
                         748272, 829489, 748273, 748274,
                         748275, 748276, 748277, 748278,
                         818705, 748280, 748281, 748282,
                         829490, 748283, 748284, 748285,
                         748286, 748287, 748288, 748138,
                         748289, 748290, 748291, 748292,
                         748293, 748294, 748295, 748296,
                         748297, 748298, 748299, 748300,
                         748301, 748302, 748303, 748304,
                         829491, 748305, 829492, 748306,
                         748307, 748308, 748309, 748310,
                         748311, 748312, 748313, 748314,
                         748315, 748316, 748317, 748318,
                         814688, 814689, 814690, 814691,
                         814692, 814693, 748319, 829493,
                         818722, 740064, 740065, 748320,
                         748321, 748322, 748323, 740066,
                         748324, 748325, 748326, 740067,
                         748327, 748328, 748329, 748332,
                         748333, 748334, 748335, 748336,
                         748337, 829494, 829495, 829496,
                         829497, 829498, 829499, 740411,
                         740421, 829500, 829501, 829502,
                         829503, 748348, 748351, 748356,
                         748357, 740071, 748358, 748359,
                         748360, 748361, 748362, 740072,
                         740073, 748363, 748364, 748365,
                         748366, 748367, 748368, 748369,
                         748370, 748371, 829504, 829505,
                         829506, 829507, 829508, 829509,
                         829510, 829511, 829512, 671110,
                         829513, 829514, 829515, 829516,
                         829517, 829518, 829519, 829520,
                         829521, 829522, 829523, 829524,
                         829525, 829526, 829527, 829528,
                         829529, 829530, 829531, 829532,
                         829533, 829534, 829535, 829536,
                         829537, 829538, 829539, 829540,
                         829541, 829542, 829543, 829544,
                         829545, 829546, 829547, 829548,
                         829549, 829550, 829551, 829552,
                         829553, 829554, 829555, 829556,
                         829557, 829558, 829559, 829560,
                         829561, 829562, 829563, 829564,
                         829565, 829566, 829567, 829568,
                         661660, 829569, 661766, 829570,
                         661784, 829571, 661790, 829572,
                         829573, 699440, 699392, 699439,
                         699438, 699437, 699436, 699435,
                         699434, 829574, 829575, 829576,
                         829577, 829578, 829579 ) 
";3051;;;;29/07/2022;marli.oliveira;0;1;1;1;;;;0;0befd03e-05da-4380-add5-688d1250da74;0;;4223;marli.oliveira;29/07/2022;marli.oliveira;29/07/2022;0
D;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
D;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
D;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
E;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
E;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
E;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
F;2;LOTE CONTABIL;"
SELECT IDLAN,  CLANCAMENTO.CODLOTE FROM FLAN
JOIN COPERACAO (NOLOCK)
ON FLAN.CODCOLIGADA = COPERACAO.CODCOLIGADA
AND FLAN.IDOPERACAO = COPERACAO.IDOPERACAO
JOIN CCONT (NOLOCK)
ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO
JOIN CPARTIDA (NOLOCK)
ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA
JOIN CLANCAMENTO ON 
CLANCAMENTO.IDLANCAMENTO = CPARTIDA.IDLANCAMENTO AND 
CPARTIDA.CODCOLIGADA = CLANCAMENTO.CODCOLIGADA
WHERE FLAN.IDLAN =:IDLAN
AND FLAN.CODCOLIGADA =:CODCOLIGADA

GROUP BY FLAN.IDLAN, CLANCAMENTO.CODLOTE
";616;;;;17/02/2022;julio.lidani;0;1;1;1;;;;0;07ec72bb-789d-4aff-9397-adaaa506d896;1;;-13756;julio.lidani;17/02/2022;julio.lidani;17/02/2022;1
F;01.01.01;Cabeçalho;"SELECT
 GFILIAL.NOME FILIAL,
 GIMAGEM.IMAGEM,
 
 (SELECT
   STIPOCURSO.NOME
  
  FROM
   STIPOCURSO (NOLOCK)
   
  WHERE	STIPOCURSO.CODCOLIGADA = GFILIAL.CODCOLIGADA 
  	AND STIPOCURSO.NOME LIKE :Nível_Ensino + '%') NIVEL,
  
 (SELECT
   SCAMPUS.DESCRICAO
  
  FROM
   SCAMPUS (NOLOCK)
  
  WHERE	SCAMPUS.CODCAMPUS = 'UNASPEC') CAMPUS
 
FROM
 GFILIAL (NOLOCK)					   
 
 INNER JOIN GIMAGEM (NOLOCK)			ON GFILIAL.IDIMAGEM = GIMAGEM.ID
 										   
WHERE	GFILIAL.CODCOLIGADA = 1 
	AND GFILIAL.CODFILIAL = :Filial";539;;;;27/07/2021;mestre;0;1;1;1;;;;0;ec6c5b6d-93fc-4f27-b4b7-103b2c36bdb7;0;;14358;mestre;27/07/2021;mestre;27/07/2021;0
F;01.01.02;Detalhe;"SELECT
FLAN.PERLETIVO,
CAST(MONTH(FLAN.MESDECOMPETENCIA) AS VARCHAR(2)) + '/' + CAST(YEAR(FLAN.MESDECOMPETENCIA) AS VARCHAR(4)) MESDECOMPETENCIA,
FCFO.NOME,
SCURSO.CODCURSO + ' - ' + SCURSO.NOME CURSO,
STIPOMATRICULA.DESCRICAO TIPOMATRICULA,
SUM(FLANBAIXA.VALORBAIXA) RECEBIMENTO,
(SUM(FLANBAIXA.VALORBAIXA) * :REPASSE)/100 REPASSE
 
FROM
FLAN (NOLOCK)
INNER JOIN FCFO (NOLOCK) 
	ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO 
	AND FCFO.CODCFO =  FLAN.CODCFO
INNER JOIN FLANBAIXA (NOLOCK) 
	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND FLANBAIXA.IDLAN = FLAN.IDLAN 
	AND FLANBAIXA.STATUS = 0
INNER JOIN SLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SPARCELA (NOLOCK) 
	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA 
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA 
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO 
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
INNER JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
	AND SHABILITACAOFILIAL.CODFILIAL = SCONTRATO.CODFILIAL
INNER JOIN SCURSO (NOLOCK)
	ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
INNER JOIN SHABILITACAOALUNO (NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 
	AND SHABILITACAOALUNO.RA = SCONTRATO.RA
INNER JOIN SMATRICPL (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET 
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
	AND SMATRICPL.RA = SCONTRATO.RA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
	AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT
INNER JOIN SCAMPUS (NOLOCK)
	ON SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
 
WHERE FLAN.CODCOLIGADA = 1
AND FLAN.CODFILIAL = :Filial
AND FLAN.PAGREC = 1
AND FLANBAIXA.DATABAIXA >= :Data_Início
AND FLANBAIXA.DATABAIXA <= :Data_Fim
AND SPLETIVO.DTINICIO >= :Início_Período_Letivo
AND SCONTRATO.CODTIPOCURSO=:TipoCurso
AND SCAMPUS.CODCAMPUS = :CODCAMPUS1
AND FLAN.DATAPAG <= DATEADD(D, 3, :Data_Fim)
 
GROUP BY FLAN.PERLETIVO, FCFO.NOME, SCURSO.CODCURSO, SCURSO.NOME, STIPOMATRICULA.DESCRICAO, FLAN.MESDECOMPETENCIA";2684;;;;28/09/2022;robson.canto;0;1;1;1;;;;0;2badb731-5f8d-4c23-806c-f79e82ccef36;0;;26041;mestre;27/07/2021;robson.canto;28/09/2022;0
F;01.01.03;Detalhe;"SELECT DISTINCT(SCAMPUS.CODCAMPUS) CODCAMPUS,
SCAMPUS.DESCRICAO
 
FROM
FLAN (NOLOCK)
INNER JOIN FCFO (NOLOCK) 
	ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO 
	AND FCFO.CODCFO =  FLAN.CODCFO
INNER JOIN FLANBAIXA (NOLOCK) 
	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND FLANBAIXA.IDLAN = FLAN.IDLAN 
	AND FLANBAIXA.STATUS = 0
INNER JOIN SLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SPARCELA (NOLOCK) 
	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA 
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA 
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO 
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
INNER JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
	AND SHABILITACAOFILIAL.CODFILIAL = SCONTRATO.CODFILIAL
INNER JOIN SCURSO (NOLOCK)
	ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
INNER JOIN SHABILITACAOALUNO (NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 
	AND SHABILITACAOALUNO.RA = SCONTRATO.RA
INNER JOIN SMATRICPL (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET 
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
	AND SMATRICPL.RA = SCONTRATO.RA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
	AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT
INNER JOIN SCAMPUS (NOLOCK)
	ON SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
 
WHERE FLAN.CODCOLIGADA = 1
AND FLAN.CODFILIAL = :Filial
AND FLAN.PAGREC = 1
AND FLANBAIXA.DATABAIXA >= :Data_Início
AND FLANBAIXA.DATABAIXA <= :Data_Fim
AND SPLETIVO.DTINICIO >= :Início_Período_Letivo
AND ((:POLO = '%' OR :POLO = 'Todos' AND SHABILITACAOALUNO.CODCAMPUS LIKE '%') OR (SHABILITACAOALUNO.CODCAMPUS IN (SELECT NAME FROM SPLITSTRINGASTABLE(:POLO, ';'))))
AND SCONTRATO.CODTIPOCURSO=:TipoCurso
AND FLAN.DATAPAG <= DATEADD(D, 3, :Data_Fim)";2422;;;;08/09/2022;robson.canto;0;1;1;1;;;;0;2badb731-5f8d-4c23-806c-f79e82ccef36;0;;-21055;mestre;01/09/2021;robson.canto;08/09/2022;0
F;01.02.01;Detalhe;"SELECT
 SCAMPUS.DESCRICAO POLO,
 CAST(MONTH(FLAN.MESDECOMPETENCIA) AS VARCHAR(2)) + '/' + CAST(YEAR(FLAN.MESDECOMPETENCIA) AS VARCHAR(4)) MESDECOMPETENCIA,
 SUM(FLANBAIXA.VALORBAIXA) RECEBIMENTO,
 (SUM(FLANBAIXA.VALORBAIXA) * :REPASSE)/100 REPASSE
 
FROM
 FLAN (NOLOCK)
 
 INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
 									   	   FCFO.CODCFO =  FLAN.CODCFO
 
 INNER JOIN FLANBAIXA (NOLOCK)			ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   FLANBAIXA.IDLAN = FLAN.IDLAN AND
 									   	   FLANBAIXA.STATUS = 0
 
 INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   SLAN.IDLAN = FLAN.IDLAN
 									   
 INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 									   	   SPARCELA.IDPARCELA = SLAN.IDPARCELA
 									   
 INNER JOIN SCONTRATO (NOLOCK)			ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   	   SCONTRATO.RA = SPARCELA.RA AND 
 									   	   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 									   	   SCONTRATO.IDPERLET = SPARCELA.IDPERLET 									   

 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND
 										   SHABILITACAOFILIAL.CODFILIAL = SCONTRATO.CODFILIAL 
 
 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 
 INNER JOIN SHABILITACAOALUNO (NOLOCK)	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   SHABILITACAOALUNO.RA = SCONTRATO.RA

 INNER JOIN SMATRICPL 					ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 										   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 										   SMATRICPL.RA = SCONTRATO.RA

 INNER JOIN SCAMPUS (NOLOCK)			ON SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.CODFILIAL = :Filial
	AND FLAN.PAGREC = 1
	AND FLANBAIXA.DATABAIXA >= :Data_Início
	AND FLANBAIXA.DATABAIXA <= :Data_Fim
	AND SPLETIVO.DTINICIO >= :Início_Período_Letivo
	AND ((:POLO = '%' OR :POLO = 'Todos' AND SHABILITACAOALUNO.CODCAMPUS LIKE '%') OR (SHABILITACAOALUNO.CODCAMPUS IN (SELECT NAME FROM SPLITSTRINGASTABLE(:POLO, ';'))))
	and SCONTRATO.codtipocurso=:tipocurso
 	AND FLAN.DATAPAG <= DATEADD(D, 3, :Data_Fim)
 
GROUP BY SCAMPUS.DESCRICAO, FLAN.MESDECOMPETENCIA";2829;;;;28/09/2022;robson.canto;0;1;1;1;;;;0;84a0e845-11a4-452a-9cd9-505c7a050008;0;;-3942;mestre;27/07/2021;robson.canto;28/09/2022;0
F;ACORDO;ACORDO;"SELECT VALORACRESCIMOACORDO, CODFILIAL,  * FROM FLANBAIXA 
WHERE CODCOLIGADA = 1 AND
VALORACRESCIMOACORDO <> '0.0000'";119;;;;22/09/2022;marli.oliveira;0;1;1;1;;;;0;fcd24916-5f8d-4548-848f-cd7aa30da397;0;;29637;marli.oliveira;22/09/2022;marli.oliveira;22/09/2022;0
F;ACORDO.1;ACORDO;"SELECT * FROM FLAN 
INNER JOIN FACORDOREL ON FLAN.CODCOLIGADA = FACORDOREL.CODCOLIGADA AND FLAN.IDLAN = FACORDOREL.IDLAN 
WHERE PERLETIVO = 'SIGA'
";150;;;;22/09/2022;marli.oliveira;0;1;1;1;;;;0;fcd24916-5f8d-4548-848f-cd7aa30da397;0;;-21722;marli.oliveira;22/09/2022;marli.oliveira;22/09/2022;0
F;Cubo.028;Relatório Sintético de Acordos Realizados no Período;"SELECT
 X.COLIGADA,
 CAST(X.NÚMERO AS INT) NÚMERO, 
 X.CODCFO,
 X.IDLAN,
 X.RESPONSÁVEL,
 X.CODTDO,
 X.TEMPLATE,
 X.DATA,
 X.STATUS,
 
 CASE WHEN X.CLASSIFICACAO = 2 THEN SUM(X.ORIGINAL/* + X.ACRESCIMO - DESCONTO_ACORDO*/)
 	  ELSE 0 END ACORDO,
/* 
 CASE WHEN X.CLASSIFICACAO = 1 THEN SUM(X.BOLSA_INCONDICIONAL)
 	  ELSE 0 END BOLSA_INCONDICIONAL,
*/ 	  
 CASE WHEN X.CLASSIFICACAO = 2 THEN SUM(X.RECEBIDO)
 	  ELSE 0 END RECEBIDO,
 	  
 CASE WHEN X.CLASSIFICACAO = 2 THEN SUM(X.ACRESCIMO)
 	  ELSE 0 END ACRÉSCIMO, 

 CASE WHEN X.CLASSIFICACAO = 2 THEN SUM(X.DESCONTO_ACORDO /*- X.['DESC. ADIMPLÊNCIA'] - X.DESCONTO_BAIXA*/)
 	  ELSE 0 END ABATIMENTO,

 CASE WHEN X.CLASSIFICACAO = 2 THEN SUM(X.ORIGINAL + ACRESCIMO - DESCONTO_ACORDO - X.RECEBIDO)
 	  ELSE 0 END 'A RECEBER'
 
FROM
(  	  

SELECT
 FACORDO.CODCOLIGADA COLIGADA,
 FACORDO.IDACORDO NÚMERO,
 FLAN.IDLAN,
 FCFO.CODCFO,
 FCFO.NOME RESPONSÁVEL,
 FLAN.CODTDO,
 FTEMPLATEACORDO.DESCRICAO TEMPLATE,
 CONVERT(VARCHAR(10), FACORDO.DATA,103) DATA,
 
 CASE WHEN FACORDO.STATUSEFETIVADO = '0' THEN 'EM ABERTO'
 	  WHEN FACORDO.STATUSEFETIVADO = '3' THEN 'CANCELADO'
 	  WHEN FACORDO.STATUSEFETIVADO = '4' THEN 'EFETIVADO'
 	  ELSE CAST(FACORDO.STATUSEFETIVADO AS VARCHAR(2)) END STATUS,

 FACORDOREL.CLASSIFICACAO, 	  
 FLAN.VALORORIGINAL ORIGINAL,
 FLAN.VALORACRESCIMOACORDO + ISNULL(SUM(FLANBAIXA.VALORJUROS),0) + ISNULL(SUM(FLANBAIXA.VALORMULTA),0) ACRESCIMO,
 FLAN.VALORDESCONTOACORDO + ISNULL(SUM(FLANBAIXA.VALORDESCONTO),0) + ISNULL(SUM(FLANBAIXA.VALOROP3),0) + ISNULL(SUM(FLANBAIXA.VALOROP6),0) DESCONTO_ACORDO,
 /*SUM(FLANBAIXA.VALORDESCONTO) DESCONTO_BAIXA,*/
 ISNULL(SUM(FLANBAIXA.VALORBAIXA),0) RECEBIDO/*,
 SUM(FLANBAIXA.VALOROP3) ['DESC. ADIMPLÊNCIA'],
 
 (SELECT
   SUM(FLANINTEGRACAO.VALOR)
  																	    
  FROM
   FLANINTEGRACAO (NOLOCK)
  
   INNER JOIN FLANINTEGRACAODEF (NOLOCK)	ON FLANINTEGRACAODEF.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA AND 
   											   FLANINTEGRACAODEF.IDCAMPO = FLANINTEGRACAO.IDCAMPO AND
   											    FLANINTEGRACAODEF.ATEVENCIMENTO = 0
  
  WHERE FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA 
  	AND FLANINTEGRACAO.IDLAN = FLAN.IDLAN) BOLSA_INCONDICIONAL
 */
FROM
 FACORDO (NOLOCK)
 
 INNER JOIN FTEMPLATEACORDO (NOLOCK)	ON FTEMPLATEACORDO.CODCOLIGADA = FACORDO.CODCOLIGADA AND 
 										   FTEMPLATEACORDO.IDTEMPLATEACORDO = FACORDO.IDTEMPLATEACORDO
 
 INNER JOIN FCFO (NOLOCK)		ON FCFO.CODCOLIGADA = FACORDO.CODCOLIGADA AND
 								   FCFO.CODCFO = FACORDO.CODCFO
 
 LEFT JOIN FACORDOREL (NOLOCK)	ON FACORDOREL.CODCOLIGADA = FACORDO.CODCOLIGADA AND
 								   FACORDOREL.IDACORDO = FACORDO.IDACORDO 
					
 LEFT JOIN FLAN (NOLOCK)		ON FLAN.CODCOLIGADA = FACORDOREL.CODCOLIGADA AND
 								   FLAN.IDLAN = FACORDOREL.IDLAN	 
 								   
 LEFT JOIN FLANBAIXA (NOLOCK)	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 								   FLANBAIXA.IDLAN = FLAN.IDLAN AND
 								   FLANBAIXA.STATUS <> 1
 								   
WHERE	FACORDO.CODCOLIGADA = 1
	AND FACORDO.DATA >= :Data_Inicio
	AND FACORDO.DATA <= :Data_Fim

GROUP BY FACORDO.CODCOLIGADA, FACORDO.IDACORDO, FLAN.IDLAN, FCFO.CODCFO, FCFO.NOME, FACORDO.DATA, FACORDO.STATUSEFETIVADO,
 		 FACORDOREL.CLASSIFICACAO, FLAN.VALORORIGINAL, FLAN.VALORACRESCIMOACORDO, FLAN.VALORDESCONTOACORDO,
 		 FACORDO.VALORDESCONTO, FLAN.CODTDO, FTEMPLATEACORDO.DESCRICAO
 		 
) X
GROUP BY X.COLIGADA, X.NÚMERO, X.IDLAN, X.CODCFO, X.RESPONSAVEL, X.DATA, X.DESCONTO_ACORDO, X.ACRESCIMO, 
		 X.STATUS, X.CLASSIFICACAO, X.CODTDO, X.TEMPLATE
  ";3588;;;;30/06/2022;robson.canto;0;1;1;1;;;;0;cfdcdcb6-7a3e-4180-bce0-8725ac38c508;0;;16079;robson.canto;28/06/2022;robson.canto;30/06/2022;0
F;EDUREL0046A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";198;;;;17/11/2021;rafael.prado;0;1;1;1;;;;;3e8a3030-8809-433f-b963-5541c01fb276;;;-7874;rafael.prado;29/09/2021;rafael.prado;17/11/2021;
F;EDUREL0046B;Relação de Alunos Bolsistas;"SELECT DISTINCT SCURSO.CODCURSO, SCURSO.NOME, SCURSO.CODTIPOCURSO, STIPOCURSO.NOME TIPOCURSO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SBOLSAALUNO (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SBOLSAALUNO.RA
	AND SCONTRATO.CODCONTRATO = SBOLSAALUNO.CODCONTRATO
	AND SCONTRATO.IDPERLET = SBOLSAALUNO.IDPERLET
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN    
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
 
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SPLETIVO.CODPERLET LIKE :CODPERLET_S
  AND SCURSO.NOME LIKE :CURSO_S
  AND ((:CODBOLSA_S = '%' AND  SBOLSA.CODBOLSA LIKE :CODBOLSA_S) OR (:CODBOLSA_S <> '%' AND SBOLSA.CODBOLSA IN (SELECT [NAME] FROM DBO.SPLITSTRINGASTABLE(:CODBOLSA_S,';'))))
  AND SCONTRATO.RA LIKE :RA_S
  /*AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D*/
  AND SBOLSAALUNO.DTINICIO >= :DTEMISSAOINICIAL_D
  AND SBOLSAALUNO.DTFIM <= :DTEMISSAOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)";3067;;;;17/11/2021;rafael.prado;0;1;1;1;;;;;f6c326ea-a18b-4175-87f4-74a6ee77d088;;;11444;rafael.prado;29/09/2021;rafael.prado;17/11/2021;
F;EDUREL0046C;Relação de Alunos Bolsistas;"SELECT DISTINCT SBOLSA.CODBOLSA,
SBOLSA.NOME AS NOMEBOLSA,
SMATRICPL.RA,
PPESSOA.NOME AS NOMEALUNO,
SBOLSALAN.IDLAN,
FLAN.HISTORICO,
FLAN.DATAEMISSAO,
FLAN.DATAVENCIMENTO,
SBOLSALAN.VALOR,
FCFO.NOMEFANTASIA

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SBOLSAALUNO (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SBOLSAALUNO.RA
	AND SCONTRATO.CODCONTRATO = SBOLSAALUNO.CODCONTRATO
	AND SCONTRATO.IDPERLET = SBOLSAALUNO.IDPERLET
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN FCFO 
	ON FLAN.CODCOLCFO = FCFO.CODCOLIGADA
	AND FLAN.CODCFO = FCFO.CODCFO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SPLETIVO.CODPERLET LIKE :CODPERLET_S
  AND ((:CODBOLSA_S = '%' AND  SBOLSA.CODBOLSA LIKE :CODBOLSA_S) OR (:CODBOLSA_S <> '%' AND SBOLSA.CODBOLSA IN (SELECT [NAME] FROM DBO.SPLITSTRINGASTABLE(:CODBOLSA_S,';'))))
  AND SCONTRATO.RA LIKE :RA_S
  AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO1_S
  /*AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D*/
  AND SBOLSAALUNO.DTINICIO >= :DTEMISSAOINICIAL_D
  AND SBOLSAALUNO.DTFIM <= :DTEMISSAOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)
  
ORDER BY SBOLSA.NOME, FLAN.DATAEMISSAO, FLAN.DATAVENCIMENTO";3356;;;;17/11/2021;rafael.prado;0;1;1;1;;;;;63e3eac6-2133-4df9-b5a3-f098158293f8;;;-13336;rafael.prado;29/09/2021;rafael.prado;17/11/2021;
F;EDUREL0046D;Quantidade de Alunos;"select count(x.RA) as QTD_ALUNOS
  from (
SELECT DISTINCT SALUNO.RA
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SBOLSAALUNO (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SBOLSAALUNO.RA
	AND SCONTRATO.CODCONTRATO = SBOLSAALUNO.CODCONTRATO
	AND SCONTRATO.IDPERLET = SBOLSAALUNO.IDPERLET
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SPLETIVO.CODPERLET LIKE :CODPERLET_S
  AND ((:CODBOLSA_S = '%' AND  SBOLSA.CODBOLSA LIKE :CODBOLSA_S) OR (:CODBOLSA_S <> '%' AND SBOLSA.CODBOLSA IN (SELECT [NAME] FROM DBO.SPLITSTRINGASTABLE(:CODBOLSA_S,';'))))
  AND SCONTRATO.RA LIKE :RA_S  
  AND (SBOLSAALUNO.DTINICIO >= :DTEMISSAOINICIAL_D
  AND SBOLSAALUNO.DTFIM <= :DTEMISSAOFINAL_D)
) x   ";2231;;;;17/11/2021;rafael.prado;0;1;1;1;;;;0;1316a45b-f6eb-4869-b0de-4b80f11b2c75;0;;-219;raphael.muzy;27/10/2021;rafael.prado;17/11/2021;0
F;EDUREL0047A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";;;;;;;0;1;1;1;;;;;e26f5840-b088-407c-aa32-1b9b64d6aefc;;;202;rafael.prado;29/09/2021;rafael.prado;29/09/2021;
F;EDUREL0047B;Relação de Alunos Bolsistas;"SELECT DISTINCT SCURSO.CODCURSO, SCURSO.NOME, SCURSO.CODTIPOCURSO, STIPOCURSO.NOME TIPOCURSO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN    
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
 
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.NOME LIKE :CURSO_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)";;;;;;;0;1;1;1;;;;;2f3c662f-be64-4186-bce0-3674f30247fc;;;22272;rafael.prado;29/09/2021;rafael.prado;29/09/2021;
F;EDUREL0047C;Relação de Alunos Bolsistas;"SELECT *,

CASE
WHEN (MENSALIDADE > 0 AND ATIVOS > 0)  THEN (MENSALIDADE / ATIVOS)
ELSE 0
END TICKETMEDIO,

CASE
WHEN VALORMENSALIDADEGRADE IS NULL THEN VALORMENSALIDADE
ELSE VALORMENSALIDADEGRADE
END VALORMENSALIDADENOVO

FROM 
(

SELECT W.CODTURMA, W.NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
((SUM(MENSALIDADE) + SUM(SERVICOS)) - (SUM(BOLSA) + SUM(DESCONTO) + SUM(DISSIDIO))) TOTAL,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(BOLSA) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END BOLSAPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(DESCONTO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END DESCONTOPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(DISSIDIO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END DISSIDIOPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN ((SUM(BOLSA) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))) + ((SUM(DESCONTO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))) + ((SUM(DISSIDIO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS)))
ELSE 0
END TOTALPERC,

(
SELECT ALUNOS
FROM
(
SELECT COUNT(RA) ALUNOS
FROM
(
SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME, SMATRICPL.RA
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SMATRICPL.CODFILIAL = :CODFILIAL_N
  AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA = W.CODTURMA
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)
)A
)B

) ATIVOS,

(
SELECT SUM(((Z.NUMCREDITOSCOB * Z.VALCRED) / 6)) VALORMENSALIDADE

FROM
(

SELECT SMATRICULA.RA, SUM(SMATRICULA.NUMCREDITOSCOB) NUMCREDITOSCOB,
(
SELECT VALCRED 
FROM SFAIXACRED 
WHERE SFAIXACRED.CODCOLIGADA = SMATRICULA.CODCOLIGADA
AND SFAIXACRED.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
AND SFAIXACRED.IDPERLET = SMATRICULA.IDPERLET
) VALCRED

FROM SMATRICULA
INNER JOIN 
(

SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME, SMATRICPL.RA, SMATRICPL.IDHABILITACAOFILIAL, SMATRICPL.IDPERLET
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SBOLSALAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SBOLSALAN.IDPARCELA
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA
INNER JOIN FLAN (NOLOCK)
	ON SBOLSALAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SBOLSALAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SMATRICPL.CODFILIAL = :CODFILIAL_N
  AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA = W.CODTURMA
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)

)X ON X.RA = SMATRICULA.RA AND X.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND X.IDPERLET = SMATRICULA.IDPERLET

GROUP BY SMATRICULA.CODCOLIGADA, SMATRICULA.RA, SMATRICULA.IDHABILITACAOFILIAL, SMATRICULA.IDPERLET

)Z
) VALORMENSALIDADE,
W.VALORMENSALIDADEGRADE

FROM
(

SELECT CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODTURMA, X.NOME,
0 MENSALIDADE,
0 SERVICOS,

CASE 
WHEN X.CLASSIFICACAO = 'O' THEN X.VALOR
ELSE 0
END OUTRAS,

CASE 
WHEN X.CLASSIFICACAO = 'F' THEN X.VALOR
ELSE 0
END FIES,

CASE 
WHEN X.CLASSIFICACAO = 'B' THEN X.VALOR
ELSE 0
END BOLSA,

CASE 
WHEN X.CLASSIFICACAO = 'E' THEN X.VALOR
ELSE 0
END DESCONTO,

CASE 
WHEN X.CLASSIFICACAO = 'D' THEN X.VALOR
ELSE 0
END DISSIDIO,

X.VALORMENSALIDADEGRADE

FROM

(
SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME,
SBOLSALAN.IDPARCELA,
SBOLSALAN.IDLAN,
SBOLSALAN.IDPERLET,
SBOLSA.CODBOLSA,
SBOLSALAN.VALOR,
CASE 
WHEN (SBOLSA.FIES = 0 AND SBOLSA.TIPOSAC = 'R') THEN 'O'
WHEN (SBOLSA.FIES > 0 AND SBOLSA.TIPOSAC = 'R') THEN 'F'
WHEN SBOLSA.CODBOLSA IN (1,2,3,4) THEN 'B'
WHEN SBOLSA.CODBOLSA IN (10,22,29,34,55,141,142,143,144,145,146,147,148,149,150) THEN 'D'
ELSE 'E'
END CLASSIFICACAO,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)

) X

) Y
GROUP BY CODTURMA, NOME, VALORMENSALIDADEGRADE

/* ******************************************************************************* */

UNION

SELECT CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODTURMA, X.NOME,
0 MENSALIDADE,
X.VALOR SERVICOS,
0 OUTRAS,
0 FIES,
0 BOLSA,
0 DESCONTO,
0 DISSIDIO,
X.VALORMENSALIDADEGRADE

FROM

(

SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME,
SPARCELA.IDPARCELA,
SLAN.IDLAN,
SPARCELA.IDPERLET,
SPARCELA.VALOR,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)
  AND SPARCELA.CODSERVICO IN (107,108,109,3,31,41,55)

) X

) Y
GROUP BY CODTURMA, NOME, VALORMENSALIDADEGRADE

/* ******************************************************************************* */

UNION

SELECT CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODTURMA, X.NOME,
CASE 
WHEN X.CLASSIFICACAO = 'M' THEN X.VALOR
ELSE 0
END MENSALIDADE,
0 SERVICOS,

0 OUTRAS,
0 FIES,
0 BOLSA,
0 DESCONTO,
0 DISSIDIO,
X.VALORMENSALIDADEGRADE

FROM

(
SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME,
FLAN.IDLAN,
CASE
WHEN ISNULL(FLAN.VALORBAIXADO,0) = 0 THEN FLAN.VALORORIGINAL
ELSE FLAN.VALORBAIXADO
END VALOR,
'M' CLASSIFICACAO,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)

) X

) Y
GROUP BY CODTURMA, NOME, VALORMENSALIDADEGRADE

) W
GROUP BY W.CODTURMA, W.NOME, W.VALORMENSALIDADEGRADE

)Z";;;;;;;0;1;1;1;;;;;515b0b4a-14fe-47c8-b21c-e7140403481e;;;30222;rafael.prado;29/09/2021;rafael.prado;29/09/2021;
F;EDUREL0048A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";;;;;;;0;1;1;1;;;;;b6d3784e-8d21-4615-b440-e466d6694642;;;30639;rafael.prado;30/09/2021;rafael.prado;30/09/2021;
F;EDUREL0048B;Relação de Alunos Bolsistas;"SELECT DISTINCT SCURSO.CODCURSO, SCURSO.NOME, SCURSO.CODTIPOCURSO, STIPOCURSO.NOME TIPOCURSO, '**** TOTAL GERAL - ' + SCURSO.CODCURSO + ' - ' + SCURSO.NOME + '****' CURSO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN    
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
 
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.NOME LIKE :CURSO_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  /*AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D*/
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND FLAN.STATUSLAN NOT IN (2)
  AND SCURSO.NOME NOT LIKE '%PENSIONATO%'";2911;;;;09/12/2021;robson.canto;0;1;1;1;;;;;8d228238-7ba7-4368-a8ac-a4191251b3f3;;;2392;rafael.prado;30/09/2021;robson.canto;09/12/2021;
F;EDUREL0048C;Relação de Alunos Bolsistas;"SELECT *,

CASE
WHEN (MENSALIDADE > 0 AND ATIVOS > 0)  THEN (MENSALIDADE / ATIVOS)
ELSE 0
END TICKETMEDIO,

CASE
WHEN VALORMENSALIDADEGRADE IS NULL THEN VALORMENSALIDADE
ELSE VALORMENSALIDADEGRADE
END VALORMENSALIDADENOVO,

/*(MENSALIDADE * 0.05) INADIMPLENCIA,*/

CASE WHEN (MENSALIDADE > 0 AND ATIVOS > 0) AND CODFILIAL = 4 THEN (MENSALIDADE / ATIVOS) / 3
	 WHEN (MENSALIDADE > 0 AND ATIVOS > 0) AND CODFILIAL <> 4 THEN (MENSALIDADE / ATIVOS) / 6
	 ELSE 0 END VALORMENSALIDADE1,
	 
CASE WHEN (TOTAL > 0 AND ATIVOS > 0) AND CODFILIAL = 4 THEN (TOTAL / ATIVOS) / 3
	 WHEN (TOTAL > 0 AND ATIVOS > 0) AND CODFILIAL <> 4 THEN (TOTAL / ATIVOS) / 6
	 ELSE 0 END MEDIA
	 
	  
	  
	   
FROM 
(

SELECT W.CODFILIAL, W.CODTURMA, W.NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
((SUM(MENSALIDADE) + SUM(SERVICOS)) - (SUM(BOLSA) + SUM(DESCONTO) + SUM(DISSIDIO) )) TOTAL,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(BOLSA) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END BOLSAPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(DESCONTO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END DESCONTOPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(DISSIDIO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END DISSIDIOPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN ((SUM(BOLSA) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))) + ((SUM(DESCONTO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))) + ((SUM(DISSIDIO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS)))
ELSE 0
END TOTALPERC,

(
SELECT ALUNOS
FROM
(
SELECT COUNT(RA) ALUNOS
FROM
(
SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME, SMATRICPL.RA
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SMATRICPL.CODFILIAL = :CODFILIAL_N
  AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA = W.CODTURMA
  /*AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D*/
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND FLAN.STATUSLAN NOT IN (2)
)A
)B

) ATIVOS,

(
SELECT SUM(((Z.NUMCREDITOSCOB * Z.VALCRED) / 6)) VALORMENSALIDADE

FROM
(

SELECT SMATRICULA.RA, SUM(SMATRICULA.NUMCREDITOSCOB) NUMCREDITOSCOB,
(
SELECT VALCRED 
FROM SFAIXACRED 
WHERE SFAIXACRED.CODCOLIGADA = SMATRICULA.CODCOLIGADA
AND SFAIXACRED.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
AND SFAIXACRED.IDPERLET = SMATRICULA.IDPERLET
) VALCRED

FROM SMATRICULA
INNER JOIN 
(

SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME, SMATRICPL.RA, SMATRICPL.IDHABILITACAOFILIAL, SMATRICPL.IDPERLET
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SBOLSALAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SBOLSALAN.IDPARCELA
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA
LEFT JOIN FLAN (NOLOCK)
	ON SBOLSALAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SBOLSALAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SMATRICPL.CODFILIAL = :CODFILIAL_N
  AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA = W.CODTURMA
  /*AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D*/
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND FLAN.STATUSLAN NOT IN (2)

)X ON X.RA = SMATRICULA.RA AND X.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND X.IDPERLET = SMATRICULA.IDPERLET

GROUP BY SMATRICULA.CODCOLIGADA, SMATRICULA.RA, SMATRICULA.IDHABILITACAOFILIAL, SMATRICULA.IDPERLET

)Z
) VALORMENSALIDADE,
W.VALORMENSALIDADEGRADE

FROM
(

SELECT CODFILIAL, CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODFILIAL, X.CODTURMA, X.NOME,
0 MENSALIDADE,
0 SERVICOS,

CASE 
WHEN X.CLASSIFICACAO = 'O' THEN X.VALOR
ELSE 0
END OUTRAS,

CASE 
WHEN X.CLASSIFICACAO = 'F' THEN X.VALOR
ELSE 0
END FIES,

CASE 
WHEN X.CLASSIFICACAO = 'B' THEN X.VALOR
ELSE 0
END BOLSA,

CASE 
WHEN X.CLASSIFICACAO = 'E' THEN X.VALOR
ELSE 0
END DESCONTO,

CASE 
WHEN X.CLASSIFICACAO = 'D' THEN X.VALOR
ELSE 0
END DISSIDIO,

X.VALORMENSALIDADEGRADE

FROM

(
SELECT DISTINCT SMATRICPL.CODFILIAL, STURMA.CODTURMA, STURMA.NOME,
SBOLSALAN.IDPARCELA,
SBOLSALAN.IDLAN,
SBOLSALAN.IDPERLET,
SBOLSA.CODBOLSA,
SBOLSALAN.VALOR,
CASE 
WHEN (SBOLSA.FIES = 0 AND SBOLSA.TIPOSAC = 'R') THEN 'O'
WHEN (SBOLSA.FIES > 0 AND SBOLSA.TIPOSAC = 'R') THEN 'F'
WHEN SBOLSA.CODBOLSA IN (1,2,3,4) THEN 'B'
WHEN SBOLSA.CODBOLSA IN (10,22,29,34,55,141,142,143,144,145,146,147,148,149,150) THEN 'D'
ELSE 'E'
END CLASSIFICACAO,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  /*AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D*/
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND FLAN.STATUSLAN NOT IN (2)

) X

) Y
GROUP BY CODFILIAL, CODTURMA, NOME, VALORMENSALIDADEGRADE

/* ******************************************************************************* */

UNION

SELECT CODFILIAL, CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODFILIAL, X.CODTURMA, X.NOME,
0 MENSALIDADE,
X.VALOR SERVICOS,
0 OUTRAS,
0 FIES,
0 BOLSA,
0 DESCONTO,
0 DISSIDIO,
X.VALORMENSALIDADEGRADE

FROM

(

SELECT DISTINCT SMATRICPL.CODFILIAL, STURMA.CODTURMA, STURMA.NOME,
SPARCELA.IDPARCELA,
SLAN.IDLAN,
SPARCELA.IDPERLET,
SPARCELA.VALOR,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  /*AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D*/
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND FLAN.STATUSLAN NOT IN (2)
  AND SPARCELA.CODSERVICO IN (107,108,109,3,31,41,55)

) X

) Y
GROUP BY CODFILIAL, CODTURMA, NOME, VALORMENSALIDADEGRADE

/* ******************************************************************************* */

UNION

SELECT CODFILIAL, CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODFILIAL, X.CODTURMA, X.NOME,
CASE 
WHEN X.CLASSIFICACAO = 'M' THEN X.VALOR
ELSE 0
END MENSALIDADE,
0 SERVICOS,

0 OUTRAS,
0 FIES,
0 BOLSA,
0 DESCONTO,
0 DISSIDIO,
X.VALORMENSALIDADEGRADE

FROM

(
SELECT DISTINCT SMATRICPL.CODFILIAL, STURMA.CODTURMA, STURMA.NOME,
FLAN.IDLAN,
CASE
WHEN ISNULL(FLAN.VALORBAIXADO,0) = 0 THEN FLAN.VALORORIGINAL
ELSE FLAN.VALORBAIXADO
END VALOR,
'M' CLASSIFICACAO,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  /*AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D*/
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND FLAN.STATUSLAN NOT IN (2)

) X

) Y
GROUP BY CODFILIAL, CODTURMA, NOME, VALORMENSALIDADEGRADE

) W
GROUP BY W.CODFILIAL, W.CODTURMA, W.NOME, W.VALORMENSALIDADEGRADE

)Z";19450;;;;10/11/2021;robson.canto;0;1;1;1;;;;;614576b7-d27f-4a49-9b66-40f056a6c2fa;;;-2226;rafael.prado;30/09/2021;robson.canto;10/11/2021;
F;EDUREL0049A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";;;;;;;0;1;1;1;;;;;c54467f9-02c4-4808-97a8-bf005011fec9;;;-10035;rafael.prado;04/10/2021;rafael.prado;04/10/2021;
F;EDUREL0049B;Relação de Alunos Bolsistas;"SELECT DISTINCT SCURSO.CODCURSO, SCURSO.NOME, SCURSO.CODTIPOCURSO, STIPOCURSO.NOME TIPOCURSO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN    
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
 
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D
  AND FLAN.DATAVENCIMENTO <= :DTVENCIMENTOATE_D
  AND FLAN.STATUSLAN NOT IN (2)";2710;;;;07/10/2021;rafael.prado;0;1;1;1;;;;;b10952d1-b4fd-42dc-920e-f5ae2426b864;;;-26933;rafael.prado;04/10/2021;rafael.prado;07/10/2021;
F;EDUREL0049C;Relação de Alunos Bolsistas;"SELECT 
X.ANO,
X.REFERENCIA,
SUM(X.RECEITA_LIQUIDA) RECEITA_LIQUIDA,
SUM(X.TOTAL_RECEBIDO) TOTAL_RECEBIDO,
SUM(X.ACAO) ACAO,
SUM(X.ACORDO) ACORDO,
SUM(X.A_RECEBER) A_RECEBER,
((SUM(X.ACAO) + SUM(X.ACORDO) + SUM(X.A_RECEBER))*100)/SUM(X.RECEITA_LIQUIDA) PER_INADIMPLENCIA

FROM
(

SELECT DISTINCT FLAN.IDLAN,
YEAR(FLAN.DATAEMISSAO) ANO,
RIGHT(CONVERT(CHAR(10),FLAN.DATAEMISSAO,103),7) REFERENCIA,
ISNULL(FLAN.VALORORIGINAL,0) RECEITA_LIQUIDA,

CASE
WHEN FLAN.CODTDO = 'ACORD_JUD' AND FLAN.STATUSLAN = 0 THEN FLAN.VALORORIGINAL
WHEN FLAN.CODTDO = 'ACORD_JUD' AND FLAN.STATUSLAN = 4 THEN (FLAN.VALORORIGINAL - FLAN.VALORBAIXADO)
ELSE 0
END ACAO,

CASE
WHEN FLAN.CODTDO = 'ACORD_EXT' AND FLAN.STATUSLAN = 0 THEN FLAN.VALORORIGINAL
WHEN FLAN.CODTDO = 'ACORD_EXT' AND FLAN.STATUSLAN = 4 THEN (FLAN.VALORORIGINAL - FLAN.VALORBAIXADO)
ELSE 0
END ACORDO,

CASE
WHEN FLAN.CODTDO IN ('ACORD_JUD','ACORD_EXT') AND FLAN.STATUSLAN = 0 THEN 0
WHEN FLAN.CODTDO IN ('ACORD_JUD', 'ACORD_EXT') AND FLAN.STATUSLAN = 4 THEN 0
ELSE (FLAN.VALORORIGINAL - FLAN.VALORBAIXADO)
END A_RECEBER,

ISNULL(FLAN.VALORBAIXADO,0) TOTAL_RECEBIDO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D
  AND FLAN.DATAVENCIMENTO <= :DTVENCIMENTOATE_D
  AND FLAN.STATUSLAN NOT IN (2)
  
)X

GROUP BY X.ANO, X.REFERENCIA";4094;;;;07/10/2021;rafael.prado;0;1;1;1;;;;;c9663302-728f-470f-91cf-4e34315ae589;;;30298;rafael.prado;04/10/2021;rafael.prado;07/10/2021;
F;EDUREL0050A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";;;;;;;0;1;1;1;;;;;7ae8f13d-66ff-4d2d-bfa5-4cbc8b8311ff;;;-26957;rafael.prado;07/10/2021;rafael.prado;07/10/2021;
F;EDUREL0050B;Relação de Alunos Bolsistas;"SELECT DISTINCT SCURSO.CODCURSO, SCURSO.NOME, SCURSO.CODTIPOCURSO, STIPOCURSO.NOME TIPOCURSO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN    
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
 
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.NOME LIKE :CURSO_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D
  AND FLAN.DATAVENCIMENTO <= :DTVENCIMENTOATE_D
  AND FLAN.STATUSLAN NOT IN (2)";2783;;;;07/10/2021;rafael.prado;0;1;1;1;;;;;aa1d497e-c7eb-4bb2-8dc1-5e39b0741644;;;-17800;rafael.prado;07/10/2021;rafael.prado;07/10/2021;
F;EDUREL0050C;Relação de Alunos Bolsistas;"SELECT 
X.CODTURMA,
X.NOME,
X.REFERENCIA,
SUM(X.RECEITA_LIQUIDA) RECEITA_LIQUIDA,
SUM(X.TOTAL_RECEBIDO) TOTAL_RECEBIDO,
SUM(X.ACAO) ACAO,
SUM(X.ACORDO) ACORDO,
SUM(X.A_RECEBER) A_RECEBER,
((SUM(X.ACAO) + SUM(X.ACORDO) + SUM(X.A_RECEBER))*100)/SUM(X.RECEITA_LIQUIDA) PER_INADIMPLENCIA

FROM
(

SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME, FLAN.IDLAN,
YEAR(FLAN.DATAEMISSAO) ANO,
RIGHT(CONVERT(CHAR(10),FLAN.DATAEMISSAO,103),7) REFERENCIA,
ISNULL(FLAN.VALORORIGINAL,0) RECEITA_LIQUIDA,

CASE
WHEN FLAN.CODTDO = 'ACORD_JUD' AND FLAN.STATUSLAN = 0 THEN FLAN.VALORORIGINAL
WHEN FLAN.CODTDO = 'ACORD_JUD' AND FLAN.STATUSLAN = 4 THEN (FLAN.VALORORIGINAL - FLAN.VALORBAIXADO)
ELSE 0
END ACAO,

CASE
WHEN FLAN.CODTDO = 'ACORD_EXT' AND FLAN.STATUSLAN = 0 THEN FLAN.VALORORIGINAL
WHEN FLAN.CODTDO = 'ACORD_EXT' AND FLAN.STATUSLAN = 4 THEN (FLAN.VALORORIGINAL - FLAN.VALORBAIXADO)
ELSE 0
END ACORDO,

CASE
WHEN FLAN.CODTDO IN ('ACORD_JUD','ACORD_EXT') AND FLAN.STATUSLAN = 0 THEN 0
WHEN FLAN.CODTDO IN ('ACORD_JUD', 'ACORD_EXT') AND FLAN.STATUSLAN = 4 THEN 0
ELSE (FLAN.VALORORIGINAL - FLAN.VALORBAIXADO)
END A_RECEBER,

ISNULL(FLAN.VALORBAIXADO,0) TOTAL_RECEBIDO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D
  AND FLAN.DATAVENCIMENTO <= :DTVENCIMENTOATE_D
  AND FLAN.STATUSLAN NOT IN (2)
  
)X

GROUP BY X.CODTURMA, X.NOME, X.REFERENCIA";4229;;;;07/10/2021;rafael.prado;0;1;1;1;;;;;728ca1e6-5966-4bca-9cd9-779845017d22;;;28821;rafael.prado;07/10/2021;rafael.prado;07/10/2021;
F;EDUREL0051A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";;;;;;;0;1;1;1;;;;;28f38545-cc19-4126-b7c9-67ae2f22ac31;;;-31244;rafael.prado;07/10/2021;rafael.prado;07/10/2021;
F;EDUREL0051B;Relação de Alunos Bolsistas;"SELECT DISTINCT 
UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR')) AS ANO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN FLANBAIXA (NOLOCK)
	ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN TFORMAPAGTO
	ON FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
	AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLANBAIXA.DATABAIXA BETWEEN :DTBAIXAINICIAL_D AND :DTBAIXAFINAL_D
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.STATUS IN (0)
  AND FLANBAIXA.VALORBAIXA > 0

ORDER BY UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR'))";3342;;;;25/11/2021;robson.canto;0;1;1;1;;;;;2a14c2eb-6cb7-4ceb-96de-7d9887e73e5f;;;-24660;rafael.prado;07/10/2021;robson.canto;25/11/2021;
F;EDUREL0051C;Relação de Alunos Bolsistas;"SELECT DISTINCT 
FLAN.IDLAN,
FLAN.DATAEMISSAO,
FLAN.HISTORICO,
FLAN.STATUSLAN,
FLAN.VALORORIGINAL,
FLAN.VALORBAIXADO,

FLANBAIXA.IDBAIXA,
FLANBAIXA.DATABAIXA,
FLANBAIXA.STATUS,
FLANBAIXA.VALORBAIXA,
FLANBAIXA.VALORJUROS,
FLANBAIXA.VALORMULTA,

FLANBAIXA.IDFORMAPAGTO,
TFORMAPAGTO.DESCFORMAPAGTO,

SPARCELA.CODSERVICO,
SSERVICO.NOME SERVICO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN FLANBAIXA (NOLOCK)
	ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN TFORMAPAGTO
	ON FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
	AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLANBAIXA.DATABAIXA BETWEEN :DTBAIXAINICIAL_D AND :DTBAIXAFINAL_D
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.STATUS IN (0)
  AND UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR')) = :ANO1_N
  AND UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'MMMM', 'pt-BR')) = :MES1_S
  AND FLANBAIXA.VALORBAIXA > 0

ORDER BY FLAN.IDLAN, FLANBAIXA.DATABAIXA";3742;;;;25/11/2021;robson.canto;0;1;1;1;;;;;7a82acd4-2a62-4f6e-8adb-3c35c6a05d29;;;-17385;rafael.prado;07/10/2021;robson.canto;25/11/2021;
F;EDUREL0051D;Relação de Alunos Bolsistas;"SELECT DISTINCT 
UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'MMMM', 'pt-BR')) AS MES

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN FLANBAIXA (NOLOCK)
	ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN TFORMAPAGTO
	ON FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
	AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLANBAIXA.DATABAIXA BETWEEN :DTBAIXAINICIAL_D AND :DTBAIXAFINAL_D
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.STATUS IN (0)
  AND UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR')) = :ANO1_N
  AND FLANBAIXA.VALORBAIXA > 0

ORDER BY UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'MMMM', 'pt-BR'))";3411;;;;25/11/2021;robson.canto;0;1;1;1;;;;;2a14c2eb-6cb7-4ceb-96de-7d9887e73e5f;;;-22742;rafael.prado;18/10/2021;robson.canto;25/11/2021;
F;EDUREL0052A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";;;;;;;0;1;1;1;;;;;d5121c8a-15b2-4551-b43b-62409e9bfc6b;;;-2439;rafael.prado;20/10/2021;rafael.prado;20/10/2021;
F;EDUREL0052B;Relação de Alunos Bolsistas;"SELECT DISTINCT 
UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR')) AS ANO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN FLANBAIXA (NOLOCK)
	ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN TFORMAPAGTO
	ON FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
	AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLANBAIXA.DATABAIXA BETWEEN :DTBAIXAINICIAL_D AND :DTBAIXAFINAL_D
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND TFORMAPAGTO.DESCFORMAPAGTO LIKE :FORMAPAGTO_S
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.STATUS IN (0)
  AND FLANBAIXA.VALORBAIXA > 0

ORDER BY UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR'))";3395;;;;25/11/2021;robson.canto;0;1;1;1;;;;;e6a05f82-33e4-4b01-a5e8-7877fb6fa013;;;-331;rafael.prado;20/10/2021;robson.canto;25/11/2021;
F;EDUREL0052C;Relação de Alunos Bolsistas;"SELECT DISTINCT 
FLAN.IDLAN,
FLAN.DATAEMISSAO,
FLAN.HISTORICO,
FLAN.STATUSLAN,
FLAN.VALORORIGINAL,
FLAN.VALORBAIXADO,

FLANBAIXA.IDBAIXA,
FLANBAIXA.DATABAIXA,
FLANBAIXA.STATUS,
FLANBAIXA.VALORBAIXA,
FLANBAIXA.VALORJUROS,
FLANBAIXA.VALORMULTA,

FLANBAIXA.IDFORMAPAGTO,
TFORMAPAGTO.DESCFORMAPAGTO,

SPARCELA.CODSERVICO,
SSERVICO.NOME SERVICO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN FLANBAIXA (NOLOCK)
	ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN TFORMAPAGTO
	ON FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
	AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLANBAIXA.DATABAIXA BETWEEN :DTBAIXAINICIAL_D AND :DTBAIXAFINAL_D
  AND SPARCELA.CODSERVICO = :CODSERVICO1_S
  AND TFORMAPAGTO.DESCFORMAPAGTO LIKE :FORMAPAGTO_S
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.STATUS IN (0)
  AND UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR')) = :ANO1_N
  AND UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'MMMM', 'pt-BR')) = :MES1_S
  AND FLANBAIXA.VALORBAIXA > 0

ORDER BY FLAN.IDLAN, FLANBAIXA.DATABAIXA";3802;;;;25/11/2021;robson.canto;0;1;1;1;;;;;32b32fdd-8c69-440d-9b85-78652e3448c3;;;-15003;rafael.prado;20/10/2021;robson.canto;25/11/2021;
F;EDUREL0052D;Relação de Alunos Bolsistas;"SELECT DISTINCT 
UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'MMMM', 'pt-BR')) AS MES

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN FLANBAIXA (NOLOCK)
	ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN TFORMAPAGTO
	ON FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
	AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLANBAIXA.DATABAIXA BETWEEN :DTBAIXAINICIAL_D AND :DTBAIXAFINAL_D
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND TFORMAPAGTO.DESCFORMAPAGTO LIKE :FORMAPAGTO_S
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.STATUS IN (0)
  AND UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR')) = :ANO1_N
  AND FLANBAIXA.VALORBAIXA > 0

ORDER BY UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'MMMM', 'pt-BR'))";3464;;;;25/11/2021;robson.canto;0;1;1;1;;;;;b2978a58-3e90-4a86-b420-99817cf14fe5;;;-22799;rafael.prado;20/10/2021;robson.canto;25/11/2021;
F;EDUREL0052E;Relação de Alunos Bolsistas;"SELECT DISTINCT SPARCELA.CODSERVICO,
SSERVICO.NOME SERVICO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
LEFT JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN FLANBAIXA (NOLOCK)
	ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN TFORMAPAGTO
	ON FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
	AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND FLANBAIXA.DATABAIXA BETWEEN :DTBAIXAINICIAL_D AND :DTBAIXAFINAL_D
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND TFORMAPAGTO.DESCFORMAPAGTO LIKE :FORMAPAGTO_S
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.STATUS IN (0)
  AND UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'yyyy', 'pt-BR')) = :ANO1_N
  AND UPPER(FORMAT(FLANBAIXA.DATABAIXA, 'MMMM', 'pt-BR')) = :MES1_N
  AND FLANBAIXA.VALORBAIXA > 0";3452;;;;25/11/2021;robson.canto;0;1;1;1;;;;;b2978a58-3e90-4a86-b420-99817cf14fe5;;;-1654;rafael.prado;20/10/2021;robson.canto;25/11/2021;
F;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
F;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
F;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
F;FIN.001;Parcelas sem Lançamento Gerado;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SCONTRATO.CODCONTRATO,
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.NOME AS 'CURSO',
	SCONTRATO.RA,
	SSTATUS.DESCRICAO AS 'STATUS CURSO',
	SMATRICPL.CODTURMA,
	SPLETIVO.CODFILIAL,
	SPLETIVO.CODTIPOCURSO,
	SSERVICO.NOME AS 'SERVICO',
	SPARCELA.PARCELA,
	SPARCELA.DTVENCIMENTO,
	SCONTRATO.CODCOLIGADA,
	SCONTRATO.IDPERLET,
	SCONTRATO.IDHABILITACAOFILIAL,
	1 AS 'TOTAL'
FROM SCONTRATO (NOLOCK)
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SPARCELA (NOLOCK) ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPARCELA.RA = SCONTRATO.RA
	AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
	AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SSERVICO (NOLOCK) ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
LEFT JOIN SLAN (NOLOCK) ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
WHERE SLAN.CODCOLIGADA IS NULL
AND SPLETIVO.CODPERLET = :CODPERLET
AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCINI_D AND :DTVENCFIN_D
AND SCONTRATO.STATUS = 'N'";2537;;;;27/04/2022;consultor1.totvs;0;1;1;1;;;;0;d22cdef5-ee6c-41b0-9fbe-336e1bec0827;0;;-16305;consultor1.totvs;27/04/2022;consultor1.totvs;27/04/2022;0
F;FIN.003;Tipos de Recebimento;"SELECT DISTINCT 
				FSESSAOCAIXA.IDSESSAO,
                GUSUARIO.NOME,
                SUM(ISNULL(FSESSAOCAIXA.SALDOINICIAL,0)) SALDOINICIAL
FROM  FSESSAOCAIXA
         /*ON FSESSAOCAIXA.CODCOLIGADA = FLAN.CODCOLIGADA
            AND FSESSAOCAIXA.CODUSUARIOOPERADOR = FLANBAIXA.USUARIO
            AND FSESSAOCAIXA.DATAHORAABERTURA >= FLAN.DATABAIXA
            AND FSESSAOCAIXA.DATAHORAFECHAMENTO < GETDATE()*/
       INNER JOIN GUSUARIO
         ON GUSUARIO.CODUSUARIO = FSESSAOCAIXA.CODUSUARIOOPERADOR

WHERE  

FSESSAOCAIXA.CODCOLIGADA = :$CODCOLIGADA
       AND CONVERT(VARCHAR(10), DATAHORAABERTURA, 103) = CONVERT(VARCHAR(10), :DATA_INICIAL, 103) 
       AND FSESSAOCAIXA.CODUSUARIOOPERADOR LIKE '%'+ CAST(:CODUSUARIO1 AS VARCHAR) + '%'
       /*AND FSESSAOCAIXA.CODUSUARIOOPERADOR = :CODUSUARIO1*/
       AND CAST(FSESSAOCAIXA.IDSESSAO AS VARCHAR(10)) LIKE :IDSESSÃO
GROUP  BY 
          FSESSAOCAIXA.IDSESSAO, GUSUARIO.NOME 
";959;;;;19/10/2022;robson.canto;0;1;1;1;;;;;8d37f9ae-22bb-40d1-adee-6e69c37e34ea;;;-19581;marli.oliveira;28/03/2022;robson.canto;19/10/2022;
F;FIN.004;Lançamentos do Dia;"SELECT SALUNO.RA,
       PPESSOA.NOME              ALUNO,
       GFILIAL.NOMEFANTASIA AS 'UNIDADE',
       FLAN.HISTORICO,
       GUSUARIO.NOME AS COLABORADOR,
       TFORMAPAGTO.DESCFORMAPAGTO,
       FTDO.DESCRICAO            TIPODOC,
       FLANBAIXA.VALORMULTA,
       FLANBAIXA.VALORJUROS,
       FLAN.IDLAN,
       FLAN.VALORORIGINAL,
       Sum(FLANBAIXA.VALORBAIXA) VALORBAIXA,
       FLAN.NUMERODOCUMENTO
FROM   FLAN
       INNER JOIN FLANBAIXA
               ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA
                  AND FLANBAIXA.IDLAN = FLAN.IDLAN
       INNER JOIN TFORMAPAGTO
               ON TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
                  AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
       INNER JOIN FTDO
               ON FTDO.CODCOLIGADA = FLAN.CODCOLIGADA
                  AND FTDO.CODTDO = FLAN.CODTDO
       INNER JOIN SLAN
               ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                  AND SLAN.IDLAN = FLAN.IDLAN
       INNER JOIN SPARCELA
               ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                  AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
       INNER JOIN SALUNO
               ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  AND SPARCELA.RA = SALUNO.RA
       INNER JOIN PPESSOA
               ON PPESSOA.CODIGO = SALUNO.CODPESSOA
       LEFT JOIN GFILIAL ON GFILIAL.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
       	AND GFILIAL.CODFILIAL = FLANBAIXA.CODFILIAL
       LEFT JOIN GUSUARIO ON GUSUARIO.CODUSUARIO = FLANBAIXA.USUARIO
       
       INNER JOIN FLOGSESSAOCAIXA ON FLOGSESSAOCAIXA.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND 	
       								 FLOGSESSAOCAIXA.IDLAN = FLANBAIXA.IDLAN AND 
       								 FLOGSESSAOCAIXA.IDBAIXA = FLANBAIXA.IDBAIXA
       								 
WHERE  FLANBAIXA.CODCOLIGADA = :$CODCOLIGADA
       AND FLANBAIXA.DATABAIXA BETWEEN :DATA_INICIAL AND :DATA_FINAL
       AND FLANBAIXA.USUARIO LIKE '%'+ CAST(:CODUSUARIO1 AS VARCHAR) + '%'
	   AND FLANBAIXA.CODFILIAL = :CODFILIAL1
       AND TFORMAPAGTO.DESCFORMAPAGTO = :DESCFORMAPAGTO1
       AND FLOGSESSAOCAIXA.IDSESSAO = :IDSESSAO1
       
GROUP  BY SALUNO.RA,
          PPESSOA.NOME,
          FLAN.HISTORICO,
          GUSUARIO.NOME,
          TFORMAPAGTO.DESCFORMAPAGTO,
          FTDO.DESCRICAO,
          FLANBAIXA.VALORMULTA,
          FLANBAIXA.VALORJUROS,
          FLAN.IDLAN,
          FLAN.VALORORIGINAL,
          GFILIAL.NOMEFANTASIA,
          FLAN.NUMERODOCUMENTO
ORDER  BY PPESSOA.NOME,
          FTDO.DESCRICAO 
";2563;;;;19/10/2022;robson.canto;0;1;1;1;;;;;794c2aab-c931-41fc-bf27-5eb3281394d1;;;24567;marli.oliveira;28/03/2022;robson.canto;19/10/2022;
F;FIN.006;Baixas Por Tipo de Pagamento;"SELECT  
TFORMAPAGTO.DESCFORMAPAGTO,
                GUSUARIO.NOME,
                SUM(ISNULL(FSESSAOCAIXA.SALDOINICIAL,0)) SALDOINICIAL
FROM   FLAN
      INNER JOIN FLANBAIXA
         ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA
            AND FLANBAIXA.IDLAN = FLAN.IDLAN
       INNER JOIN TFORMAPAGTO
         ON TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
            AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
       INNER JOIN FTDO
         ON FTDO.CODCOLIGADA = FLAN.CODCOLIGADA
            AND FTDO.CODTDO = FLAN.CODTDO
       INNER JOIN SLAN
         ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
            AND SLAN.IDLAN = FLAN.IDLAN
       INNER JOIN SPARCELA
         ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
            AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
/*       JOIN FSESSAOCAIXA
         ON FSESSAOCAIXA.CODCOLIGADA = FLAN.CODCOLIGADA
            AND FSESSAOCAIXA.CODUSUARIOOPERADOR = FLANBAIXA.USUARIO
            AND FSESSAOCAIXA.DATAHORAABERTURA >= FLAN.DATABAIXA
            AND FSESSAOCAIXA.DATAHORAFECHAMENTO < GETDATE()
*/
       INNER JOIN FLOGSESSAOCAIXA (NOLOCK)	ON FLOGSESSAOCAIXA.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND 	
       								 		   FLOGSESSAOCAIXA.IDLAN = FLANBAIXA.IDLAN AND 
       								 		   FLOGSESSAOCAIXA.IDBAIXA = FLANBAIXA.IDBAIXA
       								 		   
       INNER JOIN FSESSAOCAIXA (NOLOCK)		ON FSESSAOCAIXA.CODCOLIGADA = FLOGSESSAOCAIXA.CODCOLIGADA AND 
       								   		   FSESSAOCAIXA.IDSESSAO = FLOGSESSAOCAIXA.IDSESSAO
       								 		   
       INNER JOIN GUSUARIO
         ON GUSUARIO.CODUSUARIO = FLANBAIXA.USUARIO
/*INNER JOIN SALUNO
  ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
     AND SPARCELA.RA = SALUNO.RA
INNER JOIN PPESSOA
  ON PPESSOA.CODIGO = SALUNO.CODPESSOA*/
WHERE  
/*FLANBAIXA.CODCOLIGADA = 1
       AND FLANBAIXA.DATABAIXA BETWEEN '2019-04-11' AND '2019-04-11'
       AND FLANBAIXA.USUARIO = 'paola.gomes'*/
FLANBAIXA.CODCOLIGADA = :$CODCOLIGADA
       AND FLANBAIXA.DATABAIXA BETWEEN :DATA_INICIAL AND :DATA_FINAL
       AND FLANBAIXA.USUARIO LIKE '%' + CAST(:CODUSUARIO1 AS VARCHAR) + '%'
       /*AND FLANBAIXA.USUARIO = :CODUSUARIO1*/
       AND FSESSAOCAIXA.IDSESSAO = :IDSESSAO1
GROUP  BY TFORMAPAGTO.DESCFORMAPAGTO,
          GUSUARIO.NOME 
";2301;;;;19/10/2022;robson.canto;0;1;1;1;;;;;3489c9bd-dcf5-4a22-8842-bbe916b74d63;;;23906;marli.oliveira;28/03/2022;robson.canto;19/10/2022;
F;FIN.012;Saques, Depósitos e  Tranferências de Caixa;"SELECT 
	CASE TIPO
		WHEN 1 THEN 'Saque Manual'
		WHEN 2 THEN 'Depósito Manual'
		WHEN 3 THEN 'Transferência'
		END AS OPERACAO, NUMERODOCUMENTO, HISTORICO, VALOR, DATA,
		
	(SELECT SUM(VALOR) FROM FXCX WHERE CODCOLIGADA = :$CODCOLIGADA
AND USUARIOCRIACAO = :CODUSUARIO1
AND DATA >= :DATA_INICIAL
AND TIPO = 1) AS TOTALSAQUE,

(SELECT SUM(VALOR) FROM FXCX WHERE CODCOLIGADA = :$CODCOLIGADA
AND USUARIOCRIACAO = :CODUSUARIO1
AND DATA >= :DATA_INICIAL
AND TIPO IN (2)) AS TOTALDEPOSITO,

(SELECT SUM(VALOR) FROM FXCX WHERE CODCOLIGADA = :$CODCOLIGADA
AND USUARIOCRIACAO = :CODUSUARIO1
AND DATA >= :DATA_INICIAL
AND TIPO IN (3)) AS TOTALTRANFERENCIA


FROM FXCX
WHERE CODCOLIGADA = :$CODCOLIGADA
AND USUARIOCRIACAO LIKE '%' +  CAST(:CODUSUARIO1 AS VARCHAR) + '%'
/*AND USUARIOCRIACAO = :CODUSUARIO1*/
AND DATA >= :DATA_INICIAL
AND TIPO IN (1,2,3)";871;;;;07/04/2022;consultor1.totvs;0;1;1;1;;;;;d73f8434-b7e4-4786-b5bc-c91246d66816;;;-11477;marli.oliveira;28/03/2022;consultor1.totvs;07/04/2022;
F;FINREL0007A;Dados da Filial;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";198;;;;10/08/2021;mestre;0;1;1;1;;;;;89ce610d-f110-4a53-8a7b-a4548d7f1c25;;;-25011;mestre;10/08/2021;mestre;11/08/2021;
F;FINREL0007B;Relação de alunos inadimplentes;"SELECT DISTINCT
  SMATRICPL.RA,
  PPESSOA.NOME AS NOMEALUNO,
  FLAN.IDLAN,
  FLAN.HISTORICO,
  FLAN.DATAEMISSAO,
  FLAN.DATAVENCIMENTO,
  CASE WHEN (FLAN.STATUSLAN = 0) OR (FLAN.VALORBAIXADO IS NULL) THEN FLAN.VALORORIGINAL
  ELSE FLAN.VALORORIGINAL - FLAN.VALORBAIXADO
  END AS TOTALVALORORIGINAL
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN FCFO (NOLOCK)
    ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO
	AND FCFO.CODCFO = FLAN.CODCFO
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO

WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SPLETIVO.CODPERLET LIKE :CODPERLET_S
  AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO1_S
  AND ((:PARCELA_N = 0 AND SPARCELA.PARCELA > 0) OR (:PARCELA_N > 0 AND SPARCELA.PARCELA = :PARCELA_N))
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND SMATRICPL.RA LIKE :RA_S
  /*AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D*/
  AND FLAN.DATAVENCIMENTO BETWEEN :DTVENCIMENTODE_D AND :DTVENCIMENTOATE_D
  AND FLAN.STATUSLAN IN (0,4)
  AND FLAN.CODCFO = :CODCFO1_S
ORDER BY PPESSOA.NOME, FLAN.DATAVENCIMENTO";2934;;;;23/09/2021;nathally.lima;0;1;1;1;;;;;b62957c6-a349-4853-8090-1aba4f8584ba;;;-19452;mestre;10/08/2021;nathally.lima;23/09/2021;
F;FINREL0007C;Relação de alunos inadimplentes;"SELECT DISTINCT FCFO.CODCFO, FCFO.NOMEFANTASIA, FCFO.TELEFONE, FCFO.EMAIL , 1 CONTA

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN FCFO (NOLOCK)
    ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO
	AND FCFO.CODCFO = FLAN.CODCFO
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO

WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SPLETIVO.CODPERLET LIKE :CODPERLET_S
  AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO1_S
  AND ((:PARCELA_N = 0 AND SPARCELA.PARCELA > 0) OR (:PARCELA_N > 0 AND SPARCELA.PARCELA = :PARCELA_N))
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND SMATRICPL.RA LIKE :RA_S
  /*AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D*/
  AND FLAN.DATAVENCIMENTO BETWEEN :DTVENCIMENTODE_D AND :DTVENCIMENTOATE_D
  AND FLAN.STATUSLAN IN (0,4)";2638;;;;23/09/2021;lilian.buzetti;0;1;1;1;;;;;78fe9d5f-d0fd-45bf-85df-8a16cde5f9e0;;;28521;mestre;10/08/2021;lilian.buzetti;23/09/2021;
F;FINREL0007D;Relação de alunos inadimplentes;"SELECT DISTINCT SCURSO.CODCURSO, SCURSO.NOME, SCURSO.CODTIPOCURSO, STIPOCURSO.NOME TIPOCURSO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN FCFO (NOLOCK)
    ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO
	AND FCFO.CODCFO = FLAN.CODCFO
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SPLETIVO.CODPERLET LIKE :CODPERLET_S
  AND SCURSO.NOME LIKE :CURSO_S
  AND ((:PARCELA_N = 0 AND SPARCELA.PARCELA > 0) OR (:PARCELA_N > 0 AND SPARCELA.PARCELA = :PARCELA_N))
  AND SSERVICO.NOME LIKE :SERVICO_S
  AND SCONTRATO.RA LIKE :RA_S
  /*AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D*/
  AND FLAN.DATAVENCIMENTO BETWEEN :DTVENCIMENTODE_D AND :DTVENCIMENTOATE_D
  AND FLAN.STATUSLAN IN (0,4)";2632;;;;23/09/2021;nathally.lima;0;1;1;1;;;;;8e525def-9781-4907-b9ae-e5914377c4c9;;;29145;mestre;11/08/2021;nathally.lima;23/09/2021;
F;FINREL0012.9;RECIBO BEMATECH;"Select 
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	Sum(RECVALORBAIXA) RECVALORBAIXA,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	numerodocumento,
	dbo.dv_Recibo(RECCODIGO,RECIDSESSAO,RECNUMEROCAIXA,RECCODCXA,replace(replace(convert(varchar(20), VALORTOTAL, 0),'.',''),',',''),convert(varchar(10),getdate(),112)) RECdv_Recibo
from (
	SELECT	
		/*	RECIBO	*/	
		L.IDLAN					RECCODIGO,
		L.HISTORICO				RECHISTORICO,
		F.IDINTEGRACAO			RECENTIDADE,
		l.DATAEMISSAO			RECDATAEMISSAO,
		SC.IDSESSAO				RECIDSESSAO,
		SC.NUMEROCAIXA			RECNUMEROCAIXA,
		SC.CODUSUARIOOPERADOR	RECUSUARIOOPERADOR,
		SC.CODCXA				RECCODCXA,
		cx.DESCRICAO			RECCDESCXA,
		FP.DESCFORMAPAGTO		RECFORMAPAGAMENTO,
		lb.VALORBAIXA			RECVALORBAIXA,
		(SELECT SUM(VALORBAIXA) FROM FLANBAIXA LBX WHERE LBX.IDLAN IN(:IDLAN) AND LBX.CODCOLIGADA = 1 AND LBX.STATUS <> 1) as VALORTOTAL,
	
		/*	FILIAL	*/
		F.CODFILIAL				FILCODG,
		F.NOME					FILNOME,
		F.CGC					FILCNPJ,
		F.RUA					FILENDERECO,
		F.NUMERO				FILENDERECONUMERO,
		F.BAIRRO				FILBAIRRO,
		F.CIDADE				FILCIDADE,
		F.ESTADO				FILESTADO,
		F.CEP					FILCEP,
		F.TELEFONE				FILTELEFONE,
		F.EMAIL					FILEMAIL,
		fx.numerodocumento
	FROM 
		FSESSAOCAIXA				SC	(NOLOCK)
		INNER JOIN FLOGSESSAOCAIXA	LSC (NOLOCK)	ON LSC.CODCOLIGADA = SC.CODCOLIGADA AND LSC.IDSESSAO = SC.IDSESSAO
		INNER JOIN FLANBAIXA		LB	(NOLOCK) 	ON LB.CODCOLIGADA = LSC.CODCOLIGADA AND LB.IDBAIXA = LSC.IDBAIXA AND LB.IDLAN = LSC.IDLAN       
		INNER JOIN TFFORMAPAGTO		FP	(NOLOCK)	ON FP.CODCOLIGADA = LB.CODCOLIGADA AND FP.IDFORMAPAGTO = LB.IDFORMAPAGTO
		left join FCXA				CX	(NOLOCK)	ON cx.CODCOLIGADA = lb.CODCOLCXA and cx.CODCXA = lb.CODCXA
		INNER JOIN FLAN				L	(NOLOCK)	ON L.CODCOLIGADA = SC.CODCOLIGADA AND L.IDLAN = LB.IDLAN 
		LEFT JOIN GFILIAL			F	(NOLOCK)	ON F.CODCOLIGADA = L.CODCOLIGADA and F.CODFILIAL = L.CODFILIAL 

		left join FXCX				fx	(NOLOCK)	on fx.CODCOLIGADA = lb.CODCOLIGADA and fx.IDXCX = lb.IDXCX 
	WHERE 	
		L.IDLAN IN(:IDLAN)
		AND L.CODCOLIGADA = 1
		AND LB.STATUS <> 1) x
Group by
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	numerodocumento";2586;;;;20/07/2021;lucas.ssantos;0;1;1;1;;;;;f223f66b-e69e-4327-81f6-6fe32acec014;;;21722;lucas.ssantos;20/07/2021;lucas.ssantos;20/07/2021;
F;FINREL00124;RECIBO BEMATECH;"Select 
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECDATABAIXA,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	Sum(RECVALORBAIXA) RECVALORBAIXA,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	dbo.dv_Recibo(RECCODIGO,RECIDSESSAO,RECNUMEROCAIXA,RECCODCXA,replace(replace(convert(varchar(20), VALORTOTAL, 0),'.',''),',',''),convert(varchar(10),getdate(),112)) RECdv_Recibo,
	IDTRANSACAO
	
from (
	SELECT	
		/*	RECIBO	*/	
		L.IDLAN					RECCODIGO,
		L.HISTORICO				RECHISTORICO,
		F.IDINTEGRACAO			RECENTIDADE,
		l.DATAEMISSAO			RECDATAEMISSAO,
		l.DATABAIXA				RECDATABAIXA,
		SC.IDSESSAO				RECIDSESSAO,
		SC.NUMEROCAIXA			RECNUMEROCAIXA,
		SC.CODUSUARIOOPERADOR	RECUSUARIOOPERADOR,
		SC.CODCXA				RECCODCXA,
		cx.DESCRICAO			RECCDESCXA,
		FP.DESCFORMAPAGTO		RECFORMAPAGAMENTO,
		lb.VALORBAIXA			RECVALORBAIXA,
		/*(SELECT SUM(VALORBAIXA) FROM FLANBAIXA LBX WHERE LBX.IDLAN IN(:IDLAN) AND LBX.CODCOLIGADA = 1 AND LBX.STATUS <> 1) as VALORTOTAL,*/
		(SELECT 
		  SUM(VALORBAIXA) 
		 
		 FROM 
		  FLANBAIXA LBX 
		 
		 WHERE 	LBX.IDLAN IN(:IDLAN) 
		 	AND LBX.CODCOLIGADA = 1 
		 	AND LBX.STATUS <> 1
		 	AND CONVERT(VARCHAR(10), LBX.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
		 	) as VALORTOTAL,
	
		/*	FILIAL	*/
		F.CODFILIAL				FILCODG,
		F.NOME					FILNOME,
		F.CGC					FILCNPJ,
		F.RUA					FILENDERECO,
		F.NUMERO				FILENDERECONUMERO,
		F.BAIRRO				FILBAIRRO,
		F.CIDADE				FILCIDADE,
		F.ESTADO				FILESTADO,
		F.CEP					FILCEP,
		F.TELEFONE				FILTELEFONE,
		F.EMAIL					FILEMAIL,
		LB.IDTRANSACAO,
		fx.*
	
	FROM FLAN L
	LEFT JOIN FLANBAIXA         LB  (NOLOCK)    ON L.CODCOLIGADA = LB.CODCOLIGADA AND L.IDLAN = LB.IDLAN 
	LEFT JOIN FCXA				CX	(NOLOCK)	ON cx.CODCOLIGADA = lb.CODCOLCXA and cx.CODCXA = lb.CODCXA
	LEFT JOIN FLOGSESSAOCAIXA   LSC (NOLOCK)    ON LSC.CODCOLIGADA = LB.CODCOLIGADA AND LSC.IDLAN = LB.IDLAN AND LSC.IDBAIXA = LB.IDBAIXA
	LEFT JOIN FSESSAOCAIXA       SC (NOLOCK)    ON SC.CODCOLCXA = CX.CODCOLIGADA AND SC.CODCXA = CX.CODCXA AND SC.IDSESSAO = lsc.IDSESSAO
    LEFT JOIN TFORMAPAGTO        FP (NOLOCK)    ON FP.CODCOLIGADA = LB.CODCOLIGADA AND FP.IDFORMAPAGTO = LB.IDFORMAPAGTO
	LEFT JOIN GFILIAL			 F	(NOLOCK)	ON F.CODCOLIGADA = L.CODCOLIGADA and F.CODFILIAL = L.CODFILIAL 
    LEFT JOIN FXCX				 fx	(NOLOCK)	on fx.CODCOLIGADA = LB.CODCOLIGADA and fx.IDXCX = LB.IDXCX 
	
	WHERE 	
		L.IDLAN IN(:IDLAN)
		AND L.CODCOLIGADA = 1
		AND LB.STATUS <> 1
		AND CONVERT(VARCHAR(10), LB.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
		) x
Group by
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECDATABAIXA,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	IDTRANSACAO";3056;;;;21/09/2022;robson.canto;0;1;1;1;;;;;4d93cbaf-f8a5-4587-8815-6e0af7cfc728;;;-3731;mestre;02/08/2021;robson.canto;21/09/2022;
F;FINREL00124A;RECIBO BEMATECH;"SELECT 
 STRING_AGG(CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN), CHAR(13)+CHAR(10)) HISTORICO,
 STRING_AGG(CONCAT(FORMAT(X.VALORBAIXA, 'C', 'pt-br'), CHAR(13)+CHAR(10), ''), CHAR(13)+CHAR(10)) VALORBAIXADO

FROM
(SELECT 
  FLAN.IDLAN, 
  FLAN.NUMERODOCUMENTO, 
  SUBSTRING(FLAN.HISTORICO, 1,35) HISTORICO, 
  SUM(FLANBAIXA.VALORBAIXA) AS VALORBAIXA
  
 FROM 
  FLAN (NOLOCK)
  
  INNER JOIN FLANBAIXA (NOLOCK)	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
  								   FLANBAIXA.IDLAN = FLAN.IDLAN AND
  								   FLANBAIXA.STATUS = 0
  
 WHERE 	FLAN.CODCOLIGADA = 1
 	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
	AND FLAN.IDLAN IN (SELECT DISTINCT
	  				    FLANBAIXA.IDLAN
					   
					   FROM 
					    FLANBAIXA (NOLOCK)
					    
					   WHERE FLANBAIXA.STATUS = 0
						 AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
						 								FLANBAIXA.DATABAIXA /*FLB.IDTRANSACAO*/
														
													   FROM 
													    FLANBAIXA FLB (NOLOCK)

													    INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   FL.IDLAN = FLB.IDLAN AND
																					   FL.CODCFO = FLAN.CODCFO

													   WHERE FLB.STATUS = 0
														 AND FLB.IDLAN = :IDLAN
														 AND FLB.RECCREATEDON >= DATEADD(MI,-10,FLANBAIXA.RECCREATEDON) 
														 AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)

													  )
					  )
GROUP BY
	  FLAN.IDLAN, 
  FLAN.NUMERODOCUMENTO, 
  FLAN.HISTORICO

) X

/*
SELECT 
STRING_AGG(CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN), CHAR(13)+CHAR(10)) HISTORICO,
STRING_AGG(CONCAT(FORMAT(X.VALORBAIXADO, 'C', 'pt-br'), CHAR(13)+CHAR(10), ''), CHAR(13)+CHAR(10)) VALORBAIXADO

FROM
(
SELECT FLAN.IDLAN, FLAN.NUMERODOCUMENTO, SUBSTRING(FLAN.HISTORICO, 1,35) HISTORICO, FLAN.VALORBAIXADO
FROM FLAN
WHERE FLAN.CODCOLIGADA = 1
AND FLAN.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDLAN = :IDLAN
)
)
) X
*/
";2238;;;;21/09/2022;robson.canto;0;1;1;1;;;;;3e213eb3-06e3-4d9d-ae0e-254537b36e68;;;16646;mestre;04/08/2021;robson.canto;21/09/2022;
F;FINREL00124B;RECIBO BEMATECH;"SELECT 
 STRING_AGG(X.DESCFORMAPAGTO, CHAR(13)+CHAR(10) ) DESCFORMAPAGTO, 
 STRING_AGG(FORMAT(X.VALORBAIXA, 'C', 'PT-BR'), CHAR(13)+CHAR(10) ) VALORBAIXADO

FROM
(SELECT 
  TFORMAPAGTO.DESCFORMAPAGTO,
  SUM(FLANBAIXA.VALORBAIXA) VALORBAIXA

 FROM 
  FLANBAIXA (NOLOCK), 
  TFORMAPAGTO (NOLOCK),
  FLAN (NOLOCK)
  
 WHERE TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
	AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
	
	AND FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
	
	AND FLANBAIXA.CODCOLIGADA = 1
	AND FLANBAIXA.STATUS = 0
	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
	AND FLANBAIXA.IDLAN IN (SELECT DISTINCT
							 FLANBAIXA.IDLAN
						   
						    FROM 
						     FLANBAIXA (NOLOCK)
						    
							WHERE 	FLANBAIXA.STATUS = 0
								AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
															   FLANBAIXA.DATABAIXA /*FLB.IDTRANSACAO*/
															  
															  FROM 
															   FLANBAIXA FLB (NOLOCK)

													    	   INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   		   FL.IDLAN = FLB.IDLAN AND
																					   		   FL.CODCFO = FLAN.CODCFO

													   		  WHERE FLB.STATUS = 0
														 		AND FLB.IDLAN = :IDLAN
														 		AND FLB.RECCREATEDON >= FLANBAIXA.RECCREATEDON
														 		AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)
															 )
						   )

GROUP BY TFORMAPAGTO.DESCFORMAPAGTO
) X

/*
SELECT 
STRING_AGG(X.DESCFORMAPAGTO, CHAR(13)+CHAR(10) ) DESCFORMAPAGTO, 
STRING_AGG(FORMAT(X.VALORBAIXA, 'C', 'PT-BR'), CHAR(13)+CHAR(10) ) VALORBAIXADO

FROM
(
SELECT TFORMAPAGTO.DESCFORMAPAGTO,
SUM(FLANBAIXA.VALORBAIXA) VALORBAIXA

FROM FLANBAIXA, TFORMAPAGTO
WHERE TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
AND FLANBAIXA.CODCOLIGADA = 1
AND FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA 
WHERE FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDLAN = :IDLAN
)
)

GROUP BY TFORMAPAGTO.DESCFORMAPAGTO
) X
*/";2597;;;;27/05/2022;robson.canto;0;1;1;1;;;;;c1483060-32d8-44c3-98dd-c3bc16dd2206;;;32414;mestre;04/08/2021;robson.canto;27/05/2022;
F;FINREL00124C;RECIBO BEMATECH;"SELECT 
 SUM(FLANBAIXA.VALORBAIXA) VALORBAIXADO

FROM 
 FLAN (NOLOCK)
 
 INNER JOIN FLANBAIXA (NOLOCK)	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 								   FLANBAIXA.IDLAN = FLAN.IDLAN AND 
 								   FLANBAIXA.STATUS = 0

WHERE 	FLAN.CODCOLIGADA = 1
	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
	AND FLAN.IDLAN IN (SELECT DISTINCT
					    FLANBAIXA.IDLAN
					  
					   FROM 
					    FLANBAIXA (NOLOCK)
					 
					   WHERE FLANBAIXA.STATUS = 0
						 AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
													    FLANBAIXA.DATABAIXA /*FLB.IDTRANSACAO*/
			
													   FROM 
													    FLANBAIXA FLB (NOLOCK)
													  
													    INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   FL.IDLAN = FLB.IDLAN AND
																					   FL.CODCFO = FLAN.CODCFO

													   WHERE FLB.STATUS = 0
														 AND FLB.IDLAN = :IDLAN
														 AND FLB.RECCREATEDON >= FLANBAIXA.RECCREATEDON
														 AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)
													 )
					  )
/*
SELECT SUM(FLAN.VALORBAIXADO) VALORBAIXADO
FROM FLAN
WHERE FLAN.CODCOLIGADA = 1
AND FLAN.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDLAN = :IDLAN
)
)
*/";1506;;;;27/05/2022;robson.canto;0;1;1;1;;;;;4da7a07a-ebb1-498f-8557-07163886dd01;;;-3956;mestre;04/08/2021;robson.canto;27/05/2022;
F;FINREL00124D;RECIBO BEMATECH;"SELECT 
/*
 STRING_AGG(CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN), CHAR(13)+CHAR(10)) HISTORICO,
 STRING_AGG(CONCAT(FORMAT(X.VALORBAIXA, 'C', 'pt-br'), CHAR(13)+CHAR(10), ''), CHAR(13)+CHAR(10)) VALORBAIXADO
*/
 /*X.HISTORICO + ' Ref.: ' + CAST(X.IDLAN AS VARCHAR(10)) HISTORICO,*/
 X.RESPONSAVEL,
 X.CNPJ,
 
 X.HISTORICO,
 'Ref.: ' + CAST(X.IDLAN AS VARCHAR(10)) IDLAN,
 X.VALORBAIXA VALORBAIXADO
 
FROM
(SELECT 
  FLAN.IDLAN, 
  FLAN.NUMERODOCUMENTO, 
  FCFO.NOME RESPONSAVEL,
  FCFO.CGCCFO CNPJ,

  FLAN.HISTORICO,
  SUM(FLANBAIXA.VALORBAIXA) AS VALORBAIXA
 FROM 
  FLAN (NOLOCK)
  
  INNER JOIN FLANBAIXA (NOLOCK)	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
  								   FLANBAIXA.IDLAN = FLAN.IDLAN AND
  								   FLANBAIXA.STATUS = 0
  
   INNER JOIN FCFO (NOLOCK)		ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
  								   FCFO.CODCFO = FLAN.CODCFO								   

 WHERE 	FLAN.CODCOLIGADA = 1
 	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
	AND FLANBAIXA.IDTRANSACAO = :IDTRANSACAO1
/*	
	AND FLAN.IDLAN IN (SELECT DISTINCT
	  				    FLANBAIXA.IDLAN
					   
					   FROM 
					    FLANBAIXA (NOLOCK)
					    
					   WHERE FLANBAIXA.STATUS = 0
						 AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
						 								FLB.DATABAIXA /*FLB.IDTRANSACAO*/
														
													   FROM 
													    FLANBAIXA FLB (NOLOCK)
													    
													    INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   FL.IDLAN = FLB.IDLAN AND
																					   FL.CODCFO = FLAN.CODCFO

													   WHERE FLB.STATUS = 0
														 
														 AND FLB.RECCREATEDON >= DATEADD(MI,-10,FLANBAIXA.RECCREATEDON)
														 AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)
													  )
					  )
*/
GROUP BY
	  FLAN.IDLAN, 
  FLAN.NUMERODOCUMENTO, 
  FLAN.HISTORICO,
  FCFO.NOME,
  FCFO.CGCCFO

) X

/*
SELECT 
STRING_AGG(CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN), CHAR(13)+CHAR(10)) HISTORICO,
STRING_AGG(CONCAT(FORMAT(X.VALORBAIXADO, 'C', 'pt-br'), CHAR(13)+CHAR(10), ''), CHAR(13)+CHAR(10)) VALORBAIXADO

FROM
(
SELECT FLAN.IDLAN, FLAN.NUMERODOCUMENTO, SUBSTRING(FLAN.HISTORICO, 1,35) HISTORICO, FLAN.VALORBAIXADO
FROM FLAN
WHERE FLAN.CODCOLIGADA = 1
AND FLAN.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDLAN = :IDLAN
)
)
) X
*/
";2651;;;;09/11/2022;robson.canto;0;1;1;1;;;;;3e213eb3-06e3-4d9d-ae0e-254537b36e68;;;12624;robson.canto;21/09/2022;robson.canto;09/11/2022;
F;FINREL00125;RECIBO BEMATECH - Lançamento;"Select 
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECDATABAIXA,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	Sum(RECVALORBAIXA) RECVALORBAIXA,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	dbo.dv_Recibo(RECCODIGO,RECIDSESSAO,RECNUMEROCAIXA,RECCODCXA,replace(replace(convert(varchar(20), VALORTOTAL, 0),'.',''),',',''),convert(varchar(10),getdate(),112)) RECdv_Recibo,
	
	RESPONSÁVEL,
	CNPJ

from (
	SELECT	
		/*	RECIBO	*/	
		L.IDLAN					RECCODIGO,
		L.HISTORICO				RECHISTORICO,
		F.IDINTEGRACAO			RECENTIDADE,
		l.DATAEMISSAO			RECDATAEMISSAO,
		l.DATABAIXA				RECDATABAIXA,
		SC.IDSESSAO				RECIDSESSAO,
		SC.NUMEROCAIXA			RECNUMEROCAIXA,
		SC.CODUSUARIOOPERADOR	RECUSUARIOOPERADOR,
		SC.CODCXA				RECCODCXA,
		cx.DESCRICAO			RECCDESCXA,
		FP.DESCFORMAPAGTO		RECFORMAPAGAMENTO,
		lb.VALORBAIXA			RECVALORBAIXA,
		/*(SELECT SUM(VALORBAIXA) FROM FLANBAIXA LBX WHERE LBX.IDLAN IN(:IDLAN) AND LBX.CODCOLIGADA = 1 AND LBX.STATUS <> 1) as VALORTOTAL,*/
		(SELECT 
		  SUM(VALORBAIXA) 
		 
		 FROM 
		  FLANBAIXA LBX 
		 
		 WHERE 	LBX.IDLAN IN(:IDLAN) 
		 	AND LBX.CODCOLIGADA = 1 
		 	AND LBX.STATUS <> 1
		 	AND CONVERT(VARCHAR(10), LBX.DATABAIXA, 103) = CONVERT(VARCHAR(10), :DATABAIXA, 103)
		 	) as VALORTOTAL,
	
		/*	FILIAL	*/
		F.CODFILIAL				FILCODG,
		F.NOME					FILNOME,
		F.CGC					FILCNPJ,
		F.RUA					FILENDERECO,
		F.NUMERO				FILENDERECONUMERO,
		F.BAIRRO				FILBAIRRO,
		F.CIDADE				FILCIDADE,
		F.ESTADO				FILESTADO,
		F.CEP					FILCEP,
		F.TELEFONE				FILTELEFONE,
		F.EMAIL					FILEMAIL,

		FCFO.NOME RESPONSÁVEL,
		FCFO.CGCCFO CNPJ,

		fx.*
	
	FROM FLAN L
	LEFT JOIN FLANBAIXA         LB  (NOLOCK)    ON L.CODCOLIGADA = LB.CODCOLIGADA AND L.IDLAN = LB.IDLAN 
	LEFT JOIN FCXA				CX	(NOLOCK)	ON cx.CODCOLIGADA = lb.CODCOLCXA and cx.CODCXA = lb.CODCXA
	LEFT JOIN FLOGSESSAOCAIXA   LSC (NOLOCK)    ON LSC.CODCOLIGADA = LB.CODCOLIGADA AND LSC.IDLAN = LB.IDLAN AND LSC.IDBAIXA = LB.IDBAIXA
	LEFT JOIN FSESSAOCAIXA       SC (NOLOCK)    ON SC.CODCOLCXA = CX.CODCOLIGADA AND SC.CODCXA = CX.CODCXA AND SC.IDSESSAO = lsc.IDSESSAO
    LEFT JOIN TFORMAPAGTO        FP (NOLOCK)    ON FP.CODCOLIGADA = LB.CODCOLIGADA AND FP.IDFORMAPAGTO = LB.IDFORMAPAGTO
	LEFT JOIN GFILIAL			 F	(NOLOCK)	ON F.CODCOLIGADA = L.CODCOLIGADA and F.CODFILIAL = L.CODFILIAL 
    LEFT JOIN FXCX				 fx	(NOLOCK)	on fx.CODCOLIGADA = LB.CODCOLIGADA and fx.IDXCX = LB.IDXCX 
	
    LEFT JOIN FCFO (NOLOCK)						ON FCFO.CODCOLIGADA = L.CODCOLIGADA AND
    											   FCFO.CODCFO = L.CODCFO

	WHERE 	
		L.IDLAN IN(:IDLAN)
		AND L.CODCOLIGADA = 1
		AND LB.STATUS <> 1
		AND CONVERT(VARCHAR(10), LB.DATABAIXA, 103) = CONVERT(VARCHAR(10), :DATABAIXA, 103)
		) x
Group by
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECDATABAIXA,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	RESPONSÁVEL,
	CNPJ";3226;;;;09/11/2022;robson.canto;0;1;1;1;;;;;4d93cbaf-f8a5-4587-8815-6e0af7cfc728;;;-8459;robson.canto;17/02/2022;robson.canto;09/11/2022;
F;FINREL00125A;RECIBO BEMATECH;"SELECT 
 STRING_AGG(CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN), CHAR(13)+CHAR(10)) HISTORICO,
 /*STRING_AGG(CONVERT(VARCHAR(MAX),CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN)), CHAR(13)+CHAR(10)) HISTORICO,*/
 STRING_AGG(CONCAT(FORMAT(X.VALORBAIXA, 'C', 'pt-br'), CHAR(13)+CHAR(10), ''), CHAR(13)+CHAR(10)) VALORBAIXADO

FROM
(SELECT 
  FLAN.IDLAN, 
  FLAN.NUMERODOCUMENTO, 
  SUBSTRING(FLAN.HISTORICO, 1,35) HISTORICO, 
  SUM(FLANBAIXA.VALORBAIXA) AS VALORBAIXA
 FROM 
  FLAN (NOLOCK)
  
  INNER JOIN FLANBAIXA (NOLOCK)	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
  								   FLANBAIXA.IDLAN = FLAN.IDLAN AND
  								   FLANBAIXA.STATUS = 0
  
 WHERE 	FLAN.CODCOLIGADA = 1
 	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), :DATABAIXA, 103)
	AND FLAN.IDLAN IN (SELECT DISTINCT
	  				    FLANBAIXA.IDLAN
					   
					   FROM 
					    FLANBAIXA (NOLOCK)
					    
					   WHERE FLANBAIXA.STATUS = 0
						 AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
						 								FLB.DATABAIXA /*FLB.IDTRANSACAO*/
														
													   FROM 
													    FLANBAIXA FLB (NOLOCK)
													    
													    INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   FL.IDLAN = FLB.IDLAN AND
																					   FL.CODCFO = FLAN.CODCFO

													   WHERE FLB.STATUS = 0
														 AND FLB.IDLAN = :IDLAN
														 AND FLB.RECCREATEDON >= DATEADD(MI,-10,FLANBAIXA.RECCREATEDON)
														 AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)
													  )
					  )
GROUP BY
	  FLAN.IDLAN, 
  FLAN.NUMERODOCUMENTO, 
  FLAN.HISTORICO
) X

/*
SELECT 
STRING_AGG(CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN), CHAR(13)+CHAR(10)) HISTORICO,
STRING_AGG(CONCAT(FORMAT(X.VALORBAIXADO, 'C', 'pt-br'), CHAR(13)+CHAR(10), ''), CHAR(13)+CHAR(10)) VALORBAIXADO

FROM
(
SELECT FLAN.IDLAN, FLAN.NUMERODOCUMENTO, SUBSTRING(FLAN.HISTORICO, 1,35) HISTORICO, FLAN.VALORBAIXADO
FROM FLAN
WHERE FLAN.CODCOLIGADA = 1
AND FLAN.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDLAN = :IDLAN
)
)
) X
*/
";2368;;;;21/09/2022;robson.canto;0;1;1;1;;;;;3e213eb3-06e3-4d9d-ae0e-254537b36e68;;;-18741;robson.canto;17/02/2022;robson.canto;21/09/2022;
F;FINREL00125B;RECIBO BEMATECH;"SELECT 
 STRING_AGG(X.DESCFORMAPAGTO, CHAR(13)+CHAR(10) ) DESCFORMAPAGTO, 
 STRING_AGG(FORMAT(X.VALORBAIXA, 'C', 'PT-BR'), CHAR(13)+CHAR(10) ) VALORBAIXADO

FROM
(SELECT 
  TFORMAPAGTO.DESCFORMAPAGTO,
  SUM(FLANBAIXA.VALORBAIXA) VALORBAIXA

 FROM 
  FLANBAIXA (NOLOCK), 
  TFORMAPAGTO (NOLOCK),
  FLAN (NOLOCK)
  
 WHERE TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
	AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
	
	AND FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
	
	AND FLANBAIXA.CODCOLIGADA = 1
	AND FLANBAIXA.STATUS = 0
	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), :DATABAIXA, 103)
	/*AND FLANBAIXA.IDLAN = :IDLAN*/
	AND FLANBAIXA.IDLAN IN (SELECT DISTINCT
							 FLANBAIXA.IDLAN
						   
						    FROM 
						     FLANBAIXA (NOLOCK)
						    
							WHERE 	FLANBAIXA.STATUS = 0
								AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
															   FLB.DATABAIXA /*FLB.IDTRANSACAO*/
															  
															  FROM 
															   FLANBAIXA FLB (NOLOCK)

													    	   INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   		   FL.IDLAN = FLB.IDLAN AND
																					   		   FL.CODCFO = FLAN.CODCFO

															  WHERE FLB.STATUS = 0
																AND FLB.IDLAN = :IDLAN
																AND FLB.RECCREATEDON >= DATEADD(MI,-10,FLANBAIXA.RECCREATEDON)
														 		AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)
															 )
						   )

GROUP BY TFORMAPAGTO.DESCFORMAPAGTO
) X

/*
SELECT 
STRING_AGG(X.DESCFORMAPAGTO, CHAR(13)+CHAR(10) ) DESCFORMAPAGTO, 
STRING_AGG(FORMAT(X.VALORBAIXA, 'C', 'PT-BR'), CHAR(13)+CHAR(10) ) VALORBAIXADO

FROM
(
SELECT TFORMAPAGTO.DESCFORMAPAGTO,
SUM(FLANBAIXA.VALORBAIXA) VALORBAIXA

FROM FLANBAIXA, TFORMAPAGTO
WHERE TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
AND FLANBAIXA.CODCOLIGADA = 1
AND FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA 
WHERE FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDLAN = :IDLAN
)
)

GROUP BY TFORMAPAGTO.DESCFORMAPAGTO
) X
*/";2637;;;;22/06/2022;consultor1.totvs;0;1;1;1;;;;;c1483060-32d8-44c3-98dd-c3bc16dd2206;;;17424;robson.canto;17/02/2022;consultor1.totvs;22/06/2022;
F;FINREL00125C;RECIBO BEMATECH;"SELECT 
 SUM(FLANBAIXA.VALORBAIXA) VALORBAIXADO

FROM 
 FLAN (NOLOCK)
 
 INNER JOIN FLANBAIXA (NOLOCK)	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 								   FLANBAIXA.IDLAN = FLAN.IDLAN AND 
 								   FLANBAIXA.STATUS = 0

WHERE 	FLAN.CODCOLIGADA = 1
	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), :DATABAIXA, 103)
	/*AND FLANBAIXA.IDLAN = :IDLAN*/
	AND FLAN.IDLAN IN (SELECT DISTINCT
					    FLANBAIXA.IDLAN
					  
					   FROM 
					    FLANBAIXA (NOLOCK)
					 
					   WHERE FLANBAIXA.STATUS = 0
						 AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
													    FLB.DATABAIXA /*FLB.IDTRANSACAO*/
			
													   FROM 
													    FLANBAIXA FLB (NOLOCK)
													  
													    INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   FL.IDLAN = FLB.IDLAN AND
																					   FL.CODCFO = FLAN.CODCFO

													  
													   WHERE FLB.STATUS = 0
														 AND FLB.IDLAN = :IDLAN
														 AND FLB.RECCREATEDON >= DATEADD(MI,-10,FLANBAIXA.RECCREATEDON)
														 AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)
													 )
					  )
/*
SELECT SUM(FLAN.VALORBAIXADO) VALORBAIXADO
FROM FLAN
WHERE FLAN.CODCOLIGADA = 1
AND FLAN.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDLAN = :IDLAN
)
)
*/";1569;;;;22/06/2022;consultor1.totvs;0;1;1;1;;;;;4da7a07a-ebb1-498f-8557-07163886dd01;;;-25744;robson.canto;17/02/2022;consultor1.totvs;22/06/2022;
F;FINREL00125D;RECIBO BEMATECH;"SELECT 
/*
 STRING_AGG(CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN), CHAR(13)+CHAR(10)) HISTORICO,
 STRING_AGG(CONCAT(FORMAT(X.VALORBAIXA, 'C', 'pt-br'), CHAR(13)+CHAR(10), ''), CHAR(13)+CHAR(10)) VALORBAIXADO
*/
 X.RESPONSAVEL,
 X.CNPJ,

 /*X.HISTORICO + ' Ref.: ' + CAST(X.IDLAN AS VARCHAR(10)) HISTORICO,*/
 X.HISTORICO HISTORICO,
 'Ref.: ' + CAST(X.IDLAN AS VARCHAR(10)) IDLAN,
 X.VALORBAIXA VALORBAIXADO
 
FROM
(SELECT 
  FLAN.IDLAN, 
  FLAN.NUMERODOCUMENTO, 
  FCFO.NOME RESPONSAVEL,
  FCFO.CGCCFO CNPJ,
  FLAN.HISTORICO HISTORICO, 
  SUM(FLANBAIXA.VALORBAIXA) AS VALORBAIXA
 FROM 
  FLAN (NOLOCK)
  
  INNER JOIN FLANBAIXA (NOLOCK)	ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
  								   FLANBAIXA.IDLAN = FLAN.IDLAN AND
  								   FLANBAIXA.STATUS = 0
  
  INNER JOIN FCFO (NOLOCK)		ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
  								   FCFO.CODCFO = FLAN.CODCFO								   

 WHERE 	FLAN.CODCOLIGADA = 1
 	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), :DATABAIXA, 103)
	AND FLAN.IDLAN IN (SELECT DISTINCT
	  				    FLANBAIXA.IDLAN
					   
					   FROM 
					    FLANBAIXA (NOLOCK)
					    
					   WHERE FLANBAIXA.STATUS = 0
						 AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
						 								FLB.DATABAIXA /*FLB.IDTRANSACAO*/
														
													   FROM 
													    FLANBAIXA FLB (NOLOCK)
													    
													    INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   FL.IDLAN = FLB.IDLAN AND
																					   FL.CODCFO = FLAN.CODCFO

													   WHERE FLB.STATUS = 0
														 AND FLB.IDLAN = :IDLAN1
														 AND FLB.RECCREATEDON >= DATEADD(MI,-10,FLANBAIXA.RECCREATEDON)
														 AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)
													  )
					  )
GROUP BY
	  FLAN.IDLAN, 
  FLAN.NUMERODOCUMENTO, 
  FLAN.HISTORICO,
  FCFO.NOME,
  FCFO.CGCCFO
  
) X

/*
SELECT 
STRING_AGG(CONCAT(X.HISTORICO, CHAR(13)+CHAR(10), 'Ref.:', X.IDLAN), CHAR(13)+CHAR(10)) HISTORICO,
STRING_AGG(CONCAT(FORMAT(X.VALORBAIXADO, 'C', 'pt-br'), CHAR(13)+CHAR(10), ''), CHAR(13)+CHAR(10)) VALORBAIXADO

FROM
(
SELECT FLAN.IDLAN, FLAN.NUMERODOCUMENTO, SUBSTRING(FLAN.HISTORICO, 1,35) HISTORICO, FLAN.VALORBAIXADO
FROM FLAN
WHERE FLAN.CODCOLIGADA = 1
AND FLAN.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND FLANBAIXA.IDLAN = :IDLAN
)
)
) X
*/
";2641;;;;09/11/2022;robson.canto;0;1;1;1;;;;;3e213eb3-06e3-4d9d-ae0e-254537b36e68;;;-27706;robson.canto;21/09/2022;robson.canto;09/11/2022;
F;FINREL00127B;RECIBO BEMATECH;"SELECT 
/* 
 STRING_AGG(X.DESCFORMAPAGTO, CHAR(13)+CHAR(10) ) DESCFORMAPAGTO,
 STRING_AGG(FORMAT(X.VALORBAIXA, 'C', 'PT-BR'), CHAR(13)+CHAR(10) ) VALORBAIXADO
*/
 X.DESCFORMAPAGTO DESCFORMAPAGTO, 
 X.VALORBAIXA VALORBAIXADO

FROM
(SELECT 
  TFORMAPAGTO.DESCFORMAPAGTO,
  SUM(FLANBAIXA.VALORBAIXA) VALORBAIXA

 FROM 
  FLANBAIXA (NOLOCK), 
  TFORMAPAGTO (NOLOCK),
  FLAN (NOLOCK)
  
 WHERE TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
	AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
	
	AND FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
	AND FLAN.IDLAN = FLANBAIXA.IDLAN
	
	AND FLANBAIXA.CODCOLIGADA = 1
	AND FLANBAIXA.STATUS = 0
	AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
	AND FLANBAIXA.IDLAN IN (SELECT DISTINCT
							 FLANBAIXA.IDLAN
						   
						    FROM 
						     FLANBAIXA (NOLOCK)
						    
							WHERE 	FLANBAIXA.STATUS = 0
								AND FLANBAIXA.DATABAIXA /*FLANBAIXA.IDTRANSACAO*/ IN (SELECT 
															   FLANBAIXA.DATABAIXA /*FLB.IDTRANSACAO*/
															  
															  FROM 
															   FLANBAIXA FLB (NOLOCK)

													    	   INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FLB.CODCOLIGADA AND
													    							   		   FL.IDLAN = FLB.IDLAN AND
																					   		   FL.CODCFO = FLAN.CODCFO

													   		  WHERE FLB.STATUS = 0
														 		AND FLB.IDLAN = :IDLAN
														 		AND FLB.RECCREATEDON >= FLANBAIXA.RECCREATEDON
														 		AND FLB.RECCREATEDON <= DATEADD(MI, 10, FLANBAIXA.RECCREATEDON)
															 )
						   )

GROUP BY TFORMAPAGTO.DESCFORMAPAGTO
) X

/*
SELECT 
STRING_AGG(X.DESCFORMAPAGTO, CHAR(13)+CHAR(10) ) DESCFORMAPAGTO, 
STRING_AGG(FORMAT(X.VALORBAIXA, 'C', 'PT-BR'), CHAR(13)+CHAR(10) ) VALORBAIXADO

FROM
(
SELECT TFORMAPAGTO.DESCFORMAPAGTO,
SUM(FLANBAIXA.VALORBAIXA) VALORBAIXA

FROM FLANBAIXA, TFORMAPAGTO
WHERE TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
AND FLANBAIXA.CODCOLIGADA = 1
AND FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDLAN IN(

SELECT DISTINCT(FLANBAIXA.IDLAN)
FROM FLANBAIXA 
WHERE FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDTRANSACAO IN (

SELECT FLANBAIXA.IDTRANSACAO
FROM FLANBAIXA
WHERE FLANBAIXA.STATUS = 0
AND CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) = CONVERT(VARCHAR(10), GETDATE(), 103)
AND FLANBAIXA.IDLAN = :IDLAN
)
)

GROUP BY TFORMAPAGTO.DESCFORMAPAGTO
) X
*/";2669;;;;21/09/2022;robson.canto;0;1;1;1;;;;;c1483060-32d8-44c3-98dd-c3bc16dd2206;;;1536;robson.canto;21/09/2022;robson.canto;21/09/2022;
F;FINREL0013;Fechamento de Caixa;"SELECT 
 GFILIAL.NOMEFANTASIA,
 FSESSAOCAIXA.DATAHORAABERTURA,
 FSESSAOCAIXA.DATAHORAFECHAMENTO,
 TFORMAPAGTO.DESCFORMAPAGTO , 
 SUM(FLANBAIXA.VALORBAIXA ) Valor

FROM 
 FXCX (NOLOCK)
 
 INNER JOIN FSESSAOCAIXA (NOLOCK)	ON FXCX.CODCOLIGADA = FSESSAOCAIXA.CODCOLIGADA AND 
 									   FXCX.IDSESSAO = FSESSAOCAIXA.IDSESSAO 
 			  
 INNER JOIN FLANBAIXA (NOLOCK)		ON FLANBAIXA.CODCOLIGADA = FXCX.CODCOLIGADA AND 
 									   FLANBAIXA.IDXCX = FXCX.IDXCX AND
 									   FLANBAIXA.IDFORMAPAGTO = FXCX.IDFORMAPAGTO AND
 									   FLANBAIXA.STATUS <> 1
 								   
 INNER JOIN TFORMAPAGTO (NOLOCK)	ON TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND 
 									   TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
 
 INNER JOIN GFILIAL (NOLOCK)		ON GFILIAL.CODCOLIGADA = FXCX.CODCOLIGADA AND
 									   GFILIAL.CODFILIAL = FXCX.CODFILIAL

WHERE FXCX.IDSESSAO = :IDSESSAO
AND   FXCX.CODCOLIGADA = :$CODCOLIGADA
AND fxcx.DATACANCELAMENTO IS NULL

GROUP BY TFORMAPAGTO.DESCFORMAPAGTO, FSESSAOCAIXA.DATAHORAABERTURA, FSESSAOCAIXA.DATAHORAFECHAMENTO, GFILIAL.NOMEFANTASIA";1100;;;;23/05/2022;robson.canto;0;1;1;1;;;;0;97df8fe0-2a27-42e7-8500-e76934275a85;0;;15562;mestre;01/07/2021;robson.canto;23/05/2022;0
F;FINREL0013.1;Fechamento de Caixa - Histórico;"SELECT DISTINCT FLAN.CODTDO,
                FTDO.DESCRICAO,
                 FSESSAOCAIXA.CODUSUARIOOPERADOR,
                Sum(FLANBAIXA.VALORBAIXA) VALOR
FROM   FXCX (NOLOCK)
       INNER JOIN FSESSAOCAIXA (NOLOCK)
               ON FXCX.CODCOLIGADA = FSESSAOCAIXA.CODCOLIGADA
                  AND FXCX.IDSESSAO = FSESSAOCAIXA.IDSESSAO
       INNER JOIN FLANBAIXA (NOLOCK)
               ON FLANBAIXA.CODCOLIGADA = FXCX.CODCOLIGADA
                  AND FLANBAIXA.IDXCX = FXCX.IDXCX
                  AND FLANBAIXA.IDFORMAPAGTO = FXCX.IDFORMAPAGTO
                  AND FLANBAIXA.STATUS <> 1
       LEFT JOIN FLAN (NOLOCK)
              ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
                 AND FLAN.IDLAN = FLANBAIXA.IDLAN
       LEFT JOIN FTDO (NOLOCK)
              ON FTDO.CODCOLIGADA = FLAN.CODCOLIGADA
                 AND FTDO.CODTDO = FLAN.CODTDO
       INNER JOIN GUSUARIO (NOLOCK)
               ON GUSUARIO.CODUSUARIO = FSESSAOCAIXA.CODUSUARIOOPERADOR
WHERE  FXCX.IDSESSAO = :IDSESSAO
       AND FXCX.CODCOLIGADA = :$CODCOLIGADA
       AND FXCX.DATACANCELAMENTO IS NULL
GROUP  BY FLAN.CODTDO,
          FTDO.DESCRICAO,
          FXCX.HISTORICO,
          FSESSAOCAIXA.CODUSUARIOOPERADOR 
";1240;;;;13/04/2022;marli.oliveira;0;1;1;1;;;;0;e3b7e6c7-9051-426d-8b42-ddaf5f104bcf;0;;28202;mestre;27/07/2021;marli.oliveira;13/04/2022;0
F;FINREL0013.2;Fechamento de Caixa - Sessão;"SELECT 
 FSESSAOCAIXA.IDSESSAO,
 FSESSAOCAIXA.DATAHORAABERTURA,
 FSESSAOCAIXA.DATAHORAFECHAMENTO

FROM 
 FSESSAOCAIXA (NOLOCK)	
 
WHERE FSESSAOCAIXA.IDSESSAO = :IDSESSAO
AND   FSESSAOCAIXA.CODCOLIGADA = :$CODCOLIGADA
/*AND fxcx.DATACANCELAMENTO IS NULL*/

";268;;;;31/05/2022;robson.canto;0;1;1;1;;;;0;97df8fe0-2a27-42e7-8500-e76934275a85;0;;-13538;robson.canto;31/05/2022;robson.canto;31/05/2022;0
F;FINREL0038.1;BOLETO BRADESCO - INFORMAÇÕES DO ALUNO;"SELECT DISTINCT
       FLANBOLETO.CODCOLIGADA,
       FLANBOLETO.IDBOLETO,
       FBOLETO.NOSSONUMERO,
       FBOLETO.VENCIMENTO,
       DATEADD(DAY, 30, FBOLETO.VENCIMENTO) as DATARECEBE,
       FBOLETO.DATAEMISSAO,
       ROUND( FBOLETO.VALOR * 0.0333/100,2) JUROSAODIA ,
       ROUND (FBOLETO.VALOR * 2/100,2) MULTA,
       SPARCELA.RA,
       SPARCELA.PARCELA,
       FBOLETO.VALOR,
       PPESSOA.NOME,
       PPESSOA.RUA + ', ' + PPESSOA.NUMERO AS RUA,
       PPESSOA.NUMERO,
       PPESSOA.COMPLEMENTO,
       PPESSOA.CEP,
       PPESSOA.BAIRRO,
       PPESSOA.ESTADO,
       PPESSOA.CIDADE + '-' + PPESSOA.ESTADO CIDADE,
       PPESSOA.CPF,
       SMATRICPL.CODFILIAL,
       SMATRICPL.CODTURMA,
	   FCFO.NOME			RESP_NOME,
	   FCFO.CGCCFO			RESP_CGC,
	   PL.CODPERLET,
	   
	   ISNULL(FCFO.RUA,'') + ', ' + ISNULL(FCFO.NUMERO,'') + ' - ' + ISNULL(FCFO.BAIRRO,'') + ' - Compl.: ' + ISNULL(FCFO.COMPLEMENTO,'') END_RESP,
	   
	   CASE WHEN SPARCELA.PARCELA IS NOT NULL THEN 'Parcela: ' + CAST(SPARCELA.PARCELA AS VARCHAR(2)) + ' - ' + PL.CODPERLET
	   		ELSE FLAN.HISTORICO END PARC


FROM 
 FBOLETO (NOLOCK)
 
 INNER JOIN FLANBOLETO (NOLOCK)	ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
                      			   AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO

 INNER JOIN FLAN (NOLOCK)		ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
                				   AND FLAN.IDLAN = FLANBOLETO.IDLAN

 LEFT JOIN SLAN (NOLOCK)		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                				   AND SLAN.IDLAN = FLAN.IDLAN  

 LEFT JOIN SPARCELA (NOLOCK)	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                    			   AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 

 LEFT JOIN SPLETIVO PL (NOLOCK)	ON PL.CODCOLIGADA = SPARCELA.CODCOLIGADA
 								   AND PL.IDPERLET = SPARCELA.IDPERLET

 LEFT JOIN SALUNO (NOLOCK)		ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  				   AND SALUNO.RA = SPARCELA.RA

 LEFT JOIN PPESSOA (NOLOCK)		ON PPESSOA.CODIGO = SALUNO.CODPESSOA    

 LEFT JOIN SMATRICPL (NOLOCK)	ON SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
                     			   AND SMATRICPL.RA = SALUNO.RA
                     			   AND SMATRICPL.IDPERLET = SPARCELA.IDPERLET

 INNER JOIN FCFO (NOLOCK)		ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO
								   AND FCFO.CODCFO = FLAN.CODCFO
                                                        
WHERE FLANBOLETO.CODCOLIGADA = :CODCOLIGADA
  AND FLANBOLETO.IDBOLETO = :IDBOLETO
   ";2493;;;;11/08/2022;robson.canto;0;1;1;1;;;;0;2deb1d31-61a1-414b-bd87-69f9bf48e228;0;;1233;mestre;21/01/2021;robson.canto;11/08/2022;0
F;FINREL0038.2;BOLETO BRADESCO - INF ULTIMAS PARCELAS;"SET LANGUAGE 'Brazilian'

SELECT DISTINCT TOP 6 FLAN.CODCOLIGADA,
       FLAN.DATAVENCIMENTO,
       /*FLAN.VALORORIGINAL,*/
       FLAN.STATUSLAN,
       DateName(Month,FLAN.DATAVENCIMENTO) + ' / ' + convert(varchar(04),DatePart(YEar,FLAN.DATAVENCIMENTO)) MES,
       CASE WHEN FLAN.STATUSLAN = 0 THEN 'Aberto'
            WHEN FLAN.STATUSLAN = 1 THEN 'Pago'
            WHEN FLAN.STATUSLAN = 2 THEN 'Cancelado'
            WHEN FLAN.STATUSLAN = 4 THEN 'Pago Parcial' END STATUS
       
       		 
  FROM FLANBOLETO
 INNER JOIN FLAN ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
                AND FLAN.IDLAN = FLANBOLETO.IDLAN
 INNER JOIN SLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                AND SLAN.IDLAN = FLAN.IDLAN  
 INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                    AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
 INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  AND SALUNO.RA = SPARCELA.RA
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA    
 INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
                     AND SMATRICPL.RA = SALUNO.RA
                     AND SMATRICPL.IDPERLET = SPARCELA.IDPERLET                                                           
 WHERE FLANBOLETO.CODCOLIGADA = :CODCOLIGADA1
   AND SPARCELA.RA = :RA2
   AND FLAN.DATAVENCIMENTO <= :VENCIMENTO3
ORDER BY FLAN.DATAVENCIMENTO DESC";1445;;;;09/06/2021;mestre;0;1;1;1;;;;0;2d4bc68d-8fd6-4655-9b9d-f2b7cb53458a;0;;-10893;mestre;21/01/2021;mestre;09/06/2021;0
F;FINREL0038.3;BOLETO BRADESCO - INF DEMONSTRATIVO MENSAL;"SELECT
 X.*
FROM
(
SELECT 1 SEQ,
	   FLAN.CODCOLIGADA,
	   FLAN.DATAEMISSAO,
	   FLAN.VALORORIGINAL,
	   FTDO.DESCRICAO,
       SMATRICPL.CODTURMA,
       CASE WHEN FLAN.PAGREC = 1 THEN 'D'
            ELSE 'C' END TIPO
  FROM FBOLETO
 INNER JOIN FLANBOLETO ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
                      AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
 INNER JOIN FLAN ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
                AND FLAN.IDLAN = FLANBOLETO.IDLAN
 INNER JOIN FTDO ON FTDO.CODCOLIGADA = FLAN.CODCOLIGADA
                AND FTDO.CODTDO = FLAN.CODTDO                

 INNER JOIN SLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                AND SLAN.IDLAN = FLAN.IDLAN  

 INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                    AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
                    
 INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  AND SALUNO.RA = SPARCELA.RA

 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA    
 
 INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
 						 SCONTRATO.RA = SPARCELA.RA AND
 						 SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND
 						 SCONTRATO.IDPERLET = SPARCELA.IDPERLET
 						 
 INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
                      	 SMATRICPL.RA = SPARCELA.RA AND 
                     	 SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND                                                          
                     	 SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

 WHERE FLANBOLETO.CODCOLIGADA = :CODCOLIGADA
   AND FLANBOLETO.IDBOLETO = :IDBOLETO

UNION ALL

SELECT 2 SEQ,
	   FLAN.CODCOLIGADA,
	   FLAN.DATAEMISSAO,
	   FLAN.VALORDESCONTO * -1 VALORORIGINAL,
	   'Desconto Incondicional' DESCRICAO,
       SMATRICPL.CODTURMA,
       'C' TIPO
  FROM FBOLETO
 INNER JOIN FLANBOLETO ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
                      AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
 INNER JOIN FLAN ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
                AND FLAN.IDLAN = FLANBOLETO.IDLAN
 INNER JOIN FTDO ON FTDO.CODCOLIGADA = FLAN.CODCOLIGADA
                AND FTDO.CODTDO = FLAN.CODTDO                
 INNER JOIN SLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                AND SLAN.IDLAN = FLAN.IDLAN  
 INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                    AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
 INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  AND SALUNO.RA = SPARCELA.RA
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA    

 INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
 						 SCONTRATO.RA = SPARCELA.RA AND
 						 SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND
 						 SCONTRATO.IDPERLET = SPARCELA.IDPERLET
 						 
 INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
                      	 SMATRICPL.RA = SPARCELA.RA AND 
                     	 SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND                                                          
                     	 SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
							                       
 WHERE FLANBOLETO.CODCOLIGADA = :CODCOLIGADA
   AND FLANBOLETO.IDBOLETO = :IDBOLETO
   AND FLAN.VALORDESCONTO > 0

UNION ALL

SELECT DISTINCT
       3 SEQ,
	   FLAN.CODCOLIGADA,
	   FLAN.DATAEMISSAO,
	   FLANINTEGRACAO.VALOR * -1 VALORORIGINAL,
	   FLANINTEGRACAODEF.DESCRICAO,
       SMATRICPL.CODTURMA,
       'C' TIPO
  FROM FBOLETO
 INNER JOIN FLANBOLETO ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
                      AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
 INNER JOIN FLAN ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
                AND FLAN.IDLAN = FLANBOLETO.IDLAN
 INNER JOIN FTDO ON FTDO.CODCOLIGADA = FLAN.CODCOLIGADA
                AND FTDO.CODTDO = FLAN.CODTDO                
 INNER JOIN SLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                AND SLAN.IDLAN = FLAN.IDLAN  
 INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                    AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
 INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  AND SALUNO.RA = SPARCELA.RA
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA    

 INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
 						 SCONTRATO.RA = SPARCELA.RA AND
 						 SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND
 						 SCONTRATO.IDPERLET = SPARCELA.IDPERLET
 						 
 INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
                      	 SMATRICPL.RA = SPARCELA.RA AND 
                     	 SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND                                                          
                     	 SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

 INNER JOIN FLANINTEGRACAO 	ON FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 							   FLANINTEGRACAO.IDLAN = FLAN.IDLAN /*AND
 							   FLANINTEGRACAO.IDCAMPO = 49*/
/*
 INNER JOIN SBOLSAALUNO 	ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 							   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 							   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 							   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
 INNER JOIN SBOLSA 			ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 							   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA
  */							   
 INNER JOIN FLANINTEGRACAODEF ON FLANINTEGRACAODEF.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA AND 
 								 FLANINTEGRACAODEF.IDCAMPO = FLANINTEGRACAO.IDCAMPO AND
 								 FLANINTEGRACAODEF.ACAO = 2 AND
 								 FLANINTEGRACAODEF.CODAPLICACAO = 'S' AND
 								 /*FLANINTEGRACAODEF.ATEVENCIMENTO = 0 AND*/
 								 FLANINTEGRACAODEF.IDCAMPO NOT IN (51, 53)
 
 WHERE FLANBOLETO.CODCOLIGADA = :CODCOLIGADA
   AND FLANBOLETO.IDBOLETO = :IDBOLETO

) X
ORDER BY X.SEQ


/*
SELECT FLAN.CODCOLIGADA,
	   FLAN.DATAEMISSAO,
	   FLAN.VALORORIGINAL,
	   FTDO.DESCRICAO,
       SMATRICPL.CODTURMA,
       CASE WHEN FLAN.PAGREC = 1 THEN 'D'
            ELSE 'C' END TIPO
  FROM FBOLETO
 INNER JOIN FLANBOLETO ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
                      AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
 INNER JOIN FLAN ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
                AND FLAN.IDLAN = FLANBOLETO.IDLAN
 INNER JOIN FTDO ON FTDO.CODCOLIGADA = FLAN.CODCOLIGADA
                AND FTDO.CODTDO = FLAN.CODTDO                
 INNER JOIN SLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                AND SLAN.IDLAN = FLAN.IDLAN  
 INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                    AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
 INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  AND SALUNO.RA = SPARCELA.RA
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA    
 INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
                     AND SMATRICPL.RA = SALUNO.RA
                     AND SMATRICPL.IDPERLET = SPARCELA.IDPERLET                                                           
 WHERE FLANBOLETO.CODCOLIGADA = :CODCOLIGADA
   AND FLANBOLETO.IDBOLETO = :IDBOLETO
*/";7419;;;;09/06/2021;mestre;0;1;1;1;;;;0;b0b6ac12-1878-467d-9488-49e79fa230e5;0;;-16958;mestre;21/01/2021;mestre;09/06/2021;0
F;FINREL0038.4;BOLETO BRADESCO - DESCONTO BOLSA;"SELECT

'ATENÇÃO Srs. Caixas, Considerar Desconto' ConsiderarDesconto,
'Valido até ' validade, 
fboleto.VENCIMENTO ,
SBOLSA.NOME , 
SBOLSALAN.VALOR

FROM FBOLETO

INNER JOIN FLANBOLETO ON
FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA AND
FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO

INNER JOIN FLAN ON
FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND
FLAN.IDLAN = FLANBOLETO.IDLAN

INNER JOIN SLAN ON
SLAN.IDLAN = FLAN.IDLAN AND
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA

INNER JOIN SPARCELA ON
SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND
SPARCELA.IDPARCELA = SLAN.IDPARCELA

LEFT JOIN SBOLSALAN ON
SBOLSALAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
SBOLSALAN.IDLAN = SLAN.IDLAN

LEFT JOIN SBOLSA ON
SBOLSALAN.CODBOLSA =  SBOLSA.CODBOLSA 



WHERE FBOLETO.CODCOLIGADA = :CODCOLIGADA 
AND FBOLETO.IDBOLETO = :IDBOLETO
AND SBOLSA.VALIDADELIMITADA = 0
AND SBOLSALAN.VALOR > 0

UNION ALL

SELECT 

'ATENÇÃO Srs. Caixas, Considerar Desconto' ConsiderarDesconto,
'Valido até ' validade, 
FLAN.DATAVENCIMENTO ,
'Desconto Especial ' NOME ,
(VALORORIGINAL - VALORDESCONTO) * 0.05  AS VALOR


FROM FLAN
	INNER JOIN FLANBOLETO B ON 
	B.CODCOLIGADA = FLAN.CODCOLIGADA AND 
	B.IDBOLETO = FLAN.IDBOLETO
	
	LEFT JOIN FLANINTEGRACAO C ON 
	C.IDLAN = FLAN.IDLAN AND 
	C.CODCOLIGADA = FLAN.CODCOLIGADA AND
	C.IDCAMPO = 48
	
	LEFT JOIN FLANINTEGRACAO I ON 
	I.IDLAN = FLAN.IDLAN AND 
	I.CODCOLIGADA = FLAN.CODCOLIGADA AND
	I.IDCAMPO = 49
	
	WHERE PAGREC = 1
	AND CODFILIAL = 4
	AND FLAN.DATAVENCIMENTO >= GETDATE()
	AND ISNULL(C.VALOR,0) = 0
	AND ISNULL(I.VALOR,0) = 0
	/*AND :FRM_99EAD = 0*/
	AND CODTDO <> 'SELETIVO'
	AND CODTDO <> 'TX'
	AND b.CODCOLIGADA = :CODCOLIGADA 
	AND b.IDBOLETO = :IDBOLETO
	
	AND FLAN.FORMULAVALOROP3 = 'Desc.Adi'
	
	

";1789;;;;08/06/2022;robson.canto;0;1;1;1;;;;0;56a05bb8-938d-42e3-912b-bfee6a740120;0;;31315;mestre;03/02/2021;robson.canto;08/06/2022;0
F;FINREL0039.1;BOLETO BRADESCO - INFORMAÇÕES DO ALUNO;"SELECT DISTINCT
       FLANBOLETO.CODCOLIGADA,
       FLANBOLETO.IDBOLETO,
       FBOLETO.NOSSONUMERO,
       FBOLETO.VENCIMENTO,
       DATEADD(DAY, 30, FBOLETO.VENCIMENTO) as DATARECEBE,
       FBOLETO.DATAEMISSAO,
       FBOLETO.JUROSAODIA,
       FBOLETO.MULTA,
       SPARCELA.RA,
       SPARCELA.PARCELA,
       FBOLETO.VALOR,
       SPSUSUARIO.NOME,
       SPSUSUARIO.RUA + ', ' + SPSUSUARIO.NUMERO AS RUA,
       SPSUSUARIO.NUMERO,
       SPSUSUARIO.COMPLEMENTO,
       SPSUSUARIO.CEP,
       SPSUSUARIO.BAIRRO,
       SPSUSUARIO.ESTADO,
       SPSUSUARIO.CIDADE + '-' + SPSUSUARIO.ESTADO CIDADE,
       SPSUSUARIO.CPF,
       SMATRICPL.CODFILIAL,
       SMATRICPL.CODTURMA,
	   FCFO.NOME			RESP_NOME,
	   FCFO.CGCCFO			RESP_CGC,
	   SPSAREAINTERESSE.NOME CURSO,
	   CASE WHEN FLAN.VALOROP4 > 0 THEN 'ATENÇÃO Srs. Caixas, Considerar Desconto'
	   	    ELSE '' END MENSAGEM,
	   GFILIAL.NOMEFANTASIA LOCAL 

FROM FBOLETO (NOLOCK)
   
   INNER JOIN FLANBOLETO (NOLOCK) ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
                    			     AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
                    			     
   INNER JOIN FLAN (NOLOCK)		  ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
                					 AND FLAN.IDLAN = FLANBOLETO.IDLAN
                					 
   LEFT JOIN SLAN (NOLOCK)		  ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                					 AND SLAN.IDLAN = FLAN.IDLAN  
                					 
   LEFT JOIN SPARCELA (NOLOCK)	  ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                    				 AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
                    				 
   LEFT JOIN SALUNO (NOLOCK)	  ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  	   			     AND SALUNO.RA = SPARCELA.RA
                  	   
   LEFT JOIN SMATRICPL (NOLOCK)	  ON SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
                     				 AND SMATRICPL.RA = SALUNO.RA
                     				 AND SMATRICPL.IDPERLET = SPARCELA.IDPERLET
                     				 
   INNER JOIN FCFO (NOLOCK)		  ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO
									 AND FCFO.CODCFO = FLAN.CODCFO
                
   LEFT JOIN SPSINSCRICAOAREAOFERTADA (NOLOCK)	ON FLAN.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND
   												   FLAN.IDLAN = SPSINSCRICAOAREAOFERTADA.IDLAN
   												   
   LEFT JOIN SPSOPCAOINSCRITO (NOLOCK)			ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
   												   SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
   												   SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO   												   
   
   LEFT JOIN SPSAREAINTERESSE (NOLOCK)			ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SPSOPCAOINSCRITO.CODCOLIGADA AND 
   												   SPSAREAINTERESSE.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
 
   LEFT JOIN SPSUSUARIO (NOLOCK)				ON SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
   
   INNER JOIN GFILIAL (NOLOCK)					ON FLAN.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
   												   FLAN.CODFILIAL = GFILIAL.CODFILIAL
   												   
   



WHERE FLANBOLETO.CODCOLIGADA = :CODCOLIGADA
   AND FLANBOLETO.IDBOLETO = :IDBOLETO



/*
SELECT DISTINCT
       FLANBOLETO.CODCOLIGADA,
       FLANBOLETO.IDBOLETO,
       FBOLETO.NOSSONUMERO,
       FBOLETO.VENCIMENTO,
       DATEADD(DAY, 30, FBOLETO.VENCIMENTO) as DATARECEBE,
       FBOLETO.DATAEMISSAO,
       FBOLETO.JUROSAODIA,
       FBOLETO.MULTA,
       SPARCELA.RA,
       SPARCELA.PARCELA,
       FBOLETO.VALOR,
       FCFO.NOME,
       FCFO.RUA + ', ' + FCFO.NUMERO AS RUA,
       FCFO.NUMERO,
       FCFO.COMPLEMENTO,
       FCFO.CEP,
       FCFO.BAIRRO,
       FCFO.CODETD ESTADO,
       FCFO.CIDADE + '-' + FCFO.CODETD CIDADE,
       FCFO.CGCCFO CPF,
       SMATRICPL.CODFILIAL,
       SMATRICPL.CODTURMA,
	   FCFO.NOME			RESP_NOME,
	   FCFO.CGCCFO			RESP_CGC,
	   SPSAREAINTERESSE.NOME CURSO 

  FROM 
   FBOLETO (NOLOCK)
   
   INNER JOIN FLANBOLETO (NOLOCK) ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
                    			     AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
                    			     
   INNER JOIN FLAN (NOLOCK)		  ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
                					 AND FLAN.IDLAN = FLANBOLETO.IDLAN
                					 
   LEFT JOIN SLAN (NOLOCK)		  ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
                					 AND SLAN.IDLAN = FLAN.IDLAN  
                					 
   LEFT JOIN SPARCELA (NOLOCK)	  ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
                    				 AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
                    				 
   LEFT JOIN SALUNO (NOLOCK)	  ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA
                  	   			     AND SALUNO.RA = SPARCELA.RA
                  	   
   LEFT JOIN PPESSOA (NOLOCK)	  ON PPESSOA.CODIGO = SALUNO.CODPESSOA    
 
   LEFT JOIN SMATRICPL (NOLOCK)	  ON SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
                     				 AND SMATRICPL.RA = SALUNO.RA
                     				 AND SMATRICPL.IDPERLET = SPARCELA.IDPERLET
                     				 
   INNER JOIN FCFO (NOLOCK)		  ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO
									 AND FCFO.CODCFO = FLAN.CODCFO
                
   LEFT JOIN SPSINSCRICAOAREAOFERTADA (NOLOCK)	ON FLAN.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND
   												   FLAN.IDLAN = SPSINSCRICAOAREAOFERTADA.IDLAN
   												   
   LEFT JOIN SPSOPCAOINSCRITO (NOLOCK)			ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
   												   SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
   												   SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO   												   
   
   LEFT JOIN SPSAREAINTERESSE (NOLOCK)			ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SPSOPCAOINSCRITO.CODCOLIGADA AND 
   												   SPSAREAINTERESSE.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
 
 WHERE FLANBOLETO.CODCOLIGADA = :CODCOLIGADA
   AND FLANBOLETO.IDBOLETO = :IDBOLETO
*/";6093;;;;09/06/2021;lucas.ssantos;0;1;1;1;;;;0;2deb1d31-61a1-414b-bd87-69f9bf48e228;0;;21721;mestre;05/05/2021;lucas.ssantos;09/06/2021;0
F;FLT.FIN001;Notas Origem e Destino vindo da FLAN;"SELECT 
	TMOVLAN.CODCOLIGADA,
	TMOVRELAC.IDMOVORIGEM,
	TORIGEM.CODTMV AS 'MOVIMENTO ORIGEM',
	TMOVRELAC.IDMOVDESTINO,
	TDESTINO.CODTMV AS 'MOVIMENTO DESTINO'
FROM TMOVLAN
LEFT JOIN TMOVRELAC ON TMOVRELAC.CODCOLORIGEM = TMOVLAN.CODCOLIGADA
	AND TMOVRELAC.IDMOVORIGEM = TMOVLAN.IDMOV
LEFT JOIN TMOV TORIGEM ON TORIGEM.CODCOLIGADA = TMOVLAN.CODCOLIGADA
	AND TORIGEM.IDMOV = TMOVLAN.IDMOV
LEFT JOIN TMOV TDESTINO ON TDESTINO.CODCOLIGADA = TMOVRELAC.CODCOLDESTINO
	AND TDESTINO.IDMOV = TMOVRELAC.IDMOVDESTINO
WHERE TMOVLAN.CODCOLIGADA = :$CODCOLIGADA
	AND TMOVLAN.IDLAN = :IDLAN";587;;;;23/06/2022;consultor1.totvs;0;1;1;1;;;;0;6a908900-6aee-4bbc-b9db-89b8be9a6e05;0;;30894;consultor1.totvs;23/06/2022;consultor1.totvs;23/06/2022;0
F;FVBaixaLanVouche;SQL Para Baixa de Lançamentos de Voucher;"SELECT 
isnull(l.idlan,1)
FROM SPSINSCAREAOFERTACOMPL

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO

INNER JOIN SPSOPCAOINSCRITO ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

LEFT JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

INNER JOIN  ZSVOUCHERDESCONTO ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 

WHERE  CAST( ZSVOUCHERDESCONTO.DATAVALFIM AS DATE) >= CAST(GETDATE () AS DATE)
AND  ((SCONTRATO.CODFILIAL IS NOT NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = ZSVOUCHERDESCONTO.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NULL) OR 
	  (ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL))
AND   (ZSVOUCHERDESCONTO.RA IS NULL OR ISNULL(SPARCELA.RA,0) = ZSVOUCHERDESCONTO.RA) 
AND   (ZSVOUCHERDESCONTO.CODCURSO IS NULL OR isnull(SHABILITACAOFILIAL.CODCURSO,'') = ZSVOUCHERDESCONTO.CODCURSO)
/*AND  ((SPARCELA.CODSERVICO IS NOT NULL AND ZSVOUCHERDESCONTO.CODSERVICO IS NOT NULL AND SPARCELA.CODSERVICO = ZSVOUCHERDESCONTO.CODSERVICO) OR
      (SPARCELA.CODSERVICO IS NULL AND ZSVOUCHERDESCONTO.CODSERVICO IS NULL) OR 
	  (ZSVOUCHERDESCONTO.CODSERVICO IS NOT NULL))
AND   (ZSVOUCHERDESCONTO.PARCELA IS NULL OR (ISNULL(SPARCELA.PARCELA,1) BETWEEN ZSVOUCHERDESCONTO.PARCELA AND ZSVOUCHERDESCONTO.PARCELAFIM))
*/
AND ZSVOUCHERDESCONTO.PERCDESCONTO = 100
AND   ((ZSVOUCHERDESCONTO.QUANTIDADE IS NULL) OR (ISNULL(ZSVOUCHERDESCONTO.QUANTIDADE,0) >= (

SELECT 
COUNT (ISNULL(FLAN.IDLAN,L.IDLAN)) TOTAL
FROM SPSINSCAREAOFERTACOMPL

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO

INNER JOIN SPSOPCAOINSCRITO ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO ON 
SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND 
SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

LEFT JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

INNER JOIN  ZSVOUCHERDESCONTO V ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = V.NUMEROVOUCHER 

WHERE ((SCONTRATO.CODFILIAL IS NOT NULL AND V.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = V.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND V.CODFILIAL IS NULL) OR 
	  (V.CODFILIAL IS NOT NULL))
AND   (V.RA IS NULL OR ISNULL(SPARCELA.RA,0) = V.RA) 
AND   (V.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = V.CODCURSO)
AND  ((SPARCELA.CODSERVICO IS NOT NULL AND V.CODSERVICO IS NOT NULL AND SPARCELA.CODSERVICO = V.CODSERVICO) OR
      (SPARCELA.CODSERVICO IS NULL AND V.CODSERVICO IS NULL) OR 
	  (V.CODSERVICO IS NOT NULL))
AND   (V.PARCELA IS NULL OR (ISNULL(SPARCELA.PARCELA,0) BETWEEN V.PARCELA AND V.PARCELAFIM))
AND   (ISNULL(V.QUANTIDADE,0) > 0)
AND   V.NUMEROVOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 
)))";5883;;;;10/06/2021;mestre;0;1;1;1;;;;0;b3e15fa4-98d2-4d8e-95d5-f21954de36f8;0;;11295;mestre;10/06/2021;mestre;10/06/2021;0
F;IMG.4;Imagem relatório;"SELECT IMAGEM FROM GIMAGEM (NOLOCK)
WHERE ID = :IDIMAGEM";;;;;;;0;1;1;1;;;;;;;12.1;10743;mestre;27/01/2021;mestre;27/01/2021;
F;IMG.6;Imagem relatório;"SELECT IMAGEM FROM GIMAGEM (NOLOCK)
WHERE ID = :IDIMAGEM";;;;;;;0;1;1;1;;;;;2d01d058-b2db-4e78-a4e7-c00a04b75000;;;12114;mestre;27/01/2021;mestre;10/08/2021;
F;IMG.7;Imagem relatório;"SELECT IMAGEM FROM GIMAGEM (NOLOCK)
WHERE ID = :IDIMAGEM";;;;;;;0;1;1;1;;;;;b56001e2-dddd-4082-98a6-ed653b9f6c29;;;31548;mestre;09/08/2021;mestre;09/08/2021;
F;IP001;Lançamentos Contábeis Excluídos;"SELECT
 CPARTIDA.IDLANCAMENTO,
 CPARTIDA.IDPARTIDA,
 CPARTIDA.LCTREF,
 CPARTIDA.DOCUMENTO,
 SUBSTRING(CPARTIDA.INTEGRACHAVE,2,10) IDLAN,
 CPARTIDA.DATA,
 CPARTIDA.CREDITO,
 CPARTIDA.DEBITO,
 (SELECT
   CCONTA.DESCRICAO
  FROM
   CCONTA (NOLOCK)
  WHERE CCONTA.CODCOLIGADA = CPARTIDA.CODCOLDEBITO
  	AND CCONTA.CODCONTA = CPARTIDA.DEBITO) DEBITO, 
 CPARTIDA.CREDITO,
 (SELECT
   CCONTA.DESCRICAO
  FROM
   CCONTA (NOLOCK)
  WHERE CCONTA.CODCOLIGADA = CPARTIDA.CODCOLCREDITO
  	AND CCONTA.CODCONTA = CPARTIDA.CREDITO) DEBITO, 
  
 CPARTIDA.CODHISTP,
 CHISTP.DESCRICAO,
 CPARTIDA.COMPLEMENTO,
 CPARTIDA.VALOR

FROM
 CPARTIDA (NOLOCK)
 
 INNER JOIN CHISTP (NOLOCK)		ON CHISTP.CODCOLIGADA = CPARTIDA.CODCOLIGADA AND 
 								   CHISTP.CODHISTP = CPARTIDA.CODHISTP 
  								   
WHERE	CPARTIDA.CODCOLIGADA = 1
	AND CPARTIDA.CODLOTE = 0								   
	/*AND CPARTIDA.DOCUMENTO = :Documento*/
	AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,10) = :IDLAN";972;;;;02/02/2022;robson.canto;0;1;1;1;;;;1;76bbda13-ff58-472f-ba59-4f05e96d14de;0;;6296;robson.canto;02/02/2022;robson.canto;02/02/2022;0
F;PVT.001;FLT.0001 - Baixados Gerados por Acordo;"SELECT DISTINCT FLANBAIXA.IDBAIXA 
FROM FLAN (NOLOCK)
INNER JOIN FTDO (NOLOCK)
ON FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
AND FLAN.CODTDO = FTDO.CODTDO
INNER JOIN FLANBAIXA (NOLOCK)
ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN SLAN (NOLOCK)
ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
AND FLAN.IDLAN = SLAN.IDLAN
INNER JOIN COPERACAO (NOLOCK)
ON FLANBAIXA.CODCOLIGADA = COPERACAO.CODCOLIGADA
AND FLANBAIXA.IDOPERACAO = COPERACAO.IDOPERACAO

WHERE 
FLAN.DATABAIXA BETWEEN :DataIni_D AND :DataFIm_D
AND FLAN.CLASSIFICACAO = 15
AND FLAN.STATUSLAN IN (1,4)
/*AND FLAN.BAIXAPENDENTE = 0*/
";638;;;;06/03/2022;marli.oliveira;0;1;1;1;;;;0;ade1e626-67f1-4591-a6c3-2d8deb0a6068;0;;5881;marli.oliveira;03/03/2022;marli.oliveira;10/03/2022;0
F;PVT.002;FLT.0001 - Recontabilização;"SELECT FLANBAIXA.IDBAIXA 
FROM FLAN (NOLOCK)
INNER JOIN FTDO (NOLOCK)
ON FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
AND FLAN.CODTDO = FTDO.CODTDO
INNER JOIN FLANBAIXA (NOLOCK)
ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN SLAN (NOLOCK)
ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
AND FLAN.IDLAN = SLAN.IDLAN
INNER JOIN COPERACAO (NOLOCK)
ON FLANBAIXA.CODCOLIGADA = COPERACAO.CODCOLIGADA
AND FLANBAIXA.IDOPERACAO = COPERACAO.IDOPERACAO

INNER JOIN CCONT (NOLOCK)
ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO

INNER JOIN CPARTIDA (NOLOCK)
ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA

WHERE FLAN.CODCOLIGADA = 1
AND CPARTIDA.CREDITO = '4.1.01.01.0001'
AND CPARTIDA.CODLOTE > 0
AND CPARTIDA.DATA >= '2021-01-01'
/* AND CPARTIDA.DATA BETWEEN :DataIni_D AND :DataFIm_D */
AND CPARTIDA.TIPOGERACAO = 'O'

AND FLAN.STATUSLAN IN (1,4)
AND FLAN.CLASSIFICACAO = 0

AND FLAN.BAIXAPENDENTE = 0
AND FTDO.CODEVENTOBX = 174
/* AND FLANBAIXA.VALORORIGINAL - FLANBAIXA.VALOROP1 > 0 */
";1118;;;;06/03/2022;marli.oliveira;0;1;1;1;;;;0;ed6d0aa7-4285-4b3e-862d-4c041527e85f;0;;737;marli.oliveira;06/03/2022;marli.oliveira;06/03/2022;0
F;PVT.003;FLT.0003 - REFERENCIAS COM CONTABILIZAÇÃO;"SELECT FLAN.IDLAN
FROM   FLAN (NOLOCK)
       LEFT JOIN FCXA (NOLOCK)
              ON FLAN.CODCOLCXA = FCXA.CODCOLIGADA
                 AND FLAN.CODCXA = FCXA.CODCXA
       INNER JOIN SLAN (NOLOCK)
               ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
                  AND FLAN.IDLAN = SLAN.IDLAN
       INNER JOIN COPERACAO COPERACAO
               ON FLAN.CODCOLIGADA = COPERACAO.CODCOLIGADA
                  AND FLAN.IDOPERACAO = COPERACAO.IDOPERACAO
       INNER JOIN CCONT (NOLOCK)
               ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
                  AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO
       INNER JOIN CPARTIDA (NOLOCK)
               ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
                  AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA
WHERE  FLAN.IDLAN IN (2002269, 200303, 200363, 200441) 
";841;;;;26/04/2022;marli.oliveira;0;1;1;1;;;;0;c71a4206-5e2f-488b-b35f-ec3947031fc8;0;;4152;marli.oliveira;08/03/2022;marli.oliveira;26/04/2022;0
F;PVT.004;FLT.0004 - Baixas do Acordo;"SELECT DISTINCT FLANBAIXA.IDBAIXA 
FROM FLAN (NOLOCK)
INNER JOIN FTDO (NOLOCK)
ON FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
AND FLAN.CODTDO = FTDO.CODTDO
INNER JOIN FLANBAIXA (NOLOCK)
ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
AND FLAN.IDLAN = FLANBAIXA.IDLAN
LEFT JOIN SLAN (NOLOCK)
ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
AND FLAN.IDLAN = SLAN.IDLAN
LEFT JOIN COPERACAO (NOLOCK)
ON FLANBAIXA.CODCOLIGADA = COPERACAO.CODCOLIGADA
AND FLANBAIXA.IDOPERACAO = COPERACAO.IDOPERACAO
WHERE 
FLAN.DATABAIXA BETWEEN :DataIni_D AND :DataFIm_D
AND FLAN.STATUSLAN IN (3)
AND FLAN.CLASSIFICACAO = 0


";603;;;;31/03/2022;marli.oliveira;0;1;1;1;;;;0;ade1e626-67f1-4591-a6c3-2d8deb0a6068;0;;-28441;marli.oliveira;10/03/2022;marli.oliveira;31/03/2022;0
F;PVT.005;Contabilização Tela de lançamentos;"SELECT 'INCLUSÃO' TIPO
, DEBITO, CCONTADEBITO.DESCRICAO AS 'DESCRICACODEBITO'
, CREDITO, CCONTACREDITO.DESCRICAO AS 'DESCRICACOCREDITO'
, CASE 
	WHEN DEBITO IS NOT NULL THEN VALOR
	ELSE VALOR
END VALOR
, CPARTIDA.CODLOTE
, CPARTIDA.DATA
, CPARTIDA.IDLANCAMENTO
, CPARTIDA.IDPARTIDA
, CPARTIDA.CODCOLIGADA
FROM CPARTIDA (NOLOCK)
LEFT JOIN CCONTA CCONTADEBITO (NOLOCK)
ON CPARTIDA.CODCOLDEBITO = CCONTADEBITO.CODCOLIGADA
AND CPARTIDA.DEBITO = CCONTADEBITO.CODCONTA
LEFT JOIN CCONTA CCONTACREDITO (NOLOCK)
ON CPARTIDA.CODCOLCREDITO = CCONTACREDITO.CODCOLIGADA
AND CPARTIDA.CREDITO = CCONTACREDITO.CODCONTA
WHERE CPARTIDA.CODCOLIGADA = :$CODCOLIGADA
AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1) = 'I'
AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,10) = :IDLAN

UNION ALL

SELECT 'ESTORNO-INCLUSÃO' TIPO
, DEBITO, CCONTADEBITO.DESCRICAO AS 'DESCRICACODEBITO'
, CREDITO, CCONTACREDITO.DESCRICAO AS 'DESCRICACOCREDITO'
, CASE 
	WHEN DEBITO IS NOT NULL THEN VALOR
	ELSE VALOR
END VALOR
, CPARTIDA.CODLOTE
, CPARTIDA.DATA
, CPARTIDA.IDLANCAMENTO
, CPARTIDA.IDPARTIDA
, CPARTIDA.CODCOLIGADA
FROM CPARTIDA (NOLOCK)
LEFT JOIN CCONTA CCONTADEBITO (NOLOCK)
ON CPARTIDA.CODCOLDEBITO = CCONTADEBITO.CODCOLIGADA
AND CPARTIDA.DEBITO = CCONTADEBITO.CODCONTA
LEFT JOIN CCONTA CCONTACREDITO (NOLOCK)
ON CPARTIDA.CODCOLCREDITO = CCONTACREDITO.CODCOLIGADA
AND CPARTIDA.CREDITO = CCONTACREDITO.CODCONTA
WHERE CPARTIDA.CODCOLIGADA = :$CODCOLIGADA
AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,2) = 'EI'
AND SUBSTRING(CPARTIDA.INTEGRACHAVE,3,10) = :IDLAN


UNION ALL

SELECT 'BAIXA' TIPO
, DEBITO, CCONTADEBITO.DESCRICAO AS 'DESCRICACODEBITO'
, CREDITO, CCONTACREDITO.DESCRICAO AS 'DESCRICACOCREDITO'
, CASE 
	WHEN DEBITO IS NOT NULL THEN VALOR
	ELSE VALOR
END VALOR
, CPARTIDA.CODLOTE
, CPARTIDA.DATA
, CPARTIDA.IDLANCAMENTO
, CPARTIDA.IDPARTIDA
, CPARTIDA.CODCOLIGADA
FROM CPARTIDA (NOLOCK)
LEFT JOIN CCONTA CCONTADEBITO (NOLOCK)
ON CPARTIDA.CODCOLDEBITO = CCONTADEBITO.CODCOLIGADA
AND CPARTIDA.DEBITO = CCONTADEBITO.CODCONTA
LEFT JOIN CCONTA CCONTACREDITO (NOLOCK)
ON CPARTIDA.CODCOLCREDITO = CCONTACREDITO.CODCOLIGADA
AND CPARTIDA.CREDITO = CCONTACREDITO.CODCONTA
WHERE CPARTIDA.CODCOLIGADA = :$CODCOLIGADA
AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1) = 'B'
AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,10) = :IDLAN

UNION ALL

SELECT 'ESTORNO-BAIXA' TIPO
, DEBITO, CCONTADEBITO.DESCRICAO AS 'DESCRICACODEBITO'
, CREDITO, CCONTACREDITO.DESCRICAO AS 'DESCRICACOCREDITO'
, CASE 
	WHEN DEBITO IS NOT NULL THEN VALOR
	ELSE VALOR
END VALOR
, CPARTIDA.CODLOTE
, CPARTIDA.DATA
, CPARTIDA.IDLANCAMENTO
, CPARTIDA.IDPARTIDA
, CPARTIDA.CODCOLIGADA
FROM CPARTIDA (NOLOCK)
LEFT JOIN CCONTA CCONTADEBITO (NOLOCK)
ON CPARTIDA.CODCOLDEBITO = CCONTADEBITO.CODCOLIGADA
AND CPARTIDA.DEBITO = CCONTADEBITO.CODCONTA
LEFT JOIN CCONTA CCONTACREDITO (NOLOCK)
ON CPARTIDA.CODCOLCREDITO = CCONTACREDITO.CODCOLIGADA
AND CPARTIDA.CREDITO = CCONTACREDITO.CODCONTA
WHERE CPARTIDA.CODCOLIGADA = :$CODCOLIGADA
AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,2) = 'EB'
AND SUBSTRING(CPARTIDA.INTEGRACHAVE,3,10) = :IDLAN
";3123;;;;08/03/2022;marli.oliveira;0;1;1;1;;;;0;e9a5e606-f54d-4196-b7f8-9a53c0163bba;0;;9291;marli.oliveira;08/03/2022;marli.oliveira;08/03/2022;0
F;PVT.006;FLT.00010 - Lançamentos Contabilização - Inclusao Lote Zero;"SELECT FLAN.IDLAN
FROM   FLAN (NOLOCK)
       LEFT JOIN FCXA (NOLOCK)
              ON FLAN.CODCOLCXA = FCXA.CODCOLIGADA
                 AND FLAN.CODCXA = FCXA.CODCXA
       INNER JOIN SLAN (NOLOCK)
               ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
                  AND FLAN.IDLAN = SLAN.IDLAN
       INNER JOIN COPERACAO COPERACAO
               ON FLAN.CODCOLIGADA = COPERACAO.CODCOLIGADA
                  AND FLAN.IDOPERACAO = COPERACAO.IDOPERACAO
       INNER JOIN CCONT (NOLOCK)
               ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
                  AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO
       INNER JOIN CPARTIDA (NOLOCK)
               ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
                  AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA
WHERE  FLAN.CODCOLIGADA = 1
       /*AND CPARTIDA.CREDITO = '2.1.11.01.0001'*/
       AND CPARTIDA.CODLOTE = 0
       AND CPARTIDA.DATA >= '2022-01-01'
       AND CPARTIDA.DATA BETWEEN :DataIni_D AND :DataFIm_D
       AND FLAN.STATUSLAN <> 2 
";1033;;;;15/03/2022;marli.oliveira;0;1;1;1;;;;0;88eefe0e-e29d-4e2f-8ab7-04bfaeb34db1;0;;-8703;marli.oliveira;15/03/2022;marli.oliveira;16/03/2022;0
F;PVT.007;FLT.00011 - Baixa de Lançamentos Contabilizacao - Inclusao Lote Zero;"SELECT DISTINCT FLANBAIXA.IDBAIXA 
FROM FLAN (NOLOCK)
INNER JOIN FTDO (NOLOCK)
ON FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
AND FLAN.CODTDO = FTDO.CODTDO
INNER JOIN FLANBAIXA (NOLOCK)
ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN SLAN (NOLOCK)
ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
AND FLAN.IDLAN = SLAN.IDLAN
INNER JOIN COPERACAO (NOLOCK)
ON FLANBAIXA.CODCOLIGADA = COPERACAO.CODCOLIGADA
AND FLANBAIXA.IDOPERACAO = COPERACAO.IDOPERACAO

INNER JOIN CCONT (NOLOCK)
ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO

INNER JOIN CPARTIDA (NOLOCK)
ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA

WHERE FLAN.CODCOLIGADA = 1
/*AND CPARTIDA.CREDITO = '4.1.01.01.0001'*/
AND CPARTIDA.CODLOTE  = 0
AND CPARTIDA.DATA >= '2022-01-01'
AND CPARTIDA.DATA BETWEEN :DataIni_D AND :DataFIm_D
AND CPARTIDA.TIPOGERACAO = 'O'
AND FLAN.STATUSLAN IN (1,4)
AND FLAN.CLASSIFICACAO = 0
AND FLAN.BAIXAPENDENTE = 0
";1034;;;;16/03/2022;marli.oliveira;0;1;1;1;;;;0;88eefe0e-e29d-4e2f-8ab7-04bfaeb34db1;0;;28054;marli.oliveira;16/03/2022;marli.oliveira;16/03/2022;0
F;PVT.008;FLT.00012 - Baixa de Lançamentos Contabilizacao - Inclusao Lote Intermediário;"SELECT DISTINCT FLANBAIXA.IDBAIXA 
FROM FLAN (NOLOCK)
INNER JOIN FTDO (NOLOCK)
ON FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
AND FLAN.CODTDO = FTDO.CODTDO
INNER JOIN FLANBAIXA (NOLOCK)
ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN SLAN (NOLOCK)
ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
AND FLAN.IDLAN = SLAN.IDLAN
INNER JOIN COPERACAO (NOLOCK)
ON FLANBAIXA.CODCOLIGADA = COPERACAO.CODCOLIGADA
AND FLANBAIXA.IDOPERACAO = COPERACAO.IDOPERACAO

INNER JOIN CCONT (NOLOCK)
ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO

INNER JOIN CPARTIDA (NOLOCK)
ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA

WHERE FLAN.CODCOLIGADA = 1
/*AND CPARTIDA.CREDITO = '4.1.01.01.0001'*/
AND CPARTIDA.CODLOTE  > 0
AND CPARTIDA.DATA >= '2022-01-01'
AND CPARTIDA.DATA BETWEEN :DataIni_D AND :DataFIm_D
AND CPARTIDA.TIPOGERACAO = 'O'
AND FLAN.STATUSLAN IN (1,4)
AND FLAN.CLASSIFICACAO = 0
/*AND FLAN.BAIXAPENDENTE = 0*/
";1038;;;;16/03/2022;marli.oliveira;0;1;1;1;;;;0;88eefe0e-e29d-4e2f-8ab7-04bfaeb34db1;0;;9571;marli.oliveira;16/03/2022;marli.oliveira;16/03/2022;0
F;PVT.009;FLT.00013 - Baixa de Lançamentos Contabilizacao - Inclusão Lote Intermediario com Estorno;"SELECT FLANBAIXA.IDBAIXA 
FROM FLAN (NOLOCK)
INNER JOIN FTDO (NOLOCK)
ON FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
AND FLAN.CODTDO = FTDO.CODTDO
INNER JOIN FLANBAIXA (NOLOCK)
ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN SLAN (NOLOCK)
ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
AND FLAN.IDLAN = SLAN.IDLAN
INNER JOIN COPERACAO (NOLOCK)
ON FLANBAIXA.CODCOLIGADA = COPERACAO.CODCOLIGADA
AND FLANBAIXA.IDOPERACAO = COPERACAO.IDOPERACAO

INNER JOIN CCONT (NOLOCK)
ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO

INNER JOIN CPARTIDA (NOLOCK)
ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA

WHERE FLAN.CODCOLIGADA = 1
/*AND CPARTIDA.CREDITO = '4.1.01.01.0001'*/
AND CPARTIDA.CODLOTE > 0
AND CPARTIDA.DATA >= '2022-01-01'
AND CPARTIDA.DATA BETWEEN :DataIni_D AND :DataFIm_D
AND CPARTIDA.TIPOGERACAO = 'E'
AND FLAN.STATUSLAN IN (1,4)
AND FLAN.CLASSIFICACAO = 0
AND FLAN.BAIXAPENDENTE = 0
/*AND FTDO.CODEVENTOBX = 174*/
/* AND FLANBAIXA.VALORORIGINAL - FLANBAIXA.VALOROP1 > 0 */";1114;;;;16/03/2022;marli.oliveira;0;1;1;1;;;;0;f8e27b70-2700-4f24-9ee7-35d46973f1d8;0;;2540;marli.oliveira;16/03/2022;marli.oliveira;16/03/2022;0
F;PVT.010;FLT.00014 - Lançamentos sem Contabilização de Inclusão;"/*
DECLARE :DATA_INICIAL_D DATE;  SET :DATA_INICIAL_D = '20210101'
DECLARE :DATA_FINAL_D DATE;  SET :DATA_FINAL_D = GETDATE()
*/

SELECT DISTINCT FL.IDLAN
FROM FLAN FL (NOLOCK) 
LEFT JOIN FTDO FT (NOLOCK) ON FT.CODCOLIGADA = FL.CODCOLIGADA AND FT.CODTDO = FL.CODTDO
LEFT JOIN COPERACAO CO (NOLOCK) ON FL.CODCOLIGADA = CO.CODCOLIGADA AND FL.IDOPERACAO = CO.IDOPERACAO
LEFT JOIN CCONT CC     (NOLOCK) ON CO.CODCOLIGADA = CC.CODCOLIGADA AND CO.IDOPERACAO = CC.IDOPERACAO
LEFT JOIN CPARTIDA CP  (NOLOCK) ON CC.CODCOLIGADA = CP.CODCOLIGADA AND CC.IDPARTIDA = CP.IDPARTIDA
WHERE FL.STATUSLAN <> 2                   /* NÃO CANCELADO */
      AND FL.TIPOCONTABILLAN = 1          /* CONTABIL */
	  AND FT.CODEVENTO IS NOT NULL        /* QUE INDIQUE UM EVENTO PARA CONTABILIZAR A INCLUSAO */
      AND CP.DATA IS NULL                 /* SEM CONTABILIZAÇAO DA INCLUSÃO */ 
	  AND FL.MESDECOMPETENCIA BETWEEN :DATA_INICIAL_D AND :DATA_FINAL_D  /* NO PERIODO DE COMPETENCIA DO LANÇAMENTO */";992;;;;12/04/2022;marli.oliveira;0;1;1;1;;;;0;38dd3710-3d42-41cf-bedf-b98c5f7b49f0;0;;23161;marli.oliveira;17/03/2022;marli.oliveira;12/04/2022;0
F;PVT.011;FLT.00014 - Lançamentos sem Contabilização de Baixa;"SELECT DISTINCT FLANBAIXA.IDBAIXA 
FROM FLAN (NOLOCK) 
INNER JOIN FTDO (NOLOCK) ON FLAN.CODCOLIGADA = FTDO.CODCOLIGADA AND FLAN.CODTDO = FTDO.CODTDO
INNER JOIN FLANBAIXA (NOLOCK) ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND FLAN.IDLAN = FLANBAIXA.IDLAN
INNER JOIN SLAN (NOLOCK) ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND FLAN.IDLAN = SLAN.IDLAN 
INNER JOIN COPERACAO (NOLOCK) ON FLANBAIXA.CODCOLIGADA = COPERACAO.CODCOLIGADA AND FLANBAIXA.IDOPERACAO = COPERACAO.IDOPERACAO
INNER JOIN CCONT (NOLOCK) ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO
INNER JOIN CPARTIDA (NOLOCK) ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA
WHERE FLAN.CODCOLIGADA = 1
AND CPARTIDA.CODLOTE  = 0
AND CPARTIDA.DATA BETWEEN :DataIni_D AND :DataFIm_D
AND CPARTIDA.TIPOGERACAO = 'O'
AND FLAN.STATUSLAN <> 2";876;;;;12/04/2022;marli.oliveira;0;1;1;1;;;;0;38dd3710-3d42-41cf-bedf-b98c5f7b49f0;0;;-2880;marli.oliveira;12/04/2022;marli.oliveira;12/04/2022;0
F;PVT.012;NOSSO NUMERO;"SELECT FCFO.NOMEFANTASIA
, FCFO.CGCCFO
, FBOLETO.VENCIMENTO
, FBOLETO.NOSSONUMERO
, FBOLETO.RECCREATEDON
, FBOLETO.VALOR
, FBOLETO.NUMERODOCUMENTO
, ISNULL ( DTIPORUA.DESCRICAO, '' ) + ' ' + ISNULL ( FCFO.RUA, '' ) + ', ' + ISNULL ( FCFO.NUMERO, '' ) + ', ' + ISNULL (FCFO.BAIRRO,'') + ', ' + REPLACE(ISNULL ( FCFO.COMPLEMENTO, '' ),'APTO','AP') AS LOGRADOURO
, FCFO.CEP + ', ' + ISNULL ( FCFO.CIDADE, '' ) + '/ ' + ISNULL ( FCFO.CODETD, '' ) ENDERECO
, FBOLETO.CODIGOBARRA
, SUBSTRING(FBOLETO.IPTE,1,5) + '.' + SUBSTRING(FBOLETO.IPTE,6,5) + ' ' + SUBSTRING(FBOLETO.IPTE,11,5) + '.' + SUBSTRING(FBOLETO.IPTE,16,6) + ' ' + SUBSTRING(FBOLETO.IPTE,22,5) + '.' + SUBSTRING(FBOLETO.IPTE,27,6) + ' ' + SUBSTRING(FBOLETO.IPTE,33,1)+ ' ' + SUBSTRING(FBOLETO.IPTE,34,14) AS IPTE
, FCONVENIO.CODCEDENTE
, FCONTA.NUMAGENCIA + ISNULL('-' + GAGENCIA.DIGAG,'') + ' / ' + FCONVENIO.CODCEDENTE + '-' + ISNULL(FCONVENIO.DIGCEDENTE,'') AS AGENCIA_CEDENTE
, FCONVENIO.CARTEIRA
, GFILIAL.NOME
, GFILIAL.CGC
, FLAN.SEGUNDONUMERO
, FCONVENIO.CARTEIRA+'/'+SUBSTRING(FBOLETO.NOSSONUMERO,1,11)+'-'+SUBSTRING(FBOLETO.NOSSONUMERO,12,1) AS NOSSO_NUMERO
FROM FLAN
JOIN FCFO ON FLAN.CODCOLCFO = FCFO.CODCOLIGADA AND FLAN.CODCFO = FCFO.CODCFO
JOIN FBOLETO ON FLAN.CODCOLIGADA = FBOLETO.CODCOLIGADA AND FLAN.IDBOLETO = FBOLETO.IDBOLETO
LEFT JOIN DTIPORUA ON FCFO.TIPORUA = DTIPORUA.CODIGO
JOIN FCONVENIO ON FBOLETO.CODCOLIGADA = FCONVENIO.CODCOLIGADA AND FBOLETO.IDCONVENIO = FCONVENIO.IDCONVENIO
JOIN FCONTA ON FCONVENIO.CODCOLIGADA = FCONTA.CODCOLIGADA AND FCONVENIO.NUMBANCO = FCONTA.NUMBANCO AND FCONVENIO.NUMAGENCIA = FCONTA.NUMAGENCIA AND FCONVENIO.NROCONTA = FCONTA.NROCONTA
JOIN GFILIAL ON FLAN.CODCOLIGADA = GFILIAL.CODCOLIGADA AND FLAN.CODFILIAL = GFILIAL.CODFILIAL
JOIN GAGENCIA ON FCONVENIO.NUMBANCO = GAGENCIA.NUMBANCO AND FCONVENIO.NUMAGENCIA = GAGENCIA.NUMAGENCIA



WHERE 1=1
AND FBOLETO.CODCOLIGADA = :CODCOLIGADA
AND FBOLETO.IDBOLETO = :IDBOLETO";1962;;;;26/04/2022;consultor1.totvs;0;1;1;1;;;;0;0b25ae09-40f3-4bb0-9b74-927c0025eb58;0;;-10563;marli.oliveira;20/04/2022;consultor1.totvs;26/04/2022;0
F;PVT.013;REFERENCIAS FINANCEIRAS;"SELECT FLAN.IDLAN
FROM   FLAN
WHERE  FLAN.IDLAN IN ( 80553, 79789, 79162, 78406,
                       66886, 66140, 53529, 51356,
                       46282, 32543, 32542, 113561,
                       113559, 113558, 113557, 113310 ) 
";247;;;;15/09/2022;marli.oliveira;0;1;1;1;;;;0;c71a4206-5e2f-488b-b35f-ec3947031fc8;0;;-18460;marli.oliveira;26/04/2022;marli.oliveira;15/09/2022;0
F;PVT.013.1;REFERENCIAS FINANCEIRAS (BAIXAS);"SELECT FLANBAIXA.IDBAIXA
FROM   FLANBAIXA
WHERE  FLANBAIXA.IDBAIXA IN ( 445390, 470350, 470636, 470637,
                              471134, 471980, 480040, 537782,
                              445579, 470356, 470638, 470639,
                              471135, 537783, 445598, 470640,
                              470641, 445628, 445629, 470382,
                              470642, 470643, 445632, 470408,
                              470644, 470645, 471136, 471981,
                              445633, 470646, 470647, 445635,
                              471207, 445641, 470648, 470649,
                              480041, 445644, 471982, 537784,
                              445648, 470442, 470650, 470651,
                              471137, 471983, 480042, 537785,
                              445651, 470450, 445654, 470451,
                              471138, 471984, 480043, 537786,
                              445657, 470455, 470652, 470653,
                              471139, 537787, 445663, 470495,
                              471140, 471985, 480044, 537788,
                              445666, 470496, 470654, 470655,
                              471141, 471986, 480046, 537789,
                              445667, 470497, 445670, 470500,
                              470656, 470657, 471142, 471987,
                              480047, 445671, 471988, 480048,
                              537790, 445672, 470658, 470659,
                              445674, 452677, 470501, 470660,
                              470661, 471143, 471989, 518354,
                              445678, 470503, 537791, 445680,
                              470504, 471144, 480049, 537792,
                              445759, 470358, 470662, 470663,
                              471990, 480050, 445600, 470360,
                              471145, 480051, 445758, 472003,
                              470348, 470668, 470669, 470418,
                              470670, 470671, 471991, 537794,
                              470419, 470672, 470673, 471992,
                              470674, 470675, 470676, 470677,
                              470678, 470679, 471993, 470680,
                              470681, 470971, 470345, 470686,
                              470687, 471995, 456420, 458702,
                              470351, 470688, 470689, 471996,
                              470449, 470690, 470691, 456421,
                              470433, 471998, 471148, 471149,
                              470354, 471150, 470368, 471151,
                              470383, 471152, 471153, 480055,
                              470498, 471154, 537797, 458300,
                              471158, 471499, 472000, 480057,
                              470380, 470698, 470699, 470494,
                              470415, 470700, 470701, 470704,
                              470705, 471160, 470369, 470708,
                              470709, 471163, 472312 ) 
";3062;;;;15/09/2022;marli.oliveira;0;1;1;1;;;;0;c71a4206-5e2f-488b-b35f-ec3947031fc8;0;;16345;marli.oliveira;28/07/2022;marli.oliveira;15/09/2022;0
F;PVT.013.2;REFERENCIAS FINANCEIRAS (FLAN E FLANBAIXA);"SELECT FLAN.IDLAN,
       FLANBAIXA.IDBAIXA
FROM   FLAN
       INNER JOIN FLANBAIXA
               ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
                  AND FLAN.IDLAN = FLANBAIXA.IDLAN
WHERE  FLAN.IDLAN IN ( 197330, 197793, 197867, 197869,
                       197910, 197911, 197913, 197914,
                       197917, 197920, 197922, 197925,
                       197930, 197932, 197933, 227345,
                       265915, 268544, 268582, 268606,
                       268729, 269434, 269621, 270916,
                       274199, 274209, 274210, 274225,
                       277494, 277511, 277538, 197330,
                       197330, 197793, 197793, 197811,
                       197811, 197867, 197867, 197869,
                       197869, 197872, 197872, 197898,
                       197898, 197910, 197910, 197914,
                       197914, 197920, 197920, 197925,
                       197925, 197929, 197929, 197930,
                       197930, 268544, 268544, 268582,
                       268582, 268606, 268606, 268610,
                       268610, 268614, 268614, 268617,
                       268617, 268644, 268644, 268729,
                       268729, 269434, 269434, 269621,
                       269621, 277494, 277494, 277538,
                       277538, 282042, 282042, 197330,
                       197793, 197869, 197910, 197913,
                       197914, 197917, 197920, 197925,
                       197930, 197933, 265915, 274183,
                       274190, 274199, 274209, 274210,
                       274216, 274225, 275556, 281164,
                       282914, 197330, 197869, 197900,
                       197910, 197913, 197917, 197920,
                       197925, 197928, 197930, 266837,
                       268582, 268606, 268617, 268729,
                       269434, 270916, 275556, 197886,
                       275556, 289389 ) 
";1978;;;;15/09/2022;marli.oliveira;0;1;1;1;;;;0;c71a4206-5e2f-488b-b35f-ec3947031fc8;0;;9882;marli.oliveira;15/09/2022;marli.oliveira;15/09/2022;0
F;PVT.014;CONSULTA CONTA CONTABIL;"SELECT DISTINCT FLAN.CODFILIAL,
                FLANBAIXA.IDBAIXA,
                FLAN.IDLAN,
                FLAN.CODCCUSTO AS CCUSTO_LANCAMENTO,
                CPARTIDA.IDPARTIDA,
                CPARTIDA.IDLANCAMENTO,
                CPARTIDA.CODLOTE,
                FLAN.CODCFO,
                CPARTIDA.DEBITO,
                CPARTIDA.CREDITO,
                CPARTIDA.DATA,
                FLAN.VALORBAIXADO,
                CPARTIDA.VALOR AS VALORJUROS,
                CPARTIDA.CODHISTP,
                CPARTIDA.COMPLEMENTO,
                CPARTIDA.CODCCUSTO AS CCUSTO_CONTABIL
FROM   FLAN (NOLOCK)
       INNER JOIN FTDO (NOLOCK)
               ON FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
                  AND FLAN.CODTDO = FTDO.CODTDO
       INNER JOIN FLANBAIXA (NOLOCK)
               ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
                  AND FLAN.IDLAN = FLANBAIXA.IDLAN
       LEFT JOIN SLAN (NOLOCK)
              ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
                 AND FLAN.IDLAN = SLAN.IDLAN
       INNER JOIN COPERACAO (NOLOCK)
               ON FLANBAIXA.CODCOLIGADA = COPERACAO.CODCOLIGADA
                  AND FLANBAIXA.IDOPERACAO = COPERACAO.IDOPERACAO
       INNER JOIN CCONT (NOLOCK)
               ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
                  AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO
       INNER JOIN CPARTIDA (NOLOCK)
               ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
                  AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA
WHERE  FLAN.CODCOLIGADA = 1
       /*AND FLAN.CODCFO = '58807'*/
      AND CPARTIDA.CREDITO >= '1.1.32.099' AND CPARTIDA.CREDITO <= '1.1.32.099.07.00000000002023' 
      /*  AND CPARTIDA.DEBITO >= '1.1.32.099' AND CPARTIDA.DEBITO <= '1.1.32.099.07.00000000002023'*/
       AND CPARTIDA.DATA >= '20220101'
       AND CPARTIDA.DATA <= '20221231'
ORDER  BY CPARTIDA.DATA 
";1910;;;;30/05/2022;marli.oliveira;0;1;1;1;;;;0;776d58d0-8042-4d33-9c8d-03f21c95da16;0;;-12627;marli.oliveira;24/05/2022;marli.oliveira;30/05/2022;0
F;PVT.015;PERIODO LETIVO;"SELECT FLAN.IDLAN 
FROM FLAN (NOLOCK)
WHERE FLAN.PERLETIVO NOT IN ('SIGA', 'ADEMS', '2021')


";99;;;;14/07/2022;marli.oliveira;0;1;1;1;;;;0;cad0365d-9002-456a-aab5-5ec976f99799;0;;2610;marli.oliveira;14/07/2022;marli.oliveira;14/07/2022;0
F;PVT.016;CONSULTA;"SELECT FLAN.IDLAN,
       FLANBAIXA.IDBAIXA,
       CPARTIDA.IDPARTIDA,
       CPARTIDA.IDLANCAMENTO,
       CPARTIDA.CODLOTE,
       *
FROM   FLAN (NOLOCK)
       LEFT JOIN FCXA (NOLOCK)
              ON FLAN.CODCOLCXA = FCXA.CODCOLIGADA
                 AND FLAN.CODCXA = FCXA.CODCXA
       LEFT JOIN FLANBAIXA (NOLOCK)
              ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA
                 AND FLANBAIXA.IDLAN = FLANBAIXA.IDLAN
       LEFT JOIN SLAN (NOLOCK)
              ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
                 AND FLAN.IDLAN = SLAN.IDLAN
       INNER JOIN COPERACAO COPERACAO
               ON FLAN.CODCOLIGADA = COPERACAO.CODCOLIGADA
                  AND FLAN.IDOPERACAO = COPERACAO.IDOPERACAO
       INNER JOIN CCONT (NOLOCK)
               ON COPERACAO.CODCOLIGADA = CCONT.CODCOLIGADA
                  AND COPERACAO.IDOPERACAO = CCONT.IDOPERACAO
       INNER JOIN CPARTIDA (NOLOCK)
               ON CCONT.CODCOLIGADA = CPARTIDA.CODCOLIGADA
                  AND CCONT.IDPARTIDA = CPARTIDA.IDPARTIDA
WHERE  FLAN.CODCOLIGADA = 1
       AND CPARTIDA.IDPARTIDA IN ( 805054, 805052, 766439, 696738,
                           690689, 688346, 682240, 3822592,
                           3109609, 3109605, 3109603, 3109599,
                           2320825, 2320822, 1641418, 1641414,
                           1641410, 1641406, 1641402, 1641398,
                           1641394, 1641390, 1641386, 1641382,
                           1641378, 1641374, 1641356, 1641352,
                           1641348, 1641344, 1641340, 1641336,
                           1641332, 1641328, 1641324, 1641320,
                           1641316, 1641312, 1641308, 1298291,
                           1298290, 1298287, 1298286, 1298268,
                           1298267, 1298266, 1298265, 1297831,
                           1297062, 1297044, 1297028, 1297012,
                           1296996, 1296980, 1296964, 1296948,
                           1296766, 1296758, 1296750, 1296742,
                           1296734, 1296726, 1296718, 1296710,
                           1296701, 1296693, 1296685, 1296677,
                           1296669, 1296661, 1296653, 1296645,
                           1217798, 1213724, 1209652, 1169443,
                           1169439, 1169435, 1169431, 1169427,
                           1169423, 1169419, 1169415, 1169411,
                           1169407, 1169403, 1169399, 1169395,
                           1169391, 1169387, 1169383, 1169379,
                           1169375, 1169371, 1169367, 1169363,
                           1169359, 1169355, 1169351, 1169347 ) 
";2688;;;;15/09/2022;marli.oliveira;0;1;1;1;;;;0;99e9b3b0-97aa-4df6-ac43-17ad55019b1e;0;;-17724;marli.oliveira;25/07/2022;marli.oliveira;15/09/2022;0
F;REL.FIN.00004;EXTRATO CONTABIL - Dados;"SELECT ISNULL(FCXA.CODCXA, '') + ' - ' + ISNULL(FCXA.DESCRICAO, '') AS DESCRICAO,
       ISNULL(FCXA.NUMBANCO, '') + ' - ' + ISNULL(GBANCO.NOME, '')  AS BANCO,
       FCXA.NUMAGENCIA,
       FCXA.NROCONTA,
       GCOLIGADA.NOME                                               AS COLIGADA
FROM   FCXA (NOLOCK)
       INNER JOIN GCOLIGADA (NOLOCK)
         ON DBO.GCOLIGADA.CODCOLIGADA = DBO.FCXA.CODCOLIGADA
       LEFT JOIN GBANCO (NOLOCK)
         ON DBO.GBANCO.NUMBANCO = DBO.FCXA.NUMBANCO
WHERE  FCXA.CODCXA = :CONTACAIXA
       AND FCXA.CODCOLIGADA = :CODCOLIGADA 
";;;;;;;0;1;1;1;;;;;0076ca93-36f5-4f32-9e79-9de6a9914493;;;-23649;marli.oliveira;10/03/2022;marli.oliveira;24/03/2022;
F;REL.FIN.00007;EXTRATO BANCARIO - Valor Debito no Período;"SELECT ISNULL(Sum(FXCX.VALOR), 0) AS VALOR_DEBITO
FROM   FXCX (NOLOCK)
WHERE  Cast(FXCX.DATACOMPENSACAO AS DATE) <= :DATA_FIM
       AND Cast(FXCX.DATACOMPENSACAO AS DATE) >= :DATA_INICIO
       AND FXCX.COMPENSADO = 1
       AND FXCX.CODCOLIGADA = :CODCOLIGADA
       AND FXCX.CODCXA = :CONTACAIXA
       AND FXCX.VALOR < 0 /*AND FXCX.DATACANCELAMENTO IS NULL*/
       AND FXCX.TIPO NOT IN ( 8, 9, 10, 13, 14 )
       AND FXCX.ESTORNADO <> 1 
";;;;;;;0;1;1;1;;;;;0e18c000-4853-410b-8627-f81827551f6f;;;26659;marli.oliveira;10/03/2022;marli.oliveira;24/03/2022;
F;REL.FIN.00008;EXTRATO BANCARIO - Valor Credito no Período;"SELECT ISNULL(Sum(FXCX.VALOR), 0) AS VALOR_CREDITO
FROM   FXCX (NOLOCK)
WHERE  Cast(FXCX.DATACOMPENSACAO AS DATE) <= :DATA_FIM
       AND Cast(FXCX.DATACOMPENSACAO AS DATE) >= :DATA_INICIO
       AND FXCX.COMPENSADO = 1
       AND FXCX.CODCOLIGADA = :CODCOLIGADA
       AND FXCX.CODCXA = :CONTACAIXA
       AND FXCX.VALOR > 0 /*AND FXCX.DATACANCELAMENTO IS NULL*/
       AND FXCX.TIPO NOT IN ( 8, 9, 10, 13, 14 )
       AND FXCX.ESTORNADO <> 1 
";;;;;;;0;1;1;1;;;;;0bc9405f-bb1a-4af7-93e3-d5c30714ab56;;;-31365;marli.oliveira;10/03/2022;marli.oliveira;24/03/2022;
F;REL.FIN.00009;EXTRATO BANCARIO - Saldo Inicial e Data Base;"SELECT ISNULL(FCXA.SALDODATABASE
              + COALESCE((SELECT Sum(FXCX.VALOR) 
              			FROM FXCX (NOLOCK) 
              			WHERE Cast(FXCX.DATACOMPENSACAO AS DATE) < :DATA_INICIO 
              				AND FXCX.DATAcompensacao > FCXA.DATABASECXA 
              				AND FXCX.CODCOLIGADA = FCXA.CODCOLIGADA 
              				AND FXCX.CODCXA = FCXA.CODCXA 
              				AND FXCX.COMPENSADO = 1 
              				/*AND FXCX.DATACANCELAMENTO IS NULL*/ 
              				AND TIPO NOT IN (8, 9, 10, 13, 14) 
              				AND ESTORNADO <> 1 ), 0), 0) AS 'MOVTO'
FROM   FCXA (NOLOCK)
WHERE  FCXA.CODCXA = :CONTACAIXA
       AND FCXA.CODCOLIGADA = :CODCOLIGADA 
";;;;;;;0;1;1;1;;;;;c907d853-18e2-421d-b317-40f292669b28;;;7698;marli.oliveira;10/03/2022;marli.oliveira;24/03/2022;
F;REL.FIN.00010;EXTRATO BANCARIO - Valor Movimento Caixa;"SELECT VALOR,
       DATA,
       DATACOMPENSACAO,
       NUMERODOCUMENTO,
       IDXCX,
       CASE
         WHEN VALOR < 0 THEN VALOR
         ELSE 0
       END                                AS 'DEBITO',
       CASE
         WHEN VALOR > 0 THEN VALOR
         ELSE 0
       END                                AS 'CREDITO',
       (SELECT Max (FC.NOME + ' ' + FC.CODCFO)
        FROM   FLAN AS F (NOLOCK)
               INNER JOIN FLANBAIXA AS FB (NOLOCK)
                       ON FB.CODCOLIGADA = F.CODCOLIGADA
                          AND FB.IDLAN = F.IDLAN
               INNER JOIN FCFO AS FC (NOLOCK)
                       ON FC.CODCOLIGADA = F.CODCOLCFO
                          AND FC.CODCFO = F.CODCFO
        WHERE  FB.CODCOLIGADA = FXCX.CODCOLIGADA
               AND FB.IDXCX = FXCX.IDXCX) AS 'CLIFOR',
       FXCX.HISTORICO
FROM   FXCX (NOLOCK)
WHERE  Cast(FXCX.DATACOMPENSACAO AS DATE) <= :DATA_FIM
       AND Cast(FXCX.DATACOMPENSACAO AS DATE) >= :DATA_INICIO
       
       AND FXCX.COMPENSADO = 1
       AND FXCX.CODCOLIGADA = :CODCOLIGADA
       AND FXCX.CODCXA LIKE :CONTACAIXA /*AND FXCX.DATACANCELAMENTO IS NULL*/
       AND FXCX.TIPO NOT IN ( 8, 9, 10, 13, 14 )
       AND FXCX.ESTORNADO <> 1
ORDER  BY 3,
          9,
          4 
";;;;;;;0;1;1;1;;;;;d7564554-8619-46e5-b79a-afeb1ada853f;;;-18175;marli.oliveira;10/03/2022;marli.oliveira;24/03/2022;
F;REL.FIN.00011;EXTRATO DE CAIXA - Saldo Geral;"SELECT (SELECT ISNULL(FCXA.SALDODATABASE
                      + COALESCE((SELECT Sum(FXCX.VALOR) FROM FXCX (NOLOCK) WHERE Cast(FXCX.DATACOMPENSACAO AS DATE) < :DATA_INICIO AND FXCX.DATAcompensacao > FCXA.DATABASECXA AND FXCX.CODCOLIGADA = FCXA.CODCOLIGADA AND FXCX.CODCXA = FCXA.CODCXA AND FXCX.COMPENSADO = 1 /*AND FXCX.DATACANCELAMENTO IS NULL*/ AND TIPO NOT IN (8, 9, 10, 13, 14) AND ESTORNADO <> 1 ), 0), 0) AS 'MOVTO'
        FROM   FCXA (NOLOCK)
        WHERE  FCXA.CODCXA = :CONTACAIXA
               AND FCXA.CODCOLIGADA = :CODCOLIGADA)
       + (SELECT ISNULL(Sum(FXCX.VALOR), 0) AS VALOR_DEBITO
          FROM   FXCX (NOLOCK)
          WHERE  Cast(FXCX.DATACOMPENSACAO AS DATE) <= :DATA_FIM
                AND  Cast(FXCX.DATACOMPENSACAO AS DATE) >= :DATA_INICIO
                 AND FXCX.COMPENSADO = 1
                 AND FXCX.CODCOLIGADA = :CODCOLIGADA
                 AND FXCX.CODCXA = :CONTACAIXA
                 AND FXCX.VALOR < 0 /*AND FXCX.DATACANCELAMENTO IS NULL*/
                 AND FXCX.TIPO NOT IN ( 8, 9, 10, 13, 14 )
                 AND FXCX.ESTORNADO <> 1)
       + (SELECT ISNULL(Sum(FXCX.VALOR), 0) AS VALOR_CREDITO
          FROM   FXCX (NOLOCK)
          WHERE  Cast(FXCX.DATACOMPENSACAO AS DATE) <= :DATA_FIM
                AND Cast(FXCX.DATACOMPENSACAO AS DATE) >= :DATA_INICIO
                 AND FXCX.COMPENSADO = 1
                 AND FXCX.CODCOLIGADA = :CODCOLIGADA
                 AND FXCX.CODCXA = :CONTACAIXA
                 AND FXCX.VALOR > 0 /*AND FXCX.DATACANCELAMENTO IS NULL*/
                 AND FXCX.TIPO NOT IN ( 8, 9, 10, 13, 14 )
                 AND FXCX.ESTORNADO <> 1) AS SALDO_GERAL 
";;;;;;;0;1;1;1;;;;;8f8f76d2-b50e-47e6-8d30-b2b2fe2e9969;;;-18233;marli.oliveira;10/03/2022;marli.oliveira;24/03/2022;
F;REL.FIN.00012;EXTRATO DE CAIXA - Usuário Sessão de Caixa;"SELECT *
FROM   FSESSAOCAIXA
WHERE  CODUSUARIOABERTURA = :USUARIO

/*SELECT (SELECT ISNULL(FCXA.SALDODATABASE*/
/*  + COALESCE((SELECT Sum(FXCX.VALOR) FROM FXCX (NOLOCK) WHERE Cast(FXCX.DATACOMPENSACAO AS DATE) < :DATA_INICIO AND FXCX.DATAcompensacao > FCXA.DATABASECXA AND FXCX.CODCOLIGADA = FCXA.CODCOLIGADA AND FXCX.CODCXA = FCXA.CODCXA AND FXCX.COMPENSADO = 1*/
/*AND FXCX.DATACANCELAMENTO IS NULL*/ /*AND TIPO NOT IN (8, 9, 10, 13, 14) AND ESTORNADO <> 1 ), 0), 0) AS 'MOVTO'*/
/*FROM   FCXA (NOLOCK)
WHERE  FCXA.CODCXA = :CONTACAIXA
       AND FCXA.CODCOLIGADA = :CODCOLIGADA)
+ (SELECT ISNULL(Sum(FXCX.VALOR), 0) AS VALOR_DEBITO
  FROM   FXCX (NOLOCK)
  WHERE  Cast(FXCX.DATACOMPENSACAO AS DATE) <= :DATA_FIM
        AND  Cast(FXCX.DATACOMPENSACAO AS DATE) >= :DATA_INICIO
         AND FXCX.COMPENSADO = 1
         AND FXCX.CODCOLIGADA = :CODCOLIGADA
         AND FXCX.CODCXA = :CONTACAIXA
         AND FXCX.VALOR < 0 *//*AND FXCX.DATACANCELAMENTO IS NULL*/
/*AND FXCX.TIPO NOT IN ( 8, 9, 10, 13, 14 )
AND FXCX.ESTORNADO <> 1)
+ (SELECT ISNULL(Sum(FXCX.VALOR), 0) AS VALOR_CREDITO
FROM   FXCX (NOLOCK)
WHERE  Cast(FXCX.DATACOMPENSACAO AS DATE) <= :DATA_FIM
AND Cast(FXCX.DATACOMPENSACAO AS DATE) >= :DATA_INICIO
AND FXCX.COMPENSADO = 1
AND FXCX.CODCOLIGADA = :CODCOLIGADA
AND FXCX.CODCXA = :CONTACAIXA
AND FXCX.VALOR > 0 *//*AND FXCX.DATACANCELAMENTO IS NULL*/
/* AND FXCX.TIPO NOT IN ( 8, 9, 10, 13, 14 )
 AND FXCX.ESTORNADO <> 1) AS SALDO_GERAL */
";1487;;;;24/03/2022;marli.oliveira;0;1;1;1;;;;;8f8f76d2-b50e-47e6-8d30-b2b2fe2e9969;;;13757;marli.oliveira;24/03/2022;marli.oliveira;24/03/2022;
F;Rel_Edu046;Relação de Alunos Bolsistas;"SELECT 
  SBOLSA.CODCOLIGADA,
  SCONTRATO.CODFILIAL,
  SBOLSA.CODBOLSA,
  SBOLSA.NOME AS NOMEBOLSA,
  SBOLSAALUNO.CODCONTRATO,
  SBOLSAALUNO.IDPERLET,
  SBOLSAALUNO.RA,
  SBOLSAALUNO.CODSERVICO,
  SBOLSAALUNO.PARCELAINICIAL,
  SBOLSAALUNO.PARCELAFINAL,
  SBOLSAALUNO.DATAAUTORIZACAO,
  SBOLSAALUNO.DATACONCESSAO,
  SBOLSAALUNO.DTFIM,
  SBOLSAALUNO.DTINICIO,
  SBOLSAALUNO.DESCONTO,
  SBOLSAALUNO.TIPODESC,
  SSERVICO.NOME AS NOMESERVICO,
  PPESSOA.NOME AS NOMEALUNO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SPLETIVO.CODPERLET
FROM SBOLSA (NOLOCK) JOIN SBOLSAALUNO (NOLOCK)
    ON (SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
        AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA)
  JOIN SALUNO (NOLOCK)
    ON (SBOLSAALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
        AND SBOLSAALUNO.RA = SALUNO.RA)
  JOIN PPESSOA (NOLOCK)
    ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
  JOIN SCONTRATO (NOLOCK)
    ON (SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
        AND SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO
        AND SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
        AND SBOLSAALUNO.RA = SCONTRATO.RA)
  JOIN SPLETIVO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
  JOIN SSERVICO (NOLOCK)
    ON (SBOLSAALUNO.CODCOLIGADA = SSERVICO.CODCOLIGADA
        AND SBOLSAALUNO.CODSERVICO = SSERVICO.CODSERVICO)
  JOIN GFILIAL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK) 
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE SBOLSA.CODCOLIGADA = :CODCOLIGADA_N
  AND SBOLSA.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCONTRATO.CODFILIAL = :CODFILIAL_N
  AND SBOLSA.CODBOLSA BETWEEN :CODBOLSADE_S AND :CODBOLSAATE_S
  AND SBOLSAALUNO.RA BETWEEN :RADE_S AND :RAATE_S
  AND SBOLSAALUNO.ATIVA = 'S'
  AND SBOLSAALUNO.DATACANCELAMENTO IS NULL
  AND SCONTRATO.DTCANCELAMENTO IS NULL
ORDER BY SBOLSA.CODCOLIGADA, SBOLSA.CODBOLSA";;;;;;;0;1;1;1;;;;;0ed578cf-3154-41b5-b0ac-d3cbf9403d45;;;19330;rafael.prado;29/09/2021;rafael.prado;29/09/2021;
F;Rel_Filiais;Dados da Filial;"SELECT GFILIAL.NOME, GIMAGEM.IMAGEM, GFILIAL.CODCOLIGADA, GFILIAL.CODFILIAL
FROM GFILIAL (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE GFILIAL.CODCOLIGADA = :CODCOLIGADA AND
  GFILIAL.CODFILIAL = :CODFILIAL";;;;;;;0;1;1;1;;;;;;;12.1;28443;mestre;10/08/2021;mestre;10/08/2021;
F;Rel_Fin0003.1;Recebimentos Diários com base nos contratos Educacional;"SELECT SCONTRATO.CODCONTRATO, 
  SCONTRATO.CODCOLIGADA, 
  SCONTRATO.RA,
  SCONTRATO.CODFILIAL, 
  SCONTRATO.CODTIPOCURSO, 
  SCONTRATO.IDPERLET,
  FLAN.DATABAIXA, 
  FLAN.DATAVENCIMENTO,
  FLAN.VALORBAIXADO, 
  FLAN.VALORORIGINAL, 
  FLAN.CODMOEVALORORIGINAL,
  FLAN.IDLAN, 
  FLAN.DATAEMISSAO, 
  FLAN.DATAPREVBAIXA, 
  FLAN.NUMERODOCUMENTO,
  FLAN.CODTDO, 
  FLAN.CODCXA,
  FCXA.DESCRICAO AS NOMECXA,
  FTDO.DESCRICAO AS NOMETDO, 
  SPLETIVO.CODPERLET,
  GFILIAL.NOME AS NOMEFILIAL, 
  GIMAGEM.IMAGEM
FROM SCONTRATO (NOLOCK) JOIN SPARCELA (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
        AND SCONTRATO.RA = SPARCELA.RA
        AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
        AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
  JOIN SLAN (NOLOCK)
    ON (SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
        AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
  JOIN FLAN (NOLOCK)
    ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
        AND SLAN.IDLAN = FLAN.IDLAN)
  LEFT JOIN FTDO (NOLOCK)
    ON (FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
        AND FLAN.CODTDO = FTDO.CODTDO)
  LEFT JOIN FCXA (NOLOCK)
    ON (FLAN.CODCOLCXA = FCXA.CODCOLIGADA
        AND FLAN.CODCXA = FCXA.CODCXA)
  JOIN SPLETIVO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
  JOIN GFILIAL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SCONTRATO.CODFILIAL = :CODFILIAL_N
  AND SCONTRATO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND FLAN.STATUSLAN IN (1,4)
  AND FLAN.DATABAIXA BETWEEN :DTBAIXADE_D AND :DTBAIXAATE_D  ";;;;;;;0;1;1;1;;;;;;;12.1;-27751;mestre;10/08/2021;mestre;10/08/2021;
F;Rel_Fin0004.1;Recebimentos por Negociação de Alunos com base nos contratos Educacional;"SELECT SCONTRATO.CODCONTRATO, 
  SCONTRATO.CODCOLIGADA, 
  SCONTRATO.RA,
  SCONTRATO.CODFILIAL, 
  SCONTRATO.CODTIPOCURSO, 
  SCONTRATO.IDPERLET,
  FLAN.DATABAIXA, 
  FLAN.DATAVENCIMENTO, 
  FLAN.NUMERODOCUMENTO,
  FLAN.VALORBAIXADO, 
  FLAN.VALORORIGINAL, 
  FLAN.CODMOEVALORORIGINAL,
  FLAN.IDLAN, 
  FLAN.DATAEMISSAO, 
  FLAN.DATAPREVBAIXA,
  FLAN.CODTDO, 
  FLAN.CODCXA,
  FCXA.DESCRICAO AS NOMECXA,
  FTDO.DESCRICAO AS NOMETDO, 
  SPLETIVO.CODPERLET,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  GIMAGEM.IMAGEM,
  GFILIAL.NOME AS NOMEFILIAL
FROM SCONTRATO (NOLOCK) JOIN SPARCELA (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
        AND SCONTRATO.RA = SPARCELA.RA
        AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
        AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
  JOIN SLAN (NOLOCK)
    ON (SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
        AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
  JOIN FLAN (NOLOCK)
    ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
        AND SLAN.IDLAN = FLAN.IDLAN)
  JOIN SPLETIVO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
  JOIN SALUNO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA 
        AND SCONTRATO.RA = SALUNO.RA)
  JOIN PPESSOA (NOLOCK)
    ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)        
  JOIN GFILIAL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
  LEFT JOIN FTDO (NOLOCK)
    ON (FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
        AND FLAN.CODTDO = FTDO.CODTDO)
  LEFT JOIN FCXA (NOLOCK)
    ON (FLAN.CODCOLCXA = FCXA.CODCOLIGADA
        AND FLAN.CODCXA = FCXA.CODCXA)
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SCONTRATO.CODFILIAL = :CODFILIAL_N
  AND SCONTRATO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SPLETIVO.CODPERLET BETWEEN :CODPERLETDE_S AND :CODPERLETATE_S
  AND SCONTRATO.RA BETWEEN :RADE_S AND :RAATE_S
  AND FLAN.STATUSLAN IN (1,4) 
  AND SCONTRATO.TIPOCONTRATO = 'A'";;;;;;;0;1;1;1;;;;;;;12.1;-19905;mestre;10/08/2021;mestre;10/08/2021;
F;Rel_Fin0005;Recebimentos diários por curso e turma;"SELECT FLAN.CODCFO,
  SCONTRATO.CODCONTRATO, 
  SCONTRATO.CODCOLIGADA, 
  SCONTRATO.RA,
  SCONTRATO.CODFILIAL, 
  SCONTRATO.CODTIPOCURSO, 
  SCONTRATO.IDPERLET,
  SCONTRATO.IDHABILITACAOFILIAL,
  FLANBAIXA.DATABAIXA, 
  FLAN.DATAVENCIMENTO,
  FLANBAIXA.VALORBAIXA AS VALORBAIXADO, 
  FLAN.VALORORIGINAL, 
  FLAN.CODMOEVALORORIGINAL,
  FLAN.IDLAN, 
  FLAN.DATAEMISSAO, 
  FLAN.DATAPREVBAIXA, 
  FLAN.NUMERODOCUMENTO,
  FLAN.CODTDO, FLAN.CODCXA, 
  FCXA.DESCRICAO AS NOMECXA,
  FTDO.DESCRICAO AS NOMETDO, 
  SPLETIVO.CODPERLET,
  GFILIAL.NOME AS NOMEFILIAL, 
  GIMAGEM.IMAGEM,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  SMATRICPL.CODTURMA,
  STIPOCURSO.APRESENTACAO
FROM SCONTRATO (NOLOCK) JOIN SPARCELA (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
        AND SCONTRATO.RA = SPARCELA.RA
        AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
        AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
  JOIN SLAN (NOLOCK)
    ON (SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
        AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
  JOIN FLAN (NOLOCK)
    ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
        AND SLAN.IDLAN = FLAN.IDLAN)
  LEFT JOIN FTDO (NOLOCK)
    ON (FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
        AND FLAN.CODTDO = FTDO.CODTDO)
  LEFT JOIN FCXA (NOLOCK)
    ON (FLAN.CODCOLCXA = FCXA.CODCOLIGADA
        AND FLAN.CODCXA = FCXA.CODCXA)
  JOIN SPLETIVO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
  JOIN GFILIAL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
  JOIN SMATRICPL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
        AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL        
        AND SCONTRATO.RA = SMATRICPL.RA)
  JOIN SHABILITACAOFILIAL (NOLOCK)
    ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
        AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN SCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN STURNO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
  JOIN SHABILITACAO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO =  SHABILITACAO.CODCURSO
        AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN FLANBAIXA (NOLOCK)
    ON (FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
        AND FLAN.IDLAN = FLANBAIXA.IDLAN)
  JOIN STIPOCURSO (NOLOCK)
    ON (STIPOCURSO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
        AND STIPOCURSO.CODTIPOCURSO = SCONTRATO.CODTIPOCURSO)
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SCONTRATO.CODFILIAL = :CODFILIAL_N
  AND SCONTRATO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.DATABAIXA BETWEEN :DTBAIXADE_D AND :DTBAIXAATE_D  
  AND SHABILITACAOFILIAL.CODCURSO BETWEEN :CODCURSODE_S AND :CODCURSOATE_S
  AND (SMATRICPL.CODTURMA BETWEEN :CODTURMADE_S AND :CODTURMAATE_S OR SMATRICPL.CODTURMA IS NULL)
  AND FLANBAIXA.DATACANCELBAIXA IS NULL";;;;;;;0;1;1;1;;;;;;;12.1;-2916;mestre;10/08/2021;mestre;10/08/2021;
F;Rel_Fin0007.1;Relação de alunos inadimplentes;"SELECT SCONTRATO.RA,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  SCONTRATO.CODCOLIGADA,
  SCONTRATO.CODFILIAL,
  SCONTRATO.CODTIPOCURSO,  
  SUM(
  CASE WHEN (FLAN.STATUSLAN = 0) OR (FLAN.VALORBAIXADO IS NULL)
   THEN FLAN.VALORORIGINAL
   ELSE FLAN.VALORORIGINAL - FLAN.VALORBAIXADO
  END) AS TOTALVALORORIGINAL
FROM SCONTRATO (NOLOCK) JOIN SPARCELA (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
        AND SCONTRATO.RA = SPARCELA.RA
        AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
        AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
  JOIN SLAN (NOLOCK)
    ON (SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
        AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
  JOIN FLAN (NOLOCK)
    ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
        AND SLAN.IDLAN = FLAN.IDLAN)
  JOIN SALUNO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA 
        AND SCONTRATO.RA = SALUNO.RA)
  JOIN PPESSOA (NOLOCK)
    ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
  JOIN SPLETIVO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SCONTRATO.CODFILIAL = :CODFILIAL_N
  AND SCONTRATO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SPLETIVO.CODPERLET BETWEEN :CODPERLETDE_S AND :CODPERLETATE_S
  AND SCONTRATO.CODCONTRATO BETWEEN :CODCONTRATODE_S AND :CODCONTRATOATE_S 
  AND SCONTRATO.RA BETWEEN :RADE_S AND :RAATE_S
  AND SCONTRATO.DTCANCELAMENTO IS NULL
  AND FLAN.STATUSLAN IN (0,4)   
  AND FLAN.DATAVENCIMENTO < :$HOJE 
GROUP BY SCONTRATO.RA, PPESSOA.NOME, PPESSOA.NOMESOCIAL,
  SCONTRATO.CODCOLIGADA,
  SCONTRATO.CODFILIAL,
  SCONTRATO.CODTIPOCURSO
ORDER BY PPESSOA.NOME    ";;;;;;;0;1;1;1;;;;;;;12.1;-9725;mestre;10/08/2021;mestre;10/08/2021;
F;Rel_Fin0011.1;Recibo de Pagamento para aluno;"SELECT SCONTRATO.CODCONTRATO, 
  SCONTRATO.CODCOLIGADA, 
  SCONTRATO.RA,
  SCONTRATO.CODFILIAL, 
  SCONTRATO.CODTIPOCURSO, 
  SCONTRATO.IDPERLET,
  FLANBAIXA.DATABAIXA, 
  FLAN.DATAVENCIMENTO,
  FLANBAIXA.VALORBAIXA,
  FLAN.CODMOEVALORORIGINAL,
  FLAN.IDLAN, 
  FLAN.DATAEMISSAO, 
  FLAN.DATAPREVBAIXA,
  FLAN.NUMERODOCUMENTO, 
  SPLETIVO.CODPERLET,
  GFILIAL.NOME AS NOMEFILIAL, GIMAGEM.IMAGEM,
  GFILIAL.RUA AS RUAFILIAL,
  GFILIAL.COMPLEMENTO AS COMPLEMENTOFILIAL,
  GFILIAL.NUMERO AS NUMEROFILIAL,
  GFILIAL.CIDADE AS CIDADEFILIAL,
  GFILIAL.ESTADO AS ESTADOFILIAL,
  GFILIAL.CGC AS CNPJFILIAL,
  FCFO.NOME AS NOMERESP,
  FCFO.RUA AS RUARESP,
  FCFO.COMPLEMENTO AS COMPLEMENTORESP,
  FCFO.NUMERO AS NUMERORESP,
  FCFO.CIDADE AS CIDADERESP,
  FCFO.CODETD AS ESTADORESP,
  FCFO.CGCCFO AS CNPJRESP,
  SPARCELA.PARCELA, SPARCELA.IDPARCELA,
  SSERVICO.NOME AS NOMESERVICO,
  TFORMAPAGTO.DESCFORMAPAGTO AS NOMEFORMAPAGTO,
  FLANBAIXA.DATACANCELBAIXA
FROM SCONTRATO (NOLOCK) JOIN SPARCELA (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
        AND SCONTRATO.RA = SPARCELA.RA
        AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
        AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
  JOIN SSERVICO (NOLOCK)
    ON (SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
        AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO)        
  JOIN SLAN (NOLOCK)
    ON (SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
        AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
  JOIN FLAN (NOLOCK)
    ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
        AND SLAN.IDLAN = FLAN.IDLAN)
  JOIN FLANBAIXA (NOLOCK)
    ON (FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
        AND FLAN.IDLAN = FLANBAIXA.IDLAN)
  JOIN SPLETIVO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
  JOIN GFILIAL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
  JOIN FCFO (NOLOCK)
    ON (FLAN.CODCOLCFO = FCFO.CODCOLIGADA
        AND FLAN.CODCFO = FCFO.CODCFO)
  LEFT JOIN TFORMAPAGTO (NOLOCK)
    ON (FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
        AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO)
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SCONTRATO.CODFILIAL = :CODFILIAL_N
  AND SCONTRATO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCONTRATO.CODCONTRATO BETWEEN :CODCONTRATODE_S AND :CODCONTRATOATE_S
  AND SPARCELA.PARCELA BETWEEN :PARCELADE_N AND :PARCELAATE_N
  AND FLAN.STATUSLAN IN (1,4)
  AND FLANBAIXA.DATACANCELBAIXA IS NULL
ORDER BY SCONTRATO.CODCOLIGADA,
  SCONTRATO.CODCONTRATO,
  SCONTRATO.IDPERLET,
  SCONTRATO.RA,
  SPARCELA.IDPARCELA   ";;;;;;;0;1;1;1;;;;;;;12.1;29259;mestre;14/06/2021;mestre;14/06/2021;
F;Rel_Fin0013;Recebimentos por curso;"SELECT FLAN.CODCFO,
  SCONTRATO.CODCONTRATO, 
  SCONTRATO.CODCOLIGADA, 
  SCONTRATO.RA,
  SCONTRATO.CODFILIAL, 
  SCONTRATO.CODTIPOCURSO, 
  SCONTRATO.IDPERLET,
  SCONTRATO.IDHABILITACAOFILIAL,
  FLAN.DATABAIXA, 
  FLAN.DATAVENCIMENTO,
  FLAN.VALORBAIXADO, 
  FLAN.VALORORIGINAL, 
  FLAN.CODMOEVALORORIGINAL,
  FLAN.IDLAN, 
  FLAN.DATAEMISSAO, 
  FLAN.DATAPREVBAIXA, 
  FLAN.NUMERODOCUMENTO,
  FLAN.CODTDO, FLAN.CODCXA, 
  FCXA.DESCRICAO AS NOMECXA,
  FTDO.DESCRICAO AS NOMETDO, 
  SPLETIVO.CODPERLET,
  GFILIAL.NOME AS NOMEFILIAL, 
  GIMAGEM.IMAGEM,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  STIPOCURSO.APRESENTACAO
FROM SCONTRATO (NOLOCK) JOIN SPARCELA (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
        AND SCONTRATO.RA = SPARCELA.RA
        AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
        AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
  JOIN SLAN (NOLOCK)
    ON (SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
        AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
  JOIN FLAN (NOLOCK)
    ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
        AND SLAN.IDLAN = FLAN.IDLAN)
  LEFT JOIN FTDO (NOLOCK)
    ON (FLAN.CODCOLIGADA = FTDO.CODCOLIGADA
        AND FLAN.CODTDO = FTDO.CODTDO)
  LEFT JOIN FCXA (NOLOCK)
    ON (FLAN.CODCOLCXA = FCXA.CODCOLIGADA
        AND FLAN.CODCXA = FCXA.CODCXA)
  JOIN SPLETIVO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
  JOIN GFILIAL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
  JOIN SHABILITACAOFILIAL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
        AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN SCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN STURNO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
  JOIN SHABILITACAO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO =  SHABILITACAO.CODCURSO
        AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN STIPOCURSO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
        AND SCONTRATO.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SCONTRATO.CODFILIAL = :CODFILIAL_N
  AND SCONTRATO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND FLAN.STATUSLAN IN (1,4)
  AND FLAN.DATABAIXA BETWEEN :DTBAIXADE_D AND :DTBAIXAATE_D  
  AND SHABILITACAOFILIAL.CODCURSO BETWEEN :CODCURSODE_S AND :CODCURSOATE_S
ORDER BY SCONTRATO.CODCOLIGADA, 
  SCONTRATO.CODFILIAL, 
  SCONTRATO.IDHABILITACAOFILIAL,
  FLAN.DATABAIXA
";;;;;;;0;1;1;1;;;;;;;12.1;12129;mestre;10/08/2021;mestre;10/08/2021;
F;REQ.020;Informações Financeiras;"SELECT
 HATENDIMENTOEXT.COLIGADAALUNO,
 HATENDIMENTOEXT.RAALUNO,
 HATENDIMENTOBASE.CODLOCAL,
 CONVERT(VARCHAR(10), (GETDATE() + 3), 103) VENCIMENTO,
 HPRECOTIPOATEND.VALOR
 
FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HATENDIMENTOEXT (NOLOCK)		ON HATENDIMENTOEXT.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HATENDIMENTOEXT.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   HATENDIMENTOEXT.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 
 INNER JOIN HTIPOATENDIMENTO (NOLOCK)		ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO

 INNER JOIN HLOCALENTREGA (NOLOCK)			ON HLOCALENTREGA.CODCOLIGADA = HTIPOATENDIMENTO.CODCOLIGADA AND 
 											   HLOCALENTREGA.CODTIPOATENDIMENTO = HTIPOATENDIMENTO.CODTIPOATENDIMENTO AND
 											   HLOCALENTREGA.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 											   
 INNER JOIN HPRECOTIPOATEND (NOLOCK)		ON HPRECOTIPOATEND.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND 
 											   HPRECOTIPOATEND.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND 
 											   HPRECOTIPOATEND.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA AND 
 											   HPRECOTIPOATEND.CODFILIAL = HLOCALENTREGA.CODFILIAL

WHERE	HATENDIMENTOBASE.CODCOLIGADA = :CODCOLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = :CODATENDIMENTO";1414;;;;21/09/2021;robson.canto;0;1;1;1;;;;0;056495f1-3961-4989-a782-ebd5f47637c3;0;;30803;robson.canto;21/09/2021;robson.canto;21/09/2021;0
F;RP_RECIBO;Reports Recibo Portal;"SELECT DISTINCT 
  FLANBAIXA.VALORBAIXA,
  FCFO.NOME,
  FLAN.IDLAN, 
  FLAN.CODCXA,     
  FLAN.DATAEMISSAO, 
  FLAN.DATAVENCIMENTO, 
  FLAN.NUMERODOCUMENTO,
  FLAN.VALORORIGINAL,  
  SPARCELA.PARCELA,
  SSERVICO.NOME SERVICO,
  FLANBAIXA.VALORBAIXA,
  FLANBAIXA.IDFORMAPAGTO,
  TFORMAPAGTO.DESCFORMAPAGTO FORMAPAGTO,  
  SCONTRATO.CODCONTRATO, 
  SCONTRATO.CODCOLIGADA, 
  SCONTRATO.RA,
  SCONTRATO.CODFILIAL, 
  SCONTRATO.CODTIPOCURSO, 
  SCONTRATO.IDPERLET,
  SPLETIVO.CODPERLET  AS PERLETIVO,
  GFILIAL.NOME        AS NOMEFILIAL, 
  PPESSOA.NOME        AS NOMEALUNO,
  PPESSOA.NOMESOCIAL  AS NOMESOCIALALUNO,
  SALUNO.RA +' - '+PPESSOA.NOME +' - '+ SHABILITACAO.NOME AS CURSO_SERIE,
  FLAN.VALORBAIXADO
  
FROM FLANBAIXA    (NOLOCK) 
	INNER JOIN TFORMAPAGTO  (NOLOCK) 
			ON FLANBAIXA.IDFORMAPAGTO   = TFORMAPAGTO.IDFORMAPAGTO 
			AND FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA 
	INNER JOIN FLAN      (NOLOCK) 
			ON FLANBAIXA.IDLAN = FLAN.IDLAN  
			AND FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA    
	INNER JOIN FCFO      (NOLOCK) 
			ON FCFO.CODCFO = FLAN.CODCFO 
			AND FCFO.CODCOLIGADA = FLAN.CODCOLCFO
	INNER JOIN SLAN      (NOLOCK) 
			ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA    
			AND SLAN.IDLAN = FLAN.IDLAN) 
	INNER JOIN SPARCELA  (NOLOCK) 
			ON (SPARCELA.CODCOLIGADA    = SLAN.CODCOLIGADA   
			AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
	INNER JOIN SCONTRATO (NOLOCK) 
			ON (SCONTRATO.CODCOLIGADA   = SPARCELA.CODCOLIGADA  
			AND SCONTRATO.RA  = SPARCELA.RA  
			AND SCONTRATO.IDPERLET  = SPARCELA.IDPERLET  
			AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
	INNER JOIN SPLETIVO  (NOLOCK) 
			ON (SCONTRATO.CODCOLIGADA   = SPLETIVO.CODCOLIGADA  
			AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
	INNER JOIN SMATRICPL (NOLOCK) 
			ON (SMATRICPL.RA = SCONTRATO.RA 
			AND SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
			AND SMATRICPL.CODFILIAL = SCONTRATO.CODFILIAL 
			AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET)
	INNER JOIN GFILIAL   (NOLOCK) 
			ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA    
			AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
	LEFT  JOIN GIMAGEM   (NOLOCK) 
			ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
	INNER JOIN SALUNO    (NOLOCK) 
			ON (SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA  
			AND SCONTRATO.RA = SALUNO.RA)
	INNER JOIN PPESSOA   (NOLOCK) 
			ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
	INNER JOIN FXCX      (NOLOCK) 
			ON (FXCX.IDXCX = FLANBAIXA.IDXCX 
			AND FXCX.CODCOLIGADA = FLANBAIXA.CODCOLIGADA)
	INNER JOIN SSERVICO  (NOLOCK) 
			ON  SPARCELA.CODSERVICO = SSERVICO.CODSERVICO 
			AND SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
			ON SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	LEFT JOIN SCURSO (NOLOCK)
			ON SCURSO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	INNER JOIN SHABILITACAO (NOLOCK)
			ON SHABILITACAO.CODCOLIGADA=SMATRICPL.CODCOLIGADA
			AND SHABILITACAO.CODHABILITACAO=SHABILITACAOFILIAL.CODHABILITACAO
			AND SHABILITACAO.CODCURSO = SCURSO.CODCURSO	
	
WHERE
	FLAN.CODCOLIGADA = :CODCOLIGADA1
	AND FLAN.IDLAN = :IDLAN1
  	AND SCONTRATO.DTCANCELAMENTO IS NULL


";;;;;;;0;1;1;1;;;;;92985f85-7ea7-44d2-9c2f-91f7cf8dd90c;;;-16927;lucas.ssantos;23/06/2021;lucas.ssantos;23/06/2021;
F;RP_RECIBO2;Reports Relatório Recibo portal 2;"SELECT DISTINCT

  /*FLANBAIXA.IDBAIXA,*/
  FLANBAIXA.VALORBAIXA,
  /* FLANBAIXA.IDXCX,*/
  FLANBAIXA.IDFORMAPAGTO,
  TFORMAPAGTO.DESCFORMAPAGTO FORMAPAGTO,
  CASE
	WHEN TFORMAPAGTO.IDFORMAPAGTO = 3 THEN 
		COUNT (FLANBAIXA.IDXCX) 
	ELSE 
		NULL 
	END VEZES,
  CASE
	WHEN TFORMAPAGTO.IDFORMAPAGTO = 3 THEN 
		'Parcela(s)' 
	ELSE	
		NULL 
	END PARCELAS
  
FROM  FLANBAIXA    (NOLOCK) 
	INNER JOIN TFORMAPAGTO  (NOLOCK) 
		ON FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO 
		AND FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA 
	INNER JOIN FLAN (NOLOCK) 
		ON FLANBAIXA.IDLAN = FLAN.IDLAN  
		AND FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA    
	INNER JOIN FCFO (NOLOCK) 
		ON FCFO.CODCFO = FLAN.CODCFO 
		AND FCFO.CODCOLIGADA = FLAN.CODCOLCFO
	INNER JOIN SLAN (NOLOCK) 
		ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA    
		AND SLAN.IDLAN = FLAN.IDLAN) 
	INNER JOIN SPARCELA  (NOLOCK) 
		ON (SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA   
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
	INNER JOIN SCONTRATO (NOLOCK) 
		ON (SCONTRATO.CODCOLIGADA  = SPARCELA.CODCOLIGADA  
		AND SCONTRATO.RA  = SPARCELA.RA  
		AND SCONTRATO.IDPERLET  = SPARCELA.IDPERLET  
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
	INNER JOIN SPLETIVO  (NOLOCK) 
		ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA  
		AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
	/*INNER JOIN SMATRICPL (NOLOCK) 
		ON (SMATRICPL.RA = SCONTRATO.RA 
		AND SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
		AND SMATRICPL.CODFILIAL = SCONTRATO.CODFILIAL 
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET)*/
	INNER JOIN GFILIAL   (NOLOCK) 
		ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA    
		AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
	LEFT  JOIN GIMAGEM   (NOLOCK) 
		ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
	INNER JOIN SALUNO    (NOLOCK) 
		ON (SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA  
		AND SCONTRATO.RA = SALUNO.RA)
	INNER JOIN PPESSOA   (NOLOCK) 
		ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
	INNER JOIN FXCX      (NOLOCK) 
		ON (FXCX.IDXCX = FLANBAIXA.IDXCX 
		AND FXCX.CODCOLIGADA = FLANBAIXA.CODCOLIGADA)
	INNER JOIN SSERVICO  (NOLOCK) 
		ON  SPARCELA.CODSERVICO = SSERVICO.CODSERVICO 
		AND SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
  
WHERE
	FLAN.CODCOLIGADA = :CODCOLIGADA1
	AND FLAN.IDLAN = :IDLAN1


GROUP BY 
	FLANBAIXA.VALORBAIXA
	,FLANBAIXA.IDFORMAPAGTO
	,TFORMAPAGTO.DESCFORMAPAGTO
	,TFORMAPAGTO.IDFORMAPAGTO


";;;;;;;0;1;1;1;;;;;e78a9950-bf9b-4c70-8379-97622e5dc879;;;-30738;lucas.ssantos;23/06/2021;lucas.ssantos;23/06/2021;
F;SH;Consultas desenvolvidas pela Shift;"SELECT 
	NIVELENSINO.NIVEL,
	FLANCOMPL.ENVSERASA,
	FLANCOMPL.ENVCOBJUD,	
	NIVELENSINO.NEGATIVADOCOMPETENCIA,
	CASE WHEN COALESCE(NIVELENSINO.FIES,'F') = 'T' THEN 'Sim' ELSE 'Não' END FIES,
	NIVELENSINO.STATUS,
	FLAN.CODCOLIGADA,
	FLAN.IDLAN
FROM FLAN (NOLOCK)
OUTER APPLY(
	SELECT
		IIF(SERASA = 1,'Sim','Não') AS ENVSERASA,
		IIF(COBJUD = 1,'Sim','Não') AS ENVCOBJUD
	FROM FLANCOMPL (NOLOCK)
	WHERE FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
) AS FLANCOMPL

OUTER APPLY(
	SELECT
		IIF(NEGATIVACAO.QTD_NEGATIVADO > 0,'Sim','Não') AS NEGATIVADOCOMPETENCIA,
		SHABILITACAO.FIES,
		CASE 
			WHEN SHF.CODTIPOCURSO = 1 THEN 'Graduação'
			WHEN SHF.CODTIPOCURSO = 2 THEN 'Pós-Graduação'
			WHEN SHF.CODTIPOCURSO = 3 THEN 'Extensão/Livre'
		ELSE '' END AS NIVEL,
		SMATRICPL.DESCRICAO AS STATUS
	FROM SLAN(NOLOCK)
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
		AND SCONTRATO.RA = SPARCELA.RA
	CROSS APPLY(
		SELECT
			SSTATUS.DESCRICAO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SSTATUS(NOLOCK)
			ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	) AS SMATRICPL
	OUTER APPLY(
			SELECT
			    FIES
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SCONTRATO.RA
		) AS SHABILITACAO
	INNER JOIN SHABILITACAOFILIAL SHF(NOLOCK)
		ON SHF.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SHF.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	/** VERIFICAR SE POSSUI NEGATIVACAO NA MESMA COMPETENCIA **/
	OUTER APPLY(
		SELECT
			COUNT(*) AS QTD_NEGATIVADO
		FROM FLAN FLANCOMPT(NOLOCK)
		INNER JOIN FLANCOMPL(NOLOCK)
			ON FLANCOMPL.CODCOLIGADA = FLANCOMPT.CODCOLIGADA
			AND FLANCOMPL.IDLAN = FLANCOMPT.IDLAN
			AND (FLANCOMPL.SERASA = '1' OR FLANCOMPL.COBJUD = '1')
			AND FLANCOMPT.PAGREC = 1
			AND FLANCOMPT.STATUSLAN = 0 
			AND CONCAT(YEAR(FLANCOMPL.DTINCSERAASA),'/',MONTH(FLANCOMPL.DTINCSERAASA)) = CONCAT(YEAR(COALESCE(SPARCELA.DTCOMPETENCIA,FLAN.MESDECOMPETENCIA)),'/',MONTH(COALESCE(SPARCELA.DTCOMPETENCIA,FLAN.MESDECOMPETENCIA)))
		WHERE FLANCOMPT.CODCOLIGADA = SLAN.CODCOLIGADA
		AND FLANCOMPT.CODCFO = FLAN.CODCFO
	) AS NEGATIVACAO
	WHERE SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	AND SLAN.IDLAN = FLAN.IDLAN
) AS NIVELENSINO
WHERE FLAN.IDLAN = 56494";3184;;;;25/10/2022;shift;0;1;1;1;;;;0;4798abe1-ae9c-4017-84a0-59ac24ce00d2;0;;-14052;shift;08/06/2022;shift;25/10/2022;0
F;SH.CB;Consultas utilizadas em cubos;"SELECT 
	CASE WHEN FIES IS NULL THEN 'TRUE' ELSE 'FALSE' END FIES
FROM SHABILITACAOALUNOCOMPL WHERE CODCOLIGADA = 1 AND RA = 151308
AND IDHABILITACAOFILIAL = 15745";166;;;;28/09/2022;shift;0;1;1;1;;;;0;1c6f79cd-31de-443b-b412-ad968fdc26c7;0;;30661;shift;08/06/2022;shift;28/09/2022;0
F;SH.CB.001;Consultas utilizadas no cubo Lançamentos negativados;"SELECT
	CONCAT(FLAN.CODFILIAL,' - ',GFILIAL.NOME)						  AS 'Filial',
	CONVERT(VARCHAR,FLAN.DATAVENCIMENTO,103)						  AS 'Vencimento',
	FLAN.IDLAN 							   							  AS 'Ref. Lançamento', 
	IIF(FLANCOMPL.SERASA = 1,'Sim','Não') 							  AS 'Incluso SERASA',
	IIF(FLANCOMPL.COBJUD = 1,'Sim','Não') 							  AS 'Processo judicial',
	CONVERT(VARCHAR,DTINCSERAASA,103)	  							  AS 'Data inclusão SERASA',
	CONVERT(VARCHAR,DTBXSERASA,103)		  							  AS 'Data baixa SERASA',
	CONCAT(MOTIVOSERASA.CODINTERNO,' - ',MOTIVOSERASA.DESCRICAO)	  AS 'Motivo baixa SERASA',
	CONVERT(VARCHAR,DTINICOBJUD,103)   					  			  AS 'Data início processo judicial',
	CONVERT(VARCHAR,DTFIMCOBJUD,103)	  							  AS 'Data fim processo judicial',
	RESPONSAVELCOBRANCA.DESCRICAO		 							  AS 'Responsável cobrança',
	FCFO.NOME 							  							  AS 'Cliente',
	CASE 
		WHEN FLAN.STATUSLAN = 0 THEN 'Em Aberto'
		WHEN FLAN.STATUSLAN = 1 THEN 'Baixado'
		WHEN FLAN.STATUSLAN = 2 THEN 'Cancelado'
		WHEN FLAN.STATUSLAN = 3 THEN 'Baixado por Acordo'
		WHEN FLAN.STATUSLAN = 4 THEN 'Baixado Parcialmente'
		WHEN FLAN.STATUSLAN = 5 THEN 'Borderô'
	ELSE 'Status não identificado' END								  AS 'Status lançamento',
	SCONTRATO.CODPERLET												  AS 'Período letivo',
	SCONTRATO.PARCELA												  AS 'Parcela',
	SCONTRATO.SERVICO												  AS 'Serviço',
	SCONTRATO.NOME													  AS 'Curso',
	SCONTRATO.DESCRICAO												  AS 'Status período letivo',
	1																  AS 'Qtd'
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND (FLANCOMPL.SERASA = 1 OR FLANCOMPL.COBJUD = 1 
		AND FLANCOMPL.DTINCSERAASA IS NOT NULL OR FLANCOMPL.DTINICOBJUD IS NOT NULL)
INNER JOIN FCFO(NOLOCK)
	ON FCFO.CODCFO = FLAN.CODCFO		
/**MOTIVO SERASA**/
OUTER APPLY(
	SELECT
		CODCOLIGADA,
		CODINTERNO,
		DESCRICAO
	FROM GCONSIST(NOLOCK)
	WHERE CODTABELA = 'MTSERASA'
	AND CODINTERNO = FLANCOMPL.MOTIVOSERASA
) AS MOTIVOSERASA
/**COBRADOR**/
OUTER APPLY(
	SELECT
		CODCOLIGADA,
		CODINTERNO,
		DESCRICAO	
	FROM GCONSIST(NOLOCK)
	WHERE CODTABELA = 'COBJUD'
	AND CODINTERNO = FLANCOMPL.RESPCOBJUD
) AS RESPONSAVELCOBRANCA
/**FILIAL**/
OUTER APPLY(
	SELECT
		NOME
	FROM GFILIAL(NOLOCK)
	WHERE GFILIAL.CODFILIAL = FLAN.CODFILIAL
) AS GFILIAL
/**CONTRATO/CURSO**/
CROSS APPLY (
	SELECT 
		SCONTRATO.CODCONTRATO,
		SCONTRATO.IDPERLET,
		SPLETIVO.CODPERLET,
		SPARCELA.PARCELA,
		SCURSO.NOME,
		SMATRICPL.DESCRICAO,
		SSERVICO.CODSERVICO,
		SSERVICO.NOME AS SERVICO
	FROM SLAN(NOLOCK)
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.RA = SPARCELA.RA
	INNER JOIN SSERVICO(NOLOCK)
		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	INNER JOIN SPLETIVO(NOLOCK)
		ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
	CROSS APPLY(
		SELECT 
			SCURSO.NOME
		FROM SHABILITACAOFILIAL(NOLOCK)
		INNER JOIN SCURSO(NOLOCK)
			ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		WHERE SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	) AS SCURSO
	CROSS APPLY(
		SELECT
			SSTATUS.DESCRICAO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SSTATUS(NOLOCK)
			ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	) AS SMATRICPL
	WHERE SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	AND SLAN.IDLAN = FLAN.IDLAN
) AS SCONTRATO";4031;;;;25/10/2022;shift;0;1;1;1;;;;0;1c6f79cd-31de-443b-b412-ad968fdc26c7;0;;-614;shift;09/06/2022;shift;25/10/2022;0
F;SH.FILTROS;Consultas utilizadas em filtros (Fluxos);"SELECT * FROM GLINKSREL WHERE MASTERTABLE = 'CPARTIDA'
/*SELECT * FROM GLINKSREL WHERE MASTERTABLE = 'CLANCAMENTO'
SELECT * FROM GLINKSREL WHERE MASTERTABLE = 'CHISTRATEIOLAN'*/";179;;;;04/10/2022;shift;0;1;1;1;;;;0;623ced52-0072-4e32-a0fb-56a7d0939a54;0;;-16284;shift;14/09/2022;shift;04/10/2022;0
F;SH.FILTROS.001;Lançamentos vencidos a mais de 70 dias e que não foram negativados;"/**
	AUTOR: LAERTE
	DESC.: BUSCAR LANCAMENTO VENCIDOS A MAIS DE 70 QUE NÃO FORAM NEGATIVADOS
**/
SELECT
	FLAN.IDLAN
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND ISNULL(FLANCOMPL.SERASA,'0') = '0'
WHERE DATEDIFF(DAY,DATAVENCIMENTO,GETDATE()) >= 70
AND STATUSLAN = 0
/** IGNORAR LANÇAMENTO COM TRANSAÇÃO DE CARTÃO **/
AND NOT EXISTS
			(SELECT 
				FLANBOLETO.IDLAN
			FROM FINTEGRACAOCARTAO(NOLOCK) 
			INNER JOIN FLANBOLETO(NOLOCK)
				ON FLANBOLETO.CODCOLIGADA = FINTEGRACAOCARTAO.CODCOLIGADA
				AND FLANBOLETO.IDBOLETO = FINTEGRACAOCARTAO.IDBOLETO
				AND FLANBOLETO.IDLAN = FLAN.IDLAN)";696;;;;05/10/2022;shift;0;1;1;1;;;;0;623ced52-0072-4e32-a0fb-56a7d0939a54;0;;4177;shift;14/09/2022;shift;05/10/2022;0
F;SH.FILTROS.001.1;Lançamentos vencidos a mais de 70 dias e que não foram negativados (Ano);"/**
	AUTOR: LAERTE
	DESC.: BUSCAR LANCAMENTO VENCIDOS A MAIS DE 70 QUE NÃO FORAM NEGATIVADOS
**/
SELECT
	FLAN.IDLAN
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND ISNULL(FLANCOMPL.SERASA,'0') = '0'
	AND YEAR(DATAVENCIMENTO) = :ANO
	AND DATEDIFF(DAY,DATAVENCIMENTO,GETDATE()) >= 70
	AND STATUSLAN = 0";396;;;;14/09/2022;shift;0;1;1;1;;;;0;623ced52-0072-4e32-a0fb-56a7d0939a54;0;;-24920;shift;14/09/2022;shift;14/09/2022;0
F;SH.FILTROS.002;Lançamentos vencidos e negativados;"/**
	AUTOR: LAERTE
	DESC.: BUSCAR LANCAMENTO VENCIDOS A MAIS DE 70 QUE NÃO FORAM NEGATIVADOS
**/
SELECT
	FLAN.IDLAN
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND ISNULL(FLANCOMPL.SERASA,'0') = '1'
WHERE DATEDIFF(DAY,DATAVENCIMENTO,GETDATE()) > 4
AND STATUSLAN = 0";360;;;;14/09/2022;shift;0;1;1;1;;;;0;623ced52-0072-4e32-a0fb-56a7d0939a54;0;;2574;shift;14/09/2022;shift;14/09/2022;0
F;SH.FILTROS.003;Lançamentos que estavam negativados, mas que foram baixados;"/**
	AUTOR: LAERTE
	DESC.: BUSCAR LANCAMENTOS NEGATIVADOS QUE FORAM BAIXADOS
**/
SELECT
	FLAN.IDLAN
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND FLANCOMPL.MOTIVOSERASA IS NOT NULL
	AND FLANCOMPL.DTBXSERASA IS NOT NULL
	AND STATUSLAN IN (1,3)";339;;;;14/09/2022;shift;0;1;1;1;;;;0;623ced52-0072-4e32-a0fb-56a7d0939a54;0;;-28909;shift;14/09/2022;shift;14/09/2022;0
F;SH.FILTROS.004;Lançamentos enviados para o jurídico;"/**
	AUTOR: LAERTE
	DESC.: BUSCAR LANCAMENTOS ENVIADOS PARA O JURÍDICO
**/
SELECT
	FLAN.IDLAN
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND ISNULL(FLANCOMPL.COBJUD,'0') = '1'
	AND FLANCOMPL.RESPCOBJUD IS NOT NULL
	AND STATUSLAN = 0";328;;;;14/09/2022;shift;0;1;1;1;;;;0;623ced52-0072-4e32-a0fb-56a7d0939a54;0;;-5592;shift;14/09/2022;shift;14/09/2022;0
F;SH.FILTROS.005;Lançamentos enviados para o jurídico e baixados;"/**
	AUTOR: LAERTE
	DESC.: BUSCAR LANCAMENTOS ENVIADOS AO JURÍDICO QUE FORAM BAIXADOS
**/
SELECT
	FLAN.IDLAN
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND ISNULL(FLANCOMPL.COBJUD,'0') = '1'
	AND FLANCOMPL.RESPCOBJUD IS NOT NULL
	AND STATUSLAN IN (1,3)";348;;;;14/09/2022;shift;0;1;1;1;;;;0;623ced52-0072-4e32-a0fb-56a7d0939a54;0;;-6538;shift;14/09/2022;shift;14/09/2022;0
F;SH.FV;Consultas utilizadas em fórmulas visuais;SELECT * FROM FLANCOMPL(NOLOCK) WHERE IDLAN = 167428;52;;;;16/08/2022;shift;0;1;1;1;;;;0;5bd672d7-070e-453f-8a96-4cefb6db3f95;0;;-11479;shift;08/06/2022;shift;16/08/2022;0
F;SH.FV.001;Consulta utilizada na FV 62 - Insere dados envio Serasa;"/******
	AUTOR: LAERTE
	DESC.: CONSULTA UTILIZADA PARA ATUALIZAR DADOS DE ENVIO SERASA
******/

DECLARE 
	@ENVSERASA VARCHAR(1) = :SERASA,
	@DTSERASA DATETIME = :DATASERASA;

SELECT 
	FLANCOMPL.CODCOLIGADA AS CODCOLIGADA,
	FLANCOMPL.IDLAN AS IDLAN,
	@ENVSERASA AS SERASA,
	@DTSERASA AS DATAENVIOSERASA
FROM FLAN (NOLOCK)
INNER JOIN FLANCOMPL (NOLOCK)
	ON(FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN)
WHERE FLAN.CODCOLIGADA = :CODCOLIGADA
AND FLAN.IDLAN = :IDLAN

";515;;;;16/08/2022;shift;0;1;1;1;;;;0;55b64bde-7c9b-4065-b72e-1322593553ba;;;141;shift;12/08/2022;shift;16/08/2022;
F;SH.FV.002;Consulta utilizada na FV 62 - Insere dados de cobrança Terceirizada/Jurídica;"/******
	AUTOR: LAERTE
	DESC.: CONSULTA UTILIZADA PARA ATUALIZAR DADOS DE ENVIO COBRANÇA TERCEIRIZADA
******/

DECLARE 
	@ENVCOB VARCHAR(1) = :COBJUD,
	@DATACOB DATETIME = :DATAJUD,
	@COB VARCHAR(20) = :COBRADOR;

SELECT 
	FLANCOMPL.CODCOLIGADA AS CODCOLIGADA,
	FLANCOMPL.IDLAN AS IDLAN,
	@ENVCOB AS ENVIOCOBJUD,
	@DATACOB AS DATAENVIOCOBJUD,
	@COB AS RESPCOBJUD
FROM FLAN (NOLOCK)

INNER JOIN FLANCOMPL (NOLOCK)
	ON(FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN)

WHERE FLAN.CODCOLIGADA = :CODCOLIGADA
AND FLAN.IDLAN = :IDLAN

";582;;;;16/08/2022;shift;0;1;1;1;;;;0;55b64bde-7c9b-4065-b72e-1322593553ba;;;-18529;shift;16/08/2022;shift;16/08/2022;
F;SH.FV.003;Consulta utilizada na FV 63 - Insere dados de cobrança Terceirizada/Jurídica;"/*****
	AUTOR: LAERTE
	DESC.: CONSULTA UTILIZADA PARA BUSCAR O COBRADOR
*****/
SELECT
	CODCOLIGADA,
	CODINTERNO,
	DESCRICAO	
FROM GCONSIST(NOLOCK)
WHERE CODTABELA = 'COBJUD'";182;;;;25/10/2022;shift;0;1;1;1;;;;0;55b64bde-7c9b-4065-b72e-1322593553ba;;;-28234;shift;15/08/2022;shift;25/10/2022;
F;SH.FV.005;Consulta utilizada na FV 65 - Atualizar dados Baixa Serasa;"/******
	AUTOR: LAERTE
	DESC.: CONSULTA UTILIZADA PARA ATUALIZAR DADOS DE BAIXA SERASA
******/
/***
	01 - LANÇAMENTOS QUITADOS
****/
	SELECT 
		FLANCOMPL.CODCOLIGADA AS CODCOLIGADA,
		FLANCOMPL.IDLAN AS IDLAN,
		FLAN.STATUSLAN,
		FLAN.DATABAIXA,
		CONVERT(VARCHAR(30), CAST(FLAN.DATABAIXA AS DATETIME), 120) AS DATABAIXAUP,
		ISNULL(FLANCOMPL.MOTIVOSERASA,'01') AS MOTIVOBAIXA
	FROM FLAN (NOLOCK)
	INNER JOIN FLANCOMPL (NOLOCK)
		ON(FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANCOMPL.IDLAN = FLAN.IDLAN
		AND FLANCOMPL.SERASA = 1
		AND (FLANCOMPL.DTBXSERASA IS NULL OR FLANCOMPL.MOTIVOSERASA IS NULL)
		AND FLAN.STATUSLAN IN (1,3)
		AND FLAN.PAGREC = 1)
	
	UNION 
	/***
		02 - LANÇAMENTOS RENEGOCIADOS 
	***/
	SELECT
		FLANCOMPL.CODCOLIGADA AS CODCOLIGADA,
		FLANCOMPL.IDLAN AS IDLAN,
		FLAN.STATUSLAN,
		GETDATE() AS DATABAIXA,
		CONVERT(VARCHAR(30), CAST(GETDATE() AS DATETIME), 120) AS DATABAIXAUP,
		ISNULL(FLANCOMPL.MOTIVOSERASA,'02') AS MOTIVOBAIXA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANCOMPL(NOLOCK)
		ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANCOMPL.IDLAN = FLAN.IDLAN
		AND FLANCOMPL.SERASA = 1 
		AND (FLANCOMPL.DTBXSERASA IS NULL OR FLANCOMPL.MOTIVOSERASA IS NULL)
		AND FLAN.STATUSLAN = 0
		AND FLAN.PAGREC = 1
		AND FLAN.DATAVENCIMENTO > GETDATE()
	
	UNION	
	/***
		03 - LANÇAMENTOS CANCELADOS 
	***/
	SELECT
		FLANCOMPL.CODCOLIGADA AS CODCOLIGADA,
		FLANCOMPL.IDLAN AS IDLAN,
		FLAN.STATUSLAN,
		GETDATE() AS DATABAIXA,
		CONVERT(VARCHAR(30), CAST(GETDATE() AS DATETIME), 120) AS DATABAIXAUP,
		ISNULL(FLANCOMPL.MOTIVOSERASA,'99') AS MOTIVOBAIXA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANCOMPL(NOLOCK)
		ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANCOMPL.IDLAN = FLAN.IDLAN
		AND FLANCOMPL.SERASA = 1 
		AND (FLANCOMPL.DTBXSERASA IS NULL OR FLANCOMPL.MOTIVOSERASA IS NULL)
		AND FLAN.STATUSLAN = 2
		AND FLAN.PAGREC = 1";1919;;;;20/10/2022;shift;0;1;1;1;;;;0;55b64bde-7c9b-4065-b72e-1322593553ba;;;-12487;shift;25/08/2022;shift;20/10/2022;
F;SH.FV.006;Consulta utilizada na FV 70 - Inserir número processo judicial;"/******
	AUTOR: LAERTE
	DESC.: CONSULTA UTILIZADA PARA ATUALIZAR NÚMERO PROCESSO JUDICIAL
******/

DECLARE 
	@NUMBERPROCESS VARCHAR(MAX) = :PROCESSO;

SELECT 
	FLANCOMPL.CODCOLIGADA AS CODCOLIGADA,
	FLANCOMPL.IDLAN AS IDLAN,
	@NUMBERPROCESS AS NUMEROPROCESSO
FROM FLAN (NOLOCK)
INNER JOIN FLANCOMPL (NOLOCK)
	ON(FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN)
WHERE FLAN.CODCOLIGADA = :CODCOLIGADA
AND FLAN.IDLAN = :IDLAN";466;;;;21/09/2022;shift;0;1;1;1;;;;0;55b64bde-7c9b-4065-b72e-1322593553ba;;;-16627;shift;21/09/2022;shift;21/09/2022;
F;SH.FV.007;Consulta utilizada na FV 92 - Registrar exclusão Serasa;"/******
	AUTOR: LAERTE
	DESC.: CONSULTA UTILIZADA PARA ATUALIZAR DADOS DE EXCLUSÃO SERASA
******/

DECLARE 
	@MOTSERASA VARCHAR(10) = :MOTIVOBAIXA,
	@DTEXSERASA DATETIME = :DAEXSERASA;

SELECT 
	FLANCOMPL.CODCOLIGADA AS CODCOLIGADA,
	FLANCOMPL.IDLAN AS IDLAN,
	@MOTSERASA AS MOTIVOBAIXA,
	@DTEXSERASA AS DATARETIRADA
FROM FLAN (NOLOCK)
INNER JOIN FLANCOMPL (NOLOCK)
	ON(FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN)
WHERE FLAN.CODCOLIGADA = :CODCOLIGADA
AND FLAN.IDLAN = :IDLAN

";530;;;;25/10/2022;shift;0;1;1;1;;;;0;55b64bde-7c9b-4065-b72e-1322593553ba;;;3437;shift;25/10/2022;shift;25/10/2022;
F;SH.FV.008;Consulta utilizada na FV 92- Registrar exclusão Serasa;"/*****
	AUTOR: LAERTE
	DESC.: CONSULTA UTILIZADA PARA BUSCAR O MOTIVO DA BAIXA SERASA
*****/
SELECT
	CODCOLIGADA,
	CODINTERNO,
	DESCRICAO	
FROM GCONSIST(NOLOCK)
WHERE CODTABELA = 'MTSERASA'";198;;;;25/10/2022;shift;0;1;1;1;;;;0;55b64bde-7c9b-4065-b72e-1322593553ba;;;-6235;shift;25/10/2022;shift;25/10/2022;
F;SH.GS;Consultas utilizadas em Geradores de Saídas;SELECT * FROM FINTEGRACAOCARTAO(NOLOCK) WHERE IDBOLETO = 153493;63;;;;05/10/2022;shift;0;1;1;1;;;;0;627c2cb8-a966-4780-b312-c818a0d11fb9;0;;-28874;shift;05/07/2022;shift;05/10/2022;0
F;SH.GS.001;Consulta utilizada no gerador (13 - Exportação Serasa - Inclusão);"/*****
	AUTOR: LAERTE
	DESCRIÇÃO: CONSULTA LANÇAMENTOS NEGATIVADOS PARA EXPORTAÇÃO DE ARQUIVO DE 
			   INCLUSÃO SERASA
******/
SELECT
	REPLACE(CONVERT(VARCHAR(10),GETDATE(),120),'-','')				  AS 'Data movimento',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data ocorrencia',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data termino',
	CONCAT(SCONTRATO.RA,'-',FLAN.IDLAN)								  AS 'Ref. Lançamento', 
	CONVERT(VARCHAR,DTINCSERAASA,103)	  							  AS 'Data inclusão SERASA',
	FCFO.TIPOPESSOA 												  AS 'Tipo pessoa',
	FCFO.TIPODOC													  AS 'Tipo primeiro doc',	
	REPLICATE('0',15 - LEN(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')))
	+ RTrim(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')) AS 'Valor devido',
	REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','') AS 'Valor total',
	FCFO.NOME 							  							  AS 'Cliente',
	REPLACE(CONVERT(VARCHAR(10),FCFO.DTNASCIMENTO,120),'-','') 		  AS 'Nascimento',
	FCFO.CPF														  AS 'CPFCNPJ',
	LEFT(FCFO.TELEFONE,2) 											  AS 'DDD Cliente',
	SUBSTRING(FCFO.TELEFONE,3,9)									  AS 'Telefone Cliente',
	CONCAT(FCFO.RUA,' ',FCFO.NUMERO)								  AS 'Rua',
	FCFO.BAIRRO														  AS 'Bairro',
	FCFO.COMPLEMENTO												  AS 'Complemento',
	FCFO.CEP 														  AS 'Cep',
	FCFO.CIDADE 													  AS 'Cidade',
	FCFO.UF 														  AS 'UF',
	GFILIAL.CNPJ													  AS 'CNPJ filial',
	GFILIAL.TELEFONE												  AS 'Telefone filial',
	GFILIAL.CONTATO													  AS 'Contato',
	GFILIAL.FILIALDIGITO											  AS 'Filial digito',
	'ME'															  AS 'Natureza Operação',
	ZMDSEQUENCIA.SEQ												  AS 'Numero seq. remessa'
	
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND FLANCOMPL.SERASA = 1 /*AND FLANCOMPL.DTINCSERAASA IS NOT NULL)*/
INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	AND SLAN.IDLAN = FLAN.IDLAN

INNER JOIN SPARCELA(NOLOCK)
	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA

INNER JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO		
/** DADOS CLI/FOR**/
CROSS APPLY(
	SELECT
		REPLACE(REPLACE(NOME, CHAR(13), ''), CHAR(10), '') AS NOME,
		COALESCE(DTNASCIMENTO, 00000000) AS DTNASCIMENTO,
		REPLICATE('0', 15 - LEN(REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-',''))) + REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-','') AS CPF,	
		SUBSTRING(RUA,1,39) AS RUA,
		SUBSTRING(NUMERO,1,5) AS NUMERO,
		SUBSTRING(BAIRRO,1,20) AS BAIRRO,
		COMPLEMENTO,
		SUBSTRING(CIDADE,1,25) AS CIDADE,
		CODETD AS UF,
		CEP,
		TELEFONE,
		PESSOAFISOUJUR AS TIPOPESSOA,
		CASE 
			WHEN FCFO.PESSOAFISOUJUR = 'F' THEN 2
		ELSE 1 END AS TIPODOC
	FROM FCFO(NOLOCK)	
	WHERE FCFO.CODCFO = FLAN.CODCFO
) AS FCFO
/** DADOS FILIAL **/
CROSS APPLY(
	SELECT 
		LEFT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),8) AS CNPJ,
		RIGHT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),6) AS FILIALDIGITO,
		REPLICATE('0', 16 - LEN(REPLACE(TELEFONE,' ',''))) + RTrim(REPLACE(TELEFONE,' ','')) AS TELEFONE,
		COALESCE(CONTATO,'Central de atendimento') AS CONTATO
	FROM GFILIAL(NOLOCK)
	WHERE CODCOLIGADA = 1
	AND CODFILIAL = FLAN.CODFILIAL
) AS GFILIAL
/** SEQUENCIA REMESSA **/
CROSS APPLY(
	SELECT
		MAX(SEQ) AS SEQ
	FROM ZMDSEQUENCIAREMSERASA(NOLOCK)
) AS ZMDSEQUENCIA
WHERE CONVERT(DATE,FLANCOMPL.RECMODIFIEDON) BETWEEN CONVERT(DATE,:DATAINICIAL_D) AND CONVERT(DATE,:DATAFINAL_D)";3790;;;;05/10/2022;shift;0;1;1;1;;;;0;627c2cb8-a966-4780-b312-c818a0d11fb9;0;;-25878;shift;05/07/2022;shift;05/10/2022;0
F;SH.GS.001.1;Consulta utilizada no gerador (13 - Exportação Serasa - Inclusão);"/*****
	AUTOR: LAERTE
	DESCRIÇÃO: CONSULTA LANÇAMENTOS NEGATIVADOS PARA EXPORTAÇÃO DE ARQUIVO DE 
			   INCLUSÃO SERASA
******/
SELECT
	REPLACE(CONVERT(VARCHAR(10),GETDATE(),120),'-','')				  AS 'Data movimento',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data ocorrencia',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data termino',
	CONCAT(SCONTRATO.RA,'-',FLAN.IDLAN)								  AS 'Ref. Lançamento', 
	CONVERT(VARCHAR,DTINCSERAASA,103)	  							  AS 'Data inclusão SERASA',
	FCFO.TIPOPESSOA 												  AS 'Tipo pessoa',
	FCFO.TIPODOC													  AS 'Tipo primeiro doc',	
	REPLICATE('0',15 - LEN(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')))
	+ RTrim(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')) AS 'Valor devido',
	REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','') AS 'Valor total',
	FCFO.NOME 							  							  AS 'Cliente',
	REPLACE(CONVERT(VARCHAR(10),FCFO.DTNASCIMENTO,120),'-','') 		  AS 'Nascimento',
	FCFO.CPF														  AS 'CPFCNPJ',
	LEFT(FCFO.TELEFONE,2) 											  AS 'DDD Cliente',
	SUBSTRING(FCFO.TELEFONE,3,9)									  AS 'Telefone Cliente',
	CONCAT(FCFO.RUA,' ',FCFO.NUMERO)								  AS 'Rua',
	FCFO.BAIRRO														  AS 'Bairro',
	FCFO.COMPLEMENTO												  AS 'Complemento',
	FCFO.CEP 														  AS 'Cep',
	FCFO.CIDADE 													  AS 'Cidade',
	FCFO.UF 														  AS 'UF',
	GFILIAL.CNPJ													  AS 'CNPJ filial',
	GFILIAL.TELEFONE												  AS 'Telefone filial',
	GFILIAL.CONTATO													  AS 'Contato',
	GFILIAL.FILIALDIGITO											  AS 'Filial digito',
	'ME'															  AS 'Natureza Operação',
	ZMDSEQUENCIA.SEQ												  AS 'Numero seq. remessa'
	
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND FLANCOMPL.SERASA = 1 /*AND FLANCOMPL.DTINCSERAASA IS NOT NULL)*/
INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	AND SLAN.IDLAN = FLAN.IDLAN

INNER JOIN SPARCELA(NOLOCK)
	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA

INNER JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO		
/** DADOS CLI/FOR**/
CROSS APPLY(
	SELECT
		REPLACE(REPLACE(NOME, CHAR(13), ''), CHAR(10), '') AS NOME,
		COALESCE(DTNASCIMENTO, 00000000) AS DTNASCIMENTO,
		REPLICATE('0', 15 - LEN(REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-',''))) + REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-','') AS CPF,	
		SUBSTRING(RUA,1,39) AS RUA,
		SUBSTRING(NUMERO,1,5) AS NUMERO,
		SUBSTRING(BAIRRO,1,20) AS BAIRRO,
		COMPLEMENTO,
		SUBSTRING(CIDADE,1,25) AS CIDADE,
		CODETD AS UF,
		CEP,
		TELEFONE,
		PESSOAFISOUJUR AS TIPOPESSOA,
		CASE 
			WHEN FCFO.PESSOAFISOUJUR = 'F' THEN 2
		ELSE 1 END AS TIPODOC
	FROM FCFO(NOLOCK)	
	WHERE FCFO.CODCFO = FLAN.CODCFO
) AS FCFO
/** DADOS FILIAL **/
CROSS APPLY(
	SELECT 
		LEFT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),8) AS CNPJ,
		RIGHT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),6) AS FILIALDIGITO,
		REPLICATE('0', 16 - LEN(REPLACE(TELEFONE,' ',''))) + RTrim(REPLACE(TELEFONE,' ','')) AS TELEFONE,
		COALESCE(CONTATO,'Central de atendimento') AS CONTATO
	FROM GFILIAL(NOLOCK)
	WHERE CODCOLIGADA = 1
	AND CODFILIAL = FLAN.CODFILIAL
) AS GFILIAL
/** SEQUENCIA REMESSA **/
CROSS APPLY(
	SELECT
		MAX(SEQ) AS SEQ
	FROM ZMDSEQUENCIAREMSERASA(NOLOCK)
) AS ZMDSEQUENCIA
WHERE FLAN.DATAVENCIMENTO > GETDATE()";3716;;;;17/10/2022;shift;0;1;1;1;;;;0;627c2cb8-a966-4780-b312-c818a0d11fb9;0;;-25289;shift;17/10/2022;shift;17/10/2022;0
F;SH.GS.002;Consulta utilizada no gerador (15 - Exportação Serasa - Exclusão);"/*****
	AUTOR: LAERTE
	DESCRIÇÃO: CONSULTA LANÇAMENTOS NEGATIVADOS PARA EXPORTAÇÃO DE ARQUIVO DE 
			   EXCLUSÃO SERASA
******/
SELECT
	REPLACE(CONVERT(VARCHAR(10),GETDATE(),120),'-','')				  AS 'Data movimento',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data ocorrencia',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data termino',
	CONCAT(SCONTRATO.RA,'-',FLAN.IDLAN)								  AS 'Ref. Lançamento', 
	CONVERT(VARCHAR,DTINCSERAASA,103)	  							  AS 'Data inclusão SERASA',
	FCFO.TIPOPESSOA 												  AS 'Tipo pessoa',
	FCFO.TIPODOC													  AS 'Tipo primeiro doc',	
	REPLICATE('0',15 - LEN(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')))
	+ RTrim(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')) AS 'Valor devido',
	REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','') AS 'Valor total',
	FCFO.NOME 							  							  AS 'Cliente',
	REPLACE(CONVERT(VARCHAR(10),FCFO.DTNASCIMENTO,120),'-','') 		  AS 'Nascimento',
	FCFO.CPF														  AS 'CPFCNPJ',
	LEFT(FCFO.TELEFONE,2) 											  AS 'DDD Cliente',
	SUBSTRING(FCFO.TELEFONE,3,9)									  AS 'Telefone Cliente',
	CONCAT(FCFO.RUA,' ',FCFO.NUMERO)								  AS 'Rua',
	FCFO.BAIRRO														  AS 'Bairro',
	FCFO.COMPLEMENTO												  AS 'Complemento',
	FCFO.CEP 														  AS 'Cep',
	FCFO.CIDADE 													  AS 'Cidade',
	FCFO.UF 														  AS 'UF',
	GFILIAL.CNPJ													  AS 'CNPJ filial',
	GFILIAL.TELEFONE												  AS 'Telefone filial',
	GFILIAL.CONTATO													  AS 'Contato',
	GFILIAL.FILIALDIGITO											  AS 'Filial digito',
	'ME'															  AS 'Natureza Operação',
	FLANCOMPL.MOTIVOSERASA											  AS 'Motivo baixa',
	ZMDSEQUENCIA.SEQ												  AS 'Numero seq. remessa'
	
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND FLANCOMPL.SERASA = 1
	AND FLANCOMPL.DTBXSERASA IS NOT NULL 
	AND FLANCOMPL.MOTIVOSERASA IS NOT NULL
	
INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	AND SLAN.IDLAN = FLAN.IDLAN

INNER JOIN SPARCELA(NOLOCK)
	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA

INNER JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO		
/** DADOS CLI/FOR**/
CROSS APPLY(
	SELECT
		REPLACE(REPLACE(NOME, CHAR(13), ''), CHAR(10), '') AS NOME,
		COALESCE(DTNASCIMENTO, 00000000) AS DTNASCIMENTO,
		REPLICATE('0', 15 - LEN(REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-',''))) + REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-','') AS CPF,	
		SUBSTRING(RUA,1,39) AS RUA,
		SUBSTRING(NUMERO,1,5) AS NUMERO,
		SUBSTRING(BAIRRO,1,20) AS BAIRRO,
		COMPLEMENTO,
		SUBSTRING(CIDADE,1,25) AS CIDADE,
		CODETD AS UF,
		CEP,
		TELEFONE,
		PESSOAFISOUJUR AS TIPOPESSOA,
		CASE 
			WHEN FCFO.PESSOAFISOUJUR = 'F' THEN 2
		ELSE 1 END AS TIPODOC
	FROM FCFO(NOLOCK)	
	WHERE FCFO.CODCFO = FLAN.CODCFO
) AS FCFO
/** DADOS FILIAL **/
CROSS APPLY(
	SELECT 
		LEFT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),8) AS CNPJ,
		RIGHT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),6) AS FILIALDIGITO,
		REPLICATE('0', 16 - LEN(REPLACE(TELEFONE,' ',''))) + RTrim(REPLACE(TELEFONE,' ','')) AS TELEFONE,
		COALESCE(CONTATO,'Central de atendimento') AS CONTATO
	FROM GFILIAL(NOLOCK)
	WHERE CODCOLIGADA = 1
	AND CODFILIAL = FLAN.CODFILIAL
) AS GFILIAL
/** SEQUENCIA REMESSA **/
CROSS APPLY(
	SELECT
		MAX(SEQ) AS SEQ
	FROM ZMDSEQUENCIAREMSERASA(NOLOCK)
) AS ZMDSEQUENCIA
WHERE CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,:DATAINICIAL_D) AND CONVERT(DATE,:DATAFINAL_D)
AND FLAN.STATUSLAN IN (1,3)

UNION ALL
/***
	LANÇAMENTO RENEGOCIADOS
***/
SELECT
	REPLACE(CONVERT(VARCHAR(10),GETDATE(),120),'-','')				  AS 'Data movimento',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data ocorrencia',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data termino',
	CONCAT(SCONTRATO.RA,'-',FLAN.IDLAN)								  AS 'Ref. Lançamento', 
	CONVERT(VARCHAR,DTINCSERAASA,103)	  							  AS 'Data inclusão SERASA',
	FCFO.TIPOPESSOA 												  AS 'Tipo pessoa',
	FCFO.TIPODOC													  AS 'Tipo primeiro doc',	
	REPLICATE('0',15 - LEN(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')))
	+ RTrim(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')) AS 'Valor devido',
	REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','') AS 'Valor total',
	FCFO.NOME 							  							  AS 'Cliente',
	REPLACE(CONVERT(VARCHAR(10),FCFO.DTNASCIMENTO,120),'-','') 		  AS 'Nascimento',
	FCFO.CPF														  AS 'CPFCNPJ',
	LEFT(FCFO.TELEFONE,2) 											  AS 'DDD Cliente',
	SUBSTRING(FCFO.TELEFONE,3,9)									  AS 'Telefone Cliente',
	CONCAT(FCFO.RUA,' ',FCFO.NUMERO)								  AS 'Rua',
	FCFO.BAIRRO														  AS 'Bairro',
	FCFO.COMPLEMENTO												  AS 'Complemento',
	FCFO.CEP 														  AS 'Cep',
	FCFO.CIDADE 													  AS 'Cidade',
	FCFO.UF 														  AS 'UF',
	GFILIAL.CNPJ													  AS 'CNPJ filial',
	GFILIAL.TELEFONE												  AS 'Telefone filial',
	GFILIAL.CONTATO													  AS 'Contato',
	GFILIAL.FILIALDIGITO											  AS 'Filial digito',
	'ME'															  AS 'Natureza Operação',
	FLANCOMPL.MOTIVOSERASA											  AS 'Motivo baixa',
	ZMDSEQUENCIA.SEQ												  AS 'Numero seq. remessa'
	
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND FLANCOMPL.SERASA = 1
	AND FLANCOMPL.DTBXSERASA IS NOT NULL 
	AND FLANCOMPL.MOTIVOSERASA IS NOT NULL
	
INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	AND SLAN.IDLAN = FLAN.IDLAN

INNER JOIN SPARCELA(NOLOCK)
	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA

INNER JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO		
/** DADOS CLI/FOR**/
CROSS APPLY(
	SELECT
		REPLACE(REPLACE(NOME, CHAR(13), ''), CHAR(10), '') AS NOME,
		COALESCE(DTNASCIMENTO, 00000000) AS DTNASCIMENTO,
		REPLICATE('0', 15 - LEN(REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-',''))) + REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-','') AS CPF,	
		SUBSTRING(RUA,1,39) AS RUA,
		SUBSTRING(NUMERO,1,5) AS NUMERO,
		SUBSTRING(BAIRRO,1,20) AS BAIRRO,
		COMPLEMENTO,
		SUBSTRING(CIDADE,1,25) AS CIDADE,
		CODETD AS UF,
		CEP,
		TELEFONE,
		PESSOAFISOUJUR AS TIPOPESSOA,
		CASE 
			WHEN FCFO.PESSOAFISOUJUR = 'F' THEN 2
		ELSE 1 END AS TIPODOC
	FROM FCFO(NOLOCK)	
	WHERE FCFO.CODCFO = FLAN.CODCFO
) AS FCFO
/** DADOS FILIAL **/
CROSS APPLY(
	SELECT 
		LEFT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),8) AS CNPJ,
		RIGHT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),6) AS FILIALDIGITO,
		REPLICATE('0', 16 - LEN(REPLACE(TELEFONE,' ',''))) + RTrim(REPLACE(TELEFONE,' ','')) AS TELEFONE,
		COALESCE(CONTATO,'Central de atendimento') AS CONTATO
	FROM GFILIAL(NOLOCK)
	WHERE CODCOLIGADA = 1
	AND CODFILIAL = FLAN.CODFILIAL
) AS GFILIAL
/** SEQUENCIA REMESSA **/
CROSS APPLY(
	SELECT
		MAX(SEQ) AS SEQ
	FROM ZMDSEQUENCIAREMSERASA(NOLOCK)
) AS ZMDSEQUENCIA
WHERE CONVERT(DATE,FLANCOMPL.DTBXSERASA) BETWEEN CONVERT(DATE,:DATAINICIAL_D) AND CONVERT(DATE,:DATAFINAL_D)
AND FLAN.STATUSLAN = 0
UNION ALL
/***
	LANÇAMENTO CANCELADOS
***/
SELECT
	REPLACE(CONVERT(VARCHAR(10),GETDATE(),120),'-','')				  AS 'Data movimento',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data ocorrencia',
	REPLACE(CONVERT(VARCHAR(10),FLAN.DATAVENCIMENTO,120),'-','')	  AS 'Data termino',
	CONCAT(SCONTRATO.RA,'-',FLAN.IDLAN)								  AS 'Ref. Lançamento', 
	CONVERT(VARCHAR,DTINCSERAASA,103)	  							  AS 'Data inclusão SERASA',
	FCFO.TIPOPESSOA 												  AS 'Tipo pessoa',
	FCFO.TIPODOC													  AS 'Tipo primeiro doc',	
	REPLICATE('0',15 - LEN(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')))
	+ RTrim(REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','')) AS 'Valor devido',
	REPLACE(REPLACE(REPLACE(CONVERT(DECIMAL(10,2),FLAN.VALORORIGINAL),',',''),'.',''),' ','') AS 'Valor total',
	FCFO.NOME 							  							  AS 'Cliente',
	REPLACE(CONVERT(VARCHAR(10),FCFO.DTNASCIMENTO,120),'-','') 		  AS 'Nascimento',
	FCFO.CPF														  AS 'CPFCNPJ',
	LEFT(FCFO.TELEFONE,2) 											  AS 'DDD Cliente',
	SUBSTRING(FCFO.TELEFONE,3,9)									  AS 'Telefone Cliente',
	CONCAT(FCFO.RUA,' ',FCFO.NUMERO)								  AS 'Rua',
	FCFO.BAIRRO														  AS 'Bairro',
	FCFO.COMPLEMENTO												  AS 'Complemento',
	FCFO.CEP 														  AS 'Cep',
	FCFO.CIDADE 													  AS 'Cidade',
	FCFO.UF 														  AS 'UF',
	GFILIAL.CNPJ													  AS 'CNPJ filial',
	GFILIAL.TELEFONE												  AS 'Telefone filial',
	GFILIAL.CONTATO													  AS 'Contato',
	GFILIAL.FILIALDIGITO											  AS 'Filial digito',
	'ME'															  AS 'Natureza Operação',
	FLANCOMPL.MOTIVOSERASA											  AS 'Motivo baixa',
	ZMDSEQUENCIA.SEQ												  AS 'Numero seq. remessa'
	
FROM FLAN(NOLOCK)
INNER JOIN FLANCOMPL(NOLOCK)
	ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANCOMPL.IDLAN = FLAN.IDLAN
	AND FLANCOMPL.SERASA = 1
	AND FLANCOMPL.DTBXSERASA IS NOT NULL 
	AND FLANCOMPL.MOTIVOSERASA IS NOT NULL
	
INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	AND SLAN.IDLAN = FLAN.IDLAN

INNER JOIN SPARCELA(NOLOCK)
	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA

INNER JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO		
/** DADOS CLI/FOR**/
CROSS APPLY(
	SELECT
		REPLACE(REPLACE(NOME, CHAR(13), ''), CHAR(10), '') AS NOME,
		COALESCE(DTNASCIMENTO, 00000000) AS DTNASCIMENTO,
		REPLICATE('0', 15 - LEN(REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-',''))) + REPLACE(REPLACE(REPLACE(CGCCFO,'.',''),'.',''),'-','') AS CPF,	
		SUBSTRING(RUA,1,39) AS RUA,
		SUBSTRING(NUMERO,1,5) AS NUMERO,
		SUBSTRING(BAIRRO,1,20) AS BAIRRO,
		COMPLEMENTO,
		SUBSTRING(CIDADE,1,25) AS CIDADE,
		CODETD AS UF,
		CEP,
		TELEFONE,
		PESSOAFISOUJUR AS TIPOPESSOA,
		CASE 
			WHEN FCFO.PESSOAFISOUJUR = 'F' THEN 2
		ELSE 1 END AS TIPODOC
	FROM FCFO(NOLOCK)	
	WHERE FCFO.CODCFO = FLAN.CODCFO
) AS FCFO
/** DADOS FILIAL **/
CROSS APPLY(
	SELECT 
		LEFT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),8) AS CNPJ,
		RIGHT(REPLACE(REPLACE(REPLACE(REPLACE(CGC,'.',''),'.',''),'/',''),'-',''),6) AS FILIALDIGITO,
		REPLICATE('0', 16 - LEN(REPLACE(TELEFONE,' ',''))) + RTrim(REPLACE(TELEFONE,' ','')) AS TELEFONE,
		COALESCE(CONTATO,'Central de atendimento') AS CONTATO
	FROM GFILIAL(NOLOCK)
	WHERE CODCOLIGADA = 1
	AND CODFILIAL = FLAN.CODFILIAL
) AS GFILIAL
/** SEQUENCIA REMESSA **/
CROSS APPLY(
	SELECT
		MAX(SEQ) AS SEQ
	FROM ZMDSEQUENCIAREMSERASA(NOLOCK)
) AS ZMDSEQUENCIA
WHERE CONVERT(DATE,FLANCOMPL.DTBXSERASA) BETWEEN CONVERT(DATE,:DATAINICIAL_D) AND CONVERT(DATE,:DATAFINAL_D)
AND FLAN.STATUSLAN = 2";11556;;;;20/10/2022;shift;0;1;1;1;;;;0;627c2cb8-a966-4780-b312-c818a0d11fb9;0;;20320;shift;25/08/2022;shift;20/10/2022;0
F;TEMP;FILTRO TEMPORÁRIO;SELECT * FROM FLAN WHERE IDLAN = 265705;39;;;;01/06/2022;marli.oliveira;0;1;1;1;;;;0;da316cf6-5b10-44cf-af5e-51b1ef6ecf69;0;;-31985;marli.oliveira;03/03/2022;marli.oliveira;01/06/2022;0
F;TESTECONSULTOR;TESTE CONSULTOR;"SELECT *
FROM SCONTRATO
WHERE CODCONTRATO IN (
111939)";57;;;;19/07/2022;consultor1.totvs;0;1;1;1;;;;0;ea4d2eb2-80ba-4384-ab63-a86c9a437873;0;;-24673;consultor1.totvs;10/03/2022;consultor1.totvs;19/07/2022;0
F;testeIPL;teste;"SELECT DISTINCT
	NomFilial,
	NomTipoCurso,
	NomCurso,
	NomStatus,
	CODPERLET,
	isnull(NomTipoMatricula, 'Matrícula') NomTipoMatricula,
	p.NOME,
	p.EMAIL,
	Coalesce(p.Telefone1, p.Telefone2, p.Telefone3) Telefone,
	p.CPF,
	v.RA
FROM 
	v_Unasp_SMATRICPL v
	inner join PPESSOA p  on p.CODIGO=v.CODPESSOA
";301;;;;02/05/2022;edison.pitoli;0;1;1;1;;;;0;f0a570b0-5ba6-4b16-9368-cd29724a4a7e;0;;32706;raphael.muzy;25/10/2021;edison.pitoli;02/05/2022;0
F;TI.004;Usuario Logado;"SELECT GUSUARIO.CODUSUARIO,
       GUSUARIO.NOME
FROM   GUSUARIO
WHERE  CODUSUARIO LIKE '%' + CAST(:CODUSUARIO1 AS VARCHAR) + '%'
/*CODUSUARIO = :CODUSUARIO1*/
";165;;;;07/04/2022;consultor1.totvs;0;1;1;1;;;;;9762f01a-694c-419c-b135-bbf3b937ad18;;;-5643;marli.oliveira;28/03/2022;consultor1.totvs;07/04/2022;
F;VL_BOLSAINC;Valor da Bolsa Incondicional;"SELECT
 SUM(FLANINTEGRACAO.VALOR) VALOR

FROM
 FLANINTEGRACAO (NOLOCK)
 
 INNER JOIN FLANINTEGRACAODEF (NOLOCK)	ON FLANINTEGRACAODEF.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA AND 
 										   FLANINTEGRACAODEF.IDCAMPO = FLANINTEGRACAO.IDCAMPO AND
 										   FLANINTEGRACAODEF.ATEVENCIMENTO = 0
 										   
WHERE	FLANINTEGRACAO.CODCOLIGADA = :FRM_COLIGADA
	AND FLANINTEGRACAO.IDLAN = :FRM_IDLAN	";412;;;;28/06/2022;robson.canto;0;1;1;1;;;;0;59ca56b1-288b-41c2-a5d7-65f0993fa269;0;;-20447;robson.canto;28/06/2022;robson.canto;28/06/2022;0
G;10.010.002;Conselho de Classe;"DECLARE @RA VARCHAR (255)
DECLARE @PERLETIVO VARCHAR (255)
SET @RA = :RA_S
SET @PERLETIVO = :CODPERLET_S

                SELECT 
                               SMATRICULA.RA,
PPESSOA.NOME,
PPESSOA.DTNASCIMENTO,
(SELECT GIMAGEM.IMAGEM FROM GIMAGEM WHERE GIMAGEM.ID = PPESSOA.IDIMAGEM) AS IMAGEM,
DATEDIFF ( YEAR, PPESSOA.DTNASCIMENTO, GETDATE() ) AS IDADE,
                  STURMADISC.CODTURMA,
                  SDISCIPLINA.CODDISC,
                  SDISCIPLINA.NOME DISCIPLINA,
                  SSTATUS.DESCRICAO STATUS,
                  SCURSO.NOME AS CURSO,
                  N1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN NOTAFALTA END),
                  N2 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN NOTAFALTA END),
                  N3 = MAX(CASE WHEN SETAPAS.CODETAPA = 5 AND SETAPAS.TIPOETAPA = 'N' THEN NOTAFALTA END),
                  N4 = MAX(CASE WHEN SETAPAS.CODETAPA = 7 AND SETAPAS.TIPOETAPA = 'N' THEN NOTAFALTA END),
                  N5 = MAX(CASE WHEN SETAPAS.CODETAPA = 8 AND SETAPAS.TIPOETAPA = 'N' THEN NOTAFALTA END),
                  N6 = MAX(CASE WHEN SETAPAS.CODETAPA = 9 AND SETAPAS.TIPOETAPA = 'N' THEN NOTAFALTA END),

    F1 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'F' THEN NOTAFALTA END),
    F2 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'F' THEN NOTAFALTA END),
    F3 = MAX(CASE WHEN SETAPAS.CODETAPA = 6 AND SETAPAS.TIPOETAPA = 'F' THEN NOTAFALTA END)
                  
                FROM   
                  STURMADISC,
                  SDISCIPLINA,
                  SSTATUS,
                  SMATRICULA
                  LEFT JOIN SETAPAS ON
                      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
                      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
                  LEFT JOIN SNOTAETAPA ON
                      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
                      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
                      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
                      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
                      SNOTAETAPA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
                      AND SNOTAETAPA.RA = SMATRICULA.RA,
                  SPLETIVO,
                  SALUNO,
                  PPESSOA,
                  SHABILITACAOALUNO,
                  SHABILITACAOFILIAL,
                  SGRADE,
                  SCURSO
                 
                WHERE 
                  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
                  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
                  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
                  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
                  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
                  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS 
                  AND SPLETIVO.IDPERLET = SMATRICULA.IDPERLET
                  AND SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                  AND SALUNO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                  AND SALUNO.RA = SMATRICULA.RA
                  AND SALUNO.CODPESSOA = PPESSOA.CODIGO
                  AND SHABILITACAOALUNO.RA = SMATRICULA.RA
                  AND SHABILITACAOALUNO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                  AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
                  AND SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                  AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE
                  AND SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
                  AND SCURSO.CODCURSO = SGRADE.CODCURSO
                  AND SCURSO.CODCOLIGADA = SGRADE.CODCOLIGADA
                  AND SPLETIVO.CODPERLET = @PERLETIVO
                  AND SMATRICULA.RA = @RA
                  
                GROUP BY
                  STURMADISC.CODTURMA,
                  SMATRICULA.RA,
                  SDISCIPLINA.CODDISC,
                  SDISCIPLINA.NOME,
                  SSTATUS.DESCRICAO,
                  SCURSO.NOME,
PPESSOA.NOME,
PPESSOA.DTNASCIMENTO,
PPESSOA.IDIMAGEM
";4290;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-1879;RM;30/05/2012;RM;30/05/2012;
G;110.001;Fluxo de Caixa - Mensal;"SELECT  CASE
                  WHEN LEN (TAB.DIA) = 1 THEN '0' + TAB.DIA
                  ELSE TAB.DIA
            END AS VENCIMENTO,      
            ISNULL (SUM(TAB.VALORPAGAR),0 )  AS PAGAR,
            ISNULL (SUM(TAB.VALORRECEBER),0) AS RECEBER 
  FROM  
                  (    SELECT CONVERT (VARCHAR, DAY (FLAN.DATAVENCIMENTO)) AS DIA,                                          
                                CASE FLAN.PAGREC
                                     WHEN 2 THEN SUM(FLAN.VALORORIGINAL)
                                END AS VALORPAGAR,
                                CASE FLAN.PAGREC
                                                      WHEN 1 THEN SUM(FLAN.VALORORIGINAL)
                                               END AS VALORRECEBER
                                   FROM GCOLIGADA  (NOLOCK)
                             , GFILIAL         (NOLOCK)
                             , FLAN            (NOLOCK)
                             , GCCUSTO         (NOLOCK)
                             , FCFO            (NOLOCK)
                        WHERE GFILIAL.CODCOLIGADA        = GCOLIGADA.CODCOLIGADA 
                                     AND         FLAN.CODCOLIGADA     = GFILIAL.CODCOLIGADA      
                                     AND         FLAN.CODFILIAL       = GFILIAL.CODFILIAL          
                                     AND         ((FLAN.PAGREC        = 1) 
                           OR          (FLAN.PAGREC        = 2))      
                                     AND         FLAN.CODCCUSTO      *= GCCUSTO.CODCCUSTO
                                     AND         FLAN.CODCOLIGADA    *= GCCUSTO.CODCOLIGADA     
                                     AND         FLAN.STATUSLAN       = 0                          
                                     AND         FCFO.CODCOLIGADA     = FLAN.CODCOLCFO           
                                     AND         FCFO.CODCFO          = FLAN.CODCFO                   
                                     AND         FLAN.DATAVENCIMENTO >= '05/01/2009'          
                                     AND         FLAN.DATAVENCIMENTO <= '05/31/2009' 
                                     GROUP BY CONVERT (VARCHAR, DAY (FLAN.DATAVENCIMENTO))
                                                             , FLAN.PAGREC
                    ) AS TAB
GROUP BY TAB.DIA                
ORDER BY CASE
                  WHEN LEN (TAB.DIA) = 1 THEN '0' + TAB.DIA
                  ELSE TAB.DIA
            END 

";2537;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-5515;RM;30/05/2012;RM;30/05/2012;
G;990.040.004;Evolução anual da inadimplencia;"SELECT 
  SCURSO.NOME,
  'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORORIGINAL END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORORIGINAL END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORORIGINAL END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORORIGINAL END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORORIGINAL END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORORIGINAL END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORORIGINAL END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORORIGINAL END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORORIGINAL END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORORIGINAL END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORORIGINAL END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORORIGINAL END)
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE() AND
  SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA_I AND
  SHABILITACAOFILIAL.CODCURSO = :CODCURSO_S
GROUP BY 
  SCURSO.NOME
ORDER BY
  SCURSO.NOME";2453;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-10571;RM;30/05/2012;RM;30/05/2012;
G;9.900.400.040.001;Evolução anual da inadimplencia;"SELECT 
  SCURSO.NOME,
  'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORORIGINAL END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORORIGINAL END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORORIGINAL END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORORIGINAL END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORORIGINAL END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORORIGINAL END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORORIGINAL END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORORIGINAL END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORORIGINAL END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORORIGINAL END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORORIGINAL END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORORIGINAL END)
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE() AND
  SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA_I AND
  SHABILITACAOFILIAL.CODCURSO = :CODCURSO_S
GROUP BY 
  SCURSO.NOME
ORDER BY
  SCURSO.NOME";2453;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-10571;RM;30/05/2012;RM;30/05/2012;
G;99.005;Notas Aluno por Etapa - ;"SELECT
  SDISCIPLINA.NOMEREDUZIDO + ' - ' + SETAPAS.DESCRICAO as nota_etapa,
  SNOTAETAPA.NOTAFALTA Nota
FROM
  SMATRICULA (NOLOCK), 
  STURMADISC (NOLOCK), 
  SDISCIPLINA (NOLOCK),
  SPLETIVO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SETAPAS (NOLOCK),
  SNOTAETAPA (NOLOCK)
WHERE
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND  
  STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  STURMADISC.IDPERLET = SPLETIVO.IDPERLET AND
  SMATRICULA.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
  STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC AND
  SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
  SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
  SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
  SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
  SNOTAETAPA.RA = SMATRICULA.RA AND
/*  SETAPAS.ETAPAFINAL = 'S' AND
  SETAPAS.TIPOETAPA = 'N' AND*/
  SMATRICULA.CODCOLIGADA = 1 AND
  SMATRICULA.RA =:RA AND    
  SPLETIVO.CODPERLET = :CODPERLET AND
  SHABILITACAOFILIAL.CODCURSO = :CODCURSO
ORDER BY 
  SDISCIPLINA.NOMEREDUZIDO,
  SETAPAS.CODETAPA
";1364;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;15232;RM;30/05/2012;RM;30/05/2012;
G;990.050.001;Notas Aluno por Etapa - ;"SELECT
  SDISCIPLINA.NOMEREDUZIDO + ' - ' + SETAPAS.DESCRICAO as nota_etapa,
  SNOTAETAPA.NOTAFALTA Nota
FROM
  SMATRICULA (NOLOCK), 
  STURMADISC (NOLOCK), 
  SDISCIPLINA (NOLOCK),
  SPLETIVO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SETAPAS (NOLOCK),
  SNOTAETAPA (NOLOCK)
WHERE
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND  
  STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  STURMADISC.IDPERLET = SPLETIVO.IDPERLET AND
  SMATRICULA.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
  STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC AND
  SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
  SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
  SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
  SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
  SNOTAETAPA.RA = SMATRICULA.RA AND
/*  SETAPAS.ETAPAFINAL = 'S' AND
  SETAPAS.TIPOETAPA = 'N' AND*/
  SMATRICULA.CODCOLIGADA = 1 AND
  SMATRICULA.RA =:RA AND    
  SPLETIVO.CODPERLET = :CODPERLET AND
  SHABILITACAOFILIAL.CODCURSO = :CODCURSO
ORDER BY 
  SDISCIPLINA.NOMEREDUZIDO,
  SETAPAS.CODETAPA
";1364;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;15232;RM;30/05/2012;RM;30/05/2012;
G;99.006;Faltas Aluno por Etapa;"SELECT
  SDISCIPLINA.NOMEREDUZIDO + ' - ' + SETAPAS.DESCRICAO as nota_etapa,
  SNOTAETAPA.NOTAFALTA Nota
FROM
  SMATRICULA (NOLOCK), 
  STURMADISC (NOLOCK), 
  SDISCIPLINA (NOLOCK),
  SPLETIVO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SETAPAS (NOLOCK),
  SNOTAETAPA (NOLOCK)
WHERE
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND  
  STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  STURMADISC.IDPERLET = SPLETIVO.IDPERLET AND
  SMATRICULA.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
  STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC AND
  SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
  SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
  SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
  SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
  SNOTAETAPA.RA = SMATRICULA.RA AND
/*  SETAPAS.ETAPAFINAL = 'S' AND */
  SETAPAS.TIPOETAPA = 'F' AND
/*  SMATRICULA.CODCOLIGADA = 2 AND*/
  SMATRICULA.RA =:RA AND    
  SPLETIVO.CODPERLET = '2004/1' AND
  SHABILITACAOFILIAL.CODCURSO = '2-1' AND
  SHABILITACAOFILIAL.CODHABILITACAO = '1' AND
  SHABILITACAOFILIAL.CODGRADE = '5'
ORDER BY 
  SDISCIPLINA.NOMEREDUZIDO,
  SETAPAS.CODETAPA";1449;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;28745;RM;30/05/2012;RM;30/05/2012;
G;990.060.001;Faltas Aluno por Etapa;"SELECT
  SDISCIPLINA.NOMEREDUZIDO + ' - ' + SETAPAS.DESCRICAO as nota_etapa,
  SNOTAETAPA.NOTAFALTA Nota
FROM
  SMATRICULA (NOLOCK), 
  STURMADISC (NOLOCK), 
  SDISCIPLINA (NOLOCK),
  SPLETIVO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SETAPAS (NOLOCK),
  SNOTAETAPA (NOLOCK)
WHERE
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND  
  STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  STURMADISC.IDPERLET = SPLETIVO.IDPERLET AND
  SMATRICULA.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
  STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC AND
  SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
  SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
  SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
  SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
  SNOTAETAPA.RA = SMATRICULA.RA AND
/*  SETAPAS.ETAPAFINAL = 'S' AND */
  SETAPAS.TIPOETAPA = 'F' AND
/*  SMATRICULA.CODCOLIGADA = 2 AND*/
  SMATRICULA.RA =:RA AND    
  SPLETIVO.CODPERLET = '20081' AND
  SHABILITACAOFILIAL.CODCURSO = '01' AND
  SHABILITACAOFILIAL.CODHABILITACAO = '01' AND
  SHABILITACAOFILIAL.CODGRADE = '20081'
ORDER BY 
  SDISCIPLINA.NOMEREDUZIDO,
  SETAPAS.CODETAPA";1452;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;27047;RM;30/05/2012;RM;30/05/2012;
G;99.007;Total x Pago - Parcelas;"SELECT  
 'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORORIGINAL END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORORIGINAL END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORORIGINAL END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORORIGINAL END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORORIGINAL END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORORIGINAL END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORORIGINAL END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORORIGINAL END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORORIGINAL END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORORIGINAL END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORORIGINAL END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORORIGINAL END),
'A Pagar'



FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SMATRICPL.RA=:RA 

UNION

SELECT 
 'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORBAIXADO END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORBAIXADO END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORBAIXADO END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORBAIXADO END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORBAIXADO END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORBAIXADO END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORBAIXADO END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORBAIXADO END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORBAIXADO END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORBAIXADO END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORBAIXADO END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORBAIXADO END),
 'Pago '



FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SMATRICPL.RA=:RA and
  FLAN.DATABAIXA IS NOT NULL



";4560;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;203;RM;30/05/2012;RM;30/05/2012;
G;990.070.003;Total x Pago - Parcelas;"SELECT  
 'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORORIGINAL END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORORIGINAL END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORORIGINAL END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORORIGINAL END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORORIGINAL END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORORIGINAL END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORORIGINAL END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORORIGINAL END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORORIGINAL END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORORIGINAL END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORORIGINAL END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORORIGINAL END),
'A Pagar'



FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SMATRICPL.RA=:RA 

UNION

SELECT 
 'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORBAIXADO END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORBAIXADO END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORBAIXADO END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORBAIXADO END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORBAIXADO END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORBAIXADO END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORBAIXADO END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORBAIXADO END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORBAIXADO END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORBAIXADO END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORBAIXADO END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORBAIXADO END),
 'Pago '



FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SMATRICPL.RA=:RA and
  FLAN.DATABAIXA IS NOT NULL



";4560;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;203;RM;30/05/2012;RM;30/05/2012;
G;B00001;NÚMERO TOTAL DE PROVAS;"SELECT COUNT(*) TOTAL
FROM BPROVA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA";77;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-13084;RM;30/05/2012;RM;30/05/2012;
G;B00001.0001;NÚMERO TOTAL DE PROVAS;"SELECT COUNT(*) TOTAL
FROM BPROVA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA";77;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-13084;RM;30/05/2012;RM;30/05/2012;
G;B00003;"NÚMERO DE PROVAS DO TIPO ""AVALIAÇÃO DE CONHECIMENTO"" X ""PESQUISA DE OPINIÃO""";"SELECT CASE 
         WHEN TIPOPROVA = 'A' THEN 'AVALIAÇÃO DE CONHECIMENTO'
         WHEN TIPOPROVA = 'B' THEN 'PESQUISA DE OPNIÃO'
       END TIPOPROVA,
       COUNT(*) TOTAL
FROM BPROVA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
GROUP BY TIPOPROVA";255;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-25678;RM;30/05/2012;RM;30/05/2012;
G;B00003.0001;"NÚMERO DE PROVAS DO TIPO ""AVALIAÇÃO DE CONHECIMENTO"" X ""PESQUISA DE OPINIÃO""";"SELECT CASE 
         WHEN TIPOPROVA = 'A' THEN 'AVALIAÇÃO DE CONHECIMENTO'
         WHEN TIPOPROVA = 'B' THEN 'PESQUISA DE OPNIÃO'
       END TIPOPROVA,
       COUNT(*) TOTAL
FROM BPROVA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
GROUP BY TIPOPROVA";255;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-25678;RM;30/05/2012;RM;30/05/2012;
G;B00004;NÚMERO DE PROVAS DINÂMICAS X ESTÁTICAS;"SELECT CASE 
         WHEN PROVADINAMICA = 'T' THEN 'DINÂMICA'
         WHEN PROVADINAMICA = 'F' THEN 'ESTÁTICA'
       END CONFIGPROVA,
       COUNT(*) TOTAL
FROM BPROVA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
GROUP BY PROVADINAMICA";242;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;2404;RM;30/05/2012;RM;30/05/2012;
G;B00004.0001;NÚMERO DE PROVAS DINÂMICAS X ESTÁTICAS;"SELECT CASE 
         WHEN PROVADINAMICA = 'T' THEN 'DINÂMICA'
         WHEN PROVADINAMICA = 'F' THEN 'ESTÁTICA'
       END CONFIGPROVA,
       COUNT(*) TOTAL
FROM BPROVA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
GROUP BY PROVADINAMICA";242;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;2404;RM;30/05/2012;RM;30/05/2012;
G;B00005;COMPARATIVO ENTRE OS TIPOS DE QUESTÕES;"SELECT CASE 
         WHEN TIPOQUESTAO = 'A' THEN 'EXCLUSIVA'
         WHEN TIPOQUESTAO = 'B' THEN 'MÚLTIPLA'
         WHEN TIPOQUESTAO = 'C' THEN 'ABERTA'
       END TIPOQUESTAO,
       COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
      AND ATIVA   = 'T'
GROUP BY TIPOQUESTAO";311;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;10820;RM;30/05/2012;RM;30/05/2012;
G;B00005.0001;COMPARATIVO ENTRE OS TIPOS DE QUESTÕES;"SELECT CASE 
         WHEN TIPOQUESTAO = 'A' THEN 'EXCLUSIVA'
         WHEN TIPOQUESTAO = 'B' THEN 'MÚLTIPLA'
         WHEN TIPOQUESTAO = 'C' THEN 'ABERTA'
       END TIPOQUESTAO,
       COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
      AND ATIVA   = 'T'
GROUP BY TIPOQUESTAO";311;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;10820;RM;30/05/2012;RM;30/05/2012;
G;B00006;NÚMERO TOTAL DE QUESTÕES;"SELECT COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
      AND ATIVA   = 'T'";104;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;16671;RM;30/05/2012;RM;30/05/2012;
G;B00006.0001;NÚMERO TOTAL DE QUESTÕES;"SELECT COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
      AND ATIVA   = 'T'";104;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;16671;RM;30/05/2012;RM;30/05/2012;
G;B00007;NÚMERO DE QUESTÕES POR MATÉRIA;"SELECT UPPER(BMATERIA.NOME) NOME,
       COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK),
     BMATERIA (NOLOCK)
WHERE BMATERIA.CODCOLIGADA     = BQUESTAO.CODCOLIGADA
      AND BMATERIA.CODMATERIA  = BQUESTAO.CODMATERIA
      AND BMATERIA.CODAREA     = BQUESTAO.CODAREA
      AND BQUESTAO.CODCOLIGADA = :CODCOLIGADA
      AND BQUESTAO.ATIVA	   = 'T'
GROUP BY BMATERIA.NOME
ORDER BY TOTAL DESC";392;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30347;RM;30/05/2012;RM;30/05/2012;
G;B00007.0001;NÚMERO DE QUESTÕES POR MATÉRIA;"SELECT UPPER(BMATERIA.NOME) NOME,
       COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK),
     BMATERIA (NOLOCK)
WHERE BMATERIA.CODCOLIGADA     = BQUESTAO.CODCOLIGADA
      AND BMATERIA.CODMATERIA  = BQUESTAO.CODMATERIA
      AND BMATERIA.CODAREA     = BQUESTAO.CODAREA
      AND BQUESTAO.CODCOLIGADA = :CODCOLIGADA
      AND BQUESTAO.ATIVA	   = 'T'
GROUP BY BMATERIA.NOME
ORDER BY TOTAL DESC";392;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30347;RM;30/05/2012;RM;30/05/2012;
G;B00008;NÚMERO DE QUESTÕES POR ÁREA;"SELECT UPPER(BAREA.NOME) NOME,
       COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK),
     BAREA (NOLOCK)
WHERE BAREA.CODCOLIGADA        = BQUESTAO.CODCOLIGADA
      AND BAREA.CODAREA        = BQUESTAO.CODAREA
      AND BQUESTAO.CODCOLIGADA = :CODCOLIGADA
      AND BQUESTAO.ATIVA	   = 'T'
GROUP BY BAREA.NOME
ORDER BY TOTAL DESC";329;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;282;RM;30/05/2012;RM;30/05/2012;
G;B00008.0001;NÚMERO DE QUESTÕES POR ÁREA;"SELECT UPPER(BAREA.NOME) NOME,
       COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK),
     BAREA (NOLOCK)
WHERE BAREA.CODCOLIGADA        = BQUESTAO.CODCOLIGADA
      AND BAREA.CODAREA        = BQUESTAO.CODAREA
      AND BQUESTAO.CODCOLIGADA = :CODCOLIGADA
      AND BQUESTAO.ATIVA	   = 'T'
GROUP BY BAREA.NOME
ORDER BY TOTAL DESC";329;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;282;RM;30/05/2012;RM;30/05/2012;
G;B00009;NÚMERO DE QUESTÕES POR GRAU DE DIFICULDADE;"SELECT CONVERT(VARCHAR, GRAUDIFICULDADE) GRAUDIFICULDADE,
       COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
      AND ATIVA   = 'T'
GROUP BY GRAUDIFICULDADE";189;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;13137;RM;30/05/2012;RM;30/05/2012;
G;B00009.0001;NÚMERO DE QUESTÕES POR GRAU DE DIFICULDADE;"SELECT CONVERT(VARCHAR, GRAUDIFICULDADE) GRAUDIFICULDADE,
       COUNT(*) TOTAL
FROM BQUESTAO (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA
      AND ATIVA   = 'T'
GROUP BY GRAUDIFICULDADE";189;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;13137;RM;30/05/2012;RM;30/05/2012;
G;B00010;NÚMERO TOTAL DE MATÉRIAS;"SELECT COUNT(*) TOTAL
FROM BMATERIA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA";79;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-6920;RM;30/05/2012;RM;30/05/2012;
G;B00010.0001;NÚMERO TOTAL DE MATÉRIAS;"SELECT COUNT(*) TOTAL
FROM BMATERIA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA";79;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-6920;RM;30/05/2012;RM;30/05/2012;
G;B00011;NÚMERO TOTAL DE ÁREAS;"SELECT COUNT(*) TOTAL
FROM BAREA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA";76;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-9060;RM;30/05/2012;RM;30/05/2012;
G;B00011.0001;NÚMERO TOTAL DE ÁREAS;"SELECT COUNT(*) TOTAL
FROM BAREA (NOLOCK)
WHERE CODCOLIGADA = :CODCOLIGADA";76;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-9060;RM;30/05/2012;RM;30/05/2012;
G;B00012;PROVAS UTILIZADAS NO MÓDULO TOTVS PROCESSO SELETIVO;"SELECT UPPER(BPROVA.NOME) NOME,
       COUNT(*) TOTAL
FROM SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK),
     BPROVA (NOLOCK)
WHERE BPROVA.CODCOLIGADA     = SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADAPROVA
      AND BPROVA.CODPROVA    = SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA
      AND BPROVA.CODCOLIGADA = :CODCOLIGADA
GROUP BY BPROVA.NOME";336;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-29972;RM;30/05/2012;RM;30/05/2012;
G;B00012.0001;PROVAS UTILIZADAS NO MÓDULO TOTVS PROCESSO SELETIVO;"SELECT UPPER(BPROVA.NOME) NOME,
       COUNT(*) TOTAL
FROM SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK),
     BPROVA (NOLOCK)
WHERE BPROVA.CODCOLIGADA     = SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADAPROVA
      AND BPROVA.CODPROVA    = SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA
      AND BPROVA.CODCOLIGADA = :CODCOLIGADA
GROUP BY BPROVA.NOME";336;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-29972;RM;30/05/2012;RM;30/05/2012;
G;B00013;FAIXA ETÁRIA E SEXO DOS CANDIDATOS QUE REALIZARAM AVALIAÇÕES;"SELECT FAIXAETARIA, 
       SUM(QTDMAS) MASCULINO, 
       SUM(QTDFEM) FEMININO
FROM
(
SELECT FAIXAETARIA, 
       COUNT(*) QTDMAS, 
       0 QTDFEM
FROM (
SELECT DISTINCT BHISTORICO.CODPESSOA,
       CASE 
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 21 THEN '1 a 20 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 20 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 26  THEN '21 a 25 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 25 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 31  THEN '26 a 30 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 30 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 36  THEN '31 a 35 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 35 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 41  THEN '36 a 40 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 40 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 51  THEN '41 a 50 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 50 THEN 'Mais de 50 anos'
       END FAIXAETARIA,
       PPESSOA.SEXO
FROM BHISTORICO (NOLOCK),
     PPESSOA (NOLOCK)
WHERE BHISTORICO.CODPESSOA       = PPESSOA.CODIGO
      AND BHISTORICO.CODCOLIGADA = :CODCOLIGADA
      AND PPESSOA.SEXO           = 'M') TAB1
GROUP BY FAIXAETARIA, SEXO
UNION
SELECT FAIXAETARIA, 
       0 QTDMAS, 
       COUNT(*) QTDFEM
FROM (
SELECT DISTINCT BHISTORICO.CODPESSOA,
       CASE 
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 21 THEN '1 a 20 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 20 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 26  THEN '21 a 25 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 25 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 31  THEN '26 a 30 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 30 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 36  THEN '31 a 35 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 35 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 41  THEN '36 a 40 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 40 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 51  THEN '41 a 50 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 50 THEN 'Mais de 50 anos'
       END FAIXAETARIA,
       PPESSOA.SEXO
FROM BHISTORICO (NOLOCK),
     PPESSOA (NOLOCK)
WHERE BHISTORICO.CODPESSOA       = PPESSOA.CODIGO
      AND BHISTORICO.CODCOLIGADA = :CODCOLIGADA
      AND PPESSOA.SEXO           = 'F') TAB2
GROUP BY FAIXAETARIA, SEXO
) TABFINAL
GROUP BY FAIXAETARIA";2739;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-18142;RM;30/05/2012;RM;30/05/2012;
G;B00013.0001;FAIXA ETÁRIA E SEXO DOS CANDIDATOS QUE REALIZARAM AVALIAÇÕES;"SELECT FAIXAETARIA, 
       SUM(QTDMAS) MASCULINO, 
       SUM(QTDFEM) FEMININO
FROM
(
SELECT FAIXAETARIA, 
       COUNT(*) QTDMAS, 
       0 QTDFEM
FROM (
SELECT DISTINCT BHISTORICO.CODPESSOA,
       CASE 
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 21 THEN '1 a 20 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 20 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 26  THEN '21 a 25 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 25 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 31  THEN '26 a 30 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 30 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 36  THEN '31 a 35 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 35 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 41  THEN '36 a 40 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 40 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 51  THEN '41 a 50 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 50 THEN 'Mais de 50 anos'
       END FAIXAETARIA,
       PPESSOA.SEXO
FROM BHISTORICO (NOLOCK),
     PPESSOA (NOLOCK)
WHERE BHISTORICO.CODPESSOA       = PPESSOA.CODIGO
      AND BHISTORICO.CODCOLIGADA = :CODCOLIGADA
      AND PPESSOA.SEXO           = 'M') TAB1
GROUP BY FAIXAETARIA, SEXO
UNION
SELECT FAIXAETARIA, 
       0 QTDMAS, 
       COUNT(*) QTDFEM
FROM (
SELECT DISTINCT BHISTORICO.CODPESSOA,
       CASE 
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 21 THEN '1 a 20 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 20 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 26  THEN '21 a 25 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 25 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 31  THEN '26 a 30 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 30 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 36  THEN '31 a 35 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 35 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 41  THEN '36 a 40 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 40 AND DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) < 51  THEN '41 a 50 anos'
         WHEN DATEDIFF(YEAR, PPESSOA.DTNASCIMENTO, GETDATE()) > 50 THEN 'Mais de 50 anos'
       END FAIXAETARIA,
       PPESSOA.SEXO
FROM BHISTORICO (NOLOCK),
     PPESSOA (NOLOCK)
WHERE BHISTORICO.CODPESSOA       = PPESSOA.CODIGO
      AND BHISTORICO.CODCOLIGADA = :CODCOLIGADA
      AND PPESSOA.SEXO           = 'F') TAB2
GROUP BY FAIXAETARIA, SEXO
) TABFINAL
GROUP BY FAIXAETARIA";2739;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-18142;RM;30/05/2012;RM;30/05/2012;
G;Cubo.0001;Cubo - Alunos por periodo letivo atual (SQL Server);"SELECT
  GCOLIGADA.NOMEFANTASIA AS COLIGADA,
  GFILIAL.NOMEFANTASIA AS FILIAL,
  STIPOCURSO.NOME AS NIVEL_ENSINO,  
  SCURSO.NOME AS CURSO,
  SHABILITACAO.NOME AS HABILITACAO,
  STURNO.NOME AS TURNO,    
  SPLETIVO.CODPERLET AS PLETIVO,
  SSTATUS.DESCRICAO AS SITUACAO,
  PPESSOA.SEXO,
  PPESSOA.ESTADO,
  PPESSOA.CIDADE,  
  1 AS QUANTIDADE
FROM   
  PPESSOA (NOLOCK),
  SALUNO (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAO (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK), 
  STURNO (NOLOCK),
  SPLETIVO (NOLOCK),
  GFILIAL (NOLOCK),
  SSTATUS (NOLOCK),
  SPARAM (NOLOCK),
  STIPOCURSO (NOLOCK),
  GCOLIGADA (NOLOCK)
WHERE  
  GCOLIGADA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND  
  STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO AND
  SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
  SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL AND
  SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  SMATRICPL.IDPERLET = SPLETIVO.IDPERLET AND
  SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND
  SHABILITACAOALUNO.RA = SALUNO.RA AND
  SCURSO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA AND
  SCURSO.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO AND
  SALUNO.CODPESSOA = PPESSOA.CODIGO AND
  SPLETIVO.CODCOLIGADA = SPARAM.CODCOLIGADA AND
  SPLETIVO.CODFILIAL = SPARAM.CODFILIAL AND
  SPLETIVO.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
  SPLETIVO.IDPERLET = CONVERT(INT, SPARAM.TEXTO) AND
  SPARAM.ID = 'IDPERLET'";2315;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-3114;RM;30/05/2012;RM;30/05/2012;
G;Cubo.0001.0001;Cubo - Alunos por periodo letivo atual (SQL Server);"SELECT
  GCOLIGADA.NOMEFANTASIA AS COLIGADA,
  GFILIAL.NOMEFANTASIA AS FILIAL,
  STIPOCURSO.NOME AS NIVEL_ENSINO,  
  SCURSO.NOME AS CURSO,
  SHABILITACAO.NOME AS HABILITACAO,
  STURNO.NOME AS TURNO,    
  SPLETIVO.CODPERLET AS PLETIVO,
  SSTATUS.DESCRICAO AS SITUACAO,
  PPESSOA.SEXO,
  PPESSOA.ESTADO,
  PPESSOA.CIDADE,  
  1 AS QUANTIDADE
FROM   
  PPESSOA (NOLOCK),
  SALUNO (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAO (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK), 
  STURNO (NOLOCK),
  SPLETIVO (NOLOCK),
  GFILIAL (NOLOCK),
  SSTATUS (NOLOCK),
  SPARAM (NOLOCK),
  STIPOCURSO (NOLOCK),
  GCOLIGADA (NOLOCK)
WHERE  
  GCOLIGADA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND  
  STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO AND
  SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
  SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL AND
  SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  SMATRICPL.IDPERLET = SPLETIVO.IDPERLET AND
  SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND
  SHABILITACAOALUNO.RA = SALUNO.RA AND
  SCURSO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA AND
  SCURSO.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO AND
  SALUNO.CODPESSOA = PPESSOA.CODIGO AND
  SPLETIVO.CODCOLIGADA = SPARAM.CODCOLIGADA AND
  SPLETIVO.CODFILIAL = SPARAM.CODFILIAL AND
  SPLETIVO.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
  SPLETIVO.IDPERLET = CONVERT(INT, SPARAM.TEXTO) AND
  SPARAM.ID = 'IDPERLET'";2315;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-3114;RM;30/05/2012;RM;30/05/2012;
G;Cubo.0002;Cubo - Inadimplencia;"SELECT
  GCOLIGADA.NOMEFANTASIA AS COLIGADA,
  GFILIAL.NOMEFANTASIA AS FILIAL,
  STIPOCURSO.NOME AS NIVEL_ENSINO,  
  SCURSO.NOME AS CURSO,
  SHABILITACAO.NOME AS HABILITACAO,
  STURNO.NOME AS TURNO,    
  SPLETIVO.CODPERLET AS PLETIVO,
  SSTATUS.DESCRICAO AS SITUACAO,  
  FCFO.NOMEFANTASIA CLIENTE,  
  MONTH(FLAN.DATAVENCIMENTO) MES,
  FLAN.VALORORIGINAL TOTAL
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAO (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK),
  FCFO (NOLOCK),
  STURNO (NOLOCK),
  SPLETIVO (NOLOCK),
  GFILIAL (NOLOCK),
  GCOLIGADA (NOLOCK),
  STIPOCURSO (NOLOCK),
  SSTATUS (NOLOCK)
WHERE
  GCOLIGADA.CODCOLIGADA = FLAN.CODCOLIGADA AND  
  FLAN.CODCOLCFO = FCFO.CODCOLIGADA AND
  FLAN.CODCFO = FCFO.CODCFO AND
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND  
  STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO AND
  SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND
  SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  SCONTRATO.IDPERLET = SPLETIVO.IDPERLET AND
  SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
  SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL AND
  STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO AND
  SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE()";2727;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;13851;RM;30/05/2012;RM;30/05/2012;
G;Cubo.0002.0.0001;Cubo - Inadimplencia;"SELECT
  GCOLIGADA.NOMEFANTASIA AS COLIGADA,
  GFILIAL.NOMEFANTASIA AS FILIAL,
  STIPOCURSO.NOME AS NIVEL_ENSINO,  
  SCURSO.NOME AS CURSO,
  SHABILITACAO.NOME AS HABILITACAO,
  STURNO.NOME AS TURNO,    
  SPLETIVO.CODPERLET AS PLETIVO,
  SSTATUS.DESCRICAO AS SITUACAO,  
  FCFO.NOMEFANTASIA CLIENTE,  
  YEAR(FLAN.DATAVENCIMENTO) ANO,
  CASE
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 1 THEN
  		'01 - Janeiro'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 2 THEN
  		'02 - Fevereiro'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 3 THEN
  		'03 - Março'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 4 THEN
  		'04 - Abril'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 5 THEN
  		'05 - Maio'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 6 THEN
  		'06 - Junho'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 7 THEN
  		'07 - Julho'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 8 THEN
  		'08 - Agosto'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 9 THEN
  		'09 - Setembro'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 10 THEN
  		'10 - Outubro'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 11 THEN
  		'11 - Novembro'
  	WHEN MONTH(FLAN.DATAVENCIMENTO) = 12 THEN
  		'12 - Dezembro'
  END MES,
  FLAN.VALORORIGINAL TOTAL,
  PPESSOA.NOME ALUNO,
  FLAN.IDLAN
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAO (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK),
  FCFO (NOLOCK),
  STURNO (NOLOCK),
  SPLETIVO (NOLOCK),
  GFILIAL (NOLOCK),
  GCOLIGADA (NOLOCK),
  STIPOCURSO (NOLOCK),
  SSTATUS (NOLOCK),
  SALUNO (NOLOCK),
  PPESSOA (NOLOCK)
WHERE
  GCOLIGADA.CODCOLIGADA = FLAN.CODCOLIGADA AND  
  FLAN.CODCOLCFO = FCFO.CODCOLIGADA AND
  FLAN.CODCFO = FCFO.CODCFO AND
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND  
  STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO AND
  SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND
  SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  SCONTRATO.IDPERLET = SPLETIVO.IDPERLET AND
  SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
  SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL AND
  STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO AND
  SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE() AND
  SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
  SALUNO.RA = SMATRICPL.RA AND
  SALUNO.CODPESSOA = PPESSOA.CODIGO AND
  SPARCELA.CODSERVICO NOT IN (12,13,14)";3769;;;;02/05/2022;marli.oliveira;0;1;1;1;;;;0;a6a51ea2-36c4-45ab-a7b2-37dbf00d55e5;;;-18081;marli.oliveira;02/05/2022;marli.oliveira;02/05/2022;
G;Cubo.0002.0001;Cubo - Inadimplencia;"SELECT
  GCOLIGADA.NOMEFANTASIA AS COLIGADA,
  GFILIAL.NOMEFANTASIA AS FILIAL,
  STIPOCURSO.NOME AS NIVEL_ENSINO,  
  SCURSO.NOME AS CURSO,
  SHABILITACAO.NOME AS HABILITACAO,
  STURNO.NOME AS TURNO,    
  SPLETIVO.CODPERLET AS PLETIVO,
  SSTATUS.DESCRICAO AS SITUACAO,  
  FCFO.NOMEFANTASIA CLIENTE,  
  MONTH(FLAN.DATAVENCIMENTO) MES,
  FLAN.VALORORIGINAL TOTAL
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAO (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK),
  FCFO (NOLOCK),
  STURNO (NOLOCK),
  SPLETIVO (NOLOCK),
  GFILIAL (NOLOCK),
  GCOLIGADA (NOLOCK),
  STIPOCURSO (NOLOCK),
  SSTATUS (NOLOCK)
WHERE
  GCOLIGADA.CODCOLIGADA = FLAN.CODCOLIGADA AND  
  FLAN.CODCOLCFO = FCFO.CODCOLIGADA AND
  FLAN.CODCFO = FCFO.CODCFO AND
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND  
  STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO AND
  SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND
  SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  SCONTRATO.IDPERLET = SPLETIVO.IDPERLET AND
  SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
  SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL AND
  STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO AND
  SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE()";2727;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;13851;RM;30/05/2012;RM;30/05/2012;
G;Cubo.0003;Relatório Contábil Repasse de Polos - Detalhado;"SELECT
 GFILIAL.NOME FILIAL,
 STIPOCURSO.NOME 'Nível de Ensino',
 FLAN.PERLETIVO,
 SPLETIVO.DESCRICAO 'Período Letivo',
 FLAN.IDLAN,
 FCFO.NOME,
 SHABILITACAOALUNO.CODCAMPUS,
 SCAMPUS.DESCRICAO POLO,
 STIPOMATRICULA.DESCRICAO 'Tipo Matrícula',
 SUM(FLANBAIXA.VALORBAIXA) RECEBIMENTO,
 (SUM(FLANBAIXA.VALORBAIXA) * 18 /*:REPASSE*/)/100 REPASSE
 
FROM
 FLAN (NOLOCK)
 
 INNER JOIN GFILIAL (NOLOCK)			ON GFILIAL.CODCOLIGADA = FLAN.CODCOLIGADA AND
 										   GFILIAL.CODFILIAL = FLAN.CODFILIAL
 
 INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
 									   	   FCFO.CODCFO =  FLAN.CODCFO
 
 INNER JOIN FLANBAIXA (NOLOCK)			ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   FLANBAIXA.IDLAN = FLAN.IDLAN AND
 									   	   FLANBAIXA.STATUS = 0
 
 INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   SLAN.IDLAN = FLAN.IDLAN
 									   
 INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 									   	   SPARCELA.IDPARCELA = SLAN.IDPARCELA
 									   
 INNER JOIN SCONTRATO (NOLOCK)			ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   	   SCONTRATO.RA = SPARCELA.RA AND 
 									   	   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 									   	   SCONTRATO.IDPERLET = SPARCELA.IDPERLET 									   

 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 									   
 INNER JOIN STIPOCURSO (NOLOCK)			ON STIPOCURSO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   STIPOCURSO.CODTIPOCURSO = SCONTRATO.CODTIPOCURSO
 										   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND
 										   SHABILITACAOFILIAL.CODFILIAL = SCONTRATO.CODFILIAL 
 										   
 INNER JOIN SHABILITACAOALUNO (NOLOCK)	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   SHABILITACAOALUNO.RA = SCONTRATO.RA

 INNER JOIN SMATRICPL 					ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 										   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 										   SMATRICPL.RA = SCONTRATO.RA

 INNER JOIN STIPOMATRICULA 				ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 										   STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT
 										   
 LEFT JOIN SCAMPUS (NOLOCK)				ON SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.CODFILIAL = 4
	AND FLAN.PAGREC = 1
	AND FLANBAIXA.DATABAIXA >= :Data_Início
	AND FLANBAIXA.DATABAIXA <= :Data_Fim
 
GROUP BY GFILIAL.NOME, STIPOCURSO.NOME, FLAN.PERLETIVO, SPLETIVO.DESCRICAO, FLAN.IDLAN, FCFO.NOME, 
		 SHABILITACAOALUNO.CODCAMPUS, SCAMPUS.DESCRICAO, STIPOMATRICULA.DESCRICAO";3089;;;;27/07/2021;mestre;0;1;1;1;;;;0;c3f08751-be14-4c4b-bbd6-d24d1e61b93f;0;;14998;mestre;26/07/2021;mestre;27/07/2021;0
G;Cubo.0004;Receita Mensal;"SELECT 
 COLIGADA,
 TIPO_CONT 'Tipo Contábil',
 MES,
 FILIAL,
 CODTDO 'TIPO DOC',
 NIVEL,
 CODCURSO,
 CURSO,
 TURMA,
 CONTRATO,
 RA,
 IDPERLET,
 IDHABILITACAOFILIAL,
 IDLAN,
 COMPETENCIA,
 ALUNOS,
 CODHABILITACAO,
 CODGRADE,
 BRUTO,
 DESCONTO,
 FFG,
 BOLSA,
 [APURA PAGTO MAIOR],
 [ACRESCENTA PAGTO MENOR],
 [APURA PAGTO MENOR],
 [DESCONTA PAGTO MAIOR],
 [JUROS/MULTA RECEBIDOS],
 DEVOLUCAO,
 [DESC. ADIMPLÊNCIA PREV],
 [DESC. ADIMPLÊNCIA REA],
 VOUCHER,
 [PAGTO A MAIOR],
 [PAGTO A MENOR],
 [JUROS/MULTA A RECEBER],
 [BAIXA PARCIAL],
 [DESCONTO NA BAIXA],
 LIQUIDO,
 [LIQUIDO SEM BAIXA PARCIAL],
 [RECEITA LÍQUIDA],
 [VALOR BAIXADO],
 [SALDO A RECEBER],
 [PERC. INADIMPLÊNCIA],
 [TICKET MÉDIO],
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL) [PERC. INAD. FILIAL],
  	
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL) [PERC. INAD. NIVEL],
  	
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL
  	AND F.CODCURSO = FINAN.CODCURSO) [PERC. INAD. CURSO],
  	
(SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL
  	AND F.CODCURSO = FINAN.CODCURSO
  	AND F.TURMA = FINAN.TURMA) [PERC. INAD. TURMA]
  	   
FROM
 	z_Unasp_FN_FINANCEIRO FINAN
 where 
 	Data_Início_D = :Data_Início_D and 
 	Data_Fim_D = :Data_Fim_D and 
 	Ano_Período_Letivo_S like :Ano_Período_Letivo_S + '%'
";2632;;;;03/05/2022;robson.canto;0;1;1;1;;;;0;3f60d996-1afc-48c0-8397-0e4dce8a4371;0;;-32190;robson.canto;16/11/2021;robson.canto;03/05/2022;0
G;Cubo.0004.0001;Receita Mensal;"SELECT 
 COLIGADA,
 MES,
 FILIAL,
 CODTDO 'TIPO DOC',
 NIVEL,
 CODCURSO,
 CURSO,
 TURMA,
 CONTRATO,
 RA,
 IDPERLET,
 IDHABILITACAOFILIAL,
 IDLAN,
 COMPETENCIA,
 ALUNOS,
 CODHABILITACAO,
 CODGRADE,
 BRUTO,
 DESCONTO,
 FFG,
 BOLSA,
 [APURA PAGTO MAIOR],
 [ACRESCENTA PAGTO MENOR],
 [APURA PAGTO MENOR],
 [DESCONTA PAGTO MAIOR],
 [JUROS/MULTA RECEBIDOS],
 DEVOLUCAO,
 [DESC. ADIMPLÊNCIA PREV],
 [DESC. ADIMPLÊNCIA REA],
 VOUCHER,
 [PAGTO A MAIOR],
 [PAGTO A MENOR],
 [JUROS/MULTA A RECEBER],
 [BAIXA PARCIAL],
 [DESCONTO NA BAIXA],
 LIQUIDO,
 [LIQUIDO SEM BAIXA PARCIAL],
 [RECEITA LÍQUIDA],
 [VALOR BAIXADO],
 [SALDO A RECEBER],
 [PERC. INADIMPLÊNCIA],
 [TICKET MÉDIO],
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL) [PERC. INAD. FILIAL],
  	
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL) [PERC. INAD. NIVEL],
  	
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL
  	AND F.CODCURSO = FINAN.CODCURSO) [PERC. INAD. CURSO],
  	
(SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL
  	AND F.CODCURSO = FINAN.CODCURSO
  	AND F.TURMA = FINAN.TURMA) [PERC. INAD. TURMA]
  	   
FROM
 	z_Unasp_FN_FINANCEIRO FINAN
 where 
 	Data_Início_D = :Data_Início_D and 
 	Data_Fim_D = :Data_Fim_D and 
 	Ano_Período_Letivo_S like :Ano_Período_Letivo_S + '%'
";2603;;;;11/05/2022;marli.oliveira;0;1;1;1;;;;0;2467f490-8e33-4e7d-84ca-be3b578a5841;;;16549;marli.oliveira;11/05/2022;marli.oliveira;11/05/2022;
G;Cubo.0004.0002;Receita Mensal;"SELECT 
 COLIGADA,
 MES,
 FILIAL,
 CODTDO 'TIPO DOC',
 NIVEL,
 CODCURSO,
 CURSO,
 TURMA,
 CONTRATO,
 RA,
 IDPERLET,
 IDHABILITACAOFILIAL,
 IDLAN,
 COMPETENCIA,
 ALUNOS,
 CODHABILITACAO,
 CODGRADE,
 BRUTO,
 DESCONTO,
 FFG,
 BOLSA,
 [APURA PAGTO MAIOR],
 [ACRESCENTA PAGTO MENOR],
 [APURA PAGTO MENOR],
 [DESCONTA PAGTO MAIOR],
 [JUROS/MULTA RECEBIDOS],
 DEVOLUCAO,
 [DESC. ADIMPLÊNCIA PREV],
 [DESC. ADIMPLÊNCIA REA],
 VOUCHER,
 [PAGTO A MAIOR],
 [PAGTO A MENOR],
 [JUROS/MULTA A RECEBER],
 [BAIXA PARCIAL],
 [DESCONTO NA BAIXA],
 LIQUIDO,
 [LIQUIDO SEM BAIXA PARCIAL],
 [RECEITA LÍQUIDA],
 [VALOR BAIXADO],
 [SALDO A RECEBER],
 [PERC. INADIMPLÊNCIA],
 [TICKET MÉDIO],
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL) [PERC. INAD. FILIAL],
  	
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL) [PERC. INAD. NIVEL],
  	
 (SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL
  	AND F.CODCURSO = FINAN.CODCURSO) [PERC. INAD. CURSO],
  	
(SELECT
   CASE WHEN SUM(F.[VALOR BAIXADO]) > 0 AND SUM(F.[RECEITA LÍQUIDA]) > 0 THEN ((100 - ((SUM(F.[VALOR BAIXADO]) / SUM(F.[RECEITA LÍQUIDA])) * 100)) ) / COUNT(F.IDLAN)
        ELSE 0 END
  
  FROM 
   z_Unasp_FN_FINANCEIRO  F
  
  WHERE	F.COLIGADA = FINAN.COLIGADA
  	AND F.COMPETENCIA = FINAN.COMPETENCIA
  	AND F.FILIAL = FINAN.FILIAL
  	AND F.NIVEL = FINAN.NIVEL
  	AND F.CODCURSO = FINAN.CODCURSO
  	AND F.TURMA = FINAN.TURMA) [PERC. INAD. TURMA],
  	
 :Data_Corte_D Data_Corte,
 ALUNO,
 STATUS_MATRICULA [STATUS MATRÍCULA]
  	   
FROM
 	z_Unasp_FN_FINANCEIRO FINAN
 where 
 	Data_Início_D = :Data_Início_D and 
 	Data_Fim_D = :Data_Fim_D and 
 	Ano_Período_Letivo_S like :Ano_Período_Letivo_S + '%'
";2684;;;;12/07/2022;robson.canto;0;1;1;1;;;;0;acb518d7-f12a-496a-be67-8563aa2fd76a;;;-9245;marli.oliveira;11/05/2022;robson.canto;12/07/2022;
G;Cubo.0005;Inadimplentes;"SELECT
 FLAN.CODCOLIGADA COLIGADA,
 FLAN.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO 'NIVEL ENSINO',
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,
 SSTATUS.DESCRICAO 'STATUS MATRÍCULA',
 FLAN.CODCFO,
 FLAN.CODTDO,
 FCFO.NOME CLIENTE,
 FCFO.EMAIL,
 FCFO.TELEFONE,
 FCFO.FAX CELULAR,
 FLAN.IDLAN,
 FLAN.HISTORICO,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SPARCELA.PARCELA,
 
 CASE WHEN FLAN.STATUSLAN = 0 THEN 'EM ABERTO'
 	  WHEN FLAN.STATUSLAN = 4 THEN 'BAIXADO PARCIAL'
 	  ELSE CAST(FLAN.STATUSLAN AS VARCHAR(2)) END STATUS,

 CONVERT(VARCHAR(10), FLAN.DATABAIXA, 103) BAIXA,
 CONVERT(VARCHAR(10), FLAN.DATAVENCIMENTO, 103) VENCIMENTO,
 FLAN.VALORORIGINAL ORIGINAL,
 
 FLAN.VALORORIGINAL - FLAN.VALORBAIXADO -
 
 ISNULL((SELECT
   		  SUM(FLANINTEGRACAO.VALOR)
 
  		 FROM 
   		  FLANINTEGRACAO (NOLOCK)
 
  		 WHERE FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA
		   AND FLANINTEGRACAO.IDLAN = FLAN.IDLAN
		   AND FLANINTEGRACAO.IDCAMPO IN (48, 51, 53) 
 		),0) +
 
 ISNULL((SELECT
   		  SUM(FLANINTEGRACAO.VALOR)
 
  		 FROM 
   		  FLANINTEGRACAO (NOLOCK)
 
  		WHERE FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA
		  AND FLANINTEGRACAO.IDLAN = FLAN.IDLAN
		  AND FLANINTEGRACAO.IDCAMPO IN (50,52) 
 		),0)  +
 
   CASE WHEN 	 FLAN.STATUSLAN = 0 
   			 AND FLAN.CODTDO <> 'SELETIVO' 
   			 AND FLAN.CODCFO <> '58807' /*FIES*/ 
   			 AND SPARCELA.PARCELA <> 1 
   			 AND FLAN.DATAVENCIMENTO < CONVERT(DATE, GETDATE(), 103)
   		THEN ((FLAN.VALORORIGINAL - (ISNULL((SELECT
   		  									 SUM(FLANINTEGRACAO.VALOR)
 
  		 									FROM 
   		  									 FLANINTEGRACAO (NOLOCK)
 
  		 									WHERE FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA
		   										AND FLANINTEGRACAO.IDLAN = FLAN.IDLAN
		   										AND FLANINTEGRACAO.IDCAMPO = 48
 								   		   ),0)
 								   ) )* 0.02
 			 ) 

   		WHEN 	 FLAN.STATUSLAN = 4
   			 AND FLAN.CODTDO <> 'SELETIVO' 
   			 AND FLAN.CODCFO <> '58807' /*FIES*/ 
   			 AND SPARCELA.PARCELA <> 1 
   			 AND FLAN.DATAVENCIMENTO < CONVERT(DATE, GETDATE(), 103)
   		THEN (FLAN.VALORORIGINAL - (FLAN.VALORDESCONTO + 
   								    FLAN.VALOROP3 + 
   								    FLAN.VALOROP6)
   								 + (FLAN.VALOROP5 +
   								    FLAN.VALOROP7) ) * 0.02 
		ELSE 0 END +
		
   CASE WHEN 	 FLAN.STATUSLAN = 0 
   			 AND FLAN.CODTDO <> 'SELETIVO' 
   			 AND FLAN.CODCFO <> '58807' /*FIES*/ 
   			 AND SPARCELA.PARCELA <> 1 
   			 AND FLAN.DATAVENCIMENTO < CONVERT(DATE, GETDATE(), 103)
   		THEN (((((FLAN.VALORORIGINAL - (ISNULL((SELECT
   		  									 SUM(FLANINTEGRACAO.VALOR)
 
  		 									FROM 
   		  									 FLANINTEGRACAO (NOLOCK)
 
  		 									WHERE FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA
		   										AND FLANINTEGRACAO.IDLAN = FLAN.IDLAN
		   										AND FLANINTEGRACAO.IDCAMPO = 48
 								   		   ),0)
 								   ) ) * 0.01 / 30) * DATEDIFF(DAY, GETDATE(), FLAN.DATAVENCIMENTO) ) * -1)			
			 )
			 
   		WHEN 	 FLAN.STATUSLAN = 4
   			 AND FLAN.CODTDO <> 'SELETIVO' 
   			 AND FLAN.CODCFO <> '58807' /*FIES*/ 
   			 AND SPARCELA.PARCELA <> 1 
   			 AND FLAN.DATAVENCIMENTO < CONVERT(DATE, GETDATE(), 103)
   		THEN ((((FLAN.VALORORIGINAL ) * 0.01 / 30) * DATEDIFF(DAY, GETDATE(), FLAN.DATAVENCIMENTO) ) * -1
		     )
		ELSE 0 END LIQUIDO,

		
 (SELECT
   SUM(X.LIQUIDO) TOTAL

  FROM
  (SELECT
    FL.VALORORIGINAL - FL.VALORBAIXADO -
 
    ISNULL((SELECT
   		     SUM(FLI.VALOR)
 
  		    FROM 
   		     FLANINTEGRACAO FLI (NOLOCK)
 
  		    WHERE FLI.CODCOLIGADA = FL.CODCOLIGADA
		   	  AND FLI.IDLAN = FL.IDLAN
		   	  AND FLI.IDCAMPO IN (48, 51, 53) 
 		   ),0) +
 
    ISNULL((SELECT
   		     SUM(FLI.VALOR)
 
  		    FROM 
   		     FLANINTEGRACAO FLI (NOLOCK)
 
  		    WHERE FLI.CODCOLIGADA = FL.CODCOLIGADA
		      AND FLI.IDLAN = FL.IDLAN
		      AND FLI.IDCAMPO IN (50,52) 
 		   ),0)  +
 
    CASE WHEN 	 FL.STATUSLAN = 0 
   			 AND FL.CODTDO <> 'SELETIVO' 
   			 AND FL.CODCFO <> '58807' /*FIES*/ 
   			 AND SP.PARCELA <> 1 
   			 AND FL.DATAVENCIMENTO < CONVERT(DATE, GETDATE(), 103)
   		THEN ((FL.VALORORIGINAL - (ISNULL((SELECT
   		  									 SUM(FLI.VALOR)
 
  		 									FROM 
   		  									 FLANINTEGRACAO FLI (NOLOCK)
 
  		 									WHERE FLI.CODCOLIGADA = FL.CODCOLIGADA
		   										AND FLI.IDLAN = FL.IDLAN
		   										AND FLI.IDCAMPO = 48
 								   		   ),0)
 								   ) )* 0.02
 			 ) 

   		WHEN 	 FL.STATUSLAN = 4
   			 AND FL.CODTDO <> 'SELETIVO' 
   			 AND FL.CODCFO <> '58807' /*FIES*/ 
   			 AND SP.PARCELA <> 1 
   			 AND FL.DATAVENCIMENTO < CONVERT(DATE, GETDATE(), 103)
   		THEN (FL.VALORORIGINAL - (FL.VALORDESCONTO + 
   								  FL.VALOROP3 + 
   								  FL.VALOROP6)
   							   + (FL.VALOROP5 +
   								  FL.VALOROP7) ) * 0.02 
		ELSE 0 END +
		
    CASE WHEN 	 FL.STATUSLAN = 0 
   			 AND FL.CODTDO <> 'SELETIVO' 
   			 AND FL.CODCFO <> '58807' /*FIES*/ 
   			 AND SP.PARCELA <> 1 
   			 AND FL.DATAVENCIMENTO < CONVERT(DATE, GETDATE(), 103)
   		THEN (((((FL.VALORORIGINAL - (ISNULL((SELECT
   		  									   SUM(FLI.VALOR)
 
  		 									  FROM 
   		  									   FLANINTEGRACAO FLI (NOLOCK)
 
  		 									  WHERE FLI.CODCOLIGADA = FL.CODCOLIGADA
		   										AND FLI.IDLAN = FL.IDLAN
		   										AND FLI.IDCAMPO = 48
 								   		   ),0)
 								   ) ) * 0.01 / 30) * DATEDIFF(DAY, GETDATE(), FL.DATAVENCIMENTO) ) * -1)			
			 )
			 
   		WHEN 	 FL.STATUSLAN = 4
   			 AND FL.CODTDO <> 'SELETIVO' 
   			 AND FL.CODCFO <> '58807' /*FIES*/ 
   			 AND SP.PARCELA <> 1 
   			 AND FL.DATAVENCIMENTO < CONVERT(DATE, GETDATE(), 103)
   		THEN ((((FL.VALORORIGINAL ) * 0.01 / 30) * DATEDIFF(DAY, GETDATE(), FL.DATAVENCIMENTO) ) * -1
		     )
		ELSE 0 END LIQUIDO
 
   FROM
    FLAN FL (NOLOCK)

    INNER JOIN SLAN SL (NOLOCK) 		ON SL.CODCOLIGADA = FL.CODCOLIGADA AND
								   	       SL.IDLAN = FL.IDLAN 

    INNER JOIN SPARCELA SP (NOLOCK)		ON SP.CODCOLIGADA = SL.CODCOLIGADA AND
								   	   	   SP.IDPARCELA = SL.IDPARCELA

 	INNER JOIN SCONTRATO SC (NOLOCK)	ON SC.CODCOLIGADA = SP.CODCOLIGADA AND
								   	   	   SC.CODCONTRATO = SP.CODCONTRATO AND
								   	       SC.IDPERLET = SP.IDPERLET
								   
   WHERE	FL.CODCOLIGADA = 1
	 AND FL.STATUSLAN IN (0, 4)
	 AND FL.DATAVENCIMENTO >= :Vencto_Início
	 AND FL.DATAVENCIMENTO < :Vencto_Fim
	 AND SC.RA = SCONTRATO.RA
	
  ) X  	
 ) TOTAL 
 
FROM
 FLAN (NOLOCK)

 INNER JOIN FCFO (NOLOCK)					ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
								   			   FCFO.CODCFO = FLAN.CODCFO
 
 INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
								   			   SLAN.IDLAN = FLAN.IDLAN 

 INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND
								   			   SPARCELA.IDPARCELA = SLAN.IDPARCELA

 INNER JOIN SCONTRATO (NOLOCK)				ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
								   			   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND
								   			   SCONTRATO.IDPERLET = SPARCELA.IDPERLET
								   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   	   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 INNER JOIN SCURSO (NOLOCK)					ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   	   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 INNER JOIN SGRADE (NOLOCK)					ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   	   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   	   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   	   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 INNER JOIN SALUNO (NOLOCK)					ON SALUNO.RA = SCONTRATO.RA
 
 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 
 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
  											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
  											   SMATRICPL.RA = SCONTRATO.RA
  
 INNER JOIN SSTATUS (NOLOCK)				ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  											   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.STATUSLAN IN (0, 4)
	AND FLAN.DATAVENCIMENTO >= :Vencto_Início
	AND FLAN.DATAVENCIMENTO < :Vencto_Fim
/*	AND FLAN.CODTDO IN ('MENS', 'PENS')
	AND SCONTRATO.CODTIPOCURSO IN (1, 2, 3)
*/	

UNION ALL

SELECT
 FLAN.CODCOLIGADA COLIGADA,
 FLAN.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO 'NIVEL ENSINO',
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,
 SSTATUS.DESCRICAO 'STATUS MATRÍCULA',
 FLAN.CODCFO,
 FLAN.CODTDO,
 FCFO.NOME CLIENTE,
 FCFO.EMAIL,
 FCFO.TELEFONE,
 FCFO.FAX CELULAR,
 FLAN.IDLAN,
 FLAN.HISTORICO,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SPARCELA.PARCELA,
  'BAIXADO' STATUS,
 CONVERT(VARCHAR(10), FLAN.DATABAIXA, 103) BAIXA,
 CONVERT(VARCHAR(10), FLAN.DATAVENCIMENTO, 103) VENCIMENTO,
 FLAN.VALORORIGINAL ORIGINAL,
 FLAN.VALORBAIXADO LIQUIDO,
		
 0 TOTAL 
 
FROM
 FLAN (NOLOCK)

 INNER JOIN FCFO (NOLOCK)					ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
								   			   FCFO.CODCFO = FLAN.CODCFO
 
 INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
								   			   SLAN.IDLAN = FLAN.IDLAN 

 INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND
								   			   SPARCELA.IDPARCELA = SLAN.IDPARCELA

 INNER JOIN SCONTRATO (NOLOCK)				ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
								   			   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND
								   			   SCONTRATO.IDPERLET = SPARCELA.IDPERLET
								   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   	   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 INNER JOIN SCURSO (NOLOCK)					ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   	   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 INNER JOIN SGRADE (NOLOCK)					ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   	   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										  	   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   	   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 INNER JOIN SALUNO (NOLOCK)					ON SALUNO.RA = SCONTRATO.RA
 
 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 								   
 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
  											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
  											   SMATRICPL.RA = SCONTRATO.RA
  
 INNER JOIN SSTATUS (NOLOCK)				ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  											   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.STATUSLAN = 1
	AND FLAN.DATAVENCIMENTO >= :Vencto_Início
	AND FLAN.DATAVENCIMENTO < :Vencto_Fim
	AND FLAN.DATABAIXA > :Vencto_Fim
/*	AND FLAN.CODTDO IN ('MENS', 'PENS')
	AND SCONTRATO.CODTIPOCURSO IN (1, 2, 3)
*/	
ORDER BY SCONTRATO.RA";11404;;;;12/07/2022;robson.canto;0;1;1;1;;;;0;5f8f67d2-7391-47c6-b913-9acf091f00d3;0;;-30466;robson.canto;25/11/2021;robson.canto;12/07/2022;0
G;Cubo.003;Relatório Contábil Repasse de Polos - Detalhado;"SELECT
 GFILIAL.NOME,
 STIPOCURSO.NOME,
 FLAN.PERLETIVO,
 SPLETIVO.DESCRICAO,
 FLAN.IDLAN,
 FCFO.NOME,
 SHABILITACAOALUNO.CODCAMPUS,
 SCAMPUS.DESCRICAO,
 SUM(FLANBAIXA.VALORBAIXA),
 (SUM(FLANBAIXA.VALORBAIXA) * :REPASSE)/100
 
FROM
 FLAN (NOLOCK)
 
 INNER JOIN GFILIAL (NOLOCK)			ON GFILIAL.CODCOLIGADA = FLAN.CODCOLIGADA AND
 										   GFILIAL.CODFILIAL = FLAN.CODFILIAL
 
 INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
 									   	   FCFO.CODCFO =  FLAN.CODCFO
 
 INNER JOIN FLANBAIXA (NOLOCK)			ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   FLANBAIXA.IDLAN = FLAN.IDLAN AND
 									   	   FLANBAIXA.STATUS = 0
 
 INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   SLAN.IDLAN = FLAN.IDLAN
 									   
 INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 									   	   SPARCELA.IDPARCELA = SLAN.IDPARCELA
 									   
 INNER JOIN SCONTRATO (NOLOCK)			ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   	   SCONTRATO.RA = SPARCELA.RA AND 
 									   	   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 									   	   SCONTRATO.IDPERLET = SPARCELA.IDPERLET 									   

 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 									   
 INNER JOIN STIPOCURSO (NOLOCK)			ON STIPOCURSO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   STIPOCURSO.CODTIPOCURSO = SCONTRATO.CODTIPOCURSO
 										   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND
 										   SHABILITACAOFILIAL.CODFILIAL = SCONTRATO.CODFILIAL 
 										   
 INNER JOIN SHABILITACAOALUNO (NOLOCK)	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   SHABILITACAOALUNO.RA = SCONTRATO.RA

 LEFT JOIN SCAMPUS (NOLOCK)				ON SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.CODFILIAL = 4
	AND FLAN.PAGREC = 1
	AND FLANBAIXA.DATABAIXA >= :Data_Início
	AND FLANBAIXA.DATABAIXA <= :Data_Fim
 
GROUP BY GFILIAL.NOME, STIPOCURSO.NOME, FLAN.PERLETIVO, SPLETIVO.DESCRICAO, FLAN.IDLAN, FCFO.NOME, 
		 SHABILITACAOALUNO.CODCAMPUS, SCAMPUS.DESCRICAO

";2508;;;;26/07/2021;mestre;0;1;1;1;;;;0;95a37f54-dfac-469b-be32-352044c854fa;0;;20676;mestre;26/07/2021;mestre;26/07/2021;0
G;Cubo.006;Formatura - Lançamentos Financeiro;"SELECT
 FLAN.CODCOLIGADA,
 FLAN.IDLAN,
 SCONTRATO.CODCONTRATO,
 SHABILITACAOFILIAL.CODFILIAL FILIAL,
 SPLETIVO.CODTIPOCURSO 'NIVEL ENSINO',
 SCURSO.CODCURSO CURSO,
 FLAN.CODCFO,
 FCFO.NOME 'RESP. FINANC.',
 SCONTRATO.RA,
 SCONTRATO.IDPERLET,
 
 FLAN.CODTDO,
 
 CASE WHEN FLAN.STATUSLAN = 0 THEN 'EM ABERTO'
 	  WHEN FLAN.STATUSLAN = 1 THEN 'BAIXADO'
 	  WHEN FLAN.STATUSLAN = 4 THEN 'BAIXA PARCIAL'
 	  ELSE CAST(FLAN.STATUSLAN AS VARCHAR(2)) END STATUS,
 
 FLAN.DATAVENCIMENTO,
 FLAN.HISTORICO,
 FLAN.VALORORIGINAL,
 SPARCELA.PARCELA,
 FLAN.DATACRIACAO

FROM
 FLAN (NOLOCK)
 
 INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
 										   FCFO.CODCFO = FLAN.CODCFO
 										   
 LEFT JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 							   	   		   SLAN.IDLAN = FLAN.IDLAN
 
 LEFT JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   		   SPARCELA.IDPARCELA = SLAN.IDPARCELA
 		 
 LEFT JOIN SSERVICO (NOLOCK)			ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 										   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO AND
 										   SSERVICO.NOME LIKE '%FORMAT%'
 										   
 LEFT JOIN SCONTRATO (NOLOCK)			ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 								   		   SCONTRATO.RA = SPARCELA.RA AND 
 								   		   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 								   		   SCONTRATO.IDPERLET = SPARCELA.IDPERLET 								   
 
 LEFT JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
 					  
 LEFT JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 										   										   
 LEFT JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								   		   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET AND
		 								   SPLETIVO.CODPERLET = :Período_Letivo
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.CODTDO = 'TAX_APRO'
	AND FLAN.DATAVENCIMENTO >= :Vencto_Início
	AND FLAN.DATAVENCIMENTO <= :Vencto_Fim
 	AND FLAN.STATUSLAN <> 2	
";2226;;;;07/12/2021;robson.canto;0;1;1;1;;;;0;bf4f5af7-1014-4d8d-8fcf-145ecd36723b;0;;1209;robson.canto;07/12/2021;robson.canto;07/12/2021;0
G;Cubo.007;Formatura - Lançamentos Financeiros em Aberto;"SELECT
 FLAN.CODCOLIGADA,
 FLAN.IDLAN,
 SCONTRATO.CODCONTRATO,
 SHABILITACAOFILIAL.CODFILIAL FILIAL,
 SPLETIVO.CODTIPOCURSO 'NIVEL ENSINO',
 SCURSO.CODCURSO CURSO,
 FLAN.CODCFO,
 FCFO.NOME 'RESP. FINANC.',
 SCONTRATO.RA,
 SCONTRATO.IDPERLET,
 
 FLAN.CODTDO,
 
 CASE WHEN FLAN.STATUSLAN = 0 THEN 'EM ABERTO'
 	  WHEN FLAN.STATUSLAN = 1 THEN 'BAIXADO'
 	  WHEN FLAN.STATUSLAN = 4 THEN 'BAIXA PARCIAL'
 	  ELSE CAST(FLAN.STATUSLAN AS VARCHAR(2)) END STATUS,
 
 FLAN.DATAVENCIMENTO,
 FLAN.HISTORICO,
 FLAN.VALORORIGINAL,
 SPARCELA.PARCELA,
 FLAN.DATACRIACAO

FROM
 FLAN (NOLOCK)
 
 INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
 										   FCFO.CODCFO = FLAN.CODCFO
 										   
 LEFT JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 							   	   		   SLAN.IDLAN = FLAN.IDLAN
 
 LEFT JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   		   SPARCELA.IDPARCELA = SLAN.IDPARCELA
 		 
 LEFT JOIN SSERVICO (NOLOCK)			ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 										   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO AND
 										   SSERVICO.NOME LIKE '%FORMAT%'
 										   
 LEFT JOIN SCONTRATO (NOLOCK)			ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 								   		   SCONTRATO.RA = SPARCELA.RA AND 
 								   		   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 								   		   SCONTRATO.IDPERLET = SPARCELA.IDPERLET 								   
 
 LEFT JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
 					  
 LEFT JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 										   										   
 LEFT JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								   		   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET AND
		 								   SPLETIVO.CODPERLET = :Período_Letivo
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.CODTDO = 'TAX_APRO'
	AND FLAN.DATAVENCIMENTO >= :Vencto_Início
	AND FLAN.DATAVENCIMENTO <= :Vencto_Fim
	AND SPLETIVO.CODPERLET = :Período_Letivo
 	AND FLAN.STATUSLAN <> 2	
	AND SCONTRATO.RA NOT IN (SELECT
							  SC.RA
							 
							 FROM
							  FLAN FL (NOLOCK)
							  
							  INNER JOIN SLAN SL (NOLOCK)		ON SL.CODCOLIGADA = FL.CODCOLIGADA AND
							  								   	   SL.IDLAN = FL.IDLAN
						  								   
							  INNER JOIN SPARCELA SP (NOLOCK)	ON SP.CODCOLIGADA = SL.CODCOLIGADA AND
							  									   SP.IDPARCELA = SL.IDPARCELA
							  									  								   
 							  INNER JOIN SSERVICO SS (NOLOCK)	ON SS.CODCOLIGADA = SP.CODCOLIGADA AND 
 										   						   SS.CODSERVICO = SP.CODSERVICO AND
 										   						   SS.NOME LIKE '%FORMAT%'
 										   
 							  INNER JOIN SCONTRATO SC (NOLOCK)	ON SC.CODCOLIGADA = SP.CODCOLIGADA AND 
 								   		   						   SC.RA = SP.RA AND 
 								   		   						   SC.CODCONTRATO = SP.CODCONTRATO AND 
 								   		   						   SC.IDPERLET = SP.IDPERLET 								   

 							  INNER JOIN SPLETIVO SPL (NOLOCK)	ON SPL.CODCOLIGADA = SC.CODCOLIGADA AND 
 								   		   						   SPL.IDPERLET = SC.IDPERLET AND
		 								   						   SPL.CODPERLET = :Período_Letivo

							 WHERE 	FL.CODCOLIGADA = FLAN.CODCOLIGADA
							 	AND FL.CODTDO = 'TAX_APRO'
							 	AND FL.DATAVENCIMENTO >= :Vencto_Início
							 	AND FL.DATAVENCIMENTO <= :Vencto_Fim
							 	AND FL.STATUSLAN IN (1, 4))";3576;;;;07/12/2021;robson.canto;0;1;1;1;;;;0;6cbd3482-e79f-4c48-ba9d-51d7d3da3f44;0;;-8417;robson.canto;07/12/2021;robson.canto;07/12/2021;0
G;Cubo.008;Verificação de Bolsa não Cadastrada - Comparativo entre mês informado e posterior;"SELECT
 FLAN.CODCOLIGADA COLIGADA,
 FLAN.IDLAN,
 SCONTRATO.IDPERLET,
 SCONTRATO.CODCONTRATO,
 FLAN.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SALUNO.RA,
 PPESSOA.NOME ALUNO,
 PPESSOA.TELEFONE1 TELEFONE,
 PPESSOA.TELEFONE2 CELULAR,
 PPESSOA.EMAIL,
 SCURSO.NOME CURSO,
 SBOLSA.CODBOLSA,
 SBOLSA.NOME BOLSA,
 1 QDE,
 FLAN.VALORORIGINAL 'VALOR ORIGINAL'
 
FROM
 FLAN (NOLOCK)
 
 INNER JOIN FBOLETO (NOLOCK)		ON FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 								   	   FBOLETO.IDBOLETO = FLAN.IDBOLETO
 
 INNER JOIN SLAN (NOLOCK)			ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
 								   	   SLAN.IDLAN = FLAN.IDLAN
 								   
 INNER JOIN SPARCELA (NOLOCK)		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   	   SPARCELA.IDPARCELA = SLAN.IDPARCELA
 								   
 INNER JOIN SBOLSALAN (NOLOCK)		ON SBOLSALAN.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   	   SBOLSALAN.IDLAN = SLAN.IDLAN 								   

 INNER JOIN SBOLSAPLETIVO (NOLOCK)	ON SBOLSALAN.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA AND
 									   SBOLSALAN.IDPERLET = SBOLSAPLETIVO.IDPERLET AND
 									   SBOLSALAN.CODBOLSA = SBOLSAPLETIVO.CODBOLSA
 									   
 INNER JOIN SBOLSA (NOLOCK)			ON SBOLSA.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA AND 
 									   SBOLSA.CODBOLSA = SBOLSAPLETIVO.CODBOLSA
 
 INNER JOIN SALUNO (NOLOCK)			ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
 								   	   SALUNO.RA = SPARCELA.RA
 								   
 INNER JOIN PPESSOA (NOLOCK)		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 
 INNER JOIN SCONTRATO (NOLOCK)		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 								   	   SCONTRATO.RA = SPARCELA.RA AND
 								   	   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND
 								   	   SCONTRATO.IDPERLET = SPARCELA.IDPERLET

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

WHERE	FLAN.CODCOLIGADA = 1
	/*AND FBOLETO.CNABSTATUS IN (2, 5)*/
	AND FLAN.MESDECOMPETENCIA = :Data
	AND FLAN.CODCFO NOT IN (SELECT
 					    	 FL.CODCFO
 
					   		FROM
 							 FLAN FL (NOLOCK)
 
 							 INNER JOIN FBOLETO FB (NOLOCK)	ON FB.CODCOLIGADA = FL.CODCOLIGADA AND
 								   					   	   	   FB.IDBOLETO = FL.IDBOLETO
 
 							 INNER JOIN SLAN SL (NOLOCK)	ON SL.CODCOLIGADA = FL.CODCOLIGADA AND 
 								   						   		   SL.IDLAN = FL.IDLAN
 								   
 							INNER JOIN SPARCELA SP (NOLOCK)	ON SP.CODCOLIGADA = SL.CODCOLIGADA AND 
 								   						   		SP.IDPARCELA = SL.IDPARCELA
 								   
 							INNER JOIN SBOLSALAN SB (NOLOCK)ON SB.CODCOLIGADA = SL.CODCOLIGADA AND 
 								   						   	   SB.IDLAN = SL.IDLAN 								   
 								   
					  	   WHERE	FL.CODCOLIGADA = 1
								/*AND FL.STATUSLAN = 0
								AND FB.CNABSTATUS IN (2, 5)*/
								AND FL.MESDECOMPETENCIA = DATEADD(MM, 1, :Data)
								AND SB.CODBOLSA = SBOLSALAN.CODBOLSA
					  	   )						   
					  ";3156;;;;09/12/2021;robson.canto;0;1;1;1;;;;0;910826ab-11df-4167-9041-d7385f194694;0;;29911;robson.canto;09/12/2021;robson.canto;09/12/2021;0
G;Cubo.009;Recorrência;"SELECT DISTINCT
 1 QDE,
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.IDPERLET,
 SCONTRATO.CODCONTRATO,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SCONTRATO.IDHABILITACAOFILIAL,
 CONVERT(VARCHAR(10), FRECORRENCIACARTAO.DATAADESAO, 103) ADESAO,
 FRECORRENCIACARTAO.STATUS 'STATUS ADESSAO',
 FLAN.IDLAN,
 CONVERT(VARCHAR(10), SPARCELA.DTVENCIMENTO, 103) 'VENCTO PARCELA',
 CONVERT(VARCHAR(10), FLAN.DATAVENCIMENTO, 103) 'VENCTO LANCTO',
 FLAN.VALORORIGINAL
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SALUNO (NOLOCK)						ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SALUNO.RA = SCONTRATO.RA 
 												   
 INNER JOIN PPESSOA (NOLOCK)					ON PPESSOA.CODIGO = SALUNO.CODPESSOA 												   

 INNER JOIN SRECORRENCIACARTAO (NOLOCK)			ON SRECORRENCIACARTAO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 												   SRECORRENCIACARTAO.RA = SCONTRATO.RA AND
 												   SRECORRENCIACARTAO.CODCONTRATO = SCONTRATO.CODCONTRATO AND
 												   SRECORRENCIACARTAO.IDPERLET = SRECORRENCIACARTAO.IDPERLET
 
 INNER JOIN FRECORRENCIACARTAO (NOLOCK)			ON FRECORRENCIACARTAO.CODCOLIGADA = SRECORRENCIACARTAO.CODCOLIGADA AND 
 												   FRECORRENCIACARTAO.IDRECORRENCIA = SRECORRENCIACARTAO.IDRECORRENCIA
 
 INNER JOIN SPLETIVO (NOLOCK)					ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 
 INNER JOIN SPARCELA (NOLOCK)					ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SPARCELA.RA = SCONTRATO.RA AND 
 												   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 												   SPARCELA.IDPERLET = SCONTRATO.IDPERLET
												   
 LEFT JOIN SLAN (NOLOCK)						ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 												   SLAN.IDPARCELA = SPARCELA.IDPARCELA 												   
 
 LEFT JOIN FLAN (NOLOCK)						ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 												   FLAN.IDLAN = SLAN.IDLAN

 LEFT JOIN FINTEGRACAOTRANSACAO (NOLOCK)		ON FINTEGRACAOTRANSACAO.CODCOLIGADA = FRECORRENCIACARTAO.CODCOLIGADA AND 
 												   FINTEGRACAOTRANSACAO.IDRECORRENCIA = FRECORRENCIACARTAO.IDRECORRENCIA

WHERE 	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
 	AND FLAN.DATAVENCIMENTO >= :Data_Início
 	AND FLAN.DATAVENCIMENTO <= :Data_Fim
 	AND FLAN.STATUSLAN IN (0,4)
";2417;;;;20/12/2021;robson.canto;0;1;1;1;;;;0;04e7c610-efb3-436e-ac86-773667f89676;0;;-18755;robson.canto;15/12/2021;robson.canto;20/12/2021;0
G;Cubo.010;Alunos Regulares;"SELECT 
 *
FROM
(
 SELECT
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SCONTRATO.IDPERLET,
  SCONTRATO.STATUS,
  SCONTRATO.CODCONTRATO CONTRATO,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  SBOLSAALUNO.CODBOLSA,
  1 QDE
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

  LEFT JOIN SBOLSAALUNO (NOLOCK)			ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 											   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 											   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
											   
 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	/*AND SCONTRATO.STATUS = 'N'*/
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
) X
WHERE X.CODBOLSA IS NULL";1904;;;;22/12/2021;robson.canto;0;1;1;1;;;;0;f9832f5a-72f0-4aca-8095-c409e5b88bb2;0;;21637;robson.canto;20/12/2021;robson.canto;22/12/2021;0
G;Cubo.011;Alunos Filhos de Obreiros;" SELECT
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SALUNO.CODCFO,
  FCFO.NOME 'RESP. FINANC.',
  SCONTRATO.IDPERLET,
  SCONTRATO.STATUS,
  SCONTRATO.CODCONTRATO CONTRATO,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  GCONSIST.DESCRICAO 'NOME DO CAMPO DO OBREIRO'
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  LEFT JOIN SALUNOCOMPL (NOLOCK)			ON SALUNOCOMPL.CODCOLIGADA = SALUNO.CODCOLIGADA AND 
  											   SALUNOCOMPL.RA = SALUNO.RA  											   
  											   
  LEFT JOIN GCONSIST (NOLOCK)				ON GCONSIST.CODTABELA = 'CAMPOOBREI' AND
  											   GCONSIST.APLICACAO = 'S' AND
  											   GCONSIST.CODCLIENTE = SALUNOCOMPL.CAMPOOBREIRO
    											   
  LEFT JOIN FCFO (NOLOCK)					ON FCFO.CODCOLIGADA = SALUNO.CODCOLCFO AND
  											   FCFO.CODCFO = SALUNO.CODCFO
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'

	";2109;;;;21/12/2021;robson.canto;0;1;1;1;;;;0;3e29c5bf-e108-4313-a706-da1e168ca7c5;0;;13982;robson.canto;21/12/2021;robson.canto;21/12/2021;0
G;Cubo.012;Contratos Assinados;"SELECT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SCONTRATO.IDPERLET,
 SCONTRATO.STATUS,
 SCONTRATO.CODCONTRATO CONTRATO,
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,
 SASSINATURACONTRATO.GUID,
 SASSINATURACONTRATO.DATAHORAASSINATURA ASSINATURA,
 SASSINATURACONTRATO.CLIENTIP 'CLIENT IP',
 SASSINATURACONTRATO.DATAHORAENVIOEMAIL 'ENVIO EMAIL',
 SASSINATURACONTRATO.EMAIL,
 SUM(FLAN.VALORORIGINAL) VALOR
 
FROM
 SCONTRATO (NOLOCK)
  
 LEFT JOIN SASSINATURACONTRATO (NOLOCK)		ON SASSINATURACONTRATO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SASSINATURACONTRATO.RA = SCONTRATO.RA AND 
  											   SASSINATURACONTRATO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   SASSINATURACONTRATO.IDPERLET = SCONTRATO.IDPERLET
  											   
 LEFT JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPARCELA.RA = SCONTRATO.RA AND 
 											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET

 LEFT JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SLAN.IDPARCELA = SPARCELA.IDPARCELA

 LEFT JOIN FLAN (NOLOCK)					ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 											   FLAN.IDLAN = SLAN.IDLAN AND 
 											   FLAN.STATUSLAN <> 2
 
 INNER JOIN SALUNO (NOLOCK)					ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
 INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 INNER JOIN SCURSO (NOLOCK)					ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 INNER JOIN SGRADE (NOLOCK)					ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'

GROUP BY SCONTRATO.CODCOLIGADA, SCONTRATO.CODFILIAL, SCONTRATO.CODTIPOCURSO, SCONTRATO.RA, PPESSOA.NOME, 
		 SCONTRATO.IDPERLET, SCONTRATO.STATUS, SCONTRATO.CODCONTRATO, SCURSO.NOME, SGRADE.DESCRICAO,
 		 SASSINATURACONTRATO.DATAHORAASSINATURA, SASSINATURACONTRATO.CLIENTIP, SASSINATURACONTRATO.DATAHORAENVIOEMAIL,
 		 SASSINATURACONTRATO.EMAIL, SASSINATURACONTRATO.GUID";2976;;;;22/12/2021;robson.canto;0;1;1;1;;;;0;f550f135-c08e-41e6-9d3c-15a820b938dd;0;;-10258;robson.canto;22/12/2021;robson.canto;22/12/2021;0
G;Cubo.013;Resumo de Bolsas;"SELECT 
 *
FROM
(
 SELECT DISTINCT
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SCONTRATO.IDPERLET,
  SCONTRATO.STATUS,
  SSTATUS.DESCRICAO 'STATUS MATRICULA',
  SCONTRATO.CODCONTRATO CONTRATO,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  SBOLSAALUNO.CODBOLSA,
  SBOLSA.NOME BOLSA,
  SBOLSAALUNO.PARCELAINICIAL 'PARC. INIC',
  SBOLSAALUNO.PARCELAFINAL 'PARC. FIM',
  SBOLSAALUNO.DTINICIO 'DT INÍCIO',
  SBOLSAALUNO.DTFIM 'DT FIM', 
  SBOLSAALUNO.DESCONTO,
  SBOLSAALUNO.TIPODESC 'TIPO DESCONTO',
  SSERVICO.NOME SERVIÇO,
  /*SPARCELA.PARCELA,*/
  1 QDE
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

  LEFT JOIN SBOLSAALUNO (NOLOCK)			ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 											   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 											   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
  LEFT JOIN SBOLSA (NOLOCK)					ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  											   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA											   
  											   
  LEFT JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  											   SSERVICO.CODSERVICO = SBOLSAALUNO.CODSERVICO  											   

  											   
  INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
  											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
  											   SMATRICPL.RA = SCONTRATO.RA
  
  INNER JOIN SSTATUS (NOLOCK)				ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  											   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

/*
  LEFT JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SPARCELA.RA = SCONTRATO.RA AND 
  											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET
*/
 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
) X
WHERE X.CODBOLSA IS NOT NULL";3263;;;;12/07/2022;robson.canto;0;1;1;1;;;;0;4cee6cfa-14f1-470e-99c9-46ff1440064f;0;;416;robson.canto;22/12/2021;robson.canto;12/07/2022;0
G;Cubo.014;Alunos com Bolsa 100% e possui Pensionato;" SELECT DISTINCT
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SCONTRATO.IDPERLET,
  SCONTRATO.STATUS,
  SCONTRATO.CODCONTRATO CONTRATO,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  SBOLSAALUNO.CODBOLSA,
  SBOLSA.NOME BOLSA,
  SBOLSA.VALOR,
  1 QDE
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

  INNER JOIN SBOLSAALUNO (NOLOCK)			ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 											   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 											   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
  INNER JOIN SBOLSA (NOLOCK)				ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  											   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA AND
  											   SBOLSA.VALOR = 100
  											   											 
  LEFT JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SPARCELA.RA = SCONTRATO.RA AND 
  											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET										     
  
  LEFT JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
  											   SLAN.IDPARCELA = SPARCELA.IDPARCELA  											   

  LEFT JOIN FLAN (NOLOCK)					ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  											   FLAN.IDLAN = SLAN.IDLAN AND
  											   FLAN.CODTDO <> 'PENS'
  											     											   
 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SCONTRATO.RA IN (SELECT DISTINCT
 	 						  SCONTRATO.RA
 
 							 FROM
  							  SCONTRATO (NOLOCK)
  
  							  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   							   SALUNO.RA = SCONTRATO.RA
  											   
  							  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  							  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   							   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

  							  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   							   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  							  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   							   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  							  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   							   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   							   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   							   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

  							  LEFT JOIN SBOLSAALUNO (NOLOCK)			ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   							   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 											   							   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 											   							   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
  							  LEFT JOIN SBOLSA (NOLOCK)					ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  											   							   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA AND
  											   							   SBOLSA.VALOR <> 100
  											   											 
  							  INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   							   SPARCELA.RA = SCONTRATO.RA AND 
  											   							   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   							   SPARCELA.IDPERLET = SCONTRATO.IDPERLET										     
  
  							  INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
  											   							   SLAN.IDPARCELA = SPARCELA.IDPARCELA  											   

  							  INNER JOIN FLAN (NOLOCK)					ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  											   							   FLAN.IDLAN = SLAN.IDLAN AND
  											   							   FLAN.CODTDO = 'PENS'
  											     											   
 							 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
								AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
						   )";5404;;;;27/12/2021;robson.canto;0;1;1;1;;;;0;09a652df-b2e7-4491-9b6e-42cabba3f2ad;0;;-15765;robson.canto;27/12/2021;robson.canto;27/12/2021;0
G;Cubo.015;Alunos que não fizeram rematrícula no próximo período letivo;"SELECT DISTINCT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.RA,
 SCONTRATO.IDPERLET,
 SCONTRATO.IDHABILITACAOFILIAL,
 SCONTRATO.CODCONTRATO CONTRATO,
 PPESSOA.NOME ALUNO,
 PPESSOA.EMAIL,
 PPESSOA.TELEFONE1 TELEFONE,
 PPESSOA.TELEFONE2 CELULAR,
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,

 CASE WHEN SHABILITACAOALUNO.CODSTATUS = 11 THEN 'FORMADO'
 	  ELSE SSTATUS.DESCRICAO END STATUS,
 	
 (SELECT DISTINCT
   'SIM' 
  
  FROM
   SMATRICPL SM (NOLOCK)
 
   INNER JOIN SCONTRATO SC (NOLOCK)	     	ON SC.CODCOLIGADA = SM.CODCOLIGADA AND 
 								   		   	   SC.IDPERLET = SM.IDPERLET AND 
 								   		   	   SC.IDHABILITACAOFILIAL = SM.IDHABILITACAOFILIAL AND 
 								   		   	   SC.RA = SM.RA
 								   
   INNER JOIN SPLETIVO SP (NOLOCK)			ON SP.CODCOLIGADA = SM.CODCOLIGADA AND 
 								   		   	   SP.IDPERLET = SM.IDPERLET
   INNER JOIN SHABILITACAOFILIAL SH (NOLOCK)ON SH.CODCOLIGADA = SC.CODCOLIGADA AND
 										   	   SH.IDHABILITACAOFILIAL = SC.IDHABILITACAOFILIAL 
  
   INNER JOIN SCURSO SCU (NOLOCK)			ON SCU.CODCOLIGADA = SH.CODCOLIGADA AND
 										   	   SCU.CODCURSO = SH.CODCURSO

  WHERE	SM.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SC.CODTIPOCURSO = SCONTRATO.CODTIPOCURSO
	AND SP.CODPERLET = :Próximo_Período
	AND SC.RA = SCONTRATO.RA
	AND SCU.NOME NOT LIKE '%pensionato%'
 	/*AND SH.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SM.CODSTATUS <> 11*/
 ) MATRICULADO,
 1 QDE
 
FROM
 SMATRICPL (NOLOCK)
 
 INNER JOIN SCONTRATO (NOLOCK)		    ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   		   SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
 								   		   SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 								   		   SCONTRATO.RA = SMATRICPL.RA
 								   
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   		   SPLETIVO.IDPERLET = SMATRICPL.IDPERLET

 INNER JOIN SSTATUS (NOLOCK)			ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   		   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS 								   

 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   		   SALUNO.RA = SMATRICPL.RA 								   
 								   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA  
 
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
 										   
 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

 INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE 										   									   

 LEFT JOIN SHABILITACAOALUNO (NOLOCK)	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   SHABILITACAOALUNO.RA = SMATRICPL.RA

WHERE	SMATRICPL.CODCOLIGADA = :Coligada
	AND SCONTRATO.CODTIPOCURSO = 1
	AND SPLETIVO.CODPERLET LIKE :Período_Atual
	/*AND SMATRICPL.CODSTATUS <> 11*/
	AND SCURSO.NOME NOT LIKE '%pensionato%'";3514;;;;05/01/2022;robson.canto;0;1;1;1;;;;0;e613c848-6f1a-4b64-a0d6-bc5b7a28b0fc;0;;9168;robson.canto;04/01/2022;robson.canto;05/01/2022;0
G;Cubo.016;Alunos com Bolsa Promoção de Rematrícula com Ordem não Informada;"SELECT DISTINCT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.IDPERLET,
 SPLETIVO.CODPERLET PERÍODO,
 SCONTRATO.CODCONTRATO CONTRATO,
 SBOLSAALUNO.RA,
 PPESSOA.NOME ALUNO,
 
 SBOLSAALUNO.CODBOLSA COD_BOLSA,
 SBOLSA.NOME BOLSA,
 SBOLSAALUNO.ORDEMBOLSA ORDEM,
 
 1 QDE
FROM 
 SBOLSAALUNO (NOLOCK)
 
 INNER JOIN SPLETIVO (NOLOCK) 	ON SPLETIVO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND
 						   		   SPLETIVO.IDPERLET = SBOLSAALUNO.IDPERLET

 INNER JOIN SCONTRATO (NOLOCK) 	ON SCONTRATO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 						   		   SCONTRATO.RA = SBOLSAALUNO.RA AND 
 						   		   SCONTRATO.CODCONTRATO = SBOLSAALUNO.CODCONTRATO AND 
 						   		   SCONTRATO.IDPERLET = SBOLSAALUNO.IDPERLET 						   
 
 INNER JOIN SALUNO (NOLOCK)		ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 								   SALUNO.RA = SCONTRATO.RA
 								   
 INNER JOIN PPESSOA (NOLOCK)	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
 
 INNER JOIN SBOLSA (NOLOCK)		ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 								   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA
 								   
WHERE 	SBOLSAALUNO.ORDEMBOLSA IS NULL
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SBOLSA.VALIDADELIMITADA = 1
	AND SALUNO.RA IN (SELECT
					   SB.RA
					  
					  FROM
					   SBOLSAALUNO SB (NOLOCK)
					   
					  WHERE	SB.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
					  	AND SB.RA = SBOLSAALUNO.RA
					  	AND SB.IDPERLET = SBOLSAALUNO.IDPERLET
					  	AND SB.CODBOLSA = 137)

ORDER BY SBOLSAALUNO.RA

/*
SELECT 
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.IDPERLET,
 SPLETIVO.CODPERLET PERÍODO,
 SCONTRATO.CODCONTRATO CONTRATO,
 SBOLSAALUNO.RA,
 PPESSOA.NOME ALUNO,
 SBOLSAALUNO.CODBOLSA BOLSA,
 SBOLSAALUNO.CODSERVICO SERVIÇO,
 SBOLSAALUNO.ORDEMBOLSA ORDEM,
 1 QDE
FROM 
 SBOLSAALUNO (NOLOCK)
 
 INNER JOIN SPLETIVO (NOLOCK) 	ON SPLETIVO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND
 						   		   SPLETIVO.IDPERLET = SBOLSAALUNO.IDPERLET

 INNER JOIN SCONTRATO (NOLOCK) 	ON SCONTRATO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 						   		   SCONTRATO.RA = SBOLSAALUNO.RA AND 
 						   		   SCONTRATO.CODCONTRATO = SBOLSAALUNO.CODCONTRATO AND 
 						   		   SCONTRATO.IDPERLET = SBOLSAALUNO.IDPERLET 						   
 
 INNER JOIN SALUNO (NOLOCK)		ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 								   SALUNO.RA = SCONTRATO.RA
 								   
 INNER JOIN PPESSOA (NOLOCK)	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
 
WHERE 	SBOLSAALUNO.CODBOLSA = 137 
	AND SBOLSAALUNO.ORDEMBOLSA IS NULL
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'

*/";2709;;;;04/01/2022;robson.canto;0;1;1;1;;;;0;8a8ab8d8-6cf2-4aa7-b4a9-5875363657a7;0;;-30501;robson.canto;04/01/2022;robson.canto;04/01/2022;0
G;Cubo.017;Mensalidade alunos pensionato;"SELECT DISTINCT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SCONTRATO.IDPERLET,
 SCONTRATO.STATUS,
 SCONTRATO.CODCONTRATO CONTRATO,
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,
 SBOLSAALUNO.CODBOLSA,
 SBOLSA.NOME BOLSA,
 SBOLSAALUNO.DESCONTO PERC_BOLSA,
 SPARCELA.VALOR,
 ISNULL(SUM(FLANINTEGRACAO.VALOR),0) BOLSA,
 SPARCELA.VALOR - ISNULL(SUM(FLANINTEGRACAO.VALOR),0) LIQUIDO
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
										   SALUNO.RA = SCONTRATO.RA
  											   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 LEFT JOIN SBOLSAALUNO (NOLOCK)			ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 										   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 										   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
 LEFT JOIN SBOLSA (NOLOCK)				ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  										   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA 
  											   											 
 LEFT JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  										   SPARCELA.RA = SCONTRATO.RA AND 
  										   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  										   SPARCELA.IDPERLET = SCONTRATO.IDPERLET										     
  
 LEFT JOIN SSERVICO (NOLOCK)			ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
										   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO

 LEFT JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 										   SLAN.IDPARCELA = SPARCELA.IDPARCELA  											   

 LEFT JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  										   FLAN.IDLAN = SLAN.IDLAN 
  											     											   
 LEFT JOIN FLANINTEGRACAO (NOLOCK)		ON FLANINTEGRACAO.IDLAN = FLAN.IDLAN AND 
 										   FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA

WHERE	SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SCURSO.NOME LIKE '%PENSIONATO%'
	AND SPARCELA.PARCELA = :Parcela
	AND SSERVICO.NOME LIKE '%MENSA%%PENSIONATO%'
	
GROUP BY SCONTRATO.CODCOLIGADA, SCONTRATO.CODFILIAL, SCONTRATO.CODTIPOCURSO, SCONTRATO.RA, PPESSOA.NOME, SCONTRATO.IDPERLET, SCONTRATO.STATUS,
		 SCONTRATO.CODCONTRATO, SCURSO.NOME, SGRADE.DESCRICAO, SBOLSAALUNO.CODBOLSA, SBOLSA.NOME, SBOLSAALUNO.DESCONTO, SPARCELA.PARCELA,
		 FLAN.VALORORIGINAL, SPARCELA.VALOR

UNION ALL

SELECT DISTINCT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SCONTRATO.IDPERLET,
 SCONTRATO.STATUS,
 SCONTRATO.CODCONTRATO CONTRATO,
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,
 SBOLSAALUNO.CODBOLSA,
 SBOLSA.NOME BOLSA,
 SBOLSAALUNO.DESCONTO PERC_BOLSA,
 FLAN.VALORORIGINAL,
 ISNULL(SUM(FLANINTEGRACAO.VALOR),0) BOLSA,
 FLAN.VALORORIGINAL - ISNULL(SUM(FLANINTEGRACAO.VALOR),0)
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
										   SALUNO.RA = SCONTRATO.RA
  											   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 LEFT JOIN SBOLSAALUNO (NOLOCK)			ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 										   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 										   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
 LEFT JOIN SBOLSA (NOLOCK)				ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  										   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA 
  											   											 
 LEFT JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  										   SPARCELA.RA = SCONTRATO.RA AND 
  										   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  										   SPARCELA.IDPERLET = SCONTRATO.IDPERLET										     
  
 LEFT JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 										   SLAN.IDPARCELA = SPARCELA.IDPARCELA  											   

 LEFT JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  										   FLAN.IDLAN = SLAN.IDLAN 
  											     											   
 LEFT JOIN FLANINTEGRACAO (NOLOCK)		ON FLANINTEGRACAO.IDLAN = FLAN.IDLAN AND 
 										   FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA

WHERE	SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SCURSO.NOME NOT LIKE '%PENSIONATO%'
	AND SPARCELA.PARCELA = :Parcela
    AND SCONTRATO.RA IN (SELECT DISTINCT
 						  SCONTRATO.RA
 
						 FROM
 						  SCONTRATO (NOLOCK)
 
 						  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
										   							   SALUNO.RA = SCONTRATO.RA
  											   
 						  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
 						  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   							   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

 						  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   							   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 						  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   							   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 						  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   							   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   							   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   							   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

						  INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  																	   SPARCELA.RA = SCONTRATO.RA AND 
  																	   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  																	   SPARCELA.IDPERLET = SCONTRATO.IDPERLET										     

						  INNER JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
																	   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
						   
						WHERE	SCONTRATO.CODCOLIGADA = 1 
							AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
							AND SPARCELA.PARCELA = :Parcela
							AND SSERVICO.NOME LIKE '%MENSA%%PENSIONATO%'
							AND SCURSO.NOME LIKE '%PENSIONATO%')

GROUP BY SCONTRATO.CODCOLIGADA, SCONTRATO.CODFILIAL, SCONTRATO.CODTIPOCURSO, SCONTRATO.RA, PPESSOA.NOME, SCONTRATO.IDPERLET, SCONTRATO.STATUS,
		 SCONTRATO.CODCONTRATO, SCURSO.NOME, SGRADE.DESCRICAO, SBOLSAALUNO.CODBOLSA, SBOLSA.NOME, SBOLSAALUNO.DESCONTO, SPARCELA.PARCELA,
		 FLAN.VALORORIGINAL, SPARCELA.VALOR
";8644;;;;13/01/2022;robson.canto;0;1;1;1;;;;0;51342712-3108-4a88-8c5a-9c25c991de7e;0;;-28639;robson.canto;13/01/2022;robson.canto;13/01/2022;0
G;Cubo.018;Relatório para Acerto JW - Jurídico;"SELECT
 FLAN.CODCOLIGADA,
 FLAN.CODFILIAL FILIAL,
 FLAN.IDLAN,
 SPARCELA.RA,
 PPESSOA.NOME ALUNO,
 FLAN.NUMERODOCUMENTO DOCUMENTO,
 FLAN.CODTDO 'TIPO DOC',
 YEAR(FLAN.DATAVENCIMENTO) ANO,
 MONTH(FLAN.DATAVENCIMENTO) MES,
 FLAN.VALORORIGINAL PRINCIPAL,
 SUM(FLANINTEGRACAO.VALOR) BOLSA,
 FLAN.VALORBAIXADO - SUM(FLANBAIXA.VALORBAIXA) BAIXA_ANTERIOR,
 FLAN.VALORORIGINAL - SUM(FLANINTEGRACAO.VALOR) - FLAN.VALORBAIXADO + SUM(FLANBAIXA.VALORBAIXA) 'LIQ SEM JUROS/MULTA',
 
 CASE WHEN FLAN.CODCFO <> '58807' AND FLAN.CODCFO NOT IN ('SELETIVO', 'TAX_APRO', 'TAX_EXT') AND SPARCELA.PARCELA <> 1 
      THEN (FLAN.VALORORIGINAL - SUM(FLANINTEGRACAO.VALOR) - FLAN.VALORBAIXADO + SUM(FLANBAIXA.VALORBAIXA)) * 0.02 
	  ELSE 0 END MULTA,

 CASE WHEN FLAN.CODCFO <> '58807' AND FLAN.CODCFO NOT IN ('SELETIVO', 'TAX_APRO', 'TAX_EXT') AND SPARCELA.PARCELA <> 1 
      THEN ((((FLAN.VALORORIGINAL - SUM(FLANINTEGRACAO.VALOR) - FLAN.VALORBAIXADO + SUM(FLANBAIXA.VALORBAIXA)) * 0.01) / 30) * DATEDIFF(DAY, FLAN.DATAVENCIMENTO, GETDATE()) )
	  ELSE 0 END JUROS,

 SUM(FLANBAIXA.VALORBAIXA) RECEBIDO,
 CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) BAIXA,
 SUM(FLANBAIXA.VALORBAIXA) * 0.1 CUSTAS

FROM
 FLAN (NOLOCK)

 INNER JOIN FLANBAIXA (NOLOCK)		ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
									   FLANBAIXA.IDLAN = FLAN.IDLAN AND
									   FLANBAIXA.STATUS <> 1

 INNER JOIN SLAN (NOLOCK)			ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
									   SLAN.IDLAN = FLAN.IDLAN

 INNER JOIN SPARCELA (NOLOCK)		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND
									   SPARCELA.IDPARCELA = SLAN.IDPARCELA

 INNER JOIN SALUNO (NOLOCK)			ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
									   SALUNO.RA = SPARCELA.RA
 
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA

 LEFT JOIN FLANINTEGRACAO (NOLOCK)		ON FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA AND			
										   FLANINTEGRACAO.IDLAN = FLAN.IDLAN AND
										   FLANINTEGRACAO.IDCAMPO <> 49

WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.CODFILIAL LIKE :Filial
	AND FLANBAIXA.DATABAIXA >= :Baixa_Inicio
	AND FLANBAIXA.DATABAIXA <= :Baixa_Fim
	AND FLAN.DATAVENCIMENTO <= :Limite_Vencto

GROUP BY FLAN.CODCOLIGADA, FLAN.IDLAN, SPARCELA.RA, PPESSOA.NOME, FLAN.NUMERODOCUMENTO, FLAN.DATAVENCIMENTO, FLAN.VALORORIGINAL,
		 FLANBAIXA.DATABAIXA, FLAN.CODTDO, FLAN.VALORBAIXADO, FLAN.CODCFO, SPARCELA.PARCELA, FLAN.CODFILIAL
";2439;;;;08/09/2022;robson.canto;0;1;1;1;;;;0;2087fce7-1df7-40fd-95db-87587cfb34ed;0;;28959;robson.canto;13/01/2022;robson.canto;08/09/2022;0
G;Cubo.019;Caixa;"SELECT	  
  FSESSAOCAIXA.CODCOLIGADA,
  FSESSAOCAIXA.CODFILIAL FILIAL,
  FSESSAOCAIXA.IDSESSAO, 
  FSESSAOCAIXA.NUMEROCAIXA CAIXA, 
  FSESSAOCAIXA.CODUSUARIOOPERADOR 'CÓD. OPERADOR',
  GUSUARIO.NOME OPERADOR,
  FSESSAOCAIXA.DATAHORAABERTURA ABERTURA,
  FSESSAOCAIXA.DATAHORAFECHAMENTO FECHAMENTO,
  FSESSAOCAIXA.CODCXA 'CÓD. CONTA',
  FCXA.DESCRICAO 'CONTA CAIXA',
  FLAN.IDLAN,
  FLAN.NUMERODOCUMENTO DOCUMENTO,
  FLAN.CODCFO,
  FCFO.NOME RESPONSÁVEL,
  FLANBAIXA.IDBAIXA,
  FLANBAIXA.USUARIO 'USUÁRIO BAIXA',
  CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) BAIXA,
  
  CASE WHEN FLANBAIXA.STATUS <> 1 THEN SUM(FLANBAIXA.VALORBAIXA)
	   ELSE 0 END RECEBIMENTOS,
  
  CASE WHEN FLANBAIXA.STATUS = 1 AND FLOGSESSAOCAIXA.CLASSIFICACAO = 272 THEN SUM(FLANBAIXA.VALORBAIXA)
	   ELSE 0 END ESTORNADOS,

  TFORMAPAGTO.CODFORMAPAGTO,
  TFORMAPAGTO.DESCFORMAPAGTO 'FORMA PAGTO'
  
 FROM 
  FSESSAOCAIXA (NOLOCK)
  
  INNER JOIN GFILIAL (NOLOCK)			ON GFILIAL.CODCOLIGADA = FSESSAOCAIXA.CODCOLIGADA AND 
  										   GFILIAL.CODFILIAL = FSESSAOCAIXA.CODFILIAL
  										   
  INNER JOIN FCXA (NOLOCK)				ON FCXA.CODCOLIGADA = FSESSAOCAIXA.CODCOLCXA AND 
  									   	   FCXA.CODCXA = FSESSAOCAIXA.CODCXA
  
  INNER JOIN GUSUARIO (NOLOCK)			ON GUSUARIO.CODUSUARIO = FSESSAOCAIXA.CODUSUARIOOPERADOR


  INNER JOIN FLOGSESSAOCAIXA (NOLOCK)	ON FLOGSESSAOCAIXA.CODCOLIGADA = FSESSAOCAIXA.CODCOLIGADA AND 
  										   FLOGSESSAOCAIXA.IDSESSAO = FSESSAOCAIXA.IDSESSAO
  
  INNER JOIN FLANBAIXA (NOLOCK)			ON FLANBAIXA.CODCOLIGADA = FLOGSESSAOCAIXA.CODCOLIGADA AND 
  										   FLANBAIXA.IDLAN = FLOGSESSAOCAIXA.IDLAN AND 
  										   FLANBAIXA.IDBAIXA = FLOGSESSAOCAIXA.IDBAIXA 
  
  INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLCXA = FLANBAIXA.CODCOLIGADA AND 
  										   FLAN.IDLAN = FLANBAIXA.IDLAN
  
  INNER JOIN TFORMAPAGTO (NOLOCK)    	ON TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND 
  										   TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
										   
  INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
										   FCFO.CODCFO = FLAN.CODCFO

 WHERE  FSESSAOCAIXA.CODCOLIGADA = 1
 	AND CONVERT(VARCHAR(10), FSESSAOCAIXA.DATAHORAABERTURA, 103) = :Data_S
	/*AND FSESSAOCAIXA.IDSESSAO = 1754*/
 	 	
GROUP BY FSESSAOCAIXA.CODCOLIGADA,
		 FSESSAOCAIXA.CODFILIAL,
		 FSESSAOCAIXA.IDSESSAO, 
		 FSESSAOCAIXA.NUMEROCAIXA, 
		 FSESSAOCAIXA.CODUSUARIOOPERADOR,
		 GUSUARIO.NOME,
		 FSESSAOCAIXA.DATAHORAABERTURA,
		 FSESSAOCAIXA.DATAHORAFECHAMENTO,
		 FSESSAOCAIXA.CODCXA,
		 FCXA.DESCRICAO,
		 FSESSAOCAIXA.SALDOBAIXADORECEBIDO,
		 FSESSAOCAIXA.SALDORECEBIMENTOSESTORNADOS,
		 FSESSAOCAIXA.QTDEBAIXASRECEBER,
		 FSESSAOCAIXA.QTDEESTORNOSBAIXASRECEBER,
		 TFORMAPAGTO.CODFORMAPAGTO,
		 TFORMAPAGTO.DESCFORMAPAGTO,
		 FLANBAIXA.IDFORMAPAGTO,
		 FLANBAIXA.STATUS,
		 FLAN.IDLAN,
		 FLAN.NUMERODOCUMENTO,
		 FLAN.CODCFO,
		 FCFO.NOME,
  		 FLANBAIXA.IDBAIXA,
  		 FLANBAIXA.USUARIO,
		 FLANBAIXA.DATABAIXA,
		 FLOGSESSAOCAIXA.CLASSIFICACAO
";3059;;;;28/02/2022;robson.canto;0;1;1;1;;;;0;e8b84d83-c8cc-4cab-8154-1d2ef245bf99;0;;-18716;robson.canto;28/02/2022;robson.canto;28/02/2022;0
G;Cubo.019.1;Caixa;"SELECT	  
  FSESSAOCAIXA.CODCOLIGADA,
  FSESSAOCAIXA.CODFILIAL FILIAL,
  FSESSAOCAIXA.IDSESSAO, 
  FSESSAOCAIXA.NUMEROCAIXA CAIXA, 
  FSESSAOCAIXA.CODUSUARIOOPERADOR 'CÓD. OPERADOR',
  GUSUARIO.NOME OPERADOR,
  FSESSAOCAIXA.DATAHORAABERTURA ABERTURA,
  FSESSAOCAIXA.DATAHORAFECHAMENTO FECHAMENTO,
  FSESSAOCAIXA.CODCXA 'CÓD. CONTA',
  FCXA.DESCRICAO 'CONTA CAIXA',
  FLAN.IDLAN,
  FLAN.NUMERODOCUMENTO DOCUMENTO,
  FLAN.CODCFO,
  FCFO.NOME RESPONSÁVEL,
  FLANBAIXA.IDBAIXA,
  FLANBAIXA.USUARIO 'USUÁRIO BAIXA',
  CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) BAIXA,
  
  CASE WHEN FLANBAIXA.STATUS <> 1 THEN SUM(FLANBAIXA.VALORBAIXA)
	   ELSE 0 END RECEBIMENTOS,
  
  CASE WHEN FLANBAIXA.STATUS = 1 AND FLOGSESSAOCAIXA.CLASSIFICACAO = 272 THEN SUM(FLANBAIXA.VALORBAIXA)
	   ELSE 0 END ESTORNADOS,

  TFORMAPAGTO.CODFORMAPAGTO,
  TFORMAPAGTO.DESCFORMAPAGTO 'FORMA PAGTO'
  
 FROM 
  FSESSAOCAIXA (NOLOCK)
  
  INNER JOIN GFILIAL (NOLOCK)			ON GFILIAL.CODCOLIGADA = FSESSAOCAIXA.CODCOLIGADA AND 
  										   GFILIAL.CODFILIAL = FSESSAOCAIXA.CODFILIAL
  										   
  INNER JOIN FCXA (NOLOCK)				ON FCXA.CODCOLIGADA = FSESSAOCAIXA.CODCOLCXA AND 
  									   	   FCXA.CODCXA = FSESSAOCAIXA.CODCXA
  
  INNER JOIN GUSUARIO (NOLOCK)			ON GUSUARIO.CODUSUARIO = FSESSAOCAIXA.CODUSUARIOOPERADOR


  INNER JOIN FLOGSESSAOCAIXA (NOLOCK)	ON FLOGSESSAOCAIXA.CODCOLIGADA = FSESSAOCAIXA.CODCOLIGADA AND 
  										   FLOGSESSAOCAIXA.IDSESSAO = FSESSAOCAIXA.IDSESSAO
  
  INNER JOIN FLANBAIXA (NOLOCK)			ON FLANBAIXA.CODCOLIGADA = FLOGSESSAOCAIXA.CODCOLIGADA AND 
  										   FLANBAIXA.IDLAN = FLOGSESSAOCAIXA.IDLAN AND 
  										   FLANBAIXA.IDBAIXA = FLOGSESSAOCAIXA.IDBAIXA 
  
  INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLCXA = FLANBAIXA.CODCOLIGADA AND 
  										   FLAN.IDLAN = FLANBAIXA.IDLAN
  
  INNER JOIN TFORMAPAGTO (NOLOCK)    	ON TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND 
  										   TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
										   
  INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
										   FCFO.CODCFO = FLAN.CODCFO

 WHERE  FSESSAOCAIXA.CODCOLIGADA = 1
 	AND CONVERT(VARCHAR(10), FSESSAOCAIXA.DATAHORAABERTURA, 103) between :DataINI_S and :DataFIM_S
	/*AND FSESSAOCAIXA.IDSESSAO = 1754*/
 	 	
GROUP BY FSESSAOCAIXA.CODCOLIGADA,
		 FSESSAOCAIXA.CODFILIAL,
		 FSESSAOCAIXA.IDSESSAO, 
		 FSESSAOCAIXA.NUMEROCAIXA, 
		 FSESSAOCAIXA.CODUSUARIOOPERADOR,
		 GUSUARIO.NOME,
		 FSESSAOCAIXA.DATAHORAABERTURA,
		 FSESSAOCAIXA.DATAHORAFECHAMENTO,
		 FSESSAOCAIXA.CODCXA,
		 FCXA.DESCRICAO,
		 FSESSAOCAIXA.SALDOBAIXADORECEBIDO,
		 FSESSAOCAIXA.SALDORECEBIMENTOSESTORNADOS,
		 FSESSAOCAIXA.QTDEBAIXASRECEBER,
		 FSESSAOCAIXA.QTDEESTORNOSBAIXASRECEBER,
		 TFORMAPAGTO.CODFORMAPAGTO,
		 TFORMAPAGTO.DESCFORMAPAGTO,
		 FLANBAIXA.IDFORMAPAGTO,
		 FLANBAIXA.STATUS,
		 FLAN.IDLAN,
		 FLAN.NUMERODOCUMENTO,
		 FLAN.CODCFO,
		 FCFO.NOME,
  		 FLANBAIXA.IDBAIXA,
  		 FLANBAIXA.USUARIO,
		 FLANBAIXA.DATABAIXA,
		 FLOGSESSAOCAIXA.CLASSIFICACAO
";3083;;;;24/10/2022;isaldo;0;1;1;1;;;;0;e8b84d83-c8cc-4cab-8154-1d2ef245bf99;0;;-25593;isaldo;24/10/2022;isaldo;24/10/2022;0
G;Cubo.020;Alunos FIES;"SELECT
 SALUNO.CODCOLIGADA COLIGADA,
 SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
 SPLETIVO.IDPERLET,
 SALUNO.RA,
 PPESSOA.NOME ALUNO,
 SHABILITACAOFILIAL.CODFILIAL FILIAL,
 SHABILITACAOFILIAL.CODCURSO,
 SCURSO.NOME CURSO, 
 SGRADE.DESCRICAO MATRIZ,
 SPLETIVO.CODPERLET PERÍODO,
 SCONTRATO.CODCONTRATO CONTRATO,
 1 QDE
 
FROM
 SHABILITACAOALUNO (NOLOCK)
 
 INNER JOIN SHABILITACAOALUNOCOMPL (NOLOCK)	ON SHABILITACAOALUNOCOMPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
 											   SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
 											   SHABILITACAOALUNOCOMPL.RA = SHABILITACAOALUNO.RA

 INNER JOIN SALUNO (NOLOCK)					ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
 											   SALUNO.RA = SHABILITACAOALUNO.RA
 											   
 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA 											   
 
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

 INNER JOIN SCURSO (NOLOCK)					ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

 INNER JOIN SGRADE (NOLOCK)					ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
 											   SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
 											   SMATRICPL.RA = SHABILITACAOALUNO.RA
 											   
 LEFT JOIN SCONTRATO (NOLOCK)				ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 											   SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
 											   SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 											   SCONTRATO.RA = SMATRICPL.RA 											   

 INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 											   
WHERE	SHABILITACAOALUNOCOMPL.FIES = 'T' 											   
	AND SPLETIVO.CODPERLET LIKE :PERÍODO_LETIVO + '%'";2393;;;;21/04/2022;robson.canto;0;1;1;1;;;;0;fdbfad5f-6b0b-4498-8495-c93e56548a48;0;;20772;robson.canto;21/04/2022;robson.canto;21/04/2022;0
G;Cubo.021;Conferência Contratos SIGA;"SELECT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO 'NIVEL ENSINO',
 SCONTRATO.IDPERLET,
 SCONTRATO.CODCONTRATO,
 
 SCURSO.CODCURSO,
 SCURSO.NOME CURSO,
 SGRADE.CODGRADE,
 SGRADE.CODHABILITACAO,
 SGRADE.DESCRICAO MATRIZ,
 
 CASE WHEN SGRADE.STATUS = 1 THEN 'INATIVA' 
 	  WHEN SGRADE.STATUS = 0 THEN 'ATIVA'
 	  WHEN SGRADE.STATUS = 2 THEN 'ATUAL' END 'STATUS MATRIZ.',
 
 SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
 SHABILITACAOFILIAL.ATIVO OFERTA,
 SCONTRATO.RA,
 SPARCELA.IDPARCELA,
 SPARCELA.CODSERVICO,
 SSERVICO.NOME SERVIÇO,
 SPARCELA.PARCELA,
 SPARCELA.DTVENCIMENTO 'VENCTO PARCELA',
 SPARCELA.VALOR 'VALOR PARCELA',
 SRESPONSAVEL.CODCFO 'CODCFO RESP',
 FLAN.IDLAN,
 FLAN.DATACRIACAO CRIAÇÃO,
 FLAN.DATAVENCIMENTO VENCIMENTO,
 FLAN.MESDECOMPETENCIA COMPETÊNCIA,
 FLAN.CODCFO 'CODCFO LANÇAMENTO',
 FCFO.NOME RESPONSÁVEL,
 FLAN.CODTDO 'TIPO DOC',
 FLAN.VALORORIGINAL 'VALOR LANÇAMENTO',
 
 CASE WHEN FLAN.TIPOCONTABILLAN = 0 THEN 'NÃO CONTÁBIL'
 	  WHEN FLAN.TIPOCONTABILLAN = 1 THEN 'CONTÁBIL'
 	  WHEN FLAN.TIPOCONTABILLAN = 2 THEN 'BAIXA CONTÁBIL'
 	  WHEN FLAN.TIPOCONTABILLAN = 3 THEN 'A CONTABILIZAR' END 'TIPO CONT',
 	  
 FLANRATCCU.CODCCUSTO,
 GCCUSTO.NOME 'C. CUSTO,',
 FLANRATCCU.CODNATFINANCEIRA 'COD NAT',
 TTBORCAMENTO.DESCRICAO 'NATUREZA ORÇAMENTÁRIA',
 1 QDE
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
 											   
 INNER JOIN SCURSO (NOLOCK)					ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 											   
 INNER JOIN SGRADE (NOLOCK)					ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
 											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
 											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE 
 
 LEFT JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPARCELA.RA = SCONTRATO.RA AND 
 											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET

 LEFT JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
 											   
 LEFT JOIN SRESPONSAVEL (NOLOCK)			ON SRESPONSAVEL.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SRESPONSAVEL.IDPARCELA = SPARCELA.IDPARCELA

 LEFT JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SLAN.IDPARCELA = SPARCELA.IDPARCELA
 											   
 LEFT JOIN FLAN (NOLOCK)					ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 											   FLAN.IDLAN = SLAN.IDLAN
 											   
 LEFT JOIN FCFO (NOLOCK)					ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
 											   FCFO.CODCFO = FLAN.CODCFO
 											   
 LEFT JOIN FLANRATCCU (NOLOCK)				ON FLANRATCCU.CODCOLIGADA = FLAN.CODCOLIGADA AND 
 											   FLANRATCCU.IDLAN = FLAN.IDLAN
 											   
 LEFT JOIN GCCUSTO (NOLOCK)					ON GCCUSTO.CODCOLIGADA = FLANRATCCU.CODCOLIGADA AND 
 											   GCCUSTO.CODCCUSTO = FLANRATCCU.CODCCUSTO 											   										   									    											   
 											   
 LEFT JOIN TTBORCAMENTO (NOLOCK)			ON TTBORCAMENTO.CODCOLIGADA = FLANRATCCU.CODCOLNATFINANCEIRA AND 
 											   TTBORCAMENTO.CODTBORCAMENTO = FLANRATCCU.CODNATFINANCEIRA 											   

WHERE	SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET = 'SIGA'
	AND SCONTRATO.CODFILIAL = :Filial
	AND SCONTRATO.CODTIPOCURSO = :Nível
  	AND SSERVICO.NOME LIKE '%' + :Serviço + '%'
	AND SCURSO.NOME LIKE '%' + :Curso + '%'";4008;;;;23/05/2022;robson.canto;0;1;1;1;;;;0;efc68279-eaca-4b6c-9093-721c2c53d1a5;0;;-24790;robson.canto;23/05/2022;robson.canto;23/05/2022;0
G;Cubo.022;Alunos com Contratos NÃO Assinados com Status CURSANDO e CONCLUÍDO;"SELECT DISTINCT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SCONTRATO.IDPERLET,
 SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
 SCONTRATO.CODCONTRATO CONTRATO,
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,
 SSTATUS.DESCRICAO STATUS,
 1 SEQ
  
FROM
 SCONTRATO (NOLOCK)
  
 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  										   SALUNO.RA = SCONTRATO.RA
  											   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 INNER JOIN SMATRICPL (NOLOCK)			ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 										   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 										   SMATRICPL.RA = SCONTRATO.RA
 										   
 INNER JOIN SSTATUS (NOLOCK)			ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 										   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
 										   
WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SCONTRATO.ASSINADO = 'N'
	AND SSTATUS.DESCRICAO IN ('Cursando', 'Concluído')";2065;;;;08/06/2022;robson.canto;0;1;1;1;;;;0;86e2cb24-134e-4e7c-98bc-980504ed7540;0;;15219;robson.canto;08/06/2022;robson.canto;08/06/2022;0
G;Cubo.023;Alunos com Contratos ASSINADOS com Curso CANCELADO;"SELECT DISTINCT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SCONTRATO.IDPERLET,
 SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
 SCONTRATO.CODCONTRATO CONTRATO,
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,
 SSTATUS.DESCRICAO STATUS,
 CONVERT(VARCHAR(10), SCONTRATO.DTASSINATURA, 103) ASSINATURA,
 CONVERT(VARCHAR(10), SCONTRATO.DTCANCELAMENTO, 103) CANCELAMENTO,
 1 SEQ
  
FROM
 SCONTRATO (NOLOCK)
  
 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  										   SALUNO.RA = SCONTRATO.RA
  											   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 INNER JOIN SMATRICPL (NOLOCK)			ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 										   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 										   SMATRICPL.RA = SCONTRATO.RA
 										   
 INNER JOIN SSTATUS (NOLOCK)			ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 										   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
 										   
WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SCONTRATO.ASSINADO = 'S'
	AND SCONTRATO.DTCANCELAMENTO IS NOT NULL
	";2190;;;;08/06/2022;robson.canto;0;1;1;1;;;;0;4eb8ed35-8b87-450b-ad5e-275b95c5ac95;0;;-18266;robson.canto;08/06/2022;robson.canto;08/06/2022;0
G;Cubo.024;Verificação de Alunos com Bolsa x Bolsa Futura;"SELECT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.IDPERLET,
 SPLETIVO.CODPERLET 'PERÍODO LETIVO',
 SCONTRATO.CODCONTRATO CONTRATO,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SALUNO.RA,
 PPESSOA.NOME ALUNO,
 SCURSO.NOME CURSO,
 SBOLSA.CODBOLSA,
 SBOLSA.NOME BOLSA,
 SSERVICO.NOME SERVIÇO, 
 SBOLSAALUNO.PARCELAINICIAL 'PARC. INI.',
 SBOLSAALUNO.PARCELAFINAL 'PARC. FIM',
 CASE WHEN SBOLSAALUNO.TIPODESC = 'P' THEN 'Percentual'
 	  WHEN SBOLSAALUNO.TIPODESC = 'V' THEN 'Valor' END 'Tipo Desc.',
 SBOLSAALUNO.DESCONTO,
 SCONCESSAOBOLSA.CODBOLSA,
 SCONCESSAOBOLSASERVICO.IDCONCESSAOBOLSA,
 CONVERT(VARCHAR(10), SCONCESSAOBOLSA.DTINICIO, 103) 'INI CONCESSÃO',
 CONVERT(VARCHAR(10), SCONCESSAOBOLSA.DTFIM, 103) 'FIM CONCESSÃO',
 1 QDE
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 										   
 INNER JOIN SBOLSAALUNO (NOLOCK)		ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   	   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 									   	   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 									   	   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
 INNER JOIN SBOLSA (NOLOCK)				ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 									   	   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA 
 									   
 INNER JOIN SSERVICO (NOLOCK)			ON SSERVICO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 										   SSERVICO.CODSERVICO = SBOLSAALUNO.CODSERVICO
 
 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 								   	   	   SALUNO.RA = SCONTRATO.RA
 								   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

 INNER JOIN SHABILITACAOALUNO (NOLOCK)	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   SHABILITACAOALUNO.RA = SCONTRATO.RA

 LEFT JOIN SCONCESSAOBOLSAHABALUNO (NOLOCK)	ON SCONCESSAOBOLSAHABALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
 											   SCONCESSAOBOLSAHABALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
 											   SCONCESSAOBOLSAHABALUNO.RA = SHABILITACAOALUNO.RA AND
 											   SCONCESSAOBOLSAHABALUNO.CODBOLSA = SBOLSAALUNO.CODBOLSA									   
  											   
 LEFT JOIN SCONCESSAOBOLSA (NOLOCK)			ON SCONCESSAOBOLSA.CODCOLIGADA = SCONCESSAOBOLSAHABALUNO.CODCOLIGADA AND 
 											   SCONCESSAOBOLSA.IDCONCESSAOBOLSA = SCONCESSAOBOLSAHABALUNO.IDCONCESSAOBOLSA AND
 											   SCONCESSAOBOLSA.CODBOLSA = SCONCESSAOBOLSAHABALUNO.CODBOLSA

 LEFT JOIN SCONCESSAOBOLSASERVICO (NOLOCK)	ON SCONCESSAOBOLSASERVICO.CODCOLIGADA = SCONCESSAOBOLSA.CODCOLIGADA AND 
 											   SCONCESSAOBOLSASERVICO.IDCONCESSAOBOLSA = SCONCESSAOBOLSA.IDCONCESSAOBOLSA AND
 											   SCONCESSAOBOLSASERVICO.CODSERVICO = SBOLSAALUNO.CODSERVICO

WHERE	SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SCONTRATO.CODTIPOCURSO LIKE :Nível";3468;;;;15/06/2022;robson.canto;0;1;1;1;;;;0;b583060c-1c01-425f-92af-b18540d98397;0;;4201;robson.canto;15/06/2022;robson.canto;15/06/2022;0
G;Cubo.025;Comparativo de Bolsas do Aluno entre Período Letivo;"SELECT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.IDPERLET,
 SPLETIVO.CODPERLET 'PERÍODO LETIVO',
 SCONTRATO.CODCONTRATO CONTRATO,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SALUNO.RA,
 PPESSOA.NOME ALUNO,
 SCURSO.NOME CURSO,
 SBOLSA.CODBOLSA,
 SBOLSA.NOME BOLSA,
 SSERVICO.NOME SERVIÇO,
 SBOLSAALUNO.PARCELAINICIAL 'PARC. INI.',
 SBOLSAALUNO.PARCELAFINAL 'PARC. FIM',
 CASE WHEN SBOLSAALUNO.TIPODESC = 'P' THEN 'Percentual'
 	  WHEN SBOLSAALUNO.TIPODESC = 'V' THEN 'Valor' END 'Tipo Desc.',
 SBOLSAALUNO.DESCONTO,
 1 QDE,
 
 (SELECT DISTINCT
   'SIM' /*SH.IDHABILITACAOFILIAL*/
 
  FROM
   SCONTRATO SC (NOLOCK)
 
   INNER JOIN SHABILITACAOFILIAL SH (NOLOCK)	ON SH.CODCOLIGADA = SC.CODCOLIGADA AND
 										   		   SH.IDHABILITACAOFILIAL = SC.IDHABILITACAOFILIAL
 
   INNER JOIN SPLETIVO SP (NOLOCK)			ON SP.CODCOLIGADA = SC.CODCOLIGADA AND 
 										   	   SP.IDPERLET = SC.IDPERLET
 										   
  WHERE	SH.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SH.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SC.RA = SCONTRATO.RA
	AND SP.CODPERLET = '2022/2'
 ) REMATRICULADO,
 
 (SELECT DISTINCT
   'SIM' /*SH.IDHABILITACAOFILIAL*/
 
  FROM
   SCONTRATO SC (NOLOCK)
 
   INNER JOIN SHABILITACAOFILIAL SH (NOLOCK)	ON SH.CODCOLIGADA = SC.CODCOLIGADA AND
 										   		   SH.IDHABILITACAOFILIAL = SC.IDHABILITACAOFILIAL
 
   INNER JOIN SPLETIVO SP (NOLOCK)				ON SP.CODCOLIGADA = SC.CODCOLIGADA AND 
 										   	   	   SP.IDPERLET = SC.IDPERLET
 										   
   INNER JOIN SBOLSAALUNO SBA (NOLOCK)			ON SBA.CODCOLIGADA = SC.CODCOLIGADA AND 
 									   	   		   SBA.RA = SC.RA AND 
 									   	   		   SBA.CODCONTRATO = SC.CODCONTRATO AND 
 									   	   		   SBA.IDPERLET = SC.IDPERLET
 
   INNER JOIN SBOLSA SB (NOLOCK)				ON SB.CODCOLIGADA = SBA.CODCOLIGADA AND 
 									   	   		   SB.CODBOLSA = SBA.CODBOLSA 
 									   	   		   
  WHERE	SH.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SH.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SC.RA = SCONTRATO.RA
	AND SP.CODPERLET = '2022/2'
	AND SBA.CODBOLSA = SBOLSAALUNO.CODBOLSA
	AND SBA.CODSERVICO = SBOLSAALUNO.CODSERVICO
/*
	AND SBA.PARCELAINICIAL = SBOLSAALUNO.PARCELAINICIAL
	AND SBA.PARCELAFINAL = SBOLSAALUNO.PARCELAFINAL
*/
	AND (	 (SBA.PARCELAINICIAL = SBOLSAALUNO.PARCELAINICIAL
		 	  AND SBA.PARCELAFINAL = SBOLSAALUNO.PARCELAFINAL
		 	 )
		 	  OR SBA.DTINICIO IS NOT NULL
		 	 
		)

 ) 'BOLSA RENOVADA'
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 										   
 INNER JOIN SBOLSAALUNO (NOLOCK)		ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   	   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 									   	   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 									   	   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
 INNER JOIN SBOLSA (NOLOCK)				ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 									   	   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA 
 									   
 INNER JOIN SSERVICO (NOLOCK)			ON SSERVICO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 										   SSERVICO.CODSERVICO = SBOLSAALUNO.CODSERVICO
 										   
 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 								   	   	   SALUNO.RA = SCONTRATO.RA
 								   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

WHERE	SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE '2022/1'
	AND SCONTRATO.CODTIPOCURSO = 1
	
UNION ALL

SELECT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.IDPERLET,
 SPLETIVO.CODPERLET 'PERÍODO LETIVO',
 SCONTRATO.CODCONTRATO CONTRATO,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SALUNO.RA,
 PPESSOA.NOME ALUNO,
 SCURSO.NOME CURSO,
 SBOLSA.CODBOLSA,
 SBOLSA.NOME BOLSA,
 SSERVICO.NOME SERVIÇO,
 SBOLSAALUNO.PARCELAINICIAL 'PARC. INI.',
 SBOLSAALUNO.PARCELAFINAL 'PARC. FIM',
 CASE WHEN SBOLSAALUNO.TIPODESC = 'P' THEN 'Percentual'
 	  WHEN SBOLSAALUNO.TIPODESC = 'V' THEN 'Valor' END 'Tipo Desc.',
 SBOLSAALUNO.DESCONTO,
 1 QDE,
 
 (SELECT DISTINCT
   'SIM' /*SH.IDHABILITACAOFILIAL*/
 
  FROM
   SCONTRATO SC (NOLOCK)
 
   INNER JOIN SHABILITACAOFILIAL SH (NOLOCK)	ON SH.CODCOLIGADA = SC.CODCOLIGADA AND
 										   		   SH.IDHABILITACAOFILIAL = SC.IDHABILITACAOFILIAL
 
   INNER JOIN SPLETIVO SP (NOLOCK)			ON SP.CODCOLIGADA = SC.CODCOLIGADA AND 
 										   	   SP.IDPERLET = SC.IDPERLET
 										   
  WHERE	SH.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SH.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SC.RA = SCONTRATO.RA
	AND SP.CODPERLET = '2022/1'
 ) REMATRICULADO,

 (SELECT DISTINCT
   'SIM' /*SH.IDHABILITACAOFILIAL*/
 
  FROM
   SCONTRATO SC (NOLOCK)
 
   INNER JOIN SHABILITACAOFILIAL SH (NOLOCK)	ON SH.CODCOLIGADA = SC.CODCOLIGADA AND
 										   		   SH.IDHABILITACAOFILIAL = SC.IDHABILITACAOFILIAL
 
   INNER JOIN SPLETIVO SP (NOLOCK)				ON SP.CODCOLIGADA = SC.CODCOLIGADA AND 
 										   	   	   SP.IDPERLET = SC.IDPERLET
 										   
   INNER JOIN SBOLSAALUNO SBA (NOLOCK)			ON SBA.CODCOLIGADA = SC.CODCOLIGADA AND 
 									   	   		   SBA.RA = SC.RA AND 
 									   	   		   SBA.CODCONTRATO = SC.CODCONTRATO AND 
 									   	   		   SBA.IDPERLET = SC.IDPERLET
 
   INNER JOIN SBOLSA SB (NOLOCK)				ON SB.CODCOLIGADA = SBA.CODCOLIGADA AND 
 									   	   		   SB.CODBOLSA = SBA.CODBOLSA 
 									   	   		   
  WHERE	SH.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SH.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SC.RA = SCONTRATO.RA
	AND SP.CODPERLET = '2022/1'
	AND SBA.CODBOLSA = SBOLSAALUNO.CODBOLSA
	AND SBA.CODSERVICO = SBOLSAALUNO.CODSERVICO

	AND (	 (SBA.PARCELAINICIAL = SBOLSAALUNO.PARCELAINICIAL
		 	  AND SBA.PARCELAFINAL = SBOLSAALUNO.PARCELAFINAL
		 	 )
		 	  OR SBA.DTINICIO IS NOT NULL
		 	 
		)
 ) 'BOLSA RENOVADA'
  
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 										   
 INNER JOIN SBOLSAALUNO (NOLOCK)		ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   	   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 									   	   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 									   	   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
 INNER JOIN SBOLSA (NOLOCK)				ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 									   	   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA 
 									   
 INNER JOIN SSERVICO (NOLOCK)			ON SSERVICO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
 										   SSERVICO.CODSERVICO = SBOLSAALUNO.CODSERVICO
 										   
 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 								   	   	   SALUNO.RA = SCONTRATO.RA
 								   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

WHERE	SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE '2022/2'
	AND SCONTRATO.CODTIPOCURSO LIKE '%' 
";7870;;;;15/06/2022;robson.canto;0;1;1;1;;;;0;43a40b03-8c17-4700-b9da-94f00c8ef354;0;;2278;robson.canto;15/06/2022;robson.canto;15/06/2022;0
G;Cubo.026;Análise de Descontos Concedidos - Bolsa;"SELECT 
 X.COLIGADA,
 X.IDLAN,
 X.FILIAL,
 X.NIVEL,
 X.RA,
 X.ALUNO,
 X.IDPERLET,
 X.CONTRATO,
 X.[STATUS MATRÍCULA],
 X.[STATUS CONTRATO],
 X.COMPETÊNCIA,
 X.CURSO,
 X.MATRIZ,
 X.PARCELA,
 X.MENSALIDADE,
 X.CEBAS,
 X.PROUNI,
 X.FIES,
 X.FUNCIONÁRIO,
 X.DEPENDENTE,
 X.INCONDICIONAL,
 X.CONDICIONAL,
 X.MENSALIDADE - X.CEBAS - X.PROUNI - X.FIES - X.FUNCIONÁRIO - X.DEPENDENTE - X.INCONDICIONAL - X.CONDICIONAL LIQUIDO,
 (X.CEBAS + X.PROUNI + X.FIES + X.FUNCIONÁRIO + X.DEPENDENTE + X.INCONDICIONAL + X.CONDICIONAL) 'TOTAL BOLSA',
 
 CASE WHEN (X.CEBAS + X.PROUNI + X.FIES + X.FUNCIONÁRIO + X.DEPENDENTE + X.INCONDICIONAL + X.CONDICIONAL) > 0 THEN (X.CEBAS + X.PROUNI + X.FIES + X.FUNCIONÁRIO + X.DEPENDENTE + X.INCONDICIONAL + X.CONDICIONAL) / X.MENSALIDADE
 	  ELSE 0 END PERCENTUAL

FROM
(
 SELECT DISTINCT
  FLAN.IDLAN,
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SCONTRATO.IDPERLET,
  SCONTRATO.STATUS [STATUS CONTRATO],
  SSTATUS.DESCRICAO [STATUS MATRÍCULA],
  CAST(MONTH(FLAN.MESDECOMPETENCIA) AS VARCHAR(2)) + '/' + CAST(YEAR(FLAN.MESDECOMPETENCIA) AS VARCHAR(4)) COMPETÊNCIA,
  SCONTRATO.CODCONTRATO CONTRATO,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  SPARCELA.PARCELA,
  FLAN.VALORORIGINAL MENSALIDADE,
    
  ISNULL((SELECT
    	   SUM(SBOLSALAN.VALOR)
    
   		  FROM
    	   SBOLSALAN (NOLOCK)
    
   		  WHERE	SBOLSALAN.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   			AND SBOLSALAN.IDLAN = FLAN.IDLAN
   			AND SBOLSALAN.CODBOLSA IN (SELECT
   										SBOLSA.CODBOLSA
   									
   								   	   FROM
   								    	SBOLSA (NOLOCK)
   								    
   								   	   WHERE SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
   								   		 AND SBOLSA.NOME LIKE '%CEBAS%'
   								   	   ) 
  	    ),0) CEBAS,
  
  ISNULL((SELECT
    	   SUM(SBOLSALAN.VALOR)
    
   		  FROM
    	   SBOLSALAN (NOLOCK)
    
   		  WHERE	SBOLSALAN.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   			AND SBOLSALAN.IDLAN = FLAN.IDLAN
   			AND SBOLSALAN.CODBOLSA IN (SELECT
   										SBOLSA.CODBOLSA
   									
   								   	   FROM
   								    	SBOLSA (NOLOCK)
   								    
   								   	   WHERE	SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
   								   			AND SBOLSA.NOME LIKE '%PROUNI%'
   								   	  ) 
  		),0) PROUNI,
    
  ISNULL((SELECT
    	   SUM(SBOLSALAN.VALOR)
    
   		  FROM
    	   SBOLSALAN (NOLOCK)
    
   		  WHERE	SBOLSALAN.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   			AND SBOLSALAN.IDLAN = FLAN.IDLAN
   			AND SBOLSALAN.CODBOLSA IN (SELECT
   										SBOLSA.CODBOLSA
   									
   								   	   FROM
   								    	SBOLSA (NOLOCK)
   								    
   								   	   WHERE	SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
   								   			AND SBOLSA.NOME LIKE '%FIES%'
   								   	  ) 
  		),0) FIES,

  ISNULL((SELECT
    	   SUM(SBOLSALAN.VALOR)
    
   		  FROM
    	   SBOLSALAN (NOLOCK)
    
   		  WHERE	SBOLSALAN.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   			AND SBOLSALAN.IDLAN = FLAN.IDLAN
   			AND SBOLSALAN.CODBOLSA IN (SELECT
   										SBOLSA.CODBOLSA
   									
   								   	   FROM
   								    	SBOLSA (NOLOCK)
   								    
   								   	   WHERE SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
   								   		 AND SBOLSA.NOME LIKE '%FUNCIONÁRIO%' 
   								   		 AND SBOLSA.NOME NOT LIKE '%DEPENDENTE%'
   								      ) 
  		),0) FUNCIONÁRIO,

  ISNULL((SELECT
    	   SUM(SBOLSALAN.VALOR)
    
   		  FROM
    	   SBOLSALAN (NOLOCK)
    
   		  WHERE	SBOLSALAN.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   			AND SBOLSALAN.IDLAN = FLAN.IDLAN
   			AND SBOLSALAN.CODBOLSA IN (SELECT
   										SBOLSA.CODBOLSA
   									
   								   	   FROM
   								    	SBOLSA (NOLOCK)
   								    
   								   	   WHERE	SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
   								   			AND SBOLSA.NOME LIKE '%DEPENDENTE%'
   								   	  ) 
  		),0) DEPENDENTE,

  ISNULL((SELECT
    	   SUM(SBOLSALAN.VALOR)
    
   		  FROM
    	   SBOLSALAN (NOLOCK)
    
   		  WHERE	SBOLSALAN.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   			AND SBOLSALAN.IDLAN = FLAN.IDLAN
   			AND SBOLSALAN.CODBOLSA IN (SELECT
   										SBOLSA.CODBOLSA
   									
   								   	   FROM
   								    	SBOLSA (NOLOCK)
   								    
   								   	   WHERE	SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
   								   			AND SBOLSA.NOME NOT LIKE '%CEBAS%'
   								   			AND SBOLSA.NOME NOT LIKE '%PROUNI%'
   								   			AND SBOLSA.NOME NOT LIKE '%FIES%'
   								   			AND SBOLSA.NOME NOT LIKE '%FUNCIONÁRIO%'
   								   			AND SBOLSA.NOME NOT LIKE '%DEPENDENTE%'
   								   			AND SBOLSA.VALIDADELIMITADA = 1
   								   	  ) 
  		),0) INCONDICIONAL,

  ISNULL((SELECT
    	   SUM(SBOLSALAN.VALOR)
    
   		  FROM
    	   SBOLSALAN (NOLOCK)
    
   		  WHERE	SBOLSALAN.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   			AND SBOLSALAN.IDLAN = FLAN.IDLAN
   			AND SBOLSALAN.CODBOLSA IN (SELECT
   									 	SBOLSA.CODBOLSA
   									
   								   	   FROM
   								    	SBOLSA (NOLOCK)
   								    
   								   	   WHERE	SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
   								   			AND SBOLSA.NOME NOT LIKE '%CEBAS%'
   								   			AND SBOLSA.NOME NOT LIKE '%PROUNI%'
   								   			AND SBOLSA.NOME NOT LIKE '%FIES%'
   								   			AND SBOLSA.NOME NOT LIKE '%FUNCIONÁRIO%'
   								   			AND SBOLSA.NOME NOT LIKE '%DEPENDENTE%'
   								   			AND SBOLSA.VALIDADELIMITADA = 0
   								   	  ) 
  		),0) CONDICIONAL
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
  											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
  											   SMATRICPL.RA = SCONTRATO.RA
  											   
  INNER JOIN SSTATUS (NOLOCK)				ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  											   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS  											   
  											   
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

  INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SPARCELA.RA = SCONTRATO.RA AND 
  											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET

  INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
  											   SLAN.IDPARCELA = SPARCELA.IDPARCELA
  											   
  INNER JOIN FLAN (NOLOCK)					ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  											   FLAN.IDLAN = SLAN.IDLAN

 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SCONTRATO.CODFILIAL LIKE :Filial_S
	AND SCONTRATO.CODTIPOCURSO LIKE :Nível_Ensino_S
	AND CAST(MONTH(FLAN.MESDECOMPETENCIA) AS VARCHAR(2)) + '/' + CAST(YEAR(FLAN.MESDECOMPETENCIA) AS VARCHAR(4)) = :Competência
	

) X
/*WHERE (X.CEBAS + X.PROUNI + X.FIES + X.FUNCIONÁRIO + X.DEPENDENTE + X.INCONDICIONAL + X.CONDICIONAL) > 0*/
";8209;;;;21/06/2022;robson.canto;0;1;1;1;;;;0;ece19f18-629f-42b9-95d8-26e59f2722b6;0;;-15111;robson.canto;21/06/2022;robson.canto;21/06/2022;0
G;Cubo.027;Lançamentos Financeiros sem Natureza Orçamentária;"SELECT 
 FLAN.CODCOLIGADA COLIGADA,
 FLAN.CODFILIAL FILIAL,
 CONVERT(VARCHAR(10), FLAN.DATAEMISSAO, 103) EMISSÃO,
 CONVERT(VARCHAR(10), FLAN.DATAVENCIMENTO, 103) VENCIMENTO,
 FLAN.CODTDO 'TIPO DOC.',
 FLAN.IDLAN,
 FLAN.NUMERODOCUMENTO DOCUMENTO,
 FLAN.VALORORIGINAL ORIGINAL,
 FLANRATCCU.CODNATFINANCEIRA 'COD NATUREZA',
 TTBORCAMENTO.DESCRICAO 'NATUREZA ORÇAMENTÁRIA',
 FLANRATCCU.CODCCUSTO ,
 GCCUSTO.NOME 'CENTRO CUSTO',
 SSERVICO.CODSERVICO 'COD SERVIÇO',
 SSERVICO.NOME SERVIÇO,
 SSERVICO.CODNATFINANCEIRA 'NATUREZA DO SERVIÇO'
 
FROM
 FLAN (NOLOCK)
 
 LEFT JOIN FLANRATCCU (NOLOCK)		ON FLANRATCCU.CODCOLIGADA = FLAN.CODCOLIGADA AND
 								   	   FLANRATCCU.IDLAN = FLAN.IDLAN
 								   
 LEFT JOIN TTBORCAMENTO (NOLOCK)	ON TTBORCAMENTO.CODCOLIGADA = FLANRATCCU.CODCOLNATFINANCEIRA AND 
 									   TTBORCAMENTO.CODTBORCAMENTO = FLANRATCCU.CODNATFINANCEIRA 								   
 									   
 LEFT JOIN GCCUSTO (NOLOCK)			ON GCCUSTO.CODCOLIGADA = FLANRATCCU.CODCOLIGADA AND 
 									   GCCUSTO.CODCCUSTO = FLANRATCCU.CODCCUSTO 									   

 INNER JOIN SLAN (NOLOCK)			ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   SLAN.IDLAN = FLAN.IDLAN
 									   
 INNER JOIN SPARCELA (NOLOCK)		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 									   SPARCELA.IDPARCELA = SLAN.IDPARCELA  									   
 									   
 INNER JOIN SSERVICO (NOLOCK)		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO 									   

WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.PAGREC = 1
	AND FLAN.STATUSLAN = 0
	AND (	FLANRATCCU.CODNATFINANCEIRA IS NULL
		 OR FLANRATCCU.CODCCUSTO IS NULL)";1666;;;;28/06/2022;robson.canto;0;1;1;1;;;;0;96eb4a2b-b2fd-4e05-bc60-10e3ef1a7ab8;0;;-12222;robson.canto;28/06/2022;robson.canto;28/06/2022;0
G;Cubo.028;Relatório Sintético de Acordos Realizados no Período;"SELECT
 FACORDO.IDACORDO ACORDO,
 FCFO.CODCFO,
 FCFO.NOME RESPONSÁVEL,
 FACORDO.DATA,
 FACORDO.STATUSEFETIVADO STATUS,
 SUM(FLAN.VALORORIGINAL + FLAN.VALORACRESCIMOACORDO - FLAN.VALORDESCONTOACORDO) ACORDO,
 FLAN.VALORBAIXADO RECEBIDO,
 FACORDO.VALORACRESCIMO,
 FACORDO.VALORDESCONTO,
 SUM(FLAN.VALORORIGINAL + FLAN.VALORACRESCIMOACORDO - FLAN.VALORDESCONTOACORDO) - FLAN.VALORBAIXADO 'A RECEBER'
 
FROM
 FACORDO (NOLOCK)
 
 INNER JOIN FCFO (NOLOCK)		ON FCFO.CODCOLIGADA = FACORDO.CODCOLIGADA AND
 								   FCFO.CODCFO = FACORDO.CODCFO
 
 INNER JOIN FACORDOREL (NOLOCK)	ON FACORDOREL.CODCOLIGADA = FACORDO.CODCOLIGADA AND
 								   FACORDOREL.IDACORDO = FACORDO.IDACORDO AND 
 								   FACORDOREL.CLASSIFICACAO = 2
					
 INNER JOIN FLAN (NOLOCK)		ON FLAN.CODCOLIGADA = FACORDOREL.CODCOLIGADA AND
 								   FLAN.IDLAN = FACORDOREL.IDLAN							   

WHERE	FACORDO.CODCOLIGADA = 1
	AND FACORDO.DATA >= :Data_Início
	AND FACORDO.DATA <= :Data_Fim

GROUP BY FACORDO.IDACORDO, FCFO.CODCFO, FCFO.NOME, FACORDO.DATA, FACORDO.VALORDESCONTO, FACORDO.VALORACRESCIMO,
 		 FACORDO.STATUSEFETIVADO, FLAN.VALORBAIXADO
 ";1143;;;;28/06/2022;robson.canto;0;1;1;1;;;;0;11acb554-63a2-4057-bc70-f356ab03ad86;0;;3823;robson.canto;28/06/2022;robson.canto;28/06/2022;0
G;Cubo.029;Voucher de Desconto;"SELECT 
 SPSINSCRICAOAREAOFERTADA.CODCOLIGADA COLIGADA,
 SCONTRATO.CODCONTRATO CONTRATO,
 SCONTRATO.IDPERLET,
 ZMDCPDESCONTO.ID,
 
 SMATRICPL.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NÍVEL,
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ, 
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 CONVERT(VARCHAR(10), SCONTRATO.DTASSINATURA, 103) ASSINATURA,
 CONVERT(VARCHAR(10), SCONTRATO.DTCANCELAMENTO, 103) CANCELAMENTO,
 SPSINSCAREAOFERTACOMPL.VOUCHER,
 SSERVICO.NOME SERVIÇO,
 SBOLSA.NOME BOLSA,
 
 CASE WHEN SBOLSAALUNO.IDPERLET = ZMDBOLSACUPOM.IDPERLET AND
		   SBOLSAALUNO.CODSERVICO = ZMDBOLSACUPOM.CODSERVICO AND
		   SBOLSAALUNO.CODBOLSA = ZMDBOLSACUPOM.CODBOLSA THEN 'SIM'
	  ELSE 'NÃO' END 'DESCONTO CONCEDIDO',
 ZMDBOLSACUPOM.VALOR 'VALOR/PERCENTUAL'
 
FROM
 SPSINSCRICAOAREAOFERTADA (NOLOCK)

 INNER JOIN SALUNO (NOLOCK)					ON SALUNO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
 											   SALUNO.RA = SPSINSCRICAOAREAOFERTADA.RAMAT

 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA 
 
 INNER JOIN SPSINSCAREAOFERTACOMPL (NOLOCK)	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND
 											   SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND
 											   SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
  	 							   
 INNER JOIN ZMDCPDESCONTO (NOLOCK)			ON ZMDCPDESCONTO.CODCUPOM = SPSINSCAREAOFERTACOMPL.VOUCHER 											   
 
 INNER JOIN ZMDBOLSACUPOM (NOLOCK)			ON ZMDBOLSACUPOM.CODCOLIGADA = ZMDCPDESCONTO.CODCOLIGADA AND
 											   ZMDBOLSACUPOM.IDCUPOM = ZMDCPDESCONTO.ID 
 							   
 INNER JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = ZMDBOLSACUPOM.CODCOLIGADA AND 
 											   SSERVICO.CODSERVICO = ZMDBOLSACUPOM.CODSERVICO
 											   
 INNER JOIN SBOLSA (NOLOCK)					ON SBOLSA.CODCOLIGADA = ZMDBOLSACUPOM.CODCOLIGADA AND 
 											   SBOLSA.CODBOLSA = ZMDBOLSACUPOM.CODBOLSA

 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADAMAT AND 
 											   SMATRICPL.IDPERLET = SPSINSCRICAOAREAOFERTADA.IDPERLET AND 
 											   SMATRICPL.IDHABILITACAOFILIAL = SPSINSCRICAOAREAOFERTADA.IDHABFILIALMAT AND 
 											   SMATRICPL.RA = SPSINSCRICAOAREAOFERTADA.RAMAT
	 										   
 INNER JOIN SCONTRATO (NOLOCK)				ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 											   SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
 											   SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 											   SCONTRATO.RA = SMATRICPL.RA 											   
 											   
 INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 											   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
 											   
 INNER JOIN SCURSO (NOLOCK)					ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											    											   
 INNER JOIN SGRADE (NOLOCK)					ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   	   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   	   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   	   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
 
 LEFT JOIN SBOLSAALUNO (NOLOCK)				ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 											   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET

WHERE	SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = 1
	AND SPSINSCRICAOAREAOFERTADA.RAMAT IS NOT NULL
	AND SPSINSCAREAOFERTACOMPL.VOUCHER IS NOT NULL
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'";3956;;;;05/07/2022;robson.canto;0;1;1;1;;;;0;23bd3be6-6a9d-4996-8fac-0f0c860979da;0;;-6143;robson.canto;05/07/2022;robson.canto;05/07/2022;0
G;Cubo.030;Frequência por Turma;"SELECT 
 STURMADISC.CODFILIAL FILIAL,
 STURMADISC.CODTIPOCURSO NÍVEL,
 SPLETIVO.CODPERLET 'CÓD PERÍODO',
 SPLETIVO.DESCRICAO 'PERÍODO LETIVO',
 STURMA.CODTURMA 'CÓD TURMA',
 STURMA.NOME TURMA,
 STURMADISC.IDTURMADISC,
 SDISCIPLINA.NOME DISCIPLINA,
 SMATRICULA.RA,
 PPESSOA.NOME ALUNO,
 SSTATUS.DESCRICAO STATUS,
 CONVERT(VARCHAR(10), SPLANOAULA.DATA, 103) + ' ' + SHORARIO.HORAINICIAL + ' - ' + SHORARIO.HORAFINAL AULA
 
FROM
 SPLANOAULA (NOLOCK)
 
 INNER JOIN SHORARIO (NOLOCK)		ON SHORARIO.CODCOLIGADA = SPLANOAULA.CODCOLIGADA AND 
 									   SHORARIO.CODHOR = SPLANOAULA.CODHOR
 
 INNER JOIN STURMADISC (NOLOCK)		ON STURMADISC.CODCOLIGADA = SPLANOAULA.CODCOLIGADA AND 
 									   STURMADISC.IDTURMADISC = SPLANOAULA.IDTURMADISC
 
 INNER JOIN SDISCIPLINA (NOLOCK)	ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 									   SDISCIPLINA.CODDISC = STURMADISC.CODDISC
 									   
 INNER JOIN SPLETIVO (NOLOCK)		ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
 									   SPLETIVO.IDPERLET = STURMADISC.IDPERLET
 									   
 INNER JOIN STURMA (NOLOCK)			ON STURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 									   STURMA.CODFILIAL = STURMADISC.CODFILIAL AND 
 									   STURMA.CODTURMA = STURMADISC.CODTURMA AND 
 									   STURMA.IDPERLET = STURMADISC.IDPERLET

 INNER JOIN SMATRICULA (NOLOCK)		ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 									   SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC

 INNER JOIN SSTATUS (NOLOCK)		ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 									   SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
 									   
 INNER JOIN SALUNO (NOLOCK)			ON SALUNO.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 									   SALUNO.RA = SMATRICULA.RA
 									   
 INNER JOIN PPESSOA (NOLOCK)		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 
WHERE	SPLANOAULA.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SDISCIPLINA.NOME LIKE '%' + :Disciplina + '%'
	AND MONTH(SPLANOAULA.DATA) = :Mês
	AND YEAR(SPLANOAULA.DATA) = :Ano
	
	";2058;;;;12/07/2022;robson.canto;0;1;1;1;;;;0;43363899-55e8-461e-b619-77f9631414e5;0;;16392;robson.canto;12/07/2022;robson.canto;12/07/2022;0
G;Cubo.031;Alunos Matriculados com Lançamentos em Aberto;"SELECT 
 *
 
FROM
(
 SELECT DISTINCT
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SCONTRATO.IDPERLET,
  SCONTRATO.STATUS,
  SSTATUS.DESCRICAO 'STATUS MATRICULA',
  SCONTRATO.CODCONTRATO 'CONTRATO ATUAL',
  SMATRICPL.DTMATRICULA MATRÍCULA,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  /*SSERVICO.NOME SERVIÇO,*/
  SP.CODCONTRATO 'CONTRATO_ANTERIOR',
  SP.IDPERLET IDP,
  SPL.DESCRICAO 'PERÍODO ANT.',
  FL.CODFILIAL 'FILIAL ANT.',
  FL.IDLAN,
  FL.CODTDO 'TIPO DOC.',
  FL.NUMERODOCUMENTO 'DOCUMENTO ANT.',
  CONVERT(VARCHAR(10), FL.DATAVENCIMENTO, 103) 'VENCTO ANT.',
  FL.VALORORIGINAL 'VALOR ANT.',

  CASE WHEN FLANINTEGRACAODEF.ACAO = 1 THEN (SUM(ISNULL(FLANINTEGRACAO.VALOR,0)))
  	   ELSE 0 END ACRÉSCIMO,
  
  CASE WHEN FLANINTEGRACAODEF.ACAO = 2 THEN (SUM(ISNULL(FLANINTEGRACAO.VALOR,0))) * -1
  	   ELSE 0 END DESCONTO,

  FL.VALORBAIXADO * -1 BAIXA_PARCIAL,
  
  CASE WHEN FLANINTEGRACAODEF.ACAO = 1 THEN FL.VALORORIGINAL + (SUM(FLANINTEGRACAO.VALOR)) - FL.VALORBAIXADO
  	   WHEN FLANINTEGRACAODEF.ACAO = 2 THEN FL.VALORORIGINAL - (SUM(FLANINTEGRACAO.VALOR)) - FL.VALORBAIXADO
  	   ELSE FL.VALORORIGINAL - FL.VALORBAIXADO END LIQUIDO,

  /*SPARCELA.PARCELA,*/
  1 QDE
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET

  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE


  INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SPARCELA.RA = SCONTRATO.RA AND 
  											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET

  											   
  INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
  											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
  											   SMATRICPL.RA = SCONTRATO.RA
  
  INNER JOIN SSTATUS (NOLOCK)				ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  											   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

  INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
  											   SLAN.IDPARCELA = SPARCELA.IDPARCELA 
  											   
  INNER JOIN FLAN (NOLOCK)					ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  											   FLAN.IDLAN = SLAN.IDLAN

  INNER JOIN FLAN FL (NOLOCK)				ON FL.CODCOLIGADA = FLAN.CODCOLIGADA AND
  											   FL.CODCFO = FLAN.CODCFO  AND
  											   FL.STATUSLAN IN (0, 4) AND
  											   FL.DATAVENCIMENTO < :Data_Matrícula AND
  											   FL.CODTDO = FLAN.CODTDO

  INNER JOIN SLAN SL (NOLOCK)				ON SL.CODCOLIGADA = FL.CODCOLIGADA AND
  											   SL.IDLAN = FL.IDLAN
  											   
  INNER JOIN SPARCELA SP (NOLOCK)			ON SP.CODCOLIGADA = FL.CODCOLIGADA AND
  											   SP.IDPARCELA = SL.IDPARCELA AND
  											   SP.IDPERLET <> SCONTRATO.IDPERLET AND
  											   SP.RA = SCONTRATO.RA
  
  INNER JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = SP.CODCOLIGADA AND 
  											   SSERVICO.CODSERVICO = SP.CODSERVICO  											   

  INNER JOIN SPLETIVO SPL (NOLOCK)			ON SPL.CODCOLIGADA = SP.CODCOLIGADA AND
  											   SPL.IDPERLET = SP.IDPERLET
  											   
  LEFT JOIN FLANINTEGRACAO (NOLOCK)			ON FLANINTEGRACAO.CODCOLIGADA = FL.CODCOLIGADA AND
  											   FLANINTEGRACAO.IDLAN = FL.IDLAN AND
  											   FLANINTEGRACAO.VALOR > 0
  											   
  LEFT JOIN FLANINTEGRACAODEF (NOLOCK)		ON FLANINTEGRACAODEF.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA AND 
  											   FLANINTEGRACAODEF.IDCAMPO = FLANINTEGRACAO.IDCAMPO AND
  											   FLANINTEGRACAODEF.ATEVENCIMENTO = 0

 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SMATRICPL.DTMATRICULA >= :Data_Matrícula

GROUP BY SCONTRATO.CODCOLIGADA, SCONTRATO.CODFILIAL, SCONTRATO.CODTIPOCURSO, SCONTRATO.RA, PPESSOA.NOME,
  		 SCONTRATO.IDPERLET, SCONTRATO.STATUS, SSTATUS.DESCRICAO, SCONTRATO.CODCONTRATO, SMATRICPL.DTMATRICULA,
  		 Fl.datavencimento, SCURSO.NOME, SGRADE.DESCRICAO, SP.CODCONTRATO, SP.IDPERLET, SPL.DESCRICAO,
  		 FL.CODFILIAL, FL.IDLAN, FL.NUMERODOCUMENTO, FL.VALORORIGINAL, FLANINTEGRACAODEF.ACAO, FL.CODTDO,
  		 FLAN.IDLAN, FL.VALORBAIXADO

) X
";5347;;;;08/09/2022;robson.canto;0;1;1;1;;;;0;5885e2c5-d584-4305-a6be-25187e2bf373;0;;30727;robson.canto;01/09/2022;robson.canto;08/09/2022;0
G;Cubo.032;Alunos Devedores X Contrato Atual;"SELECT 
 *
 
FROM
(
 SELECT DISTINCT
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.IDHABILITACAOFILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SCONTRATO.IDPERLET,
  SCONTRATO.STATUS,
  SSTATUS.DESCRICAO 'STATUS MATRICULA',
  SCONTRATO.CODCONTRATO CONTRATO,
  SPLETIVO.CODPERLET,
  CONVERT(VARCHAR(10), SMATRICPL.DTMATRICULA, 103) MATRÍCULA,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  /*SSERVICO.NOME SERVIÇO,*/
  FLAN.IDLAN,
  FLAN.CODTDO 'TIPO DOC.',
  FLAN.NUMERODOCUMENTO DOCUMENTO,
  CONVERT(VARCHAR(10), FLAN.DATAVENCIMENTO, 103) VENCIMENTO,
  FLAN.VALORORIGINAL 'VALOR PRINCIPAL',

  CASE WHEN FLANINTEGRACAODEF.ACAO = 1 THEN (SUM(ISNULL(FLANINTEGRACAO.VALOR,0)))
  	   ELSE 0 END ACRÉSCIMO,
  
  CASE WHEN FLANINTEGRACAODEF.ACAO = 2 THEN (SUM(ISNULL(FLANINTEGRACAO.VALOR,0))) * -1
  	   ELSE 0 END DESCONTO,

  FLAN.VALORBAIXADO * -1 BAIXA_PARCIAL,
  FLAN.VALOROP7 CUSTAS,
  
  
  CASE WHEN FLANINTEGRACAODEF.ACAO = 1 THEN FLAN.VALORORIGINAL + (SUM(FLANINTEGRACAO.VALOR)) - FLAN.VALORBAIXADO + FLAN.VALOROP7
  	   WHEN FLANINTEGRACAODEF.ACAO = 2 THEN FLAN.VALORORIGINAL - (SUM(FLANINTEGRACAO.VALOR)) - FLAN.VALORBAIXADO + FLAN.VALOROP7
  	   ELSE FLAN.VALORORIGINAL - FLAN.VALORBAIXADO + FLAN.VALOROP7 END LIQUIDO,

  (SELECT TOP 1
 	SC.CODFILIAL
 							  
   FROM
    SCONTRATO SC (NOLOCK)
 							  
    INNER JOIN SPLETIVO SP (NOLOCK)	ON SP.CODCOLIGADA = SC.CODCOLIGADA  AND
   									   SP.IDPERLET = SC.IDPERLET
 							  									   
   WHERE SC.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   	 AND SC.RA = SCONTRATO.RA
 	 AND SP.CODPERLET LIKE :Período_Desconsiderado + '%'
 							 	
   ORDER BY SC.IDPERLET DESC) [FILIAL ATUAL],

  (SELECT TOP 1
 	SCU.NOME
 							  
   FROM
    SCONTRATO SC (NOLOCK)
 							  
    INNER JOIN SPLETIVO SP (NOLOCK)	 ON SP.CODCOLIGADA = SC.CODCOLIGADA  AND
   									    SP.IDPERLET = SC.IDPERLET
 							  									   
    INNER JOIN SHABILITACAOFILIAL SH ON SH.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
    								    SH.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
    								    
    INNER JOIN SCURSO SCU			 ON SCU.CODCOLIGADA = SH.CODCOLIGADA AND
    									SCU.CODCURSO = SH.CODCURSO
    									
   WHERE SC.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   	 AND SC.RA = SCONTRATO.RA
 	 AND SP.CODPERLET LIKE :Período_Desconsiderado + '%'
 							 	
   ORDER BY SC.IDPERLET DESC) [CURSO ATUAL],

  (SELECT TOP 1
 	SC.CODCONTRATO
 							  
   FROM
    SCONTRATO SC (NOLOCK)
 							  
    INNER JOIN SPLETIVO SP (NOLOCK)	ON SP.CODCOLIGADA = SC.CODCOLIGADA  AND
   									   SP.IDPERLET = SC.IDPERLET
 							  									   
   WHERE SC.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   	 AND SC.RA = SCONTRATO.RA
 	 AND SP.CODPERLET LIKE :Período_Desconsiderado + '%'
 							 	
   ORDER BY SC.IDPERLET DESC) [CONTRATO ATUAL],

  (SELECT TOP 1
 	SS.DESCRICAO
 							  
   FROM
    SCONTRATO SC (NOLOCK)
 							  
    INNER JOIN SPLETIVO SP (NOLOCK)	ON SP.CODCOLIGADA = SC.CODCOLIGADA  AND
   									   SP.IDPERLET = SC.IDPERLET
 							  									   
    INNER JOIN SMATRICPL SM (NOLOCK)ON SM.CODCOLIGADA = SC.CODCOLIGADA AND
    								   SM.IDPERLET = SC.IDPERLET AND
    								   SM.IDHABILITACAOFILIAL = SC.IDHABILITACAOFILIAL AND
    								   SM.RA = SC.RA
    								   
    INNER JOIN SSTATUS SS (NOLOCK)	ON SS.CODCOLIGADA = SM.CODCOLIGADA AND
    								   SS.CODSTATUS = SM.CODSTATUS
    								   
    
   WHERE SC.CODCOLIGADA = SCONTRATO.CODCOLIGADA
   	 AND SC.RA = SCONTRATO.RA
 	 AND SP.CODPERLET LIKE :Período_Desconsiderado + '%'
 							 	
   ORDER BY SC.IDPERLET DESC) [STATUS ATUAL],
  
  1 QDE
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET

  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE


  INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SPARCELA.RA = SCONTRATO.RA AND 
  											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET

  											   
  INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
  											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
  											   SMATRICPL.RA = SCONTRATO.RA
  
  INNER JOIN SSTATUS (NOLOCK)				ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  											   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

  INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
  											   SLAN.IDPARCELA = SPARCELA.IDPARCELA 
  											   
  INNER JOIN FLAN (NOLOCK)					ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  											   FLAN.IDLAN = SLAN.IDLAN

  											   
  LEFT JOIN FLANINTEGRACAO (NOLOCK)			ON FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA AND
  											   FLANINTEGRACAO.IDLAN = FLAN.IDLAN AND
  											   FLANINTEGRACAO.VALOR > 0
  											   
  LEFT JOIN FLANINTEGRACAODEF (NOLOCK)		ON FLANINTEGRACAODEF.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA AND 
  											   FLANINTEGRACAODEF.IDCAMPO = FLANINTEGRACAO.IDCAMPO AND
  											   FLANINTEGRACAODEF.ATEVENCIMENTO = 0

 WHERE	FLAN.CODCOLIGADA = :Coligada
 	AND FLAN.PAGREC = 1
 	AND FLAN.STATUSLAN IN (0, 4)
 	AND FLAN.DATAVENCIMENTO >= :Vencto_Início
 	AND FLAN.DATAVENCIMENTO <= :Vencto_Fim
	AND SPLETIVO.CODPERLET NOT LIKE (:Período_Desconsiderado) + '%'

GROUP BY SCONTRATO.CODCOLIGADA, SCONTRATO.CODFILIAL, SCONTRATO.CODTIPOCURSO, SCONTRATO.RA, PPESSOA.NOME,
  		 SCONTRATO.IDPERLET, SCONTRATO.STATUS, SSTATUS.DESCRICAO, SCONTRATO.CODCONTRATO, SMATRICPL.DTMATRICULA,
  		 SCURSO.NOME, SGRADE.DESCRICAO, FLAN.IDLAN, FLAN.NUMERODOCUMENTO, FLAN.VALORORIGINAL, FLANINTEGRACAODEF.ACAO, 
  		 FLAN.CODTDO, FLAN.IDLAN, FLAN.VALORBAIXADO, FLAN.DATAVENCIMENTO, SPLETIVO.CODPERLET, SCONTRATO.IDHABILITACAOFILIAL,
  		 FLAN.VALOROP7

) X
";7025;;;;28/09/2022;robson.canto;0;1;1;1;;;;0;18056644-a8d5-43bd-a8d8-ce53dbd3da42;0;;21881;robson.canto;28/09/2022;robson.canto;28/09/2022;0
G;Cubo.033;Resumo de Bolsas com Lançamentos em Aberto;"SELECT 
 *
FROM
(
 SELECT DISTINCT
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SCONTRATO.IDPERLET,
  SCONTRATO.STATUS,
  SSTATUS.DESCRICAO 'STATUS MATRICULA',
  SCONTRATO.CODCONTRATO CONTRATO,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  SBOLSAALUNO.CODBOLSA,
  SBOLSA.NOME BOLSA,
  SBOLSAALUNO.PARCELAINICIAL 'PARC. INIC',
  SBOLSAALUNO.PARCELAFINAL 'PARC. FIM',
  CONVERT(VARCHAR(10), SBOLSAALUNO.DTINICIO, 103) 'DT INÍCIO',
  CONVERT(VARCHAR(10), SBOLSAALUNO.DTFIM, 103) 'DT FIM', 
  SBOLSAALUNO.DESCONTO,
  SBOLSAALUNO.TIPODESC 'TIPO DESCONTO',
  SSERVICO.NOME SERVIÇO,
  FLAN.IDLAN,
  FLAN.NUMERODOCUMENTO DOCUMENTO,
  CONVERT(VARCHAR(10), FLAN.DATAVENCIMENTO, 103) VENCIMENTO,
  /*SPARCELA.PARCELA,*/
  1 QDE
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

  LEFT JOIN SBOLSAALUNO (NOLOCK)			ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 											   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 											   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
  LEFT JOIN SBOLSA (NOLOCK)					ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  											   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA											   
  											   
  LEFT JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  											   SSERVICO.CODSERVICO = SBOLSAALUNO.CODSERVICO  											   

  											   
  INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
  											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
  											   SMATRICPL.RA = SCONTRATO.RA
  
  INNER JOIN SSTATUS (NOLOCK)				ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  											   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS


  INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SPARCELA.RA = SCONTRATO.RA AND 
  											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET

  INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
  											   SLAN.IDPARCELA = SPARCELA.IDPARCELA
  											   
  INNER JOIN FLAN (NOLOCK)					ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  											   FLAN.IDLAN = SLAN.IDLAN
  											     											   
 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND FLAN.STATUSLAN IN (0, 4)
	AND FLAN.DATAVENCIMENTO < :Vencimento_Fim
	
) X
WHERE X.CODBOLSA IS NOT NULL";3805;;;;28/09/2022;robson.canto;0;1;1;1;;;;0;ae58006a-5470-4192-9136-e2d880ea2dc9;0;;-7594;robson.canto;28/09/2022;robson.canto;28/09/2022;0
G;Cubo.034;Matrículas por Período Letivo e Data de Matrícula;" SELECT DISTINCT
  SCONTRATO.CODCOLIGADA COLIGADA,
  SCONTRATO.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  SCONTRATO.IDHABILITACAOFILIAL,
  SCONTRATO.RA,
  PPESSOA.NOME ALUNO,
  SCONTRATO.IDPERLET,
  CONVERT(VARCHAR(10), SMATRICPL.DTMATRICULA, 103) MATRÍCULA,
  CONVERT(VARCHAR(10), SCONTRATO.DTCONTRATO, 103) 'DT CONTRATO',
  CONVERT(VARCHAR(10), SCONTRATO.DTASSINATURA, 103) ASSINATURA,
  CONVERT(VARCHAR(10), SCONTRATO.DTCANCELAMENTO, 103) CANCELAMENTO,
  SCONTRATO.STATUS,
  SSTATUS.DESCRICAO 'STATUS MATRICULA',
  SCONTRATO.CODCONTRATO CONTRATO,
  SCURSO.NOME CURSO,
  SGRADE.DESCRICAO MATRIZ,
  /*SSERVICO.NOME SERVIÇO,*/
  1 QDE
 
 FROM
  SCONTRATO (NOLOCK)
  
  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
  											   SALUNO.RA = SCONTRATO.RA
  											   
  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
/*
  LEFT JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SPARCELA.RA = SCONTRATO.RA AND 
  											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET
  											   
  LEFT JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
  											   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO  											   
*/
  											   
  INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
  											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
  											   SMATRICPL.RA = SCONTRATO.RA
  
  INNER JOIN SSTATUS (NOLOCK)				ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  											   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

 WHERE	SCONTRATO.CODCOLIGADA = :Coligada
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SMATRICPL.DTMATRICULA <= :Data_Fim
";2819;;;;11/10/2022;robson.canto;0;1;1;1;;;;0;2ebf46c3-058a-473f-9199-f858644e7dcb;0;;-20976;robson.canto;11/10/2022;robson.canto;11/10/2022;0
G;CUBO.035;Serasa Limpa Nome - Inclusão;"SELECT
 X.COLIGADA,
 X.IDLAN,
 X.NUMERO_CONTRATO,
 X.CNPJ_CREDOR,
 X.TIPO_DOCUMENTO,
 X.DOCUMENTO,
 CONVERT(VARCHAR(10), X.DATA_VENCIMENTO, 103) DATA_VENCIMENTO,
 X.TIPO_DIVIDA,
 X.VALOR_DIVIDA,
 
 X.VALOR_DIVIDA + 
 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO <> 'SELETIVO' AND
 		   X.CODTDO <> 'TAX_APRO' AND
 		   X.CODTDO <> 'TAX_EXT' THEN ((X.VALOR_DIVIDA * 0.01) / 30) * DATEDIFF(DAY, X.DATA_VENCIMENTO, GETDATE()) 
 	  ELSE 0 END +
 	  
 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO <> 'SELETIVO' AND
 		   X.CODTDO <> 'TAX_APRO' AND
 		   X.CODTDO <> 'TAX_EXT' THEN (X.VALOR_DIVIDA * 0.02) 
 	  ELSE 0 END VALOR_ATUALIZADO,
 	  
 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO <> 'SELETIVO' AND
 		   X.CODTDO <> 'TAX_APRO' AND
 		   X.CODTDO <> 'TAX_EXT' THEN ((X.VALOR_DIVIDA * 0.01) / 30) * DATEDIFF(DAY, X.DATA_VENCIMENTO, GETDATE()) 
 	  ELSE 0 END +
 	  
 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO <> 'SELETIVO' AND
 		   X.CODTDO <> 'TAX_APRO' AND
 		   X.CODTDO <> 'TAX_EXT' THEN (X.VALOR_DIVIDA * 0.02) 
 	  ELSE 0 END VALOR_JUROS,
 	  
 X.HISTORICO,
 X.NOME 'RESPONSÁVEL FINANCEIRO',
 X.CGCCFO 'CNPJ RESP',
 X.SERASALN 'ENVIADO SERASA LIMPA NOME',
 X.DTINCSERAASALN 'ENVIO SERASA LIMPA NOME'
 	  
FROM
(SELECT
  FLAN.CODCOLIGADA COLIGADA,
  FLAN.IDLAN IDLAN,
  SPARCELA.CODCONTRATO NUMERO_CONTRATO,
  GFILIAL.CGC CNPJ_CREDOR,
  FLAN.CODTDO TIPO_DOCUMENTO,
  FLAN.IDLAN DOCUMENTO,
  FLAN.DATAVENCIMENTO DATA_VENCIMENTO,
  '' TIPO_DIVIDA,
  FLAN.VALORORIGINAL - (SUM(FLANINTEGRACAO.VALOR) +
 					    FLAN.VALORDESCONTO +
 					    FLAN.VALOROP3 +
 					    FLAN.VALOROP6)
 					 + (FLAN.VALOROP5 +
 					    FLAN.VALOROP6) VALOR_DIVIDA,
 
  0 VALOR_ATUALIZADO,
  0 VALOR_JUROS,
  FLAN.CODCFO,
  SPARCELA.PARCELA,
  FLAN.CODTDO,
  
  FLAN.HISTORICO,
  FCFO.NOME,
  FCFO.CGCCFO,
  
  CASE WHEN FLANCOMPL.SERASALN = 1 THEN 'SIM'
  	   ELSE 'NÃO' END SERASALN,
  	   
  CONVERT(VARCHAR(10), FLANCOMPL.DTINCSERAASALN, 103) DTINCSERAASALN
 
 FROM
  FLAN (NOLOCK)
 
  INNER JOIN GFILIAL (NOLOCK)			ON GFILIAL.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   GFILIAL.CODFILIAL = FLAN.CODFILIAL
 									   
  INNER JOIN FLANCOMPL (NOLOCK)			ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   FLANCOMPL.IDLAN = FLAN.IDLAN
 									   
  INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
  										   FCFO.CODCFO = FLAN.CODCFO
  										   
  LEFT JOIN FLANINTEGRACAO (NOLOCK)		ON FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   FLANINTEGRACAO.IDLAN = FLAN.IDLAN
 									   
  LEFT JOIN FLANINTEGRACAODEF (NOLOCK)	ON FLANINTEGRACAODEF.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA AND 
 										   FLANINTEGRACAODEF.IDCAMPO = FLANINTEGRACAO.IDCAMPO AND
 										   FLANINTEGRACAODEF.ATEVENCIMENTO = 0
 
  INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 										   SLAN.IDLAN = FLAN.IDLAN
 
  INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 										   SPARCELA.IDPARCELA = SLAN.IDPARCELA
 										   
 WHERE	FLAN.CODCOLIGADA = :Coligada
	AND FLAN.PAGREC = 1
	AND FLANCOMPL.DTINCSERAASALN = :Data_Envio_SerasaLN

 GROUP BY SPARCELA.CODCONTRATO, GFILIAL.CGC, FLAN.CODTDO, FLAN.NUMERODOCUMENTO, FLAN.DATAVENCIMENTO, FLAN.VALORORIGINAL,
		  FLAN.VALORDESCONTO, FLAN.VALOROP3, FLAN.VALOROP6, FLAN.VALOROP5, FLAN.VALOROP6, FLAN.CODCFO, SPARCELA.PARCELA,
 		  FLAN.CODTDO, FCFO.NOME, FCFO.CGCCFO, FLANCOMPL.SERASALN, FLANCOMPL.DTINCSERAASALN, FLAN.HISTORICO, FLAN.CODCOLIGADA,
 		  FLAN.IDLAN

) X";3751;;;;03/11/2022;robson.canto;0;1;1;1;;;;0;6003c7fe-3dbf-4565-8958-b221ac0bcde0;0;;-19451;robson.canto;03/11/2022;robson.canto;03/11/2022;0
G;Cubo.036;Serasa Limpa Nome - EXCLUSÃO;"SELECT
 X.COLIGADA,
 X.IDLAN,
 X.NUMERO_CONTRATO,
 X.CNPJ_CREDOR,
 X.TIPO_DOCUMENTO,
 X.DOCUMENTO,
 CONVERT(VARCHAR(10), X.DATA_VENCIMENTO, 103) DATA_VENCIMENTO,
 X.TIPO_DIVIDA,
 X.VALOR_DIVIDA,
 
 X.VALOR_DIVIDA + 
 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO <> 'SELETIVO' AND
 		   X.CODTDO <> 'TAX_APRO' AND
 		   X.CODTDO <> 'TAX_EXT' THEN ((X.VALOR_DIVIDA * 0.01) / 30) * DATEDIFF(DAY, X.DATA_VENCIMENTO, GETDATE()) 
 	  ELSE 0 END +
 	  
 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO <> 'SELETIVO' AND
 		   X.CODTDO <> 'TAX_APRO' AND
 		   X.CODTDO <> 'TAX_EXT' THEN (X.VALOR_DIVIDA * 0.02) 
 	  ELSE 0 END VALOR_ATUALIZADO,
 	  
 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO <> 'SELETIVO' AND
 		   X.CODTDO <> 'TAX_APRO' AND
 		   X.CODTDO <> 'TAX_EXT' THEN ((X.VALOR_DIVIDA * 0.01) / 30) * DATEDIFF(DAY, X.DATA_VENCIMENTO, GETDATE()) 
 	  ELSE 0 END +
 	  
 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO <> 'SELETIVO' AND
 		   X.CODTDO <> 'TAX_APRO' AND
 		   X.CODTDO <> 'TAX_EXT' THEN (X.VALOR_DIVIDA * 0.02) 
 	  ELSE 0 END VALOR_JUROS,
 	  
 X.HISTORICO,
 X.NOME 'RESPONSÁVEL FINANCEIRO',
 X.CGCCFO 'CNPJ RESP',
 X.SERASALN 'ENVIADO SERASA LIMPA NOME',
 X.DTINCSERAASALN 'ENVIO SERASA LIMPA NOME',
 X.DTBXSERASALN 'BAIXA SERASA LIMPA NOME'
 	  
FROM
(SELECT
  FLAN.CODCOLIGADA COLIGADA,
  FLAN.IDLAN IDLAN,
  SPARCELA.CODCONTRATO NUMERO_CONTRATO,
  GFILIAL.CGC CNPJ_CREDOR,
  FLAN.CODTDO TIPO_DOCUMENTO,
  FLAN.NUMERODOCUMENTO DOCUMENTO,
  FLAN.DATAVENCIMENTO DATA_VENCIMENTO,
  '' TIPO_DIVIDA,
  FLAN.VALORORIGINAL - (SUM(FLANINTEGRACAO.VALOR) +
 					    FLAN.VALORDESCONTO +
 					    FLAN.VALOROP3 +
 					    FLAN.VALOROP6)
 					 + (FLAN.VALOROP5 +
 					    FLAN.VALOROP6) VALOR_DIVIDA,
 
  0 VALOR_ATUALIZADO,
  0 VALOR_JUROS,
  FLAN.CODCFO,
  SPARCELA.PARCELA,
  FLAN.CODTDO,
  
  FLAN.HISTORICO,
  FCFO.NOME,
  FCFO.CGCCFO,
  
  CASE WHEN FLANCOMPL.SERASALN = 1 THEN 'SIM'
  	   ELSE 'NÃO' END SERASALN,
  	   
  CONVERT(VARCHAR(10), FLANCOMPL.DTINCSERAASALN, 103) DTINCSERAASALN,
  CONVERT(VARCHAR(10), FLANCOMPL.DTBXSERASALN, 103) DTBXSERASALN
 
 FROM
  FLAN (NOLOCK)
 
  INNER JOIN GFILIAL (NOLOCK)			ON GFILIAL.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   GFILIAL.CODFILIAL = FLAN.CODFILIAL
 									   
  INNER JOIN FLANCOMPL (NOLOCK)			ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   FLANCOMPL.IDLAN = FLAN.IDLAN
 									   
  INNER JOIN FCFO (NOLOCK)				ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND
  										   FCFO.CODCFO = FLAN.CODCFO
  										   
  LEFT JOIN FLANINTEGRACAO (NOLOCK)		ON FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   	   FLANINTEGRACAO.IDLAN = FLAN.IDLAN
 									   
  LEFT JOIN FLANINTEGRACAODEF (NOLOCK)	ON FLANINTEGRACAODEF.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA AND 
 										   FLANINTEGRACAODEF.IDCAMPO = FLANINTEGRACAO.IDCAMPO AND
 										   FLANINTEGRACAODEF.ATEVENCIMENTO = 0
 
  INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 										   SLAN.IDLAN = FLAN.IDLAN
 
  INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 										   SPARCELA.IDPARCELA = SLAN.IDPARCELA
 										   
 WHERE	FLAN.CODCOLIGADA = :Coligada
	AND FLAN.PAGREC = 1
	AND FLANCOMPL.DTBXSERASALN = :Data_Envio_SerasaLN

 GROUP BY SPARCELA.CODCONTRATO, GFILIAL.CGC, FLAN.CODTDO, FLAN.NUMERODOCUMENTO, FLAN.DATAVENCIMENTO, FLAN.VALORORIGINAL,
		  FLAN.VALORDESCONTO, FLAN.VALOROP3, FLAN.VALOROP6, FLAN.VALOROP5, FLAN.VALOROP6, FLAN.CODCFO, SPARCELA.PARCELA,
 		  FLAN.CODTDO, FCFO.NOME, FCFO.CGCCFO, FLANCOMPL.SERASALN, FLANCOMPL.DTINCSERAASALN, FLAN.HISTORICO, FLAN.CODCOLIGADA,
 		  FLAN.IDLAN, FLANCOMPL.DTBXSERASALN

) X";3894;;;;03/11/2022;robson.canto;0;1;1;1;;;;0;9d5404b9-2c24-4a17-8658-3d19d7758108;0;;-26359;robson.canto;03/11/2022;robson.canto;03/11/2022;0
G;Cubo.037;Bolsa Futura com Matriz Incorreta;"SELECT
 *
FROM
(
SELECT DISTINCT
 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.RA,
 SCONTRATO.IDPERLET,
 SCONTRATO.CODCONTRATO CONTRATO,
 SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
 SGRADE.CODGRADE COD_CONTRATO,
 SGRADE.DESCRICAO 'MATRIZ CONTRATO',
 SG.CODGRADE COD_BOLSA,
 SG.DESCRICAO 'MATRIZ BOLSA'

FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
 
 INNER JOIN SGRADE (NOLOCK)					ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
 											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
 											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

 INNER JOIN SCONCESSAOBOLSAHABALUNO (NOLOCK)ON SCONCESSAOBOLSAHABALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SCONCESSAOBOLSAHABALUNO.RA = SCONTRATO.RA AND
 											   SCONCESSAOBOLSAHABALUNO.CODBOLSA = 3

 INNER JOIN SHABILITACAOFILIAL SH (NOLOCK)	ON SH.CODCOLIGADA = SCONCESSAOBOLSAHABALUNO.CODCOLIGADA AND
 											   SH.IDHABILITACAOFILIAL = SCONCESSAOBOLSAHABALUNO.IDHABILITACAOFILIAL
 											   
 INNER JOIN SGRADE SG (NOLOCK)				ON SG.CODCOLIGADA = SH.CODCOLIGADA AND 
 											   SG.CODCURSO = SH.CODCURSO AND 
 											   SG.CODHABILITACAO = SH.CODHABILITACAO AND 
 											   SG.CODGRADE = SH.CODGRADE
 
 INNER JOIN SPLETIVO (NOLOCK)			 	ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET

WHERE SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo
) X

WHERE 	X.COD_CONTRATO <> X.COD_BOLSA
";1772;;;;09/11/2022;robson.canto;0;1;1;1;;;;0;4691ea06-3a0d-43ef-8538-aaf414ce1129;0;;-9813;robson.canto;09/11/2022;robson.canto;09/11/2022;0
G;D01.002;Painel de Controle RM - Formulas da Base de dados;"
SELECT  GSISTEMA.NOMESISTEMA ,COUNT(*)[TOTAL DE FORMULAS] 
 FROM GFORMULA (NOLOCK)
JOIN
 GSISTEMA (NOLOCK)
ON
 GFORMULA.APLICACAO=GSISTEMA.CODSISTEMA
GROUP BY GSISTEMA.NOMESISTEMA
ORDER BY 2 DESC
";206;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;13074;RM;30/05/2012;RM;30/05/2012;
G;D01.003;Painel de Controle RM - Consultas SQL;"
SELECT NOMESISTEMA,
       COUNT(*)""TOTAL DE CONSULTAS SQL"" ,
       [TOTAL DE CONSULTAS SQL COM NOLOCK],
       [TOTAL DE CONSULTAS SQL SEM NOLOCK]
 FROM GCONSSQL (NOLOCK)
JOIN
 GSISTEMA (NOLOCK)
ON
 GCONSSQL.APLICACAO=GSISTEMA.CODSISTEMA
JOIN
 (
SELECT  GCONSSQL.APLICACAO ,COUNT(*)[TOTAL DE CONSULTAS SQL COM NOLOCK] 
 FROM GCONSSQL (NOLOCK)
JOIN
 GSISTEMA (NOLOCK)
ON
 GCONSSQL.APLICACAO=GSISTEMA.CODSISTEMA
WHERE SENTENCA  LIKE '%NOLOCK%'
GROUP BY GCONSSQL.APLICACAO
)COMNOLOCK
ON
 COMNOLOCK.APLICACAO=GCONSSQL.APLICACAO
JOIN
(
SELECT  GCONSSQL.APLICACAO ,COUNT(*)[TOTAL DE CONSULTAS SQL SEM NOLOCK] 
 FROM GCONSSQL (NOLOCK)
JOIN
 GSISTEMA (NOLOCK)
ON
 GCONSSQL.APLICACAO=GSISTEMA.CODSISTEMA
WHERE SENTENCA NOT LIKE '%NOLOCK%'
GROUP BY GCONSSQL.APLICACAO
) SEMNOLOCK
ON
  SEMNOLOCK.APLICACAO=GCONSSQL.APLICACAO
GROUP BY NOMESISTEMA,   [TOTAL DE CONSULTAS SQL COM NOLOCK],
       [TOTAL DE CONSULTAS SQL SEM NOLOCK]
ORDER BY 2 DESC
";976;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;2431;RM;30/05/2012;RM;30/05/2012;
G;D01.004;Painel de Controle RM - Objetos da Base de Dados;"


select case type
when 'F' THEN 'FOREIGN KEY'
WHEN 'U' THEN 'TABLE USER'
WHEN 'K' THEN 'PRIMARY KEY'
WHEN 'D' THEN 'CONSTRAINT DEFAULT'
WHEN 'P' THEN 'PROCEDURE'
WHEN 'C' THEN 'CONSTRAINT CHECK'
WHEN 'V' THEN 'VIEW'
WHEN 'FN' THEN 'FUNCTION SCALAR'
WHEN 'TF' THEN 'FUNCTION TABLE'
WHEN 'S' THEN 'TABLE SYSTEM'
WHEN 'TR' THEN 'TRIGGER'
WHEN 'R'  THEN 'RULES'
else type
END OBJETO
,count(*) ""TOTAL DE OBJETOS"" from sysobjects
group by type
order by 2 desc
";477;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-28394;RM;30/05/2012;RM;30/05/2012;
G;D01.012;Painel de Controle RM - COMPARATIVO TABELAS COM CHAVE E SEM CHAVE PRIMÁRIA ;"  --COMPARATIVO
  SELECT 
   (select COUNT(*) from sys.tables
  join
   GDIC
   on
    sys.tables.name=GDIC.TABELA
  where 
   object_id not in (select object_id from sys.indexes where is_primary_key=1)
  and GDIC.COLUNA='#') AS TABELAS_SEM_CHAVE
  ,
  (    select COUNT(*) from sys.tables
  join
   GDIC
   on
    sys.tables.name=GDIC.TABELA
  where 
   object_id  in (select object_id from sys.indexes where is_primary_key=1)
  and GDIC.COLUNA='#') AS TABELAS_COM_CHAVE
  ";493;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-25738;RM;30/05/2012;RM;30/05/2012;
G;D01.014;Painel de Controle RM - CONSUMO DE RECURSO DO SERVIDOR POR HOSTNAME;"SELECT TOP 10
   ISNULL(hostname,'NAO IDENTIFICADO') HOSTNAME
  ,SUM(CPU) CPU,SUM(MEMUSAGE) MEMORIA,SUM(PHYSICAL_IO) IO,SUM(OPEN_TRAN) TRANSACOES
FROM
 MASTER.DBO.SYSPROCESSES
GROUP BY 
 HOSTNAME
ORDER BY 1 DESC,2 DESC,3 DESC,4 DESC";239;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-6199;RM;30/05/2012;RM;30/05/2012;
G;D01.015;Painel de Controle RM - PROCESSOS POR DATABASE;"select db_name(dbid),count(*) PROCESSOS
from master.dbo.sysprocesses
group by db_name(dbid)
";95;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-29188;RM;30/05/2012;RM;30/05/2012;
G;D01.016;Painel de Controle RM - CPU POR DATABASE;"select db_name(dbid),sum(cpu) CPU
from master.dbo.sysprocesses
group by db_name(dbid)";87;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;21408;RM;30/05/2012;RM;30/05/2012;
G;D01.017;Painel de Controle RM - INFORMAÇÕES SOBRE DESEMPENHO DO SERVIDOR;SELECT * FROM sys.dm_os_sys_info;32;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;28243;RM;30/05/2012;RM;30/05/2012;
G;D01.019;Painel de Controle RM - OPERADORES DE FILTRO;" select
  gcondicao.OPERADOR,COUNT(*)AS TOTAL  from gcondicao
join
GFILTROS (nolock)
on
 gcondicao.codcoligada=gfiltros.codcoligada and
 gcondicao.idfiltro=gfiltros.id
 group by 
  gcondicao.OPERADOR";207;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;29048;RM;30/05/2012;RM;30/05/2012;
G;D01.020;Painel de Controle RM - INFORMACOES SGDB;SELECT * FROM ZDIARIOBORDO_INFORMACOES_SGBD;43;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;4643;RM;30/05/2012;RM;30/05/2012;
G;D01.021;Painel de Controle RM - REGISTROS POR APLICAÇÃO;"select 
gsistema.nomesistema aplicacao,
sum(row_count)
 from sys.dm_db_partition_stats a
join
 sys.indexes b (nolock)
 on
  a.object_id=b.object_id and
  a.index_id=b.index_id
 join 
  gsistema (nolock)
 on
  substring(object_name(a.object_id),1,1)=gsistema.codsistema
 where
  is_primary_key=1
  group by gsistema.nomesistema
order by 2 desc";358;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30921;RM;30/05/2012;RM;30/05/2012;
G;D01.022;Painel de Controle RM- TOP 10 TABELAS (REGISTROS);"
select top 10 
 object_name(a.object_id),row_count
from
 sys.dm_db_partition_stats a
join
 sys.indexes b (nolock)
 on
  a.object_id=b.object_id and
  a.index_id=b.index_id
 where
  object_name(a.object_id) in (select name from sys.tables where type='u') and
  is_primary_key=1
 order by 2 desc";307;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;10598;RM;30/05/2012;RM;30/05/2012;
G;D01.023;Painel de Controle RM - Memória SQL Utilizada;"select total_physical_memory_kb/1024,(total_physical_memory_kb - available_physical_memory_kb) /1024
 from sys.dm_os_sys_memory";128;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;19595;RM;30/05/2012;RM;30/05/2012;
G;D01.024;Painel de Controle RM- TOP 10 USO AGREGADO DE CPU;"SELECT CONVERT(VARCHAR(10),LEGENDA) LEGENDA,[TEXT],TOTAL_CPU_TIME
 FROM MASTER.DBO.ZDIARIOBORDO_CPUAGRE";104;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;20467;RM;30/05/2012;RM;30/05/2012;
G;D01.025;Painel de Controle RM- 10 principais procedimentos que foram recompilados;"SELECT CONVERT(VARCHAR(10),LEGENDA),
[TEXT],
EXECUTION_COUNT FROM MASTER.DBO.ZDIARIOBORDO_PROC_COMP
";103;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-26952;RM;30/05/2012;RM;30/05/2012;
G;D01.026;Painel de Controle RM - Consulta está usando a CPU de maneira mais cumulativa;"select convert(varchar(10),legenda),[text],total_worker_time 
from MASTER.DBO.zdiariobordo_con_acum";100;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-21676;RM;30/05/2012;RM;30/05/2012;
G;D01.13;Painel de Controle RM - ESTATISTICAS CRIADAS PELO SQL SERVER;"  
SELECT GSISTEMA.NOMESISTEMA APLICACAO,COUNT(*) QUANTIDADE FROM SYSindexes
JOIN
GSISTEMA
ON
  SUBSTRING(OBJECT_NAME(ID),1,1)=GSISTEMA.CODSISTEMA
 WHERE 
(NAME LIKE  '_WA_SYS_%' OR  NAME LIKE '%_HYPMV%' OR NAME LIKE '%HIND%')
AND OBJECT_NAME(ID) NOT LIKE 'SYS%'
GROUP BY
GSISTEMA.NOMESISTEMA
ORDER BY 2 DESC";319;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-9462;RM;30/05/2012;RM;30/05/2012;
G;EDUCUB001;Cubo Censo INEP;"SELECT 	
    GC.NOMEFANTASIA AS COLIGADA,
    GF.NOMEFANTASIA AS FILIAL, 
    SP.CODPERLET AS PLETIVO, 
    SC.CODCURSO, 
    SC.NOME AS CURSO, 
    ST.NOME AS TURNO,
    SM.PERIODO,
    SA.RA,  
    PP.NOME AS ALUNO,
    PP.SEXO,  
    SS.DESCRICAO AS SITUACAO, 
    1 QUANTIDADE,

    CASE 
    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='5' THEN 'Até 05 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'5' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='10' THEN 'De 06 à 10 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'10' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='15' THEN 'De 11 à 15 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'15' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='20' THEN 'De 16 à 20 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'20' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='25' THEN 'De 21 à 25 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'25' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='30' THEN 'De 26 à 30 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'30' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='35' THEN 'De 31 à 35 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'35' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='40' THEN 'De 36 à 40 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'40' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='45' THEN 'De 41 à 45 anos' 

    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'45' AND 
         ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)<='50' THEN 'De 46 à 50 anos'
 
    WHEN ((DATEDIFF(DAY,PP.DTNASCIMENTO,GETDATE()))/365)>'50' THEN 'Mais de 50 anos' 

    END AS IDADE

FROM
    SMATRICPL SM (NOLOCK), 
    SPLETIVO SP (NOLOCK),
    GFILIAL GF (NOLOCK), 
    SCURSO SC (NOLOCK),
    SHABILITACAOFILIAL SH (NOLOCK),
    STURNO ST (NOLOCK),
    SSTATUS SS (NOLOCK), 
    GCOLIGADA GC(NOLOCK), 
    SALUNO SA (NOLOCK), 
    PPESSOA PP (NOLOCK)

WHERE
    GC.CODCOLIGADA = SM.CODCOLIGADA AND
    GC.CODCOLIGADA = SM.CODCOLIGADA AND

    SM.CODCOLIGADA = GF.CODCOLIGADA AND
    SM.CODFILIAL = GF.CODFILIAL AND
    
    SM.CODCOLIGADA = SP.CODCOLIGADA AND
    SM.IDPERLET = SP.IDPERLET AND
    
    SM.CODCOLIGADA = SS.CODCOLIGADA AND
    SM.CODSTATUS = SS.CODSTATUS AND

    SA.CODCOLIGADA = SM.CODCOLIGADA AND
    SA.RA = SM.RA AND
    
    SA.CODPESSOA = PP.CODIGO AND

    SM.CODCOLIGADA = SH.CODCOLIGADA AND
    SM.IDHABILITACAOFILIAL = SH.IDHABILITACAOFILIAL AND 

    SH.CODCOLIGADA = SC.CODCOLIGADA AND    
    SH.CODCURSO = SC.CODCURSO AND
    
    SH.CODCOLIGADA = ST.CODCOLIGADA AND
    SH.CODTURNO = ST.CODTURNO 

ORDER BY   
GC.NOMEFANTASIA,
    GF.NOMEFANTASIA, 
    SP.CODPERLET, 
    SC.CODCURSO, 
    SC.NOME, 
    ST.NOME,
    SM.PERIODO,
    SA.RA,  
    PP.NOME,
    PP.SEXO,  
    SS.DESCRICAO, 
    IDADE";3124;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-9888;RM;30/05/2012;RM;30/05/2012;
G;EDUCUB002;Cubo Quantidade de Alunos;"SELECT A.RA, F.NOME ALUNO, H.CODPERLET PLETIVO, B.CODCURSO, B.NOME CURSO, 
       C.CODHABILITACAO, C.NOME HABILITACAO,G.CODGRADE,
       D.NOME TURNO, S.DESCRICAO SITUACAO, 1 QUANTIDADE

FROM SMATRICPL A (NOLOCK), SCURSO B (NOLOCK), SHABILITACAO C (NOLOCK), 
     STURNO D (NOLOCK), SALUNO E (NOLOCK), PPESSOA F (NOLOCK), 
     SHABILITACAOFILIAL G (NOLOCK), SPLETIVO H (NOLOCK), SSTATUS S (NOLOCK)

WHERE A.CODCOLIGADA = E.CODCOLIGADA AND
      A.RA = E.RA AND
      E.CODPESSOA = F.CODIGO AND
      A.CODCOLIGADA = G.CODCOLIGADA AND
      A.IDHABILITACAOFILIAL = G.IDHABILITACAOFILIAL AND
      G.CODCOLIGADA = B.CODCOLIGADA AND
      G.CODCURSO = B.CODCURSO AND
      G.CODCOLIGADA = C.CODCOLIGADA AND
      G.CODHABILITACAO = C.CODHABILITACAO AND
      G.CODCOLIGADA = D.CODCOLIGADA AND
      G.CODTURNO = D.CODTURNO AND
      A.CODCOLIGADA = H.CODCOLIGADA AND
      A.IDPERLET = H.IDPERLET AND
      A.CODCOLIGADA = S.CODCOLIGADA AND
      A.CODSTATUS = S.CODSTATUS
ORDER BY PLETIVO DESC, CURSO
";1025;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-13839;RM;30/05/2012;RM;30/05/2012;
G;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
G;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
G;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
G;FATUMESPORC.0001;Faturamento mensal por curso;"SELECT 
  SCURSO.NOME,
  'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORORIGINAL END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORORIGINAL END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORORIGINAL END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORORIGINAL END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORORIGINAL END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORORIGINAL END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORORIGINAL END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORORIGINAL END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORORIGINAL END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORORIGINAL END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORORIGINAL END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORORIGINAL END)
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA         = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA         = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA         = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
GROUP BY 
  SCURSO.NOME
ORDER BY
  SCURSO.NOME";2317;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;12090;RM;30/05/2012;RM;30/05/2012;
G;FATUMESPORC.0002;Faturamento mensal por curso;"SELECT 
  SCURSO.NOME,
  'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORORIGINAL END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORORIGINAL END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORORIGINAL END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORORIGINAL END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORORIGINAL END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORORIGINAL END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORORIGINAL END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORORIGINAL END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORORIGINAL END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORORIGINAL END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORORIGINAL END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORORIGINAL END)
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA         = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA         = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA         = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
GROUP BY 
  SCURSO.NOME
ORDER BY
  SCURSO.NOME";2317;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;12090;RM;30/05/2012;RM;30/05/2012;
G;GERSAIDASCONT;Arquivo Ger. Saídas Contabilidade;"select 
	nome,idintegracao,conta,subconta,fundo,codreduzido,restricao,replace(valor,'.','') valor,aviso,historico 
from 
	z_Unasp_LoteContabil 
order by 
	item

/*
select * from fn_Unasp_LoteContabil(:CODFILIAL_I , :datainicial_D , :datafinal_D , :TipoLote_S , :gerartodos_I , :IDFORMAPAGTO_I , :CODSESSAO_I, :Agrupamento_I )

with lanc as (
select gfilial.nome,
       gfilial.idintegracao, 
       case when charindex('.',cconta.reduzido) > 0 then left(cconta.reduzido, charindex('.', cconta.reduzido) - 1) else cconta.reduzido end as conta,
       case when len(cconta.codconta) > 13 then dbo.fnRemoveZeros(right(cconta.codconta, charindex('.', reverse(cconta.codconta)) - 1),0) end as subconta,       
       '10' as fundo,
       gccusto.codreduzido,
       case when left(cconta.codconta,1) IN ('1', '2') then '0A'
            when left(cconta.codconta,1) = '3' then '2'
            when left(cconta.codconta,1) = '4' then '0E'
       end as restricao,  	
       cpartida.valor valor,
       'N' as aviso,  
       CHISTP.DESCRICAO + ' ' + CPARTIDA.COMPLEMENTO as historico
  from cpartida (nolock)
	  inner join cconta (nolock) on cpartida.codcoligada = cconta.codcoligada and cpartida.debito = cconta.codconta
	  left join chistp (nolock) on cpartida.codcoligada = chistp.codcoligada and cpartida.codhistp = chistp.codhistp
	  inner join gfilial (nolock) on cpartida.codcoligada = gfilial.codcoligada and cpartida.codfilial = gfilial.codfilial
	  left join gccusto (nolock) on cpartida.codcoligada = gccusto.codcoligada and cpartida.codccusto = gccusto.codccusto
  Where cpartida.data between :datainicial_D and :datafinal_D and (cpartida.DATAINTEGRACAO is null or :gerartodos_I = 1)
		and cpartida.CODFILIAL = :CODFILIAL_I
		and (
				(cpartida.INTEGRAAPLICACAO = 'T' and :TipoLote_S = 'T')
				or
				(cpartida.INTEGRAAPLICACAO = 'F' and cpartida.INTEGRACHAVE like :TipoLote_S + '%')
			)
			
		and (CPARTIDA.IDPARTIDA in (
			SELECT IDPARTIDA FROM CPARTIDA C (NOLOCK), FLANBAIXA B (NOLOCK)
			WHERE C.CODCOLIGADA = B.CODCOLIGADA
			AND   case when ISNUMERIC(SUBSTRING(C.INTEGRACHAVE,2,1))=0 then SUBSTRING(C.INTEGRACHAVE,3,20) else SUBSTRING(C.INTEGRACHAVE,2,20) end = B.IDLAN
			AND   SUBSTRING(C.INTEGRACHAVE,1,1) = 'B'
			AND   C.INTEGRAAPLICACAO='F'
			AND   B.IDFORMAPAGTO=:IDFORMAPAGTO_I) or :IDFORMAPAGTO_I = '0' )
			
		and
			(
				CPARTIDA.IDPARTIDA in (
					SELECT 
						c.IDPARTIDA 
					FROM 
						FSESSAOCAIXA				SC	(NOLOCK)
						INNER JOIN FLOGSESSAOCAIXA	LSC (NOLOCK)	ON LSC.CODCOLIGADA = SC.CODCOLIGADA AND LSC.IDSESSAO = SC.IDSESSAO
						INNER JOIN FLANBAIXA		LB	(NOLOCK) 	ON LB.CODCOLIGADA = LSC.CODCOLIGADA AND LB.IDBAIXA = LSC.IDBAIXA AND LB.IDLAN = LSC.IDLAN       
						inner join CPARTIDA			C	(NOLOCK)	on case when ISNUMERIC(SUBSTRING(C.INTEGRACHAVE,2,1))=0 then SUBSTRING(C.INTEGRACHAVE,3,20) else SUBSTRING(C.INTEGRACHAVE,2,20) end = LB.IDLAN
					WHERE 	
						sc.IDSESSAO=:CODSESSAO_I)
			
				or CPARTIDA.IDPARTIDA in (
					SELECT distinct
						CPARTIDA.IDPARTIDA 
					from 
						FXCX 
						inner join FXCXCOMPL on fxcx.CODCOLIGADA = FXCXCOMPL.CODCOLIGADA and fxcx.IDXCX = FXCXCOMPL.IDXCX
						inner join CPARTIDA on CPARTIDA.CODCOLIGADA = fxcx.CODCOLIGADA 
							and FXCX.IDXCX = case when ISNUMERIC(SUBSTRING(CPARTIDA.INTEGRACHAVE,2,1))=0 then SUBSTRING(CPARTIDA.INTEGRACHAVE,3,20) else SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) end 
							AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='X'
							AND   CPARTIDA.INTEGRAAPLICACAO='F'
					where 
						FXCXCOMPL.CODSESSAO = :CODSESSAO_I)
			
				or :CODSESSAO_I = '0'
			)
		
 union all
 
 select gfilial.nome,
       gfilial.idintegracao,
       case when charindex('.',cconta.reduzido) > 0 then left(cconta.reduzido, charindex('.', cconta.reduzido) - 1) else cconta.reduzido end as conta,
       case when len(cconta.codconta) > 13 then dbo.fnRemoveZeros(right(cconta.codconta, charindex('.', reverse(cconta.codconta)) - 1),0) end as subconta,       
       '10' as fundo,
       gccusto.codreduzido,
       case when left(cconta.codconta,1) IN ('1', '2') then '0A'
            when left(cconta.codconta,1) = '3' then '2'
            when left(cconta.codconta,1) = '4' then '0E'
       end as restricao,
       cpartida.valor *-1 valor,
       'N' as aviso,  
       CHISTP.DESCRICAO + ' ' + CPARTIDA.COMPLEMENTO as historico
from cpartida (nolock)
	inner join cconta (nolock) on cpartida.codcoligada = cconta.codcoligada and cpartida.credito = cconta.codconta
	left join chistp (nolock) on cpartida.codcoligada = chistp.codcoligada and cpartida.codhistp = chistp.codhistp
	inner join gfilial (nolock) on cpartida.codcoligada = gfilial.codcoligada and cpartida.codfilial = gfilial.codfilial
	left join gccusto (nolock) on cpartida.codcoligada = gccusto.codcoligada and cpartida.codccusto = gccusto.codccusto
Where cpartida.data between :datainicial_D and :datafinal_D and (cpartida.DATAINTEGRACAO is null or :gerartodos_I = 1)
		and cpartida.CODFILIAL = :CODFILIAL_I
		and (
				(cpartida.INTEGRAAPLICACAO = 'T' and :TipoLote_S = 'T')
				or
				(cpartida.INTEGRAAPLICACAO = 'F' and cpartida.INTEGRACHAVE like :TipoLote_S + '%')
			)
		
		and (CPARTIDA.IDPARTIDA in (
			SELECT IDPARTIDA FROM CPARTIDA C (NOLOCK), FLANBAIXA B (NOLOCK)
			WHERE C.CODCOLIGADA = B.CODCOLIGADA
			AND   case when ISNUMERIC(SUBSTRING(C.INTEGRACHAVE,2,1))=0 then SUBSTRING(C.INTEGRACHAVE,3,20) else SUBSTRING(C.INTEGRACHAVE,2,20) end = B.IDLAN
			AND   SUBSTRING(C.INTEGRACHAVE,1,1) = 'B'
			AND   C.INTEGRAAPLICACAO='F'
			AND   B.IDFORMAPAGTO=:IDFORMAPAGTO_I) or :IDFORMAPAGTO_I = '0' )
			
		
		and
			(
				CPARTIDA.IDPARTIDA in (
					SELECT 
						c.IDPARTIDA 
					FROM 
						FSESSAOCAIXA				SC	(NOLOCK)
						INNER JOIN FLOGSESSAOCAIXA	LSC (NOLOCK)	ON LSC.CODCOLIGADA = SC.CODCOLIGADA AND LSC.IDSESSAO = SC.IDSESSAO
						INNER JOIN FLANBAIXA		LB	(NOLOCK) 	ON LB.CODCOLIGADA = LSC.CODCOLIGADA AND LB.IDBAIXA = LSC.IDBAIXA AND LB.IDLAN = LSC.IDLAN       
						inner join CPARTIDA			C	(NOLOCK)	on case when ISNUMERIC(SUBSTRING(C.INTEGRACHAVE,2,1))=0 then SUBSTRING(C.INTEGRACHAVE,3,20) else SUBSTRING(C.INTEGRACHAVE,2,20) end = LB.IDLAN
					WHERE 	
						sc.IDSESSAO=:CODSESSAO_I)
			
				or CPARTIDA.IDPARTIDA in (
					SELECT distinct
						CPARTIDA.IDPARTIDA 
					from 
						FXCX 
						inner join FXCXCOMPL on fxcx.CODCOLIGADA = FXCXCOMPL.CODCOLIGADA and fxcx.IDXCX = FXCXCOMPL.IDXCX
						inner join CPARTIDA on CPARTIDA.CODCOLIGADA = fxcx.CODCOLIGADA 
							and FXCX.IDXCX = case when ISNUMERIC(SUBSTRING(CPARTIDA.INTEGRACHAVE,2,1))=0 then SUBSTRING(CPARTIDA.INTEGRACHAVE,3,20) else SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) end 
							AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='X'
							AND   CPARTIDA.INTEGRAAPLICACAO='F'
					where 
						FXCXCOMPL.CODSESSAO = :CODSESSAO_I)
			
				or :CODSESSAO_I = '0'
			)
)
Select 
	nome,idintegracao,conta,subconta,fundo,codreduzido,restricao, replace(valor,'.','') valor,aviso,historico
from (
	Select 
		1 item, nome,idintegracao,conta,subconta,fundo,codreduzido,restricao, sum(valor) valor,aviso,historico
	from 
		lanc where conta in ('1112001','1139090','1132021','1132031','1132099','1132002','2161032','2161033','2161034','1111005')
	group by
		nome,idintegracao,conta,subconta,fundo,codreduzido,restricao,aviso,historico

	union all

	Select 
		2 item, nome,idintegracao,conta,subconta,fundo,codreduzido,restricao, valor,aviso,historico
	from 
		lanc where conta not in ('1112001','1139090','1132021','1132031','1132099','1132002','2161032','2161033','2161034','1111005')
	) x
order by item, historico
*/";7671;;;;18/11/2021;mestre;0;1;1;1;;;;0;46534053-fe62-49c3-a479-81d73b08d7aa;0;;-23797;mestre;23/03/2021;mestre;18/11/2021;0
G;GLBAnexPerf;Consulta Usuários por Perfil;"select gusuario.codusuario AS [Cód. Usuário], 
       gusuario.nome as [Nome]
  from gusrperfil (nolock)
 inner join gusuario (nolock) on gusrperfil.codusuario = gusuario.codusuario
where gusrperfil.codcoligada = :CODCOLIGADA
  and gusrperfil.codsistema = :CODSISTEMA
  and gusrperfil.codperfil = :CODPERFIL";313;;;;17/06/2021;mestre;0;1;1;1;;;;0;b8f9220f-e7b7-4de5-baf0-c186deaa0d7a;0;;4878;mestre;17/06/2021;mestre;17/06/2021;0
G;Graf4.0001;Evolução da venda - SQL;"SELECT TOP 6 CAST(DATEPART(year,  DATAEMISSAO) AS VARCHAR (4)) + '/'+ CAST(DATEPART(month, DATAEMISSAO) AS VARCHAR (2)), SUM (VALORLIQUIDO)

FROM TMOV

WHERE CODTMV LIKE '2.2.%'
AND DATAEMISSAO >=:DT_inicio
AND DATAEMISSAO <=:DT_Fim

GROUP BY CAST(DATEPART(year,  DATAEMISSAO) AS VARCHAR (4)) + '/'+ CAST(DATEPART(month, DATAEMISSAO) AS VARCHAR (2))

ORDER BY  CAST(DATEPART(year,  DATAEMISSAO) AS VARCHAR (4)) + '/'+ CAST(DATEPART(month, DATAEMISSAO) AS VARCHAR (2)) DESC";482;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-31200;RM;30/05/2012;RM;30/05/2012;
G;H.001;Atendimentos com Prazo Excedido;"SELECT DISTINCT
 *
FROM
(
 SELECT
  HATENDIMENTOBASE.CODCOLIGADA COLIGADA,
  HATENDIMENTOBASE.CODLOCAL,
  HLOCALIDADE.DESLOCAL LOCAL,
  HATENDIMENTOBASE.CODATENDIMENTO ATENDIMENTO,
  PPESSOA.NOME ATENDENTE,
  HTIPOATENDIMENTO.NOME 'TIPO ATENDIMENTO',
  HTAREFA.NOME ETAPA,
  CONVERT(VARCHAR(10), HHISTORICOETAPASATENDIMENTO.INICIO,103) INICIO,
   
/*Aproveitamento de Estudos Interno*/ 
  CASE WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 1 AND /* Aproveitamento de Estudos Interno */
   		    HATENDIMENTOBASE.CODTAREFA = 1 AND /*Secretaria*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 1 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())
 		    
	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 1 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 2 AND /*Coordenador do Curso*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 3 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())

	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 1 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 3 AND /*Retorna Parecer para a Secretaria*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 1 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())

	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 1 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 7 AND /*Realizar Matrícula*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 1 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())

/*Aproveitamento de Estudos Externo*/
	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 2 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 12 AND /*Abertura*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 1 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) 		    

  	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 2 AND /* Aproveitamento de Estudos Externo */
   		    HATENDIMENTOBASE.CODTAREFA = 4 AND /*Coordenador do Curso*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 5 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())
 		    
	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 2 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 5 AND /*Retorna Parecer para a Central de Atendimento*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 1 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) 		    

	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 2 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 6 AND /*Realizar Matrícula*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 1 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) 		    

/*Alteração/Inclusão de Notas e Faltas*/
  	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 4 AND /* Alteração/Inclusão de Notas e Faltas */
   		    HATENDIMENTOBASE.CODTAREFA = 19 AND /*Coordenador do Curso*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 3 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())
 		    
	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 4 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 20 AND /*Professor Titular da Disciplina*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 5 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())		    

/*Solicitação de Cancelamento/Trancamento de Curso*/
  	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 5 AND /* Solicitação de Cancelamento/Trancamento de Curso */
   		    HATENDIMENTOBASE.CODTAREFA = 23 AND /*Coordenador do Curso*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 2 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())
 		    
	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 5 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 24 AND /*Realizar Trancamento/Cancelamento*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 1 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate())		    

	   WHEN HATENDIMENTOBASE.CODTIPOATENDIMENTO = 5 AND 
   		    HATENDIMENTOBASE.CODTAREFA = 25 AND /*Financeiro*/
 		    dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) > 1 THEN dbo.FCNDIASUTEIS (HATENDIMENTOBASE.ABERTURA,getdate()) 		    
 		    
 	   ELSE 0 END DIAS_ATRASO
 
 FROM
  HATENDIMENTOBASE (NOLOCK)
 
  INNER JOIN HATENDENTE (NOLOCK)					ON HATENDIMENTOBASE.CODCOLIGADAATENDENTE = HATENDENTE.CODCOLIGADA AND 
 									   	   			   HATENDIMENTOBASE.CODATENDENTERESP = HATENDENTE.CODATENDENTE
 									   
  INNER JOIN PPESSOA (NOLOCK)						ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA 									   
 
  INNER JOIN HTIPOATENDIMENTO (NOLOCK)				ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   			   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
 										   
  INNER JOIN HTAREFA (NOLOCK)						ON HTAREFA.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   			   HTAREFA.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND 
 										   			   HTAREFA.CODTAREFA = HATENDIMENTOBASE.CODTAREFA 										   

  INNER JOIN HHISTORICOETAPASATENDIMENTO (NOLOCK)	ON HHISTORICOETAPASATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   			   HHISTORICOETAPASATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   			   HHISTORICOETAPASATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   			   HHISTORICOETAPASATENDIMENTO.CODTIPOATENDIMENTOETAPAATUAL = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND
 										   			   HHISTORICOETAPASATENDIMENTO.CODETAPAATUAL = HATENDIMENTOBASE.CODTAREFA

  LEFT JOIN HLOCALIDADE (NOLOCK)					ON HATENDIMENTOBASE.CODLOCAL = HLOCALIDADE.CODLOCAL
  
 WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	
) X
WHERE X.DIAS_ATRASO > 0
";5737;;;;22/02/2021;mestre;0;1;1;1;;;;0;bed670ad-fa58-415a-a328-1815d3aa8423;0;;3024;mestre;04/02/2021;mestre;22/02/2021;0
G;INADPLMESCU.0001;Inadimplência mensal por curso;"SELECT 
  SCURSO.NOME,
  'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORORIGINAL END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORORIGINAL END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORORIGINAL END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORORIGINAL END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORORIGINAL END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORORIGINAL END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORORIGINAL END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORORIGINAL END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORORIGINAL END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORORIGINAL END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORORIGINAL END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORORIGINAL END)
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE()
GROUP BY 
  SCURSO.NOME
ORDER BY
  SCURSO.NOME";2349;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-9208;RM;30/05/2012;RM;30/05/2012;
G;INADPLMESCU.0002;Inadimplência mensal por curso;"SELECT 
  SCURSO.NOME,
  'Janeiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 1 THEN VALORORIGINAL END),
  'Fevereiro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 2 THEN VALORORIGINAL END),
  'Março' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 3 THEN VALORORIGINAL END),
  'Abril' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 4 THEN VALORORIGINAL END),
  'Maio' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 5 THEN VALORORIGINAL END),
  'Junho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 6 THEN VALORORIGINAL END),
  'Julho' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 7 THEN VALORORIGINAL END),
  'Agosto' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 8 THEN VALORORIGINAL END),
  'Setembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 9 THEN VALORORIGINAL END),
  'Outubro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 10 THEN VALORORIGINAL END),
  'Novembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 11 THEN VALORORIGINAL END),
  'Dezembro' = SUM(CASE WHEN MONTH(DATAVENCIMENTO) = 12 THEN VALORORIGINAL END)
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE()
GROUP BY 
  SCURSO.NOME
ORDER BY
  SCURSO.NOME";2349;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-9208;RM;30/05/2012;RM;30/05/2012;
G;INADPORCURS.0001;Inadimplência por curso;"SELECT 
   SUM(FLAN.VALORORIGINAL) [TOTAL INADIMPLENCIA],
   SCURSO.NOME
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA         = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA         = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA         = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE()
GROUP BY 
  SCURSO.NOME
ORDER BY
  [TOTAL INADIMPLENCIA] DESC";1484;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12805;RM;30/05/2012;RM;30/05/2012;
G;L00001;TOTAL DE PUBLICAÇÕES;"SELECT COUNT(*) TOTAL
FROM LPUBLIC (NOLOCK)
WHERE LPUBLIC.CODCOLIGADA = :CODCOLIGADA";86;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;31597;RM;30/05/2012;RM;30/05/2012;
G;L00001.0001;TOTAL DE PUBLICAÇÕES;"SELECT COUNT(*) TOTAL
FROM LPUBLIC (NOLOCK)
WHERE LPUBLIC.CODCOLIGADA = :CODCOLIGADA";86;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;31597;RM;30/05/2012;RM;30/05/2012;
G;L00002;TOTAL DE PUBLICAÇÕES POR TIPO DE PUBLICAÇÃO;"SELECT UPPER(LTIPOPUBLIC.DESCRICAO) DESCRICAO,
       COUNT(*) TOTAL
FROM LPUBLIC (NOLOCK), 
     LTIPOPUBLIC (NOLOCK)
WHERE LPUBLIC.TIPOPUBLIC      = LTIPOPUBLIC.CODIGO
      AND LPUBLIC.CODCOLIGADA = :CODCOLIGADA
GROUP BY LTIPOPUBLIC.DESCRICAO";251;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-22077;RM;30/05/2012;RM;30/05/2012;
G;L00002.0001;TOTAL DE PUBLICAÇÕES POR TIPO DE PUBLICAÇÃO;"SELECT UPPER(LTIPOPUBLIC.DESCRICAO) DESCRICAO,
       COUNT(*) TOTAL
FROM LPUBLIC (NOLOCK), 
     LTIPOPUBLIC (NOLOCK)
WHERE LPUBLIC.TIPOPUBLIC      = LTIPOPUBLIC.CODIGO
      AND LPUBLIC.CODCOLIGADA = :CODCOLIGADA
GROUP BY LTIPOPUBLIC.DESCRICAO";251;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-22077;RM;30/05/2012;RM;30/05/2012;
G;L00003;AS SETE EDITORAS COM MAIOR NÚMERO DE PUBLICAÇÕES;"SELECT TOP 7 UPPER(LEDITORA.EDITOR) EDITOR,
       COUNT(*) TOTAL
FROM LPUBLIC (NOLOCK), 
     LEDITORA (NOLOCK)
WHERE LPUBLIC.EDITORA         = LEDITORA.CODIGO
      AND LPUBLIC.CODCOLIGADA = :CODCOLIGADA
GROUP BY LEDITORA.EDITOR
ORDER BY TOTAL DESC";257;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;14903;RM;30/05/2012;RM;30/05/2012;
G;L00003.0001;AS SETE EDITORAS COM MAIOR NÚMERO DE PUBLICAÇÕES;"SELECT TOP 7 UPPER(LEDITORA.EDITOR) EDITOR,
       COUNT(*) TOTAL
FROM LPUBLIC (NOLOCK), 
     LEDITORA (NOLOCK)
WHERE LPUBLIC.EDITORA         = LEDITORA.CODIGO
      AND LPUBLIC.CODCOLIGADA = :CODCOLIGADA
GROUP BY LEDITORA.EDITOR
ORDER BY TOTAL DESC";257;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;14903;RM;30/05/2012;RM;30/05/2012;
G;L00004;TOTAL DE CLIENTES DA UNIDADE BIBLIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LUSUARIO (NOLOCK),
     LUSUUNI (NOLOCK)
WHERE LUSUARIO.CODCOLIGADA    = LUSUUNI.CODCOLIGADA
      AND LUSUARIO.CODIGO     = LUSUUNI.CODUSUARIO
      AND LUSUUNI.CODCOLIGADA = :CODCOLIGADA
      AND LUSUUNI.CODFILIAL   = :CODFILIAL
      AND LUSUUNI.CODUNIDADE  = :CODUNIDADE";309;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-1936;RM;30/05/2012;RM;30/05/2012;
G;L00004.0001;TOTAL DE CLIENTES DA UNIDADE BIBLIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LUSUARIO (NOLOCK),
     LUSUUNI (NOLOCK)
WHERE LUSUARIO.CODCOLIGADA    = LUSUUNI.CODCOLIGADA
      AND LUSUARIO.CODIGO     = LUSUUNI.CODUSUARIO
      AND LUSUUNI.CODCOLIGADA = :CODCOLIGADA
      AND LUSUUNI.CODFILIAL   = :CODFILIAL
      AND LUSUUNI.CODUNIDADE  = :CODUNIDADE";309;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-1936;RM;30/05/2012;RM;30/05/2012;
G;L00005;TOTAL DE CLIENTES DA UNIDADE BIBLIOTECÁRIA POR TIPO DE USUÁRIO;"SELECT UPPER(LTIPOUSUARIO.DESCRICAO) DESCRICAO,
       COUNT(*) TOTAL
FROM LUSUARIO (NOLOCK),
     LTIPOUSUARIO (NOLOCK),
     LUSUUNI (NOLOCK)
WHERE LUSUARIO.TIPOUSUARIO         = LTIPOUSUARIO.CODIGO
      AND LTIPOUSUARIO.CODCOLIGADA = LUSUUNI.CODCOLIGADA
      AND LUSUARIO.CODCOLIGADA     = LUSUUNI.CODCOLIGADA
      AND LUSUARIO.CODIGO          = LUSUUNI.CODUSUARIO
      AND LUSUUNI.CODCOLIGADA      = :CODCOLIGADA
      AND LUSUUNI.CODFILIAL        = :CODFILIAL
      AND LUSUUNI.CODUNIDADE       = :CODUNIDADE
GROUP BY LTIPOUSUARIO.DESCRICAO";561;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-22820;RM;30/05/2012;RM;30/05/2012;
G;L00005.0001;TOTAL DE CLIENTES DA UNIDADE BIBLIOTECÁRIA POR TIPO DE USUÁRIO;"SELECT UPPER(LTIPOUSUARIO.DESCRICAO) DESCRICAO,
       COUNT(*) TOTAL
FROM LUSUARIO (NOLOCK),
     LTIPOUSUARIO (NOLOCK),
     LUSUUNI (NOLOCK)
WHERE LUSUARIO.TIPOUSUARIO         = LTIPOUSUARIO.CODIGO
      AND LTIPOUSUARIO.CODCOLIGADA = LUSUUNI.CODCOLIGADA
      AND LUSUARIO.CODCOLIGADA     = LUSUUNI.CODCOLIGADA
      AND LUSUARIO.CODIGO          = LUSUUNI.CODUSUARIO
      AND LUSUUNI.CODCOLIGADA      = :CODCOLIGADA
      AND LUSUUNI.CODFILIAL        = :CODFILIAL
      AND LUSUUNI.CODUNIDADE       = :CODUNIDADE
GROUP BY LTIPOUSUARIO.DESCRICAO";561;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-22820;RM;30/05/2012;RM;30/05/2012;
G;L00006;SITUAÇÃO ATUAL DOS CLIENTES NA UNIDADE BIBLIOTECÁRIA;"SELECT CASE 
         WHEN LUSUARIO.SITUSUARIO = 'R' THEN 'REGULAR'
         WHEN LUSUARIO.SITUSUARIO = 'I' THEN 'IRREGULAR'
         WHEN LUSUARIO.SITUSUARIO = 'C' THEN 'CANCELADO'
         WHEN LUSUARIO.SITUSUARIO = 'P' THEN 'PENDENTE'
       END SITUACAO,
       COUNT(*) TOTAL
FROM LUSUARIO (NOLOCK),
     LUSUUNI (NOLOCK)
WHERE LUSUARIO.CODCOLIGADA    = LUSUUNI.CODCOLIGADA
      AND LUSUARIO.CODIGO     = LUSUUNI.CODUSUARIO
      AND LUSUUNI.CODCOLIGADA = :CODCOLIGADA
      AND LUSUUNI.CODFILIAL   = :CODFILIAL
      AND LUSUUNI.CODUNIDADE  = :CODUNIDADE
GROUP BY LUSUARIO.SITUSUARIO";604;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;1597;RM;30/05/2012;RM;30/05/2012;
G;L00006.0001;SITUAÇÃO ATUAL DOS CLIENTES NA UNIDADE BIBLIOTECÁRIA;"SELECT CASE 
         WHEN LUSUARIO.SITUSUARIO = 'R' THEN 'REGULAR'
         WHEN LUSUARIO.SITUSUARIO = 'I' THEN 'IRREGULAR'
         WHEN LUSUARIO.SITUSUARIO = 'C' THEN 'CANCELADO'
         WHEN LUSUARIO.SITUSUARIO = 'P' THEN 'PENDENTE'
       END SITUACAO,
       COUNT(*) TOTAL
FROM LUSUARIO (NOLOCK),
     LUSUUNI (NOLOCK)
WHERE LUSUARIO.CODCOLIGADA    = LUSUUNI.CODCOLIGADA
      AND LUSUARIO.CODIGO     = LUSUUNI.CODUSUARIO
      AND LUSUUNI.CODCOLIGADA = :CODCOLIGADA
      AND LUSUUNI.CODFILIAL   = :CODFILIAL
      AND LUSUUNI.CODUNIDADE  = :CODUNIDADE
GROUP BY LUSUARIO.SITUSUARIO";604;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;1597;RM;30/05/2012;RM;30/05/2012;
G;L00007;TOTAL DE EXEMPLARES POR UNIDADE BIBLIOTECÁRIA;"SELECT UPPER(LUNIDADE.UNIDADE) UNIDADE,
       COUNT(*) TOTAL
FROM LEXEMPLAR (NOLOCK),
     LUNIDADE (NOLOCK)
WHERE LEXEMPLAR.CODCOLIGADA     = LUNIDADE.CODCOLIGADA
      AND LEXEMPLAR.CODFILIAL   = LUNIDADE.CODFILIAL
      AND LEXEMPLAR.CODUNIDADE  = LUNIDADE.CODIGO
      AND LEXEMPLAR.CODCOLIGADA = :CODCOLIGADA
GROUP BY LUNIDADE.UNIDADE";348;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17604;RM;30/05/2012;RM;30/05/2012;
G;L00007.0001;TOTAL DE EXEMPLARES POR UNIDADE BIBLIOTECÁRIA;"SELECT UPPER(LUNIDADE.UNIDADE) UNIDADE,
       COUNT(*) TOTAL
FROM LEXEMPLAR (NOLOCK),
     LUNIDADE (NOLOCK)
WHERE LEXEMPLAR.CODCOLIGADA     = LUNIDADE.CODCOLIGADA
      AND LEXEMPLAR.CODFILIAL   = LUNIDADE.CODFILIAL
      AND LEXEMPLAR.CODUNIDADE  = LUNIDADE.CODIGO
      AND LEXEMPLAR.CODCOLIGADA = :CODCOLIGADA
GROUP BY LUNIDADE.UNIDADE";348;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17604;RM;30/05/2012;RM;30/05/2012;
G;L00008;AS DEZ PUBLICAÇÕES MAIS RESERVADAS NA UNIDADE BIBLIOTECÁRIA;"SELECT TOP 10 UPPER(LPUBLIC.TITULO) TITULO,
       COUNT(*) TOTAL
FROM LRESERVA (NOLOCK),
     LPUBLIC (NOLOCK)
WHERE LRESERVA.CODCOLIGADA     = LPUBLIC.CODCOLIGADA
      AND LRESERVA.CODPUBLIC   = LPUBLIC.CODIGO
      AND LRESERVA.CODCOLIGADA = :CODCOLIGADA
      AND LRESERVA.CODFILIAL   = :CODFILIAL
      AND LRESERVA.CODUNIDADE  = :CODUNIDADE
GROUP BY LPUBLIC.TITULO
ORDER BY TOTAL DESC";401;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;4258;RM;30/05/2012;RM;30/05/2012;
G;L00008.0001;AS DEZ PUBLICAÇÕES MAIS RESERVADAS NA UNIDADE BIBLIOTECÁRIA;"SELECT TOP 10 UPPER(LPUBLIC.TITULO) TITULO,
       COUNT(*) TOTAL
FROM LRESERVA (NOLOCK),
     LPUBLIC (NOLOCK)
WHERE LRESERVA.CODCOLIGADA     = LPUBLIC.CODCOLIGADA
      AND LRESERVA.CODPUBLIC   = LPUBLIC.CODIGO
      AND LRESERVA.CODCOLIGADA = :CODCOLIGADA
      AND LRESERVA.CODFILIAL   = :CODFILIAL
      AND LRESERVA.CODUNIDADE  = :CODUNIDADE
GROUP BY LPUBLIC.TITULO
ORDER BY TOTAL DESC";401;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;4258;RM;30/05/2012;RM;30/05/2012;
G;L00009;NÚMERO DE RESERVAS ATIVAS NA UNIDADE BILBIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LRESERVA (NOLOCK)
WHERE LRESERVA.CODCOLIGADA    = :CODCOLIGADA
      AND LRESERVA.CODFILIAL  = :CODFILIAL
      AND LRESERVA.CODUNIDADE = :CODUNIDADE
      AND LRESERVA.STATUSRES = 'R'";216;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;24374;RM;30/05/2012;RM;30/05/2012;
G;L00009.0001;NÚMERO DE RESERVAS ATIVAS NA UNIDADE BILBIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LRESERVA (NOLOCK)
WHERE LRESERVA.CODCOLIGADA    = :CODCOLIGADA
      AND LRESERVA.CODFILIAL  = :CODFILIAL
      AND LRESERVA.CODUNIDADE = :CODUNIDADE
      AND LRESERVA.STATUSRES = 'R'";216;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;24374;RM;30/05/2012;RM;30/05/2012;
G;L00010;AS DEZ PUBLICAÇÕES MAIS EMPRESTADAS NA UNIDADE BIBLIOTECÁRIA;"SELECT TOP 10 UPPER(LPUBLIC.TITULO) TITULO,
       COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK),
     LPUBLIC (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA     = LPUBLIC.CODCOLIGADA
      AND LEMPRESTIMOS.CODPUBLIC   = LPUBLIC.CODIGO
      AND LEMPRESTIMOS.CODCOLIGADA = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL   = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE  = :CODUNIDADE
GROUP BY LPUBLIC.TITULO
ORDER BY TOTAL DESC";425;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-4135;RM;30/05/2012;RM;30/05/2012;
G;L00010.0001;AS DEZ PUBLICAÇÕES MAIS EMPRESTADAS NA UNIDADE BIBLIOTECÁRIA;"SELECT TOP 10 UPPER(LPUBLIC.TITULO) TITULO,
       COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK),
     LPUBLIC (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA     = LPUBLIC.CODCOLIGADA
      AND LEMPRESTIMOS.CODPUBLIC   = LPUBLIC.CODIGO
      AND LEMPRESTIMOS.CODCOLIGADA = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL   = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE  = :CODUNIDADE
GROUP BY LPUBLIC.TITULO
ORDER BY TOTAL DESC";425;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-4135;RM;30/05/2012;RM;30/05/2012;
G;L00011;NÚMERO DE EMPRÉSTIMOS REALIZADOS NO DIA NA UNIDADE BIBLIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA	      = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL      = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE	  = :CODUNIDADE
      AND CONVERT(VARCHAR(12),LEMPRESTIMOS.DTHREMPRESTIMO,103) = CONVERT(VARCHAR(12),GETDATE(),103)";306;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12912;RM;30/05/2012;RM;30/05/2012;
G;L00011.0001;NÚMERO DE EMPRÉSTIMOS REALIZADOS NO DIA NA UNIDADE BIBLIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA	      = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL      = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE	  = :CODUNIDADE
      AND CONVERT(VARCHAR(12),LEMPRESTIMOS.DTHREMPRESTIMO,103) = CONVERT(VARCHAR(12),GETDATE(),103)";306;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12912;RM;30/05/2012;RM;30/05/2012;
G;L00012;NÚMERO DE DEVOLUÇÕES REALIZADAS NO DIA NA UNIDADE BIBLIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA        = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL      = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE     = :CODUNIDADE
      AND CONVERT(VARCHAR(12),LEMPRESTIMOS.DTHRDEVEFETIVA,103) = CONVERT(VARCHAR(12),GETDATE(),103)";309;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-2731;RM;30/05/2012;RM;30/05/2012;
G;L00012.0001;NÚMERO DE DEVOLUÇÕES REALIZADAS NO DIA NA UNIDADE BIBLIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA        = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL      = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE     = :CODUNIDADE
      AND CONVERT(VARCHAR(12),LEMPRESTIMOS.DTHRDEVEFETIVA,103) = CONVERT(VARCHAR(12),GETDATE(),103)";309;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-2731;RM;30/05/2012;RM;30/05/2012;
G;L00013;OS DEZ CLIENTES QUE MAIS REALIZAM EMPRÉSTIMOS NA UNIDADE BIBLIOTECÁRIA;"SELECT TOP 10 UPPER(PPESSOA.NOME) NOME,
       COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK),
     LUSUARIO (NOLOCK),
     PPESSOA (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA     = LUSUARIO.CODCOLIGADA
      AND LEMPRESTIMOS.CODCLIENTE  = LUSUARIO.CODIGO
      AND LUSUARIO.CODPESSOA       = PPESSOA.CODIGO
      AND LEMPRESTIMOS.CODCOLIGADA = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL   = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE  = :CODUNIDADE
      AND LEMPRESTIMOS.STATUSEMP   <> 'C'
GROUP BY PPESSOA.NOME
ORDER BY TOTAL DESC";542;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;1606;RM;30/05/2012;RM;30/05/2012;
G;L00013.0001;OS DEZ CLIENTES QUE MAIS REALIZAM EMPRÉSTIMOS NA UNIDADE BIBLIOTECÁRIA;"SELECT TOP 10 UPPER(PPESSOA.NOME) NOME,
       COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK),
     LUSUARIO (NOLOCK),
     PPESSOA (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA     = LUSUARIO.CODCOLIGADA
      AND LEMPRESTIMOS.CODCLIENTE  = LUSUARIO.CODIGO
      AND LUSUARIO.CODPESSOA       = PPESSOA.CODIGO
      AND LEMPRESTIMOS.CODCOLIGADA = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL   = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE  = :CODUNIDADE
      AND LEMPRESTIMOS.STATUSEMP   <> 'C'
GROUP BY PPESSOA.NOME
ORDER BY TOTAL DESC";542;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;1606;RM;30/05/2012;RM;30/05/2012;
G;L00014;NÚMERO DE EMPRÉSTIMOS ATIVOS NA UNIDADE BILBIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA    = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL  = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE = :CODUNIDADE
      AND LEMPRESTIMOS.STATUSEMP  IN ('E', 'A')";245;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;12571;RM;30/05/2012;RM;30/05/2012;
G;L00014.0001;NÚMERO DE EMPRÉSTIMOS ATIVOS NA UNIDADE BILBIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA    = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL  = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE = :CODUNIDADE
      AND LEMPRESTIMOS.STATUSEMP  IN ('E', 'A')";245;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;12571;RM;30/05/2012;RM;30/05/2012;
G;L00015;NÚMERO DE EMPRÉSTIMOS EM ATRASO NA UNIDADE BIBLIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA    = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL  = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE = :CODUNIDADE
      AND LEMPRESTIMOS.STATUSEMP  = 'A'";237;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;9635;RM;30/05/2012;RM;30/05/2012;
G;L00015.0001;NÚMERO DE EMPRÉSTIMOS EM ATRASO NA UNIDADE BIBLIOTECÁRIA;"SELECT COUNT(*) TOTAL
FROM LEMPRESTIMOS (NOLOCK)
WHERE LEMPRESTIMOS.CODCOLIGADA    = :CODCOLIGADA
      AND LEMPRESTIMOS.CODFILIAL  = :CODFILIAL
      AND LEMPRESTIMOS.CODUNIDADE = :CODUNIDADE
      AND LEMPRESTIMOS.STATUSEMP  = 'A'";237;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;9635;RM;30/05/2012;RM;30/05/2012;
G;L00017;COMPARATIVO DE RESERVAS FEITAS NA WEB X PRESENCIAL;"SELECT CASE 
         WHEN LRESERVA.ORIGEMRES = 'WIN' THEN 'PRESENCIAL'
         WHEN LRESERVA.ORIGEMRES = 'WEB' THEN 'WEB'
       END SITUACAO,
       COUNT(*) TOTAL
FROM LRESERVA (NOLOCK)
WHERE LRESERVA.CODCOLIGADA    = :CODCOLIGADA
      AND LRESERVA.CODFILIAL  = :CODFILIAL
      AND LRESERVA.CODUNIDADE = :CODUNIDADE
GROUP BY LRESERVA.ORIGEMRES";358;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-28802;RM;30/05/2012;RM;30/05/2012;
G;L00017.0001;COMPARATIVO DE RESERVAS FEITAS NA WEB X PRESENCIAL;"SELECT CASE 
         WHEN LRESERVA.ORIGEMRES = 'WIN' THEN 'PRESENCIAL'
         WHEN LRESERVA.ORIGEMRES = 'WEB' THEN 'WEB'
       END SITUACAO,
       COUNT(*) TOTAL
FROM LRESERVA (NOLOCK)
WHERE LRESERVA.CODCOLIGADA    = :CODCOLIGADA
      AND LRESERVA.CODFILIAL  = :CODFILIAL
      AND LRESERVA.CODUNIDADE = :CODUNIDADE
GROUP BY LRESERVA.ORIGEMRES";358;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-28802;RM;30/05/2012;RM;30/05/2012;
G;NALUCURSOSI.0001;Número de alunos por curso e situação de matrícula;"SELECT 
  SCURSO.NOME + ' - ' + SSTATUS.DESCRICAO as SITUACAO,
  COUNT(*) [TOTAL ALUNOS]
FROM
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK),
  SSTATUS (NOLOCK)
WHERE
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
  SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
GROUP BY 
  SCURSO.NOME,
  SSTATUS.DESCRICAO
ORDER BY 
  SCURSO.NOME,
  [TOTAL ALUNOS] DESC";682;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-3676;RM;30/05/2012;RM;30/05/2012;
G;NALUCURSOSI.0002;Número de alunos por curso e situação de matrícula;"SELECT 
  SCURSO.NOME + ' - ' + SSTATUS.DESCRICAO as SITUACAO,
  COUNT(*) [TOTAL ALUNOS]
FROM
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK),
  SSTATUS (NOLOCK)
WHERE
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
  SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
GROUP BY 
  SCURSO.NOME,
  SSTATUS.DESCRICAO
ORDER BY 
  SCURSO.NOME,
  [TOTAL ALUNOS] DESC";682;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-3676;RM;30/05/2012;RM;30/05/2012;
G;NALUNOSCURS.0001;Número de alunos por curso;"SELECT 
  SCURSO.NOME,
  COUNT(*) [TOTAL ALUNOS]
FROM
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK),
  SSTATUS
WHERE
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO and
  SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS and
  SSTATUS.DESCRICAO='Cursando'
  and SHABILITACAOFILIAL.CODTIPOCURSO = :CODTIPOCURSO
GROUP BY 
  SCURSO.NOME
ORDER BY 
  [TOTAL ALUNOS] DESC";627;0;;;01/12/2021;isaldo;0;1;1;1;;;;0;46351e45-f3eb-49dc-bc23-26ff8329563c;;;18963;RM;30/05/2012;isaldo;01/12/2021;
G;NALUNOSCURS.0002;Número de alunos por curso;"SELECT 
  SCURSO.NOME,
  COUNT(*) [TOTAL ALUNOS]
FROM
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK)
WHERE
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
GROUP BY 
  SCURSO.NOME
ORDER BY 
  [TOTAL ALUNOS] DESC";469;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;30387;RM;30/05/2012;RM;30/05/2012;
G;PVT.010;Sessão de Caixa;"SET LANGUAGE Portuguese;
SELECT	  
  FSESSAOCAIXA.CODCOLIGADA,
  FSESSAOCAIXA.CODFILIAL FILIAL,
  FSESSAOCAIXA.IDSESSAO, 
  FSESSAOCAIXA.NUMEROCAIXA CAIXA, 
  FSESSAOCAIXA.CODUSUARIOOPERADOR 'CÓD. OPERADOR',
  GUSUARIO.NOME OPERADOR,
  FSESSAOCAIXA.DATAHORAABERTURA ABERTURA,
  FSESSAOCAIXA.DATAHORAFECHAMENTO FECHAMENTO,
  FSESSAOCAIXA.CODCXA 'CÓD. CONTA',
  FCXA.DESCRICAO 'CONTA CAIXA',
  FLAN.IDLAN,
  FLAN.NUMERODOCUMENTO DOCUMENTO,
  FLAN.CODCFO,
  FCFO.NOME RESPONSÁVEL,
  FLANBAIXA.IDBAIXA,
  FLANBAIXA.USUARIO 'USUÁRIO BAIXA',
  CONVERT(VARCHAR(10), FLANBAIXA.DATABAIXA, 103) BAIXA,
  CASE WHEN FLANBAIXA.STATUS <> 1 THEN SUM(FLANBAIXA.VALORBAIXA)
	   ELSE 0 END RECEBIMENTOS,
  CASE WHEN FLANBAIXA.STATUS = 1 AND FLOGSESSAOCAIXA.CLASSIFICACAO = 272 THEN SUM(FLANBAIXA.VALORBAIXA)
	   ELSE 0 END ESTORNADOS,
  TFORMAPAGTO.CODFORMAPAGTO,
  TFORMAPAGTO.DESCFORMAPAGTO 'FORMA PAGTO'
 FROM 
  FSESSAOCAIXA (NOLOCK)
 INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = FSESSAOCAIXA.CODCOLIGADA AND GFILIAL.CODFILIAL = FSESSAOCAIXA.CODFILIAL
 INNER JOIN FCXA (NOLOCK) ON FCXA.CODCOLIGADA = FSESSAOCAIXA.CODCOLCXA AND FCXA.CODCXA = FSESSAOCAIXA.CODCXA
 INNER JOIN GUSUARIO (NOLOCK) ON GUSUARIO.CODUSUARIO = FSESSAOCAIXA.CODUSUARIOOPERADOR
 INNER JOIN FLOGSESSAOCAIXA (NOLOCK) ON FLOGSESSAOCAIXA.CODCOLIGADA = FSESSAOCAIXA.CODCOLIGADA AND FLOGSESSAOCAIXA.IDSESSAO = FSESSAOCAIXA.IDSESSAO
 INNER JOIN FLANBAIXA (NOLOCK) ON FLANBAIXA.CODCOLIGADA = FLOGSESSAOCAIXA.CODCOLIGADA AND FLANBAIXA.IDLAN = FLOGSESSAOCAIXA.IDLAN AND FLANBAIXA.IDBAIXA = FLOGSESSAOCAIXA.IDBAIXA 
 INNER JOIN FLAN (NOLOCK) ON FLAN.CODCOLCXA = FLANBAIXA.CODCOLIGADA AND FLAN.IDLAN = FLANBAIXA.IDLAN  
 INNER JOIN TFORMAPAGTO (NOLOCK)  ON TFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND TFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO
 INNER JOIN FCFO (NOLOCK) ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO AND FCFO.CODCFO = FLAN.CODCFO
 WHERE  FSESSAOCAIXA.CODCOLIGADA = 1
 	/*AND CONVERT(VARCHAR(10), FSESSAOCAIXA.DATAHORAABERTURA, 103) = :DATAINICIAL_D*/
 	AND FSESSAOCAIXA.DATAHORAABERTURA BETWEEN :DATAINICIAL_D AND :DATAFINAL_D
	/*AND FSESSAOCAIXA.IDSESSAO = 1754*/ 	
GROUP BY FSESSAOCAIXA.CODCOLIGADA,
		 FSESSAOCAIXA.CODFILIAL,
		 FSESSAOCAIXA.IDSESSAO, 
		 FSESSAOCAIXA.NUMEROCAIXA, 
		 FSESSAOCAIXA.CODUSUARIOOPERADOR,
		 GUSUARIO.NOME,
		 FSESSAOCAIXA.DATAHORAABERTURA,
		 FSESSAOCAIXA.DATAHORAFECHAMENTO,
		 FSESSAOCAIXA.CODCXA,
		 FCXA.DESCRICAO,
		 FSESSAOCAIXA.SALDOBAIXADORECEBIDO,
		 FSESSAOCAIXA.SALDORECEBIMENTOSESTORNADOS,
		 FSESSAOCAIXA.QTDEBAIXASRECEBER,
		 FSESSAOCAIXA.QTDEESTORNOSBAIXASRECEBER,
		 TFORMAPAGTO.CODFORMAPAGTO,
		 TFORMAPAGTO.DESCFORMAPAGTO,
		 FLANBAIXA.IDFORMAPAGTO,
		 FLANBAIXA.STATUS,
		 FLAN.IDLAN,
		 FLAN.NUMERODOCUMENTO,
		 FLAN.CODCFO,
		 FCFO.NOME,
  		 FLANBAIXA.IDBAIXA,
  		 FLANBAIXA.USUARIO,
		 FLANBAIXA.DATABAIXA,
		 FLOGSESSAOCAIXA.CLASSIFICACAO
";2937;;;;11/04/2022;marli.oliveira;0;1;1;1;;;;0;e8b84d83-c8cc-4cab-8154-1d2ef245bf99;0;;-254;marli.oliveira;08/04/2022;marli.oliveira;11/04/2022;0
G;QUERY;QUERY SELECT - RAFAEL;"SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME, COUNT(SMATRICPL.RA) ALUNOS
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOALUNO (NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET

WHERE SCONTRATO.CODCOLIGADA = 1 /*:CODCOLIGADA_N*/
  AND SMATRICPL.CODFILIAL = 1 /*:CODFILIAL_N*/
  AND SCURSO.CODTIPOCURSO = 1 /*:CODTIPOCURSO_N*/
  AND SCURSO.CODCURSO = 'SP-BCCOM' /*:CODCURSO1_S*/
  AND STURMA.CODTURMA = 'GBCCOM43B' /*:CODTURMA_S*/
  AND SHABILITACAOALUNO.CODSTATUS = 2
  
 GROUP BY STURMA.CODTURMA, STURMA.NOME";1994;;;;13/09/2021;rafael.prado;0;1;1;1;;;;0;ecb03780-0c65-4cfa-a3a8-b549e535f2e8;0;;-21714;rafael.prado;13/09/2021;rafael.prado;13/09/2021;0
G;SQLCubNotaProva;SQL Cubo Notas e Avaliações;"select sturmadisc.codcoligada,
	   sturmadisc.codfilial,
	   sturmadisc.idturmadisc,
	   professor.nome as nome_professor,
	   saluno.ra,
	   aluno.nome as nome_aluno,
	   sturmadisc.coddisc,
	   sdisciplina.nome as nome_disciplina,
	   sprovas.codprova,
	   sprovas.descricao as prova,
	   snotas.nota as nota_prova,
	   media.notafalta as media,
	   faltas.notafalta as faltas,
	   scurso.nome as nome_curso,
	   setapas.aulasdadas,
	   (select count(aula)
	      from splanoaula
		  where codcoligada = sturmadisc.codcoligada
		    and idturmadisc = sturmadisc.idturmadisc) as qtd_aulasprevista
  from sturmadisc (nolock)
 inner join sdisciplina (nolock) on (sturmadisc.codcoligada = sdisciplina.codcoligada and sturmadisc.coddisc = sdisciplina.coddisc)
 inner join smatricula (nolock) on (sturmadisc.codcoligada = smatricula.codcoligada and sturmadisc.idturmadisc = smatricula.idturmadisc)
  left join snotaetapa as media (nolock) on (sturmadisc.codcoligada = media.codcoligada and sturmadisc.idturmadisc = media.idturmadisc and media.tipoetapa = 'N' and media.codetapa = 2 and media.ra = smatricula.ra)
  left join snotaetapa as faltas (nolock) on (sturmadisc.codcoligada = faltas.codcoligada and sturmadisc.idturmadisc = faltas.idturmadisc and faltas.tipoetapa = 'F' and faltas.codetapa = 1 and faltas.ra = smatricula.ra)
 inner join saluno (nolock) on (smatricula.codcoligada = saluno.codcoligada and smatricula.ra = saluno.ra)
 inner join ppessoa aluno (nolock) on (saluno.codpessoa = aluno.codigo)
  left join sprovas (nolock) on (sturmadisc.codcoligada = sprovas.codcoligada and sturmadisc.idturmadisc = sprovas.idturmadisc and sprovas.codetapa = 1 and sprovas.tipoetapa = 'N')
  left join snotas (nolock) on (sprovas.codcoligada = snotas.codcoligada and sprovas.codprova = snotas.codprova and snotas.tipoetapa = 'N' and snotas.codetapa = 1 and sprovas.idturmadisc = snotas.idturmadisc and saluno.ra = snotas.ra)
 inner join spletivo (nolock) on (sturmadisc.codcoligada = spletivo.codcoligada and sturmadisc.idperlet = spletivo.idperlet)
  left join sprofessorturma (nolock) on (sturmadisc.codcoligada = sprofessorturma.codcoligada and sturmadisc.idturmadisc = sprofessorturma.idturmadisc)
  left join sprofessor (nolock) on (sprofessorturma.codcoligada = sprofessor.codcoligada and sprofessorturma.codprof = sprofessor.codprof)
  left join ppessoa professor (nolock) on (sprofessor.codpessoa = professor.codigo) 
  left join shabilitacaofilial (nolock) on (sturmadisc.codcoligada = shabilitacaofilial.codcoligada and sturmadisc.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial)  
  left join scurso (nolock) on (shabilitacaofilial.codcoligada = scurso.codcoligada and shabilitacaofilial.codcurso = scurso.codcurso)
  left join setapas (nolock) on (sturmadisc.codcoligada = setapas.codcoligada and sturmadisc.idturmadisc = setapas.idturmadisc and setapas.codetapa = 1 and setapas.tipoetapa = 'F')
 where sturmadisc.codcoligada = :CODCOLIGADA_N 
   and sturmadisc.codfilial = :CODFILIAL_N
   and smatricula.ra LIKE :RA_S
   and sturmadisc.codturma LIKE :TURMA_S
   and spletivo.codperlet LIKE :CODPERLET_S
   and scurso.codcurso LIKE :CODCURSO_S
   and sprofessorturma.tipoprof = 'T'
order by aluno.nome   ";3269;;;;08/12/2021;raphael.muzy;0;1;1;1;;;;0;e7966961-b5e7-41af-b59e-2e06aedfb402;0;;29646;raphael.muzy;07/12/2021;raphael.muzy;08/12/2021;0
G;SQLCubNotaProva1;SQL Cubo Notas e Avaliações Aulas Previstas Diferentes Aulas Dadas;"select sturmadisc.codcoligada,
	   sturmadisc.codfilial,
	   sturmadisc.idturmadisc,
	   professor.nome as nome_professor,
	   saluno.ra,
	   aluno.nome as nome_aluno,
	   sturmadisc.coddisc,
	   sdisciplina.nome as nome_disciplina,
	   sprovas.codprova,
	   sprovas.descricao as prova,
	   snotas.nota as nota_prova,
	   media.notafalta as media,
	   faltas.notafalta as faltas,
	   scurso.nome as nome_curso,
	   setapas.aulasdadas,
	   (select count(aula)
	      from splanoaula
		  where codcoligada = sturmadisc.codcoligada
		    and idturmadisc = sturmadisc.idturmadisc) as qtd_aulasprevista
  from sturmadisc (nolock)
 inner join sdisciplina (nolock) on (sturmadisc.codcoligada = sdisciplina.codcoligada and sturmadisc.coddisc = sdisciplina.coddisc)
 inner join smatricula (nolock) on (sturmadisc.codcoligada = smatricula.codcoligada and sturmadisc.idturmadisc = smatricula.idturmadisc)
  left join snotaetapa as media (nolock) on (sturmadisc.codcoligada = media.codcoligada and sturmadisc.idturmadisc = media.idturmadisc and media.tipoetapa = 'N' and media.codetapa = 2 and media.ra = smatricula.ra)
  left join snotaetapa as faltas (nolock) on (sturmadisc.codcoligada = faltas.codcoligada and sturmadisc.idturmadisc = faltas.idturmadisc and faltas.tipoetapa = 'F' and faltas.codetapa = 1 and faltas.ra = smatricula.ra)
 inner join saluno (nolock) on (smatricula.codcoligada = saluno.codcoligada and smatricula.ra = saluno.ra)
 inner join ppessoa aluno (nolock) on (saluno.codpessoa = aluno.codigo)
  left join sprovas (nolock) on (sturmadisc.codcoligada = sprovas.codcoligada and sturmadisc.idturmadisc = sprovas.idturmadisc and sprovas.codetapa = 1 and sprovas.tipoetapa = 'N')
  left join snotas (nolock) on (sprovas.codcoligada = snotas.codcoligada and sprovas.codprova = snotas.codprova and snotas.tipoetapa = 'N' and snotas.codetapa = 1 and sprovas.idturmadisc = snotas.idturmadisc and saluno.ra = snotas.ra)
 inner join spletivo (nolock) on (sturmadisc.codcoligada = spletivo.codcoligada and sturmadisc.idperlet = spletivo.idperlet)
  left join sprofessorturma (nolock) on (sturmadisc.codcoligada = sprofessorturma.codcoligada and sturmadisc.idturmadisc = sprofessorturma.idturmadisc)
  left join sprofessor (nolock) on (sprofessorturma.codcoligada = sprofessor.codcoligada and sprofessorturma.codprof = sprofessor.codprof)
  left join ppessoa professor (nolock) on (sprofessor.codpessoa = professor.codigo) 
  left join shabilitacaofilial (nolock) on (sturmadisc.codcoligada = shabilitacaofilial.codcoligada and sturmadisc.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial)  
  left join scurso (nolock) on (shabilitacaofilial.codcoligada = scurso.codcoligada and shabilitacaofilial.codcurso = scurso.codcurso)
  left join setapas (nolock) on (sturmadisc.codcoligada = setapas.codcoligada and sturmadisc.idturmadisc = setapas.idturmadisc and setapas.codetapa = 1 and setapas.tipoetapa = 'F')
 where sturmadisc.codcoligada = :CODCOLIGADA_N 
   and sturmadisc.codfilial = :CODFILIAL_N
   and smatricula.ra LIKE :RA_S
   and sturmadisc.codturma LIKE :TURMA_S
   and spletivo.codperlet LIKE :CODPERLET_S
   and scurso.codcurso LIKE :CODCURSO_S
   and sprofessorturma.tipoprof = 'T'
   
   AND setapas.aulasdadas <> (select count(aula)
	      from splanoaula
		  where codcoligada = sturmadisc.codcoligada
		    and idturmadisc = sturmadisc.idturmadisc)
order by aluno.nome   ";3445;;;;04/07/2022;consultor1.totvs;0;1;1;1;;;;0;e7966961-b5e7-41af-b59e-2e06aedfb402;0;;8166;consultor1.totvs;04/07/2022;consultor1.totvs;04/07/2022;0
G;SQLCubNotaProva2;SQL Cubo Notas e Avaliações Sem Nota ou Media;"select sturmadisc.codcoligada,
	stipocurso.nome as 'nivel ensino',
	   sturmadisc.codfilial,
	   sturmadisc.idturmadisc,
	   professor.nome as nome_professor,
	   saluno.ra,
	   aluno.nome as nome_aluno,
	   sturmadisc.coddisc,
	   sdisciplina.nome as nome_disciplina,
	   sprovas.codprova,
	   sprovas.descricao as prova,
	   snotas.nota as nota_prova,
	   media.notafalta as media,
	   faltas.notafalta as faltas,
	   scurso.nome as nome_curso,
	   setapas.aulasdadas,
	   (select count(aula)
	      from splanoaula
		  where codcoligada = sturmadisc.codcoligada
		    and idturmadisc = sturmadisc.idturmadisc) as qtd_aulasprevista
  from sturmadisc (nolock)
 inner join sdisciplina (nolock) on (sturmadisc.codcoligada = sdisciplina.codcoligada and sturmadisc.coddisc = sdisciplina.coddisc)
 inner join smatricula (nolock) on (sturmadisc.codcoligada = smatricula.codcoligada and sturmadisc.idturmadisc = smatricula.idturmadisc)
  left join snotaetapa as media (nolock) on (sturmadisc.codcoligada = media.codcoligada and sturmadisc.idturmadisc = media.idturmadisc and media.tipoetapa = 'N' and media.codetapa = 2 and media.ra = smatricula.ra)
  left join snotaetapa as faltas (nolock) on (sturmadisc.codcoligada = faltas.codcoligada and sturmadisc.idturmadisc = faltas.idturmadisc and faltas.tipoetapa = 'F' and faltas.codetapa = 1 and faltas.ra = smatricula.ra)
 inner join saluno (nolock) on (smatricula.codcoligada = saluno.codcoligada and smatricula.ra = saluno.ra)
 inner join ppessoa aluno (nolock) on (saluno.codpessoa = aluno.codigo)
  left join sprovas (nolock) on (sturmadisc.codcoligada = sprovas.codcoligada and sturmadisc.idturmadisc = sprovas.idturmadisc and sprovas.codetapa = 1 and sprovas.tipoetapa = 'N')
  left join snotas (nolock) on (sprovas.codcoligada = snotas.codcoligada and sprovas.codprova = snotas.codprova and snotas.tipoetapa = 'N' and snotas.codetapa = 1 and sprovas.idturmadisc = snotas.idturmadisc and saluno.ra = snotas.ra)
 inner join spletivo (nolock) on (sturmadisc.codcoligada = spletivo.codcoligada and sturmadisc.idperlet = spletivo.idperlet)
  INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
  left join sprofessorturma (nolock) on (sturmadisc.codcoligada = sprofessorturma.codcoligada and sturmadisc.idturmadisc = sprofessorturma.idturmadisc)
  left join sprofessor (nolock) on (sprofessorturma.codcoligada = sprofessor.codcoligada and sprofessorturma.codprof = sprofessor.codprof)
  left join ppessoa professor (nolock) on (sprofessor.codpessoa = professor.codigo) 
  left join shabilitacaofilial (nolock) on (sturmadisc.codcoligada = shabilitacaofilial.codcoligada and sturmadisc.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial)  
  left join scurso (nolock) on (shabilitacaofilial.codcoligada = scurso.codcoligada and shabilitacaofilial.codcurso = scurso.codcurso)
  left join setapas (nolock) on (sturmadisc.codcoligada = setapas.codcoligada and sturmadisc.idturmadisc = setapas.idturmadisc and setapas.codetapa = 1 and setapas.tipoetapa = 'F')
 where sturmadisc.codcoligada = :CODCOLIGADA_N 
   and sturmadisc.codfilial = :CODFILIAL_N
   and smatricula.ra LIKE :RA_S
   and sturmadisc.codturma LIKE :TURMA_S
   and spletivo.codperlet LIKE :CODPERLET_S
   and scurso.codcurso LIKE :CODCURSO_S
   AND spletivo.CODTIPOCURSO = :NIVELENSINO_N
   and sprofessorturma.tipoprof = 'T'
    AND sprovas.descricao NOT LIKE '%BONUS%'
  AND sprovas.descricao NOT LIKE '%BONIFICA%'
    AND (snotas.nota is null OR media.notafalta IS NULL OR media.notafalta = 0)
order by aluno.nome   ";3662;;;;04/07/2022;consultor1.totvs;0;1;1;1;;;;0;e7966961-b5e7-41af-b59e-2e06aedfb402;0;;25504;consultor1.totvs;04/07/2022;consultor1.totvs;04/07/2022;0
G;SQLIPCubACurric;SQL Cubo Análise Curricular;"SELECT ANALISECURRICULAR.CODDISC,
       ANALISECURRICULAR.DISCIPLINA,
       ANALISECURRICULAR.STATUS,
       ANALISECURRICULAR.PLETIVO,
       ANALISECURRICULAR.NUMCREDITOS,
       ANALISECURRICULAR.CH,
       ANALISECURRICULAR.NOTA,
       ANALISECURRICULAR.FALTAS,
       ANALISECURRICULAR.TIPO,
       ANALISECURRICULAR.CODCOLIGADA,
       ANALISECURRICULAR.IDHABILITACAOFILIAL,
       ANALISECURRICULAR.RA,
       ANALISECURRICULAR.GREQUIV,
       ANALISECURRICULAR.CODPERIODO,
       ANALISECURRICULAR.CONCEITO,
       ANALISECURRICULAR.CONCEITOECTS,
       ANALISECURRICULAR.MINCH,
       ANALISECURRICULAR.MINCREDITOS,
       ANALISECURRICULAR.MINDISCIPLINAS,
       ANALISECURRICULAR.NOME,
       ANALISECURRICULAR.TIPOAVALIACAO,
       PPESSOA.NOME AS NOMEALUNO
FROM   (SELECT SHISTDISCCONCLUIDAS.CODDISC,
               SHISTDISCCONCLUIDAS.DISCIPLINA,
               SHISTDISCCONCLUIDAS.STATUS,
               SHISTDISCCONCLUIDAS.PLETIVO,
               SHISTDISCCONCLUIDAS.NUMCREDITOS,
               SHISTDISCCONCLUIDAS.CH,
               SHISTDISCCONCLUIDAS.NOTA,
               SHISTDISCCONCLUIDAS.FALTAS,
               'CONC' AS TIPO,
               SHISTDISCCONCLUIDAS.CODCOLIGADA,
               SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
               SHISTDISCCONCLUIDAS.RA,
               SHISTDISCCONCLUIDAS.GREQUIV,
               SHISTDISCCONCLUIDAS.CODPERIODO,
               SHISTDISCCONCLUIDAS.CONCEITO,
               SHISTDISCCONCLUIDAS.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCCONCLUIDAS (NOLOCK)
       INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
       WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = :CODCOLIGADA
          AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO
          AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0
        UNION
        SELECT SHISTDISCPENDENTES.CODDISC,
               SHISTDISCPENDENTES.DISCIPLINA,
               SHISTDISCPENDENTES.STATUS,
               SHISTDISCPENDENTES.PLETIVO,
               SHISTDISCPENDENTES.NUMCREDITOS,
               SHISTDISCPENDENTES.CH,
               SHISTDISCPENDENTES.NOTA,
               SHISTDISCPENDENTES.FALTAS,
               'PEND' AS TIPO,
               SHISTDISCPENDENTES.CODCOLIGADA,
               SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
               SHISTDISCPENDENTES.RA,
               SHISTDISCPENDENTES.GREQUIV,
               SHISTDISCPENDENTES.CODPERIODO,
               SHISTDISCPENDENTES.CONCEITO,
               SHISTDISCPENDENTES.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCPENDENTES (NOLOCK)
        INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHISTDISCPENDENTES.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
        WHERE  SHISTDISCPENDENTES.CODCOLIGADA = :CODCOLIGADA
           AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO              
           AND SHISTDISCPENDENTES.CODPERIODO <> 0

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELET.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELET.MINCH,
               SGRUPOOPTELET.MINCREDITOS,
               SGRUPOOPTELET.MINDISCIPLINAS,
               SGRUPOOPTELET.NOME,
               SGRUPOOPTELET.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :CODCOLIGADA )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL 
                      AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO )
               JOIN SGRUPOOPTELET (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
                      AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
                      AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
                      AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
               JOIN SDISCGRUPOOPTELET (NOLOCK)
                 ON ( SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
                      AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
                      AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
                      AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
                      AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELET.EXIBEANALISE = 'S'
               AND SGRADEALUNO.RA IS NULL
               AND SHISTDISCOPTELETIVAS.RA NOT IN (SELECT SCOMPONENTECURRALUNO.RA
                                                   FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                   WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)
        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELETALUNO.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELETALUNO.MINCH,
               SGRUPOOPTELETALUNO.MINCREDITOS,
               SGRUPOOPTELETALUNO.MINDISCIPLINAS,
               SGRUPOOPTELETALUNO.NOME,
               SGRUPOOPTELETALUNO.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :CODCOLIGADA )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                      AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO )
               JOIN SGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
               JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
                      AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
               AND ( SGRADEALUNO.RA IS NOT NULL
                      OR SHISTDISCOPTELETIVAS.RA IN (SELECT SCOMPONENTECURRALUNO.RA
                                                     FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                     WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                            AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                            AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA) )) ANALISECURRICULAR
 LEFT JOIN SALUNO ON SALUNO.CODCOLIGADA = ANALISECURRICULAR.CODCOLIGADA AND SALUNO.RA = ANALISECURRICULAR.RA
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
ORDER  BY ANALISECURRICULAR.RA,
          ANALISECURRICULAR.CODPERIODO,
          ANALISECURRICULAR.NOME";11436;;;;30/11/2021;raphael.muzy;0;1;1;1;;;;0;3919412f-b416-4f9d-8202-e82337085350;0;;8266;raphael.muzy;29/11/2021;raphael.muzy;30/11/2021;0
G;TOTALDISCAP.0001;Total de disciplinas aprovadas e reprovadas;"/*Total de disciplinas aprovadas e reprovadas */
SELECT   
  SSTATUS.DESCRICAO, APROVADO = SUM(CASE WHEN SSTATUS.APROVADO = 'S' THEN 1 ELSE 0 END) +
                               SUM(CASE WHEN SSTATUS.APROVADO = 'N' THEN 1 ELSE 0 END)
FROM   
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA,
  SPLETIVO
WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUSRES = SSTATUS.CODSTATUS AND
  SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND
  SPLETIVO.IDPERLET = SMATRICULA.IDPERLET AND
  SMATRICULA.CODCOLIGADA = :CODCOLIGADA AND 
  SMATRICULA.RA = :RA AND
  SPLETIVO.CODPERLET = :CODPERLET   
GROUP BY
  SSTATUS.DESCRICAO
  
  ";892;0;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;28205;RM;30/05/2012;RM;30/05/2012;
G;TOTVSIP.022;FORMANDOS;"
SELECT DISTINCT SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
 /* SMATRICPL.IDPERLET,
   SPLETIVO.CODPERLET,
 */
 SGRADE.CARGAHORARIA,
 SHABILITACAOFILIAL.CODTIPOCURSO,
  SMATRICPL.RA,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  PPESSOA.NOME AS NOMEALUNO,

  STIPOCURSO.APRESENTACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  SHABILITACAOFILIAL.CODCURSO,
  shabilitacaoaluno.dtcolacaograu
FROM SMATRICPL (NOLOCK) JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN GFILIAL (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)
   JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                         AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                         AND SHABILITACAOALUNO.RA = SMATRICPL.RA
 INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                  AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
                  AND SGRADE.CODGRADE= SHABILITACAOFILIAL.CODGRADE                         
   JOIN SPLETIVO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)    
   JOIN STIPOCURSO (NOLOCK)
     ON (SPLETIVO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND SPLETIVO.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICPL.RA = SALUNO.RA)
   JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)         
WHERE SMATRICPL.CODCOLIGADA = :$CODCOLIGADA
  AND SHABILITACAOFILIAL.CODFILIAL = :$CODFILIAL
  AND SHABILITACAOFILIAL.CODCURSO BETWEEN :CODCURSODE_S AND :CODCURSOATE_S
  and SHABILITACAOFILIAL.CODTIPOCURSO like :NIVELENSINO_S
  AND SMATRICPL.CODSTATUS = 2
/*  AND SSTATUS.DIINCALUNODISC = 'S'
ORDER BY SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.IDPERLET,
  PPESSOA.NOME   */
";2981;;;;03/05/2022;edison.pitoli;0;1;1;1;;;;0;d65babb9-fe55-4b64-bcac-5eb5b0ffb5a2;0;;-2321;edison.pitoli;03/05/2022;edison.pitoli;03/05/2022;0
H;ATEN.003;Email Atendente Anterior;"SELECT TOP 1
	HATENDENTE.CODATENDENTE,
	PPESSOA.EMAIL
FROM
	HHISTORICOETAPASATENDIMENTO (NOLOCK)
	INNER JOIN HATENDENTE (NOLOCK) ON HHISTORICOETAPASATENDIMENTO.CODCOLIGADA = HATENDENTE.CODCOLIGADA AND HHISTORICOETAPASATENDIMENTO.CODATENDENTEANTERIOR=HATENDENTE.CODATENDENTE
	INNER JOIN PPESSOA (NOLOCK) ON HATENDENTE.CODPESSOA=PPESSOA.CODIGO
WHERE
	HHISTORICOETAPASATENDIMENTO.CODCOLIGADA = :FRM_COLIGADA
	AND HHISTORICOETAPASATENDIMENTO.CODLOCAL = :FRM_CODLOCAL
	AND HHISTORICOETAPASATENDIMENTO.CODATENDIMENTO = :FRM_CODATEND
ORDER BY
	IDHISTORICOETAPAS DESC

";575;;;;06/07/2021;maycon;0;1;1;1;;;;0;4ccf7c0b-dd62-4a2e-b1f1-ebc148b59785;0;;29805;maycon;06/07/2021;maycon;06/07/2021;0
H;ATEN.008;Codigo e Email do Solicitante;"SELECT
	HATENDENTE.CODATENDENTE,
	PPESSOA.EMAIL
FROM
	HATENDIMENTOBASE (NOLOCK)
	INNER JOIN HATENDENTE (NOLOCK) ON HATENDIMENTOBASE.CODCOLIGADA = HATENDENTE.CODCOLIGADA AND HATENDIMENTOBASE.CODATENDENTE=HATENDENTE.CODATENDENTE
	INNER JOIN PPESSOA (NOLOCK) ON HATENDENTE.CODPESSOA=PPESSOA.CODIGO
WHERE
	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND

";460;;;;08/07/2021;maycon;0;1;1;1;;;;0;b961479f-417d-4690-af70-4174df163a5f;0;;13081;maycon;08/07/2021;maycon;08/07/2021;0
H;EDU.ATEND.001;Total de Status por Atendimento;"

SELECT
	HTIPOATENDIMENTO.NOME AS 'ATENDIMENTO',
	ISNULL(CONFIRMADO.TCONFIRMADO,0) AS 'TCONFIRMADO',
	ISNULL(CONCLUIDO.TCONCLUIDO,0) AS 'TCONCLUIDO',
	ISNULL(ANDAMENTO.TANDAMENTO,0) AS 'TANDAMENTO',
	ISNULL(CANCELADO.TCANCELADO,0) AS 'TCANCELADO'

FROM HTIPOATENDIMENTO (NOLOCK)

LEFT JOIN (
SELECT
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODTIPOATENDIMENTO,
	COUNT(HATENDIMENTOBASE.CODATENDIMENTO) AS TCONFIRMADO
FROM HATENDIMENTOBASE (NOLOCK)
WHERE HATENDIMENTOBASE.CODSTATUS = 'F'
AND HATENDIMENTOBASE.ABERTURA BETWEEN :DTINI_D AND :DTFIM_D
GROUP BY
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODTIPOATENDIMENTO
) AS CONFIRMADO ON CONFIRMADO.CODCOLIGADA = HTIPOATENDIMENTO.CODCOLIGADA
	AND CONFIRMADO.CODTIPOATENDIMENTO = HTIPOATENDIMENTO.CODTIPOATENDIMENTO


LEFT JOIN (
SELECT
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODTIPOATENDIMENTO,
	COUNT(HATENDIMENTOBASE.CODATENDIMENTO) AS TCONCLUIDO
FROM HATENDIMENTOBASE (NOLOCK)
WHERE HATENDIMENTOBASE.CODSTATUS = 'R'
AND HATENDIMENTOBASE.ABERTURA BETWEEN :DTINI_D AND :DTFIM_D
GROUP BY
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODTIPOATENDIMENTO
) AS CONCLUIDO ON CONCLUIDO.CODCOLIGADA = HTIPOATENDIMENTO.CODCOLIGADA
	AND CONCLUIDO.CODTIPOATENDIMENTO = HTIPOATENDIMENTO.CODTIPOATENDIMENTO


LEFT JOIN (
SELECT
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODTIPOATENDIMENTO,
	COUNT(HATENDIMENTOBASE.CODATENDIMENTO) AS TCANCELADO
FROM HATENDIMENTOBASE (NOLOCK)
WHERE HATENDIMENTOBASE.CODSTATUS = 'C'
AND HATENDIMENTOBASE.ABERTURA BETWEEN :DTINI_D AND :DTFIM_D
GROUP BY
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODTIPOATENDIMENTO
) AS CANCELADO ON CANCELADO.CODCOLIGADA = HTIPOATENDIMENTO.CODCOLIGADA
	AND CANCELADO.CODTIPOATENDIMENTO = HTIPOATENDIMENTO.CODTIPOATENDIMENTO



LEFT JOIN (
SELECT
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODTIPOATENDIMENTO,
	COUNT(HATENDIMENTOBASE.CODATENDIMENTO) AS TANDAMENTO
FROM HATENDIMENTOBASE (NOLOCK)
WHERE HATENDIMENTOBASE.CODSTATUS = 'A'
AND HATENDIMENTOBASE.ABERTURA BETWEEN :DTINI_D AND :DTFIM_D
GROUP BY
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODTIPOATENDIMENTO
) AS ANDAMENTO ON ANDAMENTO.CODCOLIGADA = HTIPOATENDIMENTO.CODCOLIGADA
	AND ANDAMENTO.CODTIPOATENDIMENTO = HTIPOATENDIMENTO.CODTIPOATENDIMENTO

WHERE HTIPOATENDIMENTO.IDDLL = 10
ORDER BY 1";2377;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;1;bce4215c-4b97-4d3e-b454-115d147155b9;0;;32162;consultor1.totvs;22/08/2022;consultor1.totvs;22/08/2022;0
H;EDU.ATEND.002;Histórico de Atendimentos Concluidos;"SELECT 
	PPESSOA.NOME AS 'ATENDENTE',
	CONVERT(VARCHAR,HSTATUSATEND.DATA,103) AS DATAULTIMOREPASSE,
	CONVERT(VARCHAR,HATENDIMENTOBASE.ABERTURA,103) AS 'DTABERTURA',
	HATENDIMENTOBASE.CODATENDIMENTO,
	HATENDIMENTOBASE.CODCOLIGADA,
	HATENDIMENTOBASE.CODLOCAL,
	HTIPOATENDIMENTO.NOME AS 'TIPO ATENDIMENTO'
FROM HATENDIMENTOBASE (NOLOCK)
INNER JOIN HSTATUSATEND (NOLOCK) ON HSTATUSATEND.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
AND HSTATUSATEND.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
AND HSTATUSATEND.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
INNER JOIN HTIPOATENDIMENTO (NOLOCK) ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
INNER JOIN HATENDENTE (NOLOCK) ON HATENDENTE.CODCOLIGADA = HSTATUSATEND.CODCOLIGADA
	AND HATENDENTE.CODATENDENTE = HSTATUSATEND.CODATENDENTE
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA
AND HSTATUSATEND.CODSTATUS = 'F'
WHERE HSTATUSATEND.DATA BETWEEN :DTINI_D + ' 00:00:00.000' AND :DTFIM_D + ' 23:59:59.000'";1075;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;1;f0fc96cc-de23-48a3-b340-21ea2ed0f14d;0;;-31327;consultor1.totvs;22/08/2022;consultor1.totvs;22/08/2022;0
H;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
H;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
H;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
H;Email. Conteudo;Texto no corpo do e-mail;"SELECT


'Olá,

 Existem um novo atendimento na sua fila de atendimentos:
 
 Atendimento: ' + CAST(HATENDIMENTOBASE.CODATENDIMENTO AS VARCHAR(6))  TEXTO

FROM 

 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HLOCALIDADE (NOLOCK)		ON HLOCALIDADE.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 
 INNER JOIN HTIPOATENDIMENTO (NOLOCK)	ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
 
 
WHERE 	HATENDIMENTOBASE.CODCOLIGADA = 1 /*:FRM_COLIGADA*/
	AND HATENDIMENTOBASE.CODLOCAL = 1 /*:FRM_CODLOCAL*/
	AND HATENDIMENTOBASE.CODATENDIMENTO = 62 /*:FRM_CODATEND*/
	";670;;;;19/05/2021;mestre;0;1;1;1;;;;0;54f07af3-7ab9-494e-8d94-2848e1b8b511;;;10924;mestre;19/05/2021;mestre;19/05/2021;
H;Email.Grupo1;Lista de e-mail (Grupo Secretaria);"with Consulta as (
       
       SELECT
        PPESSOA.EMAIL

       FROM 
		HATENDIMENTOBASE (NOLOCK)
		
 		INNER JOIN HLOCALENTREGA (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
 									   		   HATENDIMENTOBASE.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND
 									   		   HATENDIMENTOBASE.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA

		INNER JOIN HATENDENTEGRUPO (NOLOCK)	ON HATENDENTEGRUPO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
											   HATENDENTEGRUPO.CODGRUPO = 1

		INNER JOIN HATENDENTE (NOLOCK)		ON HATENDENTE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
											   HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE AND
											   (HATENDENTE.CODLOCAL = HLOCALENTREGA.CODLOCAL OR
											    HATENDENTE.CODLOCAL = 5)
											   

		INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA AND
											   PPESSOA.EMAIL IS NOT NULL
													   
	   WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
			AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
			AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND


/*
       SELECT

             PPESSOA.EMAIL

       FROM HATENDENTEGRUPO (NOLOCK)

             LEFT JOIN HATENDENTE (NOLOCK) ON HATENDENTE.CODCOLIGADA = HATENDENTEGRUPO.CODCOLIGADA AND HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE

             LEFT JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA

       WHERE

             HATENDENTEGRUPO.CODGRUPO = 1 and ppessoa.email is not null
*/
)

SELECT string_agg (EMAIL, ';') as Email

  from Consulta";1634;;;;19/07/2021;mestre;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;-30739;mestre;19/05/2021;mestre;19/07/2021;0
H;Email.Grupo15;Lista de e-mail (Grupo Centro de Experiências Profissionais);"with Consulta as (
       
       SELECT
        PPESSOA.EMAIL,
        HATENDENTEGRUPO.CODGRUPO

       FROM 
		HATENDIMENTOBASE (NOLOCK)
		
 		INNER JOIN HLOCALENTREGA (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
 									   		   HATENDIMENTOBASE.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND
 									   		   HATENDIMENTOBASE.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA

		INNER JOIN HATENDENTEGRUPO (NOLOCK)	ON HATENDENTEGRUPO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
											   HATENDENTEGRUPO.CODGRUPO IN (15, 16, 17, 18)

		INNER JOIN HATENDENTE (NOLOCK)		ON HATENDENTE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
											   HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE AND
											   (HATENDENTE.CODLOCAL = HLOCALENTREGA.CODLOCAL OR
											    HATENDENTE.CODLOCAL = 5)
											   

		INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA AND
											   PPESSOA.EMAIL IS NOT NULL
													   
	   WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
			AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
			AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND

)

SELECT CODGRUPO, string_agg (EMAIL, ';') as Email

  from Consulta
  
GROUP BY CODGRUPO";1287;;;;27/10/2021;robson.canto;0;1;1;1;;;;0;25d20868-6802-4550-a778-3b9285e4f6da;0;;6136;robson.canto;27/10/2021;robson.canto;27/10/2021;0
H;Email.Grupo2;Lista de e-mail (Grupo Central de Atendimento);"with Consulta as (
       
       SELECT
        PPESSOA.EMAIL,
        HATENDENTEGRUPO.CODGRUPO

       FROM 
		HATENDIMENTOBASE (NOLOCK)
		
 		INNER JOIN HLOCALENTREGA (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
 									   		   HATENDIMENTOBASE.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND
 									   		   HATENDIMENTOBASE.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA

		INNER JOIN HATENDENTEGRUPO (NOLOCK)	ON HATENDENTEGRUPO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
											   /*HATENDENTEGRUPO.CODGRUPO IN (2, 5, 6, 10)*/
											   HATENDENTEGRUPO.CODGRUPO = (2)
											   							/*SELECT MODIFICADO POIS NÃO SERÁ 1 GRUPO PARA CADA FILIAL PARA A CENTRAL, FOI CRIADO UM GRUPO GERAL PARA TODOS
											   							    CASE WHEN HLOC.CODLOCAL = 1 THEN 2
											   							    	 WHEN HLOC.CODLOCAL = 2 THEN 5
											   							    	 WHEN HLOC.CODLOCAL = 3 THEN 6
											   							    	 WHEN HLOC.CODLOCAL = 4 THEN 10 END
											   							    	 
											   							   FROM
											   							    HLOCALENTREGA HLOC (NOLOCK) 
											   							    
											   							   WHERE	HLOC.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA
											   							   		AND HLOC.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO
											   							   		AND HLOC.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA)*/
											   
		INNER JOIN HATENDENTE (NOLOCK)		ON HATENDENTE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
											   HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE AND
											   (HATENDENTE.CODLOCAL = HLOCALENTREGA.CODLOCAL OR
											    HATENDENTE.CODLOCAL = 5)
											   

		INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA AND
											   PPESSOA.EMAIL IS NOT NULL
													   
	   WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
			AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
			AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND

)

SELECT CODGRUPO, string_agg (EMAIL, ';') as Email

  from Consulta
  
GROUP BY CODGRUPO";2116;;;;11/10/2022;totvs.nathan;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;-4564;robson.canto;20/09/2021;totvs.nathan;11/10/2022;0
H;Email.Grupo2.1;Lista de e-mail (Grupo Pós);"with Consulta as (
       
       SELECT
        PPESSOA.EMAIL,
        HATENDENTEGRUPO.CODGRUPO

       FROM 
		HATENDIMENTOBASE (NOLOCK)
		
 		INNER JOIN HLOCALENTREGA (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
 									   		   HATENDIMENTOBASE.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND
 									   		   HATENDIMENTOBASE.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA

		INNER JOIN HATENDENTEGRUPO (NOLOCK)	ON HATENDENTEGRUPO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
											   /*HATENDENTEGRUPO.CODGRUPO IN (2, 5, 6, 10)*/
											   HATENDENTEGRUPO.CODGRUPO = (SELECT
											   							    CASE WHEN HLOC.CODLOCAL = 1 THEN 24
											   							    	 WHEN HLOC.CODLOCAL = 2 THEN 22
											   							    	 WHEN HLOC.CODLOCAL = 3 THEN 23
											   							    	 WHEN HLOC.CODLOCAL = 4 THEN 25 END
											   							    	 
											   							   FROM
											   							    HLOCALENTREGA HLOC (NOLOCK) 
											   							    
											   							   WHERE	HLOC.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA
											   							   		AND HLOC.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO
											   							   		AND HLOC.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA)
											   
		INNER JOIN HATENDENTE (NOLOCK)		ON HATENDENTE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
											   HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE AND
											   (HATENDENTE.CODLOCAL = HLOCALENTREGA.CODLOCAL OR
											    HATENDENTE.CODLOCAL = 5)
											   

		INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA AND
											   PPESSOA.EMAIL IS NOT NULL
													   
	   WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
			AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
			AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND

)

SELECT CODGRUPO, string_agg (EMAIL, ';') as Email

  from Consulta
  
GROUP BY CODGRUPO";1987;;;;27/04/2022;consultor1.totvs;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;10200;consultor1.totvs;27/04/2022;consultor1.totvs;27/04/2022;0
H;Email.Grupo21;Lista de e-mail (Grupo Processo Seletivo);"with Consulta as (

       SELECT

             PPESSOA.EMAIL

       FROM HATENDENTEGRUPO (NOLOCK)

             LEFT JOIN HATENDENTE (NOLOCK) ON HATENDENTE.CODCOLIGADA = HATENDENTEGRUPO.CODCOLIGADA AND HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE

             LEFT JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA

       WHERE

             HATENDENTEGRUPO.CODGRUPO = 21 and ppessoa.email is not null

)

SELECT string_agg (EMAIL, ';') as Email

  from Consulta";509;;;;08/07/2021;maycon;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;-8319;maycon;08/07/2021;maycon;08/07/2021;0
H;Email.Grupo3;Lista de e-mail (Grupo Financeiro);"with Consulta as (

       SELECT
        PPESSOA.EMAIL

       FROM 
		HATENDIMENTOBASE (NOLOCK)
		
 		INNER JOIN HLOCALENTREGA (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
 									   		   HATENDIMENTOBASE.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND
 									   		   HATENDIMENTOBASE.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA

		INNER JOIN HATENDENTEGRUPO (NOLOCK)	ON HATENDENTEGRUPO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
											   HATENDENTEGRUPO.CODGRUPO = 3

		INNER JOIN HATENDENTE (NOLOCK)		ON HATENDENTE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
											   HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE AND
											   (HATENDENTE.CODLOCAL = HLOCALENTREGA.CODLOCAL OR
											    HATENDENTE.CODLOCAL = 5)
											   

		INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA AND
											   PPESSOA.EMAIL IS NOT NULL
													   
	   WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
			AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
			AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND

/*
       SELECT

             PPESSOA.EMAIL

       FROM HATENDENTEGRUPO (NOLOCK)

             LEFT JOIN HATENDENTE (NOLOCK) ON HATENDENTE.CODCOLIGADA = HATENDENTEGRUPO.CODCOLIGADA AND HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE

             LEFT JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA

       WHERE

             HATENDENTEGRUPO.CODGRUPO = 3 and ppessoa.email is not null
*/

)

SELECT string_agg (EMAIL, ';') as Email

  from Consulta";1627;;;;05/10/2021;robson.canto;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;-4517;maycon;08/07/2021;robson.canto;05/10/2021;0
H;Email.Grupo34;Lista de e-mail (Grupo Assessoria Reitoria);"with Consulta as (

       SELECT

             PPESSOA.EMAIL

       FROM HATENDENTEGRUPO (NOLOCK)

             LEFT JOIN HATENDENTE (NOLOCK) ON HATENDENTE.CODCOLIGADA = HATENDENTEGRUPO.CODCOLIGADA AND HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE

             LEFT JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA

       WHERE

             HATENDENTEGRUPO.CODGRUPO = 34 and ppessoa.email is not null

)

SELECT string_agg (EMAIL, ';') as Email

  from Consulta";509;;;;06/07/2021;maycon;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;7096;maycon;06/07/2021;maycon;08/07/2021;0
H;Email.Grupo35;Lista de e-mail (Grupo Departamento Pessoal);"with Consulta as (

       SELECT

             PPESSOA.EMAIL

       FROM HATENDENTEGRUPO (NOLOCK)

             LEFT JOIN HATENDENTE (NOLOCK) ON HATENDENTE.CODCOLIGADA = HATENDENTEGRUPO.CODCOLIGADA AND HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE

             LEFT JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA

       WHERE

             HATENDENTEGRUPO.CODGRUPO = 35 and ppessoa.email is not null

)

SELECT string_agg (EMAIL, ';') as Email

  from Consulta";509;;;;08/07/2021;maycon;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;-6791;maycon;08/07/2021;maycon;08/07/2021;0
H;Email.Grupo36;Lista de e-mail (Grupo Contabilidade);"with Consulta as (

       SELECT

             PPESSOA.EMAIL

       FROM HATENDENTEGRUPO (NOLOCK)

             LEFT JOIN HATENDENTE (NOLOCK) ON HATENDENTE.CODCOLIGADA = HATENDENTEGRUPO.CODCOLIGADA AND HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE

             LEFT JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA

       WHERE

             HATENDENTEGRUPO.CODGRUPO = 36 and ppessoa.email is not null

)

SELECT string_agg (EMAIL, ';') as Email

  from Consulta";509;;;;08/07/2021;maycon;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;-9302;maycon;08/07/2021;maycon;08/07/2021;0
H;Email.Grupo37;Lista de e-mail (Grupo PROAD);"with Consulta as (
       
       SELECT
        PPESSOA.EMAIL,
        HATENDENTEGRUPO.CODGRUPO

       FROM 
		HATENDIMENTOBASE (NOLOCK)
		
 		INNER JOIN HLOCALENTREGA (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
 									   		   HATENDIMENTOBASE.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND
 									   		   HATENDIMENTOBASE.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA

		INNER JOIN HATENDENTEGRUPO (NOLOCK)	ON HATENDENTEGRUPO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
											   /*HATENDENTEGRUPO.CODGRUPO IN (2, 5, 6, 10)*/
											   HATENDENTEGRUPO.CODGRUPO = (SELECT
											   							    CASE WHEN HLOC.CODLOCAL = 1 THEN 37
											   							    	 WHEN HLOC.CODLOCAL = 2 THEN 38
											   							    	 WHEN HLOC.CODLOCAL = 3 THEN 39
											   							    	 WHEN HLOC.CODLOCAL = 4 THEN 40 END
											   							    	 
											   							   FROM
											   							    HLOCALENTREGA HLOC (NOLOCK) 
											   							    
											   							   WHERE	HLOC.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA
											   							   		AND HLOC.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO
											   							   		AND HLOC.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA)
											   
		INNER JOIN HATENDENTE (NOLOCK)		ON HATENDENTE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
											   HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE AND
											   (HATENDENTE.CODLOCAL = HLOCALENTREGA.CODLOCAL OR
											    HATENDENTE.CODLOCAL = 5)
											   

		INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA AND
											   PPESSOA.EMAIL IS NOT NULL
													   
	   WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
			AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
			AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND

)

SELECT CODGRUPO, string_agg (EMAIL, ';') as Email

  from Consulta
  
GROUP BY CODGRUPO";1987;;;;24/02/2022;robson.canto;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;16964;robson.canto;24/02/2022;robson.canto;24/02/2022;0
H;Email.Grupo47;Lista de e-mail (Grupo Cursos Livres);"with Consulta as (
       
       SELECT
        PPESSOA.EMAIL,
        HATENDENTEGRUPO.CODGRUPO

       FROM 
		HATENDIMENTOBASE (NOLOCK)
		
 		INNER JOIN HLOCALENTREGA (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
 									   		   HATENDIMENTOBASE.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND
 									   		   HATENDIMENTOBASE.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA

		INNER JOIN HATENDENTEGRUPO (NOLOCK)	ON HATENDENTEGRUPO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
											   HATENDENTEGRUPO.CODGRUPO IN (47, 48, 49, 50) AND
											   HATENDENTEGRUPO.CODGRUPO = (SELECT 
											   							    CASE WHEN HLOC.CODLOCAL = 1 THEN 47
											   							    	 WHEN HLOC.CODLOCAL = 2 THEN 48
											   							    	 WHEN HLOC.CODLOCAL = 3 THEN 49
											   							    	 WHEN HLOC.CODLOCAL = 7 THEN 50 END
											   							    	 
											   							   FROM
											   							    HLOCALENTREGA HLOC (NOLOCK) 
											   							    
											   							   WHERE	HLOC.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA
											   							   		AND HLOC.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO
											   							   		AND HLOC.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA)
											   
		INNER JOIN HATENDENTE (NOLOCK)		ON HATENDENTE.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND
											   HATENDENTE.CODATENDENTE = HATENDENTEGRUPO.CODATENDENTE AND
											   (HATENDENTE.CODLOCAL = HLOCALENTREGA.CODLOCAL OR
											    HATENDENTE.CODLOCAL = 5)
											   

		INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA AND
											   PPESSOA.EMAIL IS NOT NULL
													   
	   WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
			AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
			AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND

)

SELECT CODGRUPO, string_agg (EMAIL, ';') as Email

  from Consulta
  
GROUP BY CODGRUPO";1991;;;;27/10/2022;robson.canto;0;1;1;1;;;;0;2d21fd82-da62-422d-b29e-a76ee105f357;0;;28480;robson.canto;27/10/2022;robson.canto;27/10/2022;0
H;IP001;E-mail do Aluno;"SELECT
 PPESSOA.EMAIL,
 HTIPOATENDIMENTO.NOME ASSUNTO
 
FROM
 HATENDIMENTOEXT (NOLOCK)
 
 INNER JOIN SALUNO (NOLOCK)				ON HATENDIMENTOEXT.CODCOLIGADA = SALUNO.CODCOLIGADA AND
 								   		   HATENDIMENTOEXT.RAALUNO = SALUNO.RA
 								   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA  								   
 
 LEFT JOIN HATENDIMENTOBASE (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HATENDIMENTOEXT.CODCOLIGADA AND
 										   HATENDIMENTOBASE.CODLOCAL = HATENDIMENTOEXT.CODLOCAL AND
 										   HATENDIMENTOBASE.CODATENDIMENTO = HATENDIMENTOEXT.CODATENDIMENTO
 										   
 LEFT JOIN HTIPOATENDIMENTO (NOLOCK)	ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
 
WHERE 	HATENDIMENTOEXT.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOEXT.CODATENDIMENTO = :FRM_CODATEND
	AND HATENDIMENTOEXT.CODLOCAL = :FRM_CODLOCAL	";958;;;;09/05/2022;robson.canto;0;1;1;1;;;;0;74db42cf-adeb-4955-9c15-abb5f4ac1914;0;;4062;mestre;04/03/2021;robson.canto;09/05/2022;0
H;IP002;Localiza Professor Titular do Período Letivo Anterior;"SELECT DISTINCT 
 SPROFESSOR.CODPROF,
 PPESSOA.NOME

FROM 
 SMATRICULA (NOLOCK)

 INNER JOIN STURMADISC (NOLOCK)		ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
									   SMATRICULA.IDPERLET = STURMADISC.IDPERLET AND
									   SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC 
									   
 INNER JOIN SDISCIPLINA (NOLOCK)	ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
									   STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
 									   STURMADISC.CODDISC = :FRM_PAR.001

 LEFT JOIN SPROFESSORTURMA (NOLOCK)			ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 											   SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC AND
 											   SPROFESSORTURMA.TIPOPROF = 'T' 											   
 
 LEFT JOIN SPROFESSOR (NOLOCK)				ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND 
 											   SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF   
 											   
 LEFT JOIN PPESSOA (NOLOCK)					ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA


WHERE 	SMATRICULA.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICULA.RA = :RA
	AND SMATRICULA.IDHABILITACAOFILIAL = (SELECT TOP 1
										   SMATRICPL.IDHABILITACAOFILIAL

										  FROM
										   SMATRICPL (NOLOCK)

										   INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
																					   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

										  WHERE SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
											AND SMATRICPL.RA = SMATRICULA.RA
											AND SHABILITACAOFILIAL.CODCURSO = (SELECT
																			    SHABILITACAOFILIAL.CODCURSO
 
																			   FROM
																				SHABILITACAOFILIAL (NOLOCK)
 
																			   WHERE	SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA
																					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL)

											AND SMATRICPL.IDPERLET <> :IDPERLET
										  
										  ORDER BY SMATRICPL.IDPERLET
										)

";2024;;;;02/02/2022;robson.canto;0;1;1;1;;;;0;1faf456d-f070-44da-aa12-f59a00290711;0;;6643;robson.canto;02/02/2022;robson.canto;02/02/2022;0
H;IP003;Código do Atendimento;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO
 
FROM
 HATENDIMENTOBASE (NOLOCK)
 
WHERE	HATENDIMENTOBASE.CODCOLIGADA = :CODCOLIGADA
	AND HATENDIMENTOBASE.CODLOCAL = :CODLOCAL
	AND HATENDIMENTOBASE.CODATENDIMENTO = :CODATENDIMENTO";292;;;;09/05/2022;robson.canto;0;1;1;1;;;;0;73d0372a-6fad-4e0f-b0c3-38b603ca30c8;0;;9898;robson.canto;09/05/2022;robson.canto;09/05/2022;0
H;MOV.001;Envia E-mail de Aviso;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO
 
FROM
 HATENDIMENTOBASE (NOLOCK)
 
WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	/*
	AND HATENDIMENTOBASE.CODATENDIMENTO = 10*/";330;;;;03/02/2021;mestre;0;1;1;1;;;;0;4e246596-5a66-4e0a-98aa-98e44fcb4ae3;0;;-22893;mestre;03/02/2021;mestre;03/02/2021;0
H;MOV.002;Declaração de Matrícula - Envia para Secretaria após Pagto;"SELECT
 SPARCELASOLICITACAO.CODCOLIGADA,
 SPARCELASOLICITACAO.CODLOCAL,
 SPARCELASOLICITACAO.CODATENDIMENTO

FROM
 SPARCELASOLICITACAO (NOLOCK)
 
 INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 									   	   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA
 									   
 INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   	   SLAN.IDPARCELA = SPARCELA.IDPARCELA  									   
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 									   	   FLAN.IDLAN = SLAN.IDLAN 
 									   
 INNER JOIN HATENDIMENTOBASE (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADAATEND AND 
 										   HATENDIMENTOBASE.CODATENDIMENTO = SPARCELASOLICITACAO.CODATENDIMENTO AND 
 										   HATENDIMENTOBASE.CODLOCAL = SPARCELASOLICITACAO.CODLOCAL
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 8
	AND HATENDIMENTOBASE.CODTAREFA = 74
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";1092;;;;26/07/2021;mestre;0;1;1;1;;;;0;c079ddb9-5967-4b28-8133-0bf85f6dde84;0;;1405;mestre;26/07/2021;mestre;26/07/2021;0
H;MOV.003;Histórico Escolar - Envia para Secretaria após Pagto;"SELECT
 SPARCELASOLICITACAO.CODCOLIGADA,
 SPARCELASOLICITACAO.CODLOCAL,
 SPARCELASOLICITACAO.CODATENDIMENTO

FROM
 SPARCELASOLICITACAO (NOLOCK)
 
 INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 									   	   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA
 									   
 INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   	   SLAN.IDPARCELA = SPARCELA.IDPARCELA  									   
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 									   	   FLAN.IDLAN = SLAN.IDLAN 
 									   
 INNER JOIN HATENDIMENTOBASE (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADAATEND AND 
 										   HATENDIMENTOBASE.CODATENDIMENTO = SPARCELASOLICITACAO.CODATENDIMENTO AND 
 										   HATENDIMENTOBASE.CODLOCAL = SPARCELASOLICITACAO.CODLOCAL
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 40
	AND HATENDIMENTOBASE.CODTAREFA = 90
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";1093;;;;21/09/2021;robson.canto;0;1;1;1;;;;0;c079ddb9-5967-4b28-8133-0bf85f6dde84;0;;4310;robson.canto;21/09/2021;robson.canto;21/09/2021;0
H;MOV.004;PLANOS de Ensino (SEMESTRE) - Envia para Secretaria após Pagto;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 13
	AND HATENDIMENTOBASE.CODTAREFA = 130
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;10/02/2022;robson.canto;0;1;1;1;;;;0;9a171295-2391-4431-ad26-6d3aa880bf5d;0;;-4465;robson.canto;10/02/2022;robson.canto;10/02/2022;0
H;MOV.005;SRA - PLANOS de Ensino (DISCIPLINA) - Envia para Secretaria após Pagto;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 16
	AND HATENDIMENTOBASE.CODTAREFA = 131
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;10/02/2022;robson.canto;0;1;1;1;;;;0;9a171295-2391-4431-ad26-6d3aa880bf5d;0;;-1217;robson.canto;10/02/2022;robson.canto;10/02/2022;0
H;MOV.006;Declaração para Fins Específicos pelo Sistema - Envia para a Secretaria;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 49
	AND HATENDIMENTOBASE.CODTAREFA = 137
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;24/02/2022;robson.canto;0;1;1;1;;;;0;9a171295-2391-4431-ad26-6d3aa880bf5d;0;;-2723;robson.canto;24/02/2022;robson.canto;24/02/2022;0
H;MOV.007;Histórico Escolar - Abert. Sistema - Envia para a Secretaria;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 7
	AND HATENDIMENTOBASE.CODTAREFA = 138
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";819;;;;24/02/2022;robson.canto;0;1;1;1;;;;0;9a171295-2391-4431-ad26-6d3aa880bf5d;0;;-9032;robson.canto;24/02/2022;robson.canto;24/02/2022;0
H;MOV.008;2ª Via Diploma de Graduação - Aberto pelo Sistema - Enc. Secretaria;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 50
	AND HATENDIMENTOBASE.CODTAREFA = 141
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;24/02/2022;robson.canto;0;1;1;1;;;;0;9a171295-2391-4431-ad26-6d3aa880bf5d;0;;16184;robson.canto;24/02/2022;robson.canto;24/02/2022;0
H;MOV.009;2ª Via Certificado de Pós Graduação - Abert. Sist. - Enc. Secretaria;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 52
	AND HATENDIMENTOBASE.CODTAREFA = 144
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;24/02/2022;robson.canto;0;1;1;1;;;;0;9a171295-2391-4431-ad26-6d3aa880bf5d;0;;-13933;robson.canto;24/02/2022;robson.canto;24/02/2022;0
H;MOV.010;Solicitação de Carteirinha;"SELECT
 SPARCELASOLICITACAO.CODCOLIGADA,
 SPARCELASOLICITACAO.CODLOCAL,
 SPARCELASOLICITACAO.CODATENDIMENTO

FROM
 SPARCELASOLICITACAO (NOLOCK)
 
 INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 									   	   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA
 									   
 INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   	   SLAN.IDPARCELA = SPARCELA.IDPARCELA  									   
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 									   	   FLAN.IDLAN = SLAN.IDLAN 
 									   
 INNER JOIN HATENDIMENTOBASE (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADAATEND AND 
 										   HATENDIMENTOBASE.CODATENDIMENTO = SPARCELASOLICITACAO.CODATENDIMENTO AND 
 										   HATENDIMENTOBASE.CODLOCAL = SPARCELASOLICITACAO.CODLOCAL
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 32
	AND HATENDIMENTOBASE.CODTAREFA = 51
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";1093;;;;04/03/2022;robson.canto;0;1;1;1;;;;0;32f2ee88-cb90-4132-a1f5-555fcada97b9;0;;23472;robson.canto;04/03/2022;robson.canto;04/03/2022;0
H;MOV.011;Taxa de Envio por Correio - Abert. Sistema;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 56
	AND HATENDIMENTOBASE.CODTAREFA = 166
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;31/03/2022;robson.canto;0;1;1;1;;;;0;9a171295-2391-4431-ad26-6d3aa880bf5d;0;;32576;robson.canto;31/03/2022;robson.canto;31/03/2022;0
H;MOV.012;Plano de Ensino (SEMESTRE);"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 79
	AND HATENDIMENTOBASE.CODTAREFA = 247
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;11/05/2022;consultor1.totvs;0;1;1;1;;;;0;88563e2b-bfda-42ee-b060-17c7586ae63e;0;;-2771;consultor1.totvs;11/05/2022;consultor1.totvs;11/05/2022;0
H;MOV.013;Plano de Ensino (DISCIPLINA);"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 80
	AND HATENDIMENTOBASE.CODTAREFA = 250
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;11/05/2022;consultor1.totvs;0;1;1;1;;;;0;ab29f970-8828-42d9-b593-70deab87b8b9;0;;-30901;consultor1.totvs;11/05/2022;consultor1.totvs;11/05/2022;0
H;MOV.014;Declaração de Matrícula - Cancelamento;"SELECT DISTINCT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO
 
FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN SATENDIMENTO (NOLOCK)			ON SATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 									   		   SATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 									   		   SATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 
 INNER JOIN SPARCELASOLICITACAO  (NOLOCK)	ON SPARCELASOLICITACAO.CODCOLIGADAATEND = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   SPARCELASOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   SPARCELASOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 											   
 INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 											   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA 											   
 											   
 INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SLAN.IDPARCELA = SPARCELA.IDPARCELA
 											   
 INNER JOIN FLAN (NOLOCK)					ON FLAN.IDLAN = SLAN.IDLAN AND 
 											   FLAN.CODCOLIGADA = SLAN.CODCOLIGADA  											   

 INNER JOIN FBOLETO (NOLOCK)				ON FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 											   FBOLETO.IDBOLETO = FLAN.IDBOLETO

 											   
 INNER JOIN STIPOATENDIMENTO (NOLOCK)		ON STIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
 											   STIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND
 											   STIPOATENDIMENTO.AGENDALANCAMENTO = 1
 
 INNER JOIN HTAREFA (NOLOCK)				ON HTAREFA.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HTAREFA.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND 
 											   HTAREFA.CODTAREFA = HATENDIMENTOBASE.CODTAREFA AND
 											   HTAREFA.NOME = 'Aguardando Pagamento'
 
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 0
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 8
	AND FBOLETO.VENCIMENTO <= DATEADD(DD, -7, GETDATE())
	
	";2103;;;;31/05/2022;robson.canto;0;1;1;1;;;;0;0f3027fe-34d9-4ff7-a838-e00a0b094e92;0;;17637;robson.canto;31/05/2022;robson.canto;31/05/2022;0
H;MOV.015;Solicitação de Carteirinha do Aluno - Cancelamento;"SELECT DISTINCT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO
 
FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN SATENDIMENTO (NOLOCK)			ON SATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 									   		   SATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 									   		   SATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 
 INNER JOIN SPARCELASOLICITACAO  (NOLOCK)	ON SPARCELASOLICITACAO.CODCOLIGADAATEND = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   SPARCELASOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   SPARCELASOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 											   
 INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 											   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA 											   
 											   
 INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SLAN.IDPARCELA = SPARCELA.IDPARCELA
 											   
 INNER JOIN FLAN (NOLOCK)					ON FLAN.IDLAN = SLAN.IDLAN AND 
 											   FLAN.CODCOLIGADA = SLAN.CODCOLIGADA  											   

 INNER JOIN FBOLETO (NOLOCK)				ON FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 											   FBOLETO.IDBOLETO = FLAN.IDBOLETO

 											   
 INNER JOIN STIPOATENDIMENTO (NOLOCK)		ON STIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
 											   STIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND
 											   STIPOATENDIMENTO.AGENDALANCAMENTO = 1
 
 INNER JOIN HTAREFA (NOLOCK)				ON HTAREFA.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HTAREFA.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND 
 											   HTAREFA.CODTAREFA = HATENDIMENTOBASE.CODTAREFA AND
 											   HTAREFA.NOME = 'Aguardando Pagamento'
 
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 0
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 32
	AND FBOLETO.VENCIMENTO <= DATEADD(DD, -7, GETDATE())
	
	";2104;;;;31/05/2022;robson.canto;0;1;1;1;;;;0;d59f2622-83dd-4c28-9146-6567a743b5ab;0;;14465;robson.canto;31/05/2022;robson.canto;31/05/2022;0
H;MOV.016;Histórico Escolar - Cancelamento;"SELECT DISTINCT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO
 
FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN SATENDIMENTO (NOLOCK)			ON SATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 									   		   SATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 									   		   SATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 
 INNER JOIN SPARCELASOLICITACAO  (NOLOCK)	ON SPARCELASOLICITACAO.CODCOLIGADAATEND = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   SPARCELASOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   SPARCELASOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 											   
 INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 											   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA 											   
 											   
 INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SLAN.IDPARCELA = SPARCELA.IDPARCELA
 											   
 INNER JOIN FLAN (NOLOCK)					ON FLAN.IDLAN = SLAN.IDLAN AND 
 											   FLAN.CODCOLIGADA = SLAN.CODCOLIGADA  											   

 INNER JOIN FBOLETO (NOLOCK)				ON FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 											   FBOLETO.IDBOLETO = FLAN.IDBOLETO

 											   
 INNER JOIN STIPOATENDIMENTO (NOLOCK)		ON STIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
 											   STIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND
 											   STIPOATENDIMENTO.AGENDALANCAMENTO = 1
 
 INNER JOIN HTAREFA (NOLOCK)				ON HTAREFA.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HTAREFA.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND 
 											   HTAREFA.CODTAREFA = HATENDIMENTOBASE.CODTAREFA AND
 											   HTAREFA.NOME = 'Aguardando Pagamento'
 
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 0
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 40
	AND FBOLETO.VENCIMENTO <= DATEADD(DD, -7, GETDATE())
	
	";2104;;;;31/05/2022;robson.canto;0;1;1;1;;;;0;b443b8f1-ae76-4729-9ccc-9bb091efbdc3;0;;23925;robson.canto;31/05/2022;robson.canto;31/05/2022;0
H;MOV.017;Envio de Atividades Complementares EAD - Arquivos Anexados;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
INNER JOIN HATENDIMENTOARQUIVOSANEXOS (NOLOCK) ON HATENDIMENTOARQUIVOSANEXOS.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
		AND HATENDIMENTOARQUIVOSANEXOS.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
		AND HATENDIMENTOARQUIVOSANEXOS.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 43
	AND HATENDIMENTOBASE.CODTAREFA = 345
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND HATENDIMENTOARQUIVOSANEXOS.CODCOLIGADA IS NOT NULL";653;;;;20/09/2022;consultor1.totvs;0;1;1;1;;;;0;76bda011-0049-4307-b7a9-3dcdbbd2bd51;0;;-29006;consultor1.totvs;20/09/2022;consultor1.totvs;20/09/2022;0
H;MOV.018;Envio de Atividades Complementares EAD - Arquivos Não Anexados;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
LEFT JOIN HATENDIMENTOARQUIVOSANEXOS ON HATENDIMENTOARQUIVOSANEXOS.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
		AND HATENDIMENTOARQUIVOSANEXOS.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
		AND HATENDIMENTOARQUIVOSANEXOS.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 43
	AND HATENDIMENTOBASE.CODTAREFA = 345
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND HATENDIMENTOARQUIVOSANEXOS.CODCOLIGADA IS NULL
	AND  DATEDIFF(DAY,HATENDIMENTOBASE.ABERTURA,GETDATE()) > 6";700;;;;20/09/2022;consultor1.totvs;0;1;1;1;;;;0;d1141ef1-b57b-4862-ba50-3e25fb8b0c49;0;;-9212;consultor1.totvs;20/09/2022;consultor1.totvs;20/09/2022;0
H;MOV.019;Notório Saber - Abert. Sistema;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA,
 HATENDIMENTOBASE.CODLOCAL,
 HATENDIMENTOBASE.CODATENDIMENTO

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)	ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL AND
 										   HPARAMATENDIMENTO.CODPARAMETRO = 10
 
 INNER JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 									   	   FLAN.IDLAN = HPARAMATENDIMENTO.VALOR_INTEIRO 
 									   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1 
	AND HATENDIMENTOBASE.CODTIPOATENDIMENTO = 83
	AND HATENDIMENTOBASE.CODTAREFA = 262
	AND HATENDIMENTOBASE.CODSTATUS = 'A'
	AND FLAN.STATUSLAN = 1";820;;;;20/09/2022;consultor1.totvs;0;1;1;1;;;;0;25233093-f68a-480f-b086-bfccbb97808c;0;;6138;consultor1.totvs;20/09/2022;consultor1.totvs;20/09/2022;0
H;PARAM.001;Cursos;"SELECT DISTINCT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	/*MODIFICADO POR NATHAN PVT - 11/05/2022 - ADICIONADO CURSOS DE TESTE QUE NÃO DEVE APARECER*/
 	AND SCURSO.NOME NOT LIKE '%PENSIO%'
 	AND SCURSO.NOME NOT LIKE '%TESTE%'
 	AND SCURSO.NOME NOT LIKE '%MIGRA%DADO%SIGA%'
 	AND SCURSO.NOME NOT LIKE '%CURSO%DE%CIENCIA%'
 	/*AND SHABILITACAOFILIAL.ATIVO = 'S'*/

)
TABELA /*WHERE*/";744;;;;11/05/2022;consultor1.totvs;0;1;1;1;;;;0;f9b3c54c-fc1b-424e-a45a-0997b6203c91;0;;-11446;mestre;18/01/2021;consultor1.totvs;11/05/2022;0
H;PARAM.001.1;Cursos EAD;"SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	AND SCURSO.CODCURSO LIKE '%EAD%'
)
TABELA /*WHERE*/";456;;;;27/04/2022;consultor1.totvs;0;1;1;1;;;;0;f9b3c54c-fc1b-424e-a45a-0997b6203c91;0;;-10652;consultor1.totvs;27/04/2022;consultor1.totvs;27/04/2022;0
H;PARAM.001.2;Cursos Transferencia;"SELECT DISTINCT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.CODCURSO + ' - ' + SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	
 	AND SCURSO.NOME NOT LIKE '%PENSIO%'
 	AND SCURSO.NOME NOT LIKE '%TESTE%'
 	AND SCURSO.NOME NOT LIKE '%MIGRA%DADO%SIGA%'
 	AND SCURSO.NOME NOT LIKE '%CURSO%DE%CIENCIA%'
 	AND SHABILITACAOFILIAL.ATIVO = 'S'
 	AND SHABILITACAOFILIAL.CODTIPOCURSO = 1

)
TABELA /*WHERE*/
ORDER BY 1";728;;;;31/08/2022;consultor1.totvs;0;1;1;1;;;;0;f9b3c54c-fc1b-424e-a45a-0997b6203c91;0;;-20720;consultor1.totvs;27/04/2022;consultor1.totvs;31/08/2022;0
H;PARAM.001.3;Campus Transferencia;"SELECT DESCRICAO, CODCAMPUS FROM

(SELECT CODCAMPUS, DESCRICAO
FROM SCAMPUS
WHERE TIPOCAMPUS = 1

)
TABELA /*WHERE*/";123;;;;27/04/2022;consultor1.totvs;0;1;1;1;;;;0;f9b3c54c-fc1b-424e-a45a-0997b6203c91;0;;21819;consultor1.totvs;27/04/2022;consultor1.totvs;27/04/2022;0
H;PARAM.001.4;Polos Transferencia;"SELECT DISTINCT DESCRICAO, CODCAMPUS FROM

(SELECT
  CODCAMPUS,DESCRICAO
 
FROM SCAMPUS (NOLOCK)
WHERE ATIVO = 'S'
AND TIPOCAMPUS = 2
)
TABELA /*WHERE*/";161;;;;31/08/2022;consultor1.totvs;0;1;1;1;;;;0;f9b3c54c-fc1b-424e-a45a-0997b6203c91;0;;24941;consultor1.totvs;31/08/2022;consultor1.totvs;31/08/2022;0
H;PARAM.001.5;Curso Aluno;"SELECT DISTINCT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
  INNER JOIN SHABILITACAOALUNO (NOLOCK)     ON  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
                                               SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
 INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
 	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
 	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
  	
  
 WHERE	SMATRICPL.CODCOLIGADA = :CODCOLIGADA
 	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	AND SMATRICPL.RA = :RA
 	AND SMATRICPL.IDPERLET = :IDPERLET
 	/*MODIFICADO POR NATHAN PVT - 11/05/2022 - ADICIONADO CURSOS DE TESTE QUE NÃO DEVE APARECER*/
 	AND SCURSO.NOME NOT LIKE '%PENSIO%'
 	AND SCURSO.NOME NOT LIKE '%TESTE%'
 	AND SCURSO.NOME NOT LIKE '%MIGRA%DADO%SIGA%'
 	AND SCURSO.NOME NOT LIKE '%CURSO%DE%CIENCIA%'
 	/*AND SHABILITACAOFILIAL.ATIVO = 'S'*/

)
TABELA /*WHERE*/";1259;;;;31/08/2022;consultor1.totvs;0;1;1;1;;;;0;f9b3c54c-fc1b-424e-a45a-0997b6203c91;0;;4421;consultor1.totvs;31/08/2022;consultor1.totvs;31/08/2022;0
H;PARAM.001.6;Cursos Tecnologos;"SELECT DISTINCT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.CODCURSO + ' - ' + SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
  INNER JOIN SHABILITACAOALUNO (NOLOCK)     ON  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
                                               SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
 INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
 	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
 	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
  	
  
 WHERE	SMATRICPL.CODCOLIGADA = :CODCOLIGADA
 	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	AND SMATRICPL.RA = :RA
 	AND SMATRICPL.IDPERLET = :IDPERLET
 	/*MODIFICADO POR NATHAN PVT - 11/05/2022 - ADICIONADO CURSOS DE TESTE QUE NÃO DEVE APARECER*/
 	AND SCURSO.NOME NOT LIKE '%PENSIO%'
 	AND SCURSO.NOME NOT LIKE '%TESTE%'
 	AND SCURSO.NOME NOT LIKE '%MIGRA%DADO%SIGA%'
 	AND SCURSO.NOME NOT LIKE '%CURSO%DE%CIENCIA%'
 	AND SCURSO.CODCURSO IN(
 	'EAD-TADSI','EAD-TCINS','EAD-TFOTO','EAD-TGETI','EAD-TRHUM','EAD-TEGEF',
'EAD-TJODI','EAD-TEMAR','EAD-TPGER','EAD-TPAUD','EAD-TPMUL','EAD-TPPUB',
'EAD-TSECR','SP-TADSI','SP-TGAST','SP-TEMAD','SP-TRECO')
 	/*AND SHABILITACAOFILIAL.ATIVO = 'S'*/

)
TABELA /*WHERE*/";1520;;;;22/09/2022;consultor1.totvs;0;1;1;1;;;;0;2a0769e4-fdc0-4fdd-aa21-749538e56b15;0;;31768;consultor1.totvs;22/09/2022;consultor1.totvs;22/09/2022;0
H;PARAM.002;Disciplina;"SELECT DISTINCT 
 SDISCIPLINA.NOME, 
 SDISCIPLINA.CODDISC

FROM 
 SMATRICULA (NOLOCK)
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
 INNER JOIN STURMADISC (NOLOCK)		ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
									   SMATRICULA.IDPERLET = STURMADISC.IDPERLET AND
									   SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
									   
 INNER JOIN SDISCIPLINA (NOLOCK)	ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
									   STURMADISC.CODDISC = SDISCIPLINA.CODDISC
									   
 /*INNER JOIN SPARAM (NOLOCK)			ON SMATRICULA.CODCOLIGADA = SPARAM.CODCOLIGADA AND
									   STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
									   SMATRICULA.IDPERLET = CAST(SPARAM.TEXTO AS INT)*/
									   
WHERE 	1=1
	/*SPARAM.ID = 'IDPERLET'*/
	AND SSTATUS.DESCRICAO NOT LIKE '%CANCELA%'
	AND SMATRICULA.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICULA.RA = :RA
	AND SMATRICULA.IDPERLET = :IDPERLET
	AND SMATRICULA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
	AND SDISCIPLINA.NOME NOT LIKE 'PENSIONATO%'
	
	AND SMATRICULA.IDPERLET IN (
	SELECT IDPERLET
	FROM SMATRICPL
	INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
		AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
	WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICPL.RA = :RA
	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
	AND SSTATUS.DESCRICAO IN (
	'Contrato Assinado',
	'Cursando')
	)";1493;;;;13/10/2022;totvs.nathan;0;1;1;1;;;;0;c400bad2-ea55-4db6-932f-0be7164e56e6;0;;-24742;mestre;09/02/2021;totvs.nathan;13/10/2022;0
H;PARAM.002.1;Disciplina EAD;"SELECT DISTINCT 
 SDISCIPLINA.NOME, 
 SDISCIPLINA.CODDISC

FROM 
 SMATRICULA (NOLOCK)

 INNER JOIN STURMADISC (NOLOCK)		ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
									   SMATRICULA.IDPERLET = STURMADISC.IDPERLET AND
									   SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET									   
 INNER JOIN SDISCIPLINA (NOLOCK)	ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
									   STURMADISC.CODDISC = SDISCIPLINA.CODDISC
/*									   
 INNER JOIN SPARAM (NOLOCK)			ON SMATRICULA.CODCOLIGADA = SPARAM.CODCOLIGADA AND
									   STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
									   SMATRICULA.IDPERLET = CAST(SPARAM.TEXTO AS INT)
									   AND SPARAM.ID = 'IDPERLET'
									   */
									   
/*Modificado por Nathan PVT 07/06/2022 - Adicionado uma nova forma de verificar o periodo letivo do parametro, para considerar o periodo letivo atual e o anterior.*/
OUTER APPLY(
SELECT CODCOLIGADA,
	CAST(SPARAM.TEXTO AS INT) AS IDPERLET
FROM SPARAM
WHERE CODFILIAL = 4
AND ID = 'IDPERLET'

) AS A
LEFT JOIN SPLETIVO SP2 ON SP2.CODCOLIGADA = A.CODCOLIGADA
	AND SP2.IDPERLET = A.IDPERLET									  
									  
								
									   
WHERE 	
	SMATRICULA.CODCOLIGADA = :CODCOLIGADA
	AND SPLETIVO.IDPERLET IN (SP2.IDPERLET,SP2.IDPERLETANT)
	AND SMATRICULA.RA = :RA
	AND SMATRICULA.IDPERLET = :IDPERLET
	AND SMATRICULA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
	AND SDISCIPLINA.NOME NOT LIKE 'PENSIONATO%'
	AND SPLETIVO.CODFILIAL = 4";1626;;;;07/06/2022;consultor1.totvs;0;1;1;1;;;;0;c400bad2-ea55-4db6-932f-0be7164e56e6;0;;-434;consultor1.totvs;27/04/2022;consultor1.totvs;07/06/2022;0
H;PARAM.003;Tipo de Requisição;"SELECT DESCRICAO, CODCLIENTE FROM

(SELECT
  GCONSIST.CODCLIENTE,
  GCONSIST.DESCRICAO
 
 FROM
  GCONSIST (NOLOCK)
 
 WHERE	GCONSIST.APLICACAO = 'H'
	AND GCONSIST.CODTABELA = 'TIPOREQ'
)

TABELA /*WHERE*/";217;;;;09/02/2021;mestre;0;1;1;1;;;;0;85b25ce6-1464-46af-b756-0785ca16764b;0;;24689;mestre;09/02/2021;mestre;09/02/2021;0
H;PARAM.004;Motivos do Cancelamento/Trancamento;"SELECT MOTIVO, CODMOTIVO FROM

(SELECT
  SMOTIVOALTMAT.CODMOTIVO,
  SMOTIVOALTMAT.DESCRICAO MOTIVO
 
 FROM
  SMOTIVOALTMAT (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMOTIVOALTMAT.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SMOTIVOALTMAT.CODTIPOCURSO
  
 WHERE	SMOTIVOALTMAT.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL

)
TABELA /*WHERE*/";473;;;;23/02/2021;mestre;0;1;1;1;;;;0;198627f7-c14a-46db-93f0-2f9499c71c09;0;;22803;mestre;09/02/2021;mestre;23/02/2021;0
H;PARAM.005;Nível de Ensino;"SELECT NOME, CODTIPOCURSO FROM

(SELECT
  STIPOCURSO.CODTIPOCURSO,
  STIPOCURSO.NOME
 
 FROM
  STIPOCURSO (NOLOCK)
  
 WHERE	STIPOCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND STIPOCURSO.CODTIPOCURSO = (SELECT
 									SPLETIVO.CODTIPOCURSO
 								
 								   FROM
 								    SPLETIVO (NOLOCK)
 								    
 								   WHERE	SPLETIVO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
 								   		AND SPLETIVO.IDPERLET = :IDPERLET) 

 UNION ALL
 
 SELECT
  STIPOCURSO.CODTIPOCURSO,
  STIPOCURSO.NOME
 
 FROM
  STIPOCURSO (NOLOCK)
  
 WHERE	STIPOCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND (SELECT
 		  SPLETIVO.CODTIPOCURSO
 								
 		 FROM
 		  SPLETIVO (NOLOCK)
 								    
 		 WHERE	SPLETIVO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
 			AND SPLETIVO.IDPERLET = :IDPERLET)  IS NULL
 	AND STIPOCURSO.CODTIPOCURSO IS NOT NULL
)

TABELA /*WHERE*/";868;;;;21/09/2021;robson.canto;0;1;1;1;;;;0;c1989b8f-f805-4e2a-95ea-c6234fb041ed;0;;-14380;mestre;17/02/2021;robson.canto;21/09/2021;0
H;PARAM.006;Cursos por Nível de Ensino;"SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
  	AND SCURSO.CODTIPOCURSO = :Parametro_5
 	AND SCURSO.CODCURSO LIKE (SELECT
							   CASE WHEN HATENDENTE.CODLOCAL = 1 THEN 'SP%'
							   		WHEN HATENDENTE.CODLOCAL = 2 THEN 'EC%'
							   		WHEN HATENDENTE.CODLOCAL = 3 THEN 'HT%'
							   		WHEN HATENDENTE.CODLOCAL = 4 THEN 'EAD%'
							   		WHEN HATENDENTE.CODLOCAL = 5 THEN '%' END 
							   
							  FROM
							   HATENDENTE (NOLOCK)
							   
							  WHERE	HATENDENTE.CODCOLIGADA = :CODCOLIGADA
							  	AND HATENDENTE.CODATENDENTE = :CODATENDENTE) 

 	AND SCURSO.NOME NOT LIKE ('%TESTE%')
 	AND SCURSO.NOME NOT LIKE ('%PENSIONATO%')
 	AND SCURSO.NOME NOT LIKE ('%MIGRA%')
)
TABELA /*WHERE*/";835;;;;24/02/2022;robson.canto;0;1;1;1;;;;0;acd8ba09-87d2-4ab4-b6cf-92c6532d284b;0;;-13138;mestre;17/02/2021;robson.canto;24/02/2022;0
H;PARAM.006.4;Curso Aluno EAD;"SELECT DISTINCT CURSO, CODCURSO FROM

(SELECT DISTINCT
  SCURSO.CODCURSO,
  SCURSO.NOME + ' - ' + GFILIAL.NOMEFANTASIA AS CURSO
 
 FROM
  SMATRICPL (NOLOCK)	
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
									   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO									  
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SMATRICPL.RA = :RA
 	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	AND SMATRICPL.IDPERLET = :IDPERLET
 	AND SPLETIVO.CODFILIAL = 4
 	AND SPLETIVO.CODTIPOCURSO = 1
 	/*MODIFICADO POR NATHAN PVT - 11/05/2022 - ADICIONADO CURSOS DE TESTE QUE NÃO DEVE APARECER*/
 	AND SCURSO.NOME NOT LIKE '%PENSIO%'
 	AND SCURSO.NOME NOT LIKE '%TESTE%'
 	AND SCURSO.NOME NOT LIKE '%MIGRA%DADO%SIGA%'
 	AND SCURSO.NOME NOT LIKE '%CURSO%DE%CIENCIA%'
 	/*AND SHABILITACAOFILIAL.ATIVO = 'S'*/

)
TABELA /*WHERE*/";1309;;;;15/09/2022;consultor1.totvs;0;1;1;1;;;;0;23129d3a-c430-48ea-adf2-a3334684791d;0;;-32052;consultor1.totvs;15/09/2022;consultor1.totvs;15/09/2022;0
H;PARAM.007;Motivo de Alteração de Matrícula;"SELECT MOTIVO, CODMOTIVO FROM

(SELECT
  SMOTIVOALTMAT.CODMOTIVO,
  SMOTIVOALTMAT.DESCRICAO MOTIVO
 
 FROM
  SMOTIVOALTMAT (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMOTIVOALTMAT.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SMOTIVOALTMAT.CODTIPOCURSO
  
 WHERE	SMOTIVOALTMAT.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL

)
TABELA /*WHERE*/";473;;;;23/02/2021;mestre;0;1;1;1;;;;0;5096c600-bb28-4f90-813f-b3c7a11ef04f;0;;3649;mestre;23/02/2021;mestre;23/02/2021;0
H;PARAM.008;Filial;"SELECT FILIAL, CODFILIAL FROM

(SELECT
  HLOCALIDADE.CODLOCAL CODFILIAL,
  HLOCALIDADE.DESLOCAL FILIAL
  
 FROM
  HLOCALIDADE (NOLOCK)
  
 WHERE HLOCALIDADE.CODLOCAL <> 5
   	
)

TABELA /*WHERE*/";208;;;;20/09/2021;robson.canto;0;1;1;1;;;;0;47ad7765-2451-48bf-bef9-fd4be6e13a1f;0;;-6856;robson.canto;20/09/2021;robson.canto;20/09/2021;0
H;PARAM.009;Curso por Localidade;"SELECT CURSO, CODCURSO FROM

(SELECT DISTINCT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM 
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO AND
  											   SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO AND
  											   SHABILITACAOFILIAL.ATIVO = 'S'
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA 
 	AND SHABILITACAOFILIAL.CODTIPOCURSO = :Parametro_5 
 	AND SHABILITACAOFILIAL.CODFILIAL = :Parametro_11
 	AND SCURSO.CODCURSO NOT LIKE '%PENS%'
 	/*AND SHABILITACAOFILIAL.CODTIPOCURSO = :CODTIPOCURSO*/

)
TABELA /*WHERE*/";690;;;;05/10/2021;robson.canto;0;1;1;1;;;;0;f8b84733-358a-4da2-aefa-0033e597bed8;0;;-25136;robson.canto;20/09/2021;robson.canto;05/10/2021;0
H;PARAM.010;Nível de Ensino sem Filtro;"SELECT DISTINCT NOME, CODTIPOCURSO FROM

(SELECT
  STIPOCURSO.CODTIPOCURSO,
  STIPOCURSO.NOME
 
 FROM
  STIPOCURSO (NOLOCK)
  
 WHERE	STIPOCURSO.CODCOLIGADA = :CODCOLIGADA
	AND STIPOCURSO.CODCOLIGADA = (SELECT DISTINCT
								   1
								
								  FROM
								   HATENDIMENTOBASE (NOLOCK)
								 
								  WHERE	HATENDIMENTOBASE.CODCOLIGADA = STIPOCURSO.CODCOLIGADA)

)
TABELA /*WHERE*/";412;;;;21/09/2021;robson.canto;0;1;1;1;;;;0;ae185e35-cb77-490e-8026-6a9a7ea36be6;0;;3001;robson.canto;21/09/2021;robson.canto;21/09/2021;0
H;PARAM.011;Cursos;"SELECT CURSO, CODCURSO FROM

(SELECT DISTINCT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM 
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO AND
  											   SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO AND
  											   SHABILITACAOFILIAL.ATIVO = 'S'
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA 
 	AND SHABILITACAOFILIAL.CODFILIAL = :Parametro_11
 	AND SHABILITACAOFILIAL.CODTIPOCURSO = :Parametro_13
 	/*AND SHABILITACAOFILIAL.CODTIPOCURSO = :CODTIPOCURSO*/
 	AND SCURSO.NOME NOT LIKE ('%TESTE%')
 	AND SCURSO.NOME NOT LIKE ('%PENSIONATO%')
 	AND SCURSO.NOME NOT LIKE ('%MIGRA%')


)
TABELA /*WHERE*/";776;;;;06/04/2022;robson.canto;0;1;1;1;;;;0;b918ce34-9b01-47d9-9571-c444b0888671;0;;8201;robson.canto;21/09/2021;robson.canto;06/04/2022;0
H;PARAM.012;Componente Curricular;"SELECT COMPONENTE, CODCOMPONENTE FROM

(SELECT
  SCOMPONENTE.CODCOMPONENTE,
  SCOMPONENTE.DESCRICAO COMPONENTE
 
 FROM
  SHABILITACAOFILIAL (NOLOCK)
  
  INNER JOIN SCOMPONENTECURRICULAR (NOLOCK)	ON SCOMPONENTECURRICULAR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 											   SCOMPONENTECURRICULAR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
 
  INNER JOIN SCOMPONENTE (NOLOCK)			ON SCOMPONENTE.CODCOLIGADA = SCOMPONENTECURRICULAR.CODCOLIGADA AND 
 											   SCOMPONENTE.CODCOMPONENTE = SCOMPONENTECURRICULAR.CODCOMPONENTE

  												
 WHERE	SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL

)
TABELA /*WHERE*/";730;;;;27/10/2021;robson.canto;0;1;1;1;;;;0;1265847a-e970-4dd9-86da-d437520ced6c;0;;-24741;robson.canto;27/10/2021;robson.canto;27/10/2021;0
H;PARAM.019;Qde de Semestres;"SELECT DESCRICAO, CODCLIENTE FROM

(SELECT
  CAST(GCONSIST.CODCLIENTE AS INT) AS CODCLIENTE,
  GCONSIST.DESCRICAO
 
 FROM
  GCONSIST (NOLOCK)
  
   OUTER APPLY(
 SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 FROM
  SCURSO (NOLOCK)
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
											   AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL

)
TABELA 
) AS A

  
 
 WHERE	GCONSIST.APLICACAO = 'H'
	AND GCONSIST.CODTABELA = 'QDESEM'
	AND A.CODCURSO LIKE '%EAD%'
	
	
	
UNION ALL

SELECT
  CAST(GCONSIST.CODCLIENTE AS INT) AS CODCLIENTE,
  GCONSIST.DESCRICAO
 
 FROM
  GCONSIST (NOLOCK)
  
   OUTER APPLY(
 SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 FROM
  SCURSO (NOLOCK)
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
											   AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL

)
TABELA 
) AS A

  
 
 WHERE	GCONSIST.APLICACAO = 'H'
	AND GCONSIST.CODTABELA = 'QDESEM'
	AND A.CODCURSO NOT LIKE '%EAD%'
	AND CAST(GCONSIST.CODCLIENTE AS INT) <=10
)

TABELA /*WHERE*/

ORDER BY 2
";1583;;;;07/07/2022;consultor1.totvs;0;1;1;1;;;;0;4cb7ec3c-a650-41cb-8620-8c5076558699;0;;-21095;robson.canto;02/02/2022;consultor1.totvs;07/07/2022;0
H;PARAM.019.1;Qde de Semestres;"SELECT DESCRICAO, CODCLIENTE FROM

(SELECT
  CAST(GCONSIST.CODCLIENTE AS INT) AS CODCLIENTE,
  GCONSIST.DESCRICAO
 
 FROM
  GCONSIST (NOLOCK)
 
 WHERE	GCONSIST.APLICACAO = 'H'
	AND GCONSIST.CODTABELA = 'QDESEM'

)

TABELA /*WHERE*/

ORDER BY 2
";261;;;;14/07/2022;consultor1.totvs;0;1;1;1;;;;0;4cb7ec3c-a650-41cb-8620-8c5076558699;0;;-24102;consultor1.totvs;14/07/2022;consultor1.totvs;14/07/2022;0
H;PARAM.020;Disciplinas do Período Letivo Anterior;"SELECT NOME, CODDISC FROM

(

SELECT DISTINCT 
 SDISCIPLINA.NOME, 
 SDISCIPLINA.CODDISC

FROM 
 SMATRICULA (NOLOCK)

 INNER JOIN STURMADISC (NOLOCK)		ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
									   SMATRICULA.IDPERLET = STURMADISC.IDPERLET AND
									   SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC

INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
									   
 INNER JOIN SDISCIPLINA (NOLOCK)	ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
									   STURMADISC.CODDISC = SDISCIPLINA.CODDISC

WHERE 	SMATRICULA.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICULA.RA = :RA
	AND SMATRICULA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL 
	AND SSTATUS.DESCRICAO NOT LIKE '%CANCELADO%'
	AND SMATRICULA.IDPERLET = 
	(SELECT IDPERLETANT
	FROM SPLETIVO
	WHERE IDPERLET = :IDPERLET) /*(SELECT TOP 1
										   SMATRICPL.IDHABILITACAOFILIAL

										  FROM
										   SMATRICPL (NOLOCK)

										   INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
																					   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

										  WHERE SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
											AND SMATRICPL.RA = SMATRICULA.RA
											AND SHABILITACAOFILIAL.CODCURSO = (SELECT 
																			    SHABILITACAOFILIAL.CODCURSO
 
																			   FROM
																				SHABILITACAOFILIAL (NOLOCK)
 
																			   WHERE	SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA
																					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL)
											AND SMATRICPL.IDPERLET <> :IDPERLET
										  
										  ORDER BY SMATRICPL.IDPERLET DESC
										)
	AND SMATRICULA.IDPERLET = (SELECT TOP 1
										   SMATRICPL.IDPERLET

										  FROM
										   SMATRICPL (NOLOCK)

										   INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
																					   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

										  WHERE SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
											AND SMATRICPL.RA = SMATRICULA.RA
											AND SHABILITACAOFILIAL.CODCURSO = (SELECT 
																			    SHABILITACAOFILIAL.CODCURSO
 
																			   FROM
																				SHABILITACAOFILIAL (NOLOCK)
 
																			   WHERE	SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA
																					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL)
											AND SMATRICPL.IDPERLET <> :IDPERLET
										  
										  ORDER BY SMATRICPL.IDPERLET DESC
										)*/
										
) 
TABELA /*WHERE*/										";2787;;;;04/05/2022;consultor1.totvs;0;1;1;1;;;;0;ccca7f89-d339-4158-b4d2-ede4db73e3a8;0;;-29757;robson.canto;02/02/2022;consultor1.totvs;04/05/2022;0
H;PARAM.021;Professor;"SELECT NOME, CODPROF FROM

(
SELECT DISTINCT 
 SPROFESSOR.CODPROF,
 PPESSOA.NOME

FROM 
 SMATRICULA (NOLOCK)

 INNER JOIN STURMADISC (NOLOCK)				ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
									   		   SMATRICULA.IDPERLET = STURMADISC.IDPERLET AND
									   		   SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC 
									   
 INNER JOIN SDISCIPLINA (NOLOCK)			ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
									   		   STURMADISC.CODDISC = SDISCIPLINA.CODDISC 

 LEFT JOIN SPROFESSORTURMA (NOLOCK)			ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 											   SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC AND
 											   SPROFESSORTURMA.TIPOPROF = 'T' 											   
 
 LEFT JOIN SPROFESSOR (NOLOCK)				ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND 
 											   SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF   
 											   
 LEFT JOIN PPESSOA (NOLOCK)					ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA

 INNER JOIN SHABILITACAOFILIAL SHAB (NOLOCK)ON SHAB.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 											   SHAB.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL 
 											   
WHERE 	SMATRICULA.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICULA.RA = :RA
	AND SMATRICULA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL 
	AND SMATRICULA.IDPERLET = 
	(SELECT IDPERLETANT
	FROM SPLETIVO
	WHERE IDPERLET = :IDPERLET) /*(SELECT TOP 1
										   SMATRICPL.IDHABILITACAOFILIAL

										  FROM
										   SMATRICPL (NOLOCK)

										   INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
																					   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

										  WHERE SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
											AND SMATRICPL.RA = SMATRICULA.RA
											AND SHABILITACAOFILIAL.CODCURSO = SHAB.CODCURSO
											AND SMATRICPL.IDPERLET <> :IDPERLET
																	   
										  ORDER BY SMATRICPL.IDHABILITACAOFILIAL DESC
										)
	AND SMATRICULA.IDPERLET = (SELECT TOP 1
										   SMATRICPL.IDPERLET

										  FROM
										   SMATRICPL (NOLOCK)

										   INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
																					   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

										  WHERE SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
											AND SMATRICPL.RA = SMATRICULA.RA
											AND SHABILITACAOFILIAL.CODCURSO = (SELECT 
																			    SHABILITACAOFILIAL.CODCURSO
 
																			   FROM
																				SHABILITACAOFILIAL (NOLOCK)
 
																			   WHERE	SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA
																					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL)
											AND SMATRICPL.IDPERLET <> :IDPERLET
										  
										  ORDER BY SMATRICPL.IDPERLET DESC
										)
*/
) 
TABELA /*WHERE*/
";3012;;;;04/05/2022;consultor1.totvs;0;1;1;1;;;;0;4cb7ec3c-a650-41cb-8620-8c5076558699;0;;-4101;robson.canto;09/02/2022;consultor1.totvs;04/05/2022;0
H;PARAM.022;Modalidade;"SELECT DESCRICAO, CODCLIENTE FROM

(SELECT
  GCONSIST.CODCLIENTE,
  GCONSIST.DESCRICAO
 
 FROM
  GCONSIST (NOLOCK)
 
 WHERE	GCONSIST.APLICACAO = 'H'
	AND GCONSIST.CODTABELA = 'MODALIDADE'
)

TABELA /*WHERE*/";220;;;;22/02/2022;robson.canto;0;1;1;1;;;;0;07998ca7-ca07-444e-a6ff-b74c6fab2f6f;0;;-18526;robson.canto;22/02/2022;robson.canto;22/02/2022;0
H;PARAM.023;Optativas 2 Aluno;"SELECT DISTINCT DISCIPLINA1, CODDISC1 FROM

(SELECT
  SDISCIPLINA.CODDISC AS CODDISC1,
  SDISCIPLINA.NOME DISCIPLINA1


FROM 

 SMATRICPL (NOLOCK)	
									   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
									   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO									  
INNER JOIN SGRADE (NOLOCK)	 ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
INNER JOIN SGRUPOOPTELET (NOLOCK) ON SGRUPOOPTELET.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SGRUPOOPTELET.CODCURSO = SGRADE.CODCURSO
	AND SGRUPOOPTELET.CODHABILITACAO = SGRADE.CODHABILITACAO
	AND SGRUPOOPTELET.CODGRADE = SGRADE.CODGRADE
INNER JOIN SDISCGRUPOOPTELET (NOLOCK) ON SDISCGRUPOOPTELET.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
	AND SDISCGRUPOOPTELET.CODCURSO = SGRUPOOPTELET.CODCURSO
	AND SDISCGRUPOOPTELET.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
	AND SDISCGRUPOOPTELET.CODGRADE = SGRUPOOPTELET.CODGRADE
	AND SDISCGRUPOOPTELET.IDGRUPO = SGRUPOOPTELET.IDGRUPO
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = SDISCGRUPOOPTELET.CODDISC	
	
	
OUTER APPLY(

SELECT CODDISC,IDPERLET,CODCOLIGADA
	FROM STURMADISC
	WHERE STURMADISC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STURMADISC.IDPERLET = SMATRICPL.IDPERLET
	AND STURMADISC.CODDISC = SDISCGRUPOOPTELET.CODDISC
	) AS T


WHERE 	
	SMATRICPL.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL 
	AND SMATRICPL.IDPERLET = :IDPERLET 
	AND SMATRICPL.RA = :RA
	AND SGRUPOOPTELET.NOME LIKE '%2%'
	AND SCURSO.NOME LIKE '%TEOLOGI%'
	AND T.CODCOLIGADA IS NOT NULL
	AND (SGRUPOOPTELET.MINCREDITOS > 0 OR SGRUPOOPTELET.MINCH > 0 OR SGRUPOOPTELET.MINDISCIPLINAS > 0)
) TABELA /*WHERE*/";2122;;;;06/09/2022;consultor1.totvs;0;1;1;1;;;;0;19a9e7c0-f599-479d-928b-95379e2fe8ef;0;;-11033;consultor1.totvs;30/07/2022;consultor1.totvs;06/09/2022;0
H;PARAM.024;Optativas 3 Aluno;"SELECT DISTINCT DISCIPLINA2, CODDISC2 FROM

(SELECT
  SDISCIPLINA.CODDISC AS CODDISC2,
  SDISCIPLINA.NOME DISCIPLINA2


FROM 

 SMATRICPL (NOLOCK)	
									   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
									   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO									  
INNER JOIN SGRADE (NOLOCK)	 ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
INNER JOIN SGRUPOOPTELET (NOLOCK) ON SGRUPOOPTELET.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SGRUPOOPTELET.CODCURSO = SGRADE.CODCURSO
	AND SGRUPOOPTELET.CODHABILITACAO = SGRADE.CODHABILITACAO
	AND SGRUPOOPTELET.CODGRADE = SGRADE.CODGRADE
INNER JOIN SDISCGRUPOOPTELET (NOLOCK) ON SDISCGRUPOOPTELET.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
	AND SDISCGRUPOOPTELET.CODCURSO = SGRUPOOPTELET.CODCURSO
	AND SDISCGRUPOOPTELET.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
	AND SDISCGRUPOOPTELET.CODGRADE = SGRUPOOPTELET.CODGRADE
	AND SDISCGRUPOOPTELET.IDGRUPO = SGRUPOOPTELET.IDGRUPO
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = SDISCGRUPOOPTELET.CODDISC								  


OUTER APPLY(

SELECT CODDISC,IDPERLET,CODCOLIGADA
	FROM STURMADISC
	WHERE STURMADISC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STURMADISC.IDPERLET = SMATRICPL.IDPERLET
	AND STURMADISC.CODDISC = SDISCGRUPOOPTELET.CODDISC
	) AS T

WHERE 	
	SMATRICPL.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL 
	AND SMATRICPL.IDPERLET = :IDPERLET 
	AND SMATRICPL.RA = :RA
	AND SGRUPOOPTELET.NOME LIKE '%3%'
	AND SCURSO.NOME LIKE '%TEOLOGI%'
	AND T.CODCOLIGADA IS NOT NULL
	AND (SGRUPOOPTELET.MINCREDITOS > 0 OR SGRUPOOPTELET.MINCH > 0 OR SGRUPOOPTELET.MINDISCIPLINAS > 0)									
) TABELA /*WHERE*/				";2140;;;;06/09/2022;consultor1.totvs;0;1;1;1;;;;0;19a9e7c0-f599-479d-928b-95379e2fe8ef;0;;-13370;consultor1.totvs;30/07/2022;consultor1.totvs;06/09/2022;0
H;PARAM.025;Optativas Aluno Mestrado;"SELECT DISCIPLINA, CODDISC FROM

(SELECT
  SDISCIPLINA.CODDISC,
  SDISCIPLINA.NOME DISCIPLINA


FROM 

 SMATRICPL (NOLOCK)	
									   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
									   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO									  
INNER JOIN SGRADE (NOLOCK)	 ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
INNER JOIN SGRUPOOPTELET (NOLOCK) ON SGRUPOOPTELET.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SGRUPOOPTELET.CODCURSO = SGRADE.CODCURSO
	AND SGRUPOOPTELET.CODHABILITACAO = SGRADE.CODHABILITACAO
	AND SGRUPOOPTELET.CODGRADE = SGRADE.CODGRADE
INNER JOIN SDISCGRUPOOPTELET (NOLOCK) ON SDISCGRUPOOPTELET.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
	AND SDISCGRUPOOPTELET.CODCURSO = SGRUPOOPTELET.CODCURSO
	AND SDISCGRUPOOPTELET.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
	AND SDISCGRUPOOPTELET.CODGRADE = SGRUPOOPTELET.CODGRADE
	AND SDISCGRUPOOPTELET.IDGRUPO = SGRUPOOPTELET.IDGRUPO
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = SDISCGRUPOOPTELET.CODDISC								  

OUTER APPLY(

SELECT CODDISC,IDPERLET,CODCOLIGADA
	FROM STURMADISC
	WHERE STURMADISC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STURMADISC.IDPERLET = SMATRICPL.IDPERLET
	AND STURMADISC.CODDISC = SDISCGRUPOOPTELET.CODDISC
	) AS T

WHERE 	
	SMATRICPL.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL 
	AND SMATRICPL.IDPERLET = :IDPERLET 
	AND SMATRICPL.RA = :RA
	AND SCURSO.NOME LIKE '%MESTRADO%'
	AND SHABILITACAOFILIAL.CODFILIAL = 1
	AND T.CODCOLIGADA IS NOT NULL
	AND (SGRUPOOPTELET.MINCREDITOS > 0 OR SGRUPOOPTELET.MINCH > 0 OR SGRUPOOPTELET.MINDISCIPLINAS > 0)									
) TABELA /*WHERE*/				";2118;;;;03/08/2022;consultor1.totvs;0;1;1;1;;;;0;19a9e7c0-f599-479d-928b-95379e2fe8ef;0;;-16650;consultor1.totvs;02/08/2022;consultor1.totvs;03/08/2022;0
H;PARAM.026;Motivo de Cancelamento Curso Livre;"SELECT MOTIVO, CODMOTIVO FROM

(SELECT
  SMOTIVOALTMAT.CODMOTIVO,
  SMOTIVOALTMAT.DESCRICAO MOTIVO
 
 FROM
  SMOTIVOALTMAT (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMOTIVOALTMAT.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SMOTIVOALTMAT.CODTIPOCURSO
  
 WHERE	SMOTIVOALTMAT.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	AND SMOTIVOALTMAT.CODMOTIVO NOT IN (9, 13, 45)

)
TABELA /*WHERE*/";523;;;;27/10/2022;robson.canto;0;1;1;1;;;;0;bd4ab6ad-7232-4546-8e97-e3887a424ca9;0;;18385;robson.canto;27/10/2022;robson.canto;27/10/2022;0
H;PARAM.027;Modalidade Curso Livre;"SELECT MODALIDADE, CODGRADE FROM

(SELECT
  SGRADE.CODGRADE,
  SGRADE.DESCRICAO MODALIDADE
 
 FROM
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO AND
  											   SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
  											   
  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  											   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  											   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND
  											   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE  											   
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL

)
TABELA /*WHERE*/";839;;;;27/10/2022;robson.canto;0;1;1;1;;;;0;2fa493db-b387-4338-848c-b06ba529e6b8;0;;-22573;robson.canto;27/10/2022;robson.canto;27/10/2022;0
H;REQ.001;Localiza Coordenador do Curso - Aluno;"/* ATENDIMENTO ABERTO PELO PORTAL COM VINCULO COM ALUNO*/

/*SELECT
 HATENDENTE.CODATENDENTE COORDENADOR,
 PPESSOA.EMAIL

FROM
 HATENDIMENTOEXT (NOLOCK)
 
 INNER JOIN SATENDIMENTO (NOLOCK)		ON SATENDIMENTO.CODCOLIGADA = HATENDIMENTOEXT.CODCOLIGADA AND
 									   	   SATENDIMENTO.CODLOCAL = HATENDIMENTOEXT.CODLOCAL AND
 									   	   SATENDIMENTO.CODATENDIMENTO = HATENDIMENTOEXT.CODATENDIMENTO
 									   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SATENDIMENTO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 									   	   SATENDIMENTO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
									   
 INNER JOIN SCOORDENADOR (NOLOCK)		ON SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										   SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   SCOORDENADOR.FUNCAO = 'C'
 
 INNER JOIN HATENDENTE (NOLOCK)			ON SCOORDENADOR.CODPESSOA = HATENDENTE.CODPESSOA
 
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA
  										   
WHERE 	HATENDIMENTOEXT.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOEXT.CODATENDIMENTO = :FRM_CODATEND*/
	/*AND HATENDIMENTOEXT.CODLOCAL = :FRM_CODLOCAL*/

SELECT DISTINCT
 HATENDENTE.CODATENDENTE COORDENADOR,
 PPESSOA.EMAIL

FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HPARAMATENDIMENTO (NOLOCK)		ON HATENDIMENTOBASE.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND 
 											   HATENDIMENTOBASE.CODATENDIMENTO = HPARAMATENDIMENTO.CODATENDIMENTO AND 
 											   HATENDIMENTOBASE.CODLOCAL = HPARAMATENDIMENTO.CODLOCAL
 	  					   
 INNER JOIN HTIPOATENDIMENTO (NOLOCK)		ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
 	   								   
 INNER JOIN HLOCALENTREGA (NOLOCK)			ON HLOCALENTREGA.CODCOLIGADA = HTIPOATENDIMENTO.CODCOLIGADA AND 
 											   HLOCALENTREGA.CODTIPOATENDIMENTO = HTIPOATENDIMENTO.CODTIPOATENDIMENTO 											   								   
  
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.CODCURSO = HPARAMATENDIMENTO.VALOR AND
 											   (   SHABILITACAOFILIAL.CODFILIAL = HATENDIMENTOBASE.CODLOCAL
 											    OR SHABILITACAOFILIAL.CODFILIAL = HLOCALENTREGA.CODFILIAL)
 
 INNER JOIN SCOORDENADOR (NOLOCK)			ON SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										  	   SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   	   SCOORDENADOR.FUNCAO = 'C'
 
 INNER JOIN HATENDENTE (NOLOCK)				ON SCOORDENADOR.CODPESSOA = HATENDENTE.CODPESSOA

 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA 											   
 
WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
	AND HPARAMATENDIMENTO.CODPARAMETRO IN (1, 12)
	/*AND HATENDENTE.CODATENDENTE <> 95*/
	/*AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL*/
	
UNION ALL

/* ATENDIMENTO ABERTO PELO SISTEMA SEM VINCULO COM ALUNO*/
SELECT DISTINCT
 HATENDENTE.CODATENDENTE COORDENADOR,
 PPESSOA.EMAIL
 
FROM
 HPARAMATENDIMENTO (NOLOCK)
 
 INNER JOIN HATENDIMENTOBASE (NOLOCK)		ON HATENDIMENTOBASE.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND 
 											   HATENDIMENTOBASE.CODATENDIMENTO = HPARAMATENDIMENTO.CODATENDIMENTO AND 
 											   HATENDIMENTOBASE.CODLOCAL = HPARAMATENDIMENTO.CODLOCAL
 										   
 INNER JOIN HTIPOATENDIMENTO (NOLOCK)		ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
 										   
 INNER JOIN HLOCALENTREGA (NOLOCK)			ON HLOCALENTREGA.CODCOLIGADA = HTIPOATENDIMENTO.CODCOLIGADA AND 
 											   HLOCALENTREGA.CODTIPOATENDIMENTO = HTIPOATENDIMENTO.CODTIPOATENDIMENTO 											   								   
  
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.CODCURSO = HPARAMATENDIMENTO.VALOR AND
 											   (   SHABILITACAOFILIAL.CODFILIAL = HATENDIMENTOBASE.CODLOCAL
 											    OR SHABILITACAOFILIAL.CODFILIAL = HLOCALENTREGA.CODFILIAL)
 											    /*
 											   (SELECT
 											   									CASE WHEN HATEND.CODLOCAL = 5 THEN HLOCALENTREGA.CODFILIAL
 											   										 ELSE 1 HPARAMATENDIMENTO.CODFILIAL END
 											   								   
 											   								   FROM
 											   								    HATENDIMENTOBASE HATEND (NOLOCK)
 											   								    
 											   								    INNER JOIN HPARAMATENDIMENTO HPARAM (NOLOCK)	ON HPARAM.CODCOLIGADA = HATEND.CODCOLIGADA AND
 											   								    												   HPARAM.CODATENDIMENTO = HATEND.CODATENDIMENTO AND
 											   								    												   HPARAM.CODPARAMETRO = 6
 											   								    
 											   								   WHERE HATEND.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
 											   								     AND HATEND.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 											   								     AND HATEND.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO)
 											   								   	*/
 
 INNER JOIN SCOORDENADOR (NOLOCK)			ON SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										  	   SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   	   SCOORDENADOR.FUNCAO = 'C'
 
 INNER JOIN HATENDENTE (NOLOCK)				ON SCOORDENADOR.CODPESSOA = HATENDENTE.CODPESSOA

 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA 											   
 
WHERE	HPARAMATENDIMENTO.CODCOLIGADA = :FRM_COLIGADA
	AND HPARAMATENDIMENTO.CODATENDIMENTO = :FRM_CODATEND
	AND HPARAMATENDIMENTO.CODLOCAL = :FRM_CODLOCAL
	AND HPARAMATENDIMENTO.CODPARAMETRO = 6
";5934;;;;06/01/2022;robson.canto;0;1;1;1;;;;0;7c85cb6b-af1c-487e-ac0d-509801857ada;0;;27899;mestre;19/01/2021;robson.canto;06/01/2022;0
H;REQ.001.1;Localiza Coordenador do Curso - Aluno;"
SELECT COUNT(*) TOTAL
FROM (
SELECT DISTINCT
 HATENDENTE.CODATENDENTE COORDENADOR,
 PPESSOA.EMAIL

FROM SATENDIMENTO
INNER JOIN HATENDIMENTOBASE ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO
	AND HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL											   								   
  
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
 											   AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL
 
 INNER JOIN SCOORDENADOR (NOLOCK)			ON SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										  	   SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   	   SCOORDENADOR.FUNCAO IN ('C','V')
 
 INNER JOIN HATENDENTE (NOLOCK)				ON SCOORDENADOR.CODPESSOA = HATENDENTE.CODPESSOA

 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA											   
 
WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL

	) AS A
";1163;;;;22/06/2022;consultor1.totvs;0;1;1;1;;;;0;7c85cb6b-af1c-487e-ac0d-509801857ada;0;;24765;consultor1.totvs;21/06/2022;consultor1.totvs;22/06/2022;0
H;REQ.001.1.1;Localiza Coordenador do Curso - Aluno;"
SELECT COUNT(*) TOTAL
FROM (
SELECT DISTINCT
 SATENDIMENTO.*

FROM SATENDIMENTO
INNER JOIN HATENDIMENTOBASE ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO
	AND HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL											   								   
  
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
 											   AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
	AND (SHABILITACAOFILIAL.CODCURSO IN ('EC-PMISS', 'EC-PETTB', 'EC-PESTM', 'EC-PETTS', 'EC-PGTEA') OR SCURSO.NOME LIKE '%TEOLOGIA%')

	) AS A
";976;;;;04/08/2022;consultor1.totvs;0;1;1;1;;;;0;7c85cb6b-af1c-487e-ac0d-509801857ada;0;;2428;consultor1.totvs;04/08/2022;consultor1.totvs;04/08/2022;0
H;REQ.001.2;Retorno do Código do Grupo de acordo com o Curso;"
SELECT DISTINCT
GRUPO.NOME,
GRUPO.CODGRUPO

FROM SATENDIMENTO
INNER JOIN HATENDIMENTOBASE ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO
	AND HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL											   								   
  
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
 											   AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 
OUTER APPLY(
SELECT *
FROM HGRUPO) AS GRUPO


WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
	AND GRUPO.NOME LIKE '%COORDENA%'
	AND GRUPO.NOME LIKE '%' + LEFT(SCURSO.NOME,43) + '%'
	
UNION ALL


SELECT DISTINCT
'Secretaria Teologia' NOME,
46 CODGRUPO

FROM SATENDIMENTO
INNER JOIN HATENDIMENTOBASE ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO
	AND HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL											   								   
  
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
 											   AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO


WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
	AND (SHABILITACAOFILIAL.CODCURSO IN ('EC-PMISS', 'EC-PETTB', 'EC-PESTM', 'EC-PETTS', 'EC-PGTEA') OR SCURSO.NOME LIKE '%TEOLOGIA%')";1882;;;;04/08/2022;consultor1.totvs;0;1;1;1;;;;0;d86d2951-b05a-4c38-9e5f-68adaa5b4489;0;;3818;consultor1.totvs;22/06/2022;consultor1.totvs;04/08/2022;0
H;REQ.002;Repassar de Volta;"SELECT TOP 1
 HHISTORICOETAPASATENDIMENTO.CODATENDENTEANTERIOR ATEND_ANT,
 PPESSOA.EMAIL
 
FROM
 HHISTORICOETAPASATENDIMENTO (NOLOCK)
 
 INNER JOIN HATENDIMENTOBASE (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HHISTORICOETAPASATENDIMENTO.CODCOLIGADA AND 
 										   HATENDIMENTOBASE.CODLOCAL = HHISTORICOETAPASATENDIMENTO.CODLOCAL AND
 										   HATENDIMENTOBASE.CODATENDIMENTO = HHISTORICOETAPASATENDIMENTO.CODATENDIMENTO

 INNER JOIN HATENDENTE (NOLOCK)			ON HATENDENTE.CODCOLIGADA = HHISTORICOETAPASATENDIMENTO.CODCOLIGADA AND 
 										   HATENDENTE.CODATENDENTE = HHISTORICOETAPASATENDIMENTO.CODATENDENTEANTERIOR
 										   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA 										   
 
WHERE HHISTORICOETAPASATENDIMENTO.CODCOLIGADA = :FRM_COLIGADA
	AND HHISTORICOETAPASATENDIMENTO.CODLOCAL = :FRM_CODLOCAL
	AND HHISTORICOETAPASATENDIMENTO.CODATENDIMENTO = :FRM_CODATEND
	AND HHISTORICOETAPASATENDIMENTO.CODATENDENTEANTERIOR <> HATENDIMENTOBASE.CODATENDENTERESP

ORDER BY HHISTORICOETAPASATENDIMENTO.IDHISTORICOETAPAS DESC";1083;;;;30/08/2021;mestre;0;1;1;1;;;;0;f6a7063c-6001-4ede-9284-dadb5ccd39c5;0;;-30996;mestre;19/01/2021;mestre;30/08/2021;0
H;REQ.006;Código do Curso do Aluno;"SELECT DISTINCT
 SCURSO.CODCURSO,
 SCURSO.NOME,
 CAST(HSOLICITACAO.TEXTOSOLICITACAO AS VARCHAR(254)) SOLICITACAO,
 CAST(HATENDIMENTOARQUIVOSANEXOS.CODARQUIVO AS VARCHAR(7)) ANEXO,
 HTIPOATENDIMENTO.NOME ASSUNTO,
 SHABILITACAOFILIAL.CODGRADE
  
FROM
 SATENDIMENTO
 
 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA AND 
 											   SMATRICPL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL AND 
 											   SMATRICPL.RA = SATENDIMENTO.RA
 
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
 
 INNER JOIN SCURSO (NOLOCK)					ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
   
 INNER JOIN HATENDIMENTOBASE (NOLOCK)		ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA AND 
 											   HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO AND 
 											   HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL    
 											   
 LEFT JOIN HSOLICITACAO (NOLOCK)			ON HSOLICITACAO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HSOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   HSOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL 											   
 											   
 LEFT JOIN HATENDIMENTOARQUIVOSANEXOS (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HATENDIMENTOARQUIVOSANEXOS.CODCOLIGADA AND 
 												   HATENDIMENTOBASE.CODATENDIMENTO = HATENDIMENTOARQUIVOSANEXOS.CODATENDIMENTO AND 
 												   HATENDIMENTOBASE.CODLOCAL = HATENDIMENTOARQUIVOSANEXOS.CODLOCAL

 INNER JOIN HTIPOATENDIMENTO (NOLOCK)			ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 												   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO 
 
WHERE	SATENDIMENTO.CODCOLIGADA = :FRM_COLIGADA
	AND SATENDIMENTO.CODLOCAL = :FRM_CODLOCAL
	AND SATENDIMENTO.CODATENDIMENTO = :FRM_CODATEND


/*
SELECT
 SCURSO.CODCURSO,
 SCURSO.NOME
 
FROM
 SATENDIMENTO
 
 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA AND 
 											   SMATRICPL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL AND 
 											   SMATRICPL.RA = SATENDIMENTO.RA
 
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
 
 INNER JOIN SCURSO (NOLOCK)					ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
   
WHERE	SATENDIMENTO.CODCOLIGADA = :FRM_COLIGADA
	AND SATENDIMENTO.CODLOCAL = :FRM_CODLOCAL
	AND SATENDIMENTO.CODATENDIMENTO = :FRM_CODATEND
*/";2870;;;;27/10/2022;robson.canto;0;1;1;1;;;;0;09e452be-6e5c-4aea-af05-48c7f05b170f;0;;-13673;mestre;10/02/2021;robson.canto;27/10/2022;0
H;REQ.006.1;Código do Curso do Aluno;"SELECT DISTINCT
 SCURSO.CODCURSO,
 SCURSO.NOME,
 CAST(HSOLICITACAO.TEXTOSOLICITACAO AS VARCHAR(254)) SOLICITACAO,
 CAST(HATENDIMENTOARQUIVOSANEXOS.CODARQUIVO AS VARCHAR(7)) ANEXO,
 HTIPOATENDIMENTO.NOME ASSUNTO
  
FROM
 SATENDIMENTO
 
 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA AND 
 											   SMATRICPL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL AND 
 											   SMATRICPL.RA = SATENDIMENTO.RA
 
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
 
 INNER JOIN SCURSO (NOLOCK)					ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
   
 INNER JOIN HATENDIMENTOBASE (NOLOCK)		ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA AND 
 											   HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO AND 
 											   HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL    
 											   
 LEFT JOIN HSOLICITACAO (NOLOCK)			ON HSOLICITACAO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HSOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   HSOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL 											   
 											   
 LEFT JOIN HATENDIMENTOARQUIVOSANEXOS (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HATENDIMENTOARQUIVOSANEXOS.CODCOLIGADA AND 
 												   HATENDIMENTOBASE.CODATENDIMENTO = HATENDIMENTOARQUIVOSANEXOS.CODATENDIMENTO AND 
 												   HATENDIMENTOBASE.CODLOCAL = HATENDIMENTOARQUIVOSANEXOS.CODLOCAL

 INNER JOIN HTIPOATENDIMENTO (NOLOCK)			ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 												   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO 
 
WHERE	SATENDIMENTO.CODCOLIGADA = :FRM_COLIGADA
	AND SATENDIMENTO.CODLOCAL = :FRM_CODLOCAL
	AND SATENDIMENTO.CODATENDIMENTO = :FRM_CODATEND
	
	

UNION ALL


SELECT DISTINCT

 HPARAMATENDIMENTO.VALOR AS 'CODCURSO',
 SCURSO.NOME,
 CAST(HSOLICITACAO.TEXTOSOLICITACAO AS VARCHAR(254)) SOLICITACAO,
 CAST(HATENDIMENTOARQUIVOSANEXOS.CODARQUIVO AS VARCHAR(7)) ANEXO,
 HTIPOATENDIMENTO.NOME ASSUNTO
 
  
FROM
 HATENDIMENTOBASE (NOLOCK)	
 
  LEFT JOIN SATENDIMENTO (NOLOCK)		ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA AND 
 											   HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO AND 
 											   HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL 
 
 
 LEFT JOIN HSOLICITACAO (NOLOCK)			ON HSOLICITACAO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HSOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   HSOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL 											   
 											   
 LEFT JOIN HATENDIMENTOARQUIVOSANEXOS (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HATENDIMENTOARQUIVOSANEXOS.CODCOLIGADA AND 
 												   HATENDIMENTOBASE.CODATENDIMENTO = HATENDIMENTOARQUIVOSANEXOS.CODATENDIMENTO AND 
 												   HATENDIMENTOBASE.CODLOCAL = HATENDIMENTOARQUIVOSANEXOS.CODLOCAL

 INNER JOIN HTIPOATENDIMENTO (NOLOCK)			ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 												   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO 
 												   
 												   
 INNER JOIN HPARAMATENDIMENTO ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
 
 INNER JOIN HPARAM ON HPARAM.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA
		AND HPARAM.CODPARAMETRO = HPARAMATENDIMENTO.CODPARAMETRO
		AND (HPARAM.NOME LIKE '%CURSO%' OR HPARAM.DESCRICAO LIKE '%CURSO%')
		
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA
	AND SCURSO.CODCURSO = HPARAMATENDIMENTO.VALOR
		
		
WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND
	AND SATENDIMENTO.CODCOLIGADA IS NULL";4126;;;;01/09/2022;consultor1.totvs;0;1;1;1;;;;0;09e452be-6e5c-4aea-af05-48c7f05b170f;0;;-18818;consultor1.totvs;11/08/2022;consultor1.totvs;01/09/2022;0
H;REQ.007;Localiza Professor Titular da Disciplina;"SELECT
 HATENDENTE.CODATENDENTE PROFESSOR,
 PPESSOA.EMAIL
 
FROM
 SATENDIMENTO
 
 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA AND 
 											   SMATRICPL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL AND 
 											   SMATRICPL.RA = SATENDIMENTO.RA
 
 INNER JOIN SMATRICULA (NOLOCK)				ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 											   SMATRICULA.IDPERLET = SMATRICPL.IDPERLET AND 
 											   SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 											   SMATRICULA.RA = SMATRICPL.RA
 
 INNER JOIN STURMADISC (NOLOCK)				ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 											   STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC AND
 											   STURMADISC.CODDISC = :FRM_PAR.001
 											   
 INNER JOIN SPROFESSORTURMA (NOLOCK)		ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 											   SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC AND
 											   SPROFESSORTURMA.TIPOPROF = 'T' 											   
 
 INNER JOIN SPROFESSOR (NOLOCK)				ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND 
 											   SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF   
 											   
 INNER JOIN HATENDENTE (NOLOCK)				ON SPROFESSOR.CODPESSOA = HATENDENTE.CODPESSOA
 
 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = HATENDENTE.CODPESSOA
 
WHERE	SATENDIMENTO.CODCOLIGADA = :FRM_COLIGADA
	AND SATENDIMENTO.CODLOCAL = :FRM_CODLOCAL
	AND SATENDIMENTO.CODATENDIMENTO = :FRM_CODATEND";1547;;;;20/09/2021;robson.canto;0;1;1;1;;;;0;dbcd1767-f5c2-4a1e-b461-dc99b77cc3b9;0;;-8855;mestre;10/02/2021;robson.canto;20/09/2021;0
H;REQ.014;Informa IDLAN no Atendimento;"SELECT
 SLAN.IDLAN

FROM
 SPARCELASOLICITACAO (NOLOCK)
 
 INNER JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 									   	   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA
 									   
 INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   	   SLAN.IDPARCELA = SPARCELA.IDPARCELA  									   
 									   
WHERE	SPARCELASOLICITACAO.CODCOLIGADA = :FRM_COLIGADA
	AND SPARCELASOLICITACAO.CODLOCAL = :FRM_CODLOCAL
	AND SPARCELASOLICITACAO.CODATENDIMENTO = :FRM_CODATEND";565;;;;26/07/2021;mestre;0;1;1;1;;;;0;2d33eada-ba7c-4baa-bfa1-2133c7edabee;0;;-19771;mestre;26/07/2021;mestre;26/07/2021;0
H;REQ.015;Repassar para o Coordenador,  Enviar Email e Verifica Anexo;"SELECT DISTINCT
 CAST(HSOLICITACAO.TEXTOSOLICITACAO AS VARCHAR(254)) SOLICITACAO,
 CAST(HATENDIMENTOARQUIVOSANEXOS.CODARQUIVO AS VARCHAR(7)) ANEXO,
 HTIPOATENDIMENTO.NOME ASSUNTO
  
FROM
 HATENDIMENTOBASE 
 
 LEFT JOIN HSOLICITACAO (NOLOCK)			    ON HSOLICITACAO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   	   HSOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											       HSOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL 											   
 											   
 LEFT JOIN HATENDIMENTOARQUIVOSANEXOS (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HATENDIMENTOARQUIVOSANEXOS.CODCOLIGADA AND 
 												   HATENDIMENTOBASE.CODATENDIMENTO = HATENDIMENTOARQUIVOSANEXOS.CODATENDIMENTO AND 
 												   HATENDIMENTOBASE.CODLOCAL = HATENDIMENTOARQUIVOSANEXOS.CODLOCAL

 INNER JOIN HTIPOATENDIMENTO (NOLOCK)			ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 												   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO 
 
WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND

";1176;;;;30/08/2021;mestre;0;1;1;1;;;;0;0b7196cf-4bf2-44f0-b790-f57845654f2c;0;;-10396;mestre;30/08/2021;mestre;30/08/2021;0
H;REQ.020;Informações Financeiras;"SELECT
 SALUNO.CODCOLCFO,
 SALUNO.CODCFO,
 HATENDIMENTOBASE.CODLOCAL,
 CONVERT(VARCHAR(10), (GETDATE() + 3), 103) VENCIMENTO,
 HPRECOTIPOATEND.VALOR
 
FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HATENDIMENTOEXT (NOLOCK)		ON HATENDIMENTOEXT.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HATENDIMENTOEXT.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   HATENDIMENTOEXT.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 
 INNER JOIN HTIPOATENDIMENTO (NOLOCK)		ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO

 INNER JOIN HLOCALENTREGA (NOLOCK)			ON HLOCALENTREGA.CODCOLIGADA = HTIPOATENDIMENTO.CODCOLIGADA AND 
 											   HLOCALENTREGA.CODTIPOATENDIMENTO = HTIPOATENDIMENTO.CODTIPOATENDIMENTO AND
 											   HLOCALENTREGA.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 											   
 INNER JOIN HPRECOTIPOATEND (NOLOCK)		ON HPRECOTIPOATEND.CODCOLIGADA = HLOCALENTREGA.CODCOLIGADA AND 
 											   HPRECOTIPOATEND.CODTIPOATENDIMENTO = HLOCALENTREGA.CODTIPOATENDIMENTO AND 
 											   HPRECOTIPOATEND.CODLOCALENTREGA = HLOCALENTREGA.CODLOCALENTREGA AND 
 											   HPRECOTIPOATEND.CODFILIAL = HLOCALENTREGA.CODFILIAL
 											   
 INNER JOIN SALUNO (NOLOCK)					ON SALUNO.CODCOLIGADA = HATENDIMENTOEXT.CODCOLIGADA AND
 											   SALUNO.RA = HATENDIMENTOEXT.RAALUNO  											   

WHERE	HATENDIMENTOBASE.CODCOLIGADA = :FRM_COLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = :FRM_CODATEND
	AND HATENDIMENTOBASE.CODLOCAL = :FRM_CODLOCAL";1612;;;;21/09/2021;robson.canto;0;1;1;1;;;;0;3316c9ef-1cc3-404c-9719-c92b50ad330d;0;;18157;robson.canto;21/09/2021;robson.canto;21/09/2021;0
H;VISAO;Visão dos Atendimentos;"SELECT
 HATENDIMENTOBASE.CODCOLIGADA, 
 HATENDIMENTOBASE.CODLOCAL, 
 HATENDIMENTOBASE.CODATENDIMENTO, 
 HATENDIMENTOBASE.CODSTATUS, 
 HATENDIMENTOBASE.CODTAREFA, 
 SALUNO.RA,
 PPESSOA.NOME NOMECLIENTE,
 HTIPOATENDIMENTO.NOME 'TIPO ATENDIMENTO',
 HTAREFA.NOME ETAPA,
 HATENDIMENTOBASE.CODCOLIGPRD, 
 HATENDIMENTOBASE.CODPRODUTO, 
 HATENDIMENTOBASE.CODATENDENTERESP, 
 HATENDIMENTOBASE.CODCOLIGADARESP, 
 HATENDIMENTOBASE.CODCOLIGADAALARME, 
 HATENDIMENTOBASE.CODATENDALARME, 
 HATENDIMENTOBASE.PRAZOLIMITE, 
 HATENDIMENTOBASE.CODCOLIGADARPR, 
 HATENDIMENTOBASE.CODRPR, 
 HATENDIMENTOBASE.ASSUNTOOC, 
 HATENDIMENTOBASE.CODITEMPRD, 
 HATENDIMENTOBASE.PRIORIDADE, 
 HATENDIMENTOBASE.FECHAMENTO,
 HATENDIMENTOBASE.AGENDADOPARA,
 FLAN.IDLAN,
 FLAN.DATABAIXA 'DATA BAIXA',
 HLOCALIDADE.DESLOCAL LOCAL,
 HATENDIMENTOEXT.CODCFO,
 
 HATENDIMENTOBASE.ABERTURA,

 (SELECT TOP 1
   HPARAMATENDIMENTO.VALOR

  FROM
   HPARAMATENDIMENTO (NOLOCK)
 
   INNER JOIN HPARAM (NOLOCK)		ON HPARAM.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA AND 
 								   	   HPARAM.CODPARAMETRO = HPARAMATENDIMENTO.CODPARAMETRO AND
 								   	   HPARAM.NOME LIKE 'CURSO%'
 
  WHERE	HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
	AND HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO) CURSO,

 SUBSTRING(HLOCALENTREGA.PRAZO,1, (charindex(' ', HLOCALENTREGA.PRAZO, 1)-1) ) PRAZO,
 SUBSTRING(HLOCALENTREGA.PRAZO,1, (charindex(' ', HLOCALENTREGA.PRAZO, 1)-1) ) - dbo.FCNDIASUTEIS(HATENDIMENTOBASE.ABERTURA, getdate()) FALTAM
 
FROM 
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN HATENDIMENTOEXT (NOLOCK)	ON HATENDIMENTOBASE.CODCOLIGADA = HATENDIMENTOEXT.CODCOLIGADA AND
 										   HATENDIMENTOBASE.CODLOCAL = HATENDIMENTOEXT.CODLOCAL AND
 										   HATENDIMENTOBASE.CODATENDIMENTO = HATENDIMENTOEXT.CODATENDIMENTO
/* 										   
 LEFT JOIN FCFO (NOLOCK)				ON HATENDIMENTOEXT.CODCOLIGADACLI = FCFO.CODCOLIGADA AND
 										   HATENDIMENTOEXT.CODCFO = FCFO.CODCFO
 */
 LEFT JOIN SALUNO (NOLOCK)				ON HATENDIMENTOEXT.COLIGADAALUNO = SALUNO.CODCOLIGADA AND
 										   HATENDIMENTOEXT.RAALUNO = SALUNO.RA
 
 LEFT JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA OR
 										   PPESSOA.CODIGO = HATENDIMENTOEXT.CODPESSOA
 
 LEFT JOIN HTIPOATENDIMENTO (NOLOCK)	ON HTIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HTIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO

 										   
 LEFT JOIN HTAREFA (NOLOCK)				ON HTAREFA.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HTAREFA.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND 
 										   HTAREFA.CODTAREFA = HATENDIMENTOBASE.CODTAREFA 										   

 LEFT JOIN SPARCELASOLICITACAO (NOLOCK)	ON SPARCELASOLICITACAO.CODCOLIGADAATEND = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   SPARCELASOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 										   SPARCELASOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 										   
 LEFT JOIN SPARCELA (NOLOCK)			ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 										   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA 										   
 										   
 LEFT JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 										   SLAN.IDPARCELA = SPARCELA.IDPARCELA 										   
 										   
 LEFT JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 										   FLAN.IDLAN = SLAN.IDLAN 										   
 
 LEFT JOIN HLOCALENTREGA (NOLOCK)		ON HLOCALENTREGA.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 										   HLOCALENTREGA.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND
 										   HLOCALENTREGA.CODLOCALENTREGA = HATENDIMENTOBASE.CODLOCALENTREGA

 LEFT JOIN HLOCALIDADE (NOLOCK)			ON HLOCALIDADE.CODLOCAL = HLOCALENTREGA.CODLOCAL";3953;;;;27/10/2022;robson.canto;0;1;1;1;;;;0;b7b1ef3c-69fc-43a1-9574-b97a97f0bd95;0;;-3377;mestre;26/07/2021;robson.canto;27/10/2022;0
H;VISQL01;Selecionar Dados para Fluxo requisição;"SELECT CODSECAO FROM VREQTRANSFERENCIA (NOLOCK)                
WHERE CODCOLREQUISICAO = :FRM_VIFRM03 AND IDREQ = :FRM_VIFRM04 
UNION                                                          
SELECT CODSECAO FROM VREQTRANSFPROMOCAO (NOLOCK)               
WHERE CODCOLREQUISICAO = :FRM_VIFRM03 AND IDREQ = :FRM_VIFRM04 ";;0;;;;;0;1;1;1;;;;0;;;;;mestre;11/01/2021;mestre;11/01/2021;
I;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
I;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
I;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
K;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
K;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
K;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
L;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
L;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
L;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
M;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
M;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
M;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
M;MOBCOLETORPRJ;MOBILIDADE - Busca coletores associados ao projeto corrente;"SELECT IDCOLETOR FROM MPRJCOLETOR (NOLOCK)
WHERE (CODCOLIGADA = :$CODCOLIGADA AND IDPRJ = :$IDPRJ)
UNION
SELECT IDCOLETOR FROM MCOLETOR (NOLOCK)
WHERE IDCOLETOR NOT IN (SELECT IDCOLETOR FROM MPRJCOLETOR (NOLOCK))";221;;;;;;0;1;1;1;;;;0;3fbb13ea-f91a-4255-a562-8acdff50927a;;;4474;;;;;
N;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
N;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
N;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
O;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
O;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
O;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
P;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
P;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
P;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
R;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
R;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
R;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
S;AlunoSemUsuário;Aluno Sem usuário;"Select distinct
	m.CODPESSOA
From	
	v_Unasp_SMATRICPL m
	inner join PPESSOA p on p.CODIGO = m.CODPESSOA
Where
	(m.CODPERLET like '2021%' or m.CODPERLET like '2022%')
	and p.CODUSUARIO is null";198;;;;13/12/2021;isaldo;0;1;1;1;;;;0;17e54361-7101-41dc-b4cd-03053b8fe990;0;;12025;isaldo;13/12/2021;isaldo;13/12/2021;0
S;BOLETIM;BOLETIM;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno, 
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
   SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
 ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";;;;;;;0;1;1;1;;;;;;;;19174;RM;30/05/2012;RM;30/05/2012;
S;BolsaFutura.1;Concessão de Bolsas;Select * from v_Unasp_SCONCESSAOBOLSA;37;0;;;14/10/2022;isaldo;0;1;1;1;;;;1;19ba3421-6fd5-441b-bf62-a8a3385770a5;0;;27963;mestre;07/06/2021;isaldo;14/10/2022;0
S;Contrato;Contrato;"SELECT   SH.NOME habilitacao
 , SP.VALOR
 , SP.DESCONTO
 , CASE WHEN SP.DESCONTO IS NULL THEN SP.VALOR ELSE SP.VALOR - SP.DESCONTO END MENSALIDADE 
 , PP.NOME  
 , SA.RA
 , PP.CARTIDENTIDADE
 , PP.ORGEMISSORIDENT
 , RTRIM(PP.RUA) + '  ' + PP.NUMERO + '  ' + RTRIM(PP.COMPLEMENTO) + ' - ' + RTRIM(PP.CIDADE) + ' - ' + RTRIM(PP.BAIRRO) + ' - ' + RTRIM(PP.ESTADO) AS ENDERECO
 , PP.TELEFONE1
 , PP.CEP
 , CF.NOMEFANTASIA  
 , CF.TELEFONE   
 , CF.RUA + '  ' + CF.NUMERO + '  ' + CF.COMPLEMENTO AS ENDERECORESP
 , CF.CGCCFO
 , CF.CEP
 , CF.CIDENTIDADE
 , CF.CI_ORGAO + '-' + CF.CI_UF

FROM    SALUNO   AS SA (NOLOCK)
 , PPESSOA   AS PP (NOLOCK)
 , FCFO    AS CF (NOLOCK)
 , SMATRICPL  AS SM (NOLOCK)
 , SHABILITACAOFILIAL AS HF (NOLOCK)
        , SHABILITACAOFILIALPL  AS HP   (NOLOCK)
 , SHABILITACAO  AS SH (NOLOCK)
 , SPLETIVO  AS PL (NOLOCK)
 , SCONTRATO  AS SC   (NOLOCK)
 , SPARCELA  AS SP   (NOLOCK)

WHERE   SM.CODCOLIGADA = PL.CODCOLIGADA
AND     SM.IDPERLET = PL.IDPERLET
AND     SM.CODCOLIGADA = SA.CODCOLIGADA
AND     SM.RA = SA.RA
AND     SA.CODPESSOA = PP.CODIGO
AND     SA.CODCOLIGADA = CF.CODCOLIGADA
AND     SA.CODCFO = CF.CODCFO
AND     SM.CODCOLIGADA = HF.CODCOLIGADA
AND     SM.IDHABILITACAOFILIAL = HF.IDHABILITACAOFILIAL
AND     HF.CODCOLIGADA = SH.CODCOLIGADA
AND     HF.CODCURSO = SH.CODCURSO
AND     HF.CODHABILITACAO = SH.CODHABILITACAO
AND     SM.CODCOLIGADA = HP.CODCOLIGADA
AND     SM.IDHABILITACAOFILIAL = HP.IDHABILITACAOFILIAL
AND     SM.IDPERLET = HP.IDPERLET
AND     SM.CODCOLIGADA = SC.CODCOLIGADA 
AND     SM.RA = SC.RA
AND     SM.IDPERLET = SC.IDPERLET
AND     SC.CODPLANOPGTO = HP.CODPLANOPGTO
AND     SC.CODCOLIGADA = SP.CODCOLIGADA
AND     SC.IDPERLET = SP.IDPERLET
AND     SC.RA = SP.RA
AND     SC.CODCONTRATO = SP.CODCONTRATO
AND     SP.PARCELA =1
AND     SM.RA =:RA
AND     PL.CODPERLET =:CODPERLET
AND     HF.CODFILIAL =:CODFILIAL
AND     HF.CODCURSO =:CODCURSO
ORDER BY PP.NOME  ";;;;;;;0;1;1;1;;;;;;;;-23279;RM;30/05/2012;RM;30/05/2012;
S;CONTRATO_PORTAL;CONTRATO FINANCEIRO MATRÍCULA ONLINE;"SELECT SMATRICPL.CODCOLIGADA,
SMATRICPL.IDPERLET,
SMATRICPL.IDHABILITACAOFILIAL,
SMATRICPL.RA,
SCONTRATO.CODCONTRATO,
SCONTRATO.CODFILIAL,
SCONTRATO.CODTIPOCURSO
FROM SMATRICPL (NOLOCK)
JOIN SCONTRATO (NOLOCK)
ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
AND SMATRICPL.RA = SCONTRATO.RA
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADAPARAM
AND SCONTRATO.CODFILIAL = :CODFILIALPARAM
AND CODTIPOCURSO = :CODTIPOCURSOPARAM
AND SMATRICPL.IDPERLET = :IDPERLETPARAM
AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIALPARAM
AND SMATRICPL.RA = :RAPARAM";;;;;;;0;1;1;1;;;;;283ce366-0603-480b-bd7c-a2700af8ef2f;;;-24717;sergio;26/04/2022;sergio;26/04/2022;
S;DIP_UNIVERSIDADE;DIPLOMA UNIVERSIDADE;"/*DIPLOMA SUPERIOR IES UNIVERSIDADE PORTARIA 1095: expedidora igual à registradora*/
SELECT 
  SALUNO.CODCOLIGADA,  
  SALUNO.RA,
  SALUNO.CODTIPOCURSO,
  STIPOCURSO.NOME NIVELENSINO,
  PPESSOA.NOME NOMEALUNO,    
  CONVERT(VARCHAR,PPESSOA.DTNASCIMENTO,103) DTNASCIMENTO,
  PPESSOAPAI.NOME NOMEPAI,           
  PPESSOAMAE.NOME NOMEMAE,
  PPESSOA.PAIS PAISALUNO,  
  PPESSOA.NATURALIDADE,
  PPESSOA.NACIONALIDADE,
  PCODNACAO.DESCRICAO NOMENACIONALIDADE,
  PPESSOA.CARTIDENTIDADE, 
  PPESSOA.ORGEMISSORIDENT,
  PPESSOA.UFCARTIDENT,
  PPESSOA.CPF,    
  
  SCURSO.NOME NOMECURSO, 
  SCURSO.CODCURSO,
  SCURSO.DECRETO,
  SCURSO.REGCONTRATO,
  SCURSO.CODCURINEP, 
  
  SHABILITACAOFILIAL.CODHABILITACAO,
  SHABILITACAOFILIAL.DECRETOCURSO,
  SHABILITACAOFILIAL.DESCRICAOCURSO,
  SHABILITACAOFILIAL.DECRETOHABILITACAO,
  SHABILITACAOFILIAL.DESCRICAOHABILITACAO,
  SHABILITACAOFILIAL.IDCURSOMEC,
  SHABILITACAOFILIAL.IDHABILITACAOFILIAL, 
  
  SHABILITACAO.NOME HABILITACAO,  
  SHABILITACAO.CODHABINEP,
  SHABILITACAO.CODTIPOHABILITACAO,
  
  SHABILITACAOALUNO.CODINST,
  SHABILITACAOALUNO.CODINSTDIPLOMA,
  SHABILITACAOALUNO.CODINSTDESTINO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO, 103) DTCONCLUSAOCURSO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU, 103) DTCOLACAOGRAU,  
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTINGRESSO, 103) DTINGRESSO,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISDIPLOMA, 103) DTEMISDIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTREGISTRODIPLOMA, 103) DTREGISTRODIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISSAODOU, 103) DTEMISSAODOU,
  SHABILITACAOALUNO.REGISTROCONCLUSAO,
  SHABILITACAOALUNO.LIVROREGISTRO, 
  SHABILITACAOALUNO.PROCESSOREGISTRO,
  SHABILITACAOALUNO.PAGINAREGISTRO,
  
  SAUTORIZACAOCURSO.ATOREGULATORIO,  
  SAUTORIZACAOCURSO.NUMRESOLUCAO,
  CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRESOLUCAO, 103) DTRESOLUCAO,
  SAUTORIZACAOCURSO.NUMPUBLICACAO,
  SAUTORIZACAOCURSO.PAGINAPUBLICACAO,
  SAUTORIZACAOCURSO.SECAOPUBLICACAO,  
  SAUTORIZACAOCURSO.TIPOAUTORIZACAO,  
            
  CASE WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '3' THEN 'Ata'
   ELSE 'PENDENTE' END DESCRICAOTIPOAUTORIZACAO, 

  CASE WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '1' THEN 'Autorizado'
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '2' THEN 'Reconhecido' 
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '3' THEN 'Renovação de Reconhecimento'
   ELSE 'PENDENTE' END DESCRICAOATOREGULATORIO,
     
   	
  COALESCE(SAUTORIZACAOCURSO.LOCALAUTORIZ, 'DOU') LOCALAUTORIZ, 	
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOURECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOUAUTORIZACAO,103)) DTDOURECONHECIMENTO,
  COALESCE(SAUTORIZACAOCURSO.PORTRECONHECIMENTO, SAUTORIZACAOCURSO.PORTAUTORIZACAO)   PORTRECONHECIMENTO,  
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTAUTORIZACAO,103)) DTRECONHECIMENTO,
   	
   	
  SINSTITUICAO.NOME NOMEREGISTRADORA,
  SINSTITUICAO.CODEMEC CODEMECREGISTRADORA,
  SINSTITUICAO.DIRETOR DIRETORREGISTRADORA,
   
  GIMAGEM.IMAGEM IMAGEMFILIAL,   
  GFILIAL.CODFILIAL,
  GFILIAL.NOME NOMEFILIAL,
  GFILIAL.CGC CGCFILIAL,
  GFILIAL.CIDADE CIDADEFILIAL,
  GFILIAL.RUA RUAFILIAL,
  GFILIAL.COMPLEMENTO COMPLEMENTOFILIAL,
  GFILIAL.BAIRRO BAIRROFILIAL,
  GFILIAL.NUMERO NUMEROFILIAL,
  GFILIAL.ESTADO ESTADOFILIAL,
  GFILIAL.PAIS PAISFILIAL,
  GFILIAL.CEP CEPFILIAL,
  GFILIAL.IDIMAGEM IDIMAGEMFILIAL,
  
  PPESSOADIRECAO.NOME NOMEDIRETORFILIAL,
  GDIR.IMAGEM ASSINATURADIRETORFILIAL,
  
  PPESSOASECRETARIO.NOME NOMESEC1FILIAL,
  GSEC1.IMAGEM ASSINATURASEC1FILIAL, 
  
  SAUTORIZACAOFILIAL.MODALIDADE IES_MODALIDADE,
  
  CASE WHEN SAUTORIZACAOFILIAL.ATOREGULATORIO = '1' THEN 'Credenciada'
  ELSE 'Recredenciada' END IES_ATOREGULATORIO,
  
  CASE WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '3' THEN 'Ata' END IES_TIPOAUTORIZ,
  
  SAUTORIZACAOFILIAL.NRAUTORIZ IES_NRAUTORIZ,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTAUTORIZ, 103) IES_DTAUTORIZ,
  SAUTORIZACAOFILIAL.RECAUTORIZ IES_RECAUTORIZ,
  SAUTORIZACAOFILIAL.LOCALAUTORIZ IES_LOCALAUTORIZ,
  SAUTORIZACAOFILIAL.NUMPUBLICACAO IES_NUMPUBLICACAO,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTPUBLICACAO, 103) IES_DTPUBLICACAO,
  SAUTORIZACAOFILIAL.SECAOPUBLICACAO IES_SECAOPUBLICACAO,
  SAUTORIZACAOFILIAL.PAGINAPUBLICACAO IES_PAGINAPUBLICACAO
  
FROM SHABILITACAOFILIAL (NOLOCK) 
JOIN SHABILITACAOALUNO (NOLOCK)
      ON (SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
          AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  LEFT JOIN SAUTORIZACAOCURSO (NOLOCK)
      ON (SAUTORIZACAOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
      AND SAUTORIZACAOCURSO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
      AND SAUTORIZACAOCURSO.CODAUTORIZACURSO = (SELECT MAX(CODAUTORIZACURSO)
                                                FROM SAUTORIZACAOCURSO SAUTORIZACAOCURSO2 (NOLOCK)
                                                WHERE SAUTORIZACAOCURSO2.CODCOLIGADA = SAUTORIZACAOCURSO.CODCOLIGADA
                                                  AND SAUTORIZACAOCURSO2.IDHABILITACAOFILIAL = SAUTORIZACAOCURSO.IDHABILITACAOFILIAL))
  JOIN SALUNO (NOLOCK) 
      ON (SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA 
          AND SALUNO.RA = SHABILITACAOALUNO.RA)  
  JOIN PPESSOA (NOLOCK) 
      ON (PPESSOA.CODIGO = SALUNO.CODPESSOA)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  LEFT JOIN PCODNACAO (NOLOCK)
    ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)      
  JOIN GFILIAL (NOLOCK) 
     ON (GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
         AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)        
    
  LEFT JOIN SFILIAL (NOLOCK)
      ON (GFILIAL.CODCOLIGADA = SFILIAL.CODCOLIGADA
          AND GFILIAL.CODFILIAL = SFILIAL.CODFILIAL)
  LEFT JOIN SDIRECAOFILIAL (NOLOCK)
      ON (SFILIAL.CODCOLIGADA = SDIRECAOFILIAL.CODCOLIGADA
          AND SFILIAL.CODFILIAL = SDIRECAOFILIAL.CODFILIAL)
 
  LEFT JOIN PPESSOA PPESSOADIRECAO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOA = PPESSOADIRECAO.CODIGO  )
  LEFT JOIN PPESSOA PPESSOASECRETARIO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC1 = PPESSOASECRETARIO.CODIGO  )     
      
  LEFT JOIN GIMAGEM GDIR(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURA = GDIR.ID   
  LEFT JOIN GIMAGEM GSEC1(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURASEC1 = GSEC1.ID 
  LEFT JOIN GIMAGEM (NOLOCK)     ON GFILIAL.IDIMAGEM = GIMAGEM.ID     
  
  JOIN STIPOCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA AND
        SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)        
  JOIN SHABILITACAO (NOLOCK) 
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO 
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN SGRADE (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO AND
          SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO AND
          SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE 
  JOIN SCURSO (NOLOCK) 
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
          AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   
  JOIN SCURSOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.IDCURSOMEC  = SCURSOMEC.IDCURSOMEC
  LEFT JOIN SINSTITUICAOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SINSTITUICAOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODFILIAL = SINSTITUICAOMEC.CODFILIAL
          
  LEFT JOIN SINSTITUICAO (NOLOCK)
      ON SHABILITACAOALUNO.CODINSTDIPLOMA = SINSTITUICAO.CODINST

  LEFT JOIN
             (SELECT CODCOLIGADA,
                     CODAUTORIZACAO,
                     IDINSTITUICAOMEC,
                     CODFILIAL,
                     CODTIPOCURSO,
                     MODALIDADE,
                     ATOREGULATORIO,
                     TIPOAUTORIZ,
                     NRAUTORIZ,
                     DTAUTORIZ,
                     RECAUTORIZ,
                     COALESCE(LOCALAUTORIZ, 'DOU') LOCALAUTORIZ,
                     NUMPUBLICACAO,
                     DTPUBLICACAO,
                     SECAOPUBLICACAO,
                     PAGINAPUBLICACAO
              FROM SAUTORIZACAOFILIAL (NOLOCK)
              WHERE CODAUTORIZACAO = (SELECT MAX(AUX.CODAUTORIZACAO)
                                      FROM SAUTORIZACAOFILIAL AUX (NOLOCK)
                                      WHERE AUX.CODCOLIGADA = SAUTORIZACAOFILIAL.CODCOLIGADA
                                        AND AUX.IDINSTITUICAOMEC = SAUTORIZACAOFILIAL.IDINSTITUICAOMEC)) SAUTORIZACAOFILIAL
             ON (SAUTORIZACAOFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
             AND SAUTORIZACAOFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)      
WHERE 
SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA_N
AND SHABILITACAOALUNO.RA = :RA_S
and SHABILITACAOALUNO.DTCONCLUSAOCURSO IS NOT NULL";;;;;;;0;1;1;1;;;;;1b101a67-7877-42c2-9fe4-06ca3f89ccfb;;;-3006;lilian.buzetti;21/09/2021;lilian.buzetti;21/09/2021;
S;DIPLOMA.001;Diplomas Alunos por Curso;"SELECT 
	SCERTIFICADO.IDCERTIFICADO,
	SCERTIFICADO.DATACERTIFICADO,
	SCERTIFICADO.RA,
	SCERTIFICADO.STATUS,
	SCERTIFICADO.FOLHA,
	SCERTIFICADO.NUMREGISTRO,
	CAST(SCERTIFICADO.CARGAHORARIA AS INT) AS 'CARGAHORARIA',
	SCERTIFICADO.NUMPROCESSO AS 'ISEMISSAOEREGISTRO',
	SCERTIFICADO.CODLIVRO,
	SCERTIFICADO.DTCONFERENCIA,
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.NOME AS 'CURSO',
	SINSTITUICAO.NOME AS 'IESREGISTRO',
	SEMI.NOME AS 'IESEMISSAO',
	SLIVRO.DESCRICAO AS 'LIVRO'
FROM SCERTIFICADO (NOLOCK)
INNER JOIN SINSTITUICAO (NOLOCK) ON SINSTITUICAO.CODINST = SCERTIFICADO.CODINSTREGISTRO
INNER JOIN SINSTITUICAO (NOLOCK) SEMI ON SEMI.CODINST = SCERTIFICADO.CODINSTEMISSAO
INNER JOIN SLIVRO (NOLOCK) ON SCERTIFICADO.CODCOLIGADA = SLIVRO.CODCOLIGADA
	AND SCERTIFICADO.CODLIVRO = SLIVRO.CODLIVRO
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SALUNO.RA = SCERTIFICADO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCERTIFICADO.IDHABILITACAOFILIAL
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
WHERE SCURSO.NOME LIKE '%' + :CURSO + '%'

ORDER BY PPESSOA.NOME";1910;;;;02/06/2022;consultor1.totvs;0;1;1;1;;;;0;d2c0b75e-7fe9-4ecc-bcd8-c1cc6e8760e2;0;;11698;consultor1.totvs;01/06/2022;consultor1.totvs;02/06/2022;0
S;DIPLOMA.002;Diplomas Alunos por Curso;"SELECT 
	SCERTIFICADO.IDCERTIFICADO,
	SCERTIFICADO.DATACERTIFICADO,
	SCERTIFICADO.RA,
	SCERTIFICADO.STATUS,
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	SCERTIFICADO.FOLHA,
	SCERTIFICADO.NUMREGISTRO,
	CAST(SCERTIFICADO.CARGAHORARIA AS INT) AS 'CARGAHORARIA',
	SCERTIFICADO.NUMPROCESSO AS 'ISEMISSAOEREGISTRO',
	SCERTIFICADO.CODLIVRO,
	SCERTIFICADO.DTCONFERENCIA,
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.NOME AS 'CURSO',
	SINSTITUICAO.NOME AS 'IESREGISTRO',
	SEMI.NOME AS 'IESEMISSAO',
	SLIVRO.DESCRICAO AS 'LIVRO',
	1 AS TOTAL,
	ZMDASSINATURAS.IMAGEM AS 'ASSINATURA'
FROM SCERTIFICADO (NOLOCK)
INNER JOIN SINSTITUICAO (NOLOCK) ON SINSTITUICAO.CODINST = SCERTIFICADO.CODINSTREGISTRO
INNER JOIN SINSTITUICAO (NOLOCK) SEMI ON SEMI.CODINST = SCERTIFICADO.CODINSTEMISSAO
INNER JOIN SLIVRO (NOLOCK) ON SCERTIFICADO.CODCOLIGADA = SLIVRO.CODCOLIGADA
	AND SCERTIFICADO.CODLIVRO = SLIVRO.CODLIVRO
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SALUNO.RA = SCERTIFICADO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCERTIFICADO.IDHABILITACAOFILIAL
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN ZMDASSINATURAS ON ZMDASSINATURAS.ID = 15
WHERE SCERTIFICADO.NUMPROCESSO BETWEEN :PROCINI AND :PROCFIM
AND GFILIAL.CODFILIAL = :CODFILIAL

ORDER BY PPESSOA.NOME";2110;;;;06/06/2022;consultor1.totvs;0;1;1;1;;;;0;d2c0b75e-7fe9-4ecc-bcd8-c1cc6e8760e2;0;;-5544;consultor1.totvs;06/06/2022;consultor1.totvs;06/06/2022;0
S;EDU.EE001;Relatório de inadimplentes;"select distinct
	sc.DESCRICAO,vf.CURSO,va.RA,va.Nome,va.email,va.TELEFONE1,ss.DESCRICAO,
	convert(decimal(18,2),vf.[SALDO A RECEBER]) [SALDO A RECEBER], vf.ANO, vf.MES
from 
	v_Unasp_PBI_FN_Financeiro vf
	inner join v_unasp_aluno va on va.RA = vf.RA
	inner join SMATRICPL sm on sm.CODCOLIGADA=vf.COLIGADA and sm.IDPERLET=vf.IDPERLET and sm.IDHABILITACAOFILIAL=vf.IDHABILITACAOFILIAL and sm.RA=vf.RA
	left join SSTATUS ss on ss.CODCOLIGADA=sm.CODCOLIGADA and ss.CODSTATUS=sm.CODSTATUS
	left join (select CODCAMPUS, DESCRICAO from SCAMPUS where CODCAMPUS in ('1','2','3','4')) sc on sc.CODCAMPUS=vf.FILIAL
where
	vf.COLIGADA = :CODCOLIGADA1
	and vf.TURMA = :CODTURMA1
	and vf.FILIAL = :CODFILIAL1
	and vf.IDPERLET = :IDPERLET1
	and vf.[SALDO A RECEBER] > 0
	and (vf.ANO * 100 + vf.MES) <= CAST(YEAR(GETDATE()) AS CHAR(4)) + RIGHT('0' + CAST(MONTH(GETDATE()) AS VARCHAR(2)),2)	
order by
	va.Nome";909;;;;19/09/2022;lucas.marques;0;1;1;1;;;;0;4d2fb298-1c90-4d74-a07d-f6aef8cf180c;0;;-11978;lucas.marques;27/07/2022;lucas.marques;19/09/2022;0
S;EDU.EE002;Lista de Chamada;"select distinct
	NomFilial Campus,RA,Nome,NomDisciplina Disciplina,' ' Segunda, ' ' Terça,' ' Quarta,' ' Quinta,' ' Sexta
from 
	v_unasp_smatricula
where
	codtipocurso = 3
	and NomCurso = 'escola de esportes'
	and NomStatus = 'cursando'
	and NomFilial = :Nome_Campus
order by
	NomFilial,NomDisciplina, Nome";316;;;;27/07/2022;lucas.marques;0;1;1;1;;;;0;06d544ca-0bbb-4444-a3dc-9bc80e877d6c;0;;12650;lucas.marques;27/07/2022;lucas.marques;27/07/2022;0
S;EDU.EE003;Lista de turmas;"select distinct
	vum.CODTURMA Turma,vum.NomFilial Campus,vum.RA,vum.Nome,vum.NomDisciplina Disciplina, vum.TELEFONE1 'Tel 1',
	vum.telefone2 'Tel 2', vum.telefone3 'Tel 3', DATEDIFF(YEAR,vua.DTNASCIMENTO, GETDATE()) + Case when(MONTH (vua.DTNASCIMENTO)
	> MONTH(GETDATE()) or (MONTH(vua.DTNASCIMENTO) = MONTH(GETDATE()) and
    DAY(vua.DTNASCIMENTO) > DAY(GETDATE()))) then -1 Else 0 end as Idade,
	sh.HORAINICIAL Entrada, sh.HORAFINAL Saída
from 
	v_unasp_smatricula(nolock) vum
	inner join v_Unasp_Aluno(nolock) vua on vua.RA = vum.RA
	left join SHORARIOTURMA(nolock) sht on sht.IDTURMADISC = vum.IDTURMADISC
	left join SHORARIO sh(nolock) on sh.CODHOR = sht.CODHOR
where
	vum.codtipocurso = 3
	and vum.NomCurso = 'escola de esportes'
	and vum.NomStatus = 'cursando'
	and vum.CODFILIAL = :Filial
order by
	vum.NomDisciplina,vum.CODTURMA, vum.Nome";865;;;;16/08/2022;lucas.marques;0;1;1;1;;;;0;3108b651-be5f-40ae-aa00-4dda6b8c868c;0;;-5218;lucas.marques;27/07/2022;lucas.marques;16/08/2022;0
S;EDU.FAT;Pesquisa matriz sem valor;"select
	sh.CODGRADE,sh.NomFilial,sh.NomTipoCurso,sh.NomGrade,sh.Status,sh.CODPERLET,vl.VALOR
from 
	v_Unasp_SHABILITACAOFILIALPL(nolock) sh
	left join ZMDVLMAT(nolock) vl on vl.IDPERLET=sh.IDPERLET 
	and vl.IDHABILITACAOFILIAL=sh.IDHABILITACAOFILIAL 
	and vl.CODCOLIGADA=sh.CODCOLIGADA
where
	sh.IDPERLET= :Periodo_Letivo";329;;;;10/10/2022;lucas.marques;0;1;1;1;;;;0;cd3ed7c4-a3ed-4525-bf1f-9d110360f5db;0;;4704;lucas.marques;10/10/2022;lucas.marques;10/10/2022;0
S;EDU.FIN001;;"SELECT
	SCONTRATO.CODCOLIGADA,
	SCONTRATO.CODCONTRATO,
	SCONTRATO.RA,
	SCONTRATO.IDPERLET,
	PPESSOA.NOME
FROM SCONTRATO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.RA = SCONTRATO.RA
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
WHERE SMATRICPL.CODTIPOMAT = 2
AND SPLETIVO.CODPERLET = :CODPERLET
AND SPLETIVO.CODTIPOCURSO = :$CODTIPOCURSO
AND SPLETIVO.CODFILIAL = :$CODFILIAL
AND SPLETIVO.CODCOLIGADA = :$CODCOLIGADA";804;;;;10/11/2022;consultor1.totvs;0;1;1;1;;;;0;b5ac3b98-2e64-4cb2-bfad-ab5f9850666b;0;;24605;consultor1.totvs;10/11/2022;consultor1.totvs;10/11/2022;0
S;EDU.PROF001;Turmas Disciplinas 2023/1;"SELECT STURMADISC.IDTURMADISC
FROM STURMADISC
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPLETIVO.CODPERLET = '2023/1'";199;;;;18/10/2022;consultor1.totvs;0;1;1;1;;;;0;37a3ccd3-7d2e-4212-be6e-d3dc5142df5a;0;;-12678;consultor1.totvs;18/10/2022;consultor1.totvs;18/10/2022;0
S;EDU.PROHELP;PROHELP - Acompanhamento dos diários;"SELECT NomFilial                          AS 'Campus',
       NomTipoCurso                       'Nível Ensino',
       NomCurso                           AS 'Curso',
       CODTURMA                           AS 'Turma',
       NomDisciplina,
       p.NomProfessor,
       tb2.Sem_Preenchimento_Ontem        AS 'em atraso',
       CASE
         WHEN tb.Total_Licao > 0 THEN 'Preenchido'
         ELSE 'Não Preenchido'
       END                                AS 'Tem AED',
       Cast(v.NUMCREDITOS * 20 AS BIGINT) AS 'CH',
       e.Total_AulasDadas                 AS 'chamada',
       tb.Total_Branco                    AS 'Planos em branco',
       STURMADISCGERENCIADA.IDTURMADISC   AS 'id Gerencial',
       v.IDTURMADISC                      AS 'Código',
       v.GERENCIAL,
       v.NomTipoTurmaDisc,
       tb.Total_PlanoAula                 AS 'Planos criados',
       prova.Total_Provas                 AS 'Qtd.provas criadas',
       prova.Total_Peso                   AS 'Total Pesos',
       prova.Total_Bonus                  AS 'Bonus na média',
       p.EMAIL
FROM   v_Unasp_STURMADISC v
       INNER JOIN(SELECT idturmadisc,
                         Count(*) Total_PlanoAula,
                         Sum(CASE
                               WHEN CONTEUDOEFETIVO IS NULL
                                     OR CONVERT(VARCHAR (MAX), CONTEUDOEFETIVO) = '' THEN 1
                               ELSE 0
                             END) Total_Branco,
                         Sum(CASE
                               WHEN LICAOCASA <> '' THEN 1
                               ELSE 0
                             END) Total_Licao
                  FROM   SPLANOAULA
                  GROUP  BY IDTURMADISC) tb
               ON tb.IDTURMADISC = v.IDTURMADISC
       INNER JOIN(SELECT idturmadisc,
                         Count(*) Total_PlanoAula,
                         Sum(CASE
                               WHEN CONTEUDOEFETIVO IS NULL
                                    AND DATA < Getdate() THEN 1
                               ELSE 0
                             END) Sem_Preenchimento_Ontem,
                         Sum(CASE
                               WHEN LICAOCASA <> '' THEN 1
                               ELSE 0
                             END) Total_Licao
                  FROM   SPLANOAULA
                  GROUP  BY IDTURMADISC) tb2
               ON tb2.IDTURMADISC = v.IDTURMADISC
       INNER JOIN(SELECT idturmadisc,
                         Sum(AULASDADAS) Total_AulasDadas
                  FROM   SETAPAS
                  GROUP  BY IDTURMADISC) e
               ON e.IDTURMADISC = v.IDTURMADISC
       LEFT JOIN(SELECT pt.IDTURMADISC,
                        pp.EMAIL,
                        Min(pp.NOME) NomProfessor
                 FROM   SPROFESSORTURMA pt
                        INNER JOIN SPROFESSOR p
                                ON p.CODCOLIGADA = pt.CODCOLIGADA
                                   AND p.CODPROF = pt.CODPROF
                        INNER JOIN PPESSOA pp
                                ON pp.CODIGO = p.CODPESSOA
                 WHERE  pt.TIPOPROF = 't'
                 GROUP  BY pt.IDTURMADISC,
                           pp.EMAIL) p
              ON p.IDTURMADISC = v.IDTURMADISC
       LEFT JOIN (SELECT p.IDTURMADISC,
                         Count(*) Total_Provas,
                         Sum(CASE
                               WHEN pc.TIPO = 'C' THEN pc.PESO
                             END) Total_Peso,
                         Sum(CASE
                               WHEN pc.tipo = 'S' THEN pc.PESO
                             END) Total_Bonus
                  FROM   SPROVAS p
                         LEFT JOIN SPROVASCOMPL pc
                                ON pc.CODCOLIGADA = p.CODCOLIGADA
                                   AND pc.IDTURMADISC = p.IDTURMADISC
                                   AND pc.CODETAPA = p.CODETAPA
                                   AND pc.TIPOETAPA = p.TIPOETAPA
                                   AND pc.CODPROVA = p.CODPROVA
                  WHERE  p.CODETAPA = 1
                  GROUP  BY p.IDTURMADISC) prova
              ON prova.IDTURMADISC = v.IDTURMADISC
       /*adicionamos a partir daqui*/
       LEFT JOIN STURMADISCGERENCIADA (NOLOCK)
              ON STURMADISCGERENCIADA.CODCOLIGADA = V.CODCOLIGADA
                 AND STURMADISCGERENCIADA.IDTURMADISCGERENCIADA = V.IDTURMADISC
WHERE  v.CODPERLET = :Periodo_letivo
/*and tb.Total_PlanoAula <> tb.Total_Branco*/
ORDER  BY NomFilial,
          NomCurso 
";4644;;;;14/11/2022;marccella.belvedere;0;1;1;1;;;;0;a97b989d-52ac-42fa-beb3-c4d4c935824c;0;;-32307;lucas.marques;04/10/2022;marccella.belvedere;14/11/2022;0
S;EDU.PROHELP01;PROHELP - Complemento de atividades em espaços diversificados;"select 
	NomFilial as 'Campus',
	NomCurso as 'Curso',
	CODTURMA as 'Turma', 
	NomDisciplina,
	cast(v.NUMCREDITOS * 5 as bigint) as 'Horas previstas', 
	v.IDTURMADISC as 'codigo',
	p.NomProfessor,p.EMAIL,pa.AULA as 'Resgistrado no plano de aula nº:',
	format(pa.DATA, 'dd/MM/yyyy') as 'Data registrada',
	h.HORAINICIAL,pa.LICAOCASA as 'AED Preenchido no campo lição de casa'
from 
	v_Unasp_STURMADISC v
	inner join SPLANOAULA pa on pa.IDTURMADISC=v.IDTURMADISC
	inner join SHORARIO h on h.CODCOLIGADA=pa.CODCOLIGADA and h.CODHOR=pa.CODHOR
	left join(  select 
					pt.IDTURMADISC,pp.EMAIL, min(pp.NOME) NomProfessor 
				from 
					SPROFESSORTURMA pt 
					inner join	SPROFESSOR p on p.CODCOLIGADA=pt.CODCOLIGADA and p.CODPROF=pt.CODPROF 
					inner join PPESSOA pp on pp.CODIGO=p.CODPESSOA 
				where 
					pt.TIPOPROF = 't'
				group by
					pt.IDTURMADISC,pp.EMAIL) p on p.IDTURMADISC=v.IDTURMADISC
where
	v.CODPERLET = :Periodo_letivo
	and v.CODTIPOCURSO = 1
	and isnull(pa.LICAOCASA,'') <> ''";1023;;;;18/10/2022;marccella.belvedere;0;1;1;1;;;;0;43199f28-c506-4095-b6fd-9994182ace57;0;;31473;lucas.marques;04/10/2022;marccella.belvedere;18/10/2022;0
S;EDU.RH001;Agrupar Pessoas;select * from z_Unasp_Log_Agrupamento_Pessoa;44;;;;02/08/2022;lucas.marques;0;1;1;1;;;;0;1e5f70a1-f68a-4ac7-8a9a-7b5a54f024d6;0;;-5668;lucas.marques;02/08/2022;lucas.marques;02/08/2022;0
S;EDU.SEC001;Dados Cadatrais Aluno por Periodo Letivo;"SELECT DISTINCT
	GFILIAL.NOMEFANTASIA AS 'FILIAL',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	PPESSOA.NOME AS 'ALUNO',
	SALUNO.RA,
	SCURSO.NOME AS 'CURSO',
	PPESSOA.EMAIL,
	PPESSOA.TELEFONE1,
	PPESSOA.TELEFONE2,
	PPESSOA.CEP,
	PPESSOA.RUA,
	PPESSOA.BAIRRO,
	PPESSOA.NUMERO,
	PPESSOA.CIDADE,
	PPESSOA.ESTADO,
	PPESSOA.CPF,
	PPESSOA.CARTIDENTIDADE,
	CONVERT(varchar,PPESSOA.DTNASCIMENTO,103) AS 'DTNASCIMENTO',
	SSTATUS.DESCRICAO AS 'STATUS PERIODO LETIVO',
	S2.DESCRICAO AS 'STATUS CURSO HABILITACAO',
	ISNULL(A.[COMPARECEU ENADE],'NAO PREENCHIDO') AS 'COMPARECEU ENADE',
	ISNULL(A.DTPROVAENADE,'NAO PREENCHIDO') AS 'DTPROVAENADE',
	ISNULL(A.ENADE,'NAO PREENCHIDO') AS 'ENADE',
	ISNULL(A.OBSENADE,'NAO PREENCHIDO') AS 'OBSENADE'
FROM SALUNO (NOLOCK)
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SSTATUS S2 (NOLOCK) ON S2.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND S2.CODSTATUS = SHABILITACAOALUNO.CODSTATUS

LEFT JOIN(

SELECT DISTINCT
	SMATRICPL.SELMECENADE,
	CASE SMATRICPL.SELMECENADE 
	WHEN 'N' THEN 'DISPENSADO'
	WHEN 'S' THEN 'SELECIONADO'
	WHEN '0' THEN 'NENHUM'
	ELSE 'NAO PREENCHIDO'

	END ENADE,
	CASE SMATRICPL.COMPARECEUENADE
		WHEN 'S' THEN 'SIM'
		ELSE 'NAO'
	END 'COMPARECEU ENADE',
	CONVERT(VARCHAR,SMATRICPL.DTPROVAENADE,103) AS 'DTPROVAENADE',
	CAST(SMATRICPL.OBSENADE AS varchar) AS 'OBSENADE',
	SMATRICPL.CODCOLIGADA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SMATRICPL.RA,
	SPLETIVO.CODPERLET,
	SMATRICPL.CODTURMA

FROM SMATRICPL (NOLOCK)
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN(
SELECT SM.CODCOLIGADA,
	SM.RA,
	SM.IDHABILITACAOFILIAL,
	MAX(IDPERLET) AS IDPERLET
	FROM SMATRICPL SM (NOLOCK)
	WHERE SM.SELMECENADE IS NOT NULL
	GROUP BY SM.CODCOLIGADA,
	SM.RA,
	SM.IDHABILITACAOFILIAL
	) AS A ON A.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND A.RA = SMATRICPL.RA
	AND A.IDPERLET = SMATRICPL.IDPERLET

WHERE 1=1
AND SMATRICPL.SELMECENADE IS NOT NULL

) AS A ON A.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND A.RA = SMATRICPL.RA
	AND A.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

	
WHERE SPLETIVO.CODPERLET = :CODPERLET_S

ORDER BY 1,2,3,4";3664;;;;06/04/2022;consultor1.totvs;0;1;1;1;;;;1;0fcb72bd-edf3-4b7c-8653-8fbcf66836fb;0;;12175;consultor1.totvs;06/04/2022;consultor1.totvs;06/04/2022;0
S;EDU.SEC002;Alunos Percentual Conclusao do Curso - ENADE (prohelp);"/* Modo de Uso:
SIMBOLO (Ex: >= ) - Maior ou igual
PERCE (Ex: 75 ) - Percentual de conclusão
*/
IF :SIMBOLO = '>='
BEGIN

SELECT
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SALUNO.RA,
	PPESSOA.NOME AS 'ALUNO',
	PPESSOA.CPF,
	SGRADE.DESCRICAO AS 'MATRIZ',
	SCAMPUS.DESCRICAO AS 'CAMPUS',
	SCAMPUS.CAMPUSMEC,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	SCURSOMEC.CODINEPCURSO AS 'CODEMEC CURSO',
	SINSTITUICAOMEC.CODEMEC AS 'CODEMEC INSTITUICAO',
	SINSTITUICAO.NOMEFANTASIA AS 'ESCOLA',
	SSTATUS.DESCRICAO AS 'STATUS CURSO',
	SGRAU.DESCRICAO AS 'GRAU',
	SPESSOA.ANOULTIMAINST AS 'CONCLUSAO ENSINO MEDIO',
	PENDENTES.TOTAL AS 'DISCIPLINAS PENDENTES',
	DTPERLET.DTINICIO AS 'DTINGRESSO',
	B.TCOMPOMENTE 'TOTAL O.C.C',
	A.TOTALATIV 'O.C.C CONCLUIDOS',
	ISNULL(CAST(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2)) AS VARCHAR),0) + '%' AS 'CONCLUIDO',
	ISNULL(CAST(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2)) AS VARCHAR),0) + '%' AS 'CONCLUIDO SEM O.C.C',
		CASE WHEN (100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2))) - A.EMCURSO < 0 THEN '0%'
	ELSE CAST((100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2))) - A.EMCURSO AS VARCHAR) + '%'
	END AS 'RESTANTE',
			CASE WHEN (100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2))) - A.EMCURSO < 0 THEN '0%'
	ELSE CAST((100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2))) - A.EMCURSO AS VARCHAR) + '%'
	END AS 'RESTANTE SEM O.C.C',
	A.EMCURSO,
	SGRADE.CARGAHORARIA
	
FROM SHISTDISCCONCLUIDAS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO



OUTER APPLY (
SELECT 
	MIN(SPLETIVO.DTINICIO) AS DTINICIO,
	SMATRICPL.RA,
	SHF.CODCURSO,
	SMATRICPL.CODCOLIGADA
FROM SMATRICPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
WHERE SMATRICPL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SMATRICPL.RA = SHISTDISCCONCLUIDAS.RA
	AND SHF.CODCURSO = SHABILITACAOFILIAL.CODCURSO
GROUP BY SHF.CODCURSO,
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA

) AS DTPERLET



LEFT JOIN (

SELECT 
	SUM(SHISTDISCOPTELETIVAS.CH) AS 'TOPTATIVAS',
	SHISTDISCOPTELETIVAS.CODCOLIGADA,
	SHISTDISCOPTELETIVAS.RA,
	SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
FROM SHISTDISCOPTELETIVAS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

OUTER APPLY(
SELECT SUM(SCP.VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR SCP
WHERE SCP.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
	AND SCP.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
) AS D

WHERE SGRADE.STATUS <> 1
AND SHISTDISCOPTELETIVAS.STATUS LIKE '%APROVADO%'
GROUP BY SHISTDISCOPTELETIVAS.CODCOLIGADA,
	SHISTDISCOPTELETIVAS.RA,
	SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL

) AS OPT ON OPT.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND OPT.RA = SHISTDISCCONCLUIDAS.RA
	AND OPT.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL


OUTER APPLY(
SELECT SUM(VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR 
WHERE SCOMPONENTECURRICULAR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCOMPONENTECURRICULAR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
) AS B


INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
LEFT JOIN SFILIAL ON SFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
	AND SFILIAL.CODFILIAL = GFILIAL.CODFILIAL
LEFT JOIN SINSTITUICAOMEC ON SINSTITUICAOMEC.CODCOLIGADA = SFILIAL.CODCOLIGADA
	AND SINSTITUICAOMEC.CODFILIAL = SFILIAL.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN STURNO ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SHISTDISCCONCLUIDAS.RA
LEFT JOIN SCAMPUS ON SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
LEFT JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
LEFT JOIN SCURSOMEC ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SALUNO.RA = SHISTDISCCONCLUIDAS.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
LEFT JOIN SPESSOA ON SPESSOA.CODIGO = PPESSOA.CODIGO
LEFT JOIN SINSTITUICAO ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
LEFT JOIN SGRAU ON SGRAU.CODGRAU = SPESSOA.GRAUULTIMAINST
	



OUTER APPLY (

SELECT 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL,
	SUM(SHD.CH) AS 'TDISC'
FROM SHISTDISCCONCLUIDAS SHD
INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHF.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHD.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC

WHERE SDGC.ZERARCREDFINRECALC IS NULL
	AND SHD.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHD.RA = SHISTDISCCONCLUIDAS.RA
	AND SHD.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL

GROUP BY SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL
) AS DISCGRADE



LEFT JOIN (

SELECT 
	/*CAST(CAST((((SUM(SHISTDISCPENDENTES.CH) + CASE WHEN ATALU.TATIV >= C.TCOMPOMENTE THEN 0 ELSE (C.TCOMPOMENTE - ATALU.TATIV) END) *100) / SGRADE.CARGAHORARIA) AS DECIMAL(10,2)) AS VARCHAR) + '%' AS 'PENDENTE',*/
	ISNULL(CAST(((SUM(SHISTDISCPENDENTES.CH) *100) / (SGRADE.CARGAHORARIA - C.TCOMPOMENTE)  ) AS DECIMAL(10,2)),0) AS 'EMCURSO',
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	SUM(SHISTDISCPENDENTES.CH) AS 'DISCEMCURSO',
	CASE WHEN ATALU.TATIV >= C.TCOMPOMENTE THEN C.TCOMPOMENTE ELSE (C.TCOMPOMENTE - ATALU.TATIV) END TOTALATIV
FROM SHISTDISCPENDENTES
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHISTDISCPENDENTES.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC


OUTER APPLY(
SELECT SUM(SC.VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR SC
WHERE SC.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SC.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
) AS C


OUTER APPLY(

SELECT SUM(CARGAHORARIAATV) AS 'TATIV'
FROM SATIVIDADEALUNO
WHERE SATIVIDADEALUNO.RA = SHISTDISCPENDENTES.RA
AND SATIVIDADEALUNO.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
AND SATIVIDADEALUNO.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
AND SATIVIDADEALUNO.CUMPRIUATIVIDADE = 'S'
) AS ATALU


WHERE SGRADE.STATUS <> 1
AND SHISTDISCPENDENTES.STATUS IS NOT NULL
AND SDGC.ZERARCREDFINRECALC IS NULL
GROUP BY SGRADE.CARGAHORARIA,
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	ATALU.TATIV,
	C.TCOMPOMENTE,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL

) AS A ON A.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND A.RA = SHISTDISCCONCLUIDAS.RA
	AND A.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	
	
	
OUTER APPLY (

SELECT 
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	COUNT(*) AS TOTAL

FROM SHISTDISCPENDENTES

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHISTDISCPENDENTES.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC


WHERE	 SHISTDISCPENDENTES.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHISTDISCPENDENTES.RA = SHISTDISCCONCLUIDAS.RA
	AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	AND SDGC.ZERARCREDFINRECALC IS NULL
GROUP BY 
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL


) AS PENDENTES
	
	

WHERE SGRADE.STATUS <> 1
AND SHABILITACAOFILIAL.CODTIPOCURSO = 1



GROUP BY SGRADE.CARGAHORARIA,
A.EMCURSO,
SALUNO.RA,
SINSTITUICAO.NOMEFANTASIA,
PPESSOA.NOME,
SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
PPESSOA.CPF,
A.TOTALATIV,
SSTATUS.DESCRICAO,
GFILIAL.NOMEFANTASIA,
STIPOCURSO.NOME,
SCAMPUS.DESCRICAO,
SCAMPUS.CAMPUSMEC,
OPT.TOPTATIVAS,
PENDENTES.TOTAL,
SCURSOMEC.CODINEPCURSO,
DISCGRADE.TDISC,
SCURSO.NOME,
DTPERLET.DTINICIO,
SGRADE.DESCRICAO,
B.TCOMPOMENTE,
SPESSOA.ANOULTIMAINST,
A.DISCEMCURSO,
STURNO.NOME,
SINSTITUICAOMEC.CODEMEC,
SGRAU.DESCRICAO



HAVING ISNULL(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2)),0) >= :PERCE


END
ELSE IF :SIMBOLO = '<=' BEGIN


SELECT
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SALUNO.RA,
	PPESSOA.NOME AS 'ALUNO',
	PPESSOA.CPF,
	SGRADE.DESCRICAO AS 'MATRIZ',
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	SCAMPUS.DESCRICAO AS 'CAMPUS',
	SCAMPUS.CAMPUSMEC,
	SCURSOMEC.CODINEPCURSO AS 'CODEMEC CURSO',
	SINSTITUICAOMEC.CODEMEC AS 'CODEMEC INSTITUICAO',
	SINSTITUICAO.NOMEFANTASIA AS 'ESCOLA',
	SSTATUS.DESCRICAO AS 'STATUS CURSO',
	SGRAU.DESCRICAO AS 'GRAU',
	SPESSOA.ANOULTIMAINST AS 'CONCLUSAO ENSINO MEDIO',
	PENDENTES.TOTAL AS 'DISCIPLINAS PENDENTES',
	DTPERLET.DTINICIO AS 'DTINGRESSO',
	B.TCOMPOMENTE 'TOTAL O.C.C',
	A.TOTALATIV 'O.C.C CONCLUIDOS',
	ISNULL(CAST(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2)) AS VARCHAR),0) + '%' AS 'CONCLUIDO',
	ISNULL(CAST(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2)) AS VARCHAR),0) + '%' AS 'CONCLUIDO SEM O.C.C',
		CASE WHEN (100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2))) - A.EMCURSO < 0 THEN '0%'
	ELSE CAST((100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2))) - A.EMCURSO AS VARCHAR) + '%'
	END AS 'RESTANTE',
			CASE WHEN (100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2))) - A.EMCURSO < 0 THEN '0%'
	ELSE CAST((100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2))) - A.EMCURSO AS VARCHAR) + '%'
	END AS 'RESTANTE SEM O.C.C',
	A.EMCURSO,
	SGRADE.CARGAHORARIA
	
FROM SHISTDISCCONCLUIDAS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO



OUTER APPLY (
SELECT 
	MIN(SPLETIVO.DTINICIO) AS DTINICIO,
	SMATRICPL.RA,
	SHF.CODCURSO,
	SMATRICPL.CODCOLIGADA
FROM SMATRICPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
WHERE SMATRICPL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SMATRICPL.RA = SHISTDISCCONCLUIDAS.RA
	AND SHF.CODCURSO = SHABILITACAOFILIAL.CODCURSO
GROUP BY SHF.CODCURSO,
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA

) AS DTPERLET


LEFT JOIN (

SELECT 
	SUM(SHISTDISCOPTELETIVAS.CH) AS 'TOPTATIVAS',
	SHISTDISCOPTELETIVAS.CODCOLIGADA,
	SHISTDISCOPTELETIVAS.RA,
	SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
FROM SHISTDISCOPTELETIVAS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

OUTER APPLY(
SELECT SUM(SCP.VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR SCP
WHERE SCP.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
	AND SCP.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
) AS D

WHERE SGRADE.STATUS <> 1
AND SHISTDISCOPTELETIVAS.STATUS LIKE '%APROVADO%'
GROUP BY SHISTDISCOPTELETIVAS.CODCOLIGADA,
	SHISTDISCOPTELETIVAS.RA,
	SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL

) AS OPT ON OPT.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND OPT.RA = SHISTDISCCONCLUIDAS.RA
	AND OPT.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL


OUTER APPLY(
SELECT SUM(VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR 
WHERE SCOMPONENTECURRICULAR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCOMPONENTECURRICULAR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
) AS B


INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
LEFT JOIN SFILIAL ON SFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
	AND SFILIAL.CODFILIAL = GFILIAL.CODFILIAL
LEFT JOIN SINSTITUICAOMEC ON SINSTITUICAOMEC.CODCOLIGADA = SFILIAL.CODCOLIGADA
	AND SINSTITUICAOMEC.CODFILIAL = SFILIAL.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN STURNO ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SHISTDISCCONCLUIDAS.RA
LEFT JOIN SCAMPUS ON SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
LEFT JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
LEFT JOIN SCURSOMEC ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SALUNO.RA = SHISTDISCCONCLUIDAS.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
LEFT JOIN SPESSOA ON SPESSOA.CODIGO = PPESSOA.CODIGO
LEFT JOIN SINSTITUICAO ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
LEFT JOIN SGRAU ON SGRAU.CODGRAU = SPESSOA.GRAUULTIMAINST
	



OUTER APPLY (

SELECT 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL,
	SUM(SHD.CH) AS 'TDISC'
FROM SHISTDISCCONCLUIDAS SHD
INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHF.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHD.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC

WHERE SDGC.ZERARCREDFINRECALC IS NULL
	AND SHD.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHD.RA = SHISTDISCCONCLUIDAS.RA
	AND SHD.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL

GROUP BY SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL
) AS DISCGRADE



LEFT JOIN (

SELECT 
	/*CAST(CAST((((SUM(SHISTDISCPENDENTES.CH) + CASE WHEN ATALU.TATIV >= C.TCOMPOMENTE THEN 0 ELSE (C.TCOMPOMENTE - ATALU.TATIV) END) *100) / SGRADE.CARGAHORARIA) AS DECIMAL(10,2)) AS VARCHAR) + '%' AS 'PENDENTE',*/
	ISNULL(CAST(((SUM(SHISTDISCPENDENTES.CH) *100) / (SGRADE.CARGAHORARIA - C.TCOMPOMENTE)  ) AS DECIMAL(10,2)),0) AS 'EMCURSO',
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	SUM(SHISTDISCPENDENTES.CH) AS 'DISCEMCURSO',
	CASE WHEN ATALU.TATIV >= C.TCOMPOMENTE THEN C.TCOMPOMENTE ELSE (C.TCOMPOMENTE - ATALU.TATIV) END TOTALATIV
FROM SHISTDISCPENDENTES
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHISTDISCPENDENTES.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC


OUTER APPLY(
SELECT SUM(SC.VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR SC
WHERE SC.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SC.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
) AS C


OUTER APPLY(

SELECT SUM(CARGAHORARIAATV) AS 'TATIV'
FROM SATIVIDADEALUNO
WHERE SATIVIDADEALUNO.RA = SHISTDISCPENDENTES.RA
AND SATIVIDADEALUNO.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
AND SATIVIDADEALUNO.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
AND SATIVIDADEALUNO.CUMPRIUATIVIDADE = 'S'
) AS ATALU


WHERE SGRADE.STATUS <> 1
AND SHISTDISCPENDENTES.STATUS IS NOT NULL
AND SDGC.ZERARCREDFINRECALC IS NULL
GROUP BY SGRADE.CARGAHORARIA,
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	ATALU.TATIV,
	C.TCOMPOMENTE,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL

) AS A ON A.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND A.RA = SHISTDISCCONCLUIDAS.RA
	AND A.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	
	
	
OUTER APPLY (

SELECT 
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	COUNT(*) AS TOTAL

FROM SHISTDISCPENDENTES

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHISTDISCPENDENTES.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC


WHERE	 SHISTDISCPENDENTES.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHISTDISCPENDENTES.RA = SHISTDISCCONCLUIDAS.RA
	AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	AND SDGC.ZERARCREDFINRECALC IS NULL
GROUP BY 
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL


) AS PENDENTES
	
	

WHERE SGRADE.STATUS <> 1
AND SHABILITACAOFILIAL.CODTIPOCURSO = 1



GROUP BY SGRADE.CARGAHORARIA,
A.EMCURSO,
SALUNO.RA,
SINSTITUICAO.NOMEFANTASIA,
PPESSOA.NOME,
SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
PPESSOA.CPF,
A.TOTALATIV,
SSTATUS.DESCRICAO,
GFILIAL.NOMEFANTASIA,
STIPOCURSO.NOME,
OPT.TOPTATIVAS,
PENDENTES.TOTAL,
SCURSOMEC.CODINEPCURSO,
DISCGRADE.TDISC,
SCURSO.NOME,
SCAMPUS.DESCRICAO,
SCAMPUS.CAMPUSMEC,
DTPERLET.DTINICIO,
SGRADE.DESCRICAO,
B.TCOMPOMENTE,
SPESSOA.ANOULTIMAINST,
A.DISCEMCURSO,
STURNO.NOME,
SINSTITUICAOMEC.CODEMEC,
SGRAU.DESCRICAO



HAVING ISNULL(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2)),0) <= :PERCE


END


";23778;;;;06/10/2022;maik.souza;0;1;1;1;;;;1;59a8ea26-b014-4f6f-b163-40d3e4781589;0;;-1193;consultor1.totvs;19/04/2022;marccella.belvedere;13/10/2022;0
S;EDU.SEC002.1;Possiveis Formandos;"

SELECT
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SALUNO.RA,
	PPESSOA.NOME AS 'ALUNO',
	PPESSOA.CPF,
	SGRADE.DESCRICAO AS 'MATRIZ',
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	SCURSOMEC.CODINEPCURSO AS 'CODEMEC CURSO',
	SINSTITUICAOMEC.CODEMEC AS 'CODEMEC INSTITUICAO',
	SINSTITUICAO.NOMEFANTASIA AS 'ESCOLA',
	SSTATUS.DESCRICAO AS 'STATUS CURSO',
	SGRAU.DESCRICAO AS 'GRAU',
	SPESSOA.ANOULTIMAINST AS 'CONCLUSAO ENSINO MEDIO',
	PENDENTES.TOTAL AS 'DISCIPLINAS PENDENTES',
	DTPERLET.DTINICIO AS 'DTINGRESSO',
	B.TCOMPOMENTE 'TOTAL O.C.C',
	A.TOTALATIV 'O.C.C CONCLUIDOS',
	ISNULL(CAST(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2)) AS VARCHAR),0) + '%' AS 'CONCLUIDO',
		CASE WHEN (100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2))) - A.EMCURSO < 0 THEN '0%'
	ELSE CAST((100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2))) - A.EMCURSO AS VARCHAR) + '%'
	END AS 'RESTANTE',
	A.EMCURSO,
	SGRADE.CARGAHORARIA
	
FROM SHISTDISCCONCLUIDAS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO


OUTER APPLY (
SELECT 
	MIN(SPLETIVO.DTINICIO) AS DTINICIO,
	SMATRICPL.RA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SMATRICPL.CODCOLIGADA
FROM SMATRICPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE SMATRICPL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SMATRICPL.RA = SHISTDISCCONCLUIDAS.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
GROUP BY SMATRICPL.IDHABILITACAOFILIAL,
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA

) AS DTPERLET


LEFT JOIN (

SELECT 
	SUM(SHISTDISCOPTELETIVAS.CH) AS 'TOPTATIVAS',
	SHISTDISCOPTELETIVAS.CODCOLIGADA,
	SHISTDISCOPTELETIVAS.RA,
	SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
FROM SHISTDISCOPTELETIVAS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

OUTER APPLY(
SELECT SUM(SCP.VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR SCP
WHERE SCP.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
	AND SCP.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
) AS D

WHERE SGRADE.STATUS <> 1
AND SHISTDISCOPTELETIVAS.STATUS LIKE '%APROVADO%'
GROUP BY SHISTDISCOPTELETIVAS.CODCOLIGADA,
	SHISTDISCOPTELETIVAS.RA,
	SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL

) AS OPT ON OPT.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND OPT.RA = SHISTDISCCONCLUIDAS.RA
	AND OPT.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL


OUTER APPLY(
SELECT SUM(VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR 
WHERE SCOMPONENTECURRICULAR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCOMPONENTECURRICULAR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
) AS B


INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
LEFT JOIN SFILIAL ON SFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
	AND SFILIAL.CODFILIAL = GFILIAL.CODFILIAL
LEFT JOIN SINSTITUICAOMEC ON SINSTITUICAOMEC.CODCOLIGADA = SFILIAL.CODCOLIGADA
	AND SINSTITUICAOMEC.CODFILIAL = SFILIAL.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN STURNO ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SHISTDISCCONCLUIDAS.RA
LEFT JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
LEFT JOIN SCURSOMEC ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SALUNO.RA = SHISTDISCCONCLUIDAS.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
LEFT JOIN SPESSOA ON SPESSOA.CODIGO = PPESSOA.CODIGO
LEFT JOIN SINSTITUICAO ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
LEFT JOIN SGRAU ON SGRAU.CODGRAU = SPESSOA.GRAUULTIMAINST
	



OUTER APPLY (

SELECT 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL,
	SUM(SHD.CH) AS 'TDISC'
FROM SHISTDISCCONCLUIDAS SHD
INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHF.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHD.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC

WHERE SDGC.ZERARCREDFINRECALC IS NULL
	AND SHD.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHD.RA = SHISTDISCCONCLUIDAS.RA
	AND SHD.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL

GROUP BY SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL
) AS DISCGRADE



LEFT JOIN (

SELECT 
	/*CAST(CAST((((SUM(SHISTDISCPENDENTES.CH) + CASE WHEN ATALU.TATIV >= C.TCOMPOMENTE THEN 0 ELSE (C.TCOMPOMENTE - ATALU.TATIV) END) *100) / SGRADE.CARGAHORARIA) AS DECIMAL(10,2)) AS VARCHAR) + '%' AS 'PENDENTE',*/
	ISNULL(CAST(((SUM(SHISTDISCPENDENTES.CH) *100) / (SGRADE.CARGAHORARIA - C.TCOMPOMENTE)  ) AS DECIMAL(10,2)),0) AS 'EMCURSO',
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	SUM(SHISTDISCPENDENTES.CH) AS 'DISCEMCURSO',
	CASE WHEN ATALU.TATIV >= C.TCOMPOMENTE THEN C.TCOMPOMENTE ELSE (C.TCOMPOMENTE - ATALU.TATIV) END TOTALATIV
FROM SHISTDISCPENDENTES
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHISTDISCPENDENTES.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC


OUTER APPLY(
SELECT SUM(SC.VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR SC
WHERE SC.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SC.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
) AS C


OUTER APPLY(

SELECT SUM(CARGAHORARIAATV) AS 'TATIV'
FROM SATIVIDADEALUNO
WHERE SATIVIDADEALUNO.RA = SHISTDISCPENDENTES.RA
AND SATIVIDADEALUNO.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
AND SATIVIDADEALUNO.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
AND SATIVIDADEALUNO.CUMPRIUATIVIDADE = 'S'
) AS ATALU


WHERE SGRADE.STATUS <> 1
AND SHISTDISCPENDENTES.STATUS IS NOT NULL
AND SDGC.ZERARCREDFINRECALC IS NULL
GROUP BY SGRADE.CARGAHORARIA,
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	ATALU.TATIV,
	C.TCOMPOMENTE,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL

) AS A ON A.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND A.RA = SHISTDISCCONCLUIDAS.RA
	AND A.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	
	
	
OUTER APPLY (

SELECT 
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	COUNT(*) AS TOTAL

FROM SHISTDISCPENDENTES

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHISTDISCPENDENTES.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC


WHERE	 SHISTDISCPENDENTES.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHISTDISCPENDENTES.RA = SHISTDISCCONCLUIDAS.RA
	AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	AND SDGC.ZERARCREDFINRECALC IS NULL
GROUP BY 
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL


) AS PENDENTES
	
	

WHERE SGRADE.STATUS <> 1
AND SHABILITACAOFILIAL.CODTIPOCURSO = 1



GROUP BY SGRADE.CARGAHORARIA,
A.EMCURSO,
SALUNO.RA,
SINSTITUICAO.NOMEFANTASIA,
PPESSOA.NOME,
SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
PPESSOA.CPF,
A.TOTALATIV,
SSTATUS.DESCRICAO,
GFILIAL.NOMEFANTASIA,
STIPOCURSO.NOME,
OPT.TOPTATIVAS,
PENDENTES.TOTAL,
SCURSOMEC.CODINEPCURSO,
DISCGRADE.TDISC,
SCURSO.NOME,
DTPERLET.DTINICIO,
SGRADE.DESCRICAO,
B.TCOMPOMENTE,
SPESSOA.ANOULTIMAINST,
A.DISCEMCURSO,
STURNO.NOME,
SINSTITUICAOMEC.CODEMEC,
SGRAU.DESCRICAO



HAVING ISNULL(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2)),0) >= :PERCE
";11066;;;;11/05/2022;consultor1.totvs;0;1;1;1;;;;1;59a8ea26-b014-4f6f-b163-40d3e4781589;0;;3623;consultor1.totvs;10/05/2022;consultor1.totvs;11/05/2022;0
S;EDU.SEC003;Documentos Exigidos Por Parametrização de Curso;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SGRADE.CODCURSO,
	SGRADE.CODHABILITACAO,
	SCURSO.NOME AS 'CURSO',
	SGRADE.DESCRICAO AS 'MATRIZ',
	ISNULL(SDOCUMENTO.DESCRICAO,'NENHUM') AS 'DOCUMENTOS EXIGIDOS'
FROM SHABILITACAOFILIALPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOFILIALPL.IDHABILITACAOFILIAL
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
LEFT JOIN SDOCEXIGIDOS ON SDOCEXIGIDOS.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA
	AND SDOCEXIGIDOS.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
	AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = SHABILITACAOFILIALPL.IDHABILITACAOFILIAL
LEFT JOIN SDOCUMENTO ON SDOCUMENTO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO

WHERE SPLETIVO.CODPERLET = :CODPERLET

ORDER BY 1,2,5,7";1571;;;;03/05/2022;consultor1.totvs;0;1;1;1;;;;1;9646d1fe-54e5-44ca-84d4-9ded9cbca3f2;0;;615;consultor1.totvs;03/05/2022;consultor1.totvs;03/05/2022;0
S;EDU.SEC004;Resumo de Matricula por Turma;"SELECT DISTINCT
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SCURSO.NOME AS 'CURSO',
	SGRADE.DESCRICAO AS 'MATRIZ (MODALIDADE)',
	STURMA.CODTURMA + ' - ' + STURMA.NOME AS 'TURMA',
	CASE SGRADE.CONTROLEVAGAS
		WHEN 0 THEN STURMA.MAXALUNOS
		WHEN 1 THEN STURMADISC.MAXALUNOS
	END 'TOTAL VAGAS',
	INSC.TINSC 'INSCRITO',
	INSCCOR.TINSCCOR 'INSCRIÇÃO CONFIRMADA',
	RES.TRESER 'RESERVA DE VAGA',
	CON.TCONASSI 'CONTRATO ASSINADO',
	CUR.TCUR 'CURSANDO',
	CASE SGRADE.CONTROLEVAGAS
		WHEN 0 THEN STURMA.MAXALUNOS
		WHEN 1 THEN STURMADISC.MAXALUNOS
	END - CUR.TCUR AS 'VAGAS DISPONIVEIS'

FROM STURMADISC
INNER JOIN SMATRICULA ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN STURMA ON STURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND STURMA.CODTURMA = STURMADISC.CODTURMA
	AND STURMA.CODFILIAL = STURMADISC.CODFILIAL
	AND STURMA.IDPERLET = STURMADISC.IDPERLET
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICULA.IDPERLET
INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

OUTER APPLY(
SELECT 
	COUNT(*) AS 'TINSC',
	SMATRICULA.CODCOLIGADA,
	SMATRICULA.IDTURMADISC
FROM SMATRICULA SM1
INNER JOIN SSTATUS S1 ON S1.CODCOLIGADA = SM1.CODCOLIGADA
	AND S1.CODSTATUS = SM1.CODSTATUS
WHERE SM1.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SM1.IDTURMADISC = STURMADISC.IDTURMADISC
	AND S1.DESCRICAO LIKE '%INSCRITO%'
) AS INSC


OUTER APPLY(
SELECT 
	COUNT(*) AS 'TINSCCOR',
	SMATRICULA.CODCOLIGADA,
	SMATRICULA.IDTURMADISC
FROM SMATRICULA SM2
INNER JOIN SSTATUS S2 ON S2.CODCOLIGADA = SM2.CODCOLIGADA
	AND S2.CODSTATUS = SM2.CODSTATUS
WHERE SM2.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SM2.IDTURMADISC = STURMADISC.IDTURMADISC
	AND S2.DESCRICAO LIKE '%INSCRI%CONFIRM%'
) AS INSCCOR



OUTER APPLY(
SELECT 
	COUNT(*) AS 'TRESER',
	SMATRICULA.CODCOLIGADA,
	SMATRICULA.IDTURMADISC
FROM SMATRICULA SM1
INNER JOIN SSTATUS S1 ON S1.CODCOLIGADA = SM1.CODCOLIGADA
	AND S1.CODSTATUS = SM1.CODSTATUS
WHERE SM1.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SM1.IDTURMADISC = STURMADISC.IDTURMADISC
	AND S1.DESCRICAO LIKE '%RESERVA%VAGA%'
) AS RES



OUTER APPLY(
SELECT 
	COUNT(*) AS 'TCONASSI',
	SMATRICULA.CODCOLIGADA,
	SMATRICULA.IDTURMADISC
FROM SMATRICULA SM1
INNER JOIN SSTATUS S1 ON S1.CODCOLIGADA = SM1.CODCOLIGADA
	AND S1.CODSTATUS = SM1.CODSTATUS
WHERE SM1.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SM1.IDTURMADISC = STURMADISC.IDTURMADISC
	AND S1.DESCRICAO LIKE '%CONTRATO%ASSINADO%'
) AS CON



OUTER APPLY(
SELECT 
	COUNT(*) AS 'TCUR',
	SMATRICULA.CODCOLIGADA,
	SMATRICULA.IDTURMADISC
FROM SMATRICULA SM1
INNER JOIN SSTATUS S1 ON S1.CODCOLIGADA = SM1.CODCOLIGADA
	AND S1.CODSTATUS = SM1.CODSTATUS
WHERE SM1.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SM1.IDTURMADISC = STURMADISC.IDTURMADISC
	AND S1.DESCRICAO LIKE '%CURSANDO%'
) AS CUR




WHERE SPLETIVO.CODPERLET = :PERIODO
AND GFILIAL.NOMEFANTASIA LIKE '%' + :FILIAL + '%'
AND SCURSO.NOME LIKE '%' + :CURSO + '%' 
AND SGRADE.DESCRICAO LIKE '%' + :MATRIZ + '%' ";3870;;;;03/05/2022;consultor1.totvs;0;1;1;1;;;;1;1c8cf89f-2fae-4eee-9940-019ace788ff3;0;;-21407;consultor1.totvs;03/05/2022;consultor1.totvs;03/05/2022;0
S;EDU.SEC005;Professor sem Conteudo Realizado Lançado;"SELECT DISTINCT
	PPESSOA.NOME AS 'PROFESSOR',
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	STURMADISC.CODTURMA,
	STURMADISC.IDTURMADISC,
	STURMADISC.CODDISC,
	SDISCIPLINA.NOME AS 'DISCIPLINA',
	SPROFESSOR.CODPROF
FROM SPROFESSOR (NOLOCK)
INNER JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
	AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SHORARIOTURMA (NOLOCK) ON SHORARIOTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHORARIOTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SPLANOAULA (NOLOCK) ON SPLANOAULA.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA
	AND SPLANOAULA.IDHORARIOTURMA = SHORARIOTURMA.IDHORARIOTURMA
WHERE SPLETIVO.CODPERLET = :CODPERLET

AND SPROFESSORTURMA.TIPOPROF = 'T'
AND SPLANOAULA.DATA <= GETDATE()
AND CONTEUDOEFETIVO IS NULL
";1584;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;1;5cfd5f9b-cf96-45f0-8f28-185aef9e4266;0;;-19153;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;EDU.SEC006;Turmas Disciplinas por Quantidade de Avaliações;"SELECT DISTINCT
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	PPESSOA.NOME AS 'PROFESSOR',
	STURMADISC.CODTURMA,
	SDISCIPLINA.NOME AS 'DISCIPLINA',
	STURMADISC.CODDISC,
	SPROFESSOR.CODPROF,
	STURMADISC.IDTURMADISC
FROM SPROFESSOR (NOLOCK)
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
INNER JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
	AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
OUTER APPLY(

SELECT COUNT(*) AS 'TPROVAS'
FROM SPROVAS (NOLOCK)
WHERE SPROVAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPROVAS.IDTURMADISC = STURMADISC.IDTURMADISC
	AND SPROVAS.TIPOETAPA = 'N'
	AND SPROVAS.CODETAPA = 1
) AS A


WHERE SPLETIVO.CODPERLET = :CODPERLET_S
AND SPROFESSORTURMA.TIPOPROF = 'T'
AND A.TPROVAS = :QTDPROVAS_I
";1497;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;1;6f623264-eec1-4a53-a88b-9593d4adf8d8;0;;26688;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;EDU.SEC007;Professor Sem Preencher Espaço Diversificado ;"SELECT DISTINCT
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	PPESSOA.NOME AS 'PROFESSOR',
	STURMADISC.CODTURMA,
	STURMADISC.CODDISC,
	SDISCIPLINA.NOME AS 'DISCIPLINA',
	STURMADISC.IDTURMADISC,
	SPROFESSOR.CODPROF
FROM SPROFESSOR (NOLOCK)
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
INNER JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
	AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC

OUTER APPLY(
SELECT *
FROM SPLANOAULA
WHERE LICAOCASA IS NOT NULL
AND LICAOCASA <> '    '
AND SPLANOAULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLANOAULA.IDTURMADISC = STURMADISC.IDTURMADISC
) AS A

WHERE SPLETIVO.CODPERLET = :CODPERLET
AND SPROFESSORTURMA.TIPOPROF = 'T'
AND A.CODCOLIGADA IS NULL



";1471;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;1;828ca744-5afc-4e3e-8a86-ac6087e00be7;0;;11366;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;EDU.SEC008;Histórico Professor sem Titulação;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	PPESSOA.NOME AS 'ALUNO',
	SALUNO.RA,
	SGRADE.DESCRICAO AS 'GRADE',
	Z_HISTORICOFINAL.CODDISC,
	Z_HISTORICOFINAL.DISCIPLINA,
	Z_HISTORICOFINAL.DESCRICAO,
	Z_HISTORICOFINAL.DESCRESULT,
	Z_HISTORICOFINAL.MEDIA,
	Z_HISTORICOFINAL.NOTAFALTA,
	Z_HISTORICOFINAL.CH,
	Z_HISTORICOFINAL.NUMCREDITOS,
	Z_HISTORICOFINAL.NOMEPROFESSOR,
	Z_HISTORICOFINAL.TITULACAO,
	Z_HISTORICOFINAL.TITULO,
	/*Z_HISTORICOFINAL.PROFESSOR_NOME,
	Z_HISTORICOFINAL.PROFESSOR_TITULACAO,*/
	Z_HISTORICOFINAL.ANO,
	Z_HISTORICOFINAL.PERIODO,
	Z_HISTORICOFINAL.CODPERIODO,
	Z_HISTORICOFINAL.DISCIPLINA_NOME
FROM Z_HISTORICOFINAL (NOLOCK)
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = Z_HISTORICOFINAL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = Z_HISTORICOFINAL.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = Z_HISTORICOFINAL.RA
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
WHERE
	(Z_HISTORICOFINAL.TITULO IS NULL
	OR Z_HISTORICOFINAL.NOMEPROFESSOR IS NULL)
	AND SSTATUS.DESCRICAO LIKE '%' + :STATUSCURSO + '%'
	AND SGRADE.DESCRICAO LIKE '%' + :GRADE + '%'
	AND SPLETIVO.CODPERLET = :CODPERLET";2343;;;;25/05/2022;consultor1.totvs;0;1;1;1;;;;1;2c5954ce-45f2-41eb-b09e-9181ba8895e5;0;;-17337;consultor1.totvs;25/05/2022;consultor1.totvs;25/05/2022;0
S;EDU.SEC008.1;Alunos Histórico em Lote;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	PPESSOA.NOME AS 'ALUNO',
	SHABILITACAOALUNO.RA,
	SGRADE.DESCRICAO AS 'GRADE',
	SHABILITACAOALUNO.CODCOLIGADA,
	SHABILITACAOALUNO.IDHABILITACAOFILIAL
FROM SHABILITACAOALUNO (NOLOCK)
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
	
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
WHERE
	SSTATUS.DESCRICAO LIKE '%' + :STATUSCURSO + '%'
	AND SCURSO.NOME LIKE '%' + :CURSO + '%'
	AND SMATRICPL.RA LIKE '%' + :RA + '%'
	AND SPLETIVO.CODPERLET = :CODPERLET
	AND SPLETIVO.CODFILIAL = :CODFILIAL";1801;;;;15/06/2022;consultor1.totvs;0;1;1;1;;;;0;2c5954ce-45f2-41eb-b09e-9181ba8895e5;0;;-19976;consultor1.totvs;25/05/2022;consultor1.totvs;15/06/2022;0
S;EDU.SEC009;Relação Quantidade de Alunos por Unidade;"
SELECT DISTINCT
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SCURSO.NOME AS 'CURSO',
	MATRIC.MATRICULADO,
	INGRESSANTE.INGRESSANTE,
	ESTRANGEIRO.ESTRANGEIRO,
	ESTAGIO.ESTAGIO,
	TCC.TCC,
	(VAGAS.VAGAS - MATRIC.MATRICULADO) AS 'VAGAS OCIOSAS'

FROM SHABILITACAOFILIAL (NOLOCK)
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO

LEFT JOIN (
SELECT 
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO,
	COUNT(*) AS 'MATRICULADO'

FROM SMATRICPL (NOLOCK)
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

WHERE SPLETIVO.CODPERLET = :CODPERLET
AND SSTATUS.DESCRICAO LIKE '%CURSANDO%'
AND SHABILITACAOALUNO.DTINGRESSO BETWEEN :DTINGREINI AND :DTINGREFIM

GROUP BY
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO

	) AS MATRIC ON MATRIC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND MATRIC.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
		AND MATRIC.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		AND MATRIC.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO


LEFT JOIN (
SELECT 
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO,
	COUNT(*) AS 'INGRESSANTE'
	
FROM SMATRICPL (NOLOCK)

INNER JOIN STIPOMATRICULA (NOLOCK) ON STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT

INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS


WHERE SPLETIVO.CODPERLET = :CODPERLET
AND STIPOMATRICULA.DESCRICAO = 'Matrícula'
AND SSTATUS.DESCRICAO LIKE '%CURSANDO%'
AND SHABILITACAOALUNO.DTINGRESSO BETWEEN :DTINGREINI AND :DTINGREFIM

GROUP BY
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO

) AS INGRESSANTE ON INGRESSANTE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND INGRESSANTE.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
	AND INGRESSANTE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND INGRESSANTE.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO


LEFT JOIN (

SELECT 
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO,
	COUNT(*) AS 'ESTRANGEIRO'
FROM SMATRICPL (NOLOCK)
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA

WHERE 
	SPLETIVO.CODPERLET = :CODPERLET
AND PPESSOA.NACIONALIDADE <> 10
AND SSTATUS.DESCRICAO LIKE '%CURSANDO%'
AND SHABILITACAOALUNO.DTINGRESSO BETWEEN :DTINGREINI AND :DTINGREFIM

GROUP BY
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO
) AS ESTRANGEIRO ON ESTRANGEIRO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND ESTRANGEIRO.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
	AND ESTRANGEIRO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
	AND ESTRANGEIRO.CODCURSO = SHABILITACAOFILIAL.CODCURSO


LEFT JOIN (

SELECT
	A.CODTIPOCURSO,
	A.CODFILIAL,
	A.CODCOLIGADA,
	A.CODCURSO,
	SUM(A.TOTAL) AS ESTAGIO
FROM 
(
SELECT 
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO,
	SHABILITACAOALUNO.RA,
	1 AS 'TOTAL'
FROM SMATRICPL (NOLOCK)
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA

LEFT JOIN SATIVIDADEALUNO (NOLOCK) ON SATIVIDADEALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SATIVIDADEALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SATIVIDADEALUNO.RA = SHABILITACAOALUNO.RA
LEFT JOIN SCOMPONENTE (NOLOCK) ON SCOMPONENTE.CODCOLIGADA = SATIVIDADEALUNO.CODCOLIGADA
	AND SCOMPONENTE.CODCOMPONENTE = SATIVIDADEALUNO.CODCOMPONENTE

INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SMATRICULA (NOLOCK) ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SMATRICULA.IDPERLET = SMATRICPL.IDPERLET
	AND SMATRICULA.RA = SMATRICPL.RA
	AND SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC

WHERE 
	SPLETIVO.CODPERLET = :CODPERLET
	AND SSTATUS.DESCRICAO LIKE '%CURSANDO%'
	AND (SDISCIPLINA.NOME LIKE '%ESTÁGIO%SUPE%' OR SCOMPONENTE.DESCRICAO LIKE '%ESTÁGIO%SUPE%')
	AND SHABILITACAOALUNO.DTINGRESSO BETWEEN :DTINGREINI AND :DTINGREFIM

GROUP BY
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO,
	SHABILITACAOALUNO.RA
	) AS A
GROUP BY 
	A.CODTIPOCURSO,
	A.CODFILIAL,
	A.CODCOLIGADA,
	A.CODCURSO

) AS ESTAGIO ON ESTAGIO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND ESTAGIO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND ESTAGIO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
	AND ESTAGIO.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL


LEFT JOIN (

SELECT
	A.CODTIPOCURSO,
	A.CODFILIAL,
	A.CODCOLIGADA,
	A.CODCURSO,
	SUM(A.TOTAL) AS 'TCC'
FROM 
(
SELECT 
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO,
	SHABILITACAOALUNO.RA,
	1 AS 'TOTAL'
FROM SMATRICPL (NOLOCK)
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA

LEFT JOIN SATIVIDADEALUNO (NOLOCK) ON SATIVIDADEALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SATIVIDADEALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SATIVIDADEALUNO.RA = SHABILITACAOALUNO.RA
LEFT JOIN SCOMPONENTE (NOLOCK) ON SCOMPONENTE.CODCOLIGADA = SATIVIDADEALUNO.CODCOLIGADA
	AND SCOMPONENTE.CODCOMPONENTE = SATIVIDADEALUNO.CODCOMPONENTE

INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SMATRICULA (NOLOCK) ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SMATRICULA.IDPERLET = SMATRICPL.IDPERLET
	AND SMATRICULA.RA = SMATRICPL.RA
	AND SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
WHERE 
	SPLETIVO.CODPERLET = :CODPERLET
	AND SSTATUS.DESCRICAO LIKE '%CURSANDO%'
	AND (SDISCIPLINA.NOME LIKE '%TCC%' OR SCOMPONENTE.DESCRICAO LIKE '%TCC%')
	AND SHABILITACAOALUNO.DTINGRESSO BETWEEN :DTINGREINI AND :DTINGREFIM
	
GROUP BY
	SPLETIVO.CODTIPOCURSO,
	SPLETIVO.CODFILIAL,
	SHABILITACAOFILIAL.CODCOLIGADA,
	SHABILITACAOFILIAL.CODCURSO,
	SHABILITACAOALUNO.RA
	) AS A
GROUP BY 
	A.CODTIPOCURSO,
	A.CODFILIAL,
	A.CODCOLIGADA,
	A.CODCURSO

) AS TCC ON TCC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND TCC.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND TCC.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
	AND TCC.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL


LEFT JOIN (
SELECT 
	ZMDVAGASCURSO.CODCOLIGADA,
	ZMDVAGASCURSO.IDPERLET,
	ZMDVAGASCURSO.IDHABILITACAOFILIAL,
	ZMDVAGASCURSO.VAGAS
FROM ZMDVAGASCURSO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = ZMDVAGASCURSO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = ZMDVAGASCURSO.IDPERLET
WHERE SPLETIVO.CODPERLET = :CODPERLET
) AS VAGAS ON VAGAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND VAGAS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL


WHERE (MATRIC.MATRICULADO IS NOT NULL OR
	INGRESSANTE.INGRESSANTE IS NOT NULL OR
	ESTRANGEIRO.ESTRANGEIRO IS NOT NULL OR
	ESTAGIO.ESTAGIO IS NOT NULL
	OR TCC.TCC IS NOT NULL)
	
	
ORDER BY 1,2,3";11909;;;;02/06/2022;consultor1.totvs;0;1;1;1;;;;0;f4b4f433-8934-4eb5-b897-8bfe8b4d5962;0;;9803;consultor1.totvs;01/06/2022;consultor1.totvs;02/06/2022;0
S;EDU.SEC010;Dados de Diploma dos Alunos;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SALUNO.RA,
	PPESSOA.NOME AS 'ALUNO',
	PPESSOA.EMAIL,
		CASE
		WHEN SHABILITACAOALUNO.EXIBEDIPLOMAWEB = 'S' 
		AND SCERTIFICADO.IDDIPLOMA IS NOT NULL
		AND SCERTIFICADO.CODVALIDACAO IS NOT NULL THEN 'REGISTRADO/ATIVO' ELSE 'EM PRODUÇÃO'
		END 'STATUS DIPLOMA',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU,103) AS 'DTCOLACAOGRAU',
	CONVERT(VARCHAR,SCERTIFICADO.DTREGISTRO,103) 'DTREGISTRO',
	CONVERT(VARCHAR,SCERTIFICADO.DATACERTIFICADO,103) AS 'DATACERTIFICADO',
	CONVERT(VARCHAR,SCERTIFICADO.DTEMISSAO,103) AS 'DTEMISSAO',
	CONVERT(VARCHAR,SCERTIFICADO.DTCONCLUSAOCURSO,103) AS 'DTCONCLUSAOCURSO',
	SCERTIFICADO.NUMREGISTRO,
	SCERTIFICADO.NUMPROCESSO,
	STIPOCERTIFICADO.NOME AS 'TIPO CERTIFICADO',
	SCURSO.NOME AS 'CURSO'

FROM SHABILITACAOALUNO (NOLOCK)
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
LEFT JOIN SCERTIFICADO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SCERTIFICADO.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SCERTIFICADO.RA
LEFT JOIN STIPOCERTIFICADO (NOLOCK) ON STIPOCERTIFICADO.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND STIPOCERTIFICADO.IDTIPOCERTIFICADO = SCERTIFICADO.IDTIPOCERTIFICADO
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
WHERE 
	SSTATUS.DESCRICAO LIKE '%FORMADO%'
	AND SALUNO.RA LIKE '%' + :RA + '%'
	AND PPESSOA.NOME LIKE '%' + :NOME + '%'
	AND SCURSO.NOME LIKE '%' + :CURSO + '%'
	
ORDER BY 
	GFILIAL.NOMEFANTASIA,
	STIPOCURSO.NOME,
	PPESSOA.NOME";2423;;;;30/06/2022;consultor1.totvs;0;1;1;1;;;;1;c17e2936-482d-4a1f-94e2-17ed24bcb363;0;;7227;consultor1.totvs;29/06/2022;consultor1.totvs;30/06/2022;0
S;EDU.SEC011;Alunos Por Data de Colação;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	SHABILITACAOALUNO.RA,
	PPESSOA.NOME,
	PPESSOA.CPF,
	SCURSO.NOME AS 'CURSO',
	SGRADE.DESCRICAO AS 'MATRIZ', 
	SHABILITACAOALUNO.PROCESSOREGISTRO,
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO,103) AS 'DT CONCLUSAO',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU,103) AS 'DT COLACAO'
FROM SHABILITACAOALUNO (NOLOCK)
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
WHERE 1=1
AND SHABILITACAOALUNO.DTCOLACAOGRAU BETWEEN :DTCOLACAOINI_D AND :DTCOLACAOFIM_D
AND SSTATUS.DESCRICAO LIKE '%FORMADO%'
AND SHABILITACAOFILIAL.CODTIPOCURSO = :NIVELENSINO

ORDER BY PPESSOA.NOME";1628;;;;18/10/2022;consultor1.totvs;0;1;1;1;;;;0;9cbf8e80-a6ce-4c5b-a258-f48c9219e76c;0;;-24483;consultor1.totvs;12/07/2022;consultor1.totvs;18/10/2022;0
S;EDU.SEC012;Diplomas Alunos por Data Criação;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	SHABILITACAOALUNO.RA,
	PPESSOA.NOME,
	SCURSO.NOME AS 'CURSO',
	SGRADE.DESCRICAO AS 'MATRIZ', 
	SHABILITACAOALUNO.PROCESSOREGISTRO,
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO,103) AS 'DT CONCLUSAO',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU,103) AS 'DT COLACAO'
FROM SHABILITACAOALUNO (NOLOCK)
INNER JOIN SCERTIFICADO (NOLOCK) ON SCERTIFICADO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SCERTIFICADO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SCERTIFICADO.RA = SHABILITACAOALUNO.RA
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
WHERE 1=1
AND SCERTIFICADO.RECCREATEDON BETWEEN :DTCRIACAOINI_D + ' 00:00:00.000' AND :DTCRIACAOFIM_D + ' 23:59:59.000'
AND SSTATUS.DESCRICAO LIKE '%FORMADO%'

ORDER BY PPESSOA.NOME";1809;;;;28/07/2022;consultor1.totvs;0;1;1;1;;;;0;9cbf8e80-a6ce-4c5b-a258-f48c9219e76c;0;;-14077;consultor1.totvs;13/07/2022;consultor1.totvs;28/07/2022;0
S;EDU.SEC013;Alunos Estrangeiros por Periodo Letivo;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	PPESSOA.NOME AS 'ALUNO',
	SALUNO.RA,
	PCODNACAO.DESCRICAO AS 'NACIONALIDADE',
	SCURSO.NOME AS 'CURSO',
	SSTATUS.DESCRICAO AS 'STATUS PERIODO',
	PPESSOA.TELEFONE1,
	PPESSOA.EMAIL,
	PPESSOA.CPF,
	PPESSOA.CARTIDENTIDADE Documento,
	PPESSOA.NROREGGERAL AS 'Registro Nacional Migratório',
	PPESSOA.NATURALIDADE
FROM SALUNO
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN PCODNACAO ON PCODNACAO.CODCLIENTE = PPESSOA.NACIONALIDADE
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.RA = SALUNO.RA
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
WHERE PPESSOA.NACIONALIDADE <> 10
AND SPLETIVO.CODPERLET = :CODPERLET";1466;;;;19/07/2022;consultor1.totvs;0;1;1;1;;;;1;3e49cda4-599f-4cd8-a737-cb6c81af53b5;0;;-26199;consultor1.totvs;19/07/2022;consultor1.totvs;19/07/2022;0
S;EDU.SEC014;Documentos Validados Aluno por Periodo Letivo;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE ALUNO',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	PPESSOA.NOME AS 'ALUNO',
	SALUNO.RA,
	SCURSO.NOME AS 'CURSO',
	SSTATUS.DESCRICAO AS 'STATUS PERIODO',
	SDOCUMENTO.DESCRICAO AS 'DOCUMENTO',
	GFD.NOMEFANTASIA AS 'UNIDADE DOCUMENTO',
	STD.NOME AS 'NIVEL ENSINO DOCUMENTO'
FROM SMATRICPL
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SDOCALUNO ON SDOCALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SDOCALUNO.RA = SALUNO.RA
INNER JOIN SDOCUMENTO ON SDOCUMENTO.CODDOCUMENTO = SDOCALUNO.CODDOCUMENTO
INNER JOIN SPLETIVO SPD ON SDOCALUNO.CODCOLIGADA = SDOCALUNO.CODCOLIGADA
	AND SPD.IDPERLET = SDOCALUNO.IDPERLET
INNER JOIN GFILIAL GFD ON GFD.CODCOLIGADA = SPD.CODCOLIGADA
	AND GFD.CODFILIAL = SPD.CODFILIAL
INNER JOIN STIPOCURSO STD ON STD.CODCOLIGADA = SPD.CODCOLIGADA
	AND STD.CODTIPOCURSO = SPD.CODTIPOCURSO
WHERE 1=1
AND SPLETIVO.CODPERLET = :CODPERLET
AND SDOCALUNO.STATUS = 3
AND SSTATUS.DESCRICAO LIKE '%POR%LIB%'";1845;;;;19/07/2022;consultor1.totvs;0;1;1;1;;;;0;1888c6ab-5876-4822-9c56-1daf508bc9ea;0;;-7952;consultor1.totvs;19/07/2022;consultor1.totvs;19/07/2022;0
S;EDU.SEC015;Lista de Alunos Estrangeiros;"select distinct
	va.RA,
	va.Nome,
	va.NomGrade,
	va.Status_Curso,
	vup.DESCRICAO
from
	ppessoa(nolock) p
	inner join v_unasp_shabilitacaoaluno(nolock) va on va.NOME=p.NOME
	left join v_Unasp_PBINacionalidade(nolock) vup on vup.CODINTERNO=p.NACIONALIDADE
where
	vup.DESCRICAO not in (' Brasileira') and
	va.Status_Curso = 'cursando' and	
	va.CODFILIAL = :Filial and
	va.CODTIPOCURSO = :Tipo_Curso
order by
	va.NOME";429;;;;16/08/2022;lucas.marques;0;1;1;1;;;;0;1b155619-366d-4024-bdcd-06bdca2960f7;0;;1381;lucas.marques;16/08/2022;lucas.marques;16/08/2022;0
S;EDU.SEC016;Alunos por Numero de Registro Geral;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SHABILITACAOALUNO.RA,
	PPESSOA.NOME,
	SCURSO.NOME AS 'CURSO',
	SGRADE.DESCRICAO AS 'MATRIZ', 
	SHABILITACAOALUNO.PROCESSOREGISTRO,
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTREGISTRODIPLOMA,103) AS 'Registro Diploma',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO,103) AS 'DT CONCLUSAO',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU,103) AS 'DT COLACAO',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISDIPLOMA,103) AS 'DT EMISSAO DIPLOMA',
	SSTATUS.DESCRICAO AS 'STATUS CURSO'
FROM SHABILITACAOALUNO (NOLOCK)
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
WHERE 1=1
AND SHABILITACAOALUNO.PROCESSOREGISTRO IS NOT NULL
ORDER BY 1,2,4";1867;;;;28/09/2022;lucas.marques;0;1;1;1;;;;0;a603dc46-c68c-496a-bbe3-4af09ba333ab;0;;-28548;consultor1.totvs;23/08/2022;lucas.marques;28/09/2022;0
S;EDU.SEC017;Diplomas dos Alunos e Numero de Registro Geral;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SALUNO.RA,
	PPESSOA.NOME AS 'ALUNO',
	SSTATUS.DESCRICAO AS 'STATUS CURSO',
	SCURSO.NOME AS 'CURSO',
	SGRADE.DESCRICAO AS 'MATRIZ',
	PPESSOA.EMAIL,
	CASE WHEN SHABILITACAOALUNO.EXIBEDIPLOMAWEB = 'S' 
		AND SCERTIFICADO.IDDIPLOMA IS NOT NULL
		AND SCERTIFICADO.CODVALIDACAO IS NOT NULL 
		THEN 'REGISTRADO/ATIVO'
		ELSE 'EM PRODUÇÃO'
	END 'STATUS DIPLOMA',
	STIPOCERTIFICADO.NOME AS 'TIPO CERTIFICADO',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTREGISTRODIPLOMA,103) AS 'Registro Diploma',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO,103) AS 'DT CONCLUSAO',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU,103) AS 'DT COLACAO',
	CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISDIPLOMA,103) AS 'DT EMISSAO DIPLOMA',
	CONVERT(VARCHAR,SCERTIFICADO.DATACERTIFICADO,103) AS 'DATACERTIFICADO',
	
	SHABILITACAOALUNO.PROCESSOREGISTRO AS 'NUM PROCESSO',
	SHABILITACAOALUNO.REGISTROCONCLUSAO AS 'REGISTRO CONCLUSÃO'

FROM SHABILITACAOALUNO (NOLOCK)
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
LEFT JOIN SCERTIFICADO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SCERTIFICADO.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SCERTIFICADO.RA
LEFT JOIN STIPOCERTIFICADO (NOLOCK) ON STIPOCERTIFICADO.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND STIPOCERTIFICADO.IDTIPOCERTIFICADO = SCERTIFICADO.IDTIPOCERTIFICADO
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO	
	
WHERE 
	(SSTATUS.DESCRICAO LIKE '%FORMADO%' OR SHABILITACAOALUNO.PROCESSOREGISTRO IS NOT NULL)
	AND SALUNO.RA LIKE '%' + :RA + '%'
	AND PPESSOA.NOME LIKE '%' + :NOME + '%'
	AND SCURSO.NOME LIKE '%' + :CURSO + '%'
	
ORDER BY 
	GFILIAL.NOMEFANTASIA,
	STIPOCURSO.NOME,
	PPESSOA.NOME";2906;;;;20/10/2022;consultor1.totvs;0;1;1;1;;;;0;5dc741ec-adf9-4687-bbc4-4ae979847676;0;;-18078;consultor1.totvs;20/10/2022;consultor1.totvs;20/10/2022;0
S;EDUREL0046A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";198;;;;17/08/2021;mestre;0;1;1;1;;;;;abbc38a4-b399-4e4a-af06-853a990a5f79;;;3658;mestre;11/08/2021;mestre;17/08/2021;
S;EDUREL0046B;Relação de Alunos Bolsistas;"SELECT DISTINCT SCURSO.CODCURSO, SCURSO.NOME, SCURSO.CODTIPOCURSO, STIPOCURSO.NOME TIPOCURSO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SBOLSAALUNO (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SBOLSAALUNO.RA
	AND SCONTRATO.CODCONTRATO = SBOLSAALUNO.CODCONTRATO
	AND SCONTRATO.IDPERLET = SBOLSAALUNO.IDPERLET
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN    
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
 
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SPLETIVO.CODPERLET LIKE :CODPERLET_S
  AND SCURSO.NOME LIKE :CURSO_S
  AND SBOLSA.CODBOLSA LIKE :CODBOLSA_S
  AND SCONTRATO.RA LIKE :RA_S
  AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)";2831;;;;17/08/2021;mestre;0;1;1;1;;;;;abbc38a4-b399-4e4a-af06-853a990a5f79;;;6317;mestre;17/08/2021;mestre;17/08/2021;
S;EDUREL0046C;Relação de Alunos Bolsistas;"SELECT DISTINCT SBOLSA.CODBOLSA,
SBOLSA.NOME AS NOMEBOLSA,
SMATRICPL.RA,
PPESSOA.NOME AS NOMEALUNO,
SBOLSALAN.IDLAN,
FLAN.HISTORICO,
FLAN.DATAEMISSAO,
FLAN.DATAVENCIMENTO,
SBOLSALAN.VALOR

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SBOLSAALUNO (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SBOLSAALUNO.RA
	AND SCONTRATO.CODCONTRATO = SBOLSAALUNO.CODCONTRATO
	AND SCONTRATO.IDPERLET = SBOLSAALUNO.IDPERLET
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SPLETIVO.CODPERLET LIKE :CODPERLET_S
  AND SBOLSA.CODBOLSA LIKE :CODBOLSA_S
  AND SCONTRATO.RA LIKE :RA_S
  AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO1_S
  AND FLAN.DATAEMISSAO BETWEEN :DTEMISSAOINICIAL_D AND :DTEMISSAOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)
  
ORDER BY SBOLSA.NOME, FLAN.DATAEMISSAO, FLAN.DATAVENCIMENTO";3011;;;;17/08/2021;mestre;0;1;1;1;;;;;abbc38a4-b399-4e4a-af06-853a990a5f79;;;-1606;mestre;17/08/2021;mestre;17/08/2021;
S;EDUREL0047A;Relação de Alunos Bolsistas;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA_N";;;;;;;0;1;1;1;;;;;41434109-4974-416d-844e-defd2aea7b79;;;-2009;rafael.prado;06/09/2021;rafael.prado;06/09/2021;
S;EDUREL0047B;Relação de Alunos Bolsistas;"SELECT DISTINCT SCURSO.CODCURSO, SCURSO.NOME, SCURSO.CODTIPOCURSO, STIPOCURSO.NOME TIPOCURSO

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN    
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
 
WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.NOME LIKE :CURSO_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)";2747;;;;20/09/2021;rafael.prado;0;1;1;1;;;;;451c922d-a7c3-4b96-8b87-bc210f8978c8;;;12353;rafael.prado;06/09/2021;rafael.prado;20/09/2021;
S;EDUREL0047C;Relação de Alunos Bolsistas;"SELECT *,

CASE
WHEN (MENSALIDADE > 0 AND ATIVOS > 0)  THEN (MENSALIDADE / ATIVOS)
ELSE 0
END TICKETMEDIO,

CASE
WHEN VALORMENSALIDADEGRADE IS NULL THEN VALORMENSALIDADE
ELSE VALORMENSALIDADEGRADE
END VALORMENSALIDADENOVO

FROM 
(

SELECT W.CODTURMA, W.NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
((SUM(MENSALIDADE) + SUM(SERVICOS)) - (SUM(BOLSA) + SUM(DESCONTO) + SUM(DISSIDIO))) TOTAL,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(BOLSA) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END BOLSAPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(DESCONTO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END DESCONTOPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN (SUM(DISSIDIO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))
ELSE 0
END DISSIDIOPERC,

CASE
WHEN (SUM(MENSALIDADE) + SUM(SERVICOS)) > 0 THEN ((SUM(BOLSA) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))) + ((SUM(DESCONTO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS))) + ((SUM(DISSIDIO) * 100) / (SUM(MENSALIDADE) + SUM(SERVICOS)))
ELSE 0
END TOTALPERC,

(
SELECT ALUNOS
FROM
(
SELECT COUNT(RA) ALUNOS
FROM
(
SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME, SMATRICPL.RA
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SMATRICPL.CODFILIAL = :CODFILIAL_N
  AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA = W.CODTURMA
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)
)A
)B

) ATIVOS,

(
SELECT SUM(((Z.NUMCREDITOSCOB * Z.VALCRED) / 6)) VALORMENSALIDADE

FROM
(

SELECT SMATRICULA.RA, SUM(SMATRICULA.NUMCREDITOSCOB) NUMCREDITOSCOB,
(
SELECT VALCRED 
FROM SFAIXACRED 
WHERE SFAIXACRED.CODCOLIGADA = SMATRICULA.CODCOLIGADA
AND SFAIXACRED.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
AND SFAIXACRED.IDPERLET = SMATRICULA.IDPERLET
) VALCRED

FROM SMATRICULA
INNER JOIN 
(

SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME, SMATRICPL.RA, SMATRICPL.IDHABILITACAOFILIAL, SMATRICPL.IDPERLET
FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SBOLSALAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SBOLSALAN.IDPARCELA
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA
INNER JOIN FLAN (NOLOCK)
	ON SBOLSALAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SBOLSALAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SMATRICPL.CODFILIAL = :CODFILIAL_N
  AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA = W.CODTURMA
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)

)X ON X.RA = SMATRICULA.RA AND X.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND X.IDPERLET = SMATRICULA.IDPERLET

GROUP BY SMATRICULA.CODCOLIGADA, SMATRICULA.RA, SMATRICULA.IDHABILITACAOFILIAL, SMATRICULA.IDPERLET

)Z
) VALORMENSALIDADE,
W.VALORMENSALIDADEGRADE

FROM
(

SELECT CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODTURMA, X.NOME,
0 MENSALIDADE,
0 SERVICOS,

CASE 
WHEN X.CLASSIFICACAO = 'O' THEN X.VALOR
ELSE 0
END OUTRAS,

CASE 
WHEN X.CLASSIFICACAO = 'F' THEN X.VALOR
ELSE 0
END FIES,

CASE 
WHEN X.CLASSIFICACAO = 'B' THEN X.VALOR
ELSE 0
END BOLSA,

CASE 
WHEN X.CLASSIFICACAO = 'E' THEN X.VALOR
ELSE 0
END DESCONTO,

CASE 
WHEN X.CLASSIFICACAO = 'D' THEN X.VALOR
ELSE 0
END DISSIDIO,

X.VALORMENSALIDADEGRADE

FROM

(
SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME,
SBOLSALAN.IDPARCELA,
SBOLSALAN.IDLAN,
SBOLSALAN.IDPERLET,
SBOLSA.CODBOLSA,
SBOLSALAN.VALOR,
CASE 
WHEN (SBOLSA.FIES = 0 AND SBOLSA.TIPOSAC = 'R') THEN 'O'
WHEN (SBOLSA.FIES > 0 AND SBOLSA.TIPOSAC = 'R') THEN 'F'
WHEN SBOLSA.CODBOLSA IN (1,2,3,4) THEN 'B'
WHEN SBOLSA.CODBOLSA IN (10,22,29,34,55,141,142,143,144,145,146,147,148,149,150) THEN 'D'
ELSE 'E'
END CLASSIFICACAO,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)

) X

) Y
GROUP BY CODTURMA, NOME, VALORMENSALIDADEGRADE

/* ******************************************************************************* */

UNION

SELECT CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODTURMA, X.NOME,
0 MENSALIDADE,
X.VALOR SERVICOS,
0 OUTRAS,
0 FIES,
0 BOLSA,
0 DESCONTO,
0 DISSIDIO,
X.VALORMENSALIDADEGRADE

FROM

(

SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME,
SPARCELA.IDPARCELA,
SLAN.IDLAN,
SPARCELA.IDPERLET,
SPARCELA.VALOR,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)
  AND SPARCELA.CODSERVICO IN (107,108,109,3,31,41,55)

) X

) Y
GROUP BY CODTURMA, NOME, VALORMENSALIDADEGRADE

/* ******************************************************************************* */

UNION

SELECT CODTURMA, NOME,
SUM(MENSALIDADE) MENSALIDADE,
SUM(SERVICOS) SERVICOS,
SUM(OUTRAS) OUTRAS,
SUM(FIES) FIES,
SUM(BOLSA) BOLSA,
SUM(DESCONTO) DESCONTO,
SUM(DISSIDIO) DISSIDIO,
VALORMENSALIDADEGRADE

FROM
(

SELECT X.CODTURMA, X.NOME,
CASE 
WHEN X.CLASSIFICACAO = 'M' THEN X.VALOR
ELSE 0
END MENSALIDADE,
0 SERVICOS,

0 OUTRAS,
0 FIES,
0 BOLSA,
0 DESCONTO,
0 DISSIDIO,
X.VALORMENSALIDADEGRADE

FROM

(
SELECT DISTINCT STURMA.CODTURMA, STURMA.NOME,
FLAN.IDLAN,
CASE
WHEN ISNULL(FLAN.VALORBAIXADO,0) = 0 THEN FLAN.VALORORIGINAL
ELSE FLAN.VALORBAIXADO
END VALOR,
'M' CLASSIFICACAO,
SGRADECOMPL.VALOR VALORMENSALIDADEGRADE

FROM SMATRICPL (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) 
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) 
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN STIPOCURSO (NOLOCK)
    ON STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA
    AND STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO
INNER JOIN SPLETIVO (NOLOCK)
    ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
    ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
    AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
    ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
INNER JOIN SCONTRATO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPARCELA (NOLOCK)
    ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
INNER JOIN SLAN (NOLOCK)
    ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
	AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SBOLSALAN (NOLOCK)
    ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SLAN.IDLAN = SBOLSALAN.IDLAN
INNER JOIN SBOLSA (NOLOCK)
    ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
    AND SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA    
INNER JOIN FLAN (NOLOCK)
	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SSERVICO (NOLOCK)
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO
INNER JOIN STURMA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.CODTURMA = STURMA.CODTURMA
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
INNER JOIN SGRADECOMPL (NOLOCK)
	ON SGRADECOMPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADECOMPL.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADECOMPL.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADECOMPL.CODGRADE = SHABILITACAOFILIAL.CODGRADE

WHERE SCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND ((:CODFILIAL_N = 0 AND SMATRICPL.CODFILIAL > 0) OR (:CODFILIAL_N > 0 AND SMATRICPL.CODFILIAL = :CODFILIAL_N))
  AND ((:CODTIPOCURSO_N = 0 AND SCURSO.CODTIPOCURSO > 0) OR ( :CODTIPOCURSO_N > 0 AND SCURSO.CODTIPOCURSO = :CODTIPOCURSO_N))
  AND SCURSO.CODCURSO = :CODCURSO1_S
  AND STURMA.CODTURMA LIKE :CODTURMA_S
  AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCIMENTOINICIAL_D AND :DTVENCIMENTOFINAL_D
  AND FLAN.STATUSLAN NOT IN (2)

) X

) Y
GROUP BY CODTURMA, NOME, VALORMENSALIDADEGRADE

) W
GROUP BY W.CODTURMA, W.NOME, W.VALORMENSALIDADEGRADE

)Z";18495;;;;29/09/2021;rafael.prado;0;1;1;1;;;;;658962fd-d66b-4c33-8388-518ec1056ae7;;;-29420;rafael.prado;06/09/2021;rafael.prado;29/09/2021;
S;EDUREL005;ALUNOS RECORRENCIA CARTAO;"SELECT 
	SRECORRENCIACARTAO.RA
FROM SRECORRENCIACARTAO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SRECORRENCIACARTAO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SRECORRENCIACARTAO.IDPERLET
WHERE SPLETIVO.CODPERLET LIKE '%' + :CODPERLET + '%'";242;;;;10/03/2022;consultor1.totvs;0;1;1;1;;;;0;f520ed1b-d28d-4697-bc91-be971676760e;0;;-31878;consultor1.totvs;10/03/2022;consultor1.totvs;10/03/2022;0
S;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
S;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
S;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
S;EDUSQL004;TURMAS DISCIPLINAS POR GESTÃO;"SELECT 
	STURMADISC.IDTURMADISC
FROM STURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SCURSOCOMPL (NOLOCK) ON SCURSOCOMPL.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND SCURSOCOMPL.CODCURSO = SCURSO.CODCURSO
INNER JOIN GCONSIST (NOLOCK) ON GCONSIST.CODTABELA = 'GESTAO'
	AND GCONSIST.CODCLIENTE = SCURSOCOMPL.GESTAO
WHERE GCONSIST.DESCRICAO LIKE '%' + :GESTAO + '%'";648;;;;10/03/2022;consultor1.totvs;0;1;1;1;;;;0;965422d2-d44b-4921-868f-dbe75330cf72;0;;17804;consultor1.totvs;10/03/2022;consultor1.totvs;10/03/2022;0
S;FECHAMENTO.2;Apuração de Resultado - Resultado Final;"
SELECT
     
  CASE WHEN SNOTAETAPA.NOTAFALTA IS NULL THEN 100 ELSE  ROUND(100 - ((SNOTAETAPA.NOTAFALTA * 100)/SNOTAETAPA.AULASDADAS),2) END AS FREQ

     
     
     
     
     ,(SELECT
             COUNT(SETAPAS.CODETAPA)
       FROM SETAPAS (NOLOCK)
       WHERE SETAPAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
       AND SETAPAS.IDTURMADISC = STURMADISC.IDTURMADISC
       AND SETAPAS.TIPOETAPA = 'N'
      ) AS QTDE_ETAPA
     
           
FROM SMATRICULA (NOLOCK) INNER JOIN SMATRICPL (NOLOCK)
ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
AND SMATRICULA.IDPERLET = SMATRICPL.IDPERLET
AND SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
AND SMATRICULA.RA = SMATRICPL.RA
/*AND SMATRICULA.CODSTATUS = '2' CURSANDO*/

INNER JOIN SHABILITACAOFILIAL (NOLOCK)
ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

INNER JOIN SPLETIVO (NOLOCK)
ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
AND SPLETIVO.CODFILIAL = SMATRICPL.CODFILIAL
AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET

INNER JOIN STURMADISC (NOLOCK)
ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
/*AND STURMADISC.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL*/
AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC

INNER JOIN SDISCIPLINA (NOLOCK)
ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC

LEFT JOIN SNOTAETAPA (NOLOCK)
ON SNOTAETAPA.CODCOLIGADA = SMATRICULA.CODCOLIGADA
AND SNOTAETAPA.IDTURMADISC = SMATRICULA.IDTURMADISC
AND SNOTAETAPA.RA = SMATRICULA.RA
AND SNOTAETAPA.TIPOETAPA = 'F'

WHERE SMATRICULA.CODCOLIGADA =:FRM_CODCOLIG
AND SMATRICULA.IDHABILITACAOFILIAL =:FRM_IDHAB 
AND SMATRICULA.IDTURMADISC =:FRM_IDTURMAD
AND SMATRICULA.RA =:FRM_RA

GROUP BY 
        SHABILITACAOFILIAL.CODCURSO        
       ,SDISCIPLINA.CH
       ,SDISCIPLINA.NOME
       ,SDISCIPLINA.ESTAGIO 
       ,STURMADISC.CODCOLIGADA
       ,STURMADISC.IDTURMADISC
       ,SNOTAETAPA.NOTAFALTA
       ,SNOTAETAPA.AULASDADAS";2089;;;;21/09/2021;consultor1.totvs;0;1;1;1;;;;0;8189c89e-cea5-472a-9a74-50a8713752a3;0;;-32525;consultor1.totvs;21/09/2021;consultor1.totvs;21/09/2021;0
S;Filtro.011;Filtro SPS DOC OK IDPS;select IDPS from SPSARQUIVOSCANDIDATO (nolock) Where DETALHE like '%DOC OK';75;;;;11/06/2021;mestre;0;1;1;1;;;;0;ca6c64c1-e77d-4c81-8c1b-4c030c6c439a;0;;14697;mestre;11/06/2021;mestre;11/06/2021;0
S;Filtro.015;Filtro SPS DOC ENVIADO IDPS;"select IDPS 
from SPSARQUIVOSCANDIDATO (nolock) 
Where DETALHE not like '%DOC' and DETALHE not like '%DOC OK'";111;;;;14/06/2021;mestre;0;1;1;1;;;;0;5254d617-0bac-4a7f-9937-1495abd4e14f;0;;28879;mestre;11/06/2021;mestre;14/06/2021;0
S;Filtro.SPS.001;Filtro Incrições com Nota;"SELECT SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS FROM SPSINSCRICAOAREAOFERTADA 
WHERE SPSINSCRICAOAREAOFERTADA.ENEMNOTAREDACAO > 0";127;;;;31/05/2021;mestre;0;1;1;1;;;;0;6b049c93-6cab-40de-9060-1a3201d168ba;0;;20651;mestre;31/05/2021;mestre;31/05/2021;0
S;FIN.002;Alunos Dependencia e Aprovação por Bolsa;"DECLARE @PERLET VARCHAR(MAX);

SET @PERLET = :CODPERLET;


IF RIGHT(@PERLET,1) = 1

BEGIN


SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SPLETIVO.CODPERLET,
	PPESSOA.NOME AS 'ALUNO',
	SCONTRATO.RA,
	SBOLSA.NOME AS 'BOLSA',
	ISNULL(DEP.TOTAL,0) + ISNULL(DEPAP.TOTAL,0) AS 'DEPENDENCIA',
	ISNULL(CONC.TOTAL,0) AS 'APROVADAS',
	ISNULL(CONCLU.TOTAL,0) + ISNULL(CONCLUAP.TOTAL,0) AS 'CONCLUIDAS',
	SCONTRATO.CODCONTRATO,
	SCURSO.NOME AS 'CURSO',
	SSTATUS.DESCRICAO AS 'STATUS CURSO'
FROM SCONTRATO (NOLOCK)
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SBOLSAALUNO ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SBOLSAALUNO.RA = SCONTRATO.RA
	AND SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO
	AND SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SBOLSA ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
	AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA

OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA
FROM SMATRICULA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%REPROVADO%'
	AND SMATRICULA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICULA.RA = SHABILITACAOALUNO.RA
	AND SMATRICULA.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA

	) AS DEP



OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA
FROM SHISTDISCFAC
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHISTDISCFAC.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%REPROVADO%'
	
	AND SHISTDISCFAC.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCFAC.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCFAC.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA


	) AS DEPAP

OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	CODCOLIGADA
FROM SHISTDISCCONCLUIDAS (NOLOCK)
WHERE 
	SHISTDISCCONCLUIDAS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCCONCLUIDAS.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCCONCLUIDAS.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	CODCOLIGADA
	) AS CONC






OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA
FROM SMATRICULA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%CONCLUIDO%'
	AND SMATRICULA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICULA.RA = SHABILITACAOALUNO.RA
	AND SMATRICULA.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA

	) AS CONCLU



OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA
FROM SHISTDISCFAC
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHISTDISCFAC.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%CONCLUIDO%'
	
	AND SHISTDISCFAC.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCFAC.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCFAC.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA


	) AS CONCLUAP

WHERE 
1=1
AND (SPLETIVO.CODPERLET = @PERLET
OR SPLETIVO.CODPERLET LIKE LEFT(@PERLET,4) + '%1%M'
OR SPLETIVO.CODPERLET LIKE LEFT(@PERLET,4) + '%2%M')
AND SCONTRATO.STATUS = 'N'
AND SBOLSA.NOME LIKE '%'+ :BOLSA + '%'

GROUP BY
	GFILIAL.NOMEFANTASIA,
	STIPOCURSO.NOME,
	PPESSOA.NOME,
	SCONTRATO.RA,
	SPLETIVO.CODPERLET,
	SBOLSA.NOME,
	DEP.TOTAL,
	DEPAP.TOTAL,
	CONC.TOTAL,
	CONCLUAP.TOTAL,
	CONCLU.TOTAL,
	SCONTRATO.CODCONTRATO,
	SCURSO.NOME,
	SSTATUS.DESCRICAO
	
	
END ELSE

IF RIGHT(@PERLET,1) = 2

BEGIN

SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SPLETIVO.CODPERLET,
	PPESSOA.NOME AS 'ALUNO',
	SCONTRATO.RA,
	SBOLSA.NOME AS 'BOLSA',
	ISNULL(DEP.TOTAL,0) + ISNULL(DEPAP.TOTAL,0) AS 'DEPENDENCIA',
	ISNULL(CONC.TOTAL,0) AS 'APROVADAS',
	ISNULL(CONCLU.TOTAL,0) + ISNULL(CONCLUAP.TOTAL,0) AS 'CONCLUIDAS',
	SCONTRATO.CODCONTRATO,
	SCURSO.NOME AS 'CURSO',
	SSTATUS.DESCRICAO AS 'STATUS CURSO'
FROM SCONTRATO (NOLOCK)
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SBOLSAALUNO ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SBOLSAALUNO.RA = SCONTRATO.RA
	AND SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO
	AND SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SBOLSA ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
	AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA

OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA
FROM SMATRICULA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%REPROVADO%'
	AND SMATRICULA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICULA.RA = SHABILITACAOALUNO.RA
	AND SMATRICULA.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA

	) AS DEP



OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA
FROM SHISTDISCFAC
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHISTDISCFAC.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%REPROVADO%'
	
	AND SHISTDISCFAC.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCFAC.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCFAC.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA


	) AS DEPAP

OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	CODCOLIGADA
FROM SHISTDISCCONCLUIDAS (NOLOCK)
WHERE 
	SHISTDISCCONCLUIDAS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCCONCLUIDAS.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCCONCLUIDAS.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	CODCOLIGADA
	) AS CONC
	
	
	


OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA
FROM SMATRICULA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%CONCLUIDO%'
	AND SMATRICULA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICULA.RA = SHABILITACAOALUNO.RA
	AND SMATRICULA.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA

	) AS CONCLU



OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA
FROM SHISTDISCFAC
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHISTDISCFAC.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%CONCLUIDO%'
	
	AND SHISTDISCFAC.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCFAC.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCFAC.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA


	) AS CONCLUAP


WHERE 
1=1
AND (SPLETIVO.CODPERLET = @PERLET
OR SPLETIVO.CODPERLET LIKE LEFT(@PERLET,4) + '%3%M'
OR SPLETIVO.CODPERLET LIKE LEFT(@PERLET,4) + '%4%M')
AND SCONTRATO.STATUS = 'N'
AND SBOLSA.NOME LIKE '%'+ :BOLSA + '%'

GROUP BY
	GFILIAL.NOMEFANTASIA,
	STIPOCURSO.NOME,
	PPESSOA.NOME,
	SCONTRATO.RA,
	SPLETIVO.CODPERLET,
	SBOLSA.NOME,
	DEP.TOTAL,
	DEPAP.TOTAL,
	CONC.TOTAL,
	CONCLUAP.TOTAL,
	CONCLU.TOTAL,
	SCONTRATO.CODCONTRATO,
	SCURSO.NOME,
	SSTATUS.DESCRICAO
	
	END
	
ELSE

BEGIN

SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SPLETIVO.CODPERLET,
	PPESSOA.NOME AS 'ALUNO',
	SCONTRATO.RA,
	SBOLSA.NOME AS 'BOLSA',
	ISNULL(DEP.TOTAL,0) + ISNULL(DEPAP.TOTAL,0) AS 'DEPENDENCIA',
	ISNULL(CONC.TOTAL,0) AS 'APROVADAS',
	ISNULL(CONCLU.TOTAL,0) + ISNULL(CONCLUAP.TOTAL,0) AS 'CONCLUIDAS',
	SCONTRATO.CODCONTRATO,
	SCURSO.NOME AS 'CURSO',
	SSTATUS.DESCRICAO AS 'STATUS CURSO'
FROM SCONTRATO (NOLOCK)
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SBOLSAALUNO ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SBOLSAALUNO.RA = SCONTRATO.RA
	AND SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO
	AND SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SBOLSA ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
	AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA

OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA
FROM SMATRICULA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%REPROVADO%'
	AND SMATRICULA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICULA.RA = SHABILITACAOALUNO.RA
	AND SMATRICULA.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA

	) AS DEP



OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA
FROM SHISTDISCFAC
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHISTDISCFAC.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%REPROVADO%'
	
	AND SHISTDISCFAC.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCFAC.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCFAC.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA


	) AS DEPAP

OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	CODCOLIGADA
FROM SHISTDISCCONCLUIDAS (NOLOCK)
WHERE 
	SHISTDISCCONCLUIDAS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCCONCLUIDAS.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCCONCLUIDAS.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	CODCOLIGADA
	) AS CONC
	
	
	


OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA
FROM SMATRICULA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%CONCLUIDO%'
	AND SMATRICULA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICULA.RA = SHABILITACAOALUNO.RA
	AND SMATRICULA.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SMATRICULA.CODCOLIGADA

	) AS CONCLU



OUTER APPLY (

SELECT COUNT(*) AS TOTAL,
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA
FROM SHISTDISCFAC
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHISTDISCFAC.CODSTATUS
WHERE 
	SSTATUS.DESCRICAO LIKE '%CONCLUIDO%'
	
	AND SHISTDISCFAC.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHISTDISCFAC.RA = SHABILITACAOALUNO.RA
	AND SHISTDISCFAC.IDPERLET = SPLETIVO.IDPERLET
GROUP BY
	RA,
	IDHABILITACAOFILIAL,
	SHISTDISCFAC.CODCOLIGADA


	) AS CONCLUAP


WHERE 
1=1
AND (SPLETIVO.CODPERLET = @PERLET)
AND SCONTRATO.STATUS = 'N'
AND SBOLSA.NOME LIKE '%'+ :BOLSA + '%'

GROUP BY
	GFILIAL.NOMEFANTASIA,
	STIPOCURSO.NOME,
	PPESSOA.NOME,
	SCONTRATO.RA,
	SPLETIVO.CODPERLET,
	SBOLSA.NOME,
	DEP.TOTAL,
	DEPAP.TOTAL,
	CONC.TOTAL,
	CONCLUAP.TOTAL,
	CONCLU.TOTAL,
	SCONTRATO.CODCONTRATO,
	SCURSO.NOME,
	SSTATUS.DESCRICAO
	
	
END";16855;;;;05/05/2022;consultor1.totvs;0;1;1;1;;;;1;f2b568d8-8fce-4d4f-9b1a-80d527adca52;0;;8208;consultor1.totvs;28/04/2022;consultor1.totvs;05/05/2022;0
S;FIN.003;Quantidade de Alunos Emissão de Notas;"IF :FILIAL = 1
BEGIN
SELECT DISTINCT COUNT(P.RA) AS 'TOTAL ALUNOS'
FROM   SPARCELA P
INNER JOIN SCONTRATO C ON  P.CODCOLIGADA = C.CODCOLIGADA
	AND    P.RA = C.RA
	AND    P.CODCONTRATO = C.CODCONTRATO
	AND    P.IDPERLET = C.IDPERLET
INNER JOIN SMATRICPL SM ON C.CODCOLIGADA = SM.CODCOLIGADA
	AND    C.IDPERLET = SM.IDPERLET
	AND    C.IDHABILITACAOFILIAL = SM.IDHABILITACAOFILIAL
	AND    C.RA = SM.RA
INNER JOIN SLAN LP ON LP.CODCOLIGADA = P.CODCOLIGADA
	AND    LP.IDPARCELA = P.IDPARCELA
INNER JOIN FLAN L ON LP.CODCOLIGADA = L.CODCOLIGADA
	AND    LP.IDLAN = L.IDLAN
INNER JOIN FBOLETO B ON L.CODCOLIGADA = B.CODCOLIGADA
	AND    L.IDBOLETO = B.IDBOLETO
INNER JOIN SSTATUS S ON SM.CODCOLIGADA = S.CODCOLIGADA
AND SM.CODSTATUS = S.CODSTATUS
WHERE MONTH(L.DATAVENCIMENTO)=:MES
AND    YEAR(L.DATAVENCIMENTO)=:ANO
AND    SM.CODFILIAL=:FILIAL
AND B.STATUS <> 2
AND S.DESCRICAO LIKE '%CURSANDO%'
END
ELSE
BEGIN

SELECT DISTINCT COUNT(P.RA) AS 'TOTAL ALUNOS'
FROM   SPARCELA P
INNER JOIN SCONTRATO C ON  P.CODCOLIGADA = C.CODCOLIGADA
	AND    P.RA = C.RA
	AND    P.CODCONTRATO = C.CODCONTRATO
	AND    P.IDPERLET = C.IDPERLET
INNER JOIN SMATRICPL SM ON C.CODCOLIGADA = SM.CODCOLIGADA
	AND    C.IDPERLET = SM.IDPERLET
	AND    C.IDHABILITACAOFILIAL = SM.IDHABILITACAOFILIAL
	AND    C.RA = SM.RA
INNER JOIN SLAN LP ON LP.CODCOLIGADA = P.CODCOLIGADA
	AND    LP.IDPARCELA = P.IDPARCELA
INNER JOIN FLAN L ON LP.CODCOLIGADA = L.CODCOLIGADA
	AND    LP.IDLAN = L.IDLAN
INNER JOIN FBOLETO B ON L.CODCOLIGADA = B.CODCOLIGADA
	AND    L.IDBOLETO = B.IDBOLETO
INNER JOIN SSTATUS S ON SM.CODCOLIGADA = S.CODCOLIGADA
AND SM.CODSTATUS = S.CODSTATUS
WHERE MONTH(L.DATAVENCIMENTO)=:MES
AND    YEAR(L.DATAVENCIMENTO)=:ANO
AND    SM.CODFILIAL=:FILIAL
AND B.VALOR > 0
AND B.STATUS <> 2
AND S.DESCRICAO LIKE '%CURSANDO%'

END

";1821;;;;03/05/2022;consultor1.totvs;0;1;1;1;;;;1;17bc2c9d-cd3d-4d9e-a86a-84cb6d11f7b0;0;;4165;consultor1.totvs;28/04/2022;consultor1.totvs;03/05/2022;0
S;FIN.004;Informações das Turmas;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	STURMA.CODTURMA,
	STURMA.NOME AS 'NOME TURMA',
	SCURSO.NOME AS 'CURSO',
	SGRADE.CODHABILITACAO,
	SGRADE.DESCRICAO AS 'MATRIZ',
	CONVERT(VARCHAR,STURMA.DTINICIAL,103) AS 'DTINICIAL',
	CONVERT(VARCHAR,STURMA.DTFINAL,103) AS 'DTFINAL',
	GCCUSTO.CODCCUSTO,
	GCCUSTO.NOME AS 'CENTRO CUSTO',
	SPLETIVO.CODPERLET,
	SCURSOCOMPL.TEMPO AS 'TEMPO CURSO',
	CASE WHEN STURMACOMPL.INGRESSANTE = 'T' THEN 'SIM'
		ELSE 'NAO'
		END 'TURMA INGRESSANTE',
	1 AS 'TOTAL'
FROM STURMA
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMA.IDHABILITACAOFILIAL
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMA.IDPERLET
INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN GCCUSTO ON GCCUSTO.CODCOLIGADA = STURMA.CODCOLIGADA
	AND GCCUSTO.CODCCUSTO = STURMA.CODCCUSTO

LEFT JOIN SCURSOCOMPL ON SCURSOCOMPL.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND SCURSOCOMPL.CODCURSO = SCURSO.CODCURSO

LEFT JOIN STURMACOMPL ON STURMACOMPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND STURMACOMPL.CODTURMA = STURMA.CODTURMA
	AND STURMACOMPL.CODFILIAL = STURMA.CODFILIAL
	AND STURMACOMPL.IDPERLET = STURMA.IDPERLET

WHERE SPLETIVO.CODPERLET = :CODPERLET";1909;;;;05/05/2022;consultor1.totvs;0;1;1;1;;;;0;3e3ac11b-f126-46c7-b841-ec99e986831e;0;;-194;consultor1.totvs;04/05/2022;consultor1.totvs;05/05/2022;0
S;FIN.004.1;Cabeçalho;"SELECT
 FCFO.CODCOLIGADA,
 FCFO.CODCFO,
 FCFO.NOME,
 FCFO.CGCCFO

FROM
 FCFO (NOLOCK)
 
WHERE	FCFO.CODCOLIGADA = :CODCOLIGADA
	AND FCFO.CODCFO = :CODCFO";162;;;;29/03/2022;robson.canto;0;1;1;1;;;;0;15c4e1fe-87ae-4815-8f88-f7d1924951d5;0;;-687;robson.canto;29/03/2022;robson.canto;29/03/2022;0
S;FIN.004.2;Detalhes;"SELECT
 X.RA,
 X.ALUNO,
 X.FILIAL,
 X.CODPERLET,
 X.CURSO,
 
 X.PARCELA,
 X.NUMERODOCUMENTO,
 X.DATAVENCIMENTO,
 X.VALOR,

 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO NOT IN ('SELETIVO', 'TAX_APRO', 'TAX_EXT') THEN (((X.VALOR * 0.01) / 30) * DATEDIFF(DAY, X.DATAVENCIMENTO, GETDATE()))
 	  ELSE 0 END JUROS,

 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO NOT IN ('SELETIVO', 'TAX_APRO', 'TAX_EXT') THEN X.VALOR * 0.02
 	  ELSE 0 END MULTA,
 	  
 X.CUSTAS,  

 CASE WHEN X.CODCFO <> '58807' AND
 		   X.PARCELA <> 1 AND
 		   X.CODTDO NOT IN ('SELETIVO', 'TAX_APRO', 'TAX_EXT') THEN X.VALOR + X.CUSTAS + (X.VALOR * 0.02) + (((X.VALOR * 0.01) / 30) * DATEDIFF(DAY, X.DATAVENCIMENTO, GETDATE()))
 	  ELSE X.VALOR + X.CUSTAS END LIQUIDO

FROM
(SELECT
  FLAN.CODTDO,
  FLAN.CODCFO,
  SALUNO.RA,
  PPESSOA.NOME ALUNO,
  GFILIAL.NOME FILIAL,
  SPLETIVO.CODPERLET,
  SCURSO.NOME CURSO,
 
  SPARCELA.PARCELA,
  FLAN.NUMERODOCUMENTO,
  FLAN.DATAVENCIMENTO,
  FLAN.VALOROP7 CUSTAS,
 
  FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - 
  ISNULL((SELECT
   		  SUM(FLANINTEGRACAO.VALOR)
  
  		 FROM
   		  FLANINTEGRACAO (NOLOCK)
   
  		 WHERE	FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA
  			AND FLANINTEGRACAO.IDLAN = FLAN.IDLAN
  			AND FLANINTEGRACAO.IDCAMPO <> 49), 0) VALOR
 
 
 FROM
  FLAN (NOLOCK)
 
  INNER JOIN GFILIAL (NOLOCK)			ON FLAN.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
 								   		   FLAN.CODFILIAL = GFILIAL.CODFILIAL
 
  INNER JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 							   	   		   SLAN.IDLAN = FLAN.IDLAN
 							   
  INNER JOIN SPARCELA (NOLOCK)			 ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   		    SPARCELA.IDPARCELA = SLAN.IDPARCELA 							   
 
  INNER JOIN SALUNO (NOLOCK)			 ON SALUNO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
 								   			SALUNO.RA = SPARCELA.RA
 
  INNER JOIN PPESSOA (NOLOCK)			 ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 
  INNER JOIN SPLETIVO (NOLOCK)			 ON SPLETIVO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
 								   		    SPLETIVO.IDPERLET = SPARCELA.IDPERLET
 								   
  INNER JOIN SCONTRATO (NOLOCK)			 ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 								   		    SCONTRATO.RA = SPARCELA.RA AND 
 								   		    SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 								   		    SCONTRATO.IDPERLET = SPARCELA.IDPERLET 								   
 
  INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										    SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
 										   
 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO 										   

WHERE	FLAN.CODCOLIGADA = :CODCOLIGADA1
	AND FLAN.CODCFO = :CODCFO1
	AND FLAN.STATUSLAN IN (0, 4)
	AND FLAN.DATAVENCIMENTO < GETDATE()
	
) X	";3016;;;;28/09/2022;robson.canto;0;1;1;1;;;;0;28b7a738-1dd1-494c-8640-3f36813bb936;0;;-31611;robson.canto;29/03/2022;robson.canto;28/09/2022;0
S;FIN.005.1;Cabeçalho;"SELECT
 FCFO.CODCOLIGADA,
 FCFO.CODCFO,
 FCFO.NOME,
 FCFO.CGCCFO

FROM
 SALUNO (NOLOCK)
 
 INNER JOIN FCFO (NOLOCK)	ON SALUNO.CODCOLCFO = FCFO.CODCOLIGADA AND
 							   SALUNO.CODCFO = FCFO.CODCFO
 
WHERE	SALUNO.CODCOLIGADA = :CODCOLIGADA
	AND SALUNO.RA = :RA";273;;;;29/03/2022;robson.canto;0;1;1;1;;;;0;15c4e1fe-87ae-4815-8f88-f7d1924951d5;0;;20298;robson.canto;29/03/2022;robson.canto;29/03/2022;0
S;FIN_Parcelas;Parcelas não geradas;"SELECT *
FROM   z_Unasp_ParcelasNaoGeradas
WHERE  CODPERLET LIKE :CODPERLET + '%' 
";86;;;;18/10/2021;isaldo;0;1;1;1;;;;0;a2f9a243-3837-4b13-9a6d-6470f467454a;0;;14709;isaldo;18/10/2021;isaldo;18/10/2021;0
S;FLR.EDU004;Professor Sem Preencher Espaço Diversificado;"SELECT DISTINCT
	SPROFESSOR.CODPROF
FROM SPROFESSOR (NOLOCK)
INNER JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
	AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
OUTER APPLY(
SELECT *
FROM SPLANOAULA
WHERE LICAOCASA IS NOT NULL
AND LICAOCASA <> '    '
AND SPLANOAULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLANOAULA.IDTURMADISC = STURMADISC.IDTURMADISC
) AS A

WHERE SPLETIVO.CODPERLET = :CODPERLET
AND SPROFESSORTURMA.TIPOPROF = 'T'
AND A.CODCOLIGADA IS NULL


";798;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;0;e1cb0713-d85f-4ca8-8771-12c412d07bdb;0;;22503;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;FLT.ALUNOSTURMA;ALUNOS POR TURMA;"SELECT SMATRICPL.RA
	FROM SMATRICPL (NOLOCK)
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			AND SPLETIVO.CODFILIAL = SMATRICPL.CODFILIAL
WHERE SMATRICPL.CODCOLIGADA = :$CODCOLIGADA
AND SMATRICPL.CODFILIAL = :$CODFILIAL
AND SPLETIVO.CODTIPOCURSO = :$CODTIPOCURSO
AND SPLETIVO.CODPERLET = :PERIODO_LETIVO
AND CODTURMA LIKE '%' + :CODTURMA + '%' 
";439;;;;09/12/2021;consultor1.totvs;0;1;1;1;;;;0;ad9680bb-dc25-4895-9cd6-7160268f02e9;0;;3822;consultor1.totvs;09/12/2021;consultor1.totvs;09/12/2021;0
S;FLT.DISCXPLANO;DISCIPLINAS COM MENOR QUANTIDADE DE PLANO GERADO CONFORME CRÉDITOS (N*20);"SELECT STURMADISC.IDTURMADISC
	FROM STURMADISC (NOLOCK)
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
			AND SPLETIVO.CODFILIAL = STURMADISC.CODFILIAL
			AND SPLETIVO.CODTIPOCURSO = STURMADISC.CODTIPOCURSO
		INNER JOIN SDISCIPLINA (NOLOCK) ON
			SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	    OUTER APPLY (SELECT COUNT(AULA)QTDE
						FROM SPLANOAULA
      				 WHERE IDTURMADISC = STURMADISC.IDTURMADISC)AULAS
WHERE STURMADISC.CODCOLIGADA = :$CODCOLIGADA
AND STURMADISC.CODFILIAL = :$CODFILIAL
AND STURMADISC.CODTIPOCURSO = :$CODTIPOCURSO
AND SPLETIVO.CODPERLET = :CODPERLET_S
AND SDISCIPLINA.NUMCREDITOS = :CREDITOS_N
AND AULAS.QTDE < (SDISCIPLINA.NUMCREDITOS * 20)";824;;;;25/11/2021;consultor1.totvs;0;1;1;1;;;;0;235fd255-6274-4a4d-8246-4197d1f3b364;0;;-23183;consultor1.totvs;25/11/2021;maik.souza;06/10/2022;0
S;FLT.DISCXPLANO21;DISCIPLINAS COM MENOR QUANTIDADE DE PLANO GERADO CONFORME CRÉDITOS (N*18);"SELECT STURMADISC.IDTURMADISC
	FROM STURMADISC (NOLOCK)
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
			AND SPLETIVO.CODFILIAL = STURMADISC.CODFILIAL
			AND SPLETIVO.CODTIPOCURSO = STURMADISC.CODTIPOCURSO
		INNER JOIN SDISCIPLINA (NOLOCK) ON
			SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	    OUTER APPLY (SELECT COUNT(AULA)QTDE
						FROM SPLANOAULA
      				 WHERE IDTURMADISC = STURMADISC.IDTURMADISC)AULAS
WHERE STURMADISC.CODCOLIGADA = :$CODCOLIGADA
AND STURMADISC.CODFILIAL = :$CODFILIAL
AND STURMADISC.CODTIPOCURSO = :$CODTIPOCURSO
AND SPLETIVO.CODPERLET = :CODPERLET_S
AND SDISCIPLINA.NUMCREDITOS = :CREDITOS_N
AND AULAS.QTDE < (SDISCIPLINA.NUMCREDITOS * 18)";824;;;;08/12/2021;consultor1.totvs;0;1;1;1;;;;0;c9a92017-295e-4d83-b868-4e1433e899f0;0;;-13973;consultor1.totvs;08/12/2021;maik.souza;06/10/2022;0
S;FLT.EDU001;Professores Sem Conteudo Realizado Preenchido Enviar Email;"SELECT DISTINCT
	SPROFESSOR.CODPROF
FROM SPROFESSOR (NOLOCK)
INNER JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
	AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
INNER JOIN SHORARIOTURMA (NOLOCK) ON SHORARIOTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHORARIOTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SPLANOAULA (NOLOCK) ON SPLANOAULA.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA
	AND SPLANOAULA.IDHORARIOTURMA = SHORARIOTURMA.IDHORARIOTURMA
WHERE SPLETIVO.CODPERLET = :CODPERLET

AND SPROFESSORTURMA.TIPOPROF = 'T'
AND SPLANOAULA.DATA <= GETDATE()
AND CONTEUDOEFETIVO IS NULL
";915;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;0;dafdbffe-ec04-487d-b5ac-06181978d65d;0;;22456;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;FLT.EDU002;Professores por Quantidade de Avaliações Criadas;"SELECT DISTINCT
	SPROFESSOR.CODPROF
FROM SPROFESSOR (NOLOCK)
INNER JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
	AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO

OUTER APPLY(

SELECT COUNT(*) AS 'TPROVAS'
FROM SPROVAS (NOLOCK)
WHERE SPROVAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPROVAS.IDTURMADISC = STURMADISC.IDTURMADISC
	AND SPROVAS.TIPOETAPA = 'N'
	AND SPROVAS.CODETAPA = 1
) AS A


WHERE SPLETIVO.CODPERLET = :CODPERLET_S
AND SPROFESSORTURMA.TIPOPROF = 'T'
AND A.TPROVAS = :QTDPROVAS_I
";1085;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;0;26e3a262-a5ca-4ecb-a4d1-1dc9d4f39ecf;0;;293;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;FLT.EDU003;Professor por Periodo Letivo;"SELECT DISTINCT
	SPROFESSOR.CODPROF
FROM SPROFESSOR
INNER JOIN SPROFESSORTURMA ON SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
	AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPLETIVO.CODPERLET = :CODPERLET

";485;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;0;405a0161-b119-4785-b2f0-02f9610e9920;0;;-6765;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;FLT.EDU004;Turmas Disciplinas Sem IDCANVAS;"SELECT 
	STURMADISC.IDTURMADISC
FROM STURMADISC
INNER JOIN STURMADISCCOMPL ON STURMADISCCOMPL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND STURMADISCCOMPL.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE STURMADISCCOMPL.IDCANVAS IS NULL
AND SPLETIVO.CODPERLET = :CODPERLET";385;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;0;59820bc4-dc2a-4e93-83ba-ab083ff0d48f;0;;4263;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;FLT.EDU005;Alunos Liberação Avaliação Institucional;"SELECT DISTINCT SMATRICPL.RA
FROM SALUNO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.RA = SALUNO.RA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE SSTATUS.DESCRICAO LIKE '%CURSANDO%'
AND SPLETIVO.CODPERLET = :CODPERLET
AND SPLETIVO.CODFILIAL = :$CODFILIAL
AND SPLETIVO.CODTIPOCURSO = :$CODTIPOCURSO";529;;;;06/06/2022;consultor1.totvs;0;1;1;1;;;;0;404d5831-a408-46e9-84fd-86b4513eb165;0;;-24269;consultor1.totvs;02/06/2022;consultor1.totvs;06/06/2022;0
S;FLT.EDU006;Avaliação Institucional Turmas não Mega;"SELECT 
	STURMADISC.IDTURMADISC
FROM STURMADISC
INNER JOIN STURMADISCCOMPL ON STURMADISCCOMPL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND STURMADISCCOMPL.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPLETIVO.CODPERLET = :CODPERLET
AND STURMADISCCOMPL.TIPOTURMADISC NOT IN ('03')";396;;;;08/06/2022;maik.souza;0;1;1;1;;;;0;f65488b4-9be8-4b1c-b1d8-ec1d6dfe411e;0;;12890;consultor1.totvs;06/06/2022;maik.souza;08/06/2022;0
S;FLT.EDU007;Avaliação Institucional Turmas Mega;"SELECT 
	STURMADISC.IDTURMADISC
FROM STURMADISC
INNER JOIN STURMADISCCOMPL ON STURMADISCCOMPL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND STURMADISCCOMPL.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPLETIVO.CODPERLET = :CODPERLET
AND STURMADISCCOMPL.TIPOTURMADISC IN ('03')";392;;;;06/06/2022;consultor1.totvs;0;1;1;1;;;;0;7ae84b73-69cf-41cd-bf74-731bcb284777;0;;-16852;consultor1.totvs;06/06/2022;consultor1.totvs;06/06/2022;0
S;FLT.EDU008;Filtro para Alunos ENADE;"SELECT SMATRICPL.RA
FROM SMATRICPL (NOLOCK)
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

	
OUTER APPLY(
SELECT SM.RA
FROM SMATRICPL SM
INNER JOIN SPLETIVO SP ON SP.CODCOLIGADA = SM.CODCOLIGADA
	AND SP.IDPERLET = SM.IDPERLET
WHERE SM.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SM.RA = SMATRICPL.RA
	AND SM.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SM.IDPERLET = SPLETIVO.IDPERLETANT) AS ING

WHERE SPLETIVO.CODPERLET = :CODPERLET
AND SCURSO.NOME LIKE '%' + :CURSO + '%'
AND SPLETIVO.CODFILIAL = :$CODFILIAL
AND SPLETIVO.CODTIPOCURSO = :$CODTIPOCURSO
AND SSTATUS.DESCRICAO IN ('CURSANDO','TRANCADO')
AND ING.RA IS NULL
";1161;;;;02/08/2022;consultor1.totvs;0;1;1;1;;;;0;27be35ba-b0b1-4861-a1d9-ca00c9d6bbe8;0;;-32019;consultor1.totvs;02/08/2022;consultor1.totvs;02/08/2022;0
S;FLT.EDU009;Turmas Disciplinas com Provas Fora da Ordem;"SELECT DISTINCT TEMP.IDTURMADISC
FROM(
SELECT 
	ROW_NUMBER () OVER (PARTITION BY SPROVAS.IDTURMADISC,SPROVAS.CODETAPA ORDER BY SPROVAS.CODPROVA) AS 'CODROW',
	SPROVAS.CODPROVA,
	STURMADISC.IDTURMADISC,
	SPROVAS.CODETAPA
FROM STURMADISC (NOLOCK)
INNER JOIN SETAPAS (NOLOCK) ON SETAPAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SETAPAS.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SPROVAS (NOLOCK) ON SPROVAS.CODCOLIGADA = SETAPAS.CODCOLIGADA
	AND SPROVAS.IDTURMADISC = SETAPAS.IDTURMADISC
	AND SPROVAS.CODETAPA = SETAPAS.CODETAPA
	AND SPROVAS.TIPOETAPA = SETAPAS.TIPOETAPA
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPROVAS.CODETAPA IN (1)
AND SPLETIVO.CODPERLET = :CODPERLET
AND SPLETIVO.CODFILIAL = :$CODFILIAL
AND SPLETIVO.CODTIPOCURSO = :$CODTIPOCURSO
) TEMP
WHERE TEMP.CODROW <> TEMP.CODPROVA
";908;;;;31/08/2022;consultor1.totvs;0;1;1;1;;;;0;54bc32be-72f1-4d24-b679-1f21b46beb54;0;;-13942;consultor1.totvs;31/08/2022;consultor1.totvs;31/08/2022;0
S;FLT.EDUCOOD2;analise curricular geral (prohelp);"SELECT ANALISECURRICULAR.CODDISC,
       ANALISECURRICULAR.DISCIPLINA,
       ANALISECURRICULAR.STATUS,
       ANALISECURRICULAR.PLETIVO,
       ANALISECURRICULAR.NUMCREDITOS,
       ANALISECURRICULAR.CH,
       ANALISECURRICULAR.NOTA,
       ANALISECURRICULAR.FALTAS,
       ANALISECURRICULAR.TIPO,
       ANALISECURRICULAR.CODCOLIGADA,
       ANALISECURRICULAR.IDHABILITACAOFILIAL,
       ANALISECURRICULAR.RA,
       ANALISECURRICULAR.GREQUIV,
       ANALISECURRICULAR.CODPERIODO,
       ANALISECURRICULAR.CONCEITO,
       ANALISECURRICULAR.CONCEITOECTS,
       ANALISECURRICULAR.MINCH,
       ANALISECURRICULAR.MINCREDITOS,
       ANALISECURRICULAR.MINDISCIPLINAS,
       ANALISECURRICULAR.NOME,
       ANALISECURRICULAR.TIPOAVALIACAO,
       PPESSOA.NOME AS NOMEALUNO
FROM   (SELECT SHISTDISCCONCLUIDAS.CODDISC,
               SHISTDISCCONCLUIDAS.DISCIPLINA,
               SHISTDISCCONCLUIDAS.STATUS,
               SHISTDISCCONCLUIDAS.PLETIVO,
               SHISTDISCCONCLUIDAS.NUMCREDITOS,
               SHISTDISCCONCLUIDAS.CH,
               SHISTDISCCONCLUIDAS.NOTA,
               SHISTDISCCONCLUIDAS.FALTAS,
               'CONC' AS TIPO,
               SHISTDISCCONCLUIDAS.CODCOLIGADA,
               SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
               SHISTDISCCONCLUIDAS.RA,
               SHISTDISCCONCLUIDAS.GREQUIV,
               SHISTDISCCONCLUIDAS.CODPERIODO,
               SHISTDISCCONCLUIDAS.CONCEITO,
               SHISTDISCCONCLUIDAS.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCCONCLUIDAS (NOLOCK)
       INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
       /*WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = :CODCOLIGADA
          AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO
          AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0*/
        UNION
        SELECT SHISTDISCPENDENTES.CODDISC,
               SHISTDISCPENDENTES.DISCIPLINA,
               SHISTDISCPENDENTES.STATUS,
               SHISTDISCPENDENTES.PLETIVO,
               SHISTDISCPENDENTES.NUMCREDITOS,
               SHISTDISCPENDENTES.CH,
               SHISTDISCPENDENTES.NOTA,
               SHISTDISCPENDENTES.FALTAS,
               'PEND' AS TIPO,
               SHISTDISCPENDENTES.CODCOLIGADA,
               SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
               SHISTDISCPENDENTES.RA,
               SHISTDISCPENDENTES.GREQUIV,
               SHISTDISCPENDENTES.CODPERIODO,
               SHISTDISCPENDENTES.CONCEITO,
               SHISTDISCPENDENTES.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCPENDENTES (NOLOCK)
        INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHISTDISCPENDENTES.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
        /*WHERE  SHISTDISCPENDENTES.CODCOLIGADA = :CODCOLIGADA
           AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO              
           AND SHISTDISCPENDENTES.CODPERIODO <> 0*/

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELET.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELET.MINCH,
               SGRUPOOPTELET.MINCREDITOS,
               SGRUPOOPTELET.MINDISCIPLINAS,
               SGRUPOOPTELET.NOME,
               SGRUPOOPTELET.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = 1 )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL 
                      AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO )
               JOIN SGRUPOOPTELET (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
                      AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
                      AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
                      AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
               JOIN SDISCGRUPOOPTELET (NOLOCK)
                 ON ( SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
                      AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
                      AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
                      AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
                      AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  /*SPARAM.CODCOLIGADA = :CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'*/
                (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELET.EXIBEANALISE = 'S'
               AND SGRADEALUNO.RA IS NULL
               AND SHISTDISCOPTELETIVAS.RA NOT IN (SELECT SCOMPONENTECURRALUNO.RA
                                                   FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                   WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)
        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELETALUNO.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELETALUNO.MINCH,
               SGRUPOOPTELETALUNO.MINCREDITOS,
               SGRUPOOPTELETALUNO.MINDISCIPLINAS,
               SGRUPOOPTELETALUNO.NOME,
               SGRUPOOPTELETALUNO.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = 1 )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                      AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO )
               JOIN SGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
               JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
                      AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  /*SPARAM.CODCOLIGADA = :CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO*/
                SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
               AND ( SGRADEALUNO.RA IS NOT NULL
                      OR SHISTDISCOPTELETIVAS.RA IN (SELECT SCOMPONENTECURRALUNO.RA
                                                     FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                     WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                            AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                            AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA) )) ANALISECURRICULAR
 LEFT JOIN SALUNO ON SALUNO.CODCOLIGADA = ANALISECURRICULAR.CODCOLIGADA AND SALUNO.RA = ANALISECURRICULAR.RA
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
ORDER  BY ANALISECURRICULAR.RA,
          ANALISECURRICULAR.CODPERIODO,
          ANALISECURRICULAR.NOME";11424;;;;26/09/2022;maik.souza;0;1;1;1;;;;0;b539f97d-66b3-442f-89a9-bd3c97d11969;0;;-25975;marccella.belvedere;26/09/2022;maik.souza;26/09/2022;0
S;FLT.EMAIL;ENVIO DE EMAIL PROFESSOR;"SELECT SPROFESSOR.CODPROF
FROM SPROFESSOR (NOLOCK)
INNER JOIN SPROFESSORCOMPL (NOLOCK) ON SPROFESSORCOMPL.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
	AND SPROFESSOR.CODPROF = SPROFESSORCOMPL.CODPROF
WHERE SPROFESSORCOMPL.EMAIL = 'S'";230;;;;16/05/2022;consultor1.totvs;0;1;1;1;;;;0;a315b2e9-9b65-4e3b-a8ff-bdd10df22c6a;0;;7922;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;flt.prof.perfil;Ver Perfis de Acesso do Professor;"/*Mostra os perfis de acesso do usuario do professor*/

SELECT
	DISTINCT
	GUSRPERFIL.CODPERFIL

FROM  SPROFESSOR (NOLOCK)
	LEFT JOIN PPESSOA (NOLOCK)
		ON SPROFESSOR.CODPESSOA = PPESSOA.CODIGO
	LEFT JOIN GUSUARIO (NOLOCK)
		ON PPESSOA.CODUSUARIO = GUSUARIO.CODUSUARIO
	LEFT JOIN GUSRPERFIL (NOLOCK)
		ON GUSUARIO.CODUSUARIO = GUSRPERFIL.CODUSUARIO
WHERE SPROFESSOR.CODPROF = :CODPROF";396;;;;03/11/2022;maik.souza;0;1;1;1;;;;0;a37c388f-6d52-487d-b555-b18c763680f8;0;;-3715;maik.souza;03/11/2022;maik.souza;09/11/2022;0
S;FLT.SEMDISC;ALUNOS SEM DISCIPLINA LANÇADA;"SELECT SMATRICPL.RA
       
	FROM SMATRICPL
		INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON
			SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		LEFT JOIN SMATRICULA (NOLOCK) ON
			SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SMATRICULA.IDPERLET = SMATRICPL.IDPERLET
			AND SMATRICULA.RA = SMATRICPL.RA
			AND SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			AND SPLETIVO.CODFILIAL = SMATRICPL.CODFILIAL
			AND SPLETIVO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
WHERE SMATRICPL.CODCOLIGADA = :$CODCOLIGADA
AND SMATRICPL.CODFILIAL = :$CODFILIAL
AND SHABILITACAOFILIAL.CODTIPOCURSO = :$CODTIPOCURSO
AND SMATRICPL.CODTIPOMAT = 2	
AND SPLETIVO.CODPERLET = :PERIODO_LETIVO
AND SMATRICPL.CODSTATUS IN(1,2)
GROUP BY SMATRICPL.RA
HAVING COUNT(SMATRICULA.IDTURMADISC) = 0";1025;;;;08/12/2021;consultor1.totvs;0;1;1;1;;;;0;47d44d9f-d1ff-4b04-805b-3c069008f242;0;;-13351;consultor1.totvs;08/12/2021;consultor1.totvs;08/12/2021;0
S;FLUIG.PROSS001;Consulta Matriz Turma;"select top (100) CODPERLET, IDHABILITACAOFILIAL, concat(CODGRADE,' - ', NomGrade,' - ', NomTurno) AS 'DESCRICAOMATRIZ', CODTURMA  
from v_Unasp_TURMA 
where  year(DTINICIO)>=2021 and HABILITACAOFILIAL_Ativo = 'S' 
and NomCurso not in ('Escola de esportes','Escola de idiomas','Pilates','Escola de Artes','Intercâmbio Adventista',
'High School') and CODPERLET=:CODPERLET ";370;;;;10/10/2022;gillead.goncalves;0;1;1;1;;;;0;730c5336-bd1d-4d36-92b5-b55d7e5f5880;0;;-19383;gillead.goncalves;05/10/2022;gillead.goncalves;10/10/2022;0
S;FLUIG.PROSS002;Consulta Periodo Letivo;select IDPERLET, CODPERLET from SPLETIVO where  year(DTINICIO)>=year(getdate ());80;;;;05/10/2022;gillead.goncalves;0;1;1;1;;;;0;7295ba51-2b3c-4209-baf9-ccc3db2ac6e2;0;;31288;gillead.goncalves;05/10/2022;gillead.goncalves;05/10/2022;0
S;FLUIG.PROSS003;Consulta Turma;"select CODPERLET, IDHABILITACAOFILIAL, CODTURMA  
from v_Unasp_TURMA 
where  year(DTINICIO)>=2021 and HABILITACAOFILIAL_Ativo = 'S' 
and NomCurso not in ('Escola de esportes','Escola de idiomas','Pilates','Escola de Artes','Intercâmbio Adventista',
'High School') and CODPERLET= :CODPERLET and IDHABILITACAOFILIAL= :IDHABILITACAOFILIAL";335;;;;07/10/2022;gillead.goncalves;0;1;1;1;;;;0;cc962c28-a93a-48f8-8458-48e22dcc2532;0;;18489;gillead.goncalves;07/10/2022;gillead.goncalves;07/10/2022;0
S;FLUIG.PROSS004;Consulta Centro de Custo;select CODREDUZIDO,CONCAT(NOME,' - ',CODREDUZIDO) as DEPARTAMENTO from GCCUSTO;78;;;;05/10/2022;gillead.goncalves;0;1;1;1;;;;0;538c293d-e729-4c26-8a06-6c31d044cc7e;0;;22911;gillead.goncalves;05/10/2022;gillead.goncalves;05/10/2022;0
S;FUIG.PROSLS005;Consulta FILIAL;Select CODFILIAL, CONCAT(CODFILIAL,' - ',NOME) as CAMPUS  from GFILIAL where CODFILIAL not in(5,7,8);100;;;;05/10/2022;gillead.goncalves;0;1;1;1;;;;0;05e8314c-ae9e-4866-91dd-d5697dbf0843;0;;14564;gillead.goncalves;05/10/2022;gillead.goncalves;05/10/2022;0
S;FV.DEL.INSC;Desmatricular e Excluir Inscrição;"SELECT 
	SALUNO.CODCOLCFO,
	SALUNO.CODCFO,
	SMATRICPL.CODFILIAL,
	PAI.CODPESSOAFILIACAO CODPESSOA_PAI,
	MAE.CODPESSOAFILIACAO CODPESSOA_MAE,
	PPESSOA.CODIGO CODPESSOA_ALUNO,
	SALUNO.CODPESSOARACA,
	SMATRICPL.CODSTATUS,
	SHABILITACAOFILIAL.CODTIPOCURSO,
	SMATRICPL.CODTURMA,
	SPSUSUARIO.CODUSUARIOPS,
	CONVERT(VARCHAR(19), ISNULL(SMATRICPL.DTMATRICULA, GETDATE()), 126) DTMATRICULA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SPSUSUARIO.NOME,
	SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO,
	SMATRICPL.PERIODO,
	SMATRICPL.RA,
	SMATRICPL.CODCOLIGADA,
	SPSOPCAOINSCRITO.IDAREAINTERESSE,
	SMATRICPL.IDPERLET,
	SPSINSCRICAOAREAOFERTADA.IDPS,
	SHABILITACAOALUNO.CODSTATUS CODSTATUS_CURSO,
	'false' USANOVOPORTAL,
	SCONTRATO.CODCONTRATO
FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)
LEFT JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
LEFT JOIN PPESSOA (NOLOCK) PPESSOA_PS
	ON PPESSOA_PS.CODIGO = SPSINSCRICAOAREAOFERTADA.CODPESSOA
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SMATRICPL (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SHABILITACAOALUNO (NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
LEFT JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SALUNO (NOLOCK)
	ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CODIGO = SALUNO.CODPESSOA
OUTER APPLY(
	SELECT 
		CODPESSOAFILIACAO
	FROM VFILIACAO (NOLOCK)
	WHERE VFILIACAO.CODPESSOAFILHO = PPESSOA.CODIGO
		AND VFILIACAO.TIPORELACIONAMENTO = 'P'
)PAI
OUTER APPLY(
	SELECT 
		CODPESSOAFILIACAO
	FROM VFILIACAO (NOLOCK)
	WHERE VFILIACAO.CODPESSOAFILHO = PPESSOA.CODIGO
		AND VFILIACAO.TIPORELACIONAMENTO = 'M'
)MAE
WHERE SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = :CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = :IDPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = :NUMEROINSCRICAO";2759;;;;16/02/2022;consultor1.totvs;0;1;1;1;;;;0;0082e3fb-1190-4227-a0e0-e93d5d2cec66;;;-4624;consultor1.totvs;16/02/2022;consultor1.totvs;16/02/2022;
S;IP96.1;SQL Matrícula;"SELECT
	HA.RA,
	HF.CODFILIAL,
	P.NOME,
	P.CARTIDENTIDADE	Rg,
	P.ORGEMISSORIDENT	RgEmissor,
	P.UFCARTIDENT		RgUF,
	P.CPF				CPF,
	CASE P.SEXO
		WHEN 'F' THEN 'a aluna'
		WHEN 'M' THEN 'o aluno'
					END	GenAlunoA,
	CASE  P.SEXO
		WHEN 'F' THEN 'portadora'
		WHEN 'M' THEN 'portador'
					END	GenPortadorA,
	CASE  P.SEXO
		WHEN 'F' THEN 'matriculada'
		WHEN 'M' THEN 'matriculado'
					END	GenMatriculadoA,	
	PL.CODPERLET		PeriodoLetivo,
	C.NOME				Curso,
	c.CODCURSO			CodCurso,
	T.CODTURMA			CodTurma,
	T.NOME				NomeTurma,
	D.CODDISC			CodDisciplina, 
	D.NOME				NomeDisciplina,
	cast(D.NUMCREDITOS as int) CredDisciplinas,	
	S.DESCRICAO			StatDisciplina,	
	M.DTMATRICULA		DataMatricula,
	Semestres = (
		Select 
			max(CODPERIODO) Semestres
		from 
			SPERIODO 
		where 
			CODCOLIGADA = HF.CODCOLIGADA AND CODCURSO = HF.CODCURSO AND CODHABILITACAO = HF.CODHABILITACAO AND CODGRADE = HF.CODGRADE),	
	CASE TU.TIPO
		WHEN 'I' THEN 'Integral'
		WHEN 'M' THEN 'Matutino'
		WHEN 'N' THEN 'Noturno'
		WHEN 'V' THEN 'Vespertino'
					END TurnoPeriodo,
	TU.HORINI			TurnoHoraInicial,
	TU.HORFIM			TurnoHoraFinal,
	CASE MA.CODFILIAL
		WHEN '1' THEN 'São Paulo,'
		WHEN '2' THEN 'Engenheiro Coelho,'
		WHEN '3' THEN 'Hortolândia,'
					END CIDADE
	
FROM 
	SHABILITACAOALUNO HA
	inner JOIN SALUNO A ON A.CODCOLIGADA = HA.CODCOLIGADA AND A.RA = HA.RA
	inner JOIN PPESSOA P ON P.CODIGO = A.CODPESSOA
	inner JOIN SHABILITACAOFILIAL HF ON HF.CODCOLIGADA = HA.CODCOLIGADA AND HF.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL
	inner JOIN SHABILITACAO H ON H.CODCOLIGADA = HF.CODCOLIGADA AND H.CODCURSO = HF.CODCURSO AND H.CODHABILITACAO = HF.CODHABILITACAO
	inner JOIN SCURSO C ON C.CODCOLIGADA = H.CODCOLIGADA AND C.CODCURSO = H.CODCURSO
	inner JOIN SMATRICPL MA ON MA.CODCOLIGADA = HA.CODCOLIGADA AND MA.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL AND MA.RA = HA.RA
	inner JOIN SPLETIVO PL ON PL.CODCOLIGADA = MA.CODCOLIGADA AND PL.IDPERLET = MA.IDPERLET
	inner JOIN SMATRICULA M ON M.CODCOLIGADA = MA.CODCOLIGADA AND M.IDPERLET = MA.IDPERLET AND M.IDHABILITACAOFILIAL = MA.IDHABILITACAOFILIAL AND M.RA = MA.RA 
	inner JOIN SSTATUS S ON S.CODCOLIGADA = M.CODCOLIGADA AND S.CODSTATUS = M.CODSTATUS
	inner JOIN STURMADISC TD ON TD.IDTURMADISC = M.IDTURMADISC
	inner JOIN STURMA T ON T.CODCOLIGADA =MA.CODCOLIGADA AND T.CODTURMA=MA.CODTURMA AND T.CODFILIAL = MA.CODFILIAL AND T.IDPERLET = MA.IDPERLET
	inner JOIN SDISCIPLINA D ON D.CODCOLIGADA = TD.CODCOLIGADA AND D.CODDISC = TD.CODDISC
	inner JOIN STURNO TU ON TU.CODCOLIGADA = TD.CODCOLIGADA AND TU.CODTURNO = TD.CODTURNO
WHERE 
  MA.CODCOLIGADA = :CODCOLIGADA
  AND MA.IDPERLET= :IDPERLET
  AND MA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
  AND MA.RA = :RA
  /*MODIFICADO EM 22/09/2022 NATHAN PVT - DEIXADO PARA TRAZER APENAS DISCIPLINAS CURSANDO*/
  AND S.DESCRICAO LIKE 'Cursando%'";2895;;;;22/09/2022;consultor1.totvs;0;1;1;1;;;;0;5ddea8bb-44de-426e-9518-54f1df45836b;0;;15081;raphael.muzy;31/01/2022;consultor1.totvs;22/09/2022;0
S;IP971;SQL Dados;"SELECT saluno.codcoligada,
       saluno.ra,
       saluno.codtipocurso,
       stipocurso.nome                                           nivelensino,
       ppessoa.nome                                              nomealuno,
       CONVERT(VARCHAR, ppessoa.dtnascimento, 103)               dtnascimento,
       ppessoa.pais                                              paisaluno,
       ppessoa.naturalidade,
       ppessoa.estadonatal,
       ppessoa.nacionalidade,
       pcodnacao.descricao
       nomenacionalidade,
       ppessoa.cartidentidade,
       ppessoa.orgemissorident,
       ppessoa.ufcartident,
       ppessoa.cpf,
       scurso.nome                                               nomecurso,
       scurso.codcurso,	   
       shabilitacaofilial.codhabilitacao,
       shabilitacaofilial.descricaocurso,
       shabilitacaofilial.descricaohabilitacao,
       shabilitacaofilial.idhabilitacaofilial,
       shabilitacao.nome                                         habilitacao,
       CONVERT(VARCHAR, shabilitacaoaluno.dtconclusaocurso, 103) dtconclusaocurso,
       CONVERT(VARCHAR, shabilitacaoaluno.dtcolacaograu, 103)	 dtcolacaograu,
       CONVERT(VARCHAR, shabilitacaoaluno.dtingresso, 103)       dtingresso,
       gfilial.cidade                                            cidadefilial,
       ppessoasecretario.nome                                    nomesec1filial,
       gfilial.nome												 nomefilial,
       gsec1.imagem
       assinaturasec1filial,
       CASE
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'M' THEN 'Bacharel'
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'F' THEN 'Bacharela'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'M' THEN 'Licenciado'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'F' THEN 'Licenciada'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'M' THEN 'Tecnólogo'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'F' THEN 'Tecnóloga'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'M' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'F' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'M' THEN 'Mestre'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'F' THEN 'Mestra'
       END                                                       AS modalidade,
       ppessoa.sexo,
       CASE 
       	WHEN ppessoa.sexo = 'M' then 'masculino'
       	ELSE 'feminino'
       END desc_sexo,
       CASE
         WHEN ppessoa.sexo = 'm' THEN 'nascido'
         ELSE 'nascida'
       END                                                       AS nascido,
       CONVERT(VARCHAR(10), Getdate(), 103)                      AS dataatual,
       assinsecretario.imagem                                    AS assin_sec1,
       CASE WHEN PPESSOA.SEXO = 'M' then ZMDNACIONALIDADE.NOMEMASCULINO
            ELSE ZMDNACIONALIDADE.NOMEFEMININO END AS DESC_NACIONALIDADE,
	   cast(isnull(sgrade.cargahoraria,0) as int) as cargahoraria,
	   ltrim(substring(scurso.nome, CHARINDEX('em', scurso.nome) + 2, len(scurso.nome))) as areaconhecimento,
	   smodalidadecurso.descricao as desc_modalidade,
	   coordenador.nome as nomecoordenador,
	   ppessoadirecao.nome as nomediretorfilial
FROM   shabilitacaofilial (nolock)
       JOIN shabilitacaoaluno (nolock)
         ON ( shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada
              AND shabilitacaoaluno.idhabilitacaofilial =
                  shabilitacaofilial.idhabilitacaofilial )
       JOIN saluno (nolock)
         ON ( saluno.codcoligada = shabilitacaoaluno.codcoligada
              AND saluno.ra = shabilitacaoaluno.ra )
       JOIN ppessoa (nolock)
         ON ( ppessoa.codigo = saluno.codpessoa )
       JOIN getd (nolock)
         ON ( ppessoa.estadonatal = getd.codetd )
       LEFT JOIN pcodnacao (nolock)
              ON ( ppessoa.nacionalidade = pcodnacao.codcliente )
       JOIN gfilial (nolock)
         ON ( gfilial.codcoligada = shabilitacaofilial.codcoligada
              AND gfilial.codfilial = shabilitacaofilial.codfilial )
       LEFT JOIN sfilial (nolock)
              ON ( gfilial.codcoligada = sfilial.codcoligada
                   AND gfilial.codfilial = sfilial.codfilial )
       LEFT JOIN sdirecaofilial (nolock)
              ON ( sfilial.codcoligada = sdirecaofilial.codcoligada
                   AND sfilial.codfilial = sdirecaofilial.codfilial )
       LEFT JOIN ppessoa ppessoadirecao (nolock)
              ON ( sdirecaofilial.codpessoa = ppessoadirecao.codigo )
       LEFT JOIN ppessoa ppessoasecretario (nolock)
              ON ( sdirecaofilial.codpessoasec1 = ppessoasecretario.codigo )
       LEFT JOIN ppessoa ppessoacoordenadorregdip (nolock)
              ON ( sdirecaofilial.codpessoasec2 =
                   ppessoacoordenadorregdip.codigo )
       LEFT JOIN zmdassinaturas assinsecretario (nolock)
              ON ( ppessoasecretario.codigo = assinsecretario.codpessoa )
       LEFT JOIN gimagem gsec1(nolock)
              ON sdirecaofilial.idassinaturasec1 = gsec1.id
       LEFT JOIN gimagem (nolock)
              ON gfilial.idimagem = gimagem.id
       JOIN stipocurso (nolock)
         ON ( shabilitacaofilial.codcoligada = stipocurso.codcoligada
              AND shabilitacaofilial.codtipocurso = stipocurso.codtipocurso )
       JOIN shabilitacao (nolock)
         ON ( shabilitacaofilial.codcoligada = shabilitacao.codcoligada
              AND shabilitacaofilial.codcurso = shabilitacao.codcurso
              AND shabilitacaofilial.codhabilitacao =
                  shabilitacao.codhabilitacao )
       JOIN sgrade (nolock)
         ON shabilitacaofilial.codcoligada = sgrade.codcoligada
            AND shabilitacaofilial.codcurso = sgrade.codcurso
            AND shabilitacaofilial.codhabilitacao = sgrade.codhabilitacao
            AND shabilitacaofilial.codgrade = sgrade.codgrade
       JOIN scurso (nolock)
         ON ( shabilitacaofilial.codcoligada = scurso.codcoligada
              AND shabilitacaofilial.codcurso = scurso.codcurso )
       LEFT JOIN smodalidadecurso (nolock)
              ON ( scurso.codcoligada = smodalidadecurso.codcoligada
                   AND scurso.codmodalidadecurso =
                 smodalidadecurso.codmodalidadecurso )
       LEFT JOIN sinstituicao (nolock)
              ON shabilitacaoaluno.codinstdiploma = sinstituicao.codinst
       LEFT JOIN zmdnacionalidade (nolock)
              ON pcodnacao.codcliente = zmdnacionalidade.CODNACAO
	   left join sarea (nolock)
	          on scurso.codcoligada = sarea.codcoligada and scurso.codarea = sarea.codarea
	   left join scoordenador (nolock)
	          on scoordenador.codcoligada = shabilitacaofilial.codcoligada
	         and scoordenador.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial	         	
	         and scoordenador.funcao = 'C'
       left join ppessoa as coordenador (nolock)
              on coordenador.codigo = scoordenador.codpessoa    
WHERE  shabilitacaoaluno.codcoligada = :pCodColigada       
	   and scurso.CODTIPOCURSO = 1
       AND shabilitacaoaluno.DTCOLACAOGRAU = :pDtColacao
	   and scurso.CODCURSO = :pCodCurso ";7794;;;;10/12/2021;raphael.muzy;0;1;1;1;;;;0;478baa4a-7e33-44dd-b06b-ea73b7e64a3a;0;;21184;raphael.muzy;22/11/2021;raphael.muzy;10/12/2021;0
S;IP971.1;SQL Dados Colação Individual;"SELECT saluno.codcoligada,
       saluno.ra,
       saluno.codtipocurso,
       stipocurso.nome                                           nivelensino,
       ppessoa.nome                                              nomealuno,
       CONVERT(VARCHAR, ppessoa.dtnascimento, 103)               dtnascimento,
       ppessoa.pais                                              paisaluno,
       ppessoa.naturalidade,
       ppessoa.estadonatal,
       ppessoa.nacionalidade,
       pcodnacao.descricao
       nomenacionalidade,
       ppessoa.cartidentidade,
       ppessoa.orgemissorident,
       ppessoa.ufcartident,
       ppessoa.cpf,
       scurso.nome                                               nomecurso,
       scurso.codcurso,	   
       shabilitacaofilial.codhabilitacao,
       shabilitacaofilial.descricaocurso,
       shabilitacaofilial.descricaohabilitacao,
       shabilitacaofilial.idhabilitacaofilial,
       shabilitacao.nome                                         habilitacao,
       CONVERT(VARCHAR, shabilitacaoaluno.dtconclusaocurso, 103) dtconclusaocurso,
       CONVERT(VARCHAR, shabilitacaoaluno.dtcolacaograu, 103)	 dtcolacaograu,
       CONVERT(VARCHAR, shabilitacaoaluno.dtingresso, 103)       dtingresso,
       gfilial.cidade                                            cidadefilial,
       ppessoasecretario.nome                                    nomesec1filial,
       gfilial.nome												 nomefilial,
       gsec1.imagem
       assinaturasec1filial,
       CASE
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'M' THEN 'Bacharel'
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'F' THEN 'Bacharela'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'M' THEN 'Licenciado'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'F' THEN 'Licenciada'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'M' THEN 'Tecnólogo'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'F' THEN 'Tecnóloga'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'M' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'F' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'M' THEN 'Mestre'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'F' THEN 'Mestra'
       END                                                       AS modalidade,
       ppessoa.sexo,
       CASE 
       	WHEN ppessoa.sexo = 'M' then 'masculino'
       	ELSE 'feminino'
       END desc_sexo,
       CASE
         WHEN ppessoa.sexo = 'm' THEN 'nascido'
         ELSE 'nascida'
       END                                                       AS nascido,
       CONVERT(VARCHAR(10), Getdate(), 103)                      AS dataatual,
       assinsecretario.imagem                                    AS assin_sec1,
       CASE WHEN PPESSOA.SEXO = 'M' then ZMDNACIONALIDADE.NOMEMASCULINO
            ELSE ZMDNACIONALIDADE.NOMEFEMININO END AS DESC_NACIONALIDADE,
	   cast(isnull(sgrade.cargahoraria,0) as int) as cargahoraria,
	   ltrim(substring(scurso.nome, CHARINDEX('em', scurso.nome) + 2, len(scurso.nome))) as areaconhecimento,
	   smodalidadecurso.descricao as desc_modalidade,
	   coordenador.nome as nomecoordenador,
	   ppessoadirecao.nome as nomediretorfilial
FROM   shabilitacaofilial (nolock)
       JOIN shabilitacaoaluno (nolock)
         ON ( shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada
              AND shabilitacaoaluno.idhabilitacaofilial =
                  shabilitacaofilial.idhabilitacaofilial )
       JOIN saluno (nolock)
         ON ( saluno.codcoligada = shabilitacaoaluno.codcoligada
              AND saluno.ra = shabilitacaoaluno.ra )
       JOIN ppessoa (nolock)
         ON ( ppessoa.codigo = saluno.codpessoa )
       JOIN getd (nolock)
         ON ( ppessoa.estadonatal = getd.codetd )
       LEFT JOIN pcodnacao (nolock)
              ON ( ppessoa.nacionalidade = pcodnacao.codcliente )
       JOIN gfilial (nolock)
         ON ( gfilial.codcoligada = shabilitacaofilial.codcoligada
              AND gfilial.codfilial = shabilitacaofilial.codfilial )
       LEFT JOIN sfilial (nolock)
              ON ( gfilial.codcoligada = sfilial.codcoligada
                   AND gfilial.codfilial = sfilial.codfilial )
       LEFT JOIN sdirecaofilial (nolock)
              ON ( sfilial.codcoligada = sdirecaofilial.codcoligada
                   AND sfilial.codfilial = sdirecaofilial.codfilial )
       LEFT JOIN ppessoa ppessoadirecao (nolock)
              ON ( sdirecaofilial.codpessoa = ppessoadirecao.codigo )
       LEFT JOIN ppessoa ppessoasecretario (nolock)
              ON ( sdirecaofilial.codpessoasec1 = ppessoasecretario.codigo )
       LEFT JOIN ppessoa ppessoacoordenadorregdip (nolock)
              ON ( sdirecaofilial.codpessoasec2 =
                   ppessoacoordenadorregdip.codigo )
       LEFT JOIN zmdassinaturas assinsecretario (nolock)
              ON ( ppessoasecretario.codigo = assinsecretario.codpessoa )
       LEFT JOIN gimagem gsec1(nolock)
              ON sdirecaofilial.idassinaturasec1 = gsec1.id
       LEFT JOIN gimagem (nolock)
              ON gfilial.idimagem = gimagem.id
       JOIN stipocurso (nolock)
         ON ( shabilitacaofilial.codcoligada = stipocurso.codcoligada
              AND shabilitacaofilial.codtipocurso = stipocurso.codtipocurso )
       JOIN shabilitacao (nolock)
         ON ( shabilitacaofilial.codcoligada = shabilitacao.codcoligada
              AND shabilitacaofilial.codcurso = shabilitacao.codcurso
              AND shabilitacaofilial.codhabilitacao =
                  shabilitacao.codhabilitacao )
       JOIN sgrade (nolock)
         ON shabilitacaofilial.codcoligada = sgrade.codcoligada
            AND shabilitacaofilial.codcurso = sgrade.codcurso
            AND shabilitacaofilial.codhabilitacao = sgrade.codhabilitacao
            AND shabilitacaofilial.codgrade = sgrade.codgrade
       JOIN scurso (nolock)
         ON ( shabilitacaofilial.codcoligada = scurso.codcoligada
              AND shabilitacaofilial.codcurso = scurso.codcurso )
       LEFT JOIN smodalidadecurso (nolock)
              ON ( scurso.codcoligada = smodalidadecurso.codcoligada
                   AND scurso.codmodalidadecurso =
                 smodalidadecurso.codmodalidadecurso )
       LEFT JOIN sinstituicao (nolock)
              ON shabilitacaoaluno.codinstdiploma = sinstituicao.codinst
       LEFT JOIN zmdnacionalidade (nolock)
              ON pcodnacao.codcliente = zmdnacionalidade.CODNACAO
	   left join sarea (nolock)
	          on scurso.codcoligada = sarea.codcoligada and scurso.codarea = sarea.codarea
	   left join scoordenador (nolock)
	          on scoordenador.codcoligada = shabilitacaofilial.codcoligada
	         and scoordenador.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial	         	
	         and scoordenador.funcao = 'C'
       left join ppessoa as coordenador (nolock)
              on coordenador.codigo = scoordenador.codpessoa    
WHERE  shabilitacaoaluno.codcoligada = :pCodColigada       
	   and shabilitacaoaluno.ra = :pRA
	   and shabilitacaoaluno.idhabilitacaofilial = :pIdhabilitacaofilial";7772;;;;07/07/2022;consultor1.totvs;0;1;1;1;;;;0;478baa4a-7e33-44dd-b06b-ea73b7e64a3a;0;;15076;consultor1.totvs;07/07/2022;consultor1.totvs;07/07/2022;0
S;IP9811;SQL Dados Certificado;"SELECT saluno.codcoligada,
       saluno.ra,
       saluno.codtipocurso,
       stipocurso.nome                                           nivelensino,
       ppessoa.nome                                              nomealuno,
       CONVERT(VARCHAR, ppessoa.dtnascimento, 103)               dtnascimento,
       ppessoa.pais                                              paisaluno,
       ppessoa.naturalidade,
       case when ppessoa.nacionalidade = '10' then getd.nome else /*ppessoa.pais*/ GPAIS.DESCRICAO end as estadonatal,
       ppessoa.nacionalidade,
       pcodnacao.descricao
       nomenacionalidade,
       case when ppessoa.nacionalidade = '10' then 'RG:. ' + ppessoa.cartidentidade 
	        when ppessoa.nroreggeral is not null then 'RNM:. ' + ppessoa.nroreggeral 
			else salunocompl.siglaestrangeiro + ':. ' + salunocompl.docestrangeiro 
	   end as cartidentidade,       
       case when ppessoa.orgemissorident is not null then ppessoa.orgemissorident + ' -' else null end as orgemissorident,
       case when ppessoa.nacionalidade = '10' then ppessoa.ufcartident else ppessoa.orgemissorrne end as ufcartident,
       ppessoa.cpf,
       scurso.nome                                               nomecurso,
       scurso.codcurso,
       shabilitacaofilial.codhabilitacao,
       shabilitacaofilial.descricaocurso,
       shabilitacaofilial.descricaohabilitacao,
       shabilitacaofilial.idhabilitacaofilial,
       shabilitacao.nome                                         habilitacao,
       CONVERT(VARCHAR, shabilitacaoaluno.dtconclusaocurso, 103) dtconclusaocurso,
       CONVERT(VARCHAR, shabilitacaoaluno.dtcolacaograu, 103)	 dtcolacaograu,
       CONVERT(VARCHAR, shabilitacaoaluno.dtingresso, 103)       dtingresso,
       gfilial.cidade                                            cidadefilial,
       ppessoasecretario.nome                                    nomesec1filial,
       gsec1.imagem
       assinaturasec1filial,
       CASE
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'M' THEN 'Bacharel'
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'F' THEN 'Bacharela'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'M' THEN 'Licenciado'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'F' THEN 'Licenciada'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'M' THEN 'Tecnólogo'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'F' THEN 'Tecnóloga'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'M' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'F' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'M' THEN 'Mestre'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'F' THEN 'Mestra'
       END                                                       AS modalidade,
       ppessoa.sexo,
       CASE 
       	WHEN ppessoa.sexo = 'M' then 'masculino'
       	ELSE 'feminino'
       END desc_sexo,
       CASE
         WHEN ppessoa.sexo = 'm' THEN 'nascido'
         ELSE 'nascida'
       END                                                       AS nascido,
       CONVERT(VARCHAR(10), Getdate(), 103)                      AS dataatual,
       assinsecretario.imagem                                    AS assin_sec1,
       (SELECT 
CASE WHEN PPESSOA.SEXO = 'F' THEN ISNULL(ZMDNACIONALIDADE.NOMEFEMININO,DESCRICAO)
	WHEN PPESSOA.SEXO = 'M' THEN ISNULL(ZMDNACIONALIDADE.NOMEMASCULINO,DESCRICAO)
	ELSE DESCRICAO END FROM PCODNACAO 
	LEFT JOIN ZMDNACIONALIDADE ON ZMDNACIONALIDADE.CODNACAO = PCODNACAO.CODCLIENTE

	WHERE CODCLIENTE = PPESSOA.NACIONALIDADE) DESC_NACIONALIDADE,
       /*CASE WHEN PPESSOA.SEXO = 'M' then ZMDNACIONALIDADE.NOMEMASCULINO
            ELSE ZMDNACIONALIDADE.NOMEFEMININO END AS DESC_NACIONALIDADE,*/
       scursocompl.autorizacao
FROM   shabilitacaofilial (nolock)
       JOIN shabilitacaoaluno (nolock)
         ON ( shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada
              AND shabilitacaoaluno.idhabilitacaofilial =
                  shabilitacaofilial.idhabilitacaofilial )
       JOIN saluno (nolock)
         ON ( saluno.codcoligada = shabilitacaoaluno.codcoligada
              AND saluno.ra = shabilitacaoaluno.ra )
       JOIN ppessoa (nolock)
         ON ( ppessoa.codigo = saluno.codpessoa )
       JOIN getd (nolock)
         ON ( ppessoa.estadonatal = getd.codetd )
       LEFT JOIN GPAIS ON GETD.IDPAIS = GPAIS.IDPAIS
       LEFT JOIN pcodnacao (nolock)
              ON ( ppessoa.nacionalidade = pcodnacao.codcliente )
       JOIN gfilial (nolock)
         ON ( gfilial.codcoligada = shabilitacaofilial.codcoligada
              AND gfilial.codfilial = shabilitacaofilial.codfilial )
       LEFT JOIN sfilial (nolock)
              ON ( gfilial.codcoligada = sfilial.codcoligada
                   AND gfilial.codfilial = sfilial.codfilial )
       LEFT JOIN sdirecaofilial (nolock)
              ON ( sfilial.codcoligada = sdirecaofilial.codcoligada
                   AND sfilial.codfilial = sdirecaofilial.codfilial )
       LEFT JOIN ppessoa ppessoadirecao (nolock)
              ON ( sdirecaofilial.codpessoa = ppessoadirecao.codigo )
       LEFT JOIN ppessoa ppessoasecretario (nolock)
              ON ( sdirecaofilial.codpessoasec1 = ppessoasecretario.codigo )
       LEFT JOIN ppessoa ppessoacoordenadorregdip (nolock)
              ON ( sdirecaofilial.codpessoasec2 =
                   ppessoacoordenadorregdip.codigo )
       LEFT JOIN zmdassinaturas assinsecretario (nolock)
              ON ( ppessoasecretario.codigo = assinsecretario.codpessoa )
       LEFT JOIN gimagem gsec1(nolock)
              ON sdirecaofilial.idassinaturasec1 = gsec1.id
       LEFT JOIN gimagem (nolock)
              ON gfilial.idimagem = gimagem.id
       JOIN stipocurso (nolock)
         ON ( shabilitacaofilial.codcoligada = stipocurso.codcoligada
              AND shabilitacaofilial.codtipocurso = stipocurso.codtipocurso )
       JOIN shabilitacao (nolock)
         ON ( shabilitacaofilial.codcoligada = shabilitacao.codcoligada
              AND shabilitacaofilial.codcurso = shabilitacao.codcurso
              AND shabilitacaofilial.codhabilitacao =
                  shabilitacao.codhabilitacao )
       JOIN sgrade (nolock)
         ON shabilitacaofilial.codcoligada = sgrade.codcoligada
            AND shabilitacaofilial.codcurso = sgrade.codcurso
            AND shabilitacaofilial.codhabilitacao = sgrade.codhabilitacao
            AND shabilitacaofilial.codgrade = sgrade.codgrade
       JOIN scurso (nolock)
         ON ( shabilitacaofilial.codcoligada = scurso.codcoligada
              AND shabilitacaofilial.codcurso = scurso.codcurso )
       LEFT JOIN scursocompl (nolock)
	     on (scurso.codcoligada = scursocompl.codcoligada 
	     and scurso.codcurso = scursocompl.codcurso)
       LEFT JOIN smodalidadecurso (nolock)
              ON ( scurso.codcoligada = smodalidadecurso.codcoligada
                   AND scurso.codmodalidadecurso =
                 smodalidadecurso.codmodalidadecurso )
       LEFT JOIN sinstituicao (nolock)
              ON shabilitacaoaluno.codinstdiploma = sinstituicao.codinst
       LEFT JOIN zmdnacionalidade (nolock)
              ON pcodnacao.codcliente = zmdnacionalidade.CODNACAO
	   LEFT JOIN salunocompl (nolock)
	          ON saluno.codcoligada = salunocompl.codcoligada
			 and saluno.ra = salunocompl.ra              
/*WHERE  shabilitacaoaluno.codcoligada = :CodColigada_N
       AND shabilitacaoaluno.ra = :RA_S
       AND shabilitacaofilial.idhabilitacaofilial = :idhabilitacaofilial*/
WHERE  shabilitacaoaluno.codcoligada = :CODCOLIGADA2
       AND shabilitacaoaluno.ra = :RA2
       AND shabilitacaofilial.idhabilitacaofilial = :IDHABILITACAOFILIAL1
       AND shabilitacaoaluno.dtconclusaocurso IS NOT NULL
       AND scurso.codtipocurso = 1 
       and shabilitacaofilial.ativo = 'S'";8505;;;;01/09/2022;consultor1.totvs;0;1;1;1;;;;0;88a61953-8c5e-4d32-a58d-9bf89f89de8e;0;;11954;raphael.muzy;16/11/2021;consultor1.totvs;01/09/2022;0
S;IP9821;SQL Dados Certificado Pós Stricto Sensu;"SELECT saluno.codcoligada,
       saluno.ra,
       saluno.codtipocurso,
       stipocurso.nome                                           nivelensino,
       ppessoa.nome                                              nomealuno,
       CONVERT(VARCHAR, ppessoa.dtnascimento, 103)               dtnascimento,
       ppessoa.pais                                              paisaluno,
       ppessoa.naturalidade,
       case when ppessoa.nacionalidade = '10' then getd.nome else ppessoa.pais end as estadonatal,
       ppessoa.nacionalidade,
       pcodnacao.descricao
       nomenacionalidade,
       case when ppessoa.nacionalidade = '10' then 'RG:. ' + ppessoa.cartidentidade 
	        when ppessoa.nroreggeral is not null then 'RNM:. ' + ppessoa.nroreggeral 
			else salunocompl.siglaestrangeiro + ':. ' + salunocompl.docestrangeiro 
	   end as cartidentidade,  
       case when ppessoa.orgemissorident is not null then ppessoa.orgemissorident + ' -' else null end as orgemissorident,
       case when ppessoa.nacionalidade = '10' then ppessoa.ufcartident else ppessoa.orgemissorrne end as ufcartident,
       ppessoa.cpf,
       scurso.nome                                               nomecurso,
       scurso.codcurso,
       shabilitacaofilial.codhabilitacao,
       shabilitacaofilial.descricaocurso,
       shabilitacaofilial.descricaohabilitacao,
       shabilitacaofilial.idhabilitacaofilial,
       shabilitacao.nome                                         habilitacao,
       CONVERT(VARCHAR, shabilitacaoaluno.dtconclusaocurso, 103) dtconclusaocurso,
       CONVERT(VARCHAR, shabilitacaoaluno.dtcolacaograu, 103)	 dtcolacaograu,
       CONVERT(VARCHAR, shabilitacaoaluno.dtingresso, 103)       dtingresso,
       gfilial.cidade                                            cidadefilial,
       ppessoasecretario.nome                                    nomesec1filial,
       gsec1.imagem
       assinaturasec1filial,
       CASE
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'M' THEN 'Bacharel'
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'F' THEN 'Bacharela'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'M' THEN 'Licenciado'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'F' THEN 'Licenciada'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'M' THEN 'Tecnólogo'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'F' THEN 'Tecnóloga'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'M' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'F' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'M' THEN 'Mestre'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'F' THEN 'Mestra'
       END                                                       AS modalidade,
       ppessoa.sexo,
       CASE 
       	WHEN ppessoa.sexo = 'M' then 'masculino'
       	ELSE 'feminino'
       END desc_sexo,
       CASE
         WHEN ppessoa.sexo = 'm' THEN 'nascido'
         ELSE 'nascida'
       END                                                       AS nascido,
       CONVERT(VARCHAR(10), Getdate(), 103)                      AS dataatual,
       assinsecretario.imagem                                    AS assin_sec1,
       CASE WHEN PPESSOA.SEXO = 'M' then ZMDNACIONALIDADE.NOMEMASCULINO
            ELSE ZMDNACIONALIDADE.NOMEFEMININO END AS DESC_NACIONALIDADE,
	   cast(isnull(sgrade.cargahoraria,0) as int) as cargahoraria,
	   ltrim(substring(scurso.nome, CHARINDEX('em', scurso.nome) + 2, len(scurso.nome))) as areaconhecimento,
	   smodalidadecurso.descricao as desc_modalidade,
	   scursocompl.autorizacao
FROM   shabilitacaofilial (nolock)
       JOIN shabilitacaoaluno (nolock)
         ON ( shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada
              AND shabilitacaoaluno.idhabilitacaofilial =
                  shabilitacaofilial.idhabilitacaofilial )
       JOIN saluno (nolock)
         ON ( saluno.codcoligada = shabilitacaoaluno.codcoligada
              AND saluno.ra = shabilitacaoaluno.ra )
       JOIN ppessoa (nolock)
         ON ( ppessoa.codigo = saluno.codpessoa )
       JOIN getd (nolock)
         ON ( ppessoa.estadonatal = getd.codetd )
       LEFT JOIN pcodnacao (nolock)
              ON ( ppessoa.nacionalidade = pcodnacao.codcliente )
       JOIN gfilial (nolock)
         ON ( gfilial.codcoligada = shabilitacaofilial.codcoligada
              AND gfilial.codfilial = shabilitacaofilial.codfilial )
       LEFT JOIN sfilial (nolock)
              ON ( gfilial.codcoligada = sfilial.codcoligada
                   AND gfilial.codfilial = sfilial.codfilial )
       LEFT JOIN sdirecaofilial (nolock)
              ON ( sfilial.codcoligada = sdirecaofilial.codcoligada
                   AND sfilial.codfilial = sdirecaofilial.codfilial )
       LEFT JOIN ppessoa ppessoadirecao (nolock)
              ON ( sdirecaofilial.codpessoa = ppessoadirecao.codigo )
       LEFT JOIN ppessoa ppessoasecretario (nolock)
              ON ( sdirecaofilial.codpessoasec1 = ppessoasecretario.codigo )
       LEFT JOIN ppessoa ppessoacoordenadorregdip (nolock)
              ON ( sdirecaofilial.codpessoasec2 =
                   ppessoacoordenadorregdip.codigo )
       LEFT JOIN zmdassinaturas assinsecretario (nolock)
              ON ( ppessoasecretario.codigo = assinsecretario.codpessoa )
       LEFT JOIN gimagem gsec1(nolock)
              ON sdirecaofilial.idassinaturasec1 = gsec1.id
       LEFT JOIN gimagem (nolock)
              ON gfilial.idimagem = gimagem.id
       JOIN stipocurso (nolock)
         ON ( shabilitacaofilial.codcoligada = stipocurso.codcoligada
              AND shabilitacaofilial.codtipocurso = stipocurso.codtipocurso )
       JOIN shabilitacao (nolock)
         ON ( shabilitacaofilial.codcoligada = shabilitacao.codcoligada
              AND shabilitacaofilial.codcurso = shabilitacao.codcurso
              AND shabilitacaofilial.codhabilitacao =
                  shabilitacao.codhabilitacao )
       JOIN sgrade (nolock)
         ON shabilitacaofilial.codcoligada = sgrade.codcoligada
            AND shabilitacaofilial.codcurso = sgrade.codcurso
            AND shabilitacaofilial.codhabilitacao = sgrade.codhabilitacao
            AND shabilitacaofilial.codgrade = sgrade.codgrade
       JOIN scurso (nolock)
         ON ( shabilitacaofilial.codcoligada = scurso.codcoligada
              AND shabilitacaofilial.codcurso = scurso.codcurso )
	   LEFT JOIN scursocompl 
	     on (scurso.codcoligada = scursocompl.codcoligada 
	     and scurso.codcurso = scursocompl.codcurso)
       LEFT JOIN smodalidadecurso (nolock)
              ON ( scurso.codcoligada = smodalidadecurso.codcoligada
                   AND scurso.codmodalidadecurso =
                 smodalidadecurso.codmodalidadecurso )
       LEFT JOIN sinstituicao (nolock)
              ON shabilitacaoaluno.codinstdiploma = sinstituicao.codinst
       LEFT JOIN zmdnacionalidade (nolock)
              ON pcodnacao.codcliente = zmdnacionalidade.CODNACAO
	   LEFT JOIN salunocompl (nolock)
	          ON saluno.codcoligada = salunocompl.codcoligada
			 and saluno.ra = salunocompl.ra              
WHERE  shabilitacaoaluno.codcoligada = :CODCOLIGADA
       AND shabilitacaoaluno.ra = :RA
	   and scurso.CODTIPOCURSO = 2
       AND shabilitacaoaluno.dtconclusaocurso IS NOT NULL
       and shabilitacaofilial.ativo = 'S'";8014;;;;13/12/2021;raphael.muzy;0;1;1;1;;;;0;7ce3f982-7f11-4dd1-9521-a101bec626d0;0;;14126;raphael.muzy;16/11/2021;raphael.muzy;13/12/2021;0
S;IP9831;SQL Declaração Conclusão;"SELECT saluno.codcoligada,
       saluno.ra,
       saluno.codtipocurso,
       stipocurso.nome                                           nivelensino,
       ppessoa.nome                                              nomealuno,
       CONVERT(VARCHAR, ppessoa.dtnascimento, 103)               dtnascimento,
       ppessoa.pais                                              paisaluno,
       ppessoa.naturalidade,
       case when ppessoa.nacionalidade = '10' then getd.nome else GPAIS.DESCRICAO end as estadonatal,
       ppessoa.nacionalidade,
       pcodnacao.descricao
       nomenacionalidade,
       case when ppessoa.nacionalidade = '10' then 'RG:. ' + ppessoa.cartidentidade 
	        when ppessoa.nroreggeral is not null then 'RNM:. ' + ppessoa.nroreggeral 
			else salunocompl.siglaestrangeiro + ':. ' + salunocompl.docestrangeiro 
	   end as cartidentidade, 
       case when ppessoa.orgemissorident is not null then ppessoa.orgemissorident + ' -' else null end as orgemissorident,
       case when ppessoa.nacionalidade = '10' then ppessoa.ufcartident else ppessoa.orgemissorrne end as ufcartident,
       ppessoa.cpf,
       scurso.nome                                               nomecurso,
       scurso.codcurso,
       scurso.capes,
       sarea.nome as nomeareacurso,
       shabilitacaofilial.codhabilitacao,
       shabilitacaofilial.descricaocurso,
       shabilitacaofilial.descricaohabilitacao,
       shabilitacaofilial.idhabilitacaofilial,
       CAST(shabilitacao.nome AS VARCHAR(MAX))                      habilitacao,
       CONVERT(VARCHAR, shabilitacaoaluno.dtconclusaocurso, 103) dtconclusaocurso,
       CONVERT(VARCHAR, shabilitacaoaluno.dtcolacaograu, 103)	 dtcolacaograu,
       CONVERT(VARCHAR, shabilitacaoaluno.dtingresso, 103)       dtingresso,
       gfilial.cidade                                            cidadefilial,
       ppessoasecretario.nome                                    nomesec1filial,
       gsec1.imagem
       assinaturasec1filial,
       CASE
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'M' THEN 'Bacharel'
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'F' THEN 'Bacharela'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'M' THEN 'Licenciado'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'F' THEN 'Licenciada'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'M' THEN 'Tecnólogo'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'F' THEN 'Tecnóloga'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'M' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'F' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'M' THEN 'Mestre'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'F' THEN 'Mestra'
       END                                                       AS modalidade,
       ppessoa.sexo,
       CASE 
       	WHEN ppessoa.sexo = 'M' then 'masculino'
       	ELSE 'feminino'
       END desc_sexo,
       CASE
         WHEN ppessoa.sexo = 'm' THEN 'nascido'
         ELSE 'nascida'
       END                                                       AS nascido,
       CONVERT(VARCHAR(10), Getdate(), 103)                      AS dataatual,
       assinsecretario.imagem                                    AS assin_sec1,
       CASE WHEN PPESSOA.SEXO = 'M' then ZMDNACIONALIDADE.NOMEMASCULINO
            ELSE ZMDNACIONALIDADE.NOMEFEMININO END AS DESC_NACIONALIDADE,
	   cast(isnull(sgrade.cargahoraria,0) as int) as cargahoraria,
	   ltrim(substring(scurso.nome, CHARINDEX('em', scurso.nome) + 2, len(scurso.nome))) as areaconhecimento,
	   smodalidadecurso.descricao as desc_modalidade,
	  CASE
	WHEN :$CODTIPOCURSO = 2 THEN SHABILITACAOFILIAL.DECRETOHABILITACAO + ' - ' + SHABILITACAOFILIAL.DECRETOCURSO
	ELSE SCURSOCOMPL.AUTORIZACAO END AS AUTORIZACAO
	   /*scursocompl.autorizacao*/
FROM   shabilitacaofilial (nolock)
       JOIN shabilitacaoaluno (nolock)
         ON ( shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada
              AND shabilitacaoaluno.idhabilitacaofilial =
                  shabilitacaofilial.idhabilitacaofilial )
       JOIN saluno (nolock)
         ON ( saluno.codcoligada = shabilitacaoaluno.codcoligada
              AND saluno.ra = shabilitacaoaluno.ra )
       JOIN ppessoa (nolock)
         ON ( ppessoa.codigo = saluno.codpessoa )
       JOIN getd (nolock)
         ON ( ppessoa.estadonatal = getd.codetd )
       LEFT JOIN pcodnacao (nolock)
              ON ( ppessoa.nacionalidade = pcodnacao.codcliente )
       JOIN gfilial (nolock)
         ON ( gfilial.codcoligada = shabilitacaofilial.codcoligada
              AND gfilial.codfilial = shabilitacaofilial.codfilial )
       LEFT JOIN sfilial (nolock)
              ON ( gfilial.codcoligada = sfilial.codcoligada
                   AND gfilial.codfilial = sfilial.codfilial )
       LEFT JOIN sdirecaofilial (nolock)
              ON ( sfilial.codcoligada = sdirecaofilial.codcoligada
                   AND sfilial.codfilial = sdirecaofilial.codfilial )
       LEFT JOIN ppessoa ppessoadirecao (nolock)
              ON ( sdirecaofilial.codpessoa = ppessoadirecao.codigo )
       LEFT JOIN ppessoa ppessoasecretario (nolock)
              ON ( sdirecaofilial.codpessoasec1 = ppessoasecretario.codigo )
       LEFT JOIN ppessoa ppessoacoordenadorregdip (nolock)
              ON ( sdirecaofilial.codpessoasec2 =
                   ppessoacoordenadorregdip.codigo )
       LEFT JOIN zmdassinaturas assinsecretario (nolock)
              ON ( ppessoasecretario.codigo = assinsecretario.codpessoa )
       LEFT JOIN gimagem gsec1(nolock)
              ON sdirecaofilial.idassinaturasec1 = gsec1.id
       LEFT JOIN gimagem (nolock)
              ON gfilial.idimagem = gimagem.id
       JOIN stipocurso (nolock)
         ON ( shabilitacaofilial.codcoligada = stipocurso.codcoligada
              AND shabilitacaofilial.codtipocurso = stipocurso.codtipocurso )
       JOIN shabilitacao (nolock)
         ON ( shabilitacaofilial.codcoligada = shabilitacao.codcoligada
              AND shabilitacaofilial.codcurso = shabilitacao.codcurso
              AND shabilitacaofilial.codhabilitacao =
                  shabilitacao.codhabilitacao )
       JOIN sgrade (nolock)
         ON shabilitacaofilial.codcoligada = sgrade.codcoligada
            AND shabilitacaofilial.codcurso = sgrade.codcurso
            AND shabilitacaofilial.codhabilitacao = sgrade.codhabilitacao
            AND shabilitacaofilial.codgrade = sgrade.codgrade
       JOIN scurso (nolock)
         ON ( shabilitacaofilial.codcoligada = scurso.codcoligada
              AND shabilitacaofilial.codcurso = scurso.codcurso )
	   LEFT JOIN scursocompl (nolock)
	     on (scurso.codcoligada = scursocompl.codcoligada 
	     and scurso.codcurso = scursocompl.codcurso)
       LEFT JOIN smodalidadecurso (nolock)
              ON ( scurso.codcoligada = smodalidadecurso.codcoligada
                   AND scurso.codmodalidadecurso =
                 smodalidadecurso.codmodalidadecurso )
       LEFT JOIN sinstituicao (nolock)
              ON shabilitacaoaluno.codinstdiploma = sinstituicao.codinst
       LEFT JOIN zmdnacionalidade (nolock)
              ON pcodnacao.codcliente = zmdnacionalidade.CODNACAO
	   left join sarea (nolock)
	          on scurso.codcoligada = sarea.codcoligada and scurso.codarea = sarea.codarea              
	   LEFT JOIN salunocompl (nolock)
	          ON saluno.codcoligada = salunocompl.codcoligada
			 and saluno.ra = salunocompl.ra	
	   LEFT JOIN GPAIS (nolock)
	          ON GPAIS.IDPAIS = GETD.IDPAIS	   
WHERE  shabilitacaoaluno.codcoligada = :CODCOLIGADA
       AND shabilitacaoaluno.ra = :RA
       AND shabilitacaofilial.idhabilitacaofilial = :idhabilitacaofilial
	   and scurso.CODTIPOCURSO = 2
       and shabilitacaofilial.ativo = 'S'";8471;;;;10/11/2022;rafael.marques;0;1;1;1;;;;0;ba4a7a98-86a1-4895-a5e7-b53abbe70f79;0;;-26807;raphael.muzy;22/11/2021;rafael.marques;10/11/2022;0
S;IP992DIP;DIPLOMA UNIVERSIDADE;"/* PÓS GRADUAÇÃO */
SELECT 
  SALUNO.CODCOLIGADA,  
  SALUNO.RA,
  SALUNO.CODTIPOCURSO,
  STIPOCURSO.NOME NIVELENSINO,
  PPESSOA.NOME NOMEALUNO,
  CONVERT(VARCHAR,PPESSOA.DTNASCIMENTO,103) DTNASCIMENTO,
  CASE WHEN PPESSOA.NACIONALIDADE <> 10 THEN
	CASE WHEN SALUNOCOMPL.TIPOESTRANGEIRO = 1 THEN 'do Registro Nacional Migratório (RNM) ' + PPESSOA.NROREGGERAL
		WHEN SALUNOCOMPL.TIPOESTRANGEIRO = 2 THEN 'do Registro Nacional Estrangeiro (RNE) ' + PPESSOA.NROREGGERAL
		ELSE 'do Registro Nacional Migratório (RNM) ' + PPESSOA.NROREGGERAL END
	ELSE 'da Cédula de Identidade RG nº ' + PPESSOA.CARTIDENTIDADE + ' - '+ PPESSOA.ORGEMISSORIDENT+'-'+PPESSOA.UFCARTIDENT END REGISTROALU,
	CASE WHEN PPESSOA.NACIONALIDADE = 10 THEN 'natural do Estado ' +
	case ppessoa.ESTADONATAL  when 'AC' then 'do'
							when 'AL' then 'do'
							when 'AM' then 'do'
							when 'AP' then 'do'
							when 'BA' then 'da'
							when 'CE' then 'do'
							when 'DF' then 'do'
							when 'ES' then 'do'
							when 'GO' then 'do'
							when 'MA' then 'do'
							when 'MG' then 'de'
							when 'MS' then 'do'
							when 'MT' then 'do'
							when 'PA' then 'do'
							when 'PB' then 'da'
							when 'PE' then 'de'
							when 'PI' then 'do'
							when 'PR' then 'do'
							when 'RJ' then 'do'
							when 'RN' then 'do'
							when 'RO' then 'de'
							when 'RR' then 'de'
							when 'RS' then 'do'
							when 'SC' then 'de'
							when 'SE' then 'de'
							when 'SP' then 'de'
							when 'TO' then 'do'
	end + ' ' + GETD.NOME
	ELSE 'natural de ' + REPLACE(GETD.NOME,'- ','') END LOCALIDADEALU,
	
  PPESSOAPAI.NOME NOMEPAI,           
  PPESSOAMAE.NOME NOMEMAE,
  PPESSOA.PAIS PAISALUNO,  
  LEN(PPESSOA.NOME) AS 'TAMANHONOME',
  LEN(SCURSO.NOME)+1 AS 'TAMANHOCURSO',
  PPESSOA.NATURALIDADE,
  PPESSOA.NACIONALIDADE,
  /*PCODNACAO.DESCRICAO NOMENACIONALIDADE,*/
  (SELECT 
CASE WHEN PPESSOA.SEXO = 'F' THEN ISNULL(ZMDNACIONALIDADE.NOMEFEMININO,DESCRICAO)
	WHEN PPESSOA.SEXO = 'M' THEN ISNULL(ZMDNACIONALIDADE.NOMEMASCULINO,DESCRICAO)
	ELSE DESCRICAO END FROM PCODNACAO 
	LEFT JOIN ZMDNACIONALIDADE ON ZMDNACIONALIDADE.CODNACAO = PCODNACAO.CODCLIENTE

	WHERE CODCLIENTE = PPESSOA.NACIONALIDADE) NOMENACIONALIDADE,
  PPESSOA.CARTIDENTIDADE, 
  PPESSOA.ORGEMISSORIDENT,
  PPESSOA.UFCARTIDENT,
  PPESSOA.CPF,    
  RTRIM(SUBSTRING(AUTORIZACAO,CHARINDEX('Em conformidade',AUTORIZACAO),999)) AS 'COMPLEMENTOCURSO',
  SCURSO.NOME + ' a' AS NOMECURSO,
  SUBSTRING(SCURSO.NOME,0,CHARINDEX(' ',SCURSO.NOME,LEN(SCURSO.NOME)/2)) AS NOMECURSOT1,
  SUBSTRING(SCURSO.NOME,CHARINDEX(' ',SCURSO.NOME,LEN(SCURSO.NOME)/2),999) + ' a' AS NOMECURSOT2,
  SCURSO.CODCURSO,
  SCURSO.DECRETO,
  SCURSO.REGCONTRATO,
  SCURSO.CODCURINEP, 
  ISNULL(', Código do CNPq ' + SCURSO.CAPES+',','') AS 'CNPQ',
 ISNULL(' na área de conhecimento de ' + SAREA.NOME,'') AS 'AREACONHECIMENTO' ,
  
  ISNULL(SHABILITACAOFILIAL.DECRETOCURSO,'') AS 'CONFORMIDADE',
  
  SHABILITACAOFILIAL.CODHABILITACAO,
  SHABILITACAOFILIAL.DECRETOHABILITACAO AS DECRETOCURSO,
  SHABILITACAOFILIAL.DESCRICAOCURSO,
  SHABILITACAOFILIAL.DECRETOHABILITACAO,
  SHABILITACAOFILIAL.DESCRICAOHABILITACAO,
  SHABILITACAOFILIAL.IDCURSOMEC,
  SHABILITACAOFILIAL.IDHABILITACAOFILIAL, 
  
  SHABILITACAO.NOME HABILITACAO,  
  SHABILITACAO.CODHABINEP,
  SHABILITACAO.CODTIPOHABILITACAO,
  
  SHABILITACAOALUNO.CODINST,
  SHABILITACAOALUNO.CODINSTDIPLOMA,
  SHABILITACAOALUNO.CODINSTDESTINO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO, 103) DTCONCLUSAOCURSO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU, 103) DTCOLACAOGRAU,  
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTINGRESSO, 103) DTINGRESSO,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISDIPLOMA, 103) DTEMISDIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTREGISTRODIPLOMA, 103) DTREGISTRODIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISSAODOU, 103) DTEMISSAODOU,
  SHABILITACAOALUNO.REGISTROCONCLUSAO,
  SHABILITACAOALUNO.LIVROREGISTRO, 
  SHABILITACAOALUNO.PROCESSOREGISTRO,
  SHABILITACAOALUNO.PAGINAREGISTRO,
  
  SAUTORIZACAOCURSO.ATOREGULATORIO,  
  SAUTORIZACAOCURSO.NUMRESOLUCAO,
  CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRESOLUCAO, 103) DTRESOLUCAO,
  SAUTORIZACAOCURSO.NUMPUBLICACAO,
  SAUTORIZACAOCURSO.PAGINAPUBLICACAO,
  SAUTORIZACAOCURSO.SECAOPUBLICACAO,  
  SAUTORIZACAOCURSO.TIPOAUTORIZACAO,  
            
  CASE WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '3' THEN 'Ata'
   ELSE 'PENDENTE' END DESCRICAOTIPOAUTORIZACAO, 

  CASE WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '1' THEN 'Autorizado'
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '2' THEN 'Reconhecido' 
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '3' THEN 'Renovação de Reconhecimento'
   ELSE 'PENDENTE' END DESCRICAOATOREGULATORIO,     
   	
  COALESCE(SAUTORIZACAOCURSO.LOCALAUTORIZ, 'DOU') LOCALAUTORIZ, 	
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOURECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOUAUTORIZACAO,103)) DTDOURECONHECIMENTO,
  COALESCE(SAUTORIZACAOCURSO.PORTRECONHECIMENTO, SAUTORIZACAOCURSO.PORTAUTORIZACAO)   PORTRECONHECIMENTO,  
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTAUTORIZACAO,103)) DTRECONHECIMENTO,
   	
  SINSTITUICAO.NOME NOMEREGISTRADORA,
  SINSTITUICAO.CODEMEC CODEMECREGISTRADORA,
  SINSTITUICAO.DIRETOR DIRETORREGISTRADORA,
  SINSTITUICAO.CIDADE,
   
  GIMAGEM.IMAGEM IMAGEMFILIAL,   
  GFILIAL.CODFILIAL,
  GFILIAL.NOME NOMEFILIAL,
  GFILIAL.CGC CGCFILIAL,
  GFILIAL.CIDADE + ' - ' + GFILIAL.ESTADO CIDADEFILIAL,
  GFILIAL.RUA RUAFILIAL,
  GFILIAL.COMPLEMENTO COMPLEMENTOFILIAL,
  GFILIAL.BAIRRO BAIRROFILIAL,
  GFILIAL.NUMERO NUMEROFILIAL,
  GFILIAL.ESTADO ESTADOFILIAL,
  GFILIAL.PAIS PAISFILIAL,
  GFILIAL.CEP CEPFILIAL,
  GFILIAL.IDIMAGEM IDIMAGEMFILIAL,
  
  PPESSOADIRECAO.NOME NOMEDIRETORFILIAL,
  GDIR.IMAGEM ASSINATURADIRETORFILIAL,
  
  PPESSOASECRETARIO.NOME NOMESEC1FILIAL,
  GSEC1.IMAGEM ASSINATURASEC1FILIAL, 
  
  SAUTORIZACAOFILIAL.MODALIDADE IES_MODALIDADE,
  
  CASE WHEN SAUTORIZACAOFILIAL.ATOREGULATORIO = '1' THEN 'Credenciada'
  ELSE 'Recredenciada' END IES_ATOREGULATORIO,
  
  CASE WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '3' THEN 'Ata' END IES_TIPOAUTORIZ,
  
  SAUTORIZACAOFILIAL.NRAUTORIZ IES_NRAUTORIZ,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTAUTORIZ, 103) IES_DTAUTORIZ,
  SAUTORIZACAOFILIAL.RECAUTORIZ IES_RECAUTORIZ,
  SAUTORIZACAOFILIAL.LOCALAUTORIZ IES_LOCALAUTORIZ,
  SAUTORIZACAOFILIAL.NUMPUBLICACAO IES_NUMPUBLICACAO,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTPUBLICACAO, 103) IES_DTPUBLICACAO,
  SAUTORIZACAOFILIAL.SECAOPUBLICACAO IES_SECAOPUBLICACAO,
  SAUTORIZACAOFILIAL.PAGINAPUBLICACAO IES_PAGINAPUBLICACAO,
  CASE WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'M' THEN 'Bacharel'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'F' THEN 'Bacharela'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'M' THEN 'Licenciado'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'F' THEN 'Licenciada'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'M' THEN 'Tecnólogo'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'F' THEN 'Tecnóloga'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'PÓS-GRADUAÇÃO LATO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'PÓS-GRADUAÇÃO LATO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'STRICTO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Mestre'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'STRICTO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Mestra'
  END AS MODALIDADE,
  SMODALIDADECURSO.DESCRICAO as NOMEMODALIDADE,
  PPESSOA.SEXO,
  CASE WHEN PPESSOA.SEXO = 'M' then 'portador' else 'portadora' end as PORTADOR,
  CASE WHEN PPESSOA.SEXO = 'M' then 'nascido' else 'nascida' end as NASCIDO,
  CONVERT(VARCHAR(10),GETDATE(), 103) AS DATAATUAL,
  COORDENADOR.NOME AS NOMECOORDENADOR,
  CASE WHEN COORDENADOR.SEXO = 'M' then 'Coordenador' else 'Coordenadora' end as GENCOORDENADOR,
  PPESSOACOORDENADORREGDIP.NOME AS NOMECOORDENADORREGDIP,
  GETD.NOME AS NOMEESTADONATAL,
  ASSINSECRETARIO.IMAGEM AS ASSIN_SEC1,
  CODREGISTRO.IMAGEM AS ASSIN_COORD,
  ASSINDIRECAO.IMAGEM AS ASSIN_DIRETOR,
  case ppessoa.ESTADONATAL  when 'AC' then 'do'
							when 'AL' then 'do'
							when 'AM' then 'do'
							when 'AP' then 'do'
							when 'BA' then 'da'
							when 'CE' then 'do'
							when 'DF' then 'do'
							when 'ES' then 'do'
							when 'GO' then 'do'
							when 'MA' then 'do'
							when 'MG' then 'de'
							when 'MS' then 'do'
							when 'MT' then 'do'
							when 'PA' then 'do'
							when 'PB' then 'da'
							when 'PE' then 'de'
							when 'PI' then 'do'
							when 'PR' then 'do'
							when 'RJ' then 'do'
							when 'RN' then 'do'
							when 'RO' then 'de'
							when 'RR' then 'de'
							when 'RS' then 'do'
							when 'SC' then 'de'
							when 'SE' then 'de'
							when 'SP' then 'de'
							when 'TO' then 'do'
	end as PREP_ESTADO,
	CAST(ISNULL(SGRADE.CARGAHORARIA, 0) AS INT) AS CARGAHORARIA,
	ASSINAFONSO.IMAGEM AS ASSIN_AFONSO
FROM SHABILITACAOFILIAL (NOLOCK) 
JOIN SHABILITACAOALUNO (NOLOCK)
      ON (SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
          AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  LEFT JOIN SAUTORIZACAOCURSO (NOLOCK)
      ON (SAUTORIZACAOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
      AND SAUTORIZACAOCURSO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
      AND SAUTORIZACAOCURSO.CODAUTORIZACURSO = (SELECT MAX(CODAUTORIZACURSO)
                                                FROM SAUTORIZACAOCURSO SAUTORIZACAOCURSO2 (NOLOCK)
                                                WHERE SAUTORIZACAOCURSO2.CODCOLIGADA = SAUTORIZACAOCURSO.CODCOLIGADA
                                                  AND SAUTORIZACAOCURSO2.IDHABILITACAOFILIAL = SAUTORIZACAOCURSO.IDHABILITACAOFILIAL))
  JOIN SALUNO (NOLOCK) 
      ON (SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA 
          AND SALUNO.RA = SHABILITACAOALUNO.RA)  
 LEFT JOIN SALUNOCOMPL (NOLOCK)
		ON SALUNOCOMPL.CODCOLIGADA = SALUNO.CODCOLIGADA
			AND SALUNOCOMPL.RA = SALUNO.RA
  JOIN PPESSOA (NOLOCK) 
      ON (PPESSOA.CODIGO = SALUNO.CODPESSOA)
  JOIN GETD (NOLOCK)
      ON (PPESSOA.ESTADONATAL = GETD.CODETD)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  LEFT JOIN PCODNACAO (NOLOCK)
    ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)      
  JOIN GFILIAL (NOLOCK) 
     ON (GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
         AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)        
    
  LEFT JOIN SFILIAL (NOLOCK)
      ON (GFILIAL.CODCOLIGADA = SFILIAL.CODCOLIGADA
          AND GFILIAL.CODFILIAL = SFILIAL.CODFILIAL)
  LEFT JOIN SDIRECAOFILIAL (NOLOCK)
      ON (SFILIAL.CODCOLIGADA = SDIRECAOFILIAL.CODCOLIGADA
          AND SFILIAL.CODFILIAL = SDIRECAOFILIAL.CODFILIAL)
 
  LEFT JOIN PPESSOA PPESSOADIRECAO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOA = PPESSOADIRECAO.CODIGO  )
  LEFT JOIN PPESSOA PPESSOASECRETARIO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC1 = PPESSOASECRETARIO.CODIGO  )    
  LEFT JOIN PPESSOA PPESSOACOORDENADORREGDIP (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC2 = PPESSOACOORDENADORREGDIP.CODIGO  ) 
  LEFT JOIN ZMDASSINATURAS ASSINSECRETARIO (NOLOCK)
      ON (PPESSOASECRETARIO.CODIGO = ASSINSECRETARIO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINDIRECAO (NOLOCK)
  	  ON (PPESSOADIRECAO.CODIGO = ASSINDIRECAO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINCOORDENADOR (NOLOCK)
  	  ON (PPESSOACOORDENADORREGDIP.CODIGO = ASSINDIRECAO.CODPESSOA)  	 
  	  
 LEFT JOIN ZMDASSINATURAS ASSINAFONSO (NOLOCK) ON (ASSINAFONSO.CODPESSOA = 31472)	
      
  LEFT JOIN GIMAGEM GDIR(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURA = GDIR.ID   
  LEFT JOIN GIMAGEM GSEC1(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURASEC1 = GSEC1.ID 
  LEFT JOIN GIMAGEM (NOLOCK)     ON GFILIAL.IDIMAGEM = GIMAGEM.ID     
  
    LEFT JOIN ZMDASSINATURAS AS CODREGISTRO ON CODREGISTRO.CODPESSOA = PPESSOACOORDENADORREGDIP.CODIGO
  
  JOIN STIPOCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA AND
        SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)        
  JOIN SHABILITACAO (NOLOCK) 
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO 
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN SGRADE (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO AND
          SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO AND
          SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE 
  JOIN SCURSO (NOLOCK) 
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
          AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
 LEFT JOIN SCURSOCOMPL ON SCURSO.CODCURSO = SCURSOCOMPL.CODCURSO
	AND SCURSO.CODCOLIGADA = SCURSOCOMPL.CODCOLIGADA
 LEFT JOIN SAREA ON SAREA.CODAREA = SCURSO.CODAREA
  LEFT JOIN SMODALIDADECURSO (NOLOCK) 
      ON (SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA AND 
	      SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO)   
  LEFT JOIN SCURSOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.IDCURSOMEC  = SCURSOMEC.IDCURSOMEC
  LEFT JOIN SINSTITUICAOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SINSTITUICAOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODFILIAL = SINSTITUICAOMEC.CODFILIAL
  LEFT JOIN SCOORDENADOR (NOLOCK)
	  ON SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	 AND SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
  LEFT JOIN PPESSOA AS COORDENADOR (NOLOCK)
      ON COORDENADOR.CODIGO = SCOORDENADOR.CODPESSOA          
  LEFT JOIN SINSTITUICAO (NOLOCK)
      ON SHABILITACAOALUNO.CODINSTDIPLOMA = SINSTITUICAO.CODINST

  LEFT JOIN
             (SELECT CODCOLIGADA,
                     CODAUTORIZACAO,
                     IDINSTITUICAOMEC,
                     CODFILIAL,
                     CODTIPOCURSO,
                     MODALIDADE,
                     ATOREGULATORIO,
                     TIPOAUTORIZ,
                     NRAUTORIZ,
                     DTAUTORIZ,
                     RECAUTORIZ,
                     COALESCE(LOCALAUTORIZ, 'DOU') LOCALAUTORIZ,
                     NUMPUBLICACAO,
                     DTPUBLICACAO,
                     SECAOPUBLICACAO,
                     PAGINAPUBLICACAO
              FROM SAUTORIZACAOFILIAL (NOLOCK)
              WHERE CODAUTORIZACAO = (SELECT MAX(AUX.CODAUTORIZACAO)
                                      FROM SAUTORIZACAOFILIAL AUX (NOLOCK)
                                      WHERE AUX.CODCOLIGADA = SAUTORIZACAOFILIAL.CODCOLIGADA
                                        AND AUX.IDINSTITUICAOMEC = SAUTORIZACAOFILIAL.IDINSTITUICAOMEC)) SAUTORIZACAOFILIAL
             ON (SAUTORIZACAOFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
             AND SAUTORIZACAOFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL) 
             
             
       
WHERE 
SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA_N
AND SHABILITACAOALUNO.RA = :RA_S
AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL_N
and SHABILITACAOALUNO.DTCONCLUSAOCURSO IS NOT NULL";17233;;;;10/11/2022;consultor1.totvs;0;1;1;1;;;;;d33fa10e-053e-4471-b108-96307261b689;;;-6858;raphael.muzy;05/10/2021;consultor1.totvs;10/11/2022;
S;IP993DIP;DIPLOMA UNIVERSIDADE;"/* PÓS GRADUAÇÃO */
SELECT 
  SALUNO.CODCOLIGADA,  
  SALUNO.RA,
  SALUNO.CODTIPOCURSO,
  STIPOCURSO.NOME NIVELENSINO,
  /*SCOMPETENCIA.DESCRICAO*/
  RTRIM(SUBSTRING(SCOMPETENCIA.DESCRICAO,0,CHARINDEX('/',SCOMPETENCIA.DESCRICAO))) AS 'COMPETENCIA',
  PPESSOA.NOME NOMEALUNO,    
  CONVERT(VARCHAR,PPESSOA.DTNASCIMENTO,103) DTNASCIMENTO,
  PPESSOAPAI.NOME NOMEPAI,           
  PPESSOAMAE.NOME NOMEMAE,
  PPESSOA.PAIS PAISALUNO,  
  PPESSOA.NATURALIDADE,
  PPESSOA.NACIONALIDADE,
  /*PCODNACAO.DESCRICAO NOMENACIONALIDADE,*/
  (SELECT 
CASE WHEN PPESSOA.SEXO = 'F' THEN ISNULL(ZMDNACIONALIDADE.NOMEFEMININO,DESCRICAO)
	WHEN PPESSOA.SEXO = 'M' THEN ISNULL(ZMDNACIONALIDADE.NOMEMASCULINO,DESCRICAO)
	ELSE DESCRICAO END FROM PCODNACAO 
	LEFT JOIN ZMDNACIONALIDADE ON ZMDNACIONALIDADE.CODNACAO = PCODNACAO.CODCLIENTE

	WHERE CODCLIENTE = PPESSOA.NACIONALIDADE) NOMENACIONALIDADE,
  PPESSOA.CARTIDENTIDADE, 
  PPESSOA.ORGEMISSORIDENT,
  PPESSOA.UFCARTIDENT,
  PPESSOA.CPF,    
  
  SCURSO.NOME NOMECURSO, 
  SCURSO.CODCURSO,
  SCURSO.DECRETO,
  SCURSO.REGCONTRATO,
  SCURSO.CODCURINEP, 
  
  A.CODHABILITACAO,
  A.DECRETOCURSO,
  A.DESCRICAOCURSO,
  A.DECRETOHABILITACAO,
  A.DESCRICAOHABILITACAO,
  A.IDCURSOMEC,
  A.IDHABILITACAOFILIAL, 
  
  SHABILITACAO.NOME HABILITACAO,  
  SHABILITACAO.CODHABINEP,
  SHABILITACAO.CODTIPOHABILITACAO,
  
  A.CODINST,
  A.CODINSTDIPLOMA,
  A.CODINSTDESTINO, 
  CONVERT(VARCHAR,A.DTCONCLUSAOCURSO, 103) DTCONCLUSAOCURSO, 
  CONVERT(VARCHAR,A.DTCOLACAOGRAU, 103) DTCOLACAOGRAU,  
  CONVERT(VARCHAR,A.DTINGRESSO, 103) DTINGRESSO,
  CONVERT(VARCHAR,A.DTEMISDIPLOMA, 103) DTEMISDIPLOMA,
  CONVERT(VARCHAR,SCERTIFICADO.DTREGISTRO, 103) DTREGISTRODIPLOMA,
  CONVERT(VARCHAR,A.DTEMISSAODOU, 103) DTEMISSAODOU,
  SCERTIFICADO.NUMREGISTRO AS REGISTROCONCLUSAO,
  SCERTIFICADO.CODLIVRO AS LIVROREGISTRO, 
  SCERTIFICADO.NUMPROCESSO,
  A.PROCESSOREGISTRO,
  SCERTIFICADO.FOLHA AS PAGINAREGISTRO,
  
  SAUTORIZACAOCURSO.ATOREGULATORIO,  
  SAUTORIZACAOCURSO.NUMRESOLUCAO,
  CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRESOLUCAO, 103) DTRESOLUCAO,
  SAUTORIZACAOCURSO.NUMPUBLICACAO,
  SAUTORIZACAOCURSO.PAGINAPUBLICACAO,
  SAUTORIZACAOCURSO.SECAOPUBLICACAO,  
  SAUTORIZACAOCURSO.TIPOAUTORIZACAO,  
            
  CASE WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '3' THEN 'Ata'
   ELSE 'PENDENTE' END DESCRICAOTIPOAUTORIZACAO, 

  CASE WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '1' THEN 'Autorizado'
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '2' THEN 'Reconhecido' 
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '3' THEN 'Renovação de Reconhecimento'
   ELSE 'PENDENTE' END DESCRICAOATOREGULATORIO,     
   	
  COALESCE(SAUTORIZACAOCURSO.LOCALAUTORIZ, 'DOU') LOCALAUTORIZ, 	
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOURECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOUAUTORIZACAO,103)) DTDOURECONHECIMENTO,
  COALESCE(SAUTORIZACAOCURSO.PORTRECONHECIMENTO, SAUTORIZACAOCURSO.PORTAUTORIZACAO)   PORTRECONHECIMENTO,  
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTAUTORIZACAO,103)) DTRECONHECIMENTO,
   	
  SINSTITUICAO.NOME NOMEREGISTRADORA,
  SINSTITUICAO.CODEMEC CODEMECREGISTRADORA,
  SINSTITUICAO.DIRETOR DIRETORREGISTRADORA,
   
  GIMAGEM.IMAGEM IMAGEMFILIAL,   
  GFILIAL.CODFILIAL,
  GFILIAL.NOME NOMEFILIAL,
  GFILIAL.CGC CGCFILIAL,
  GFILIAL.CIDADE CIDADEFILIAL,
  GFILIAL.RUA RUAFILIAL,
  GFILIAL.COMPLEMENTO COMPLEMENTOFILIAL,
  GFILIAL.BAIRRO BAIRROFILIAL,
  GFILIAL.NUMERO NUMEROFILIAL,
  GFILIAL.ESTADO ESTADOFILIAL,
  GFILIAL.PAIS PAISFILIAL,
  GFILIAL.CEP CEPFILIAL,
  GFILIAL.IDIMAGEM IDIMAGEMFILIAL,
  
  PPESSOADIRECAO.NOME NOMEDIRETORFILIAL,
  GDIR.IMAGEM ASSINATURADIRETORFILIAL,
  
  PPESSOASECRETARIO.NOME NOMESEC1FILIAL,
  GSEC1.IMAGEM ASSINATURASEC1FILIAL, 
  
  SAUTORIZACAOFILIAL.MODALIDADE IES_MODALIDADE,
  
  CASE WHEN SAUTORIZACAOFILIAL.ATOREGULATORIO = '1' THEN 'Credenciada'
  ELSE 'Recredenciada' END IES_ATOREGULATORIO,
  
  CASE WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '3' THEN 'Ata' END IES_TIPOAUTORIZ,
  
  SAUTORIZACAOFILIAL.NRAUTORIZ IES_NRAUTORIZ,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTAUTORIZ, 103) IES_DTAUTORIZ,
  SAUTORIZACAOFILIAL.RECAUTORIZ IES_RECAUTORIZ,
  SAUTORIZACAOFILIAL.LOCALAUTORIZ IES_LOCALAUTORIZ,
  SAUTORIZACAOFILIAL.NUMPUBLICACAO IES_NUMPUBLICACAO,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTPUBLICACAO, 103) IES_DTPUBLICACAO,
  SAUTORIZACAOFILIAL.SECAOPUBLICACAO IES_SECAOPUBLICACAO,
  SAUTORIZACAOFILIAL.PAGINAPUBLICACAO IES_PAGINAPUBLICACAO,
  CASE WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'M' THEN 'Bacharel'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'F' THEN 'Bacharela'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'M' THEN 'Licenciado'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'F' THEN 'Licenciada'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'M' THEN 'Tecnólogo'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'F' THEN 'Tecnóloga'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LATO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LATO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'STRICTO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Mestre'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'STRICTO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Mestra'
  END AS MODALIDADE,
  PPESSOA.SEXO,
  CASE WHEN PPESSOA.SEXO = 'M' then 'portador' else 'portadora' end as PORTADOR,
  CASE WHEN PPESSOA.SEXO = 'M' then 'nascido' else 'nascida' end as NASCIDO,
  CONVERT(VARCHAR(10),GETDATE(), 103) AS DATAATUAL,
  COORDENADOR.NOME AS NOMECOORDENADOR,
  CASE WHEN COORDENADOR.SEXO = 'M' then 'Coordenador' else 'Coordenadora' end as GENCOORDENADOR,
  PPESSOACOORDENADORREGDIP.NOME AS NOMECOORDENADORREGDIP,
  GETD.NOME AS NOMEESTADONATAL,
  ASSINSECRETARIO.IMAGEM AS ASSIN_SEC1,
  ASSINCOORDENADOR.IMAGEM AS ASSIN_COORD,
  ASSINDIRECAO.IMAGEM AS ASSIN_DIRETOR,
  case ppessoa.ESTADONATAL  when 'AC' then 'do'
							when 'AL' then 'do'
							when 'AM' then 'do'
							when 'AP' then 'do'
							when 'BA' then 'da'
							when 'CE' then 'do'
							when 'DF' then 'do'
							when 'ES' then 'do'
							when 'GO' then 'do'
							when 'MA' then 'do'
							when 'MG' then 'de'
							when 'MS' then 'do'
							when 'MT' then 'do'
							when 'PA' then 'do'
							when 'PB' then 'da'
							when 'PE' then 'de'
							when 'PI' then 'do'
							when 'PR' then 'do'
							when 'RJ' then 'do'
							when 'RN' then 'do'
							when 'RO' then 'de'
							when 'RR' then 'de'
							when 'RS' then 'do'
							when 'SC' then 'de'
							when 'SE' then 'de'
							when 'SP' then 'de'
							when 'TO' then 'do'
	end as PREP_ESTADO,
	CAST(ISNULL(SCERTIFICADO.CARGAHORARIA, 0) AS INT) AS CARGAHORARIA,
	ASSINAFONSO.IMAGEM AS ASSIN_AFONSO
FROM SCERTIFICADO (NOLOCK)
INNER JOIN SCOMPETENCIA (NOLOCK) ON SCOMPETENCIA.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SCOMPETENCIA.CODCOMPETENCIA = SCERTIFICADO.CODCOMPETENCIA
/*
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SCERTIFICADO.CODCOLIGADA = A.CODCOLIGADA
	AND A.IDHABILITACAOFILIAL = SCERTIFICADO.IDHABILITACAOFILIAL
JOIN SHABILITACAOALUNO (NOLOCK)
      ON (SHABILITACAOALUNO.CODCOLIGADA = A.CODCOLIGADA 
          AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = A.IDHABILITACAOFILIAL)
		  AND SHABILITACAOALUNO.RA = SCERTIFICADO.RA*/

OUTER APPLY (
SELECT 
	SHABILITACAOALUNO.CODCOLIGADA,
	SHABILITACAOALUNO.RA,
	SHABILITACAOALUNO.IDHABILITACAOFILIAL,
	SHABILITACAOALUNO.CODINSTDIPLOMA,
	SHABILITACAOALUNO.CODINSTDESTINO,
	SHABILITACAOALUNO.DTCONCLUSAOCURSO,
	SHABILITACAOALUNO.DTCOLACAOGRAU,
	SHABILITACAOALUNO.DTINGRESSO,
	SHABILITACAOALUNO.DTEMISDIPLOMA,
	SHABILITACAOALUNO.DTREGISTRODIPLOMA,
	SHABILITACAOALUNO.DTEMISSAODOU,
	SHABILITACAOALUNO.REGISTROCONCLUSAO,
	SHABILITACAOALUNO.LIVROREGISTRO,
	SHABILITACAOALUNO.PROCESSOREGISTRO,
	SHABILITACAOALUNO.PAGINAREGISTRO,
	SHABILITACAOALUNO.CODINST,
	SHABILITACAOFILIAL.CODFILIAL,
	SHABILITACAOFILIAL.CODTIPOCURSO,
	SHABILITACAOFILIAL.CODCURSO,
    SHABILITACAOFILIAL.CODHABILITACAO,
    SHABILITACAOFILIAL.CODGRADE,
	SHABILITACAOFILIAL.IDCURSOMEC,
	SHABILITACAOFILIAL.DECRETOCURSO,
	SHABILITACAOFILIAL.DESCRICAOCURSO,
	SHABILITACAOFILIAL.DECRETOHABILITACAO,
	SHABILITACAOFILIAL.DESCRICAOHABILITACAO
	

FROM SHABILITACAOALUNO 
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SCOMPETENCIAGRADE ON SGRADE.CODCOLIGADA = SCOMPETENCIAGRADE.CODCOLIGADA
	AND SGRADE.CODGRADE = SCOMPETENCIAGRADE.CODGRADE
	AND SGRADE.CODHABILITACAO = SCOMPETENCIAGRADE.CODHABILITACAO
	AND SGRADE.CODCURSO = SCOMPETENCIAGRADE.CODCURSO
WHERE SHABILITACAOALUNO.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
AND SHABILITACAOALUNO.RA = SCERTIFICADO.RA
AND SCOMPETENCIAGRADE.CODCOMPETENCIA = SCERTIFICADO.CODCOMPETENCIA
) AS A

  LEFT JOIN SAUTORIZACAOCURSO (NOLOCK)
      ON (SAUTORIZACAOCURSO.CODCOLIGADA = A.CODCOLIGADA 
      AND SAUTORIZACAOCURSO.IDHABILITACAOFILIAL = A.IDHABILITACAOFILIAL
      AND SAUTORIZACAOCURSO.CODAUTORIZACURSO = (SELECT MAX(CODAUTORIZACURSO)
                                                FROM SAUTORIZACAOCURSO SAUTORIZACAOCURSO2 (NOLOCK)
                                                WHERE SAUTORIZACAOCURSO2.CODCOLIGADA = SAUTORIZACAOCURSO.CODCOLIGADA
                                                  AND SAUTORIZACAOCURSO2.IDHABILITACAOFILIAL = SAUTORIZACAOCURSO.IDHABILITACAOFILIAL))
  JOIN SALUNO (NOLOCK) 
      ON (SALUNO.CODCOLIGADA = A.CODCOLIGADA 
          AND SALUNO.RA = A.RA)  
  JOIN PPESSOA (NOLOCK) 
      ON (PPESSOA.CODIGO = SALUNO.CODPESSOA)
  JOIN GETD (NOLOCK)
      ON (PPESSOA.ESTADONATAL = GETD.CODETD)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  LEFT JOIN PCODNACAO (NOLOCK)
    ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)      
  JOIN GFILIAL (NOLOCK) 
     ON (GFILIAL.CODCOLIGADA = A.CODCOLIGADA 
         AND GFILIAL.CODFILIAL = A.CODFILIAL)        
    
  LEFT JOIN SFILIAL (NOLOCK)
      ON (GFILIAL.CODCOLIGADA = SFILIAL.CODCOLIGADA
          AND GFILIAL.CODFILIAL = SFILIAL.CODFILIAL)
  LEFT JOIN SDIRECAOFILIAL (NOLOCK)
      ON (SFILIAL.CODCOLIGADA = SDIRECAOFILIAL.CODCOLIGADA
          AND SFILIAL.CODFILIAL = SDIRECAOFILIAL.CODFILIAL)
 
  LEFT JOIN PPESSOA PPESSOADIRECAO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOA = PPESSOADIRECAO.CODIGO  )
  LEFT JOIN PPESSOA PPESSOASECRETARIO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC1 = PPESSOASECRETARIO.CODIGO  )    
  LEFT JOIN PPESSOA PPESSOACOORDENADORREGDIP (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC2 = PPESSOACOORDENADORREGDIP.CODIGO  ) 
  LEFT JOIN ZMDASSINATURAS ASSINSECRETARIO (NOLOCK)
      ON (PPESSOASECRETARIO.CODIGO = ASSINSECRETARIO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINDIRECAO (NOLOCK)
  	  ON (PPESSOADIRECAO.CODIGO = ASSINDIRECAO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINCOORDENADOR (NOLOCK)
  	  ON (PPESSOACOORDENADORREGDIP.CODIGO = ASSINDIRECAO.CODPESSOA)  	  
     
     LEFT JOIN ZMDASSINATURAS ASSINAFONSO (NOLOCK) ON (ASSINAFONSO.CODPESSOA = 31472)
     
  LEFT JOIN GIMAGEM GDIR(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURA = GDIR.ID   
  LEFT JOIN GIMAGEM GSEC1(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURASEC1 = GSEC1.ID 
  LEFT JOIN GIMAGEM (NOLOCK)     ON GFILIAL.IDIMAGEM = GIMAGEM.ID     
  
  JOIN STIPOCURSO (NOLOCK)
    ON (A.CODCOLIGADA = STIPOCURSO.CODCOLIGADA AND
        A.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)        
  JOIN SHABILITACAO (NOLOCK) 
     ON (A.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
         AND A.CODCURSO = SHABILITACAO.CODCURSO 
         AND A.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN SGRADE (NOLOCK)
      ON A.CODCOLIGADA = SGRADE.CODCOLIGADA AND
          A.CODCURSO = SGRADE.CODCURSO AND
          A.CODHABILITACAO = SGRADE.CODHABILITACAO AND
          A.CODGRADE = SGRADE.CODGRADE 
  JOIN SCURSO (NOLOCK) 
      ON (A.CODCOLIGADA = SCURSO.CODCOLIGADA 
          AND A.CODCURSO = SCURSO.CODCURSO)
  LEFT JOIN SMODALIDADECURSO (NOLOCK) 
      ON (SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA AND 
	      SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO)   
  JOIN SCURSOMEC (NOLOCK)
      ON A.CODCOLIGADA = SCURSOMEC.CODCOLIGADA AND
          A.IDCURSOMEC  = SCURSOMEC.IDCURSOMEC
  LEFT JOIN SINSTITUICAOMEC (NOLOCK)
      ON A.CODCOLIGADA = SINSTITUICAOMEC.CODCOLIGADA AND
          A.CODFILIAL = SINSTITUICAOMEC.CODFILIAL
  LEFT JOIN SCOORDENADOR (NOLOCK)
	  ON SCOORDENADOR.CODCOLIGADA = A.CODCOLIGADA
	 AND SCOORDENADOR.IDHABILITACAOFILIAL = A.IDHABILITACAOFILIAL
  LEFT JOIN PPESSOA AS COORDENADOR (NOLOCK)
      ON COORDENADOR.CODIGO = SCOORDENADOR.CODPESSOA          
  LEFT JOIN SINSTITUICAO (NOLOCK)
      ON A.CODINSTDIPLOMA = SINSTITUICAO.CODINST

  LEFT JOIN
             (SELECT CODCOLIGADA,
                     CODAUTORIZACAO,
                     IDINSTITUICAOMEC,
                     CODFILIAL,
                     CODTIPOCURSO,
                     MODALIDADE,
                     ATOREGULATORIO,
                     TIPOAUTORIZ,
                     NRAUTORIZ,
                     DTAUTORIZ,
                     RECAUTORIZ,
                     COALESCE(LOCALAUTORIZ, 'DOU') LOCALAUTORIZ,
                     NUMPUBLICACAO,
                     DTPUBLICACAO,
                     SECAOPUBLICACAO,
                     PAGINAPUBLICACAO
              FROM SAUTORIZACAOFILIAL (NOLOCK)
              WHERE CODAUTORIZACAO = (SELECT MAX(AUX.CODAUTORIZACAO)
                                      FROM SAUTORIZACAOFILIAL AUX (NOLOCK)
                                      WHERE AUX.CODCOLIGADA = SAUTORIZACAOFILIAL.CODCOLIGADA
                                        AND AUX.IDINSTITUICAOMEC = SAUTORIZACAOFILIAL.IDINSTITUICAOMEC)) SAUTORIZACAOFILIAL
             ON (SAUTORIZACAOFILIAL.CODCOLIGADA = A.CODCOLIGADA
             AND SAUTORIZACAOFILIAL.CODFILIAL = A.CODFILIAL)      
WHERE 
SCERTIFICADO.CODCOLIGADA = :CODCOLIGADA1
AND SCERTIFICADO.IDCERTIFICADO = :IDCERTIFICADO1
/*AND SHABILITACAOALUNO.RA = :RA1
AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
and SHABILITACAOALUNO.DTCONCLUSAOCURSO IS NOT NULL*/



";16329;;;;25/10/2022;consultor1.totvs;0;1;1;1;;;;;4aa89d71-8c22-4c94-b6eb-bdd3d10e960c;;;-22572;raphael.muzy;13/10/2021;consultor1.totvs;25/10/2022;
S;IP993DIP.1;INFORMACAO CERTIFICADOS HISTÓRICO;"SELECT 
	'Conclusão do Módulo de Qualificação Profissional de Nível Tecnológico em ' + A.COMPETENCIA 
	/*+ ' do curso Superior de Tecnologia em ' + SCURSO.NOME + */
	+', com carga horária de ' + CAST(A.CARGAHORARIA AS VARCHAR) 
	+ ' horas, nos termos da Resolução CNE/CP nº 3 de 18/12/2002, publicada no D.O.U em 23/12/2002, Seção 1, pág. 162.' AS CONCLUSAO
		FROM SHABILITACAOALUNO 
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SCURSO (NOLOCK) 
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
          AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
INNER JOIN SCOMPETENCIAGRADE ON SGRADE.CODCOLIGADA = SCOMPETENCIAGRADE.CODCOLIGADA
	AND SGRADE.CODGRADE = SCOMPETENCIAGRADE.CODGRADE
	AND SGRADE.CODHABILITACAO = SCOMPETENCIAGRADE.CODHABILITACAO
	AND SGRADE.CODCURSO = SCOMPETENCIAGRADE.CODCURSO

OUTER APPLY(
SELECT 
	RTRIM(SUBSTRING(SCOMPETENCIA.DESCRICAO,0,CHARINDEX('/',SCOMPETENCIA.DESCRICAO))) AS 'COMPETENCIA',
	CAST(ISNULL(SCERTIFICADO.CARGAHORARIA, 0) AS INT) AS CARGAHORARIA,
	SCERTIFICADO.CODCOLIGADA,
	SCERTIFICADO.IDCERTIFICADO
FROM SCERTIFICADO
INNER JOIN SCOMPETENCIA (NOLOCK) ON SCOMPETENCIA.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SCOMPETENCIA.CODCOMPETENCIA = SCERTIFICADO.CODCOMPETENCIA
WHERE SCERTIFICADO.RA = SHABILITACAOALUNO.RA
AND SCERTIFICADO.CODCOMPETENCIA = SCOMPETENCIAGRADE.CODCOMPETENCIA
) AS A

WHERE 
SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA1
AND SHABILITACAOALUNO.RA = :RA2
AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
AND A.CODCOLIGADA IS NOT NULL
";1952;;;;25/10/2022;consultor1.totvs;0;1;1;1;;;;;4aa89d71-8c22-4c94-b6eb-bdd3d10e960c;;;-16355;consultor1.totvs;25/10/2022;consultor1.totvs;25/10/2022;
S;IP994DIP;DIPLOMA UNIVERSIDADE;"/*DIPLOMA SUPERIOR IES UNIVERSIDADE PORTARIA 1095: expedidora igual à registradora*/
SELECT 
  SALUNO.CODCOLIGADA,  
  SALUNO.RA,
  SALUNO.CODTIPOCURSO,
  STIPOCURSO.NOME NIVELENSINO,
  PPESSOA.NOME NOMEALUNO,    
  CONVERT(VARCHAR,PPESSOA.DTNASCIMENTO,103) DTNASCIMENTO,
  PPESSOAPAI.NOME NOMEPAI,           
  PPESSOAMAE.NOME NOMEMAE,
  PPESSOA.PAIS PAISALUNO,  
  PPESSOA.NATURALIDADE,
  PPESSOA.NACIONALIDADE,
  CASE WHEN ZMDNACIONALIDADE.CODNACAO IS NULL THEN PCODNACAO.DESCRICAO 
       WHEN PPESSOA.SEXO = 'M' THEN ZMDNACIONALIDADE.NOMEMASCULINO
       WHEN PPESSOA.SEXO = 'F' THEN ZMDNACIONALIDADE.NOMEFEMININO 
  END AS NOMENACIONALIDADE,
  PPESSOA.CARTIDENTIDADE, 
  PPESSOA.ORGEMISSORIDENT,
  PPESSOA.UFCARTIDENT,
  PPESSOA.CPF,    
  
  SCURSO.NOME NOMECURSO, 
  SCURSO.CODCURSO,
  SCURSO.DECRETO,
  SCURSO.REGCONTRATO,
  SCURSO.CODCURINEP, 
  
  SHABILITACAOFILIAL.CODHABILITACAO,
  SHABILITACAOFILIAL.DECRETOCURSO,
  SHABILITACAOFILIAL.DESCRICAOCURSO,
  SHABILITACAOFILIAL.DECRETOHABILITACAO,
  SHABILITACAOFILIAL.DESCRICAOHABILITACAO,
  SHABILITACAOFILIAL.IDCURSOMEC,
  SHABILITACAOFILIAL.IDHABILITACAOFILIAL, 
  
  SHABILITACAO.NOME HABILITACAO,  
  SHABILITACAO.CODHABINEP,
  SHABILITACAO.CODTIPOHABILITACAO,
  
  SHABILITACAOALUNO.CODINST,
  SHABILITACAOALUNO.CODINSTDIPLOMA,
  SHABILITACAOALUNO.CODINSTDESTINO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO, 103) DTCONCLUSAOCURSO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU, 103) DTCOLACAOGRAU,  
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTINGRESSO, 103) DTINGRESSO,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISDIPLOMA, 103) DTEMISDIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTREGISTRODIPLOMA, 103) DTREGISTRODIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISSAODOU, 103) DTEMISSAODOU,
  SHABILITACAOALUNO.REGISTROCONCLUSAO,
  SHABILITACAOALUNO.LIVROREGISTRO, 
  SHABILITACAOALUNO.PROCESSOREGISTRO,
  SHABILITACAOALUNO.PAGINAREGISTRO,
  
  SAUTORIZACAOCURSO.ATOREGULATORIO,  
  SAUTORIZACAOCURSO.NUMRESOLUCAO,
  CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRESOLUCAO, 103) DTRESOLUCAO,
  SAUTORIZACAOCURSO.NUMPUBLICACAO,
  SAUTORIZACAOCURSO.PAGINAPUBLICACAO,
  SAUTORIZACAOCURSO.SECAOPUBLICACAO,  
  SAUTORIZACAOCURSO.TIPOAUTORIZACAO,  
            
  CASE WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '3' THEN 'Ata'
   ELSE 'PENDENTE' END DESCRICAOTIPOAUTORIZACAO, 

  CASE WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '1' THEN 'Autorizado'
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '2' THEN 'Reconhecido' 
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '3' THEN 'Renovação de Reconhecimento'
   ELSE 'PENDENTE' END DESCRICAOATOREGULATORIO,     
   	
  COALESCE(SAUTORIZACAOCURSO.LOCALAUTORIZ, 'DOU') LOCALAUTORIZ, 	
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOURECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOUAUTORIZACAO,103)) DTDOURECONHECIMENTO,
  COALESCE(SAUTORIZACAOCURSO.PORTRECONHECIMENTO, SAUTORIZACAOCURSO.PORTAUTORIZACAO)   PORTRECONHECIMENTO,  
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTAUTORIZACAO,103)) DTRECONHECIMENTO,
   	
  SINSTITUICAO.NOME NOMEREGISTRADORA,
  SINSTITUICAO.CODEMEC CODEMECREGISTRADORA,
  SINSTITUICAO.DIRETOR DIRETORREGISTRADORA,
   
  GIMAGEM.IMAGEM IMAGEMFILIAL,   
  GFILIAL.CODFILIAL,
  GFILIAL.NOME NOMEFILIAL,
  GFILIAL.CGC CGCFILIAL,
  GFILIAL.CIDADE + ' - ' + GFILIAL.ESTADO AS  CIDADEFILIAL,
  GFILIAL.RUA RUAFILIAL,
  GFILIAL.COMPLEMENTO COMPLEMENTOFILIAL,
  GFILIAL.BAIRRO BAIRROFILIAL,
  GFILIAL.NUMERO NUMEROFILIAL,
  GFILIAL.ESTADO ESTADOFILIAL,
  GFILIAL.PAIS PAISFILIAL,
  GFILIAL.CEP CEPFILIAL,
  GFILIAL.IDIMAGEM IDIMAGEMFILIAL,
  
  PPESSOADIRECAO.NOME NOMEDIRETORFILIAL,
  GDIR.IMAGEM ASSINATURADIRETORFILIAL,
  
  PPESSOASECRETARIO.NOME NOMESEC1FILIAL,
  GSEC1.IMAGEM ASSINATURASEC1FILIAL, 
  
  SAUTORIZACAOFILIAL.MODALIDADE IES_MODALIDADE,
  
  CASE WHEN SAUTORIZACAOFILIAL.ATOREGULATORIO = '1' THEN 'Credenciada'
  ELSE 'Recredenciada' END IES_ATOREGULATORIO,
  
  CASE WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '3' THEN 'Ata' END IES_TIPOAUTORIZ,
  
  SAUTORIZACAOFILIAL.NRAUTORIZ IES_NRAUTORIZ,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTAUTORIZ, 103) IES_DTAUTORIZ,
  SAUTORIZACAOFILIAL.RECAUTORIZ IES_RECAUTORIZ,
  SAUTORIZACAOFILIAL.LOCALAUTORIZ IES_LOCALAUTORIZ,
  SAUTORIZACAOFILIAL.NUMPUBLICACAO IES_NUMPUBLICACAO,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTPUBLICACAO, 103) IES_DTPUBLICACAO,
  SAUTORIZACAOFILIAL.SECAOPUBLICACAO IES_SECAOPUBLICACAO,
  SAUTORIZACAOFILIAL.PAGINAPUBLICACAO IES_PAGINAPUBLICACAO,
  CASE WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'M' THEN 'Bacharel'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'F' THEN 'Bacharela'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'M' THEN 'Licenciado'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'F' THEN 'Licenciada'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'M' THEN 'Tecnólogo'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'F' THEN 'Tecnóloga'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'PÓS-GRADUAÇÃO LATO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'PÓS-GRADUAÇÃO LATO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'PÓS-GRADUAÇÃO STRICTO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Mestre'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'PÓS-GRADUAÇÃO STRICTO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Mestra'
  END AS MODALIDADE,
  PPESSOA.SEXO,
  CASE WHEN PPESSOA.SEXO = 'M' then 'portador' else 'portadora' end as PORTADOR,
  CASE WHEN PPESSOA.SEXO = 'M' then 'nascido' else 'nascida' end as NASCIDO,
  CONVERT(VARCHAR(10),GETDATE(), 103) AS DATAATUAL,
  COORDENADOR.NOME AS NOMECOORDENADOR,
  CASE WHEN COORDENADOR.SEXO = 'M' then 'Coordenador' else 'Coordenadora' end as GENCOORDENADOR,
  PPESSOACOORDENADORREGDIP.NOME AS NOMECOORDENADORREGDIP,
  GETD.NOME AS NOMEESTADONATAL,
  ASSINSECRETARIO.IMAGEM AS ASSIN_SEC1,
  ASSINCOORDENADOR.IMAGEM AS ASSIN_COORD,
  ASSINDIRECAO.IMAGEM AS ASSIN_DIRETOR,
  ASSINATURAVICEREITOR.IMAGEM AS ASSIN_VICEREITOR,
  case ppessoa.ESTADONATAL  when 'AC' then 'do'
							when 'AL' then 'do'
							when 'AM' then 'do'
							when 'AP' then 'do'
							when 'BA' then 'da'
							when 'CE' then 'do'
							when 'DF' then 'do'
							when 'ES' then 'do'
							when 'GO' then 'do'
							when 'MA' then 'do'
							when 'MG' then 'de'
							when 'MS' then 'do'
							when 'MT' then 'do'
							when 'PA' then 'do'
							when 'PB' then 'da'
							when 'PE' then 'de'
							when 'PI' then 'do'
							when 'PR' then 'do'
							when 'RJ' then 'do'
							when 'RN' then 'do'
							when 'RO' then 'de'
							when 'RR' then 'de'
							when 'RS' then 'do'
							when 'SC' then 'de'
							when 'SE' then 'de'
							when 'SP' then 'de'
							when 'TO' then 'do'
	end as prep_estado,
	REPLACE(REPLACE(SCURSO.NOME, 'Mestrado', ''), 'Profissional em ', '') as NOMECURSOREDUZIDO,
	SMODALIDADECURSO.DESCRICAO as NOMEMODALIDADE
FROM SHABILITACAOFILIAL (NOLOCK) 
JOIN SHABILITACAOALUNO (NOLOCK)
      ON (SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
          AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  LEFT JOIN SAUTORIZACAOCURSO (NOLOCK)
      ON (SAUTORIZACAOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
      AND SAUTORIZACAOCURSO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
      AND SAUTORIZACAOCURSO.CODAUTORIZACURSO = (SELECT MAX(CODAUTORIZACURSO)
                                                FROM SAUTORIZACAOCURSO SAUTORIZACAOCURSO2 (NOLOCK)
                                                WHERE SAUTORIZACAOCURSO2.CODCOLIGADA = SAUTORIZACAOCURSO.CODCOLIGADA
                                                  AND SAUTORIZACAOCURSO2.IDHABILITACAOFILIAL = SAUTORIZACAOCURSO.IDHABILITACAOFILIAL))
  JOIN SALUNO (NOLOCK) 
      ON (SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA 
          AND SALUNO.RA = SHABILITACAOALUNO.RA)  
  JOIN PPESSOA (NOLOCK) 
      ON (PPESSOA.CODIGO = SALUNO.CODPESSOA)
  JOIN GETD (NOLOCK)
      ON (PPESSOA.ESTADONATAL = GETD.CODETD)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  LEFT JOIN PCODNACAO (NOLOCK)
    ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)  
  LEFT JOIN ZMDNACIONALIDADE (NOLOCK)
    ON (PCODNACAO.CODCLIENTE = ZMDNACIONALIDADE.CODNACAO)
  JOIN GFILIAL (NOLOCK) 
     ON (GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
         AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)        
    
  LEFT JOIN SFILIAL (NOLOCK)
      ON (GFILIAL.CODCOLIGADA = SFILIAL.CODCOLIGADA
          AND GFILIAL.CODFILIAL = SFILIAL.CODFILIAL)
  LEFT JOIN SDIRECAOFILIAL (NOLOCK)
      ON (SFILIAL.CODCOLIGADA = SDIRECAOFILIAL.CODCOLIGADA
          AND SFILIAL.CODFILIAL = SDIRECAOFILIAL.CODFILIAL)
 
  LEFT JOIN PPESSOA PPESSOADIRECAO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOA = PPESSOADIRECAO.CODIGO  )
  LEFT JOIN PPESSOA PPESSOASECRETARIO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC1 = PPESSOASECRETARIO.CODIGO  )    
  LEFT JOIN PPESSOA PPESSOACOORDENADORREGDIP (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC2 = PPESSOACOORDENADORREGDIP.CODIGO  ) 
  LEFT JOIN ZMDASSINATURAS ASSINSECRETARIO (NOLOCK)
      ON (PPESSOASECRETARIO.CODIGO = ASSINSECRETARIO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINDIRECAO (NOLOCK)
  	  ON (PPESSOADIRECAO.CODIGO = ASSINDIRECAO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINCOORDENADOR (NOLOCK)
  	  ON (PPESSOACOORDENADORREGDIP.CODIGO = ASSINCOORDENADOR.CODPESSOA)  
  	  
  	  
 LEFT JOIN ZMDASSINATURAS ASSINATURAVICEREITOR (NOLOCK)
	ON ASSINATURAVICEREITOR.CODPESSOA =  31472 
      
  LEFT JOIN GIMAGEM GDIR(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURA = GDIR.ID   
  LEFT JOIN GIMAGEM GSEC1(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURASEC1 = GSEC1.ID 
  LEFT JOIN GIMAGEM (NOLOCK)     ON GFILIAL.IDIMAGEM = GIMAGEM.ID     
  
  JOIN STIPOCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA AND
        SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)        
  JOIN SHABILITACAO (NOLOCK) 
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO 
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN SGRADE (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO AND
          SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO AND
          SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE 
  JOIN SCURSO (NOLOCK) 
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
          AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  LEFT JOIN SMODALIDADECURSO (NOLOCK) 
      ON (SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA AND 
	      SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO)   
  /*JOIN SCURSOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.IDCURSOMEC  = SCURSOMEC.IDCURSOMEC*/
  LEFT JOIN SINSTITUICAOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SINSTITUICAOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODFILIAL = SINSTITUICAOMEC.CODFILIAL
  LEFT JOIN SCOORDENADOR (NOLOCK)
	  ON SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	 AND SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	 AND SCOORDENADOR.FUNCAO = 'C'
  LEFT JOIN PPESSOA AS COORDENADOR (NOLOCK)
      ON COORDENADOR.CODIGO = SCOORDENADOR.CODPESSOA          
  LEFT JOIN SINSTITUICAO (NOLOCK)
      ON SHABILITACAOALUNO.CODINSTDIPLOMA = SINSTITUICAO.CODINST

  LEFT JOIN
             (SELECT CODCOLIGADA,
                     CODAUTORIZACAO,
                     IDINSTITUICAOMEC,
                     CODFILIAL,
                     CODTIPOCURSO,
                     MODALIDADE,
                     ATOREGULATORIO,
                     TIPOAUTORIZ,
                     NRAUTORIZ,
                     DTAUTORIZ,
                     RECAUTORIZ,
                     COALESCE(LOCALAUTORIZ, 'DOU') LOCALAUTORIZ,
                     NUMPUBLICACAO,
                     DTPUBLICACAO,
                     SECAOPUBLICACAO,
                     PAGINAPUBLICACAO
              FROM SAUTORIZACAOFILIAL (NOLOCK)
              WHERE CODAUTORIZACAO = (SELECT MAX(AUX.CODAUTORIZACAO)
                                      FROM SAUTORIZACAOFILIAL AUX (NOLOCK)
                                      WHERE AUX.CODCOLIGADA = SAUTORIZACAOFILIAL.CODCOLIGADA
                                        AND AUX.IDINSTITUICAOMEC = SAUTORIZACAOFILIAL.IDINSTITUICAOMEC)) SAUTORIZACAOFILIAL
             ON (SAUTORIZACAOFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
             AND SAUTORIZACAOFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)      
WHERE 
SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA1
AND SHABILITACAOALUNO.RA = :RA1
AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
and SHABILITACAOALUNO.DTCONCLUSAOCURSO IS NOT NULL
and SMODALIDADECURSO.CODMODALIDADECURSO = 5 /*mestrado*/
and SHABILITACAOFILIAL.CODTIPOCURSO = 2";14982;;;;06/09/2022;consultor1.totvs;0;1;1;1;;;;;3ba37510-e683-4076-938a-ffcf260c3bc8;;;27105;raphael.muzy;20/10/2021;consultor1.totvs;06/09/2022;
S;IP99DIP;DIPLOMA UNIVERSIDADE;"/*DIPLOMA SUPERIOR IES UNIVERSIDADE PORTARIA 1095: expedidora igual à registradora*/
SELECT 
  SALUNO.CODCOLIGADA,  
  SALUNO.RA,
  SALUNO.CODTIPOCURSO,
  STIPOCURSO.NOME NIVELENSINO,
  PPESSOA.NOME NOMEALUNO,    
  CONVERT(VARCHAR,PPESSOA.DTNASCIMENTO,103) DTNASCIMENTO,
  PPESSOAPAI.NOME NOMEPAI,           
  PPESSOAMAE.NOME NOMEMAE,
  PPESSOA.PAIS PAISALUNO,  
  PPESSOA.NATURALIDADE,
  PPESSOA.NACIONALIDADE,
  PCODNACAO.DESCRICAO NOMENACIONALIDADE,
  PPESSOA.CARTIDENTIDADE, 
  PPESSOA.ORGEMISSORIDENT,
  PPESSOA.UFCARTIDENT,
  PPESSOA.CPF,    
  
  SCURSO.NOME NOMECURSO, 
  SCURSO.CODCURSO,
  SCURSO.DECRETO,
  SCURSO.REGCONTRATO,
  SCURSO.CODCURINEP, 
  
  SHABILITACAOFILIAL.CODHABILITACAO,
  SHABILITACAOFILIAL.DECRETOCURSO,
  SHABILITACAOFILIAL.DESCRICAOCURSO,
  SHABILITACAOFILIAL.DECRETOHABILITACAO,
  SHABILITACAOFILIAL.DESCRICAOHABILITACAO,
  SHABILITACAOFILIAL.IDCURSOMEC,
  SHABILITACAOFILIAL.IDHABILITACAOFILIAL, 
  
  SHABILITACAO.NOME HABILITACAO,  
  SHABILITACAO.CODHABINEP,
  SHABILITACAO.CODTIPOHABILITACAO,
  
  SHABILITACAOALUNO.CODINST,
  SHABILITACAOALUNO.CODINSTDIPLOMA,
  SHABILITACAOALUNO.CODINSTDESTINO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO, 103) DTCONCLUSAOCURSO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU, 103) DTCOLACAOGRAU,  
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTINGRESSO, 103) DTINGRESSO,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISDIPLOMA, 103) DTEMISDIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTREGISTRODIPLOMA, 103) DTREGISTRODIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISSAODOU, 103) DTEMISSAODOU,
  SHABILITACAOALUNO.REGISTROCONCLUSAO,
  SHABILITACAOALUNO.LIVROREGISTRO, 
  SHABILITACAOALUNO.PROCESSOREGISTRO,
  SHABILITACAOALUNO.PAGINAREGISTRO,
  
  SAUTORIZACAOCURSO.ATOREGULATORIO,  
  SAUTORIZACAOCURSO.NUMRESOLUCAO,
  CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRESOLUCAO, 103) DTRESOLUCAO,
  SAUTORIZACAOCURSO.NUMPUBLICACAO,
  SAUTORIZACAOCURSO.PAGINAPUBLICACAO,
  SAUTORIZACAOCURSO.SECAOPUBLICACAO,  
  SAUTORIZACAOCURSO.TIPOAUTORIZACAO,  
            
  CASE WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '3' THEN 'Ata'
   ELSE 'PENDENTE' END DESCRICAOTIPOAUTORIZACAO, 

  CASE WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '1' THEN 'Autorizado'
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '2' THEN 'Reconhecido' 
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '3' THEN 'Renovação de Reconhecimento'
   ELSE 'PENDENTE' END DESCRICAOATOREGULATORIO,     
   	
  COALESCE(SAUTORIZACAOCURSO.LOCALAUTORIZ, 'DOU') LOCALAUTORIZ, 	
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOURECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOUAUTORIZACAO,103)) DTDOURECONHECIMENTO,
  COALESCE(SAUTORIZACAOCURSO.PORTRECONHECIMENTO, SAUTORIZACAOCURSO.PORTAUTORIZACAO)   PORTRECONHECIMENTO,  
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTAUTORIZACAO,103)) DTRECONHECIMENTO,
   	
  SINSTITUICAO.NOME NOMEREGISTRADORA,
  SINSTITUICAO.CODEMEC CODEMECREGISTRADORA,
  SINSTITUICAO.DIRETOR DIRETORREGISTRADORA,
   
  GIMAGEM.IMAGEM IMAGEMFILIAL,   
  GFILIAL.CODFILIAL,
  GFILIAL.NOME NOMEFILIAL,
  GFILIAL.CGC CGCFILIAL,
  GFILIAL.CIDADE CIDADEFILIAL,
  GFILIAL.RUA RUAFILIAL,
  GFILIAL.COMPLEMENTO COMPLEMENTOFILIAL,
  GFILIAL.BAIRRO BAIRROFILIAL,
  GFILIAL.NUMERO NUMEROFILIAL,
  GFILIAL.ESTADO ESTADOFILIAL,
  GFILIAL.PAIS PAISFILIAL,
  GFILIAL.CEP CEPFILIAL,
  GFILIAL.IDIMAGEM IDIMAGEMFILIAL,
  
  PPESSOADIRECAO.NOME NOMEDIRETORFILIAL,
  GDIR.IMAGEM ASSINATURADIRETORFILIAL,
  
  PPESSOASECRETARIO.NOME NOMESEC1FILIAL,
  GSEC1.IMAGEM ASSINATURASEC1FILIAL, 
  
  SAUTORIZACAOFILIAL.MODALIDADE IES_MODALIDADE,
  
  CASE WHEN SAUTORIZACAOFILIAL.ATOREGULATORIO = '1' THEN 'Credenciada'
  ELSE 'Recredenciada' END IES_ATOREGULATORIO,
  
  CASE WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '3' THEN 'Ata' END IES_TIPOAUTORIZ,
  
  SAUTORIZACAOFILIAL.NRAUTORIZ IES_NRAUTORIZ,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTAUTORIZ, 103) IES_DTAUTORIZ,
  SAUTORIZACAOFILIAL.RECAUTORIZ IES_RECAUTORIZ,
  SAUTORIZACAOFILIAL.LOCALAUTORIZ IES_LOCALAUTORIZ,
  SAUTORIZACAOFILIAL.NUMPUBLICACAO IES_NUMPUBLICACAO,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTPUBLICACAO, 103) IES_DTPUBLICACAO,
  SAUTORIZACAOFILIAL.SECAOPUBLICACAO IES_SECAOPUBLICACAO,
  SAUTORIZACAOFILIAL.PAGINAPUBLICACAO IES_PAGINAPUBLICACAO,
  CASE WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'M' THEN 'Bacharel'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'F' THEN 'Bacharela'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'M' THEN 'Licenciado'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'F' THEN 'Licenciada'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'M' THEN 'Tecnólogo'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'F' THEN 'Tecnóloga'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LATO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LATO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'STRICTO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Mestre'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'STRICTO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Mestra'
  END AS MODALIDADE,
  PPESSOA.SEXO,
  CASE WHEN PPESSOA.SEXO = 'M' then 'portador' else 'portadora' end as PORTADOR,
  CASE WHEN PPESSOA.SEXO = 'M' then 'nascido' else 'nascida' end as NASCIDO,
  CONVERT(VARCHAR(10),GETDATE(), 103) AS DATAATUAL,
  COORDENADOR.NOME AS NOMECOORDENADOR,
  CASE WHEN COORDENADOR.SEXO = 'M' then 'Coordenador' else 'Coordenadora' end as GENCOORDENADOR,
  PPESSOACOORDENADORREGDIP.NOME AS NOMECOORDENADORREGDIP,
  GETD.NOME AS NOMEESTADONATAL,
  ASSINSECRETARIO.IMAGEM AS ASSIN_SEC1,
  ASSINCOORDENADOR.IMAGEM AS ASSIN_COORD,
  ASSINDIRECAO.IMAGEM AS ASSIN_DIRETOR,
  case ppessoa.ESTADONATAL  when 'AC' then 'do'
							when 'AL' then 'do'
							when 'AM' then 'do'
							when 'AP' then 'do'
							when 'BA' then 'da'
							when 'CE' then 'do'
							when 'DF' then 'do'
							when 'ES' then 'do'
							when 'GO' then 'do'
							when 'MA' then 'do'
							when 'MG' then 'de'
							when 'MS' then 'do'
							when 'MT' then 'do'
							when 'PA' then 'do'
							when 'PB' then 'da'
							when 'PE' then 'de'
							when 'PI' then 'do'
							when 'PR' then 'do'
							when 'RJ' then 'do'
							when 'RN' then 'do'
							when 'RO' then 'de'
							when 'RR' then 'de'
							when 'RS' then 'do'
							when 'SC' then 'de'
							when 'SE' then 'de'
							when 'SP' then 'de'
							when 'TO' then 'do'
	end as prep_estado,
	ASSINAFONSO.IMAGEM AS ASSIN_AFONSO
FROM SHABILITACAOFILIAL (NOLOCK) 
JOIN SHABILITACAOALUNO (NOLOCK)
      ON (SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
          AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  LEFT JOIN SAUTORIZACAOCURSO (NOLOCK)
      ON (SAUTORIZACAOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
      AND SAUTORIZACAOCURSO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
      AND SAUTORIZACAOCURSO.CODAUTORIZACURSO = (SELECT MAX(CODAUTORIZACURSO)
                                                FROM SAUTORIZACAOCURSO SAUTORIZACAOCURSO2 (NOLOCK)
                                                WHERE SAUTORIZACAOCURSO2.CODCOLIGADA = SAUTORIZACAOCURSO.CODCOLIGADA
                                                  AND SAUTORIZACAOCURSO2.IDHABILITACAOFILIAL = SAUTORIZACAOCURSO.IDHABILITACAOFILIAL))
  JOIN SALUNO (NOLOCK) 
      ON (SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA 
          AND SALUNO.RA = SHABILITACAOALUNO.RA)  
  JOIN PPESSOA (NOLOCK) 
      ON (PPESSOA.CODIGO = SALUNO.CODPESSOA)
  JOIN GETD (NOLOCK)
      ON (PPESSOA.ESTADONATAL = GETD.CODETD)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  LEFT JOIN PCODNACAO (NOLOCK)
    ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)      
  JOIN GFILIAL (NOLOCK) 
     ON (GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
         AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)        
    
  LEFT JOIN SFILIAL (NOLOCK)
      ON (GFILIAL.CODCOLIGADA = SFILIAL.CODCOLIGADA
          AND GFILIAL.CODFILIAL = SFILIAL.CODFILIAL)
  LEFT JOIN SDIRECAOFILIAL (NOLOCK)
      ON (SFILIAL.CODCOLIGADA = SDIRECAOFILIAL.CODCOLIGADA
          AND SFILIAL.CODFILIAL = SDIRECAOFILIAL.CODFILIAL)
 
  LEFT JOIN PPESSOA PPESSOADIRECAO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOA = PPESSOADIRECAO.CODIGO  )
  LEFT JOIN PPESSOA PPESSOASECRETARIO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC1 = PPESSOASECRETARIO.CODIGO  )    
  LEFT JOIN PPESSOA PPESSOACOORDENADORREGDIP (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC2 = PPESSOACOORDENADORREGDIP.CODIGO  ) 
  LEFT JOIN ZMDASSINATURAS ASSINSECRETARIO (NOLOCK)
      ON (PPESSOASECRETARIO.CODIGO = ASSINSECRETARIO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINDIRECAO (NOLOCK)
  	  ON (PPESSOADIRECAO.CODIGO = ASSINDIRECAO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINCOORDENADOR (NOLOCK)
  	  ON (PPESSOACOORDENADORREGDIP.CODIGO = ASSINDIRECAO.CODPESSOA)  	
  LEFT JOIN ZMDASSINATURAS ASSINAFONSO (NOLOCK) ON (ASSINAFONSO.CODPESSOA = 31472)	  
      
  LEFT JOIN GIMAGEM GDIR(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURA = GDIR.ID   
  LEFT JOIN GIMAGEM GSEC1(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURASEC1 = GSEC1.ID 
  LEFT JOIN GIMAGEM (NOLOCK)     ON GFILIAL.IDIMAGEM = GIMAGEM.ID     
  
  JOIN STIPOCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA AND
        SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)        
  JOIN SHABILITACAO (NOLOCK) 
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO 
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN SGRADE (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO AND
          SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO AND
          SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE 
  JOIN SCURSO (NOLOCK) 
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
          AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  LEFT JOIN SMODALIDADECURSO (NOLOCK) 
      ON (SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA AND 
	      SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO)   
  JOIN SCURSOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.IDCURSOMEC  = SCURSOMEC.IDCURSOMEC
  LEFT JOIN SINSTITUICAOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SINSTITUICAOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODFILIAL = SINSTITUICAOMEC.CODFILIAL
  LEFT JOIN SCOORDENADOR (NOLOCK)
	  ON SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	 AND SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
  LEFT JOIN PPESSOA AS COORDENADOR (NOLOCK)
      ON COORDENADOR.CODIGO = SCOORDENADOR.CODPESSOA          
  LEFT JOIN SINSTITUICAO (NOLOCK)
      ON SHABILITACAOALUNO.CODINSTDIPLOMA = SINSTITUICAO.CODINST

  LEFT JOIN
             (SELECT CODCOLIGADA,
                     CODAUTORIZACAO,
                     IDINSTITUICAOMEC,
                     CODFILIAL,
                     CODTIPOCURSO,
                     MODALIDADE,
                     ATOREGULATORIO,
                     TIPOAUTORIZ,
                     NRAUTORIZ,
                     DTAUTORIZ,
                     RECAUTORIZ,
                     COALESCE(LOCALAUTORIZ, 'DOU') LOCALAUTORIZ,
                     NUMPUBLICACAO,
                     DTPUBLICACAO,
                     SECAOPUBLICACAO,
                     PAGINAPUBLICACAO
              FROM SAUTORIZACAOFILIAL (NOLOCK)
              WHERE CODAUTORIZACAO = (SELECT MAX(AUX.CODAUTORIZACAO)
                                      FROM SAUTORIZACAOFILIAL AUX (NOLOCK)
                                      WHERE AUX.CODCOLIGADA = SAUTORIZACAOFILIAL.CODCOLIGADA
                                        AND AUX.IDINSTITUICAOMEC = SAUTORIZACAOFILIAL.IDINSTITUICAOMEC)) SAUTORIZACAOFILIAL
             ON (SAUTORIZACAOFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
             AND SAUTORIZACAOFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)      
WHERE 
SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA_N
AND SHABILITACAOALUNO.RA = :RA_S
and SHABILITACAOALUNO.DTCONCLUSAOCURSO IS NOT NULL";14217;;;;06/12/2021;raphael.muzy;0;1;1;1;;;;;ebce18f0-ee35-4e1f-9fdc-752409350d84;;;-26653;raphael.muzy;28/09/2021;raphael.muzy;06/12/2021;
S;IP99DIP.1;DIPLOMA UNIVERSIDADE;"/*DIPLOMA SUPERIOR IES UNIVERSIDADE PORTARIA 1095: expedidora igual à registradora*/
SELECT 
  SALUNO.CODCOLIGADA,  
  SALUNO.RA,
  SALUNO.CODTIPOCURSO,
  STIPOCURSO.NOME NIVELENSINO,
  PPESSOA.NOME NOMEALUNO,    
  CONVERT(VARCHAR,PPESSOA.DTNASCIMENTO,103) DTNASCIMENTO,
  PPESSOAPAI.NOME NOMEPAI,           
  PPESSOAMAE.NOME NOMEMAE,
  PPESSOA.PAIS PAISALUNO,  
  PPESSOA.NATURALIDADE,
  SMODALIDADECURSO.DESCRICAO AS 'NOMEMODALIDADE',
  PPESSOA.NACIONALIDADE,
  PCODNACAO.DESCRICAO NOMENACIONALIDADE,
  PPESSOA.CARTIDENTIDADE, 
  PPESSOA.ORGEMISSORIDENT,
  PPESSOA.UFCARTIDENT,
  PPESSOA.CPF,    
  CAST(CAST(SGRADE.CARGAHORARIA AS INT) AS VARCHAR) AS 'CARGAHORARIA',
  SCURSO.NOME NOMECURSO, 
  SCURSO.CODCURSO,
  SCURSO.DECRETO,
  SCURSO.REGCONTRATO,
  SCURSO.CODCURINEP, 
  
  SHABILITACAOFILIAL.CODHABILITACAO,
  SHABILITACAOFILIAL.DECRETOCURSO,
  SHABILITACAOFILIAL.DESCRICAOCURSO,
  SHABILITACAOFILIAL.DECRETOHABILITACAO,
  SHABILITACAOFILIAL.DESCRICAOHABILITACAO,
  SHABILITACAOFILIAL.IDCURSOMEC,
  SHABILITACAOFILIAL.IDHABILITACAOFILIAL, 
  
  SHABILITACAO.NOME HABILITACAO,  
  SHABILITACAO.CODHABINEP,
  SHABILITACAO.CODTIPOHABILITACAO,
  
  SHABILITACAOALUNO.CODINST,
  SHABILITACAOALUNO.CODINSTDIPLOMA,
  SHABILITACAOALUNO.CODINSTDESTINO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCONCLUSAOCURSO, 103) DTCONCLUSAOCURSO, 
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTCOLACAOGRAU, 103) DTCOLACAOGRAU,  
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTINGRESSO, 103) DTINGRESSO,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISDIPLOMA, 103) DTEMISDIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTREGISTRODIPLOMA, 103) DTREGISTRODIPLOMA,
  CONVERT(VARCHAR,SHABILITACAOALUNO.DTEMISSAODOU, 103) DTEMISSAODOU,
  SHABILITACAOALUNO.REGISTROCONCLUSAO,
  SHABILITACAOALUNO.LIVROREGISTRO, 
  SHABILITACAOALUNO.PROCESSOREGISTRO,
  SHABILITACAOALUNO.PAGINAREGISTRO,
  
  SAUTORIZACAOCURSO.ATOREGULATORIO,  
  SAUTORIZACAOCURSO.NUMRESOLUCAO,
  CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRESOLUCAO, 103) DTRESOLUCAO,
  SAUTORIZACAOCURSO.NUMPUBLICACAO,
  SAUTORIZACAOCURSO.PAGINAPUBLICACAO,
  SAUTORIZACAOCURSO.SECAOPUBLICACAO,  
  SAUTORIZACAOCURSO.TIPOAUTORIZACAO,  
            
  CASE WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOCURSO.TIPOAUTORIZACAO = '3' THEN 'Ata'
   ELSE 'PENDENTE' END DESCRICAOTIPOAUTORIZACAO, 

  CASE WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '1' THEN 'Autorizado'
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '2' THEN 'Reconhecido' 
  WHEN SAUTORIZACAOCURSO.ATOREGULATORIO = '3' THEN 'Renovação de Reconhecimento'
   ELSE 'PENDENTE' END DESCRICAOATOREGULATORIO,     
   	
  COALESCE(SAUTORIZACAOCURSO.LOCALAUTORIZ, 'DOU') LOCALAUTORIZ, 	
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOURECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTDOUAUTORIZACAO,103)) DTDOURECONHECIMENTO,
  COALESCE(SAUTORIZACAOCURSO.PORTRECONHECIMENTO, SAUTORIZACAOCURSO.PORTAUTORIZACAO)   PORTRECONHECIMENTO,  
  COALESCE(CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTRECONHECIMENTO,103), CONVERT(VARCHAR,SAUTORIZACAOCURSO.DTAUTORIZACAO,103)) DTRECONHECIMENTO,
   	
  SINSTITUICAO.NOME NOMEREGISTRADORA,
  SINSTITUICAO.CODEMEC CODEMECREGISTRADORA,
  SINSTITUICAO.DIRETOR DIRETORREGISTRADORA,
   
  GIMAGEM.IMAGEM IMAGEMFILIAL,   
  GFILIAL.CODFILIAL,
  GFILIAL.NOME NOMEFILIAL,
  GFILIAL.CGC CGCFILIAL,
  GFILIAL.CIDADE +' - ' + GFILIAL.ESTADO CIDADEFILIAL,
  GFILIAL.RUA RUAFILIAL,
  GFILIAL.COMPLEMENTO COMPLEMENTOFILIAL,
  GFILIAL.BAIRRO BAIRROFILIAL,
  GFILIAL.NUMERO NUMEROFILIAL,
  GFILIAL.ESTADO ESTADOFILIAL,
  GFILIAL.PAIS PAISFILIAL,
  GFILIAL.CEP CEPFILIAL,
  GFILIAL.IDIMAGEM IDIMAGEMFILIAL,
  
  PPESSOADIRECAO.NOME NOMEDIRETORFILIAL,
  GDIR.IMAGEM ASSINATURADIRETORFILIAL,
  
  PPESSOASECRETARIO.NOME NOMESEC1FILIAL,
  GSEC1.IMAGEM ASSINATURASEC1FILIAL, 
  
  SAUTORIZACAOFILIAL.MODALIDADE IES_MODALIDADE,
  
  CASE WHEN SAUTORIZACAOFILIAL.ATOREGULATORIO = '1' THEN 'Credenciada'
  ELSE 'Recredenciada' END IES_ATOREGULATORIO,
  
  CASE WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '0' THEN 'Decreto'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '1' THEN 'Portaria'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '2' THEN 'Resolução'
  WHEN SAUTORIZACAOFILIAL.TIPOAUTORIZ = '3' THEN 'Ata' END IES_TIPOAUTORIZ,
  
  SAUTORIZACAOFILIAL.NRAUTORIZ IES_NRAUTORIZ,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTAUTORIZ, 103) IES_DTAUTORIZ,
  SAUTORIZACAOFILIAL.RECAUTORIZ IES_RECAUTORIZ,
  SAUTORIZACAOFILIAL.LOCALAUTORIZ IES_LOCALAUTORIZ,
  SAUTORIZACAOFILIAL.NUMPUBLICACAO IES_NUMPUBLICACAO,
  CONVERT(VARCHAR, SAUTORIZACAOFILIAL.DTPUBLICACAO, 103) IES_DTPUBLICACAO,
  SAUTORIZACAOFILIAL.SECAOPUBLICACAO IES_SECAOPUBLICACAO,
  SAUTORIZACAOFILIAL.PAGINAPUBLICACAO IES_PAGINAPUBLICACAO,
  CASE WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'M' THEN 'Bacharel'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'BACHARELADO' AND PPESSOA.SEXO = 'F' THEN 'Bacharela'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'M' THEN 'Licenciado'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LICENCIATURA' AND PPESSOA.SEXO = 'F' THEN 'Licenciada'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'M' THEN 'Tecnólogo'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'TECNÓLOGO' AND PPESSOA.SEXO = 'F' THEN 'Tecnóloga'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LATO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'LATO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Especialista'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'STRICTO SENSU' AND PPESSOA.SEXO = 'M' THEN 'Mestre'
	   WHEN UPPER(SMODALIDADECURSO.DESCRICAO) = 'STRICTO SENSU' AND PPESSOA.SEXO = 'F' THEN 'Mestra'
  END AS MODALIDADE,
  PPESSOA.SEXO,
  CASE WHEN PPESSOA.SEXO = 'M' then 'portador' else 'portadora' end as PORTADOR,
  CASE WHEN PPESSOA.SEXO = 'M' then 'nascido' else 'nascida' end as NASCIDO,
  CONVERT(VARCHAR(10),GETDATE(), 103) AS DATAATUAL,
  COORDENADOR.NOME AS NOMECOORDENADOR,
  CASE WHEN COORDENADOR.SEXO = 'M' then 'Coordenador' else 'Coordenadora' end as GENCOORDENADOR,
  PPESSOACOORDENADORREGDIP.NOME AS NOMECOORDENADORREGDIP,
  GETD.NOME AS NOMEESTADONATAL,
  ASSINSECRETARIO.IMAGEM AS ASSIN_SEC1,
  ASSINCOORDENADOR.IMAGEM AS ASSIN_COORD,
  ASSINDIRECAO.IMAGEM AS ASSIN_DIRETOR,
  case ppessoa.ESTADONATAL  when 'AC' then 'do'
							when 'AL' then 'do'
							when 'AM' then 'do'
							when 'AP' then 'do'
							when 'BA' then 'da'
							when 'CE' then 'do'
							when 'DF' then 'do'
							when 'ES' then 'do'
							when 'GO' then 'do'
							when 'MA' then 'do'
							when 'MG' then 'de'
							when 'MS' then 'do'
							when 'MT' then 'do'
							when 'PA' then 'do'
							when 'PB' then 'da'
							when 'PE' then 'de'
							when 'PI' then 'do'
							when 'PR' then 'do'
							when 'RJ' then 'do'
							when 'RN' then 'do'
							when 'RO' then 'de'
							when 'RR' then 'de'
							when 'RS' then 'do'
							when 'SC' then 'de'
							when 'SE' then 'de'
							when 'SP' then 'de'
							when 'TO' then 'do'
	end as prep_estado,
	ASSINAFONSO.IMAGEM AS ASSIN_AFONSO,
	PCORD.NOME AS 'COORDREGISTRO'
FROM SHABILITACAOFILIAL (NOLOCK) 
JOIN SHABILITACAOALUNO (NOLOCK)
      ON (SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
          AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  LEFT JOIN SAUTORIZACAOCURSO (NOLOCK)
      ON (SAUTORIZACAOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
      AND SAUTORIZACAOCURSO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
      AND SAUTORIZACAOCURSO.CODAUTORIZACURSO = (SELECT MAX(CODAUTORIZACURSO)
                                                FROM SAUTORIZACAOCURSO SAUTORIZACAOCURSO2 (NOLOCK)
                                                WHERE SAUTORIZACAOCURSO2.CODCOLIGADA = SAUTORIZACAOCURSO.CODCOLIGADA
                                                  AND SAUTORIZACAOCURSO2.IDHABILITACAOFILIAL = SAUTORIZACAOCURSO.IDHABILITACAOFILIAL))
  JOIN SALUNO (NOLOCK) 
      ON (SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA 
          AND SALUNO.RA = SHABILITACAOALUNO.RA)  
  JOIN PPESSOA (NOLOCK) 
      ON (PPESSOA.CODIGO = SALUNO.CODPESSOA)
  JOIN GETD (NOLOCK)
      ON (PPESSOA.ESTADONATAL = GETD.CODETD)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  LEFT JOIN PCODNACAO (NOLOCK)
    ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)      
  JOIN GFILIAL (NOLOCK) 
     ON (GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
         AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)        
    
  LEFT JOIN SFILIAL (NOLOCK)
      ON (GFILIAL.CODCOLIGADA = SFILIAL.CODCOLIGADA
          AND GFILIAL.CODFILIAL = SFILIAL.CODFILIAL)
  LEFT JOIN SDIRECAOFILIAL (NOLOCK)
      ON (SFILIAL.CODCOLIGADA = SDIRECAOFILIAL.CODCOLIGADA
          AND SFILIAL.CODFILIAL = SDIRECAOFILIAL.CODFILIAL)
 
  LEFT JOIN PPESSOA PPESSOADIRECAO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOA = PPESSOADIRECAO.CODIGO  )
  LEFT JOIN PPESSOA PPESSOASECRETARIO (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC1 = PPESSOASECRETARIO.CODIGO  )    
  LEFT JOIN PPESSOA PPESSOACOORDENADORREGDIP (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC2 = PPESSOACOORDENADORREGDIP.CODIGO  ) 
  LEFT JOIN ZMDASSINATURAS ASSINSECRETARIO (NOLOCK)
      ON (PPESSOASECRETARIO.CODIGO = ASSINSECRETARIO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINDIRECAO (NOLOCK)
  	  ON (PPESSOADIRECAO.CODIGO = ASSINDIRECAO.CODPESSOA)
  LEFT JOIN ZMDASSINATURAS ASSINCOORDENADOR (NOLOCK)
  	  ON (PPESSOACOORDENADORREGDIP.CODIGO = ASSINDIRECAO.CODPESSOA)  	
  LEFT JOIN ZMDASSINATURAS ASSINAFONSO (NOLOCK) ON (ASSINAFONSO.CODPESSOA = 31472)	  
      
  LEFT JOIN GIMAGEM GDIR(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURA = GDIR.ID   
  LEFT JOIN GIMAGEM GSEC1(NOLOCK) ON SDIRECAOFILIAL.IDASSINATURASEC1 = GSEC1.ID 
  LEFT JOIN GIMAGEM (NOLOCK)     ON GFILIAL.IDIMAGEM = GIMAGEM.ID     
  
  JOIN STIPOCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA AND
        SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)        
  JOIN SHABILITACAO (NOLOCK) 
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO 
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN SGRADE (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO AND
          SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO AND
          SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE 
  JOIN SCURSO (NOLOCK) 
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
          AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  LEFT JOIN SMODALIDADECURSO (NOLOCK) 
      ON (SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA AND 
	      SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO)   
  /*JOIN SCURSOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.IDCURSOMEC  = SCURSOMEC.IDCURSOMEC*/
  LEFT JOIN SINSTITUICAOMEC (NOLOCK)
      ON SHABILITACAOFILIAL.CODCOLIGADA = SINSTITUICAOMEC.CODCOLIGADA AND
          SHABILITACAOFILIAL.CODFILIAL = SINSTITUICAOMEC.CODFILIAL
  LEFT JOIN SCOORDENADOR (NOLOCK)
	  ON SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	 AND SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
  LEFT JOIN PPESSOA AS COORDENADOR (NOLOCK)
      ON COORDENADOR.CODIGO = SCOORDENADOR.CODPESSOA          
  LEFT JOIN SINSTITUICAO (NOLOCK)
      ON SHABILITACAOALUNO.CODINSTDIPLOMA = SINSTITUICAO.CODINST

  LEFT JOIN
             (SELECT CODCOLIGADA,
                     CODAUTORIZACAO,
                     IDINSTITUICAOMEC,
                     CODFILIAL,
                     CODTIPOCURSO,
                     MODALIDADE,
                     ATOREGULATORIO,
                     TIPOAUTORIZ,
                     NRAUTORIZ,
                     DTAUTORIZ,
                     RECAUTORIZ,
                     COALESCE(LOCALAUTORIZ, 'DOU') LOCALAUTORIZ,
                     NUMPUBLICACAO,
                     DTPUBLICACAO,
                     SECAOPUBLICACAO,
                     PAGINAPUBLICACAO
              FROM SAUTORIZACAOFILIAL (NOLOCK)
              WHERE CODAUTORIZACAO = (SELECT MAX(AUX.CODAUTORIZACAO)
                                      FROM SAUTORIZACAOFILIAL AUX (NOLOCK)
                                      WHERE AUX.CODCOLIGADA = SAUTORIZACAOFILIAL.CODCOLIGADA
                                        AND AUX.IDINSTITUICAOMEC = SAUTORIZACAOFILIAL.IDINSTITUICAOMEC)) SAUTORIZACAOFILIAL
             ON (SAUTORIZACAOFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
             AND SAUTORIZACAOFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)  
             
LEFT JOIN SCERTIFICADO ON SCERTIFICADO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SCERTIFICADO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SCERTIFICADO.RA = SHABILITACAOALUNO.RA
LEFT JOIN SPARTICIPANTE ON SPARTICIPANTE.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SPARTICIPANTE.IDCERTIFICADO = SCERTIFICADO.IDCERTIFICADO
	AND SPARTICIPANTE.CODTIPOPART = 999
LEFT JOIN PPESSOA PCORD ON PCORD.CODIGO = SPARTICIPANTE.CODPESSOA

WHERE 
SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA_N
AND SHABILITACAOALUNO.RA = :RA_S
AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL_N
/*and SHABILITACAOALUNO.DTCONCLUSAOCURSO IS NOT NULL*/";14939;;;;02/08/2022;consultor1.totvs;0;1;1;1;;;;;ebce18f0-ee35-4e1f-9fdc-752409350d84;;;-9137;consultor1.totvs;19/07/2022;consultor1.totvs;02/08/2022;
S;PARAM.006;Cursos - FIltro por Parâmetro;"SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
  	AND SCURSO.CODTIPOCURSO = :Parametro_5
 	 
)
TABELA /*WHERE*/";224;;;;17/02/2021;mestre;0;1;1;1;;;;0;9d7946fd-3107-4054-8271-b6b928836edf;0;;-10628;mestre;17/02/2021;mestre;17/02/2021;0
S;PARAM.013;Tipo de Cartão de Ônibus;"SELECT DESCRICAO, CODCLIENTE FROM

(SELECT
  GCONSIST.CODCLIENTE,
  GCONSIST.DESCRICAO
 
 FROM
  GCONSIST (NOLOCK)
 
 WHERE	GCONSIST.APLICACAO = 'H'
	AND GCONSIST.CODTABELA = 'TIPCART'
)

TABELA /*WHERE*/";217;;;;05/01/2022;robson.canto;0;1;1;1;;;;0;70678c26-725b-486a-8b59-7335d509ca59;0;;-14432;robson.canto;05/01/2022;robson.canto;05/01/2022;0
S;PER.ALUNO.INGR01;PERMANENCIA DE ALUNO INGRESSANTE;"SELECT nomStatus,
       Count(*)
FROM   v_unasp_smatricpl v1 (NOLOCK)
WHERE  nomtipomatricula = 'rematricula'
       AND CODCURSO = :CODCURSO
       AND CODFILIAL = :CODFILIAL
       AND codperlet = :CODPERLET_REM
       AND EXISTS (SELECT NomStatus
                   FROM   v_unasp_smatricpl v2 (NOLOCK)
                   WHERE  codperlet = :CODPERLET_ING
                          AND nomtipomatricula = 'matricula'
                          AND v2.RA = v1.RA
                          AND v2.CODCURSO = v1.CODCURSO
                          AND v2.CODFILIAL = v1.CODFILIAl)
GROUP  BY NomStatus 
";616;;;;04/08/2022;gillead.goncalves;0;1;1;1;;;;1;04f0769c-160d-4698-95c9-197f1bd299d5;0;;-7378;gillead.goncalves;04/08/2022;gillead.goncalves;04/08/2022;0
S;Professor01;Professores por curso ;"select 
	DISTINCT
	CODPERLET Período,
	NomFilial Filial,
	CodCurso, 
	NomCurso Curso, 
	p.NOME Professor,
	p.sexo
	
	
from 
	v_unasp_STURMADISC td
	left join SPROFESSORTURMA pt on pt.CODCOLIGADA=td.CODCOLIGADA and pt.IDTURMADISC=td.IDTURMADISC
	left join SPROFESSOR prof on prof.CODCOLIGADA = pt.CODCOLIGADA and prof.CODPROF=pt.CODPROF
	left join PPESSOA p on p.CODIGO = prof.CODPESSOA
where 
	CODPERLET = :CODPERLET 


	
	";443;;;;13/05/2022;maik.souza;0;1;1;1;;;;0;dca7f8f9-b914-446b-8235-5ac7eb82e1dc;0;;30645;maik.souza;13/05/2022;maik.souza;13/05/2022;0
S;PSRELCOMP_2;Copia de PSRELCOMP_2;"SELECT DISTINCT
	s1.NOME,
	UPPER(s.NUMEROINSCRICAO) [NÚMERO DE INSCRIÇÃO],
	UPPER(s4.NOME) CURSO,
	UPPER(g.NOMEFANTASIA) CAMPUS,
	/*UPPER (s.status) STATUS,
	UPPER (s.idps) ID,*/
	ISNULL ((s1.CPF + ' - CPF'),(s1.NPASSAPORTE + ' - Passaporte')) [DOCUMENTO DE IDENTIFICAÇÃO],
	UPPER(s6.NOME) [TIPO DE AVALIAÇÃO],
	CASE WHEN s.status ='1' THEN  'https://institutoadventista118931.rm.cloudtotvs.com.br/Corpore.Net/Source/Tst-Avaliacao/RM.Tst.Provas/Public/TstNewMain.aspx?codigo='
+ CAST(s.NUMEROINSCRICAO AS VARCHAR(132) )
	ELSE  'PENDENTE'  
	END [PGTO]

FROM 
	SPSINSCRICAOAREAOFERTADA s
	INNER JOIN SPSUSUARIO s1 ON s.CODUSUARIOPS = s1.CODUSUARIOPS
	INNER JOIN SPSOPCAOINSCRITO s2 ON s.CODCOLIGADA = s2.CODCOLIGADA AND s.IDPS = s2.IDPS AND s.NUMEROINSCRICAO = s2.NUMEROINSCRICAO
	INNER JOIN SPSAREAOFERTADA s3 ON s2.CODCOLIGADA = s3.CODCOLIGADA AND s2.IDPS = s3.IDPS AND s2.IDAREAINTERESSE = s3.IDAREAINTERESSE
	INNER JOIN SPSAREAINTERESSE s4 ON s3.IDAREAINTERESSE = s4.IDAREAINTERESSE
	INNER JOIN SPSPROCESSOSELETIVO s5 ON s.IDPS=s5.IDPS
	INNER JOIN GFILIAL g ON s5.CODFILIALLAN=g.CODFILIAL
	INNER JOIN SPSFORMAINSCRICAOPS s6 ON s.IDFORMAINSCRICAO=s6.IDFORMAINSCRICAO AND s.IDPS = S6.IDPS
	LEFT JOIN PPESSOA S7 ON  s1.CPF = s7.CPF
	LEFT JOIN SALUNO s8 ON s7.CODIGO = s8.CODPESSOA
WHERE
	s.NUMEROINSCRICAO = :NUMEROINSCRICAO1
	AND s.IDPS = :IDPS1
";1375;;;;12/05/2021;mestre;0;1;1;1;;;;0;39d63916-8c9b-492e-b703-6bec4227305a;0;;-20029;mestre;12/05/2021;mestre;12/05/2021;0
S;RB;Consultas Rubeus;"SELECT
	*
FROM
	SPSOPCAOINSCRITO
WHERE
	IDPS = 132
	AND ULTIMAETAPA = 2
	AND STATUS = 3";94;;;;16/11/2022;crmrubeus;0;1;1;1;;;;0;66cc1f69-15c8-4377-b6fe-285ee91457b7;0;;12319;wsrubeus;27/09/2021;crmrubeus;16/11/2022;0
S;RB.AUX;Consultas Auxiliares Rubeus;"SELECT CONVERT(VARCHAR(MAX),RECCREATEDON) FROM SPSAREAOFERTADA
WHERE
IDPS = 120";81;;;;16/05/2022;wsrubeus;0;1;1;1;;;;0;66cc1f69-15c8-4377-b6fe-285ee91457b7;0;;3723;wsrubeus;28/10/2021;wsrubeus;16/05/2022;0
S;RB.AUX.001;Consultas Rubeus - Cubo análse de entrega de documentos Matricula;"SELECT 
	SALUNO.NOME 																				 AS 'Candidato',
	SPSPROCESSOSELETIVO.NOME 																	 AS 'Processo seletvo',
	SDOCUMENTO.DESCRICAO 																		 AS 'Documento',
	SALUNO.RA 																					 AS 'RA',
	SPSAREAINTERESSE.NOME 																		 AS 'Curso',
	SPLETIVO.CODPERLET,
	CASE 
		WHEN SDOCALUNO.STATUS = 0 THEN 'Pendente envio'
		WHEN SDOCALUNO.STATUS = 1 THEN 'Em analise'
		WHEN SDOCALUNO.STATUS = 2 THEN 'Pendente envio (Recusado)'		
		WHEN SDOCALUNO.STATUS = 3 THEN 'Documentos entregues'
	END AS 'Status envio'
FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS	
	
LEFT JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS	
	
/**CASO CANDIDATO TENHA MAIS DE UM RA PEGAR O ULTIMO**/
OUTER APPLY 
		(
		SELECT TOP 1 
			MAX(SALUNO.RECCREATEDON) AS DATACRIACAO,
			SALUNO.RA,
			PPESSOA.CPF,
			PPESSOA.NOME,
			SALUNO.CODCOLIGADA
		FROM SALUNO(NOLOCK)
			INNER JOIN PPESSOA(NOLOCK)
				ON SALUNO.CODPESSOA = PPESSOA.CODIGO
				AND PPESSOA.CPF = SPSUSUARIO.CPF
		GROUP BY SALUNO.RECCREATEDON,SALUNO.RA,PPESSOA.CPF,SALUNO.CODCOLIGADA,PPESSOA.NOME
		ORDER BY SALUNO.RECCREATEDON DESC) AS SALUNO
		
INNER JOIN SPSAREAINTERESSE (NOLOCK)   
   ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE  
   
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
    ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
    
INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	
INNER JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SALUNO.RA
	AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SCONTRATO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.CODSTATUS = SPSPROCSELCOMPL.MAT_PLETIVO
	
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	
INNER JOIN SDOCEXIGIDOS(NOLOCK)
	ON SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SDOCEXIGIDOS.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL	
	
INNER JOIN  SDOCALUNO (NOLOCK) 
	ON SDOCALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SDOCALUNO.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCALUNO.RA = SCONTRATO.RA
	AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
	
INNER JOIN SDOCUMENTO (NOLOCK)	
	ON SDOCUMENTO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO

LEFT JOIN SMOTIVOREJEICAODOCUMENTO(NOLOCK)
	ON SMOTIVOREJEICAODOCUMENTO.CODCOLIGADA = SDOCALUNO.CODCOLIGADA
	AND SMOTIVOREJEICAODOCUMENTO.IDMOTIVOREJEICAODOCUMENTO = SDOCALUNO.IDMOTIVOREJEICAODOCUMENTO	
	
LEFT JOIN SARQUIVOS (NOLOCK) ON
	SARQUIVOS.CHAVERM =  CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)

WHERE SPSOPCAOINSCRITO.RECCREATEDBY LIKE '%RUBEUS%'	
/**/
AND SPLETIVO.CODPERLET LIKE :CODPERLET + '%'";3923;;;;26/07/2022;consultor1.totvs;0;1;1;1;;;;0;66cc1f69-15c8-4377-b6fe-285ee91457b7;0;;-21399;wsrubeus;28/10/2021;consultor1.totvs;26/07/2022;0
S;RB.AUX.002;Consultas Rubeus - Cubo análse de entrega de documentos Inscrição;"SELECT DISTINCT 
	SPSUSUARIO.NOME                                                                       		 AS 'Canddato',
	SPSPROCESSOSELETIVO.NOME                              										 AS 'Processo seletvo',
	SDOCUMENTO.DESCRICAO 																		 AS 'Documento',
	'' 																							 AS 'RA',
	SPSAREAINTERESSE.NOME 																		 AS 'Curso',
	CASE 
		/** PENDENTE ENVIO **/
		WHEN SPSARQUIVOSCANDIDATO.NOMEARQUIVO IS NULL AND ISNULL(SPSDOCUMENTOENTREGUE.ENTREGUE,'F') = 'F' THEN 'Pendente envio'
		/** PENDENTE ENVIO (RECUSADO) **/
		WHEN SPSARQUIVOSCANDIDATO.NOMEARQUIVO IS NOT NULL AND ISNULL(SPSDOCUMENTOENTREGUE.ENTREGUE,'F') = 'F' AND SPSDOCUMENTOENTREGUE.MOTIVO IS NOT NULL THEN 'Pendente envio (Recusado)'
		/** EM ANALISE **/
		WHEN SPSARQUIVOSCANDIDATO.NOMEARQUIVO IS NOT NULL AND ISNULL(SPSDOCUMENTOENTREGUE.ENTREGUE,'F') = 'F' AND ISNULL(SPSDOCUMENTOENTREGUE.MOTIVO,'') = '' THEN 'Em analise'
		/** ENTREGUES **/
		WHEN SPSARQUIVOSCANDIDATO.NOMEARQUIVO IS NOT NULL AND SPSDOCUMENTOENTREGUE.ENTREGUE = 'T' AND ISNULL(SPSDOCUMENTOENTREGUE.MOTIVO,'') = '' THEN 'Documentos entregues'
	END AS 'Status envio'
FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO(NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSUSUARIO.NOME NOT LIKE '%TESTE%'
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SPSDOCUMENTOEXIGIDO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE
		
INNER JOIN SDOCUMENTO (NOLOCK) 
	ON SDOCUMENTO.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
	  
INNER JOIN SPSDOCUMENTOENTREGUE (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSDOCUMENTOENTREGUE.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO

INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS

LEFT JOIN SPSARQUIVOSCANDIDATO (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSARQUIVOSCANDIDATO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO
	AND SPSARQUIVOSCANDIDATO.NOMEARQUIVO LIKE '%' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.IDPS) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO)  + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODDOCUMENTO) + '.%'	
	
WHERE DATEDIFF(DAY, SPSOPCAOINSCRITO.RECMODIFIEDON, GETDATE()) < 10
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSOPCAOINSCRITO.RECCREATEDBY LIKE '%RUBEUS%'";3173;;;;01/11/2021;wsrubeus;0;1;1;1;;;;0;66cc1f69-15c8-4377-b6fe-285ee91457b7;0;;-5709;wsrubeus;01/11/2021;wsrubeus;01/11/2021;0
S;RB.FG;## Consultas utilizadas em fórmulas Globais ##;;0;;;;11/10/2021;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;7326;wsrubeus;11/10/2021;wsrubeus;11/10/2021;0
S;RB.FG.001;Busca nota do candidato - Prova online;"SELECT 
	ISNULL(SUM(CONVERT(INT, NOTAOBTIDA)),9999) AS NOTA
FROM SPSOPCAOINSCRITO(NOLOCK) 
INNER JOIN SPSETAPAAREAOFERTADA  (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA 
	AND SPSOPCAOINSCRITO.IDPS = SPSETAPAAREAOFERTADA.IDPS 
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE 

INNER JOIN SPSHORARIOETAPAAREAOFERTADA (NOLOCK) 
	ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA 
	AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE 
	AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS 
	AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA 

INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
	ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS 
	AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE 
	AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO 

INNER JOIN DBO.SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
	ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSPROVAETAPAAREA.IDPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADAPROVA = SPSPROVAETAPAAREA.CODCOLIGADAPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO
	AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN BHISTORICO(NOLOCK)
	ON BHISTORICO.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND BHISTORICO.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND BHISTORICO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BHISTORICO.ID

WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI";2225;;;;19/10/2021;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;-1308;wsrubeus;11/10/2021;wsrubeus;19/10/2021;0
S;RB.FG.002;Consulta utilizada para classificação de Teologia - 1º FASE;"SELECT 
	ISNULL(SUM(CONVERT(INT, NOTAOBTIDA)),9999) AS NOTA
FROM SPSOPCAOINSCRITO(NOLOCK) 
INNER JOIN SPSETAPAAREAOFERTADA  (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA 
	AND SPSOPCAOINSCRITO.IDPS = SPSETAPAAREAOFERTADA.IDPS 
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
	AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 1

INNER JOIN SPSHORARIOETAPAAREAOFERTADA (NOLOCK) 
	ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA 
	AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE 
	AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS 
	AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA 

INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
	ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS 
	AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE 
	AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO 

INNER JOIN DBO.SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
	ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSPROVAETAPAAREA.IDPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADAPROVA = SPSPROVAETAPAAREA.CODCOLIGADAPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO
	AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN BHISTORICO(NOLOCK)
	ON BHISTORICO.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND BHISTORICO.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND BHISTORICO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BHISTORICO.ID

WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI";2266;;;;25/04/2022;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;31714;wsrubeus;16/10/2021;wsrubeus;25/04/2022;0
S;RB.FG.003;Consulta utilizada para classificação de Teologia - 2º FASE;"SELECT 
	ISNULL(SUM(CONVERT(INT, NOTAOBTIDA)),9999) AS NOTA
FROM SPSOPCAOINSCRITO(NOLOCK) 
INNER JOIN SPSETAPAAREAOFERTADA  (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA 
	AND SPSOPCAOINSCRITO.IDPS = SPSETAPAAREAOFERTADA.IDPS 
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
	AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 3

INNER JOIN SPSHORARIOETAPAAREAOFERTADA (NOLOCK) 
	ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA 
	AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE 
	AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS 
	AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA 

INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
	ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS 
	AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE 
	AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO 

INNER JOIN DBO.SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
	ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSPROVAETAPAAREA.IDPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADAPROVA = SPSPROVAETAPAAREA.CODCOLIGADAPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO
	AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN BHISTORICO(NOLOCK)
	ON BHISTORICO.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND BHISTORICO.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND BHISTORICO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BHISTORICO.ID

WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI";2266;;;;18/10/2021;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;-21079;wsrubeus;17/10/2021;wsrubeus;18/10/2021;0
S;RB.FG.004;Consulta utilizada para classificação de Teologia - 2º FASE - ENTREVISTA;"SELECT 
	ISNULL(SUM(CONVERT(INT, NOTAOBTIDA)),0) AS NOTA
FROM SPSOPCAOINSCRITO(NOLOCK) 
INNER JOIN SPSETAPAAREAOFERTADA  (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA 
	AND SPSOPCAOINSCRITO.IDPS = SPSETAPAAREAOFERTADA.IDPS 
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
	AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 4

INNER JOIN SPSHORARIOETAPAAREAOFERTADA (NOLOCK) 
	ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA 
	AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE 
	AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS 
	AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA 

INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
	ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS 
	AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE 
	AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO 

INNER JOIN DBO.SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
	ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSPROVAETAPAAREA.IDPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADAPROVA = SPSPROVAETAPAAREA.CODCOLIGADAPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO
	AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN BHISTORICO(NOLOCK)
	ON BHISTORICO.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND BHISTORICO.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND BHISTORICO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BHISTORICO.ID

WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI";2263;;;;22/11/2021;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;9640;wsrubeus;17/10/2021;wsrubeus;22/11/2021;0
S;RB.FG.004.1;Consulta utilizada para classificação de Teologia ENEM- 2º FASE - ENTREVISTA;"SELECT 
	ISNULL(SUM(CONVERT(INT, NOTAOBTIDA)),0) AS NOTA
FROM SPSOPCAOINSCRITO(NOLOCK) 
INNER JOIN SPSETAPAAREAOFERTADA  (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA 
	AND SPSOPCAOINSCRITO.IDPS = SPSETAPAAREAOFERTADA.IDPS 
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
	AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 3

INNER JOIN SPSHORARIOETAPAAREAOFERTADA (NOLOCK) 
	ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA 
	AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE 
	AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS 
	AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA 

INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
	ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS 
	AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE 
	AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO 

INNER JOIN DBO.SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
	ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSPROVAETAPAAREA.IDPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADAPROVA = SPSPROVAETAPAAREA.CODCOLIGADAPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO
	AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN BHISTORICO(NOLOCK)
	ON BHISTORICO.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND BHISTORICO.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND BHISTORICO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BHISTORICO.ID

WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI";2263;;;;23/11/2021;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;11832;wsrubeus;23/11/2021;wsrubeus;23/11/2021;0
S;RB.FG.005;Consultar nacionalidade do candidato;"SELECT 
	CANDIDATO.CODPAIS AS CODPAIS
FROM SPSOPCAOINSCRITO(NOLOCK) 
CROSS APPLY(
	SELECT
		SPSUSUARIO.IDPAIS,
		CODPAIS
	FROM SPSUSUARIO(NOLOCK)
	INNER JOIN GPAIS(NOLOCK)
		ON GPAIS.IDPAIS = SPSUSUARIO.IDPAIS
	WHERE CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS) AS CANDIDATO
WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI";434;;;;17/10/2021;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;23255;wsrubeus;17/10/2021;wsrubeus;17/10/2021;0
S;RB.FG.006;Consulta excedente Entrevista 2º Fase;"/**
	- FUNÇÃO: TRAZER QUANTIDADE DE CANDIDATOS BRA APROVADOS (VALIDAÇÃO DO NUMERO DE VAGAS)
**/
SELECT 
	CASE 
		WHEN ISNULL(SPSINSCAREAOFERTACOMPL.EXCEDENTE,'F') = 'F' THEN 0
		WHEN SPSINSCAREAOFERTACOMPL.EXCEDENTE = 'T' THEN 1 
	END  AS EXCEDENTE
FROM SPSOPCAOINSCRITO(NOLOCK) 
INNER JOIN SPSINSCAREAOFERTACOMPL(NOLOCK)
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA 
	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO 
	
WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI
";695;;;;27/01/2022;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;-24973;wsrubeus;17/10/2021;wsrubeus;27/01/2022;0
S;RB.FG.007;Consulta quantidade de classificados - 1º FASE 2º Etapa ESTR;"/**
	- FUNÇÃO: TRAZER QUANTIDADE DE CANDIDATOS ESTRANGEIROS APROVADOS (VALIDAÇÃO DO NUMERO DE VAGAS)
**/
SELECT 
	COUNT(SPSOPCAOINSCRITO.NUMEROINSCRICAO) AS QTD
FROM SPSOPCAOINSCRITO(NOLOCK) 
INNER JOIN SPSETAPAAREAOFERTADA  (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA 
	AND SPSOPCAOINSCRITO.IDPS = SPSETAPAAREAOFERTADA.IDPS 
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
	AND SPSETAPAAREAOFERTADA.ORDEMETAPA >= 2
CROSS APPLY(
	SELECT
		SPSUSUARIO.IDPAIS,
		CODPAIS
	FROM SPSUSUARIO(NOLOCK)
	INNER JOIN GPAIS(NOLOCK)
		ON GPAIS.IDPAIS = SPSUSUARIO.IDPAIS
		AND GPAIS.CODPAIS <> 'BRA'
	WHERE CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS) AS CANDIDATO	
WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI
AND SPSOPCAOINSCRITO.STATUS = 16
";865;;;;18/10/2021;wsrubeus;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;4454;wsrubeus;17/10/2021;wsrubeus;18/10/2021;0
S;RB.FG.008;Verificar se o candidato tem notas lançadas - ENEM;"SELECT 
	/*CASE WHEN ISNULL(ENEMNOTAREDACAO,0) = 0 AND ISNULL(ENEMNOTAOBJETIVA,0) = 0 THEN 0 ELSE 1 END AS NOTA*/
	
		CASE WHEN ENEMNOTAREDACAO = 0 THEN 0 
		WHEN ENEMNOTAREDACAO IS NULL THEN 2
	ELSE 1 END AS NOTA
	/*Modificado em 22/03/2022 Nathan PVT - Modificado a consulta para verificar apenas redação candidatos do ENEM. Solicitado pela Bruna.*/
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK) 

WHERE SPSINSCRICAOAREAOFERTADA.IDPS = :FRM_SPPSIDPS
AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = :FRM_SPPSCOLI";572;;;;24/03/2022;consultor1.totvs;0;1;1;1;;;;0;1ca480ab-a802-499f-b7a6-8b1c4e8dc5c2;0;;13219;wsrubeus;28/10/2021;consultor1.totvs;24/03/2022;0
S;RB.FG.009;Aprovado na entrevista Teologia;"/**
	- FUNÇÃO: TRAZER QUANTIDADE DE CANDIDATOS BRA APROVADOS (VALIDAÇÃO DO NUMERO DE VAGAS)
**/
SELECT 
	CASE 
		WHEN ISNULL(SPSINSCAREAOFERTACOMPL.ENTREVISTA,'F') = 'F' THEN 0
		WHEN SPSINSCAREAOFERTACOMPL.ENTREVISTA = 'T' THEN 1 
	END  AS ENTREVISTA
FROM SPSOPCAOINSCRITO(NOLOCK) 
INNER JOIN SPSINSCAREAOFERTACOMPL(NOLOCK)
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA 
	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO 
	
WHERE SPSOPCAOINSCRITO.IDPS = :FRM_SPPSIDPS
AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :FRM_SPPSNUMI
AND SPSOPCAOINSCRITO.CODCOLIGADA = :FRM_SPPSCOLI
";698;;;;05/09/2022;wsrubeus;0;1;1;1;;;;0;15c10aae-9498-4be0-8128-a7b3b6a7c825;0;;-22960;wsrubeus;05/09/2022;wsrubeus;05/09/2022;0
S;RB.INT;## Consultas do Integrador Rubeus x TOTVS ##;;0;;;;27/09/2021;wsrubeus;0;1;1;1;;;;0;667c58e4-4817-4fc7-aafe-89067e45646e;0;;10714;wsrubeus;27/09/2021;wsrubeus;27/09/2021;0
S;RB.INT.CAP;Consultas do Rubeus para Captação de Alunos;SELECT * FROM RRPTREPORT(NOLOCK) WHERE ID = 119;47;;;;18/08/2022;wsrubeus;0;1;1;1;;;;0;1992f01e-7d15-4f41-af03-b5a9e04851b5;0;;20116;wsrubeus;27/09/2021;wsrubeus;18/08/2022;0
S;RB.INT.CAP.001;Envio/Atualização processo seletivo;"SELECT DISTINCT
	CONVERT(VARCHAR,SPSPROCESSOSELETIVO.CODCOLIGADA)+'-'+CONVERT(VARCHAR,SPSPROCESSOSELETIVO.IDPS) AS 'processo.codigo',
	SPSPROCESSOSELETIVO.NOME AS 'processo.nome',
	CONVERT(VARCHAR(10),SPSPROCESSOSELETIVO.DTINIINSCRICAO,120) AS 'processo.inicioInscricao',
	CONVERT(VARCHAR(10),SPSPROCESSOSELETIVO.DTFIMINSCRICAO,120) AS 'processo.terminoInscricao',
	CASE 
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%São Paulo%' THEN '1-1' /*São Paulo*/
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Engenheiro Coelho%' THEN '1-2' /*Engenheiro Coelho*/
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Teologia%' THEN '1-2' /*Engenheiro Coelho*/
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Hortolândia%' THEN '1-3' /*Hortolândia*/
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%ead%' THEN '1-4' /*EAD*/
	ELSE CONVERT(VARCHAR,SPSPROCESSOSELETIVO.CODCOLIGADA)+'-'+CONVERT(VARCHAR,SPSPROCESSOSELETIVO.CODFILIAL) END AS 'processo.codUnidade',
	IIF(SPSPROCESSOSELETIVO.NOME LIKE '%Pós%',3,4) as 'processo.codNivelEnsino'	
              
FROM SPSPROCESSOSELETIVO (NOLOCK)  
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS	
WHERE  
	(GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO OR GETDATE() < SPSPROCESSOSELETIVO.DTINIINSCRICAO)
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'

AND DATEDIFF(DAY,SPSPROCESSOSELETIVO.RECMODIFIEDON,GETDATE()) <= :DIAS";1508;;;;31/10/2022;crmrubeus;0;1;1;1;;;;0;92fbc531-f509-47a3-a97f-beae1865c519;;;16960;wsrubeus;27/09/2021;crmrubeus;31/10/2022;
S;RB.INT.CAP.002;Envio/Atualização cursos;"SELECT DISTINCT
	CONVERT(VARCHAR, SCURSO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SCURSO.CODCURSO) AS 'curso.codigo',
	SCURSO.NOME AS 'curso.nome',
	SCURSO.NOME AS 'curso.descricao',
	CASE 
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%ead%' THEN '1-4' /*EAD*/
	ELSE CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODFILIAL) END AS 'processo.codUnidade',
	IIF(SPSPROCESSOSELETIVO.NOME LIKE '%Pós%',3,4) AS 'processo.nivelEnsino'
	             
FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS      	

INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL          
	
INNER JOIN SCURSO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO 
	
INNER JOIN SGRADE (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE

INNER JOIN SHABILITACAOFILIALCAMPUS (NOLOCK)
	ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SMODALIDADECURSO (NOLOCK)
	ON SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA
	AND SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO
	
WHERE  
	(GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO OR GETDATE() < SPSPROCESSOSELETIVO.DTINIINSCRICAO)
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'";2151;;;;04/03/2022;wsrubeus;0;1;1;1;;;;0;80971d93-e590-4d81-a42c-b34f9689e1c4;;;-7129;wsrubeus;27/09/2021;wsrubeus;04/03/2022;
S;RB.INT.CAP.002.1;Envio/Atualização cursos;"SELECT DISTINCT
	CONVERT(VARCHAR, SCURSO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SCURSO.CODCURSO) AS 'curso.codigo',
	SCURSO.NOME AS 'curso.nome',
	SCURSO.NOME AS 'curso.descricao',
	CASE 
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%ead%' THEN '1-4' /*EAD*/
	ELSE CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODFILIAL) END AS 'processo.codUnidade',
	IIF(SPSPROCESSOSELETIVO.NOME LIKE '%Pós%',3,4) AS 'processo.nivelEnsino'
	             
FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS      	

INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL          
	
INNER JOIN SCURSO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO 
	
INNER JOIN SGRADE (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE

INNER JOIN SHABILITACAOFILIALCAMPUS (NOLOCK)
	ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SMODALIDADECURSO (NOLOCK)
	ON SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA
	AND SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO
	
WHERE  
	(GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO OR GETDATE() < SPSPROCESSOSELETIVO.DTINIINSCRICAO)
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'";2151;;;;04/03/2022;wsrubeus;0;1;1;1;;;;0;80971d93-e590-4d81-a42c-b34f9689e1c4;;;-7129;wsrubeus;04/03/2022;wsrubeus;04/03/2022;
S;RB.INT.CAP.003;Envio/Atualização ofertas de cursos;"SELECT DISTINCT 
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS,'-',SPSAREAOFERTADA.IDAREAINTERESSE)AS 'oferta.codOferta',
	CONCAT(SCURSO.NOME,' ',STURNO.NOME) AS 'oferta.nome',
	CONCAT(SCURSO.CODCOLIGADA,'-',SCURSO.CODCURSO) AS 'oferta.codCurso',
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODFILIAL) AS 'oferta.codUnidade',
	IIF(SPSPROCESSOSELETIVO.NOME LIKE '%Pós%',3,4) as 'oferta.codNivelEnsino',
	ISNULL(SCURSO.CURPRESDIST,'P') AS 'oferta.codModalidade',
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS) AS 'oferta.codProcessoSeletivo',
	SPSAREAOFERTADA.NUMMININSCRICOES AS 'oferta.vagasMinimas',
	SPSAREAOFERTADA.NUMEROVAGAS AS 'oferta.vagasMaximas',
	CONVERT(VARCHAR(10),SGRADE.DTINICIO, 120)  AS 'oferta.inicioCurso',
    CONVERT(VARCHAR(10),SGRADE.DTFIM,120) AS 'oferta.terminoCurso',
    CONVERT(VARCHAR(10),SHABILITACAOFILIALPL.DTINICIOALTERACAOPROGRAMA,120)  AS 'oferta.inicioMatricula',
    CONVERT(VARCHAR(10),SHABILITACAOFILIALPL.DTFIMALTERACAOPROGRAMA,120)  AS 'oferta.terminoMatricula',
    CONCAT(STRING_AGG(CONVERT(VARCHAR,CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SHABILITACAOFILIALCAMPUS.CODCAMPUS)), '|;|'), '|;|') AS 'oferta.codLocalOferta'
 
FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS

INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SHABILITACAOFILIALCAMPUS (NOLOCK)
	ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPLETIVO.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
	AND SPLETIVO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
	AND SPLETIVO.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)

INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET

INNER JOIN STURNO(NOLOCK)
	ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
	
INNER JOIN SCURSO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO 
	
INNER JOIN SGRADE (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE
	
WHERE  
	(GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO OR GETDATE() < SPSPROCESSOSELETIVO.DTINIINSCRICAO)
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
AND CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS,'-',SPSAREAOFERTADA.IDAREAINTERESSE) = '1-124-476'
GROUP BY
	SPSPROCESSOSELETIVO.CODCOLIGADA,
	SPSPROCESSOSELETIVO.IDPS,
	SPSAREAOFERTADA.IDAREAINTERESSE,
	SCURSO.NOME, 
	STURNO.NOME,
	SCURSO.CODCOLIGADA, 
	SCURSO.CODCURSO,
	SPSPROCESSOSELETIVO.CODCOLIGADA,
	SHABILITACAOFILIAL.CODFILIAL,
	SPSPROCESSOSELETIVO.NOME,
	SCURSO.CURPRESDIST,
	SPSAREAOFERTADA.NUMMININSCRICOES,
	SPSAREAOFERTADA.NUMEROVAGAS,
	SGRADE.DTINICIO,
    SGRADE.DTFIM,
    SHABILITACAOFILIALPL.DTINICIOALTERACAOPROGRAMA,
    SHABILITACAOFILIALPL.DTFIMALTERACAOPROGRAMA";4127;;;;09/11/2022;shift;0;1;1;1;;;;0;aff03f30-faad-4e23-9597-8b39005c5cc8;;;28505;wsrubeus;27/09/2021;shift;09/11/2022;
S;RB.INT.CAP.004;Envio/Atualização ofertas de cursos -SEMPS;"SELECT DISTINCT
	CASE 
		WHEN SHABILITACAOFILIAL.CODFILIAL = 1 THEN '1-1' /*São Paulo*/
		WHEN SHABILITACAOFILIAL.CODFILIAL = 2 THEN '1-2' /*Engenheiro Coelho*/
		WHEN SHABILITACAOFILIAL.CODFILIAL = 3 THEN '1-3' /*Hortolândia*/
		WHEN SHABILITACAOFILIAL.CODFILIAL = 4 THEN '1-4' /*EAD*/
	END AS 'oferta.codUnidade',
	IIF(SHABILITACAOFILIAL.CODTIPOCURSO = 1,4,3) as 'oferta.codNivelEnsino',
	CASE 
		WHEN SHABILITACAOFILIAL.CODFILIAL = 1 THEN '1-1' /*São Paulo*/
		WHEN SHABILITACAOFILIAL.CODFILIAL = 2 THEN '1-2' /*Engenheiro Coelho*/
		WHEN SHABILITACAOFILIAL.CODFILIAL = 3 THEN '1-3' /*Hortolândia*/
		WHEN SHABILITACAOFILIAL.CODFILIAL = 4 THEN '1-4' /*EAD*/
	END AS 'oferta.codLocalOferta',
	CONCAT(SCURSO.CODCOLIGADA,'-', SCURSO.CODCURSO)   AS 'oferta.codCurso',                                   
	CONCAT(SCURSO.CODCOLIGADA,'-', SCURSO.CODCURSO) + ' -SEMPS'  AS 'oferta.codOferta',
	SCURSO.NOME +' - SEM PS' AS 'oferta.nome',
	SMODALIDADECURSO.DESCRICAO  AS 'oferta.complemento',
	ISNULL(SCURSO.CURPRESDIST,'P') AS 'oferta.codModalidade',
	NULL AS 'oferta.vagasMinimas',
	NULL AS 'oferta.vagasMaximas',
	NULL AS 'oferta.inicioCurso',
	NULL AS 'oferta.terminoCurso',
	NULL AS 'oferta.inicioMatricula',
	NULL AS 'oferta.terminoMatricula'
FROM SCURSO(NOLOCK)
    INNER JOIN SHABILITACAOFILIAL(NOLOCK)
      ON SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
      AND SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
  INNER JOIN SMODALIDADECURSO(NOLOCK)
    ON SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO
    AND SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA
WHERE DATEDIFF(DAY, SHABILITACAOFILIAL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SHABILITACAOFILIAL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL
    
";1782;;;;27/09/2021;wsrubeus;0;1;1;1;;;;0;aff03f30-faad-4e23-9597-8b39005c5cc8;;;21035;wsrubeus;27/09/2021;wsrubeus;27/09/2021;
S;RB.INT.CAP.005;Envio/Atualização de cursos -SEMPS;"SELECT DISTINCT
	CONVERT(VARCHAR, SCURSO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SCURSO.CODCURSO) AS 'curso.codigo',
	SCURSO.NOME AS 'curso.nome',
	SCURSO.NOME AS 'curso.descricao'
FROM SCURSO(NOLOCK)
    INNER JOIN SHABILITACAOFILIAL(NOLOCK)
      ON SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
      AND SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
  INNER JOIN SMODALIDADECURSO(NOLOCK)
    ON SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO
    AND SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA
WHERE DATEDIFF(DAY, SHABILITACAOFILIAL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SHABILITACAOFILIAL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL";691;;;;27/09/2021;wsrubeus;0;1;1;1;;;;0;aff03f30-faad-4e23-9597-8b39005c5cc8;;;-8513;wsrubeus;27/09/2021;wsrubeus;27/09/2021;
S;RB.INT.CAP.006;consulta dados candidatos em chamada - Evento convocado;"SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                        AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa'
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.STATUS = 5
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS		

WHERE DATEDIFF(DAY, SPSINSCRICAOAREAOFERTADA.RECMODIFIEDON, GETDATE()) <=:DIAS
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'";1563;;;;13/01/2022;wsrubeus;0;1;1;1;;;;0;5d1b96a1-6298-4729-856a-0c355f48daf2;;;29646;wsrubeus;04/10/2021;wsrubeus;13/01/2022;
S;RB.INT.CAP.007;##### Consulta matriculados - Evento matriculado;"SELECT DISTINCT
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDAREAINTERESSE) AS CODOFERTA,
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) AS CODPROCESSOSELETIVO,
	SPSOPCAOINSCRITO.CODUSUARIOPS AS CODPESSOA,
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS MOMENTO,
	'1' AS FILIAL,
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS CODCURSO,
	CASE
		WHEN CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCURSO) <> CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCURSO)+'-'+'SEMPS')
	ELSE NULL END AS CODOFERTAMATRICULA  

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	AND :CODPROCESSOSELETIVO LIKE '%#' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) + '#%'

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.CODSTATUS IN (2)
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SPSPROCSELCOMPL.IDPERLET
	AND SMATRICPL.CODSTATUS IN (2)

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)
	AND  :CODPROCESSOSELETIVO LIKE '%#' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) + '#%'

INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA

INNER JOIN SPARCELA(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SPARCELA.PARCELA = 1

INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA

INNER JOIN FLAN(NOLOCK)
	ON FLAN.IDLAN = SLAN.IDLAN
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
	AND FLAN.STATUSLAN IN (1, 3)";4455;;;;04/10/2021;wsrubeus;0;1;1;1;;;;0;1a759e11-41e9-44e3-8930-e182e323198b;;;-4577;wsrubeus;04/10/2021;wsrubeus;04/10/2021;
S;RB.INT.CAP.007.1;Consulta matriculados - Etapa matriculado - Graduação;"SELECT DISTINCT
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	SALUNO.RA AS 'evento.r-a1_compl_proc',
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta'

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = 2 /**2- CURSANDO**/ 
	/*AND SMATRICPL.CODTIPOMAT = 1*/ /**1- MATRICULA**/
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL
	AND SMATRICPL.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON
	

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)

INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SCONTRATO.ASSINADO = 'S'

INNER JOIN SPARCELA(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SPARCELA.PARCELA = 1

INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA

INNER JOIN FLAN(NOLOCK)
	ON FLAN.IDLAN = SLAN.IDLAN
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
	AND FLAN.STATUSLAN IN (1, 3)
";4144;;;;17/08/2022;wsrubeus;0;1;1;1;;;;0;1a759e11-41e9-44e3-8930-e182e323198b;;;-21790;wsrubeus;04/10/2021;wsrubeus;17/08/2022;
S;RB.INT.CAP.007.2;consulta matriculados - Etapa matriculado - Pós Graduação;"SELECT DISTINCT
	/*CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) AS 'evento.codRegistro',*/
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta'

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	AND GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN( SPSPROCSELCOMPL.IDPERLET,  SPSPROCSELCOMPL.IDPERLET1,  SPSPROCSELCOMPL.IDPERLET2,  SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = 27 /**27- CURSANDO**/ 
	AND SMATRICPL.CODTIPOMAT = 4 /**4- MATRICULA**/
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL	

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)
/*
INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SCONTRATO.ASSINADO = 'S'

INNER JOIN SPARCELA(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SPARCELA.PARCELA = 1

INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA

INNER JOIN FLAN(NOLOCK)
	ON FLAN.IDLAN = SLAN.IDLAN
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
	AND FLAN.STATUSLAN IN (1, 3)*/
/*
LEFT JOIN SPSPARAMETROPS (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPARAMETROPS.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPARAMETROPS.IDPS 
	AND SPSPARAMETROPS.USAINTEGRACAORUBEUS = 'T'*/";4552;;;;05/11/2022;shift;0;1;1;1;;;;0;1a759e11-41e9-44e3-8930-e182e323198b;;;29747;wsrubeus;04/10/2021;shift;05/11/2022;
S;RB.INT.CAP.008;##### Consulta reserva de vaga;"SELECT DISTINCT
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDAREAINTERESSE) AS CODOFERTA,
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) AS CODPROCESSOSELETIVO,
	SPSOPCAOINSCRITO.CODUSUARIOPS AS CODPESSOA,
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS MOMENTO,
	'1' AS FILIAL,
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS CODCURSO,
	CASE
		WHEN CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCURSO) <> CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCURSO)+'-'+'SEMPS')
	ELSE NULL END AS CODOFERTAMATRICULA  

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	AND :CODPROCESSOSELETIVO LIKE '%#' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) + '#%'

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.CODSTATUS IN (2)
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SPSPROCSELCOMPL.IDPERLET
	AND SMATRICPL.CODSTATUS IN (2)

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)
	AND  :CODPROCESSOSELETIVO LIKE '%#' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) + '#%'

INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA

INNER JOIN SPARCELA(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SPARCELA.PARCELA = 1

INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA

INNER JOIN FLAN(NOLOCK)
	ON FLAN.IDLAN = SLAN.IDLAN
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
	AND FLAN.STATUSLAN IN (1, 3)";4455;;;;04/10/2021;wsrubeus;0;1;1;1;;;;0;1a759e11-41e9-44e3-8930-e182e323198b;;;20735;wsrubeus;04/10/2021;wsrubeus;04/10/2021;
S;RB.INT.CAP.008.1;Consulta reserva de vaga - Graduação;"SELECT DISTINCT
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',	
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN IIF(SPSAREAOFERTADA_MAT.CODCOLIGADA IS NOT NULL AND SPSAREAOFERTADA_MAT.IDPS IS NOT NULL AND SPSAREAOFERTADA_MAT.IDAREAINTERESSE IS NOT NULL,
				CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),
				CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta' 

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO	
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = 1 /**1 - RESERVA DE VAGA**/
	AND SMATRICPL.CODTIPOMAT = 1 /**1 - MATRICULA**/
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

LEFT JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)";3475;;;;21/10/2021;wsrubeus;0;1;1;1;;;;0;1a759e11-41e9-44e3-8930-e182e323198b;;;-28484;wsrubeus;04/10/2021;shift;05/11/2022;
S;RB.INT.CAP.009;##### Consulta alunos com status de pré-matrícula;"SELECT DISTINCT
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDAREAINTERESSE) AS CODOFERTA,
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) AS CODPROCESSOSELETIVO,
	SPSOPCAOINSCRITO.CODUSUARIOPS AS CODPESSOA,
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS MOMENTO,
	'1' AS FILIAL,
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS CODCURSO,
	CASE
		WHEN CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCURSO) <> CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCURSO)+'-'+'SEMPS')
	ELSE NULL
	END AS CODOFERTAMATRICULA  

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
  ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
  AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
  AND SPSPROCESSOSELETIVO.STATUS = 'T'
  AND :CODPROCESSOSELETIVO LIKE '%#' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) + '#%'

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SPSPROCSELCOMPL.IDPERLET
	/*AND SMATRICPL.CODSTATUS = SHABILITACAOALUNO.CODSTATUS*/

CROSS APPLY(
	SELECT CODSTATUS
	FROM SSTATUS(NOLOCK)
	WHERE DESCRICAO LIKE '%Reserva de Vaga%'
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
	AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
) AS SSTATUS

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)
	AND  :CODPROCESSOSELETIVO LIKE '%#' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) + '#%' ";3967;;;;04/10/2021;wsrubeus;0;1;1;1;;;;0;20a93d84-4c97-416b-a4e3-0ade2e72d934;;;18292;wsrubeus;04/10/2021;wsrubeus;04/10/2021;
S;RB.INT.CAP.009.1;Consulta alunos com status de pré-matrícula - Graduação;"SELECT DISTINCT
	/*CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',*/
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',	
	SALUNO.RA AS 'evento.r-a1_compl_proc',
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN IIF(SPSAREAOFERTADA_MAT.CODCOLIGADA IS NOT NULL AND SPSAREAOFERTADA_MAT.IDPS IS NOT NULL AND SPSAREAOFERTADA_MAT.IDAREAINTERESSE IS NOT NULL,
				CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),
				CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta' 

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	/*AND SPSPROCESSOSELETIVO.IDPS = 13*/

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = 45 /**45 - PORTAL LIBERADO**/
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)";3691;;;;01/12/2021;wsrubeus;0;1;1;1;;;;0;20a93d84-4c97-416b-a4e3-0ade2e72d934;;;-10091;wsrubeus;04/10/2021;wsrubeus;01/12/2021;
S;RB.INT.CAP.009.2;Consulta alunos com status de pré-matrícula - Pós Graduação;"SELECT DISTINCT
	/*CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) AS 'evento.codRegistro',*/
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',		
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN IIF(SPSAREAOFERTADA_MAT.CODCOLIGADA IS NOT NULL AND SPSAREAOFERTADA_MAT.IDPS IS NOT NULL AND SPSAREAOFERTADA_MAT.IDAREAINTERESSE IS NOT NULL,
				CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),
				CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta' 

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	AND GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SPSPROCSELCOMPL.IDPERLET
	AND SMATRICPL.CODSTATUS IN (42,43) /**42 - PORTAL LIBERADO   43 - Inscrição confirmada**/
	AND SMATRICPL.CODTIPOMAT = 4 /**4 - MATRICULA**/
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)

LEFT JOIN SPSPARAMETROPS (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPARAMETROPS.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPARAMETROPS.IDPS 
	AND SPSPARAMETROPS.USAINTEGRACAORUBEUS = 'T'";3865;;;;05/11/2022;shift;0;1;1;1;;;;0;20a93d84-4c97-416b-a4e3-0ade2e72d934;;;12077;wsrubeus;04/10/2021;shift;05/11/2022;
S;RB.INT.CAP.010;#### Consulta inscrições e Matriculas Canceladas ####;;0;;;;04/10/2021;wsrubeus;0;1;1;1;;;;0;659bfd0e-2e9c-4000-a863-c7f71ecd0e0a;0;;-5361;wsrubeus;04/10/2021;wsrubeus;04/10/2021;0
S;RB.INT.CAP.010.1;Consulta inscrições canceladas - Graduação;"SELECT DISTINCT 
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                AS 'evento.codCurso',
    SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa'
FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SPSINSCRICAOAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	AND SPSINSCRICAOAREAOFERTADA.STATUS = 8
	/**CONDIÇÃO PARA NÃO ENVIAR INSCRICOES CANCELADAS MAS QUE TEM INSCRIÇÃO ATIVAS NO MESMO PS**/
    AND SPSOPCAOINSCRITO.CODUSUARIOPS NOT IN (SELECT INSCRICAOAREAOFERTADA.CODUSUARIOPS 
    										  FROM SPSINSCRICAOAREAOFERTADA AS INSCRICAOAREAOFERTADA(NOLOCK)
											  WHERE INSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
											  AND INSCRICAOAREAOFERTADA.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
											  AND INSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
											  AND INSCRICAOAREAOFERTADA.STATUS != 8)
    
LEFT JOIN SPSINSCRICAOAREAOFERTADA AS INSCRICAOAREAOFERTADA(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = INSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = INSCRICAOAREAOFERTADA.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = INSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND INSCRICAOAREAOFERTADA.STATUS != 8
	
INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL

CROSS APPLY(
	SELECT
		CODCOLIGADA,
		IDPS
	FROM SPSPROCESSOSELETIVO(NOLOCK)
	WHERE CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND IDPS = SPSOPCAOINSCRITO.IDPS
	AND PATINDEX('%Pós-Graduação%',SPSPROCESSOSELETIVO.NOME) = 0
) AS SPSPROCESSOSELETIVO
WHERE DATEDIFF(DAY, SPSINSCRICAOAREAOFERTADA.RECMODIFIEDON, GETDATE()) <=:DIAS
";2755;;;;05/11/2022;shift;0;1;1;1;;;;0;8be1fe09-d71d-4084-b2d9-64819192acdf;;;7760;wsrubeus;04/10/2021;shift;05/11/2022;
S;RB.INT.CAP.010.2;Consulta matrículas canceladas - Graduação;"SELECT DISTINCT 
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 					   AS 'evento.codCurso',    
    SPSOPCAOINSCRITO.CODUSUARIOPS                                                                  AS 'evento.pessoa'
FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	
INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF
	
INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5,7,10,11)
	
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	
INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.CODSTATUS IN (4,28)
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON
	
INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIAL.CODTIPOCURSO = 1
	
INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL	
	
INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
	
INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
";2771;;;;05/11/2022;shift;0;1;1;1;;;;0;92fbc531-f509-47a3-a97f-beae1865c519;;;22881;wsrubeus;04/10/2021;shift;05/11/2022;
S;RB.INT.CAP.010.3;Consulta inscrições canceladas - Pós-graduação;"SELECT DISTINCT 
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                AS 'evento.codCurso',
    SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa'
FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SPSINSCRICAOAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	AND SPSINSCRICAOAREAOFERTADA.STATUS = 8
	/**CONDIÇÃO PARA NÃO ENVIAR INSCRICOES CANCELADAS MAS QUE TEM INSCRIÇÃO ATIVAS NO MESMO PS**/
    AND SPSOPCAOINSCRITO.CODUSUARIOPS NOT IN (SELECT INSCRICAOAREAOFERTADA.CODUSUARIOPS 
    										  FROM SPSINSCRICAOAREAOFERTADA AS INSCRICAOAREAOFERTADA(NOLOCK)
											  WHERE INSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
											  AND INSCRICAOAREAOFERTADA.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
											  AND INSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
											  AND INSCRICAOAREAOFERTADA.STATUS != 8)
    
LEFT JOIN SPSINSCRICAOAREAOFERTADA AS INSCRICAOAREAOFERTADA(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = INSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = INSCRICAOAREAOFERTADA.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = INSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND INSCRICAOAREAOFERTADA.STATUS != 8
	
INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL

CROSS APPLY(
	SELECT
		CODCOLIGADA,
		IDPS
	FROM SPSPROCESSOSELETIVO(NOLOCK)
	WHERE CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND IDPS = SPSOPCAOINSCRITO.IDPS
	AND PATINDEX('%Pós-Graduação%',SPSPROCESSOSELETIVO.NOME) = 1
) AS SPSPROCESSOSELETIVO
WHERE DATEDIFF(DAY, SPSINSCRICAOAREAOFERTADA.RECMODIFIEDON, GETDATE()) <=:DIAS
";2755;;;;05/11/2022;shift;0;1;1;1;;;;0;8be1fe09-d71d-4084-b2d9-64819192acdf;;;24514;shift;05/11/2022;shift;05/11/2022;
S;RB.INT.CAP.010.4;Consulta matrículas canceladas - Pós-graduação;"SELECT DISTINCT 
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 					   AS 'evento.codCurso',    
    SPSOPCAOINSCRITO.CODUSUARIOPS                                                                  AS 'evento.pessoa'
FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	
INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF
	
INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5,7,10,11)
	
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	
INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.CODSTATUS IN (4,28)
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON
	
INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIAL.CODTIPOCURSO = 2
	
INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL	
	
INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
	
INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
";2771;;;;05/11/2022;shift;0;1;1;1;;;;0;92fbc531-f509-47a3-a97f-beae1865c519;;;19281;shift;05/11/2022;shift;05/11/2022;
S;RB.INT.CAP.011;Consulta inscrições confirmadas - Etapa confirmado;"SELECT DISTINCT 
	/** DADOS CONTATO **/
	CONVERT(VARCHAR,SPSOPCAOINSCRITO.CODUSUARIOPS) AS 'contato.codigo',
	ISNULL(SPSUSUARIO.NOME,SPSUSUARIO.NOMESOCIAL) 'contato.nome',
	CONVERT(VARCHAR(10),SPSUSUARIO.DTNASCIMENTO,121) 'contato.dataNascimento',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE1,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE1,'(',''),')',''),' ','') END 'contato.telefonePrincipal',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE2,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE2,'(',''),')',''),' ','') END 'contato.telefonesecundario_1',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE3,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE3,'(',''),')',''),' ','') END 'contato.telefonesecundario_2',
	CASE WHEN SPSUSUARIO.EMAIL IS NULL AND SPSUSUARIO.EMAIL NOT LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', SPSUSUARIO.EMAIL) = 1
         THEN  'sememail@rubeus.com.br' 
    ELSE REPLACE(REPLACE(SPSUSUARIO.EMAIL,' ',''),' ','') COLLATE SQL_Latin1_General_CP1251_CS_AS END AS 'contato.emailPrincipal',
    REPLACE(REPLACE(LTRIM(RTRIM(SPSUSUARIO.EMAIL)),' ',''),' ',''),
	CASE WHEN SPSUSUARIO.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(SPSUSUARIO.CPF) <  11
		THEN NULL 
	ELSE SPSUSUARIO.CPF END 'contato.cpf',
	SPSUSUARIO.RUA 'contato.endereco',
	SPSUSUARIO.CEP 'contato.cep',
	SPSUSUARIO.NUMERO 'contato.numero',
	SPSUSUARIO.BAIRRO 'contato.bairro',
	SPSUSUARIO.CIDADE 'contato.cidade',
	SPSUSUARIO.ESTADO 'contato.estado',
	
	CASE SPSUSUARIO.SEXO WHEN 'M' THEN 1 ELSE 2 END AS 'contato.sexo',
	CASE 
		WHEN SPSUSUARIO.ESTADOCIVIL = 'C' THEN 1 /*Casado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'D' THEN 2 /*Desquitado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'E' THEN 3 /*União Estável*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'I' THEN 4 /*Divorciado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'O' THEN 5 /*Outros*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'P' THEN 6 /*Separado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'S' THEN 7 /*Solteiro*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'V' THEN 8 /*Viúvo*/
	ELSE NULL END AS 'contato.estadocivil',
	CASE 
		WHEN SPSINSCRICAOAREAOFERTADA.DEFFISICA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFAUDITIVA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFVISUAL = 'T' THEN 1	
		WHEN SPSINSCRICAOAREAOFERTADA.DEFMENTAL = 'T'	THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFINTELECTUAL = 'T' THEN 1
	ELSE NULL END AS 'contato.deficiencias',
	
	/**DADOS EVENTO **/
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                        AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    ISNULL(FLAN.DATABAIXA, SPSINSCRICAOAREAOFERTADA.DATAINSCRICAO)                                                      AS 'evento.momento'
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	
INNER JOIN SPSUSUARIO(NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS

INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS		
	
LEFT JOIN FLAN (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.IDLAN = FLAN.IDLAN
	AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN = FLAN.CODCOLIGADA
	
WHERE (SPSINSCRICAOAREAOFERTADA.STATUS = 1 OR FLAN.STATUSLAN IN (1,3))
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
AND DATEDIFF(DAY, SPSINSCRICAOAREAOFERTADA.RECMODIFIEDON, GETDATE()) <=:DIAS

	   
";4617;;;;17/01/2022;wsrubeus;0;1;1;1;;;;0;1df67c98-a08c-48f5-9698-5eab56af8db5;;;18457;wsrubeus;18/10/2021;wsrubeus;17/01/2022;
S;RB.INT.CAP.011.1;Consulta inscrições confirmadas - Atualização Locais Oferta;"SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                        AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    CONCAT(SPSINSCAREAOFERTACOMPL.CODCOLIGADA,'-',SPSINSCAREAOFERTACOMPL.CODPOLO) AS 'evento.codLocalOferta',
    SPSUSUARIO.NOME
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
INNER JOIN SPSUSUARIO(NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS =  SPSOPCAOINSCRITO.CODUSUARIOPS
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
LEFT JOIN SPSINSCAREAOFERTACOMPL (NOLOCK) 
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO	
LEFT JOIN FLAN (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.IDLAN = FLAN.IDLAN
	AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN = FLAN.CODCOLIGADA
WHERE (SPSINSCRICAOAREAOFERTADA.STATUS = 1 OR FLAN.STATUSLAN IN (1,3))
AND SPSPROCESSOSELETIVO.IDPS IN (76,70,69,64)

/*AND SPSOPCAOINSCRITO.CODUSUARIOPS = 6288*/
/*AND SPSOPCAOINSCRITO.NUMEROINSCRICAO IN (11,12,15,21,22,23,27,28,31,34,35,39,41,43,44,45,47,48,49,50,52,53,54,55,56,59,60,62,64,65,66,67,69,70,73,75,76,77,78,79,80,81,84,85,87,89,91,93,94,96,98,99,101,104,105,
107,108,112,113,118,119,121,122,123,125,126,127,128,131,133,134,135,137,138,139,140,143,145,147,148,149,151,152,153,155,156,157,158,159,160,161,162,163,166,168,169,170,171,172,173,174,175,176,177,178,180,182,
183,187,188,190,191,192,194,195,196,197,198,200,201,202,203,206,207,208,211,213,217,220,221,222,224,226,228,231,232,233,237,238,239,242,244,249,250,251,254,255,256,257,258,260,262,266,268,270,271,274,275,276,
277,279,281,282,283,284,287,288,289,290,291,292,293,295,298,301,302,303,304,305,306,308,309,311,312,313,314,315,317,319,321,322,323,324,325,327,329,330,331,333,338,339,341,342,343,345,346,347,348,350,353,354,
355,356,360,361,362,363,364,365,366,367,368,370,371,372,373,379,380,381,382,383,386,388,389,390,391,393,394,395,396,400,403,405,406,408,413,414,415,416,418,420,424,425,426,427,428,429,430,433,434,435,436,437,
440,442,452,453,454)*/";3107;;;;08/02/2022;wsrubeus;0;1;1;1;;;;0;1df67c98-a08c-48f5-9698-5eab56af8db5;;;-17630;wsrubeus;27/10/2021;wsrubeus;08/02/2022;
S;RB.INT.CAP.012;Atualização dados Contato - CRM;"SELECT DISTINCT 
	CONVERT(VARCHAR,SPSOPCAOINSCRITO.CODUSUARIOPS) AS 'contato.codigo',
	ISNULL(SPSUSUARIO.NOME,SPSUSUARIO.NOMESOCIAL) 'contato.nome',
	CONVERT(VARCHAR(10),SPSUSUARIO.DTNASCIMENTO,121) 'contato.dataNascimento',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE1,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE1,'(',''),')',''),' ','') END 'contato.telefonePrincipal',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE2,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE2,'(',''),')',''),' ','') END 'contato.telefonesecundario_1',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE3,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE3,'(',''),')',''),' ','') END 'contato.telefonesecundario_2',
	CASE WHEN SPSUSUARIO.EMAIL IS NULL AND SPSUSUARIO.EMAIL NOT LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', SPSUSUARIO.EMAIL) = 1
         THEN  'sememail@rubeus.com.br' 
    ELSE REPLACE(REPLACE(SPSUSUARIO.EMAIL,' ',''),' ','') COLLATE SQL_Latin1_General_CP1251_CS_AS END AS 'contato.emailPrincipal',
    REPLACE(REPLACE(LTRIM(RTRIM(SPSUSUARIO.EMAIL)),' ',''),' ',''),
	CASE WHEN SPSUSUARIO.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(SPSUSUARIO.CPF) <  11
		THEN NULL 
	ELSE SPSUSUARIO.CPF END 'contato.cpf',
	SPSUSUARIO.RUA 'contato.endereco',
	SPSUSUARIO.CEP 'contato.cep',
	SPSUSUARIO.NUMERO 'contato.numero',
	SPSUSUARIO.BAIRRO 'contato.bairro',
	SPSUSUARIO.CIDADE 'contato.cidade',
	SPSUSUARIO.ESTADO 'contato.estado',
	
	CASE SPSUSUARIO.SEXO WHEN 'M' THEN 1 ELSE 2 END AS 'contato.sexo',
	CASE 
		WHEN SPSUSUARIO.ESTADOCIVIL = 'C' THEN 1 /*Casado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'D' THEN 2 /*Desquitado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'E' THEN 3 /*União Estável*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'I' THEN 4 /*Divorciado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'O' THEN 5 /*Outros*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'P' THEN 6 /*Separado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'S' THEN 7 /*Solteiro*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'V' THEN 8 /*Viúvo*/
	ELSE NULL END AS 'contato.estadocivil',
	CASE 
		WHEN SPSINSCRICAOAREAOFERTADA.DEFFISICA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFAUDITIVA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFVISUAL = 'T' THEN 1	
		WHEN SPSINSCRICAOAREAOFERTADA.DEFMENTAL = 'T'	THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFINTELECTUAL = 'T' THEN 1
	ELSE NULL END AS 'contato.deficiencias'
   
FROM   SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
INNER JOIN SPSINSCRICAOAREAOFERTADA(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
INNER JOIN SPSINSCAREAOFERTACOMPL (NOLOCK)
	ON SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO		
INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE	
 INNER JOIN SPSAREAINTERESSE(NOLOCK)
 ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

WHERE GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
AND DATEDIFF(DAY, SPSINSCRICAOAREAOFERTADA.RECMODIFIEDON, GETDATE()) <= 2
AND SPSPROCESSOSELETIVO.STATUS = 'T'";4178;;;;13/01/2022;wsrubeus;0;1;1;1;;;;0;1df67c98-a08c-48f5-9698-5eab56af8db5;;;-25344;wsrubeus;19/10/2021;wsrubeus;13/01/2022;
S;RB.INT.CAP.013;Envio/Atualização Data da atividade (Todos os cursos);"SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SPSINSCRICAOAREAOFERTADA.IDPS,'-', SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SHABILITACAOFILIAL.CODCURSO)                                         AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    CASE 
    	WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Agendado Online%'
    	THEN CONCAT('https://rubeusscripttotvs.apprbs.com.br/unifacema/index.php?p=',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO,'-',SPSOPCAOINSCRITO.CODCOLIGADA) 
    ELSE '' END AS 'evento.linkdaprova_compl_proc',
    PROVA.DATAAGENDAMENTO    AS 'evento.data' 
    
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
/**DADOS PROVA**/
OUTER APPLY(
	SELECT
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		BEXECPROVA.ID AS 'IDPROVA',
		CONCAT(CONVERT(VARCHAR,SPSAGENDARECURSOPS.DATAAGENDAMENTO,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, SPSAGENDARECURSOPS.HORAINICIO,0))), ':00') AS 'DATAAGENDAMENTO'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
	LEFT JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	LEFT JOIN SPSAGENDARECURSOPS AS SPSAGENDARECURSOPS (NOLOCK)
		ON SPSAGENDARECURSOPS.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
		AND SPSAGENDARECURSOPS.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSAGENDARECURSOPS.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS			
	WHERE 
			SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA
		AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND (CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Agendado Presencial%' THEN 1 ELSE 0 END) = 1

) AS PROVA
	
WHERE SPSPROCESSOSELETIVO.IDPS IN (1,6)
/*AND SPSPROCESSOSELETIVO.CODCOLIGADA = 1
AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = 8*/
AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%'";4381;;;;22/10/2021;wsrubeus;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;12821;wsrubeus;22/10/2021;wsrubeus;22/10/2021;0
S;RB.INT.CAP.014;Envio/Atualização Data da atividade (Teologia 1° Fase);"SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SPSINSCRICAOAREAOFERTADA.IDPS,'-', SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SHABILITACAOFILIAL.CODCURSO)                                         AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    PROVA.DATAAGENDAMENTO    AS 'evento.data' 
    
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
/**DADOS PROVA**/
CROSS APPLY(
	SELECT
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		BEXECPROVA.ID AS 'IDPROVA',
		CONCAT(CONVERT(VARCHAR,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, SPSHORARIOETAPAAREAOFERTADA.HORAINICIO,0))), ':00') AS 'DATAAGENDAMENTO'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
	LEFT JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	WHERE 
			SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSETAPAAREAOFERTADA.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 1
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND GETDATE() <= SPSHORARIOETAPAAREAOFERTADA.DATAETAPA

) AS PROVA
	
WHERE SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCESSOSELETIVO.NOME LIKE '%Vestibular Teologia%'+' - Nacional%'";3734;;;;05/11/2021;wsrubeus;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;14794;wsrubeus;22/10/2021;wsrubeus;05/11/2021;0
S;RB.INT.CAP.015;Envio/Atualização Data da atividade (Teologia 2° Fase);"SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SPSINSCRICAOAREAOFERTADA.IDPS,'-', SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SHABILITACAOFILIAL.CODCURSO)                                         AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    PROVA.DATAAGENDAMENTO    AS 'evento.data' 
    
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.STATUS = 16
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
/**DADOS PROVA**/
CROSS APPLY(
	SELECT
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		BEXECPROVA.ID AS 'IDPROVA',
		CONCAT(CONVERT(VARCHAR,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, SPSHORARIOETAPAAREAOFERTADA.HORAINICIO,0))), ':00') AS 'DATAAGENDAMENTO'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
	LEFT JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	WHERE 
			SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSETAPAAREAOFERTADA.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 3
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND GETDATE() <= SPSHORARIOETAPAAREAOFERTADA.DATAETAPA

) AS PROVA
	
WHERE SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCESSOSELETIVO.NOME LIKE '%Vestibular Teologia%'+' - Nacional%'

UNION

SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SPSINSCRICAOAREAOFERTADA.IDPS,'-', SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SHABILITACAOFILIAL.CODCURSO)                                         AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    PROVA.DATAAGENDAMENTO    AS 'evento.data' 
    
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.STATUS = 16
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
/**DADOS PROVA**/
CROSS APPLY(
	SELECT
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		BEXECPROVA.ID AS 'IDPROVA',
		CONCAT(CONVERT(VARCHAR,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, SPSHORARIOETAPAAREAOFERTADA.HORAINICIO,0))), ':00') AS 'DATAAGENDAMENTO'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
	LEFT JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	WHERE 
			SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSETAPAAREAOFERTADA.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 2
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND GETDATE() <= SPSHORARIOETAPAAREAOFERTADA.DATAETAPA

) AS PROVA
	
WHERE SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCESSOSELETIVO.NOME LIKE '%Vestibular Teologia%'+' - ENEM%'";7547;;;;05/11/2021;wsrubeus;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;-18606;wsrubeus;22/10/2021;wsrubeus;05/11/2021;0
S;RB.INT.CAP.016;#### Consulta alunos contrato assinado - Etapa contrato assinado ####;"SELECT DISTINCT
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta'

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SPSPROCSELCOMPL.IDPERLET
	AND SMATRICPL.CODSTATUS = 19 /**19- CONTRATO ASSINADO**/ 
	AND SMATRICPL.CODTIPOMAT = 1 /**1- MATRICULA**/
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL	

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)

INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SCONTRATO.ASSINADO = 'S'
";3552;;;;26/10/2021;wsrubeus;0;1;1;1;;;;0;1a759e11-41e9-44e3-8930-e182e323198b;;;-14104;wsrubeus;26/10/2021;shift;09/11/2022;
S;RB.INT.CAP.016.1;Consulta alunos contrato assinado - Graduação;"SELECT DISTINCT
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta'

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = 19 /**19- CONTRATO ASSINADO**/ 
	AND SMATRICPL.CODTIPOMAT = 1 /**1- MATRICULA**/
	AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL	

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)

INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SCONTRATO.ASSINADO = 'S'
";3633;;;;09/11/2022;shift;0;1;1;1;;;;0;1a759e11-41e9-44e3-8930-e182e323198b;;;-4282;shift;09/11/2022;shift;09/11/2022;
S;RB.INT.CAP.016.2;Consulta alunos contrato assinado - Etapa contrato assinado;"SELECT DISTINCT
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta'

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	AND SPSPROCESSOSELETIVO.IDPS = 124

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	/*AND SPSUSUARIO.CODUSUARIOPS = 20982*/
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = 42 /**42- INSCRITO**/ 
	AND SMATRICPL.CODTIPOMAT = 4 /**1- MATRICULA**/
	/*AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL	*/

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)

INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SCONTRATO.ASSINADO = 'S'
";3707;;;;10/11/2022;shift;0;1;1;1;;;;0;1a759e11-41e9-44e3-8930-e182e323198b;;;-6522;shift;09/11/2022;shift;10/11/2022;
S;RB.INT.CAP.017;Consulta candidatos reprovados - Etapa desclassificado;"SELECT DISTINCT 
	CONVERT(VARCHAR, SPSINSCRICAOAREAOFERTADA.CODCOLIGADA)+ '-'+ CONVERT(VARCHAR, SPSINSCRICAOAREAOFERTADA.IDPS)+ '-'+ CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONVERT(VARCHAR, SPSINSCRICAOAREAOFERTADA.CODCOLIGADA)+ '-'+ CONVERT(VARCHAR, SHABILITACAOFILIAL.CODCURSO) AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    SPSOPCAOINSCRITO.RECMODIFIEDON AS 'evento.momento'

FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.STATUS = 3

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL

INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA	
                                                
WHERE 	
	DATEDIFF(DAY, SPSOPCAOINSCRITO.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SPSOPCAOINSCRITO.RECMODIFIEDON, GETDATE()) <= :DIAFINAL
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'

ORDER BY
	SPSOPCAOINSCRITO.RECMODIFIEDON DESC";1940;;;;17/01/2022;wsrubeus;0;1;1;1;;;;0;fe2e8ab0-d5aa-43c1-9571-1a54e9e5db39;;;-4383;wsrubeus;26/10/2021;wsrubeus;17/01/2022;
S;RB.INT.CAP.018;Consulta candidatos ausentes - Etapa não compareceu;"SELECT DISTINCT 
     SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS                                                                     AS 'evento.pessoa',
     CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                    AS 'evento.codCurso',
     CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS,'-',SPSAREAINTERESSE.IDAREAINTERESSE) AS 'evento.codOferta'

FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
     ON (SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
     AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS)

INNER JOIN SPSINSCRICAOAREAOFERTADA(NOLOCK)
     ON (SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
     AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
     AND SPSINSCRICAOAREAOFERTADA.STATUS <> 8)

INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
     ON (SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
     AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
     AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
     AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
     AND SPSOPCAOINSCRITO.STATUS = 4 )

INNER JOIN SPSAREAOFERTADA (NOLOCK)
     ON (SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
     AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
     AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE)

LEFT JOIN SPSATIVIDADEAGENDADAPS (NOLOCK)
     ON (SPSPROCESSOSELETIVO.CODCOLIGADA = SPSATIVIDADEAGENDADAPS.CODCOLIGADA
     AND SPSPROCESSOSELETIVO.IDPS = SPSATIVIDADEAGENDADAPS.IDPS)

LEFT JOIN SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
     ON (SPSAREAOFERTADA.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA
     AND SPSAREAOFERTADA.IDPS = SPSETAPAAREAOFERTADA.IDPS
     AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE)

INNER JOIN SPSAREAINTERESSE (NOLOCK)
     ON (SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE)
     
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
     AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
     
LEFT JOIN SPSAGENDARECURSOPS 
     ON (SPSAGENDARECURSOPS.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
     AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSAGENDARECURSOPS.NUMEROINSCRICAO)

WHERE  SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
AND CASE
        WHEN SPSOPCAOINSCRITO.STATUS = 4 AND ISNULL(CONVERT(DATE,SPSAGENDARECURSOPS.DATAAGENDAMENTO),CONVERT(DATE,SPSPROCESSOSELETIVO.DTINISELECAO)) < CONVERT(DATE,GETDATE())   THEN 2
        WHEN SPSATIVIDADEAGENDADAPS.CODCOLIGADA IS NOT NULL AND SPSOPCAOINSCRITO.PONTUACAO IS NOT NULL  AND SPSOPCAOINSCRITO.PONTUACAO <> 0 THEN 1
        WHEN SPSETAPAAREAOFERTADA.CODCOLIGADA IS NOT NULL AND SPSOPCAOINSCRITO.PONTUACAO IS NOT NULL  AND SPSOPCAOINSCRITO.PONTUACAO <> 0 THEN 1
        WHEN SPSOPCAOINSCRITO.PONTUACAO IS NOT NULL  AND SPSOPCAOINSCRITO.PONTUACAO <> 0 THEN 1
     ELSE NULL END IS NOT NULL ";3190;;;;17/01/2022;wsrubeus;0;1;1;1;;;;0;fe2e8ab0-d5aa-43c1-9571-1a54e9e5db39;;;-20338;wsrubeus;26/10/2021;wsrubeus;17/01/2022;
S;RB.INT.CAP.019;Consulta documentos Pendentes - Inscrição;"SELECT DISTINCT 
     SPSOPCAOINSCRITO.CODUSUARIOPS                                                                       AS 'evento.pessoa',
     CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                              AS 'evento.codCurso',
     CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta'

FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SPSDOCUMENTOEXIGIDO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE
		
INNER JOIN SDOCUMENTO (NOLOCK) 
	ON SDOCUMENTO.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
	  
INNER JOIN SPSDOCUMENTOENTREGUE (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSDOCUMENTOENTREGUE.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO

INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS

INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS	
	
LEFT JOIN SPSARQUIVOSCANDIDATO (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSARQUIVOSCANDIDATO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO
	AND SPSARQUIVOSCANDIDATO.NOMEARQUIVO LIKE '%' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.IDPS) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO)  + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODDOCUMENTO) + '.%'	
	
WHERE DATEDIFF(DAY, SPSOPCAOINSCRITO.RECMODIFIEDON, GETDATE()) < 10
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
AND SPSARQUIVOSCANDIDATO.NOMEARQUIVO IS NULL";2485;;;;13/01/2022;wsrubeus;0;1;1;1;;;;0;fe2e8ab0-d5aa-43c1-9571-1a54e9e5db39;;;3327;wsrubeus;26/10/2021;wsrubeus;13/01/2022;
S;RB.INT.CAP.020;#### Consulta documentos Pendentes - Matrícula ####;"SELECT DISTINCT 
     SPSOPCAOINSCRITO.CODUSUARIOPS                                                                       AS 'evento.pessoa',
     CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                              AS 'evento.codCurso',
     CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta'
     
FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS	
	
LEFT JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS	
	
/**CASO CANDIDATO TENHA MAIS DE UM RA PEGAR O ULTIMO**/
OUTER APPLY 
		(
		SELECT TOP 1 
			MAX(SALUNO.RECCREATEDON) AS DATACRIACAO,
			SALUNO.RA,
			PPESSOA.CPF,
			PPESSOA.NOME,
			SALUNO.CODCOLIGADA
		FROM SALUNO(NOLOCK)
			INNER JOIN PPESSOA(NOLOCK)
				ON SALUNO.CODPESSOA = PPESSOA.CODIGO
				AND PPESSOA.CPF = SPSUSUARIO.CPF
		GROUP BY SALUNO.RECCREATEDON,SALUNO.RA,PPESSOA.CPF,SALUNO.CODCOLIGADA,PPESSOA.NOME
		ORDER BY SALUNO.RECCREATEDON DESC) AS SALUNO
		
INNER JOIN SPSAREAINTERESSE (NOLOCK)   
   ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE  
   
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
    ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
    
INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	
INNER JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SALUNO.RA
	AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SCONTRATO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.CODSTATUS = 45
	
INNER JOIN SDOCEXIGIDOS(NOLOCK)
	ON SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SDOCEXIGIDOS.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL	
	
INNER JOIN  SDOCALUNO (NOLOCK) 
	ON SDOCALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SDOCALUNO.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCALUNO.RA = SCONTRATO.RA
	AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
	
INNER JOIN SDOCUMENTO (NOLOCK)	
	ON SDOCUMENTO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
	
LEFT JOIN SARQUIVOS (NOLOCK) 
	ON SARQUIVOS.CHAVERM =  CONCAT(SDOCALUNO.CODCOLIGADA,';',SDOCALUNO.IDPERLET,';',SDOCALUNO.RA,';',SDOCALUNO.CODDOCUMENTO)	  	

WHERE DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) < 10
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
AND SARQUIVOS.NOMEARQUIVO IS NULL";3407;;;;13/01/2022;wsrubeus;0;1;1;1;;;;0;fe2e8ab0-d5aa-43c1-9571-1a54e9e5db39;;;-17164;wsrubeus;01/11/2021;shift;05/11/2022;
S;RB.INT.CAP.020.1;Consulta documentos Pendentes Matrícula - Graduação;"SELECT DISTINCT 
     SPSOPCAOINSCRITO.CODUSUARIOPS                                                                       AS 'evento.pessoa',
     CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                              AS 'evento.codCurso',
     CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta'
     
FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS	
	
LEFT JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS	
	
/**CASO CANDIDATO TENHA MAIS DE UM RA PEGAR O ULTIMO**/
OUTER APPLY 
		(
		SELECT TOP 1 
			MAX(SALUNO.RECCREATEDON) AS DATACRIACAO,
			SALUNO.RA,
			PPESSOA.CPF,
			PPESSOA.NOME,
			SALUNO.CODCOLIGADA
		FROM SALUNO(NOLOCK)
			INNER JOIN PPESSOA(NOLOCK)
				ON SALUNO.CODPESSOA = PPESSOA.CODIGO
				AND PPESSOA.CPF = SPSUSUARIO.CPF
		GROUP BY SALUNO.RECCREATEDON,SALUNO.RA,PPESSOA.CPF,SALUNO.CODCOLIGADA,PPESSOA.NOME
		ORDER BY SALUNO.RECCREATEDON DESC) AS SALUNO
		
INNER JOIN SPSAREAINTERESSE (NOLOCK)   
   ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE  
   
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
    ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
    
INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	
INNER JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SALUNO.RA
	AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SCONTRATO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.CODSTATUS = 45
	
INNER JOIN SDOCEXIGIDOS(NOLOCK)
	ON SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SDOCEXIGIDOS.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL	
	
INNER JOIN  SDOCALUNO (NOLOCK) 
	ON SDOCALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SDOCALUNO.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCALUNO.RA = SCONTRATO.RA
	AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
	
INNER JOIN SDOCUMENTO (NOLOCK)	
	ON SDOCUMENTO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
	
LEFT JOIN SARQUIVOS (NOLOCK) 
	ON SARQUIVOS.CHAVERM =  CONCAT(SDOCALUNO.CODCOLIGADA,';',SDOCALUNO.IDPERLET,';',SDOCALUNO.RA,';',SDOCALUNO.CODDOCUMENTO)	  	

WHERE DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) < 10
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
AND SARQUIVOS.NOMEARQUIVO IS NULL";3407;;;;05/11/2022;shift;0;1;1;1;;;;0;fe2e8ab0-d5aa-43c1-9571-1a54e9e5db39;;;18999;shift;05/11/2022;shift;05/11/2022;
S;RB.INT.CAP.021;Aprovado (Teologia 1° Fase);"SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SPSINSCRICAOAREAOFERTADA.IDPS,'-', SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SHABILITACAOFILIAL.CODCURSO)                                         AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa'
    
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.ULTIMAETAPA = 2
	AND SPSOPCAOINSCRITO.STATUS = 16
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
/**DADOS PROVA**/
CROSS APPLY(
	SELECT
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		BEXECPROVA.ID AS 'IDPROVA',
		CONCAT(CONVERT(VARCHAR,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, SPSHORARIOETAPAAREAOFERTADA.HORAINICIO,0))), ':00') AS 'DATAAGENDAMENTO'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
	LEFT JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	WHERE 
			SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSETAPAAREAOFERTADA.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 3
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND GETDATE() <= SPSHORARIOETAPAAREAOFERTADA.DATAETAPA

) AS PROVA	
	
WHERE SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCESSOSELETIVO.NOME LIKE '%Vestibular Teologia%'+' - Nacional%'

UNION

SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SPSINSCRICAOAREAOFERTADA.IDPS,'-', SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SHABILITACAOFILIAL.CODCURSO)                                         AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa'
    
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.ULTIMAETAPA = 1
	AND SPSOPCAOINSCRITO.STATUS = 16
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
/**DADOS PROVA**/
CROSS APPLY(
	SELECT
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		BEXECPROVA.ID AS 'IDPROVA',
		CONCAT(CONVERT(VARCHAR,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, SPSHORARIOETAPAAREAOFERTADA.HORAINICIO,0))), ':00') AS 'DATAAGENDAMENTO'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
	LEFT JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	WHERE 
			SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSETAPAAREAOFERTADA.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 2
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND GETDATE() <= SPSHORARIOETAPAAREAOFERTADA.DATAETAPA
) AS PROVA	
WHERE SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCESSOSELETIVO.NOME LIKE '%Vestibular Teologia%'+' - ENEM%'";7524;;;;05/11/2021;wsrubeus;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;-13632;wsrubeus;05/11/2021;wsrubeus;05/11/2021;0
S;RB.INT.CAP.022;Aprovado- Excedente (Teologia);"SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SPSINSCRICAOAREAOFERTADA.IDPS,'-', SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SHABILITACAOFILIAL.CODCURSO)                                         AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    SPSINSCRICAOAREAOFERTADA.IDPS,
    SPSOPCAOINSCRITO.NUMEROINSCRICAO
    
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS	
INNER JOIN SPSINSCAREAOFERTACOMPL(NOLOCK)
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA 
	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO 	
	
WHERE SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSOPCAOINSCRITO.STATUS = 0
AND SPSINSCAREAOFERTACOMPL.EXCEDENTE = 'T'";1682;;;;01/12/2021;wsrubeus;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;-13293;wsrubeus;01/12/2021;wsrubeus;01/12/2021;0
S;RB.INT.CAP.023;Envio/atualização Locais de ofertas;"SELECT DISTINCT 	
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SCAMPUS.CODCAMPUS) AS 'localoferta.codigo',
	SCAMPUS.DESCRICAO AS 'localoferta.titulo',
	SCAMPUS.DESCRICAO AS 'localoferta.descricao',
	SCAMPUS.RUA AS 'localoferta.endereco',
	SCAMPUS.BAIRRO AS 'localoferta.bairro',
	SCAMPUS.NUMERO AS 'localoferta.numero',
	SCAMPUS.CEP AS 'localoferta.cep',
	SCAMPUS.CIDADE AS 'localoferta.cidade',
	SCAMPUS.UF AS 'localoferta.estado'
       
FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS      	

INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SHABILITACAOFILIALCAMPUS (NOLOCK)
	ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL

INNER JOIN SCAMPUS(NOLOCK)
	ON SCAMPUS.CODCAMPUS = SHABILITACAOFILIALCAMPUS.CODCAMPUS
	AND SCAMPUS.ATIVO = 'S'	
	
INNER JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPLETIVO.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
	AND SPLETIVO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
	AND SPLETIVO.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)

INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
	
WHERE  
	(GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO OR GETDATE() < SPSPROCESSOSELETIVO.DTINIINSCRICAO)
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
AND DATEDIFF(DAY,SCAMPUS.RECMODIFIEDON,GETDATE()) <= :DIAS
";2352;;;;23/02/2022;wsrubeus;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;31329;wsrubeus;21/12/2021;wsrubeus;23/02/2022;0
S;RB.INT.CAP.024;##### Consultas documentos de matrículas recusados #####;;0;;;;05/11/2022;shift;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;-4639;shift;05/11/2022;shift;05/11/2022;0
S;RB.INT.CAP.024.1;Consultas documentos de matrículas recusados - Graduação;"SELECT DISTINCT 
     SPSOPCAOINSCRITO.CODUSUARIOPS                                                                       AS 'evento.pessoa',
     CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                              AS 'evento.codCurso',
     CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
	 (SELECT 
			CONCAT(DOCUMENTO.DESCRICAO,': ',DOCRECUSADO.DESCRICAO, IIF(DOCALUNO.OBS IS NOT NULL,' - Obs: '+CONVERT(VARCHAR(MAX),DOCALUNO.OBS),''))
		FROM SDOCALUNO DOCALUNO	
		INNER JOIN SDOCUMENTO DOCUMENTO (NOLOCK) 
			ON DOCUMENTO.CODDOCUMENTO = DOCALUNO.CODDOCUMENTO
		INNER JOIN SDOCEXIGIDOS DOCEXIGIDOS (NOLOCK) 
			ON DOCEXIGIDOS.CODDOCUMENTO = DOCUMENTO.CODDOCUMENTO
		INNER JOIN SMOTIVOREJEICAODOCUMENTO DOCRECUSADO (NOLOCK) 
			ON DOCRECUSADO.CODCOLIGADA = DOCALUNO.CODCOLIGADA
			AND DOCRECUSADO. IDMOTIVOREJEICAODOCUMENTO = DOCALUNO.IDMOTIVOREJEICAODOCUMENTO
		WHERE
			DOCALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND DOCALUNO.RA = SMATRICPL.RA
			AND DOCEXIGIDOS.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND DOCEXIGIDOS.IDPERLET = SMATRICPL.IDPERLET
			AND DOCALUNO.STATUS = 2
      FOR XML PATH('p')) AS 'evento.campopersonalizado_25_compl_proc',
      SMATRICPL.RA

FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS	
	
LEFT JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS	
	
OUTER APPLY 
		(
		SELECT TOP 1
			MAX(SALUNO.RECCREATEDON) AS DATACRIACAO,
			SALUNO.RA,
			PPESSOA.CPF,
			PPESSOA.NOME,
			SALUNO.CODCOLIGADA
		FROM SALUNO(NOLOCK)
			INNER JOIN PPESSOA(NOLOCK)
				ON SALUNO.CODPESSOA = PPESSOA.CODIGO
				AND PPESSOA.CPF = SPSUSUARIO.CPF
		GROUP BY SALUNO.RECCREATEDON,SALUNO.RA,PPESSOA.CPF,SALUNO.CODCOLIGADA,PPESSOA.NOME
		ORDER BY SALUNO.RECCREATEDON DESC) AS SALUNO
		
INNER JOIN SPSAREAINTERESSE (NOLOCK)   
   ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE  
   
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
    ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
    AND SHABILITACAOFILIAL.CODTIPOCURSO = 1

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SALUNO.RA = SMATRICPL.RA
	
INNER JOIN (
		SELECT 
			DOCALUNO.CODCOLIGADA,
			DOCALUNO.RA,
			DOCEXIGIDOS.IDHABILITACAOFILIAL,
			DOCEXIGIDOS.IDPERLET,
			DOCALUNO.STATUS
		FROM SDOCALUNO DOCALUNO(NOLOCK)
		INNER JOIN SDOCUMENTO DOCUMENTO (NOLOCK) 
			ON DOCUMENTO.CODDOCUMENTO = DOCALUNO.CODDOCUMENTO
		INNER JOIN SDOCEXIGIDOS DOCEXIGIDOS (NOLOCK) 
			ON DOCEXIGIDOS.CODDOCUMENTO = DOCUMENTO.CODDOCUMENTO
		INNER JOIN SMOTIVOREJEICAODOCUMENTO DOCRECUSADO (NOLOCK) 
			ON DOCRECUSADO.CODCOLIGADA = DOCALUNO.CODCOLIGADA
			AND DOCRECUSADO. IDMOTIVOREJEICAODOCUMENTO = DOCALUNO.IDMOTIVOREJEICAODOCUMENTO
		WHERE
			DOCALUNO.STATUS = 2
		GROUP BY
			DOCALUNO.CODCOLIGADA,
			DOCALUNO.RA,
			DOCEXIGIDOS.IDHABILITACAOFILIAL,
			DOCEXIGIDOS.IDPERLET,
			DOCALUNO.STATUS
) AS DOCUMENTOALUNO
	ON  DOCUMENTOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND DOCUMENTOALUNO.RA = SMATRICPL.RA
	AND DOCUMENTOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND DOCUMENTOALUNO.IDPERLET = SMATRICPL.IDPERLET

WHERE DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) < 5
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
and SPSOPCAOINSCRITO.STATUS IN (5,10,7)";3953;;;;05/11/2022;shift;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;-23154;shift;05/11/2022;shift;05/11/2022;0
S;RB.INT.CAP.024.2;Consultas documentos de matrículas recusados - Pós-Graduação;"SELECT DISTINCT 
     SPSOPCAOINSCRITO.CODUSUARIOPS                                                                       AS 'evento.pessoa',
     CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                              AS 'evento.codCurso',
     CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
	 (SELECT 
			CONCAT(DOCUMENTO.DESCRICAO,': ',DOCRECUSADO.DESCRICAO, IIF(DOCALUNO.OBS IS NOT NULL,' - Obs: '+CONVERT(VARCHAR(MAX),DOCALUNO.OBS),''))
		FROM SDOCALUNO DOCALUNO	
		INNER JOIN SDOCUMENTO DOCUMENTO (NOLOCK) 
			ON DOCUMENTO.CODDOCUMENTO = DOCALUNO.CODDOCUMENTO
		INNER JOIN SDOCEXIGIDOS DOCEXIGIDOS (NOLOCK) 
			ON DOCEXIGIDOS.CODDOCUMENTO = DOCUMENTO.CODDOCUMENTO
		INNER JOIN SMOTIVOREJEICAODOCUMENTO DOCRECUSADO (NOLOCK) 
			ON DOCRECUSADO.CODCOLIGADA = DOCALUNO.CODCOLIGADA
			AND DOCRECUSADO. IDMOTIVOREJEICAODOCUMENTO = DOCALUNO.IDMOTIVOREJEICAODOCUMENTO
		WHERE
			DOCALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND DOCALUNO.RA = SMATRICPL.RA
			AND DOCEXIGIDOS.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND DOCEXIGIDOS.IDPERLET = SMATRICPL.IDPERLET
			AND DOCALUNO.STATUS = 2
      FOR XML PATH('p')) AS 'evento.campopersonalizado_25_compl_proc',
      SMATRICPL.RA

FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS	
	
LEFT JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS	
	
OUTER APPLY 
		(
		SELECT TOP 1
			MAX(SALUNO.RECCREATEDON) AS DATACRIACAO,
			SALUNO.RA,
			PPESSOA.CPF,
			PPESSOA.NOME,
			SALUNO.CODCOLIGADA
		FROM SALUNO(NOLOCK)
			INNER JOIN PPESSOA(NOLOCK)
				ON SALUNO.CODPESSOA = PPESSOA.CODIGO
				AND PPESSOA.CPF = SPSUSUARIO.CPF
		GROUP BY SALUNO.RECCREATEDON,SALUNO.RA,PPESSOA.CPF,SALUNO.CODCOLIGADA,PPESSOA.NOME
		ORDER BY SALUNO.RECCREATEDON DESC) AS SALUNO
		
INNER JOIN SPSAREAINTERESSE (NOLOCK)   
   ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE  
   
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
    ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
    AND SHABILITACAOFILIAL.CODTIPOCURSO = 2

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SALUNO.RA = SMATRICPL.RA
	
INNER JOIN (
		SELECT 
			DOCALUNO.CODCOLIGADA,
			DOCALUNO.RA,
			DOCEXIGIDOS.IDHABILITACAOFILIAL,
			DOCEXIGIDOS.IDPERLET,
			DOCALUNO.STATUS
		FROM SDOCALUNO DOCALUNO(NOLOCK)
		INNER JOIN SDOCUMENTO DOCUMENTO (NOLOCK) 
			ON DOCUMENTO.CODDOCUMENTO = DOCALUNO.CODDOCUMENTO
		INNER JOIN SDOCEXIGIDOS DOCEXIGIDOS (NOLOCK) 
			ON DOCEXIGIDOS.CODDOCUMENTO = DOCUMENTO.CODDOCUMENTO
		INNER JOIN SMOTIVOREJEICAODOCUMENTO DOCRECUSADO (NOLOCK) 
			ON DOCRECUSADO.CODCOLIGADA = DOCALUNO.CODCOLIGADA
			AND DOCRECUSADO. IDMOTIVOREJEICAODOCUMENTO = DOCALUNO.IDMOTIVOREJEICAODOCUMENTO
		WHERE
			DOCALUNO.STATUS = 2
		GROUP BY
			DOCALUNO.CODCOLIGADA,
			DOCALUNO.RA,
			DOCEXIGIDOS.IDHABILITACAOFILIAL,
			DOCEXIGIDOS.IDPERLET,
			DOCALUNO.STATUS
) AS DOCUMENTOALUNO
	ON  DOCUMENTOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND DOCUMENTOALUNO.RA = SMATRICPL.RA
	AND DOCUMENTOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND DOCUMENTOALUNO.IDPERLET = SMATRICPL.IDPERLET

WHERE DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) < 5
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
and SPSOPCAOINSCRITO.STATUS IN (5,10,7)";3953;;;;05/11/2022;shift;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;3933;shift;05/11/2022;shift;05/11/2022;0
S;RB.INT.CAP.025;Consulta documentos recusados - inscrição;"SELECT 
CONVERT(VARCHAR, OP.CODCOLIGADA) + '-'+ CONVERT(VARCHAR, OP.IDPS) + '-' + CONVERT(VARCHAR, OP.IDAREAINTERESSE) AS 'evento.codOferta',
OP.CODUSUARIOPS AS 'evento.pessoa',
CONVERT(VARCHAR, OP.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SH.CODCURSO) AS 'evento.codCurso',
   (SELECT DOC.DESCRICAO+': '+ DS.MOTIVO
        FROM SPSDOCUMENTOENTREGUE DS
        INNER JOIN SPSDOCUMENTOEXIGIDO E
        ON E.CODCOLIGADA = DS.CODCOLIGADA
        AND E.CODDOCUMENTO = DS.CODDOCUMENTO
        AND E.IDPS = OP.IDPS
        AND E.IDAREAINTERESSE = OP.IDAREAINTERESSE
        AND E.OBRIGATORIO = 'T'
        INNER JOIN SDOCUMENTO DOC
        ON DOC.CODDOCUMENTO = E.CODDOCUMENTO
        WHERE DS.CODCOLIGADA = OP.CODCOLIGADA
        AND DS.IDPS = OP.IDPS
        AND DS.NUMEROINSCRICAO = OP.NUMEROINSCRICAO
        AND DS.MOTIVO IS NOT NULL
        AND DS.ENTREGUE = 'F'
        FOR XML PATH('p')) AS 'evento.campopersonalizado_26_compl_proc'/*Colocar qual é o campo personalizado*/
    
FROM SPSOPCAOINSCRITO AS OP (NOLOCK)

INNER JOIN (SELECT E.CODCOLIGADA, E.IDPS, E.IDAREAINTERESSE, DS.CODPESSOA, DS.NUMEROINSCRICAO, COUNT(*) AS QTD
            FROM SPSDOCUMENTOENTREGUE DS
            INNER JOIN SPSDOCUMENTOEXIGIDO E            
            ON E.CODCOLIGADA = DS.CODCOLIGADA
            AND E.CODDOCUMENTO = DS.CODDOCUMENTO            
            AND E.IDPS = DS.IDPS            
            AND E.OBRIGATORIO = 'T'
            AND DS.ENTREGUE = 'F'
            AND DS.MOTIVO IS NOT NULL
            GROUP BY E.CODCOLIGADA, E.IDPS, E.IDAREAINTERESSE, DS.CODPESSOA, DS.NUMEROINSCRICAO) AS DC
ON DC.CODCOLIGADA = OP.CODCOLIGADA
AND DC.IDAREAINTERESSE = OP.IDAREAINTERESSE
AND DC.IDPS = OP.IDPS
AND DC.NUMEROINSCRICAO = OP.NUMEROINSCRICAO
 INNER JOIN SPSAREAINTERESSE (NOLOCK)
     ON OP.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SPSINSCRICAOAREAOFERTADA (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = OP.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = OP.IDPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = OP.NUMEROINSCRICAO
	
INNER JOIN SHABILITACAOFILIAL as SH(NOLOCK)
 ON OP.CODCOLIGADA = SH.CODCOLIGADA
    AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SH.IDHABILITACAOFILIAL
WHERE
	DATEDIFF(DAY, SPSINSCRICAOAREAOFERTADA.RECMODIFIEDON, GETDATE()) >= 0 AND DATEDIFF(DAY, SPSINSCRICAOAREAOFERTADA.RECMODIFIEDON, GETDATE()) <= 2



";2405;;;;05/11/2022;shift;0;1;1;1;;;;0;fe2e8ab0-d5aa-43c1-9571-1a54e9e5db39;;;-14151;shift;05/11/2022;shift;05/11/2022;
S;RB.INT.CAP.099;Consulta para verificação (TESTE);"SELECT DISTINCT 
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS,'-',SPSAREAOFERTADA.IDAREAINTERESSE)AS 'oferta.codOferta',
	CONCAT(SCURSO.NOME,' ',STURNO.NOME) AS 'oferta.nome',
	CONCAT(SCURSO.CODCOLIGADA,'-',SCURSO.CODCURSO) AS 'oferta.codCurso',
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODFILIAL) AS 'oferta.codUnidade',
	IIF(SPSPROCESSOSELETIVO.NOME LIKE '%Pós%',3,4) as 'oferta.codNivelEnsino',
	ISNULL(SCURSO.CURPRESDIST,'P') AS 'oferta.codModalidade',
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS) AS 'oferta.codProcessoSeletivo',
	SPSAREAOFERTADA.NUMMININSCRICOES AS 'oferta.vagasMinimas',
	SPSAREAOFERTADA.NUMEROVAGAS AS 'oferta.vagasMaximas',
	CONVERT(VARCHAR(10),SGRADE.DTINICIO, 120)  AS 'oferta.inicioCurso',
    CONVERT(VARCHAR(10),SGRADE.DTFIM,120) AS 'oferta.terminoCurso',
    CONVERT(VARCHAR(10),SHABILITACAOFILIALPL.DTINICIOALTERACAOPROGRAMA,120)  AS 'oferta.inicioMatricula',
    CONVERT(VARCHAR(10),SHABILITACAOFILIALPL.DTFIMALTERACAOPROGRAMA,120)  AS 'oferta.terminoMatricula',
    CONCAT(STRING_AGG(CONVERT(VARCHAR,CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SHABILITACAOFILIALCAMPUS.CODCAMPUS)), '|;|'), '|;|') AS 'oferta.codLocalOferta'
 
FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS

INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SHABILITACAOFILIALCAMPUS (NOLOCK)
	ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPLETIVO.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
	AND SPLETIVO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
	AND SPLETIVO.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)

INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET

INNER JOIN STURNO(NOLOCK)
	ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
	
INNER JOIN SCURSO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO 
	
INNER JOIN SGRADE (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE
	
WHERE  
	(GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO OR GETDATE() < SPSPROCESSOSELETIVO.DTINIINSCRICAO)
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND SPSPROCSELCOMPL.PSRUBEUS = 'T'
/*AND CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS,'-',SPSAREAOFERTADA.IDAREAINTERESSE) = '1-124-476'*/
GROUP BY
	SPSPROCESSOSELETIVO.CODCOLIGADA,
	SPSPROCESSOSELETIVO.IDPS,
	SPSAREAOFERTADA.IDAREAINTERESSE,
	SCURSO.NOME, 
	STURNO.NOME,
	SCURSO.CODCOLIGADA, 
	SCURSO.CODCURSO,
	SPSPROCESSOSELETIVO.CODCOLIGADA,
	SHABILITACAOFILIAL.CODFILIAL,
	SPSPROCESSOSELETIVO.NOME,
	SCURSO.CURPRESDIST,
	SPSAREAOFERTADA.NUMMININSCRICOES,
	SPSAREAOFERTADA.NUMEROVAGAS,
	SGRADE.DTINICIO,
    SGRADE.DTFIM,
    SHABILITACAOFILIALPL.DTINICIOALTERACAOPROGRAMA,
    SHABILITACAOFILIALPL.DTFIMALTERACAOPROGRAMA";4131;;;;09/11/2022;crmrubeus;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;12292;wsrubeus;15/03/2022;crmrubeus;09/11/2022;0
S;RB.INT.CAP.099.1;Consulta para verificação (TESTE);select * from sstatus where codstatus in (4,28);47;;;;08/09/2022;wsrubeus;0;1;1;1;;;;0;1520cd31-06c7-4545-ae0b-fa5a55310611;0;;9993;wsrubeus;28/07/2022;wsrubeus;08/09/2022;0
S;RB.INT.GI;Consultas da Gestão da Inadimplência;SELECT * FROM FLANINTEGRACAO(NOLOCK) WHERE IDLAN = 13898;56;;;;22/08/2022;wsrubeus;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;-4881;wsrubeus;07/04/2022;wsrubeus;22/08/2022;0
S;RB.INT.GI.001;Envio/Atualização Responsável financeiro;"/******
	- CONSULTA PARA ENVIO DE ATUALIZAÇÃO CADASTRO DE RESPONSÁVEL FINANCEIRO
	- GESTÃO DA PERMANÊNCIA
******/
SELECT * FROM (
SELECT DISTINCT
	ROW_NUMBER() OVER(ORDER BY FCFO.CODCFO ASC) AS CONTADOR,
	SALUNO.RA,
	/** INFORMAÇÕES DO CONTATO **/
	CONCAT('R-',FCFO.CODCFO) AS 'contato.codigo',
	FCFO.NOME AS 'contato.nome',
	CONVERT(VARCHAR(10),FCFO.DTNASCIMENTO, 121) AS 'contato.dataNascimento',
    CASE WHEN LEN(COALESCE(FCFO.TELEX,FCFO.TELEFONE,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(COALESCE(FCFO.TELEX,FCFO.TELEFONE),'(',''),')',''),' ','') END AS 'contato.telefonePrincipal',
	CASE WHEN LEN(ISNULL(FCFO.TELEFONE,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(FCFO.TELEFONE,'(',''),')',''),' ','') END AS 'contato.telefonesecundario_1',
	CASE WHEN (SELECT AA.EMAIL FROM FCFO AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
      			AND AA.CODCFO = FCFO.CODCFO) IS NOT NULL 
 	 THEN REPLACE(FCFO.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
         ELSE 'sememail@rubeus.com.br' 
	END			AS 'contato.emailPrincipal',
	FCFO.CGCCFO AS 'contato.cpf',
	FCFO.RUA 	AS 'contato.endereco',
	FCFO.CEP 	AS 'contato.cep',
	FCFO.NUMERO AS 'contato.numero',
	FCFO.BAIRRO AS 'contato.bairro',
	FCFO.CIDADE AS 'contato.cidade',
	FCFO.CODETD AS 'contato.estado'

FROM SALUNO(NOLOCK)
INNER JOIN FCFO(NOLOCK)
	ON FCFO.CODCFO = SALUNO.CODCFO

INNER JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SALUNO.RA

/**DADOS MATRICULA**/
CROSS APPLY(
	SELECT DISTINCT
		SMATRICPL.CODCOLIGADA,
		SMATRICPL.RA,
		CODSTATUS,
		SPLETIVO.CODPERLET AS PERIODOLETIVO
	FROM SMATRICPL(NOLOCK)
	INNER JOIN SPLETIVO(NOLOCK)
		ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
		AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
		/**NAO CONSIDERAR ALUNOS FIES**/
	CROSS APPLY(
		SELECT
			SHABILITACAOALUNOCOMPL.CODCOLIGADA,
			SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
			SHABILITACAOALUNOCOMPL.RA
		FROM SHABILITACAOALUNOCOMPL(NOLOCK)
		INNER JOIN SHABILITACAOALUNO(NOLOCK)
			ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
			AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
		WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
		AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
		AND ISNULL(FIES,'F') = 'F'
	) AS SHABILITACAO
	WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.CODSTATUS IN (2,3,4,7,10,    /**GRADUACAO**/
								27,28,29,46,50,/**POS GRADUACAO**/
								23,24,25,67    )/**EXTENSAO/LIVRE**/
) AS SMATRICPL

CROSS APPLY(
	SELECT
		FLAN.CODCOLIGADA,
		FBOLETO.VENCIMENTO,
		FLAN.CODCFO
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO(NOLOCK)
	ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANBOLETO.IDLAN = FLAN.IDLAN
	
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO	
		AND DATEDIFF(DAY,GETDATE(),FBOLETO.RECMODIFIEDON) <= 7
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
	CROSS APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO		
	WHERE FLAN.PAGREC = 1
	AND FLAN.STATUSLAN IN (0,1,2,3)
	AND FLAN.CODCFO = SALUNO.CODCFO
	AND FLAN.CODCFO <> '58807'
	/*AND YEAR(FBOLETO.VENCIMENTO) > 2021*/	
	AND (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6) > 0		
) AS FLAN

GROUP BY
	FCFO.CODCFO,FCFO.NOME,FCFO.DTNASCIMENTO,FCFO.TELEX,FCFO.TELEFONE,FCFO.EMAIL,
	FCFO.CGCCFO,FCFO.RUA,FCFO.CEP,FCFO.NUMERO,FCFO.BAIRRO,FCFO.CIDADE,
	FCFO.CODETD,SALUNO.RA

) AS SUB
WHERE PATINDEX('%TESTE%',SUB.[contato.nome]) = 0
AND SUB.CONTADOR BETWEEN :INICIO AND :FIM";4427;;;;20/10/2022;shift;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;32209;wsrubeus;22/08/2022;shift;20/10/2022;0
S;RB.INT.GI.003;Envio/Atualização Boletos a vencer;"/******
	- CONSULTA PARA ENVIO DE ATUALIZAÇÃO BOLETOS A VENCER
	- GESTÃO DA PERMANÊNCIA
******/
SELECT
	SUB.CONTADOR,
	/** INFORMAÇÕES DO CONTATO **/
	SUB.CONTATOCODIGO AS 'contato.codigo',
	SUB.NOMECONTATO   AS 'contato.nome',
	SUB.NOMESOCIAL    AS 'contato.nomeSocial',
	SUB.DTNASCIMENTO  AS 'contato.dataNascimento',
	SUB.TELEFONE1     AS 'contato.telefonePrincipal',
	SUB.TELEFONE2     AS 'contato.telefonesecundario_1',
	SUB.TELEFONE3     AS 'contato.telefonesecundario_2',
	SUB.EMAIL         AS 'contato.emailPrincipal',
	SUB.CPF           AS 'contato.cpf',
	SUB.RUA      	  AS 'contato.endereco',
	SUB.CEP 		  AS 'contato.cep',
	SUB.NUMERO 		  AS 'contato.numero',
	SUB.BAIRRO 		  AS 'contato.bairro',
	SUB.CIDADE 		  AS 'contato.cidade',
	SUB.ESTADO 		  AS 'contato.estado',
	SUB.GENERO		  AS 'contato.sexo',
	SUB.ESTADOCIVIL   AS 'contato.estadoCivil',
	SUB.COR 		  AS 'contato.cor',
	1 				  AS 'contato.aluno',
		
	/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/	
	SUM(CONVERT(DECIMAL(10,2),SUB.VALORORIGINAL)) AS 'evento.campopersonalizado_9_compl_proc',
	SUM(CONVERT(DECIMAL(10,2),SUB.VALORLIQUIDO))  AS 'evento.campopersonalizado_10_compl_proc',
	SUM(CONVERT(DECIMAL(10,2),SUB.DESCONTO)) 	  AS 'evento.campopersonalizado_11_compl_proc',
	SUBSTRING((
		    SELECT DISTINCT 
		    	', '+ CONVERT(VARCHAR,PARCELA)
		    FROM SPARCELA(NOLOCK)   
		    CROSS APPLY(
		    	SELECT
		    		SLAN.CODCOLIGADA,
		    		SLAN.IDPARCELA
		    	FROM SLAN(NOLOCK)
		    	INNER JOIN FLANBOLETO(NOLOCK)
		    		ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
		    		AND FLANBOLETO.IDLAN = SLAN.IDLAN
		    		AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
		    	WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
		    	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
		    ) AS SLAN
		    WHERE SPARCELA.CODCOLIGADA = SUB.CODCOLIGADA	    
		    AND SPARCELA.RA = SUB.RA
		    /*AND CODCONTRATO = SCONTRATO.CODCONTRATO*/
		        FOR XML PATH ('')),2,1000)		  AS 'evento.campopersonalizado_15_compl_proc',
	SUB.VENCIMENTO 	  							  AS 'evento.campopersonalizado_13_compl_proc',	
	/**TIPO DE DOCUMENTO**/
	SUBSTRING((
			SELECT DISTINCT
		   		', '+DESCRICAO
			FROM FTDO(NOLOCK)
			CROSS APPLY(
				SELECT
					FLAN.CODTDO,
					FLAN.CODCOLIGADA
				FROM FLAN(NOLOCK)
				INNER JOIN FLANBOLETO(NOLOCK)
					ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
					AND FLANBOLETO.IDLAN = FLAN.IDLAN
					AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			) AS FLANSUB
		   WHERE FTDO.CODCOLIGADA = FLANSUB.CODCOLIGADA
		   AND FTDO.CODTDO = FLANSUB.CODTDO
		FOR XML PATH ('')),2,1000)				  AS 'evento.campopersonalizado_16_compl_proc',
	SUB.PERIODOLETIVO 							  AS 'evento.campopersonalizado_17_compl_proc',
	SUB.CODCFO 									  AS 'evento.campopersonalizado_18_compl_proc',
	SUB.DIASVENCIDO 							  AS 'evento.campopersonalizado_19_compl_proc',
	SUB.IDBOLETO 								  AS 'evento.campopersonalizado_20_compl_proc',
	SUB.STATUSBOLETO 							  AS 'evento.campopersonalizado_24_compl_proc',
	SUB.FILIAL									  AS 'evento.campopersonalizado_21_compl_proc',
	/** NIVEL DE ENSINO **/
	SUBSTRING((SELECT DISTINCT
					', '+STIPOCURSO.NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   CROSS APPLY(
			   		SELECT
			   			NOME
			   		FROM STIPOCURSO(NOLOCK)
			   		INNER JOIN SHABILITACAOFILIAL(NOLOCK)
						ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
						AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   			AND SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
			   			AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO
			   ) AS STIPOCURSO			   	
			FOR XML PATH ('')),2,1000)  AS	'evento.campopersonalizado_76_compl_proc',
	
	/** INFORMAÇÕES DA OFERTA **/
	SUBSTRING((SELECT DISTINCT
					', '+NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   	INNER JOIN SHABILITACAOFILIAL(NOLOCK)
					ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   INNER JOIN SCURSO(NOLOCK)
			   		ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			   		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			FOR XML PATH ('')),2,1000)		 	  AS 'evento.campopersonalizado_27_compl_proc',
	CONCAT('https://rubeusscripttotvs.apprbs.com.br/unasp/relatorio.php?p=',SUB.CONTATORESP) AS 'evento.campopersonalizado_85_compl_proc',
	
	/** INFORMAÇÕES DO EVENTO **/
	SUB.CODREGISTRO   AS 'evento.codRegistro',
	SUB.EVENTODATA 	  AS 'evento.data',
	SUB.CONTATORESP   AS 'evento.codigoResponsavelFinanceiro',
	SUB.CONTATOCODIGO AS 'evento.pessoa'
FROM (
	SELECT
		ROW_NUMBER() OVER(ORDER BY FBOLETO.IDBOLETO ASC) AS CONTADOR,
		/** INFORMAÇÕES DO CONTATO **/
		CONCAT('P-',PPESSOA.CODIGO) AS CONTATOCODIGO,
		CONCAT('R-',FLAN.CODCFO) AS CONTATORESP,
		PPESSOA.NOME AS NOMECONTATO,
		PPESSOA.NOMESOCIAL AS NOMESOCIAL,
		CONVERT(VARCHAR(10),PPESSOA.DTNASCIMENTO, 121) AS DTNASCIMENTO,
	    CASE WHEN LEN(COALESCE(PPESSOA.TELEFONE1,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE1,'(',''),')',''),' ','') END TELEFONE1,
		CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE2,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE2,'(',''),')',''),' ','') END TELEFONE2,
		CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE3,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE3,'(',''),')',''),' ','') END TELEFONE3,
		CASE WHEN (SELECT AA.EMAIL FROM PPESSOA AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
	      			AND AA.CODIGO = PPESSOA.CODIGO) IS NOT NULL 
	 	 THEN REPLACE(PPESSOA.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
	         ELSE 'sememail@rubeus.com.br' 
		END	EMAIL,
		CASE WHEN PPESSOA.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(PPESSOA.CPF) <  11
			THEN NULL 
		ELSE PPESSOA.CPF END CPF,
		PPESSOA.RUA,
		PPESSOA.CEP,
		PPESSOA.NUMERO,
		PPESSOA.BAIRRO,
		PPESSOA.CIDADE,
		PPESSOA.ESTADO,
		CASE PPESSOA.SEXO WHEN 'M' THEN 1 ELSE 2 END AS GENERO,
	  	CASE PPESSOA.ESTADOCIVIL 
			WHEN 'C' THEN 1 /*CASADO */
			WHEN 'D' THEN 2 /*DESQUITADO */
			WHEN 'E' THEN 3 /*UNIAO ESTAVEL */
			WHEN 'I' THEN 4 /*DIVORCIADO */
			WHEN 'O' THEN 5 /*OUTROS */
			WHEN 'P' THEN 6 /*SEPARADO */
			WHEN 'S' THEN 7 /*SOLTEIRO */
			WHEN 'V' THEN 8 /*VIUVO */
		END AS ESTADOCIVIL,
		CASE PPESSOA.CORRACA
			WHEN 0 THEN 1
			WHEN 2 THEN 2
			WHEN 4 THEN 3
			WHEN 6 THEN 4
			WHEN 8 THEN 5
			WHEN 9 THEN 6
			WHEN 10 THEN 7
		END COR,
		
		/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
		FLAN.IDLAN,
		SALUNO.RA,
		FLAN.CODCOLIGADA,
		SCONTRATO.CODCONTRATO,
		FLAN.VALORORIGINAL AS VALORORIGINAL,
		(FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) AS VALORLIQUIDO,
		(FLAN.VALOROP2 + FLAN.VALOROP5 + FLAN.VALOROP6 + ISNULL(FLANINTEGRACAO.VALOR,0)) AS DESCONTO,
		/*'Valor baixado' AS 'evento.campopersonalizado_12_compl_proc',*/
		CONVERT(VARCHAR,FBOLETO.VENCIMENTO,103) AS VENCIMENTO,
		/*'Data baixa' AS 'evento.campopersonalizado_14_compl_proc',*/
		
		SMATRICPL.PERIODOLETIVO,
		FLAN.CODCFO,
		DATEDIFF(DAY,FBOLETO.VENCIMENTO,GETDATE()) AS DIASVENCIDO,
		FBOLETO.IDBOLETO,
		CASE 
			WHEN FBOLETO.CNABSTATUS	= 0 THEN 'Não Remetido'
			WHEN FBOLETO.CNABSTATUS	= 1 THEN 'Remetido'
			WHEN FBOLETO.CNABSTATUS	= 2 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 3 THEN 'Recusado'
			WHEN FBOLETO.CNABSTATUS	= 4 THEN 'Baixado'
			WHEN FBOLETO.CNABSTATUS	= 5 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 6 THEN 'Cancelado'
			WHEN FBOLETO.CNABSTATUS	= 7 THEN 'Pendente Remessa'
		ELSE 'Boleto sem status' END AS STATUSBOLETO,
		FILIAL.NOME AS FILIAL,
		
	  	/** INFORMAÇÕES DO EVENTO **/
	  	CONCAT('GI-',FLAN.CODCOLIGADA,'-',FLAN.CODFILIAL,'-',FBOLETO.IDBOLETO) AS CODREGISTRO, 
		/*CONVERT(VARCHAR(30), CAST(FBOLETO.VENCIMENTO AS DATETIME), 121) AS EVENTODATA*/
		CONCAT(CONVERT(VARCHAR(10), CAST(FBOLETO.VENCIMENTO AS DATETIME), 121),' 08:00:00') AS EVENTODATA
		
	FROM FLAN(NOLOCK)
	/**DESCONTOS ABA INTEGRACAO**/
	OUTER APPLY(
		SELECT 
			SUM(VALOR) AS VALOR
		FROM FLANINTEGRACAO (NOLOCK) 
		WHERE FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA
	    AND FLANINTEGRACAO.IDLAN = FLAN.IDLAN
	    AND VALOR > 0
	) AS FLANINTEGRACAO
	
	INNER JOIN FLANBOLETO(NOLOCK)
		ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANBOLETO.IDLAN = FLAN.IDLAN
		
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FBOLETO.VENCIMENTO > GETDATE()
		AND DATEDIFF(DAY,GETDATE(), FBOLETO.VENCIMENTO) <= 7		
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	
	CROSS APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO
		
	OUTER APPLY(
		SELECT
			NOME
		FROM GFILIAL(NOLOCK)
		WHERE CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODFILIAL = FLAN.CODFILIAL
	) AS FILIAL
	
	INNER JOIN SALUNO(NOLOCK)
		ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SALUNO.RA = SCONTRATO.RA
		
	INNER JOIN PPESSOA(NOLOCK)
		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	
	/**DADOS MATRICULA**/
	CROSS APPLY(
		SELECT DISTINCT
			SMATRICPL.CODCOLIGADA,
			SMATRICPL.RA,
			CODSTATUS,
			SPLETIVO.CODPERLET AS PERIODOLETIVO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SPLETIVO(NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			/**NAO CONSIDERAR ALUNOS FIES**/
		CROSS APPLY(
			SELECT
				SHABILITACAOALUNOCOMPL.CODCOLIGADA,
				SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
				SHABILITACAOALUNOCOMPL.RA
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
			AND ISNULL(FIES,'F') = 'F'
		) AS SHABILITACAO
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.CODSTATUS IN (2,3,4,7,10,    /**GRADUACAO**/
									27,28,29,46,50,/**POS GRADUACAO**/
									23,24,25,67 )  /**EXTENSAO/LIVRE**/
	) AS SMATRICPL
	
	WHERE FLAN.PAGREC = 1
	AND FLAN.STATUSLAN = 0	
	AND FLAN.CODCFO <> '58807'
	AND (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) > 0
	
	GROUP BY PPESSOA.CODIGO,PPESSOA.NOME,PPESSOA.NOMESOCIAL,PPESSOA.DTNASCIMENTO,
			 PPESSOA.TELEFONE1,PPESSOA.TELEFONE2,PPESSOA.TELEFONE3,PPESSOA.EMAIL,
			 PPESSOA.CPF,PPESSOA.CPF,PPESSOA.RUA,PPESSOA.CEP,PPESSOA.NUMERO,
			 PPESSOA.BAIRRO,PPESSOA.CIDADE,PPESSOA.ESTADO,PPESSOA.SEXO,
			 PPESSOA.ESTADOCIVIL,PPESSOA.CORRACA,FLAN.IDLAN,FLAN.VALORORIGINAL,
			 FBOLETO.VENCIMENTO,SMATRICPL.PERIODOLETIVO,FLAN.CODCFO,FLAN.CODTDO,
			 FBOLETO.IDBOLETO,FBOLETO.CNABSTATUS,FBOLETO.CNABSTATUS,FBOLETO.IPTE,
			 FLAN.CODCOLIGADA,FLAN.CODFILIAL,SCONTRATO.RA,FLAN.VALOROP2,
			 FLAN.VALOROP5,FLAN.VALOROP6,FLANINTEGRACAO.VALOR,SLAN.CODCOLIGADA,
			 SLAN.IDPARCELA,SCONTRATO.CODCONTRATO,SCONTRATO.IDHABILITACAOFILIAL,
			 SCONTRATO.CODCOLIGADA,SALUNO.RA,SPARCELA.CODCOLIGADA,FLAN.CODCFO,
			 SPARCELA.CODCONTRATO,FILIAL.NOME
) AS SUB
WHERE SUB.CONTADOR BETWEEN :INICIO AND :FIM
/*AND SUB.CODREGISTRO = 'GI-1-1-47594'*/
GROUP BY SUB.CONTATOCODIGO,SUB.NOMECONTATO,SUB.NOMESOCIAL,SUB.RA,
		 SUB.DTNASCIMENTO,SUB.TELEFONE1,SUB.TELEFONE2,SUB.TELEFONE3,SUB.EMAIL,
		 SUB.CPF,SUB.RUA,SUB.CEP,SUB.NUMERO,SUB.BAIRRO,SUB.CIDADE,SUB.ESTADO,
		 SUB.GENERO,SUB.ESTADOCIVIL,SUB.COR,SUB.VENCIMENTO,SUB.CODCOLIGADA,
		 SUB.PERIODOLETIVO,SUB.CODCFO,SUB.DIASVENCIDO,SUB.IDBOLETO,
		 SUB.STATUSBOLETO,SUB.CODREGISTRO,SUB.EVENTODATA,SUB.FILIAL,
		 SUB.CONTATORESP, SUB.CONTADOR";13959;;;;04/10/2022;shift;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;1196;wsrubeus;08/04/2022;shift;04/10/2022;0
S;RB.INT.GI.004;Envio/Atualização Boletos vencidos;"/******
	- CONSULTA PARA ENVIO E ATUALIZAÇÃO DOS BOLETOS VENCIDOS
	- GESTÃO DA PERMANÊNCIA
******/
SELECT 
	SUB.CONTADOR,
	/** INFORMAÇÕES DO CONTATO **/
	SUB.CONTATOCODIGO AS 'contato.codigo',
	SUB.NOMECONTATO   AS 'contato.nome',
	SUB.NOMESOCIAL    AS 'contato.nomeSocial',
	SUB.DTNASCIMENTO  AS 'contato.dataNascimento',
	SUB.TELEFONE1     AS 'contato.telefonePrincipal',
	SUB.TELEFONE2     AS 'contato.telefonesecundario_1',
	SUB.TELEFONE3     AS 'contato.telefonesecundario_2',
	SUB.EMAIL         AS 'contato.emailPrincipal',
	SUB.CPF           AS 'contato.cpf',
	SUB.RUA      	  AS 'contato.endereco',
	SUB.CEP 		  AS 'contato.cep',
	SUB.NUMERO 		  AS 'contato.numero',
	SUB.BAIRRO 		  AS 'contato.bairro',
	SUB.CIDADE 		  AS 'contato.cidade',
	SUB.ESTADO 		  AS 'contato.estado',
	SUB.GENERO		  AS 'contato.sexo',
	SUB.ESTADOCIVIL   AS 'contato.estadoCivil',
	SUB.COR 		  AS 'contato.cor',
		
	/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/	
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORORIGINAL)) AS 'evento.campopersonalizado_9_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORLIQUIDO))  AS 'evento.campopersonalizado_10_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.DESCONTO))	  AS 'evento.campopersonalizado_11_compl_proc',
	SUBSTRING((
	    SELECT DISTINCT 
	    	', '+ CONVERT(VARCHAR,PARCELA)
	    FROM SPARCELA(NOLOCK)   
	    CROSS APPLY(
	    	SELECT
	    		SLAN.CODCOLIGADA,
	    		SLAN.IDPARCELA
	    	FROM SLAN(NOLOCK)
	    	INNER JOIN FLANBOLETO(NOLOCK)
	    		ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
	    		AND FLANBOLETO.IDLAN = SLAN.IDLAN
	    		AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
	    	WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	    	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
	    ) AS SLAN
	    WHERE SPARCELA.CODCOLIGADA = SUB.CODCOLIGADA	    
	    AND SPARCELA.RA = SUB.RA
	    /*AND CODCONTRATO = SCONTRATO.CODCONTRATO*/
	        FOR XML PATH ('')),2,1000)		      AS 'evento.campopersonalizado_15_compl_proc',
	SUB.VENCIMENTO 	  							  AS 'evento.campopersonalizado_13_compl_proc',	
	/**TIPO DE DOCUMENTO**/
	SUBSTRING((
		SELECT DISTINCT
	   		', '+DESCRICAO
		FROM FTDO(NOLOCK)
		CROSS APPLY(
			SELECT
				FLAN.CODTDO,
				FLAN.CODCOLIGADA
			FROM FLAN(NOLOCK)
			INNER JOIN FLANBOLETO(NOLOCK)
				ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
				AND FLANBOLETO.IDLAN = FLAN.IDLAN
				AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
		) AS FLANSUB
	   WHERE FTDO.CODCOLIGADA = FLANSUB.CODCOLIGADA
	   AND FTDO.CODTDO = FLANSUB.CODTDO
	FOR XML PATH ('')),2,1000) 					  AS 'evento.campopersonalizado_16_compl_proc',
	SUB.PERIODOLETIVO 							  AS 'evento.campopersonalizado_17_compl_proc',
	SUB.CODCFO 									  AS 'evento.campopersonalizado_18_compl_proc',
	SUB.DIASVENCIDO 							  AS 'evento.campopersonalizado_19_compl_proc',
	SUB.IDBOLETO 								  AS 'evento.campopersonalizado_20_compl_proc',
	SUB.STATUSBOLETO 							  AS 'evento.campopersonalizado_24_compl_proc',
	SUB.FILIAL									  AS 'evento.campopersonalizado_21_compl_proc',
	/** NIVEL DE ENSINO **/
	SUBSTRING((SELECT DISTINCT
					', '+STIPOCURSO.NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   CROSS APPLY(
			   		SELECT
			   			NOME
			   		FROM STIPOCURSO(NOLOCK)
			   		INNER JOIN SHABILITACAOFILIAL(NOLOCK)
						ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
						AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   			AND SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
			   			AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO
			   ) AS STIPOCURSO			   	
			FOR XML PATH ('')),2,1000)  AS	'evento.campopersonalizado_76_compl_proc',	
	/** INFORMAÇÕES DO CURSO **/
	SUBSTRING((SELECT DISTINCT
							', '+NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   	INNER JOIN SHABILITACAOFILIAL(NOLOCK)
					ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   INNER JOIN SCURSO(NOLOCK)
			   		ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			   		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			FOR XML PATH ('')),2,1000)		 	  AS 'evento.campopersonalizado_27_compl_proc',
	CONCAT('https://rubeusscripttotvs.apprbs.com.br/unasp/relatorio.php?p=',SUB.CONTATORESP) AS 'evento.campopersonalizado_85_compl_proc',		
	
	/** INFORMAÇÕES DO EVENTO **/
	SUB.CODREGISTRO  AS 'evento.codRegistro',
	SUB.EVENTODATA 	 AS 'evento.data',
	SUB.CONTATORESP   AS 'evento.codigoResponsavelFinanceiro',
	SUB.CONTATOCODIGO AS 'evento.pessoa'
FROM (
	SELECT
		ROW_NUMBER() OVER(ORDER BY FBOLETO.IDBOLETO ASC) AS CONTADOR,	
		/** INFORMAÇÕES DO CONTATO **/
		PPESSOA.CONTATOCODIGO,
		CONCAT('R-',FLAN.CODCFO) AS CONTATORESP,
		PPESSOA.NOMECONTATO,
		PPESSOA.NOMESOCIAL,
		PPESSOA.DTNASCIMENTO,
	    PPESSOA.TELEFONE1,
		PPESSOA.TELEFONE2,
		PPESSOA.TELEFONE3,
		PPESSOA.EMAIL,
		PPESSOA.CPF,
		PPESSOA.RUA,
		PPESSOA.CEP,
		PPESSOA.NUMERO,
		PPESSOA.BAIRRO,
		PPESSOA.CIDADE,
		PPESSOA.ESTADO,
		PPESSOA.GENERO,
	  	PPESSOA.ESTADOCIVIL,
		PPESSOA.COR,
		
		/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
		FLAN.IDLAN,
		PPESSOA.RA,
		FLAN.CODCOLIGADA,
		FLAN.VALORORIGINAL AS VALORORIGINAL,
		CASE 
			WHEN SPARCELA.PARCELA = 1 THEN (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) 
		ELSE (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0))
			+ ((FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) * 0.02)
			+ ((((FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) * 0.01) / 30) * DATEDIFF(DAY, FLAN.DATAVENCIMENTO, GETDATE()))
		END AS VALORLIQUIDO,
		(FLAN.VALOROP2 + FLAN.VALOROP5 + FLAN.VALOROP6 + ISNULL(FLANINTEGRACAO.VALOR,0)) AS DESCONTO,
		/*'Valor baixado' AS 'evento.campopersonalizado_12_compl_proc',*/
		CONVERT(VARCHAR,FBOLETO.VENCIMENTO,103) AS VENCIMENTO,
		/*'Data baixa' AS 'evento.campopersonalizado_14_compl_proc',*/
		SMATRICPL.PERIODOLETIVO,
		FLAN.CODCFO,
		DATEDIFF(DAY,FBOLETO.VENCIMENTO,GETDATE()) AS DIASVENCIDO,
		FBOLETO.IDBOLETO,
		CASE 
			WHEN FBOLETO.CNABSTATUS	= 0 THEN 'Não Remetido'
			WHEN FBOLETO.CNABSTATUS	= 1 THEN 'Remetido'
			WHEN FBOLETO.CNABSTATUS	= 2 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 3 THEN 'Recusado'
			WHEN FBOLETO.CNABSTATUS	= 4 THEN 'Baixado'
			WHEN FBOLETO.CNABSTATUS	= 5 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 6 THEN 'Cancelado'
			WHEN FBOLETO.CNABSTATUS	= 7 THEN 'Pendente Remessa'
		ELSE 'Boleto sem status' END AS STATUSBOLETO,
		FILIAL.NOME AS FILIAL,
		
	  	/** INFORMAÇÕES DO EVENTO **/
	  	CONCAT('GI-',FLAN.CODCOLIGADA,'-',FLAN.CODFILIAL,'-',FBOLETO.IDBOLETO) AS CODREGISTRO, 
		CONCAT(CONVERT(VARCHAR(10), CAST(FBOLETO.VENCIMENTO AS DATETIME), 121),' 08:00:00') AS EVENTODATA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO(NOLOCK)
		ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANBOLETO.IDLAN = FLAN.IDLAN
		
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FBOLETO.VENCIMENTO < GETDATE()
		AND DATEDIFF(DAY,FBOLETO.VENCIMENTO,GETDATE()) BETWEEN 1 AND 8		
		AND FBOLETO.STATUS = 0
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO

	CROSS APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO
	
	OUTER APPLY(
		SELECT
			NOME
		FROM GFILIAL(NOLOCK)
		WHERE CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODFILIAL = FLAN.CODFILIAL
	) AS FILIAL
	
	/**DESCONTOS ABA INTEGRACAO**/
	OUTER APPLY(
		SELECT 
			SUM(VALOR) AS VALOR
		FROM FLANINTEGRACAO (NOLOCK) 
		WHERE FLANBOLETO.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA
	    AND FLANBOLETO.IDLAN = FLANINTEGRACAO.IDLAN
	    AND FLANINTEGRACAO.IDCAMPO NOT IN (48,49,52)
	    AND VALOR > 0
	) AS FLANINTEGRACAO

	/**DADOS ALUNO**/
	CROSS APPLY(
		SELECT
			CONCAT('P-',PPESSOA.CODIGO) AS CONTATOCODIGO,
			PPESSOA.NOME AS NOMECONTATO,
			PPESSOA.NOMESOCIAL AS NOMESOCIAL,
			CONVERT(VARCHAR(10),PPESSOA.DTNASCIMENTO, 121) AS DTNASCIMENTO,
		    CASE WHEN LEN(COALESCE(PPESSOA.TELEFONE1,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE1,'(',''),')',''),' ','') END TELEFONE1,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE2,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE2,'(',''),')',''),' ','') END TELEFONE2,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE3,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE3,'(',''),')',''),' ','') END TELEFONE3,
			CASE WHEN (SELECT AA.EMAIL FROM PPESSOA AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
		      			AND AA.CODIGO = PPESSOA.CODIGO) IS NOT NULL 
		 	 THEN REPLACE(PPESSOA.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
		         ELSE 'sememail@rubeus.com.br' 
			END	EMAIL,
			CASE WHEN PPESSOA.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(PPESSOA.CPF) <  11
				THEN NULL 
			ELSE PPESSOA.CPF END CPF,
			PPESSOA.RUA,
			PPESSOA.CEP,
			PPESSOA.NUMERO,
			PPESSOA.BAIRRO,
			PPESSOA.CIDADE,
			PPESSOA.ESTADO,
			CASE PPESSOA.SEXO WHEN 'M' THEN 1 ELSE 2 END AS GENERO,
		  	CASE PPESSOA.ESTADOCIVIL 
				WHEN 'C' THEN 1 /*CASADO */
				WHEN 'D' THEN 2 /*DESQUITADO */
				WHEN 'E' THEN 3 /*UNIAO ESTAVEL */
				WHEN 'I' THEN 4 /*DIVORCIADO */
				WHEN 'O' THEN 5 /*OUTROS */
				WHEN 'P' THEN 6 /*SEPARADO */
				WHEN 'S' THEN 7 /*SOLTEIRO */
				WHEN 'V' THEN 8 /*VIUVO */
			END AS ESTADOCIVIL,
			CASE PPESSOA.CORRACA
				WHEN 0 THEN 1
				WHEN 2 THEN 2
				WHEN 4 THEN 3
				WHEN 6 THEN 4
				WHEN 8 THEN 5
				WHEN 9 THEN 6
				WHEN 10 THEN 7
			END COR,
			SALUNO.RA
		FROM SALUNO(NOLOCK)
		INNER JOIN PPESSOA(NOLOCK)
			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
		WHERE SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SALUNO.RA = SCONTRATO.RA
	) AS PPESSOA		
	
	/**DADOS MATRICULA**/
	CROSS APPLY(
		SELECT DISTINCT
			SMATRICPL.CODCOLIGADA,
			SMATRICPL.RA,
			CODSTATUS,
			SPLETIVO.CODPERLET AS PERIODOLETIVO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SPLETIVO(NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			/**NAO CONSIDERAR ALUNOS FIES**/
		CROSS APPLY(
			SELECT
				SHABILITACAOALUNOCOMPL.CODCOLIGADA,
				SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
				SHABILITACAOALUNOCOMPL.RA
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
			AND ISNULL(FIES,'F') = 'F'
		) AS SHABILITACAO
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.CODSTATUS IN (2,3,4,7,10,    /**GRADUACAO**/
									27,28,29,46,50,/**POS GRADUACAO**/
									23,24,25,67  )  /**EXTENSAO/LIVRE**/
	) AS SMATRICPL
	
	WHERE FLAN.PAGREC = 1
	AND FLAN.STATUSLAN = 0	
	/**NAO CONSIDERAR CAIXA ECONOMICA**/
	AND FLAN.CODCFO <> '58807'
	AND (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) > 0
	
	GROUP BY PPESSOA.CONTATOCODIGO,PPESSOA.NOMECONTATO,PPESSOA.NOMESOCIAL,
			 PPESSOA.DTNASCIMENTO,PPESSOA.TELEFONE1,PPESSOA.TELEFONE2,
			 PPESSOA.TELEFONE3,PPESSOA.EMAIL,PPESSOA.CPF,PPESSOA.CPF,PPESSOA.RA,
			 PPESSOA.RUA,PPESSOA.CEP,PPESSOA.NUMERO,PPESSOA.BAIRRO,FBOLETO.IPTE,
			 PPESSOA.CIDADE,PPESSOA.ESTADO,PPESSOA.GENERO,PPESSOA.ESTADOCIVIL,
			 PPESSOA.COR,FLAN.IDLAN,FLAN.VALORORIGINAL,FBOLETO.VENCIMENTO,
			 SMATRICPL.PERIODOLETIVO,FLAN.CODCFO,FLAN.CODTDO,FBOLETO.IDBOLETO,
			 FBOLETO.CNABSTATUS,FBOLETO.CNABSTATUS,FLAN.CODCOLIGADA,
			 FLAN.CODFILIAL,SCONTRATO.RA,FLAN.VALOROP2,FLAN.VALOROP5,
			 FLAN.VALOROP6,FLANINTEGRACAO.VALOR,SLAN.IDPARCELA,FLAN.CODCFO,
			 SCONTRATO.CODCONTRATO,SLAN.CODCOLIGADA,FLAN.DATAVENCIMENTO,
			 SCONTRATO.CODCOLIGADA,SCONTRATO.IDHABILITACAOFILIAL,SPARCELA.PARCELA,
			 SPARCELA.CODCOLIGADA,SPARCELA.CODCONTRATO,FILIAL.NOME
) AS SUB
WHERE SUB.CONTADOR BETWEEN :INICIO AND :FIM

GROUP BY SUB.CONTATOCODIGO,SUB.NOMECONTATO,SUB.NOMESOCIAL,SUB.CODCOLIGADA,
		 SUB.DTNASCIMENTO,SUB.TELEFONE1,SUB.TELEFONE2,SUB.TELEFONE3,SUB.EMAIL,
		 SUB.CPF,SUB.RUA,SUB.CEP,SUB.NUMERO,SUB.BAIRRO,SUB.CIDADE,SUB.ESTADO,
		 SUB.GENERO,SUB.ESTADOCIVIL,SUB.COR,SUB.VENCIMENTO,SUB.CONTATORESP,
		 SUB.PERIODOLETIVO,SUB.CODCFO,SUB.DIASVENCIDO,SUB.IDBOLETO,SUB.RA,
		 SUB.STATUSBOLETO,SUB.CODREGISTRO,SUB.EVENTODATA,SUB.FILIAL,
		 SUB.CONTADOR";14873;;;;03/11/2022;shift;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;-31155;wsrubeus;08/04/2022;shift;03/11/2022;0
S;RB.INT.GI.004.1;Envio/Atualização Boletos vencidos;"/******
	- CONSULTA PARA ENVIO E ATUALIZAÇÃO DOS BOLETOS VENCIDOS
	- GESTÃO DA PERMANÊNCIA
******/
SELECT 
	SUB.CONTADOR,
	/** INFORMAÇÕES DO CONTATO **/
	SUB.CONTATOCODIGO AS 'contato.codigo',
	SUB.NOMECONTATO   AS 'contato.nome',
	SUB.NOMESOCIAL    AS 'contato.nomeSocial',
	SUB.DTNASCIMENTO  AS 'contato.dataNascimento',
	SUB.TELEFONE1     AS 'contato.telefonePrincipal',
	SUB.TELEFONE2     AS 'contato.telefonesecundario_1',
	SUB.TELEFONE3     AS 'contato.telefonesecundario_2',
	SUB.EMAIL         AS 'contato.emailPrincipal',
	SUB.CPF           AS 'contato.cpf',
	SUB.RUA      	  AS 'contato.endereco',
	SUB.CEP 		  AS 'contato.cep',
	SUB.NUMERO 		  AS 'contato.numero',
	SUB.BAIRRO 		  AS 'contato.bairro',
	SUB.CIDADE 		  AS 'contato.cidade',
	SUB.ESTADO 		  AS 'contato.estado',
	SUB.GENERO		  AS 'contato.sexo',
	SUB.ESTADOCIVIL   AS 'contato.estadoCivil',
	SUB.COR 		  AS 'contato.cor',
		
	/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/	
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORORIGINAL)) AS 'evento.campopersonalizado_9_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORLIQUIDO))  AS 'evento.campopersonalizado_10_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.DESCONTO))	  AS 'evento.campopersonalizado_11_compl_proc',
	SUBSTRING((
	    SELECT DISTINCT 
	    	', '+ CONVERT(VARCHAR,PARCELA)
	    FROM SPARCELA(NOLOCK)   
	    CROSS APPLY(
	    	SELECT
	    		SLAN.CODCOLIGADA,
	    		SLAN.IDPARCELA
	    	FROM SLAN(NOLOCK)
	    	INNER JOIN FLANBOLETO(NOLOCK)
	    		ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
	    		AND FLANBOLETO.IDLAN = SLAN.IDLAN
	    		AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
	    	WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	    	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
	    ) AS SLAN
	    WHERE SPARCELA.CODCOLIGADA = SUB.CODCOLIGADA	    
	    AND SPARCELA.RA = SUB.RA
	    /*AND CODCONTRATO = SCONTRATO.CODCONTRATO*/
	        FOR XML PATH ('')),2,1000)		      AS 'evento.campopersonalizado_15_compl_proc',
	SUB.VENCIMENTO 	  							  AS 'evento.campopersonalizado_13_compl_proc',	
	/**TIPO DE DOCUMENTO**/
	SUBSTRING((
		SELECT DISTINCT
	   		', '+DESCRICAO
		FROM FTDO(NOLOCK)
		CROSS APPLY(
			SELECT
				FLAN.CODTDO,
				FLAN.CODCOLIGADA
			FROM FLAN(NOLOCK)
			INNER JOIN FLANBOLETO(NOLOCK)
				ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
				AND FLANBOLETO.IDLAN = FLAN.IDLAN
				AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
		) AS FLANSUB
	   WHERE FTDO.CODCOLIGADA = FLANSUB.CODCOLIGADA
	   AND FTDO.CODTDO = FLANSUB.CODTDO
	FOR XML PATH ('')),2,1000) 					  AS 'evento.campopersonalizado_16_compl_proc',
	SUB.PERIODOLETIVO 							  AS 'evento.campopersonalizado_17_compl_proc',
	SUB.CODCFO 									  AS 'evento.campopersonalizado_18_compl_proc',
	SUB.DIASVENCIDO 							  AS 'evento.campopersonalizado_19_compl_proc',
	SUB.IDBOLETO 								  AS 'evento.campopersonalizado_20_compl_proc',
	SUB.STATUSBOLETO 							  AS 'evento.campopersonalizado_24_compl_proc',
	SUB.FILIAL									  AS 'evento.campopersonalizado_21_compl_proc',
	/** NIVEL DE ENSINO **/
	SUBSTRING((SELECT DISTINCT
					', '+STIPOCURSO.NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   CROSS APPLY(
			   		SELECT
			   			NOME
			   		FROM STIPOCURSO(NOLOCK)
			   		INNER JOIN SHABILITACAOFILIAL(NOLOCK)
						ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
						AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   			AND SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
			   			AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO
			   ) AS STIPOCURSO			   	
			FOR XML PATH ('')),2,1000)  AS	'evento.campopersonalizado_76_compl_proc',	
	/** INFORMAÇÕES DO CURSO **/
	SUBSTRING((SELECT DISTINCT
							', '+NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   	INNER JOIN SHABILITACAOFILIAL(NOLOCK)
					ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   INNER JOIN SCURSO(NOLOCK)
			   		ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			   		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			FOR XML PATH ('')),2,1000)		 	  AS 'evento.campopersonalizado_27_compl_proc',
	CONCAT('https://rubeusscripttotvs.apprbs.com.br/unasp/relatorio.php?p=',SUB.CONTATORESP) AS 'evento.campopersonalizado_85_compl_proc',		
	SUB.FIES,
	/** INFORMAÇÕES DO EVENTO **/
	SUB.CODREGISTRO  AS 'evento.codRegistro',
	SUB.EVENTODATA 	 AS 'evento.data',
	SUB.CONTATORESP   AS 'evento.codigoResponsavelFinanceiro',
	SUB.CONTATOCODIGO AS 'evento.pessoa'
FROM (
	SELECT
		ROW_NUMBER() OVER(ORDER BY FBOLETO.IDBOLETO ASC) AS CONTADOR,	
		/** INFORMAÇÕES DO CONTATO **/
		PPESSOA.CONTATOCODIGO,
		CONCAT('R-',FLAN.CODCFO) AS CONTATORESP,
		PPESSOA.NOMECONTATO,
		PPESSOA.NOMESOCIAL,
		PPESSOA.DTNASCIMENTO,
	    PPESSOA.TELEFONE1,
		PPESSOA.TELEFONE2,
		PPESSOA.TELEFONE3,
		PPESSOA.EMAIL,
		PPESSOA.CPF,
		PPESSOA.RUA,
		PPESSOA.CEP,
		PPESSOA.NUMERO,
		PPESSOA.BAIRRO,
		PPESSOA.CIDADE,
		PPESSOA.ESTADO,
		PPESSOA.GENERO,
	  	PPESSOA.ESTADOCIVIL,
		PPESSOA.COR,
		
		/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
		FLAN.IDLAN,
		PPESSOA.RA,
		FLAN.CODCOLIGADA,
		FLAN.VALORORIGINAL AS VALORORIGINAL,
		CASE 
			WHEN SPARCELA.PARCELA = 1 THEN (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) 
		ELSE (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0))
			+ ((FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) * 0.02)
			+ ((((FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) * 0.01) / 30) * DATEDIFF(DAY, FLAN.DATAVENCIMENTO, GETDATE()))
		END AS VALORLIQUIDO,
		(FLAN.VALOROP2 + FLAN.VALOROP5 + FLAN.VALOROP6 + ISNULL(FLANINTEGRACAO.VALOR,0)) AS DESCONTO,
		/*'Valor baixado' AS 'evento.campopersonalizado_12_compl_proc',*/
		CONVERT(VARCHAR,FBOLETO.VENCIMENTO,103) AS VENCIMENTO,
		/*'Data baixa' AS 'evento.campopersonalizado_14_compl_proc',*/
		SMATRICPL.PERIODOLETIVO,
		FLAN.CODCFO,
		DATEDIFF(DAY,FBOLETO.VENCIMENTO,GETDATE()) AS DIASVENCIDO,
		FBOLETO.IDBOLETO,
		CASE 
			WHEN FBOLETO.CNABSTATUS	= 0 THEN 'Não Remetido'
			WHEN FBOLETO.CNABSTATUS	= 1 THEN 'Remetido'
			WHEN FBOLETO.CNABSTATUS	= 2 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 3 THEN 'Recusado'
			WHEN FBOLETO.CNABSTATUS	= 4 THEN 'Baixado'
			WHEN FBOLETO.CNABSTATUS	= 5 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 6 THEN 'Cancelado'
			WHEN FBOLETO.CNABSTATUS	= 7 THEN 'Pendente Remessa'
		ELSE 'Boleto sem status' END AS STATUSBOLETO,
		FILIAL.NOME AS FILIAL,
		SMATRICPL.FIES,
		
	  	/** INFORMAÇÕES DO EVENTO **/
	  	CONCAT('GI-',FLAN.CODCOLIGADA,'-',FLAN.CODFILIAL,'-',FBOLETO.IDBOLETO) AS CODREGISTRO, 
		CONCAT(CONVERT(VARCHAR(10), CAST(FBOLETO.VENCIMENTO AS DATETIME), 121),' 08:00:00') AS EVENTODATA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO(NOLOCK)
		ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANBOLETO.IDLAN = FLAN.IDLAN
		
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
		/*AND FBOLETO.STATUS = 0*/
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO

	OUTER APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO
	
	OUTER APPLY(
		SELECT
			NOME
		FROM GFILIAL(NOLOCK)
		WHERE CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODFILIAL = FLAN.CODFILIAL
	) AS FILIAL
	
	/**DESCONTOS ABA INTEGRACAO**/
	OUTER APPLY(
		SELECT 
			SUM(VALOR) AS VALOR
		FROM FLANINTEGRACAO (NOLOCK) 
		WHERE FLANBOLETO.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA
	    AND FLANBOLETO.IDLAN = FLANINTEGRACAO.IDLAN
	    AND FLANINTEGRACAO.IDCAMPO NOT IN (48,49,52)
	    AND VALOR > 0
	) AS FLANINTEGRACAO

	/**DADOS ALUNO**/
	CROSS APPLY(
		SELECT
			CONCAT('P-',PPESSOA.CODIGO) AS CONTATOCODIGO,
			PPESSOA.NOME AS NOMECONTATO,
			PPESSOA.NOMESOCIAL AS NOMESOCIAL,
			CONVERT(VARCHAR(10),PPESSOA.DTNASCIMENTO, 121) AS DTNASCIMENTO,
		    CASE WHEN LEN(COALESCE(PPESSOA.TELEFONE1,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE1,'(',''),')',''),' ','') END TELEFONE1,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE2,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE2,'(',''),')',''),' ','') END TELEFONE2,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE3,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE3,'(',''),')',''),' ','') END TELEFONE3,
			CASE WHEN (SELECT AA.EMAIL FROM PPESSOA AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
		      			AND AA.CODIGO = PPESSOA.CODIGO) IS NOT NULL 
		 	 THEN REPLACE(PPESSOA.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
		         ELSE 'sememail@rubeus.com.br' 
			END	EMAIL,
			CASE WHEN PPESSOA.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(PPESSOA.CPF) <  11
				THEN NULL 
			ELSE PPESSOA.CPF END CPF,
			PPESSOA.RUA,
			PPESSOA.CEP,
			PPESSOA.NUMERO,
			PPESSOA.BAIRRO,
			PPESSOA.CIDADE,
			PPESSOA.ESTADO,
			CASE PPESSOA.SEXO WHEN 'M' THEN 1 ELSE 2 END AS GENERO,
		  	CASE PPESSOA.ESTADOCIVIL 
				WHEN 'C' THEN 1 /*CASADO */
				WHEN 'D' THEN 2 /*DESQUITADO */
				WHEN 'E' THEN 3 /*UNIAO ESTAVEL */
				WHEN 'I' THEN 4 /*DIVORCIADO */
				WHEN 'O' THEN 5 /*OUTROS */
				WHEN 'P' THEN 6 /*SEPARADO */
				WHEN 'S' THEN 7 /*SOLTEIRO */
				WHEN 'V' THEN 8 /*VIUVO */
			END AS ESTADOCIVIL,
			CASE PPESSOA.CORRACA
				WHEN 0 THEN 1
				WHEN 2 THEN 2
				WHEN 4 THEN 3
				WHEN 6 THEN 4
				WHEN 8 THEN 5
				WHEN 9 THEN 6
				WHEN 10 THEN 7
			END COR,
			SALUNO.RA
		FROM SALUNO(NOLOCK)
		INNER JOIN PPESSOA(NOLOCK)
			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
		WHERE SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SALUNO.RA = SCONTRATO.RA
	) AS PPESSOA		
	
	/**DADOS MATRICULA**/
	OUTER APPLY(
		SELECT DISTINCT
			SMATRICPL.CODCOLIGADA,
			SMATRICPL.RA,
			CODSTATUS,
			SPLETIVO.CODPERLET AS PERIODOLETIVO,
			SHABILITACAO.FIES
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SPLETIVO(NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			/**NAO CONSIDERAR ALUNOS FIES**/
		OUTER APPLY(
			SELECT
				SHABILITACAOALUNOCOMPL.CODCOLIGADA,
				SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
				SHABILITACAOALUNOCOMPL.RA,
				FIES
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
			AND ISNULL(FIES,'F') = 'F'
		) AS SHABILITACAO
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.RA = SCONTRATO.RA
	) AS SMATRICPL
	
	WHERE FBOLETO.IDBOLETO IN (45568,45580,80339,115160,221665,289253,312706,313021,313242,316638,340115)
	
	GROUP BY PPESSOA.CONTATOCODIGO,PPESSOA.NOMECONTATO,PPESSOA.NOMESOCIAL,
			 PPESSOA.DTNASCIMENTO,PPESSOA.TELEFONE1,PPESSOA.TELEFONE2,
			 PPESSOA.TELEFONE3,PPESSOA.EMAIL,PPESSOA.CPF,PPESSOA.CPF,PPESSOA.RA,
			 PPESSOA.RUA,PPESSOA.CEP,PPESSOA.NUMERO,PPESSOA.BAIRRO,FBOLETO.IPTE,
			 PPESSOA.CIDADE,PPESSOA.ESTADO,PPESSOA.GENERO,PPESSOA.ESTADOCIVIL,
			 PPESSOA.COR,FLAN.IDLAN,FLAN.VALORORIGINAL,FBOLETO.VENCIMENTO,
			 SMATRICPL.PERIODOLETIVO,FLAN.CODCFO,FLAN.CODTDO,FBOLETO.IDBOLETO,
			 FBOLETO.CNABSTATUS,FBOLETO.CNABSTATUS,FLAN.CODCOLIGADA,
			 FLAN.CODFILIAL,SCONTRATO.RA,FLAN.VALOROP2,FLAN.VALOROP5,
			 FLAN.VALOROP6,FLANINTEGRACAO.VALOR,SLAN.IDPARCELA,FLAN.CODCFO,
			 SCONTRATO.CODCONTRATO,SLAN.CODCOLIGADA,FLAN.DATAVENCIMENTO,
			 SCONTRATO.CODCOLIGADA,SCONTRATO.IDHABILITACAOFILIAL,SPARCELA.PARCELA,
			 SPARCELA.CODCOLIGADA,SPARCELA.CODCONTRATO,FILIAL.NOME,SMATRICPL.FIES
) AS SUB

GROUP BY SUB.CONTATOCODIGO,SUB.NOMECONTATO,SUB.NOMESOCIAL,SUB.CODCOLIGADA,
		 SUB.DTNASCIMENTO,SUB.TELEFONE1,SUB.TELEFONE2,SUB.TELEFONE3,SUB.EMAIL,
		 SUB.CPF,SUB.RUA,SUB.CEP,SUB.NUMERO,SUB.BAIRRO,SUB.CIDADE,SUB.ESTADO,
		 SUB.GENERO,SUB.ESTADOCIVIL,SUB.COR,SUB.VENCIMENTO,SUB.CONTATORESP,
		 SUB.PERIODOLETIVO,SUB.CODCFO,SUB.DIASVENCIDO,SUB.IDBOLETO,SUB.RA,
		 SUB.STATUSBOLETO,SUB.CODREGISTRO,SUB.EVENTODATA,SUB.FILIAL,
		 SUB.CONTADOR,SUB.FIES";14532;;;;16/11/2022;shift;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;20312;shift;14/11/2022;shift;16/11/2022;0
S;RB.INT.GI.004.2;Envio/Atualização Boletos vencidos;"SELECT IDBOLETO FROM FBOLETO(NOLOCK) WHERE IDBOLETO IN (57859,
141623,
141622,
141621,
273325,
273329,
273327,
273321,
273322,
273331,
273323,
273316,
273330,
273328,
273319,
273326,
273317,
273320,
273315,
273318,
273324,
286420,
289412,
286421,
289502,
289424,
282215,
282216,
282217,
288755,
286431,
286430,
286429,
284131,
289037,
286726,
286727,
289022,
286725,
289039,
289839,
289147,
287455,
288127,
282135,
282136,
282134,
289337,
289219,
289236,
289255,
289335,
289253,
290809,
291434,
292068,
291435,
290096,
292358,
290028,
292369,
290385,
290301,
292625,
292666,
290461,
291992,
290607,
293911,
293795,
294596,
294903,
294900,
293362,
295301,
296706,
296707,
296708,
293351,
293451,
293487,
293612,
293632,
296344,
298483,
298484,
298485,
293739,
298482,
296231,
296310,
296467,
294149,
298421,
296500,
296498,
296499,
301686,
301684,
301690,
301483,
301489,
301482,
301688,
300699,
301689,
301691,
301484,
301683,
301485,
301481,
301493,
301495,
301486,
301490,
301492,
301494,
301685,
301687,
301487,
301491,
301488,
301130,
300494,
300525,
300326,
299589,
299590,
299591,
302598,
302611,
302612,
302613,
300733,
299588,
302591,
302595,
302596,
302593,
302584,
302587,
302600,
302594,
302586,
302607,
301751,
301752,
301758,
301760,
301820,
302588,
302590,
302589,
302592,
302617,
302606,
302605,
302608,
302609,
302610,
302601,
302602,
302614,
302603,
302585,
302615,
302604,
301759,
301808,
301755,
301757,
301753,
301837,
301756,
301750,
302597,
302599,
302616,
301763,
301762,
301764,
301843,
301836,
300748,
301812,
301814,
301824,
301841,
301821,
301807,
301827,
301830,
301811,
301806,
301816,
301839,
301911,
301910,
301754,
301748,
301749,
301761,
301817,
301831,
301833,
301809,
301810,
301818,
301813,
301835,
301908,
301832,
301826,
301906,
301907,
301909,
301915,
301952,
301914,
301913,
301815,
301805,
301819,
301828,
301917,
301912,
301902,
301903,
301916,
301901,
301953,
302026,
302033,
302022,
299988,
301829,
301842,
301844,
301834,
301825,
301838,
301840,
301823,
302024,
302031,
302034,
300755,
300751,
300956,
302023,
302035,
302029,
302032,
302036,
302030,
302021,
302028,
301381,
301387,
301905,
301904,
300334,
301393,
301383,
301380,
301382,
301378,
301379,
302199,
302214,
302025,
301385,
301384,
301388,
301389,
301392,
301390,
300365,
301391,
301394,
302027,
302213,
302205,
300264,
301386,
300025,
302215,
302207,
300673,
300284,
300837,
304150,
304153,
304147,
304149,
303408,
303397,
303398,
304138,
304146,
304145,
304152,
304148,
304151,
304144,
303406,
303410,
304275,
303403,
303400,
303391,
303394,
303411,
303387,
303412,
303402,
303392,
303388,
303405,
303404,
303396,
303390,
304279,
303393,
303395,
303409,
303414,
303413,
303407,
303389,
303401,
303399,
304283,
304274,
304278,
304282,
304280,
304276,
304284,
304277,
304281,
304296,
304691,
304694,
304688,
304687,
304692,
304695,
304689,
304693,
304696,
304697,
304690,
304800,
304799,
304959,
305147,
305020,
305140,
303853,
303899,
303903,
303904,
303854,
303902,
303905,
303896,
303897,
303901,
303898,
303855,
303900,
309020,
308803,
308804,
307447,
307623,
306828,
308060,
307005,
308113,
307061,
307126,
307199,
307207,
307156,
308210,
308209,
307163,
307229,
307380,
307396,
307357,
307332,
307189,
307195,
307395,
307432,
307451,
307324,
307385,
308219,
307433,
307441,
308271,
307565,
307518,
307459,
307454,
307821,
307382,
307806,
307556,
309299,
307466,
307816,
307546,
308289,
306230,
306233,
309323,
308930,
306215,
307444,
307032,
307767,
307383,
306241,
308154,
308419,
309322,
307845,
306227,
306264,
308713,
308714,
307889,
306206,
307302,
308261,
311346,
311478,
312413,
310841,
310842,
311759,
311572,
311761,
311212,
310966,
310968,
311976,
310846,
310854,
312450,
310844,
310853,
311779,
311847,
311735,
312444,
310903,
310971,
310858,
310862,
311030,
311650,
310865,
311058,
311817,
311444,
311818,
289233,
310650,
312587,
309916,
310021,
310017,
310023,
310111,
310690,
310689,
312554,
310233,
310234,
309787,
310766,
310510,
310528,
310620,
310617,
310794,
310519,
310529,
312644,
312634,
312706,
312666,
312773,
312774,
312924,
300285,
313006,
313011,
313102,
313027,
313021,
313236,
313242,
316735,
318392,
314915,
315607,
315628,
318505,
315691,
318588,
318604,
318622,
318713,
315776,
314133,
316011,
316093,
317065,
316437,
317320,
317326,
317356,
317565,
316486,
315452,
318228,
315558,
316546,
316595,
316624,
316638,
319237,
322415,
320665,
322760,
322615,
323086,
318970,
322063,
323579,
319083,
319091,
324016,
324066,
324738,
321333,
321371,
324570,
319855,
322065,
38034,
38036,
45568,
45580,
80339,
115160,
212865,
221665,
349196,
349197,
324389,
332705,
332711,
332749,
334939,
335132,
335354,
336557,
337611,
337837,
338429,
338560,
339340,
340115,
339829,
185455,
336882,
343580,
344327,
350296)";5331;;;;16/11/2022;shift;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;11836;shift;14/11/2022;shift;16/11/2022;0
S;RB.INT.GI.005;Envio/Atualização Boletos Pagos;"/******
	- CONSULTA PARA ENVIO E ATUALIZAÇÃO DOS BOLETOS PAGOS
	- GESTÃO DA PERMANÊNCIA
******/
SELECT 
	SUB.CONTADOR,
	/** INFORMAÇÕES DO CONTATO **/
	SUB.CONTATOCODIGO AS 'contato.codigo',
	SUB.NOMECONTATO   AS 'contato.nome',
	SUB.NOMESOCIAL    AS 'contato.nomeSocial',
	SUB.DTNASCIMENTO  AS 'contato.dataNascimento',
	SUB.TELEFONE1     AS 'contato.telefonePrincipal',
	SUB.TELEFONE2     AS 'contato.telefonesecundario_1',
	SUB.TELEFONE3     AS 'contato.telefonesecundario_2',
	SUB.EMAIL         AS 'contato.emailPrincipal',
	SUB.CPF           AS 'contato.cpf',
	SUB.RUA      	  AS 'contato.endereco',
	SUB.CEP 		  AS 'contato.cep',
	SUB.NUMERO 		  AS 'contato.numero',
	SUB.BAIRRO 		  AS 'contato.bairro',
	SUB.CIDADE 		  AS 'contato.cidade',
	SUB.ESTADO 		  AS 'contato.estado',
	SUB.GENERO		  AS 'contato.sexo',
	SUB.ESTADOCIVIL   AS 'contato.estadoCivil',
	SUB.COR 		  AS 'contato.cor',
		
	/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/	
	SUB.BAIXASERASA								  AS 'evento.campopersonalizado_72_compl_proc',
	SUB.BAIXAPROCESSO 							  AS 'evento.campopersonalizado_74_compl_proc',
	SUB.COBRADOR 								  AS 'evento.campopersonalizado_75_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORBAIXADO))  AS 'evento.campopersonalizado_12_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORORIGINAL)) AS 'evento.campopersonalizado_9_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORLIQUIDO))  AS 'evento.campopersonalizado_10_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.DESCONTO))	  AS 'evento.campopersonalizado_11_compl_proc',
	SUB.DATABAIXA 								  AS 'evento.campopersonalizado_14_compl_proc',
	SUBSTRING((
	    SELECT DISTINCT 
	    	', '+ CONVERT(VARCHAR,PARCELA)
	    FROM SPARCELA(NOLOCK)   
	    CROSS APPLY(
	    	SELECT
	    		SLAN.CODCOLIGADA,
	    		SLAN.IDPARCELA
	    	FROM SLAN(NOLOCK)
	    	INNER JOIN FLANBOLETO(NOLOCK)
	    		ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
	    		AND FLANBOLETO.IDLAN = SLAN.IDLAN
	    		AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
	    	WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	    	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
	    ) AS SLAN
	    WHERE SPARCELA.CODCOLIGADA = SUB.CODCOLIGADA	    
	    AND SPARCELA.RA = SUB.RA
	    /*AND CODCONTRATO = SCONTRATO.CODCONTRATO*/
	        FOR XML PATH ('')),2,1000)		      AS 'evento.campopersonalizado_15_compl_proc',
	SUB.VENCIMENTO 	  							  AS 'evento.campopersonalizado_13_compl_proc',	
	/**TIPO DE DOCUMENTO**/
	SUBSTRING((
		SELECT DISTINCT
	   		', '+DESCRICAO
		FROM FTDO(NOLOCK)
		CROSS APPLY(
			SELECT
				FLAN.CODTDO,
				FLAN.CODCOLIGADA
			FROM FLAN(NOLOCK)
			INNER JOIN FLANBOLETO(NOLOCK)
				ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
				AND FLANBOLETO.IDLAN = FLAN.IDLAN
				AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
		) AS FLANSUB
	   WHERE FTDO.CODCOLIGADA = FLANSUB.CODCOLIGADA
	   AND FTDO.CODTDO = FLANSUB.CODTDO
	FOR XML PATH ('')),2,1000) 					  AS 'evento.campopersonalizado_16_compl_proc',
	SUB.PERIODOLETIVO 							  AS 'evento.campopersonalizado_17_compl_proc',
	SUB.CODCFO 									  AS 'evento.campopersonalizado_18_compl_proc',
	SUB.DIASVENCIDO 							  AS 'evento.campopersonalizado_19_compl_proc',
	SUB.IDBOLETO 								  AS 'evento.campopersonalizado_20_compl_proc',
	SUB.STATUSBOLETO 							  AS 'evento.campopersonalizado_24_compl_proc',
	SUB.FILIAL									  AS 'evento.campopersonalizado_21_compl_proc',
	/** NIVEL DE ENSINO **/
	SUBSTRING((SELECT DISTINCT
					', '+STIPOCURSO.NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   CROSS APPLY(
			   		SELECT
			   			NOME
			   		FROM STIPOCURSO(NOLOCK)
			   		INNER JOIN SHABILITACAOFILIAL(NOLOCK)
						ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
						AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   			AND SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
			   			AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO
			   ) AS STIPOCURSO			   	
			FOR XML PATH ('')),2,1000)  AS	'evento.campopersonalizado_76_compl_proc',	
	/** INFORMAÇÕES DO CURSO **/
	SUBSTRING((SELECT DISTINCT
							', '+NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   	INNER JOIN SHABILITACAOFILIAL(NOLOCK)
					ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   INNER JOIN SCURSO(NOLOCK)
			   		ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			   		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			FOR XML PATH ('')),2,1000)		 	  AS 'evento.campopersonalizado_27_compl_proc',
	CONCAT('https://rubeusscripttotvs.apprbs.com.br/unasp/relatorio.php?p=',SUB.CONTATORESP) AS 'evento.campopersonalizado_85_compl_proc',
	
	/** INFORMAÇÕES DO EVENTO **/
	SUB.CODREGISTRO   AS 'evento.codRegistro',
	SUB.EVENTODATA 	  AS 'evento.data',
	SUB.CONTATORESP   AS 'evento.codigoResponsavelFinanceiro',
	SUB.CONTATOCODIGO AS 'evento.pessoa'
FROM (
	SELECT
		ROW_NUMBER() OVER(ORDER BY FBOLETO.IDBOLETO ASC) AS CONTADOR,	
		/** INFORMAÇÕES DO CONTATO **/
		PPESSOA.CONTATOCODIGO,
		CONCAT('R-',FLAN.CODCFO) AS CONTATORESP,
		PPESSOA.NOMECONTATO,
		PPESSOA.NOMESOCIAL,
		PPESSOA.DTNASCIMENTO,
	    PPESSOA.TELEFONE1,
		PPESSOA.TELEFONE2,
		PPESSOA.TELEFONE3,
		PPESSOA.EMAIL,
		PPESSOA.CPF,
		PPESSOA.RUA,
		PPESSOA.CEP,
		PPESSOA.NUMERO,
		PPESSOA.BAIRRO,
		PPESSOA.CIDADE,
		PPESSOA.ESTADO,
		PPESSOA.GENERO,
	  	PPESSOA.ESTADOCIVIL,
		PPESSOA.COR,
		
		/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
		CONVERT(VARCHAR(30), CAST(FLANCOMPL.DTBXSERASA AS DATE), 121) AS BAIXASERASA,
		CONVERT(VARCHAR(30), CAST(FLANCOMPL.DTFIMCOBJUD AS DATE), 121) AS BAIXAPROCESSO,
		COBRADOR.DESCRICAO AS COBRADOR,
		FLAN.IDLAN,
		PPESSOA.RA,
		FLAN.CODCOLIGADA,
		FLAN.VALORORIGINAL AS VALORORIGINAL,
		(FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) AS VALORLIQUIDO,
		CASE 
			WHEN FBOLETO.VENCIMENTO < FLAN.DATABAIXA THEN 0
		ELSE (FLAN.VALOROP2 + FLAN.VALOROP5 + FLAN.VALOROP6 + ISNULL(FLANINTEGRACAO.VALOR,0)) END AS DESCONTO,
		FLAN.VALORBAIXADO,
		CONVERT(VARCHAR,FBOLETO.VENCIMENTO,103) AS VENCIMENTO,
		CONVERT(VARCHAR,FLAN.DATABAIXA,103) AS DATABAIXA,
		SMATRICPL.PERIODOLETIVO,
		FLAN.CODCFO,
		DATEDIFF(DAY,FBOLETO.VENCIMENTO,FLAN.DATABAIXA) AS DIASVENCIDO,
		FBOLETO.IDBOLETO,
		CASE 
			WHEN FBOLETO.CNABSTATUS	= 0 THEN 'Não Remetido'
			WHEN FBOLETO.CNABSTATUS	= 1 THEN 'Remetido'
			WHEN FBOLETO.CNABSTATUS	= 2 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 3 THEN 'Recusado'
			WHEN FBOLETO.CNABSTATUS	= 4 THEN 'Baixado'
			WHEN FBOLETO.CNABSTATUS	= 5 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 6 THEN 'Cancelado'
			WHEN FBOLETO.CNABSTATUS	= 7 THEN 'Pendente Remessa'
		ELSE 'Boleto sem status' END AS STATUSBOLETO,
		FILIAL.NOME AS FILIAL,
		
	  	/** INFORMAÇÕES DO EVENTO **/
	  	CONCAT('GI-',FLAN.CODCOLIGADA,'-',FLAN.CODFILIAL,'-',FBOLETO.IDBOLETO) AS CODREGISTRO, 
		CONCAT(CONVERT(VARCHAR(10), CAST(FLAN.DATABAIXA AS DATETIME), 121),' 08:00:00') AS EVENTODATA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO(NOLOCK)
		ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANBOLETO.IDLAN = FLAN.IDLAN
	
	INNER JOIN FLANCOMPL(NOLOCK)
		ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANCOMPL.IDLAN = FLAN.IDLAN
	
	OUTER APPLY(
		SELECT
			DESCRICAO
		FROM GCONSIST(NOLOCK)
		WHERE CODTABELA = 'COBJUD'
		AND CODCLIENTE = FLANCOMPL.RESPCOBJUD
	) AS COBRADOR
	
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FBOLETO.STATUS = 1
		/*AND DATEDIFF(DAY,FLAN.RECMODIFIEDON, GETDATE()) <= 7*/
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO

	CROSS APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO
	
	OUTER APPLY(
		SELECT
			NOME
		FROM GFILIAL(NOLOCK)
		WHERE CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODFILIAL = FLAN.CODFILIAL
	) AS FILIAL
	
	/**DESCONTOS ABA INTEGRACAO**/
	OUTER APPLY(
		SELECT 
			SUM(VALOR) AS VALOR
		FROM FLANINTEGRACAO (NOLOCK) 
		WHERE FLANBOLETO.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA
	    AND FLANBOLETO.IDLAN = FLANINTEGRACAO.IDLAN
	    AND VALOR > 0
	) AS FLANINTEGRACAO

	/**DADOS ALUNO**/
	CROSS APPLY(
		SELECT
			CONCAT('P-',PPESSOA.CODIGO) AS CONTATOCODIGO,
			PPESSOA.NOME AS NOMECONTATO,
			PPESSOA.NOMESOCIAL AS NOMESOCIAL,
			CONVERT(VARCHAR(10),PPESSOA.DTNASCIMENTO, 121) AS DTNASCIMENTO,
		    CASE WHEN LEN(COALESCE(PPESSOA.TELEFONE1,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE1,'(',''),')',''),' ','') END TELEFONE1,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE2,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE2,'(',''),')',''),' ','') END TELEFONE2,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE3,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE3,'(',''),')',''),' ','') END TELEFONE3,
			CASE WHEN (SELECT AA.EMAIL FROM PPESSOA AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
		      			AND AA.CODIGO = PPESSOA.CODIGO) IS NOT NULL 
		 	 THEN REPLACE(PPESSOA.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
		         ELSE 'sememail@rubeus.com.br' 
			END	EMAIL,
			CASE WHEN PPESSOA.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(PPESSOA.CPF) <  11
				THEN NULL 
			ELSE PPESSOA.CPF END CPF,
			PPESSOA.RUA,
			PPESSOA.CEP,
			PPESSOA.NUMERO,
			PPESSOA.BAIRRO,
			PPESSOA.CIDADE,
			PPESSOA.ESTADO,
			CASE PPESSOA.SEXO WHEN 'M' THEN 1 ELSE 2 END AS GENERO,
		  	CASE PPESSOA.ESTADOCIVIL 
				WHEN 'C' THEN 1 /*CASADO */
				WHEN 'D' THEN 2 /*DESQUITADO */
				WHEN 'E' THEN 3 /*UNIAO ESTAVEL */
				WHEN 'I' THEN 4 /*DIVORCIADO */
				WHEN 'O' THEN 5 /*OUTROS */
				WHEN 'P' THEN 6 /*SEPARADO */
				WHEN 'S' THEN 7 /*SOLTEIRO */
				WHEN 'V' THEN 8 /*VIUVO */
			END AS ESTADOCIVIL,
			CASE PPESSOA.CORRACA
				WHEN 0 THEN 1
				WHEN 2 THEN 2
				WHEN 4 THEN 3
				WHEN 6 THEN 4
				WHEN 8 THEN 5
				WHEN 9 THEN 6
				WHEN 10 THEN 7
			END COR,
			SALUNO.RA
		FROM SALUNO(NOLOCK)
		INNER JOIN PPESSOA(NOLOCK)
			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
		WHERE SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SALUNO.RA = SCONTRATO.RA
	) AS PPESSOA		
	
	/**DADOS MATRICULA**/
	CROSS APPLY(
		SELECT DISTINCT
			SMATRICPL.CODCOLIGADA,
			SMATRICPL.RA,
			CODSTATUS,
			SPLETIVO.CODPERLET AS PERIODOLETIVO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SPLETIVO(NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			/**NAO CONSIDERAR ALUNOS FIES**/
		CROSS APPLY(
			SELECT
				SHABILITACAOALUNOCOMPL.CODCOLIGADA,
				SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
				SHABILITACAOALUNOCOMPL.RA
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
			AND ISNULL(FIES,'F') = 'F'
		) AS SHABILITACAO
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.CODSTATUS IN (2,3,4,7,10,    /**GRADUACAO**/
									27,28,29,46,50,/**POS GRADUACAO**/
									23,24,25,67    /**EXTENSAO/LIVRE**/)
	) AS SMATRICPL
	
	WHERE FLAN.PAGREC = 1
	AND FLAN.STATUSLAN = 1
	/**NAO CONSIDERAR CAIXA ECONOMICA**/
	AND FLAN.CODCFO <> '58807'
	AND (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) > 0
	
	GROUP BY PPESSOA.CONTATOCODIGO,PPESSOA.NOMECONTATO,PPESSOA.NOMESOCIAL,
			 PPESSOA.DTNASCIMENTO,PPESSOA.TELEFONE1,PPESSOA.TELEFONE2,
			 PPESSOA.TELEFONE3,PPESSOA.EMAIL,PPESSOA.CPF,PPESSOA.CPF,FLAN.CODTDO,
			 PPESSOA.RUA,PPESSOA.CEP,PPESSOA.NUMERO,PPESSOA.BAIRRO,PPESSOA.RA,
			 PPESSOA.CIDADE,PPESSOA.ESTADO,PPESSOA.GENERO,PPESSOA.ESTADOCIVIL,
			 PPESSOA.COR,FLAN.IDLAN,FLAN.VALORORIGINAL,FBOLETO.VENCIMENTO,
			 SMATRICPL.PERIODOLETIVO,FLAN.CODCFO,FBOLETO.IDBOLETO,FBOLETO.IPTE,
			 FBOLETO.CNABSTATUS,FBOLETO.CNABSTATUS,FLAN.CODCOLIGADA,
			 FLAN.CODFILIAL,SCONTRATO.RA,FLAN.VALOROP2,FLAN.VALORBAIXADO,
			 FLAN.VALOROP5,FLAN.VALOROP6,FLANINTEGRACAO.VALOR,SLAN.IDPARCELA,
			 SCONTRATO.CODCONTRATO,SLAN.CODCOLIGADA,FLAN.DATAVENCIMENTO,
			 SCONTRATO.CODCOLIGADA,SCONTRATO.IDHABILITACAOFILIAL,FLAN.DATABAIXA,
			 SPARCELA.CODCOLIGADA,SPARCELA.CODCONTRATO,FILIAL.NOME,FLAN.CODCFO,
			 COBRADOR.DESCRICAO,FLANCOMPL.DTBXSERASA,FLANCOMPL.DTFIMCOBJUD
) AS SUB
WHERE DATEDIFF(DAY,SUB.EVENTODATA, GETDATE()) BETWEEN 0 AND 7
AND SUB.CONTADOR BETWEEN :INICIO AND :FIM
GROUP BY SUB.CONTATOCODIGO,SUB.NOMECONTATO,SUB.NOMESOCIAL,SUB.CODCOLIGADA,
		 SUB.DTNASCIMENTO,SUB.TELEFONE1,SUB.TELEFONE2,SUB.TELEFONE3,SUB.EMAIL,
		 SUB.CPF,SUB.RUA,SUB.CEP,SUB.NUMERO,SUB.BAIRRO,SUB.CIDADE,SUB.ESTADO,
		 SUB.GENERO,SUB.ESTADOCIVIL,SUB.COR,SUB.VENCIMENTO,SUB.DATABAIXA,
		 SUB.PERIODOLETIVO,SUB.CODCFO,SUB.DIASVENCIDO,SUB.IDBOLETO,SUB.RA,
		 SUB.STATUSBOLETO,SUB.CODREGISTRO,SUB.EVENTODATA,SUB.FILIAL,
		 SUB.CONTADOR,SUB.VALORBAIXADO,SUB.COBRADOR,SUB.BAIXASERASA,
		 SUB.BAIXAPROCESSO,SUB.CONTATORESP";15414;;;;12/11/2022;shift;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;-25785;wsrubeus;08/04/2022;shift;12/11/2022;0
S;RB.INT.GI.006;Envio/Atualização Boletos Serasa/SPC;"/******
	- CONSULTA PARA ENVIO DE ATUALIZAÇÃO BOLETOS ENVIADO PARA SPC/SERASA
	- GESTÃO DA PERMANÊNCIA
******/
SELECT 
	SUB.CONTADOR,
	/** INFORMAÇÕES DO CONTATO **/
	SUB.CONTATOCODIGO AS 'contato.codigo',
	SUB.NOMECONTATO   AS 'contato.nome',
	SUB.NOMESOCIAL    AS 'contato.nomeSocial',
	SUB.DTNASCIMENTO  AS 'contato.dataNascimento',
	SUB.TELEFONE1     AS 'contato.telefonePrincipal',
	SUB.TELEFONE2     AS 'contato.telefonesecundario_1',
	SUB.TELEFONE3     AS 'contato.telefonesecundario_2',
	SUB.EMAIL         AS 'contato.emailPrincipal',
	SUB.CPF           AS 'contato.cpf',
	SUB.RUA      	  AS 'contato.endereco',
	SUB.CEP 		  AS 'contato.cep',
	SUB.NUMERO 		  AS 'contato.numero',
	SUB.BAIRRO 		  AS 'contato.bairro',
	SUB.CIDADE 		  AS 'contato.cidade',
	SUB.ESTADO 		  AS 'contato.estado',
	SUB.GENERO		  AS 'contato.sexo',
	SUB.ESTADOCIVIL   AS 'contato.estadoCivil',
	SUB.COR 		  AS 'contato.cor',
		
	/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/	
	SUB.DTINCSERAASA 							  AS 'evento.campopersonalizado_71_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORORIGINAL)) AS 'evento.campopersonalizado_9_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORLIQUIDO))  AS 'evento.campopersonalizado_10_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.DESCONTO))	  AS 'evento.campopersonalizado_11_compl_proc',
	SUBSTRING((
	    SELECT DISTINCT 
	    	', '+ CONVERT(VARCHAR,PARCELA)
	    FROM SPARCELA(NOLOCK)   
	    CROSS APPLY(
	    	SELECT
	    		SLAN.CODCOLIGADA,
	    		SLAN.IDPARCELA
	    	FROM SLAN(NOLOCK)
	    	INNER JOIN FLANBOLETO(NOLOCK)
	    		ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
	    		AND FLANBOLETO.IDLAN = SLAN.IDLAN
	    		AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
	    	WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	    	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
	    ) AS SLAN
	    WHERE SPARCELA.CODCOLIGADA = SUB.CODCOLIGADA	    
	    AND SPARCELA.RA = SUB.RA
	    /*AND CODCONTRATO = SCONTRATO.CODCONTRATO*/
	        FOR XML PATH ('')),2,1000)		      AS 'evento.campopersonalizado_15_compl_proc',
	SUB.VENCIMENTO 	  							  AS 'evento.campopersonalizado_13_compl_proc',	
	/**TIPO DE DOCUMENTO**/
	SUBSTRING((
		SELECT DISTINCT
	   		', '+DESCRICAO
		FROM FTDO(NOLOCK)
		CROSS APPLY(
			SELECT
				FLAN.CODTDO,
				FLAN.CODCOLIGADA
			FROM FLAN(NOLOCK)
			INNER JOIN FLANBOLETO(NOLOCK)
				ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
				AND FLANBOLETO.IDLAN = FLAN.IDLAN
				AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
		) AS FLANSUB
	   WHERE FTDO.CODCOLIGADA = FLANSUB.CODCOLIGADA
	   AND FTDO.CODTDO = FLANSUB.CODTDO
	FOR XML PATH ('')),2,1000) 					  AS 'evento.campopersonalizado_16_compl_proc',
	SUB.PERIODOLETIVO 							  AS 'evento.campopersonalizado_17_compl_proc',
	SUB.CODCFO 									  AS 'evento.campopersonalizado_18_compl_proc',
	SUB.DIASVENCIDO 							  AS 'evento.campopersonalizado_19_compl_proc',
	SUB.IDBOLETO 								  AS 'evento.campopersonalizado_20_compl_proc',
	SUB.STATUSBOLETO 							  AS 'evento.campopersonalizado_24_compl_proc',
	SUB.FILIAL									  AS 'evento.campopersonalizado_21_compl_proc',
	/** NIVEL DE ENSINO **/
	SUBSTRING((SELECT DISTINCT
					', '+STIPOCURSO.NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   CROSS APPLY(
			   		SELECT
			   			NOME
			   		FROM STIPOCURSO(NOLOCK)
			   		INNER JOIN SHABILITACAOFILIAL(NOLOCK)
						ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
						AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   			AND SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
			   			AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO
			   ) AS STIPOCURSO			   	
			FOR XML PATH ('')),2,1000)  AS	'evento.campopersonalizado_76_compl_proc',	
	/** INFORMAÇÕES DO CURSO **/
	SUBSTRING((SELECT DISTINCT
							', '+NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   	INNER JOIN SHABILITACAOFILIAL(NOLOCK)
					ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   INNER JOIN SCURSO(NOLOCK)
			   		ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			   		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			FOR XML PATH ('')),2,1000)		 	  AS 'evento.campopersonalizado_27_compl_proc',
	CONCAT('https://rubeusscripttotvs.apprbs.com.br/unasp/relatorio.php?p=',SUB.CONTATORESP) AS 'evento.campopersonalizado_85_compl_proc',
	
	/** INFORMAÇÕES DO EVENTO **/
	SUB.CODREGISTRO  AS 'evento.codRegistro',
	SUB.EVENTODATA 	 AS 'evento.data',
	SUB.CONTATORESP   AS 'evento.codigoResponsavelFinanceiro',
	SUB.CONTATOCODIGO AS 'evento.pessoa'
FROM (
	SELECT
		ROW_NUMBER() OVER(ORDER BY FBOLETO.IDBOLETO ASC) AS CONTADOR,	
		/** INFORMAÇÕES DO CONTATO **/
		PPESSOA.CONTATOCODIGO,
		CONCAT('R-',FLAN.CODCFO) AS CONTATORESP,
		PPESSOA.NOMECONTATO,
		PPESSOA.NOMESOCIAL,
		PPESSOA.DTNASCIMENTO,
	    PPESSOA.TELEFONE1,
		PPESSOA.TELEFONE2,
		PPESSOA.TELEFONE3,
		PPESSOA.EMAIL,
		PPESSOA.CPF,
		PPESSOA.RUA,
		PPESSOA.CEP,
		PPESSOA.NUMERO,
		PPESSOA.BAIRRO,
		PPESSOA.CIDADE,
		PPESSOA.ESTADO,
		PPESSOA.GENERO,
	  	PPESSOA.ESTADOCIVIL,
		PPESSOA.COR,
		
		/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
		CONVERT(VARCHAR(10), CAST(FLANCOMPL.DTINCSERAASA AS DATE), 121) AS DTINCSERAASA,
		FLAN.IDLAN,
		PPESSOA.RA,
		FLAN.CODCOLIGADA,
		FLAN.VALORORIGINAL AS VALORORIGINAL,
		CASE 
			WHEN SPARCELA.PARCELA = 1 THEN (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) 
		ELSE (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0))
			+ ((FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) * 0.02)
			+ + ((((FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) * 0.01) / 30) * DATEDIFF(DAY, FLAN.DATAVENCIMENTO, GETDATE()))
		END AS VALORLIQUIDO,
		(FLAN.VALOROP2 + FLAN.VALOROP5 + FLAN.VALOROP6 + ISNULL(FLANINTEGRACAO.VALOR,0)) AS DESCONTO,
		/*'Valor baixado' AS 'evento.campopersonalizado_12_compl_proc',*/
		CONVERT(VARCHAR,FBOLETO.VENCIMENTO,103) AS VENCIMENTO,
		/*'Data baixa' AS 'evento.campopersonalizado_14_compl_proc',*/
		SMATRICPL.PERIODOLETIVO,
		FLAN.CODCFO,
		DATEDIFF(DAY,FBOLETO.VENCIMENTO,GETDATE()) AS DIASVENCIDO,
		FBOLETO.IDBOLETO,
		CASE 
			WHEN FBOLETO.CNABSTATUS	= 0 THEN 'Não Remetido'
			WHEN FBOLETO.CNABSTATUS	= 1 THEN 'Remetido'
			WHEN FBOLETO.CNABSTATUS	= 2 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 3 THEN 'Recusado'
			WHEN FBOLETO.CNABSTATUS	= 4 THEN 'Baixado'
			WHEN FBOLETO.CNABSTATUS	= 5 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 6 THEN 'Cancelado'
			WHEN FBOLETO.CNABSTATUS	= 7 THEN 'Pendente Remessa'
		ELSE 'Boleto sem status' END AS STATUSBOLETO,
		FILIAL.NOME AS FILIAL,
		
	  	/** INFORMAÇÕES DO EVENTO **/
	  	CONCAT('GI-',FLAN.CODCOLIGADA,'-',FLAN.CODFILIAL,'-',FBOLETO.IDBOLETO) AS CODREGISTRO, 
		CONCAT(CONVERT(VARCHAR(10), CAST(FBOLETO.VENCIMENTO AS DATETIME), 121),' 08:00:00') AS EVENTODATA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO(NOLOCK)
		ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANBOLETO.IDLAN = FLAN.IDLAN
	
	INNER JOIN FLANCOMPL(NOLOCK)
		ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANCOMPL.IDLAN = FLAN.IDLAN
		AND FLANCOMPL.SERASA = 1
		AND FLANCOMPL.DTBXSERASA IS NULL
		
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FBOLETO.VENCIMENTO < GETDATE()
		AND FBOLETO.STATUS = 0
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO

	CROSS APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO
	
	OUTER APPLY(
		SELECT
			NOME
		FROM GFILIAL(NOLOCK)
		WHERE CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODFILIAL = FLAN.CODFILIAL
	) AS FILIAL
	
	/**DESCONTOS ABA INTEGRACAO**/
	OUTER APPLY(
		SELECT 
			SUM(VALOR) AS VALOR
		FROM FLANINTEGRACAO (NOLOCK) 
		WHERE FLANBOLETO.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA
	    AND FLANBOLETO.IDLAN = FLANINTEGRACAO.IDLAN
	    AND VALOR > 0
	    AND IDCAMPO NOT IN (48,49,52)
	) AS FLANINTEGRACAO

	/**DADOS ALUNO**/
	CROSS APPLY(
		SELECT
			CONCAT('P-',PPESSOA.CODIGO) AS CONTATOCODIGO,
			PPESSOA.NOME AS NOMECONTATO,
			PPESSOA.NOMESOCIAL AS NOMESOCIAL,
			CONVERT(VARCHAR(10),PPESSOA.DTNASCIMENTO, 121) AS DTNASCIMENTO,
		    CASE WHEN LEN(COALESCE(PPESSOA.TELEFONE1,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE1,'(',''),')',''),' ','') END TELEFONE1,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE2,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE2,'(',''),')',''),' ','') END TELEFONE2,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE3,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE3,'(',''),')',''),' ','') END TELEFONE3,
			CASE WHEN (SELECT AA.EMAIL FROM PPESSOA AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
		      			AND AA.CODIGO = PPESSOA.CODIGO) IS NOT NULL 
		 	 THEN REPLACE(PPESSOA.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
		         ELSE 'sememail@rubeus.com.br' 
			END	EMAIL,
			CASE WHEN PPESSOA.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(PPESSOA.CPF) <  11
				THEN NULL 
			ELSE PPESSOA.CPF END CPF,
			PPESSOA.RUA,
			PPESSOA.CEP,
			PPESSOA.NUMERO,
			PPESSOA.BAIRRO,
			PPESSOA.CIDADE,
			PPESSOA.ESTADO,
			CASE PPESSOA.SEXO WHEN 'M' THEN 1 ELSE 2 END AS GENERO,
		  	CASE PPESSOA.ESTADOCIVIL 
				WHEN 'C' THEN 1 /*CASADO */
				WHEN 'D' THEN 2 /*DESQUITADO */
				WHEN 'E' THEN 3 /*UNIAO ESTAVEL */
				WHEN 'I' THEN 4 /*DIVORCIADO */
				WHEN 'O' THEN 5 /*OUTROS */
				WHEN 'P' THEN 6 /*SEPARADO */
				WHEN 'S' THEN 7 /*SOLTEIRO */
				WHEN 'V' THEN 8 /*VIUVO */
			END AS ESTADOCIVIL,
			CASE PPESSOA.CORRACA
				WHEN 0 THEN 1
				WHEN 2 THEN 2
				WHEN 4 THEN 3
				WHEN 6 THEN 4
				WHEN 8 THEN 5
				WHEN 9 THEN 6
				WHEN 10 THEN 7
			END COR,
			SALUNO.RA
		FROM SALUNO(NOLOCK)
		INNER JOIN PPESSOA(NOLOCK)
			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
		WHERE SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SALUNO.RA = SCONTRATO.RA
	) AS PPESSOA		
	
	/**DADOS MATRICULA**/
	CROSS APPLY(
		SELECT DISTINCT
			SMATRICPL.CODCOLIGADA,
			SMATRICPL.RA,
			CODSTATUS,
			SPLETIVO.CODPERLET AS PERIODOLETIVO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SPLETIVO(NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			/**NAO CONSIDERAR ALUNOS FIES**/
		CROSS APPLY(
			SELECT
				SHABILITACAOALUNOCOMPL.CODCOLIGADA,
				SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
				SHABILITACAOALUNOCOMPL.RA
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
			AND ISNULL(FIES,'F') = 'F'
		) AS SHABILITACAO
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.CODSTATUS IN (2,3,4,7,10,    /**GRADUACAO**/
									27,28,29,46,50,/**POS GRADUACAO**/
									23,24,25,67    /**EXTENSAO/LIVRE**/)
	) AS SMATRICPL
	
	WHERE FLAN.PAGREC = 1	
	/**NAO CONSIDERAR CAIXA ECONOMICA**/
	AND FLAN.CODCFO <> '58807'
	AND (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) > 0
	
	GROUP BY PPESSOA.CONTATOCODIGO,PPESSOA.NOMECONTATO,PPESSOA.NOMESOCIAL,
			 PPESSOA.DTNASCIMENTO,PPESSOA.TELEFONE1,PPESSOA.TELEFONE2,
			 PPESSOA.TELEFONE3,PPESSOA.EMAIL,PPESSOA.CPF,PPESSOA.CPF,PPESSOA.RA,
			 PPESSOA.RUA,PPESSOA.CEP,PPESSOA.NUMERO,PPESSOA.BAIRRO,FBOLETO.IPTE,
			 PPESSOA.CIDADE,PPESSOA.ESTADO,PPESSOA.GENERO,PPESSOA.ESTADOCIVIL,
			 PPESSOA.COR,FLAN.IDLAN,FLAN.VALORORIGINAL,FBOLETO.VENCIMENTO,
			 SMATRICPL.PERIODOLETIVO,FLAN.CODCFO,FLAN.CODTDO,FBOLETO.IDBOLETO,
			 FBOLETO.CNABSTATUS,FBOLETO.CNABSTATUS,FLAN.CODCOLIGADA,
			 FLAN.CODFILIAL,SCONTRATO.RA,FLAN.VALOROP2,FLAN.VALOROP5,
			 FLAN.VALOROP6,FLANINTEGRACAO.VALOR,SLAN.IDPARCELA,FLAN.CODCFO,
			 SCONTRATO.CODCONTRATO,SLAN.CODCOLIGADA,FLAN.DATAVENCIMENTO,
			 SCONTRATO.CODCOLIGADA,SCONTRATO.IDHABILITACAOFILIAL,SPARCELA.PARCELA,
			 SPARCELA.CODCOLIGADA,SPARCELA.CODCONTRATO,FILIAL.NOME,FLANCOMPL.DTINCSERAASA
) AS SUB
WHERE SUB.CONTADOR BETWEEN :INICIO AND :FIM
GROUP BY SUB.CONTATOCODIGO,SUB.NOMECONTATO,SUB.NOMESOCIAL,SUB.CODCOLIGADA,
		 SUB.DTNASCIMENTO,SUB.TELEFONE1,SUB.TELEFONE2,SUB.TELEFONE3,SUB.EMAIL,
		 SUB.CPF,SUB.RUA,SUB.CEP,SUB.NUMERO,SUB.BAIRRO,SUB.CIDADE,SUB.ESTADO,
		 SUB.GENERO,SUB.ESTADOCIVIL,SUB.COR,SUB.VENCIMENTO,
		 SUB.PERIODOLETIVO,SUB.CODCFO,SUB.DIASVENCIDO,SUB.IDBOLETO,SUB.RA,
		 SUB.STATUSBOLETO,SUB.CODREGISTRO,SUB.EVENTODATA,SUB.FILIAL,
		 SUB.CONTADOR,SUB.DTINCSERAASA,SUB.CONTATORESP";15154;;;;12/11/2022;shift;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;-19598;wsrubeus;13/04/2022;shift;12/11/2022;0
S;RB.INT.GI.007;Envio/Atualização Boletos Baixados por Acordo;"/******
	- CONSULTA PARA ENVIO E ATUALIZAÇÃO DOS BOLETOS BAIXADO POR ACORDO
	- GESTÃO DA PERMANÊNCIA
******/
SELECT DISTINCT
	SUB.CONTADOR,
	/** INFORMAÇÕES DO CONTATO **/
	SUB.CONTATOCODIGO AS 'contato.codigo',
	SUB.NOMECONTATO   AS 'contato.nome',
	SUB.NOMESOCIAL    AS 'contato.nomeSocial',
	SUB.DTNASCIMENTO  AS 'contato.dataNascimento',
	SUB.TELEFONE1     AS 'contato.telefonePrincipal',
	SUB.EMAIL         AS 'contato.emailPrincipal',
	SUB.CPF           AS 'contato.cpf',
	SUB.RUA      	  AS 'contato.endereco',
	SUB.CEP 		  AS 'contato.cep',
	SUB.NUMERO 		  AS 'contato.numero',
	SUB.BAIRRO 		  AS 'contato.bairro',
	SUB.CIDADE 		  AS 'contato.cidade',
	SUB.ESTADO 		  AS 'contato.estado',
		
	/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
	SUB.BAIXASERASA								  AS 'evento.campopersonalizado_72_compl_proc',
	SUB.BAIXAPROCESSO 							  AS 'evento.campopersonalizado_74_compl_proc',
	SUB.COBRADOR 								  AS 'evento.campopersonalizado_75_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORORIGINAL)) AS 'evento.campopersonalizado_9_compl_proc',
	SUB.DATABAIXA 								  AS 'evento.campopersonalizado_14_compl_proc',
	SUBSTRING((SELECT DISTINCT 
			    	', '+ CONVERT(VARCHAR,PARCELA)
			    FROM SPARCELA(NOLOCK)   
			    CROSS APPLY(
			    	SELECT
			    		SLAN.CODCOLIGADA,
			    		SLAN.IDPARCELA
			    	FROM SLAN(NOLOCK)
			    	INNER JOIN FLANBOLETO(NOLOCK)
			    		ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			    		AND FLANBOLETO.IDLAN = SLAN.IDLAN
			    		AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			    	WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			    	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			    ) AS SLAN
			    WHERE SPARCELA.CODCOLIGADA = SUB.CODCOLIGADA	    
			    AND SPARCELA.RA = SUB.RA			
			        FOR XML PATH ('')),2,1000)    AS 'evento.campopersonalizado_15_compl_proc',
	SUB.VENCIMENTO 	  							  AS 'evento.campopersonalizado_13_compl_proc',	
	/**TIPO DE DOCUMENTO**/
	SUBSTRING((SELECT DISTINCT
					', '+DESCRICAO
				FROM FACORDO(NOLOCK) 
				INNER JOIN FACORDOREL(NOLOCK)
					ON FACORDOREL.CODCOLIGADA = FACORDO.CODCOLIGADA
					AND FACORDOREL.IDACORDO = FACORDO.IDACORDO
				INNER JOIN FLANBOLETO(NOLOCK)
					ON FLANBOLETO.CODCOLIGADA = FACORDOREL.CODCOLIGADA
					AND FLANBOLETO.IDLAN = FACORDOREL.IDLAN
				INNER JOIN FTEMPLATEACORDO(NOLOCK)
					ON FTEMPLATEACORDO.CODCOLIGADA = FACORDO.CODCOLIGADA
					AND FTEMPLATEACORDO.IDTEMPLATEACORDO = FACORDO.IDTEMPLATEACORDO
				WHERE FLANBOLETO.IDBOLETO = SUB.IDBOLETO
				AND FLANBOLETO.CODCOLIGADA = SUB.CODCOLIGADA
			FOR XML PATH ('')),2,1000)			  AS 'evento.campopersonalizado_16_compl_proc',
	SUB.PERIODOLETIVO 							  AS 'evento.campopersonalizado_17_compl_proc',
	SUB.CODCFO 									  AS 'evento.campopersonalizado_18_compl_proc',
	SUB.DIASVENCIDO 							  AS 'evento.campopersonalizado_19_compl_proc',
	SUB.IDBOLETO 								  AS 'evento.campopersonalizado_20_compl_proc',
	SUB.FILIAL									  AS 'evento.campopersonalizado_21_compl_proc',
	/** NIVEL DE ENSINO **/
	SUBSTRING((SELECT DISTINCT
					', '+STIPOCURSO.NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   CROSS APPLY(
			   		SELECT
			   			NOME
			   		FROM STIPOCURSO(NOLOCK)
			   		INNER JOIN SHABILITACAOFILIAL(NOLOCK)
						ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
						AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   			AND SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
			   			AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO
			   ) AS STIPOCURSO			   	
			FOR XML PATH ('')),2,1000)  AS	'evento.campopersonalizado_76_compl_proc',	
	/** INFORMAÇÕES DO CURSO **/
	SUBSTRING((SELECT DISTINCT
					', '+NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   	INNER JOIN SHABILITACAOFILIAL(NOLOCK)
					ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   INNER JOIN SCURSO(NOLOCK)
			   		ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			   		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			FOR XML PATH ('')),2,1000)		 	  AS 'evento.campopersonalizado_27_compl_proc',
	CONCAT('https://rubeusscripttotvs.apprbs.com.br/unasp/relatorio.php?p=',SUB.CONTATORESP) AS 'evento.campopersonalizado_85_compl_proc',
	
	/** INFORMAÇÕES DO EVENTO **/
	SUB.CODREGISTRO   AS 'evento.codRegistro',
	SUB.EVENTODATA 	  AS 'evento.data',
	SUB.CONTATORESP   AS 'evento.codigoResponsavelFinanceiro',
	SUB.CONTATOCODIGO AS 'evento.pessoa'
FROM (
	SELECT DISTINCT
		ROW_NUMBER() OVER(ORDER BY FBOLETO.IDBOLETO ASC) AS CONTADOR,	
		/** INFORMAÇÕES DO CONTATO **/
		SMATRICPL.CONTATOCODIGO,
		CONCAT('R-',FLAN.CODCFO) AS CONTATORESP,
		SMATRICPL.NOMECONTATO,
		SMATRICPL.NOMESOCIAL,
		SMATRICPL.DTNASCIMENTO,
	    SMATRICPL.TELEFONE1,
		SMATRICPL.EMAIL,
		SMATRICPL.CPF,
		SMATRICPL.RUA,
		SMATRICPL.CEP,
		SMATRICPL.NUMERO,
		SMATRICPL.BAIRRO,
		SMATRICPL.CIDADE,
		SMATRICPL.ESTADO,
		
		/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
		CONVERT(VARCHAR(30), CAST(FLANCOMPL.DTBXSERASA AS DATE), 121) AS BAIXASERASA,
		CONVERT(VARCHAR(30), CAST(FLANCOMPL.DTFIMCOBJUD AS DATE), 121) AS BAIXAPROCESSO,
		COBRADOR.DESCRICAO AS COBRADOR,
		FLAN.IDLAN,
		SMATRICPL.RA,
		FLAN.CODCOLIGADA,
		FLAN.VALORORIGINAL AS VALORORIGINAL,
		CONVERT(VARCHAR,FBOLETO.VENCIMENTO,103) AS VENCIMENTO,
		CONVERT(VARCHAR,FLAN.DATABAIXA,103) AS DATABAIXA,
		SMATRICPL.PERIODOLETIVO,
		FLAN.CODCFO,
		DATEDIFF(DAY,FBOLETO.VENCIMENTO,FLAN.DATABAIXA) AS DIASVENCIDO,
		FBOLETO.IDBOLETO,
		FILIAL.NOME AS FILIAL,
		
	  	/** INFORMAÇÕES DO EVENTO **/
	  	CONCAT('GI-',FLAN.CODCOLIGADA,'-',FLAN.CODFILIAL,'-',FBOLETO.IDBOLETO) AS CODREGISTRO, 
		CONCAT(CONVERT(VARCHAR(10), CAST(FLAN.DATABAIXA AS DATETIME), 121),' 08:00:00') AS EVENTODATA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO(NOLOCK)
		ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANBOLETO.IDLAN = FLAN.IDLAN
		
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
	
	INNER JOIN FLANCOMPL(NOLOCK)
		ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANCOMPL.IDLAN = FLAN.IDLAN
		
	OUTER APPLY(
		SELECT
			DESCRICAO
		FROM GCONSIST(NOLOCK)
		WHERE CODTABELA = 'COBJUD'
		AND CODCLIENTE = FLANCOMPL.RESPCOBJUD
	) AS COBRADOR
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO

	CROSS APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO
	
	OUTER APPLY(
		SELECT
			NOME
		FROM GFILIAL(NOLOCK)
		WHERE CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODFILIAL = FLAN.CODFILIAL
	) AS FILIAL
	
	/**DADOS MATRICULA E DADOS DO ALUNO**/
	CROSS APPLY(
		SELECT DISTINCT
			SMATRICPL.CODCOLIGADA,
			SMATRICPL.RA,
			CODSTATUS,
			SPLETIVO.CODPERLET AS PERIODOLETIVO,
			CONCAT('P-',PPESSOA.CODIGO) AS CONTATOCODIGO,
			PPESSOA.NOME AS NOMECONTATO,
			PPESSOA.NOMESOCIAL AS NOMESOCIAL,
			CONVERT(VARCHAR(10),PPESSOA.DTNASCIMENTO, 121) AS DTNASCIMENTO,
		    CASE WHEN LEN(COALESCE(PPESSOA.TELEFONE1,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE1,'(',''),')',''),' ','') END TELEFONE1,
			CASE WHEN (SELECT AA.EMAIL FROM PPESSOA AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
		      			AND AA.CODIGO = PPESSOA.CODIGO) IS NOT NULL 
		 	 THEN REPLACE(PPESSOA.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
		         ELSE 'sememail@rubeus.com.br' 
			END	EMAIL,
			CASE WHEN PPESSOA.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(PPESSOA.CPF) <  11
				THEN NULL 
			ELSE PPESSOA.CPF END CPF,
			PPESSOA.RUA,
			PPESSOA.CEP,
			PPESSOA.NUMERO,
			PPESSOA.BAIRRO,
			PPESSOA.CIDADE,
			PPESSOA.ESTADO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SPLETIVO(NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			/**NAO CONSIDERAR ALUNOS FIES**/
		CROSS APPLY(
			SELECT
				SHABILITACAOALUNOCOMPL.CODCOLIGADA,
				SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
				SHABILITACAOALUNOCOMPL.RA
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
			AND ISNULL(FIES,'F') = 'F'
		) AS SHABILITACAO
		INNER JOIN SALUNO(NOLOCK)
			ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SALUNO.RA = SMATRICPL.RA
		INNER JOIN PPESSOA(NOLOCK)
			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.CODSTATUS IN (2,3,4,7,10,    /**GRADUACAO**/
									27,28,29,46,50,/**POS GRADUACAO**/
									23,24,25,67    /**EXTENSAO/LIVRE**/)
	) AS SMATRICPL
	WHERE FLAN.PAGREC = 1
	AND FLAN.STATUSLAN = 3
	/**NAO CONSIDERAR CAIXA ECONOMICA**/
	AND FLAN.CODCFO <> '58807'	
	AND DATEDIFF(DAY,FLAN.DATABAIXA,GETDATE()) <= 50
	GROUP BY SMATRICPL.CONTATOCODIGO,SMATRICPL.NOMECONTATO,SMATRICPL.NOMESOCIAL,
			 SMATRICPL.DTNASCIMENTO,SMATRICPL.TELEFONE1,SMATRICPL.EMAIL,
			 SMATRICPL.CPF,SMATRICPL.CPF,
			 SMATRICPL.RUA,SMATRICPL.CEP,SMATRICPL.NUMERO,SMATRICPL.BAIRRO,
			 SMATRICPL.CIDADE,SMATRICPL.ESTADO,FLAN.IDLAN,FLAN.VALORORIGINAL,
			 SMATRICPL.PERIODOLETIVO,FLAN.CODCFO,FBOLETO.IDBOLETO,
			 FBOLETO.CNABSTATUS,FBOLETO.CNABSTATUS,FLAN.CODCOLIGADA,SMATRICPL.RA,
			 FLAN.CODFILIAL,SCONTRATO.RA,FLAN.VALOROP2,FBOLETO.VENCIMENTO,
			 FLAN.VALOROP5,FLAN.VALOROP6,SLAN.IDPARCELA,FLAN.DATAVENCIMENTO,
			 SCONTRATO.CODCONTRATO,SLAN.CODCOLIGADA,FLAN.DATABAIXA,
			 SCONTRATO.CODCOLIGADA,SCONTRATO.IDHABILITACAOFILIAL,FLAN.CODTDO,
			 SPARCELA.CODCOLIGADA,SPARCELA.CODCONTRATO,FILIAL.NOME,FLAN.CODCFO,
			 COBRADOR.DESCRICAO,FLANCOMPL.DTFIMCOBJUD,FLANCOMPL.DTBXSERASA
) AS SUB
WHERE DATEDIFF(DAY,SUB.EVENTODATA, GETDATE()) < 7
GROUP BY SUB.CONTATOCODIGO,SUB.NOMECONTATO,SUB.NOMESOCIAL,SUB.CODCOLIGADA,
		 SUB.DTNASCIMENTO,SUB.TELEFONE1,SUB.EMAIL,SUB.DATABAIXA,
		 SUB.CPF,SUB.RUA,SUB.CEP,SUB.NUMERO,SUB.BAIRRO,SUB.CIDADE,SUB.ESTADO,
		 SUB.VENCIMENTO,SUB.DATABAIXA,SUB.DIASVENCIDO,SUB.IDBOLETO,SUB.RA,
		 SUB.PERIODOLETIVO,SUB.CODCFO,SUB.EVENTODATA,SUB.FILIAL,
		 SUB.CODREGISTRO,SUB.CONTADOR,SUB.COBRADOR,SUB.BAIXASERASA,
		 SUB.BAIXAPROCESSO,SUB.CONTATORESP";12576;;;;12/09/2022;wsrubeus;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;223;wsrubeus;13/04/2022;wsrubeus;12/09/2022;0
S;RB.INT.GI.008;Envio/Atualização Boletos Judicial;"/******
	- CONSULTA PARA ENVIO DE ATUALIZAÇÃO LANÇAMENTO ENCAMINHADOS PARA COBRANÇA JUDICIAL
	- GESTÃO DA PERMANÊNCIA
******/
SELECT 
	SUB.CONTADOR,
	/** INFORMAÇÕES DO CONTATO **/
	SUB.CONTATOCODIGO AS 'contato.codigo',
	SUB.NOMECONTATO   AS 'contato.nome',
	SUB.NOMESOCIAL    AS 'contato.nomeSocial',
	SUB.DTNASCIMENTO  AS 'contato.dataNascimento',
	SUB.TELEFONE1     AS 'contato.telefonePrincipal',
	SUB.TELEFONE2     AS 'contato.telefonesecundario_1',
	SUB.TELEFONE3     AS 'contato.telefonesecundario_2',
	SUB.EMAIL         AS 'contato.emailPrincipal',
	SUB.CPF           AS 'contato.cpf',
	SUB.RUA      	  AS 'contato.endereco',
	SUB.CEP 		  AS 'contato.cep',
	SUB.NUMERO 		  AS 'contato.numero',
	SUB.BAIRRO 		  AS 'contato.bairro',
	SUB.CIDADE 		  AS 'contato.cidade',
	SUB.ESTADO 		  AS 'contato.estado',
	SUB.GENERO		  AS 'contato.sexo',
	SUB.ESTADOCIVIL   AS 'contato.estadoCivil',
	SUB.COR 		  AS 'contato.cor',
		
	/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/	
	SUB.DTINICOBJUD 							  AS 'evento.campopersonalizado_73_compl_proc',
	SUB.COBRADOR 								  AS 'evento.campopersonalizado_75_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORORIGINAL)) AS 'evento.campopersonalizado_9_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORLIQUIDO))  AS 'evento.campopersonalizado_10_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.DESCONTO))	  AS 'evento.campopersonalizado_11_compl_proc',
	SUBSTRING((
	    SELECT DISTINCT 
	    	', '+ CONVERT(VARCHAR,PARCELA)
	    FROM SPARCELA(NOLOCK)   
	    CROSS APPLY(
	    	SELECT
	    		SLAN.CODCOLIGADA,
	    		SLAN.IDPARCELA
	    	FROM SLAN(NOLOCK)
	    	INNER JOIN FLANBOLETO(NOLOCK)
	    		ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
	    		AND FLANBOLETO.IDLAN = SLAN.IDLAN
	    		AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
	    	WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	    	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
	    ) AS SLAN
	    WHERE SPARCELA.CODCOLIGADA = SUB.CODCOLIGADA	    
	    AND SPARCELA.RA = SUB.RA
	    /*AND CODCONTRATO = SCONTRATO.CODCONTRATO*/
	        FOR XML PATH ('')),2,1000)		      AS 'evento.campopersonalizado_15_compl_proc',
	SUB.VENCIMENTO 	  							  AS 'evento.campopersonalizado_13_compl_proc',	
	/**TIPO DE DOCUMENTO**/
	SUBSTRING((
		SELECT DISTINCT
	   		', '+DESCRICAO
		FROM FTDO(NOLOCK)
		CROSS APPLY(
			SELECT
				FLAN.CODTDO,
				FLAN.CODCOLIGADA
			FROM FLAN(NOLOCK)
			INNER JOIN FLANBOLETO(NOLOCK)
				ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
				AND FLANBOLETO.IDLAN = FLAN.IDLAN
				AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
		) AS FLANSUB
	   WHERE FTDO.CODCOLIGADA = FLANSUB.CODCOLIGADA
	   AND FTDO.CODTDO = FLANSUB.CODTDO
	FOR XML PATH ('')),2,1000) 					  AS 'evento.campopersonalizado_16_compl_proc',
	SUB.PERIODOLETIVO 							  AS 'evento.campopersonalizado_17_compl_proc',
	SUB.CODCFO 									  AS 'evento.campopersonalizado_18_compl_proc',
	SUB.DIASVENCIDO 							  AS 'evento.campopersonalizado_19_compl_proc',
	SUB.IDBOLETO 								  AS 'evento.campopersonalizado_20_compl_proc',
	SUB.STATUSBOLETO 							  AS 'evento.campopersonalizado_24_compl_proc',
	SUB.FILIAL									  AS 'evento.campopersonalizado_21_compl_proc',
	/** NIVEL DE ENSINO **/
	SUBSTRING((SELECT DISTINCT
					', '+STIPOCURSO.NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   CROSS APPLY(
			   		SELECT
			   			NOME
			   		FROM STIPOCURSO(NOLOCK)
			   		INNER JOIN SHABILITACAOFILIAL(NOLOCK)
						ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
						AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   			AND SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
			   			AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO
			   ) AS STIPOCURSO			   	
			FOR XML PATH ('')),2,1000)  AS	'evento.campopersonalizado_76_compl_proc',
			
	/** INFORMAÇÕES DO CURSO **/
	SUBSTRING((SELECT DISTINCT
							', '+NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   	INNER JOIN SHABILITACAOFILIAL(NOLOCK)
					ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   INNER JOIN SCURSO(NOLOCK)
			   		ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			   		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			FOR XML PATH ('')),2,1000)		 	  AS 'evento.campopersonalizado_27_compl_proc',
	CONCAT('https://rubeusscripttotvs.apprbs.com.br/unasp/relatorio.php?p=',SUB.CONTATORESP) AS 'evento.campopersonalizado_85_compl_proc',
	
	/** INFORMAÇÕES DO EVENTO **/
	SUB.CODREGISTRO  AS 'evento.codRegistro',
	SUB.EVENTODATA 	 AS 'evento.data',
	SUB.CONTATORESP   AS 'evento.codigoResponsavelFinanceiro',
	SUB.CONTATOCODIGO AS 'evento.pessoa'
FROM (
	SELECT
		ROW_NUMBER() OVER(ORDER BY FBOLETO.IDBOLETO ASC) AS CONTADOR,	
		/** INFORMAÇÕES DO CONTATO **/
		PPESSOA.CONTATOCODIGO,
		CONCAT('R-',FLAN.CODCFO) AS CONTATORESP,
		PPESSOA.NOMECONTATO,
		PPESSOA.NOMESOCIAL,
		PPESSOA.DTNASCIMENTO,
	    PPESSOA.TELEFONE1,
		PPESSOA.TELEFONE2,
		PPESSOA.TELEFONE3,
		PPESSOA.EMAIL,
		PPESSOA.CPF,
		PPESSOA.RUA,
		PPESSOA.CEP,
		PPESSOA.NUMERO,
		PPESSOA.BAIRRO,
		PPESSOA.CIDADE,
		PPESSOA.ESTADO,
		PPESSOA.GENERO,
	  	PPESSOA.ESTADOCIVIL,
		PPESSOA.COR,
		
		/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
		CONVERT(VARCHAR(30), CAST(FLANCOMPL.DTINICOBJUD AS DATE), 121) AS DTINICOBJUD,
		COBRADOR.DESCRICAO AS COBRADOR,
		FLAN.IDLAN,
		PPESSOA.RA,
		FLAN.CODCOLIGADA,
		FLAN.VALORORIGINAL AS VALORORIGINAL,
		CASE 
			WHEN SPARCELA.PARCELA = 1 THEN (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) 
		ELSE (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0))
			+ ((FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) * 0.02)
			+ + ((((FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) * 0.01) / 30) * DATEDIFF(DAY, FLAN.DATAVENCIMENTO, GETDATE()))
		END AS VALORLIQUIDO,
		(FLAN.VALOROP2 + FLAN.VALOROP5 + FLAN.VALOROP6 + ISNULL(FLANINTEGRACAO.VALOR,0)) AS DESCONTO,
		/*'Valor baixado' AS 'evento.campopersonalizado_12_compl_proc',*/
		CONVERT(VARCHAR,FBOLETO.VENCIMENTO,103) AS VENCIMENTO,
		/*'Data baixa' AS 'evento.campopersonalizado_14_compl_proc',*/
		SMATRICPL.PERIODOLETIVO,
		FLAN.CODCFO,
		DATEDIFF(DAY,FBOLETO.VENCIMENTO,GETDATE()) AS DIASVENCIDO,
		FBOLETO.IDBOLETO,
		CASE 
			WHEN FBOLETO.CNABSTATUS	= 0 THEN 'Não Remetido'
			WHEN FBOLETO.CNABSTATUS	= 1 THEN 'Remetido'
			WHEN FBOLETO.CNABSTATUS	= 2 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 3 THEN 'Recusado'
			WHEN FBOLETO.CNABSTATUS	= 4 THEN 'Baixado'
			WHEN FBOLETO.CNABSTATUS	= 5 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 6 THEN 'Cancelado'
			WHEN FBOLETO.CNABSTATUS	= 7 THEN 'Pendente Remessa'
		ELSE 'Boleto sem status' END AS STATUSBOLETO,
		FILIAL.NOME AS FILIAL,
		
	  	/** INFORMAÇÕES DO EVENTO **/
	  	CONCAT('GI-',FLAN.CODCOLIGADA,'-',FLAN.CODFILIAL,'-',FBOLETO.IDBOLETO) AS CODREGISTRO, 
		CONCAT(CONVERT(VARCHAR(10), CAST(FBOLETO.VENCIMENTO AS DATETIME), 121),' 08:00:00') AS EVENTODATA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO(NOLOCK)
		ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANBOLETO.IDLAN = FLAN.IDLAN
	
	INNER JOIN FLANCOMPL(NOLOCK)
		ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANCOMPL.IDLAN = FLAN.IDLAN
		AND FLANCOMPL.COBJUD = '1' 
		AND FLANCOMPL.DTFIMCOBJUD IS NULL
	
	OUTER APPLY(
		SELECT
			DESCRICAO
		FROM GCONSIST(NOLOCK)
		WHERE CODTABELA = 'COBJUD'
		AND CODCLIENTE = FLANCOMPL.RESPCOBJUD
	) AS COBRADOR
		
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FBOLETO.VENCIMENTO < GETDATE()
		AND FBOLETO.STATUS = 0
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO

	CROSS APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO
	
	OUTER APPLY(
		SELECT
			NOME
		FROM GFILIAL(NOLOCK)
		WHERE CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODFILIAL = FLAN.CODFILIAL
	) AS FILIAL
	
	/**DESCONTOS ABA INTEGRACAO**/
	OUTER APPLY(
		SELECT 
			SUM(VALOR) AS VALOR
		FROM FLANINTEGRACAO (NOLOCK) 
		WHERE FLANBOLETO.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA
	    AND FLANBOLETO.IDLAN = FLANINTEGRACAO.IDLAN
	    AND VALOR > 0
	    AND IDCAMPO NOT IN (48,49,52)
	) AS FLANINTEGRACAO

	/**DADOS ALUNO**/
	CROSS APPLY(
		SELECT
			CONCAT('P-',PPESSOA.CODIGO) AS CONTATOCODIGO,
			PPESSOA.NOME AS NOMECONTATO,
			PPESSOA.NOMESOCIAL AS NOMESOCIAL,
			CONVERT(VARCHAR(10),PPESSOA.DTNASCIMENTO, 121) AS DTNASCIMENTO,
		    CASE WHEN LEN(COALESCE(PPESSOA.TELEFONE1,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE1,'(',''),')',''),' ','') END TELEFONE1,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE2,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE2,'(',''),')',''),' ','') END TELEFONE2,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE3,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE3,'(',''),')',''),' ','') END TELEFONE3,
			CASE WHEN (SELECT AA.EMAIL FROM PPESSOA AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
		      			AND AA.CODIGO = PPESSOA.CODIGO) IS NOT NULL 
		 	 THEN REPLACE(PPESSOA.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
		         ELSE 'sememail@rubeus.com.br' 
			END	EMAIL,
			CASE WHEN PPESSOA.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(PPESSOA.CPF) <  11
				THEN NULL 
			ELSE PPESSOA.CPF END CPF,
			PPESSOA.RUA,
			PPESSOA.CEP,
			PPESSOA.NUMERO,
			PPESSOA.BAIRRO,
			PPESSOA.CIDADE,
			PPESSOA.ESTADO,
			CASE PPESSOA.SEXO WHEN 'M' THEN 1 ELSE 2 END AS GENERO,
		  	CASE PPESSOA.ESTADOCIVIL 
				WHEN 'C' THEN 1 /*CASADO */
				WHEN 'D' THEN 2 /*DESQUITADO */
				WHEN 'E' THEN 3 /*UNIAO ESTAVEL */
				WHEN 'I' THEN 4 /*DIVORCIADO */
				WHEN 'O' THEN 5 /*OUTROS */
				WHEN 'P' THEN 6 /*SEPARADO */
				WHEN 'S' THEN 7 /*SOLTEIRO */
				WHEN 'V' THEN 8 /*VIUVO */
			END AS ESTADOCIVIL,
			CASE PPESSOA.CORRACA
				WHEN 0 THEN 1
				WHEN 2 THEN 2
				WHEN 4 THEN 3
				WHEN 6 THEN 4
				WHEN 8 THEN 5
				WHEN 9 THEN 6
				WHEN 10 THEN 7
			END COR,
			SALUNO.RA
		FROM SALUNO(NOLOCK)
		INNER JOIN PPESSOA(NOLOCK)
			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
		WHERE SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SALUNO.RA = SCONTRATO.RA
	) AS PPESSOA		
	
	/**DADOS MATRICULA**/
	CROSS APPLY(
		SELECT DISTINCT
			SMATRICPL.CODCOLIGADA,
			SMATRICPL.RA,
			CODSTATUS,
			SPLETIVO.CODPERLET AS PERIODOLETIVO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SPLETIVO(NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			/**NAO CONSIDERAR ALUNOS FIES**/
		CROSS APPLY(
			SELECT
				SHABILITACAOALUNOCOMPL.CODCOLIGADA,
				SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
				SHABILITACAOALUNOCOMPL.RA
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
			AND ISNULL(FIES,'F') = 'F'
		) AS SHABILITACAO
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.CODSTATUS IN (2,3,4,7,10,    /**GRADUACAO**/
									27,28,29,46,50,/**POS GRADUACAO**/
									23,24,25,67    /**EXTENSAO/LIVRE**/)
	) AS SMATRICPL
	
	WHERE FLAN.PAGREC = 1
	AND FLAN.STATUSLAN = 0	
	/**NAO CONSIDERAR CAIXA ECONOMICA**/
	AND FLAN.CODCFO <> '58807'
	AND (FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) > 0
	
	GROUP BY PPESSOA.CONTATOCODIGO,PPESSOA.NOMECONTATO,PPESSOA.NOMESOCIAL,
			 PPESSOA.DTNASCIMENTO,PPESSOA.TELEFONE1,PPESSOA.TELEFONE2,
			 PPESSOA.TELEFONE3,PPESSOA.EMAIL,PPESSOA.CPF,PPESSOA.CPF,PPESSOA.RA,
			 PPESSOA.RUA,PPESSOA.CEP,PPESSOA.NUMERO,PPESSOA.BAIRRO,FBOLETO.IPTE,
			 PPESSOA.CIDADE,PPESSOA.ESTADO,PPESSOA.GENERO,PPESSOA.ESTADOCIVIL,
			 PPESSOA.COR,FLAN.IDLAN,FLAN.VALORORIGINAL,FBOLETO.VENCIMENTO,
			 SMATRICPL.PERIODOLETIVO,FLAN.CODCFO,FLAN.CODTDO,FBOLETO.IDBOLETO,
			 FBOLETO.CNABSTATUS,FBOLETO.CNABSTATUS,FLAN.CODCOLIGADA,
			 FLAN.CODFILIAL,SCONTRATO.RA,FLAN.VALOROP2,FLAN.VALOROP5,
			 FLAN.VALOROP6,FLANINTEGRACAO.VALOR,SLAN.IDPARCELA,FLAN.CODCFO,
			 SCONTRATO.CODCONTRATO,SLAN.CODCOLIGADA,FLAN.DATAVENCIMENTO,
			 SCONTRATO.CODCOLIGADA,SCONTRATO.IDHABILITACAOFILIAL,SPARCELA.PARCELA,
			 SPARCELA.CODCOLIGADA,SPARCELA.CODCONTRATO,FILIAL.NOME,
			 FLANCOMPL.DTINICOBJUD,COBRADOR.DESCRICAO
) AS SUB
WHERE SUB.CONTADOR BETWEEN 1 AND 100
GROUP BY SUB.CONTATOCODIGO,SUB.NOMECONTATO,SUB.NOMESOCIAL,SUB.CODCOLIGADA,
		 SUB.DTNASCIMENTO,SUB.TELEFONE1,SUB.TELEFONE2,SUB.TELEFONE3,SUB.EMAIL,
		 SUB.CPF,SUB.RUA,SUB.CEP,SUB.NUMERO,SUB.BAIRRO,SUB.CIDADE,SUB.ESTADO,
		 SUB.GENERO,SUB.ESTADOCIVIL,SUB.COR,SUB.VENCIMENTO,
		 SUB.PERIODOLETIVO,SUB.CODCFO,SUB.DIASVENCIDO,SUB.IDBOLETO,SUB.RA,
		 SUB.STATUSBOLETO,SUB.CODREGISTRO,SUB.EVENTODATA,SUB.FILIAL,
		 SUB.CONTADOR,SUB.DTINICOBJUD,SUB.COBRADOR,SUB.CONTATORESP";15488;;;;07/09/2022;shift;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;-25846;wsrubeus;13/04/2022;shift;07/09/2022;0
S;RB.INT.GI.009;Envio/Atualização Boletos Estornados/Cancelados;"/******
	- CONSULTA PARA ENVIO E ATUALIZAÇÃO DOS BOLETOS CANCELADOS/ESTORNADOS
	- GESTÃO DA PERMANÊNCIA
******/
SELECT 
	SUB.CONTADOR,
	/** INFORMAÇÕES DO CONTATO **/
	SUB.CONTATOCODIGO AS 'contato.codigo',
	SUB.NOMECONTATO   AS 'contato.nome',
	SUB.NOMESOCIAL    AS 'contato.nomeSocial',
	SUB.DTNASCIMENTO  AS 'contato.dataNascimento',
	SUB.TELEFONE1     AS 'contato.telefonePrincipal',
	SUB.TELEFONE2     AS 'contato.telefonesecundario_1',
	SUB.TELEFONE3     AS 'contato.telefonesecundario_2',
	SUB.EMAIL         AS 'contato.emailPrincipal',
	SUB.CPF           AS 'contato.cpf',
	SUB.RUA      	  AS 'contato.endereco',
	SUB.CEP 		  AS 'contato.cep',
	SUB.NUMERO 		  AS 'contato.numero',
	SUB.BAIRRO 		  AS 'contato.bairro',
	SUB.CIDADE 		  AS 'contato.cidade',
	SUB.ESTADO 		  AS 'contato.estado',
	SUB.GENERO		  AS 'contato.sexo',
	SUB.ESTADOCIVIL   AS 'contato.estadoCivil',
	SUB.COR 		  AS 'contato.cor',
		
	/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/	
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORBAIXADO))  AS 'evento.campopersonalizado_12_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORORIGINAL)) AS 'evento.campopersonalizado_9_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.VALORLIQUIDO))  AS 'evento.campopersonalizado_10_compl_proc',
	CONVERT(DECIMAL(10,2),SUM(SUB.DESCONTO))	  AS 'evento.campopersonalizado_11_compl_proc',
	SUB.DATABAIXA 								  AS 'evento.campopersonalizado_14_compl_proc',
	SUBSTRING((
	    SELECT DISTINCT 
	    	', '+ CONVERT(VARCHAR,PARCELA)
	    FROM SPARCELA(NOLOCK)   
	    CROSS APPLY(
	    	SELECT
	    		SLAN.CODCOLIGADA,
	    		SLAN.IDPARCELA
	    	FROM SLAN(NOLOCK)
	    	INNER JOIN FLANBOLETO(NOLOCK)
	    		ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
	    		AND FLANBOLETO.IDLAN = SLAN.IDLAN
	    		AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
	    	WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	    	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
	    ) AS SLAN
	    WHERE SPARCELA.CODCOLIGADA = SUB.CODCOLIGADA	    
	    AND SPARCELA.RA = SUB.RA
	    /*AND CODCONTRATO = SCONTRATO.CODCONTRATO*/
	        FOR XML PATH ('')),2,1000)		      AS 'evento.campopersonalizado_15_compl_proc',
	SUB.VENCIMENTO 	  							  AS 'evento.campopersonalizado_13_compl_proc',	
	/**TIPO DE DOCUMENTO**/
	SUBSTRING((
		SELECT DISTINCT
	   		', '+DESCRICAO
		FROM FTDO(NOLOCK)
		CROSS APPLY(
			SELECT
				FLAN.CODTDO,
				FLAN.CODCOLIGADA
			FROM FLAN(NOLOCK)
			INNER JOIN FLANBOLETO(NOLOCK)
				ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
				AND FLANBOLETO.IDLAN = FLAN.IDLAN
				AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
		) AS FLANSUB
	   WHERE FTDO.CODCOLIGADA = FLANSUB.CODCOLIGADA
	   AND FTDO.CODTDO = FLANSUB.CODTDO
	FOR XML PATH ('')),2,1000) 					  AS 'evento.campopersonalizado_16_compl_proc',
	SUB.PERIODOLETIVO 							  AS 'evento.campopersonalizado_17_compl_proc',
	SUB.CODCFO 									  AS 'evento.campopersonalizado_18_compl_proc',
	SUB.DIASVENCIDO 							  AS 'evento.campopersonalizado_19_compl_proc',
	SUB.IDBOLETO 								  AS 'evento.campopersonalizado_20_compl_proc',
	SUB.STATUSBOLETO 							  AS 'evento.campopersonalizado_24_compl_proc',
	SUB.FILIAL									  AS 'evento.campopersonalizado_21_compl_proc',
	/** NIVEL DE ENSINO **/
	SUBSTRING((SELECT DISTINCT
					', '+STIPOCURSO.NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   CROSS APPLY(
			   		SELECT
			   			NOME
			   		FROM STIPOCURSO(NOLOCK)
			   		INNER JOIN SHABILITACAOFILIAL(NOLOCK)
						ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
						AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   			AND SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
			   			AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO
			   ) AS STIPOCURSO			   	
			FOR XML PATH ('')),2,1000)  AS	'evento.campopersonalizado_76_compl_proc',
			
	/** INFORMAÇÕES DO CURSO **/
	SUBSTRING((SELECT DISTINCT
							', '+NOME
			   FROM SCONTRATO(NOLOCK)
			   CROSS APPLY(
			   		SELECT
			   			SPARCELA.CODCOLIGADA,
			   			SPARCELA.CODCONTRATO
			   		FROM SPARCELA(NOLOCK)
			   		INNER JOIN SLAN(NOLOCK)
			   			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
			   			AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
			   		INNER JOIN FLANBOLETO(NOLOCK)
			   			ON FLANBOLETO.CODCOLIGADA = SLAN.CODCOLIGADA
			   			AND FLANBOLETO.IDLAN = SLAN.IDLAN
			   			AND FLANBOLETO.IDBOLETO = SUB.IDBOLETO
			   		WHERE SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
			   		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
			   ) AS PARCELA
			   	INNER JOIN SHABILITACAOFILIAL(NOLOCK)
					ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
					AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
			   INNER JOIN SCURSO(NOLOCK)
			   		ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			   		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			FOR XML PATH ('')),2,1000)		 	  AS 'evento.campopersonalizado_27_compl_proc',
	CONCAT('https://rubeusscripttotvs.apprbs.com.br/unasp/relatorio.php?p=',SUB.CONTATORESP) AS 'evento.campopersonalizado_85_compl_proc',
	
	/** INFORMAÇÕES DO EVENTO **/
	SUB.CODREGISTRO   AS 'evento.codRegistro',
	SUB.EVENTODATA 	  AS 'evento.data',
	SUB.CONTATORESP   AS 'evento.codigoResponsavelFinanceiro',
	SUB.CONTATOCODIGO AS 'evento.pessoa'
FROM (
	SELECT
		ROW_NUMBER() OVER(ORDER BY FBOLETO.IDBOLETO ASC) AS CONTADOR,	
		/** INFORMAÇÕES DO CONTATO **/
		PPESSOA.CONTATOCODIGO,
		CONCAT('R-',FLAN.CODCFO) AS CONTATORESP,
		PPESSOA.NOMECONTATO,
		PPESSOA.NOMESOCIAL,
		PPESSOA.DTNASCIMENTO,
	    PPESSOA.TELEFONE1,
		PPESSOA.TELEFONE2,
		PPESSOA.TELEFONE3,
		PPESSOA.EMAIL,
		PPESSOA.CPF,
		PPESSOA.RUA,
		PPESSOA.CEP,
		PPESSOA.NUMERO,
		PPESSOA.BAIRRO,
		PPESSOA.CIDADE,
		PPESSOA.ESTADO,
		PPESSOA.GENERO,
	  	PPESSOA.ESTADOCIVIL,
		PPESSOA.COR,
		
		/** INFORMAÇÕES DOS CAMPOS PERSONALIZADOS **/
		FLAN.IDLAN,
		PPESSOA.RA,
		FLAN.CODCOLIGADA,
		FLAN.VALORORIGINAL AS VALORORIGINAL,
		(FLAN.VALORORIGINAL - FLAN.VALOROP2 - FLAN.VALOROP5 - FLAN.VALOROP6 - ISNULL(FLANINTEGRACAO.VALOR,0)) AS VALORLIQUIDO,
		(FLAN.VALOROP2 + FLAN.VALOROP5 + FLAN.VALOROP6 + ISNULL(FLANINTEGRACAO.VALOR,0)) AS DESCONTO,
		FLAN.VALORBAIXADO,
		CONVERT(VARCHAR,FBOLETO.VENCIMENTO,103) AS VENCIMENTO,
		CONVERT(VARCHAR,FLAN.DATABAIXA,103) AS DATABAIXA,
		SMATRICPL.PERIODOLETIVO,
		FLAN.CODCFO,
		DATEDIFF(DAY,FBOLETO.VENCIMENTO,FLAN.DATACANCELAMENTO) AS DIASVENCIDO,
		FBOLETO.IDBOLETO,
		CASE 
			WHEN FBOLETO.CNABSTATUS	= 0 THEN 'Não Remetido'
			WHEN FBOLETO.CNABSTATUS	= 1 THEN 'Remetido'
			WHEN FBOLETO.CNABSTATUS	= 2 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 3 THEN 'Recusado'
			WHEN FBOLETO.CNABSTATUS	= 4 THEN 'Baixado'
			WHEN FBOLETO.CNABSTATUS	= 5 THEN FBOLETO.IPTE
			WHEN FBOLETO.CNABSTATUS	= 6 THEN 'Cancelado'
			WHEN FBOLETO.CNABSTATUS	= 7 THEN 'Pendente Remessa'
		ELSE 'Boleto sem status' END AS STATUSBOLETO,
		FILIAL.NOME AS FILIAL,
		
	  	/** INFORMAÇÕES DO EVENTO **/
	  	CONCAT('GI-',FLAN.CODCOLIGADA,'-',FLAN.CODFILIAL,'-',FBOLETO.IDBOLETO) AS CODREGISTRO, 
		CONCAT(CONVERT(VARCHAR(10), CAST(FLAN.DATACANCELAMENTO AS DATETIME), 121),' 08:00:00') AS EVENTODATA
		
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO(NOLOCK)
		ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
		AND FLANBOLETO.IDLAN = FLAN.IDLAN
		
	INNER JOIN FBOLETO(NOLOCK)
		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
		AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FBOLETO.STATUS = 2
	
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO

	CROSS APPLY(
		SELECT
			CODTDO,
			CODCOLIGADA
		FROM FTDO(NOLOCK)
		WHERE CODTDO = FLAN.CODTDO
		AND CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODTDO IN ('ACORDO_EXT','CHQ_DEV','EXTENSAO','FINE','INTER','MENS','OUTRBAIX','OUTRCONT','PENS')
	) AS FTDO
	
	OUTER APPLY(
		SELECT
			NOME
		FROM GFILIAL(NOLOCK)
		WHERE CODCOLIGADA = FLAN.CODCOLIGADA
		AND CODFILIAL = FLAN.CODFILIAL
	) AS FILIAL
	
	/**DESCONTOS ABA INTEGRACAO**/
	OUTER APPLY(
		SELECT 
			SUM(VALOR) AS VALOR
		FROM FLANINTEGRACAO (NOLOCK) 
		WHERE FLANBOLETO.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA
	    AND FLANBOLETO.IDLAN = FLANINTEGRACAO.IDLAN
	    AND VALOR > 0
	) AS FLANINTEGRACAO

	/**DADOS ALUNO**/
	CROSS APPLY(
		SELECT
			CONCAT('P-',PPESSOA.CODIGO) AS CONTATOCODIGO,
			PPESSOA.NOME AS NOMECONTATO,
			PPESSOA.NOMESOCIAL AS NOMESOCIAL,
			CONVERT(VARCHAR(10),PPESSOA.DTNASCIMENTO, 121) AS DTNASCIMENTO,
		    CASE WHEN LEN(COALESCE(PPESSOA.TELEFONE1,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE1,'(',''),')',''),' ','') END TELEFONE1,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE2,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE2,'(',''),')',''),' ','') END TELEFONE2,
			CASE WHEN LEN(ISNULL(PPESSOA.TELEFONE3,'0')) < 8 THEN NULL ELSE REPLACE(REPLACE(REPLACE(PPESSOA.TELEFONE3,'(',''),')',''),' ','') END TELEFONE3,
			CASE WHEN (SELECT AA.EMAIL FROM PPESSOA AA (NOLOCK) WHERE AA.EMAIL LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', AA.EMAIL) = 0 
		      			AND AA.CODIGO = PPESSOA.CODIGO) IS NOT NULL 
		 	 THEN REPLACE(PPESSOA.EMAIL COLLATE SQL_Latin1_General_CP1251_CS_AS,' ','')
		         ELSE 'sememail@rubeus.com.br' 
			END	EMAIL,
			CASE WHEN PPESSOA.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(PPESSOA.CPF) <  11
				THEN NULL 
			ELSE PPESSOA.CPF END CPF,
			PPESSOA.RUA,
			PPESSOA.CEP,
			PPESSOA.NUMERO,
			PPESSOA.BAIRRO,
			PPESSOA.CIDADE,
			PPESSOA.ESTADO,
			CASE PPESSOA.SEXO WHEN 'M' THEN 1 ELSE 2 END AS GENERO,
		  	CASE PPESSOA.ESTADOCIVIL 
				WHEN 'C' THEN 1 /*CASADO */
				WHEN 'D' THEN 2 /*DESQUITADO */
				WHEN 'E' THEN 3 /*UNIAO ESTAVEL */
				WHEN 'I' THEN 4 /*DIVORCIADO */
				WHEN 'O' THEN 5 /*OUTROS */
				WHEN 'P' THEN 6 /*SEPARADO */
				WHEN 'S' THEN 7 /*SOLTEIRO */
				WHEN 'V' THEN 8 /*VIUVO */
			END AS ESTADOCIVIL,
			CASE PPESSOA.CORRACA
				WHEN 0 THEN 1
				WHEN 2 THEN 2
				WHEN 4 THEN 3
				WHEN 6 THEN 4
				WHEN 8 THEN 5
				WHEN 9 THEN 6
				WHEN 10 THEN 7
			END COR,
			SALUNO.RA
		FROM SALUNO(NOLOCK)
		INNER JOIN PPESSOA(NOLOCK)
			ON PPESSOA.CODIGO = SALUNO.CODPESSOA
		WHERE SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SALUNO.RA = SCONTRATO.RA
	) AS PPESSOA		
	
	/**DADOS MATRICULA**/
	CROSS APPLY(
		SELECT DISTINCT
			SMATRICPL.CODCOLIGADA,
			SMATRICPL.RA,
			CODSTATUS,
			SPLETIVO.CODPERLET AS PERIODOLETIVO
		FROM SMATRICPL(NOLOCK)
		INNER JOIN SPLETIVO(NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			/**NAO CONSIDERAR ALUNOS FIES**/
		CROSS APPLY(
			SELECT
				SHABILITACAOALUNOCOMPL.CODCOLIGADA,
				SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL,
				SHABILITACAOALUNOCOMPL.RA
			FROM SHABILITACAOALUNOCOMPL(NOLOCK)
			INNER JOIN SHABILITACAOALUNO(NOLOCK)
				ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOALUNOCOMPL.CODCOLIGADA
				AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL
				AND SHABILITACAOALUNO.RA = SHABILITACAOALUNOCOMPL.RA
			WHERE SHABILITACAOALUNOCOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNOCOMPL.RA = SMATRICPL.RA
			AND ISNULL(FIES,'F') = 'F'
		) AS SHABILITACAO
		WHERE SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
		AND SMATRICPL.RA = SCONTRATO.RA
		AND SMATRICPL.CODSTATUS IN (2,3,4,7,10,    /**GRADUACAO**/
									27,28,29,46,50,/**POS GRADUACAO**/
									23,24,25,67    /**EXTENSAO/LIVRE**/)
	) AS SMATRICPL
	
	WHERE FLAN.PAGREC = 1
	/**NAO CONSIDERAR CAIXA ECONOMICA**/
	AND FLAN.CODCFO <> '58807'
	
	GROUP BY PPESSOA.CONTATOCODIGO,PPESSOA.NOMECONTATO,PPESSOA.NOMESOCIAL,
			 PPESSOA.DTNASCIMENTO,PPESSOA.TELEFONE1,PPESSOA.TELEFONE2,
			 PPESSOA.TELEFONE3,PPESSOA.EMAIL,PPESSOA.CPF,PPESSOA.CPF,FLAN.CODTDO,
			 PPESSOA.RUA,PPESSOA.CEP,PPESSOA.NUMERO,PPESSOA.BAIRRO,PPESSOA.RA,
			 PPESSOA.CIDADE,PPESSOA.ESTADO,PPESSOA.GENERO,PPESSOA.ESTADOCIVIL,
			 PPESSOA.COR,FLAN.IDLAN,FLAN.VALORORIGINAL,FBOLETO.VENCIMENTO,
			 SMATRICPL.PERIODOLETIVO,FLAN.CODCFO,FBOLETO.IDBOLETO,FBOLETO.IPTE,
			 FBOLETO.CNABSTATUS,FBOLETO.CNABSTATUS,FLAN.CODCOLIGADA,
			 FLAN.CODFILIAL,SCONTRATO.RA,FLAN.VALOROP2,FLAN.VALORBAIXADO,
			 FLAN.VALOROP5,FLAN.VALOROP6,FLANINTEGRACAO.VALOR,SLAN.IDPARCELA,
			 SCONTRATO.CODCONTRATO,SLAN.CODCOLIGADA,FLAN.DATACANCELAMENTO,
			 SCONTRATO.CODCOLIGADA,SCONTRATO.IDHABILITACAOFILIAL,FLAN.DATABAIXA,
			 SPARCELA.CODCOLIGADA,SPARCELA.CODCONTRATO,FILIAL.NOME,FLAN.CODCFO
) AS SUB
WHERE DATEDIFF(DAY,SUB.EVENTODATA, GETDATE()) < 7
GROUP BY SUB.CONTATOCODIGO,SUB.NOMECONTATO,SUB.NOMESOCIAL,SUB.CODCOLIGADA,
		 SUB.DTNASCIMENTO,SUB.TELEFONE1,SUB.TELEFONE2,SUB.TELEFONE3,SUB.EMAIL,
		 SUB.CPF,SUB.RUA,SUB.CEP,SUB.NUMERO,SUB.BAIRRO,SUB.CIDADE,SUB.ESTADO,
		 SUB.GENERO,SUB.ESTADOCIVIL,SUB.COR,SUB.VENCIMENTO,SUB.DATABAIXA,
		 SUB.PERIODOLETIVO,SUB.CODCFO,SUB.DIASVENCIDO,SUB.IDBOLETO,SUB.RA,
		 SUB.STATUSBOLETO,SUB.CODREGISTRO,SUB.EVENTODATA,SUB.FILIAL,
		 SUB.CONTADOR,SUB.VALORBAIXADO,SUB.CONTATORESP";14319;;;;12/09/2022;wsrubeus;0;1;1;1;;;;0;5f5df2c8-db19-428f-8520-d616760da342;0;;-2258;wsrubeus;13/04/2022;wsrubeus;12/09/2022;0
S;RB.INT.REL;Consultas de integração de Relatórios;;0;;;;04/05/2022;wsrubeus;0;1;1;1;;;;0;917f2603-a7de-41f7-b758-32e8257729e4;0;;-20594;wsrubeus;04/05/2022;wsrubeus;04/05/2022;0
S;RB.INT.REL.001;Consultas de integração de Relatórios;"/**
	FUNÇÃO: TRAZER OS DADOS PARA GERAÇÃO DO RELATÓRIO DE DÉBITOS - CONTROLE DE INADIMPLÊNCIA
**/
SELECT
  FCFO.CODCFO AS CODCFO,
  RRPTREPORT.ID as IDRELATORIO,
  RRPTREPORT.CODCOLIGADA AS CODCOLIGADARELATORIO
FROM FCFO(NOLOCK)
INNER JOIN SALUNO (NOLOCK)
	ON SALUNO.CODCFO = FCFO.CODCFO
CROSS APPLY(
	SELECT 
		ID,
		CODCOLIGADA
	FROM RRPTREPORT(NOLOCK) WHERE CODIGO = 'FINANCEIRO.004') AS RRPTREPORT
WHERE  FCFO.CODCFO = :CODCFO";445;;;;04/05/2022;wsrubeus;0;1;1;1;;;;0;917f2603-a7de-41f7-b758-32e8257729e4;0;;-12663;wsrubeus;04/05/2022;wsrubeus;04/05/2022;0
S;RB.PS;## Consultas do Processo seletivo ##;"SELECT
	CONVERT(VARCHAR, RECMODIFIEDON) AS MODIFICADO
FROM
	spsopcaoinscrito
WHERE
	NUMEROINSCRICAO = 42
	AND IDPS = 132";126;;;;17/10/2022;crmrubeus;0;1;1;1;;;;0;554befc4-10fa-46dc-ad1f-e525ad3fae07;0;;25420;wsrubeus;27/09/2021;crmrubeus;17/10/2022;0
S;RB.PS.FV;Consulta utilizadas em fórmulas visuais;"SELECT * FROM SPSPROCESSOSELETIVO
WHERE IDPS = 122";51;;;;17/05/2022;wsrubeus;0;1;1;1;;;;0;f63015df-304a-49b2-acda-a85eb5c43702;0;;30911;wsrubeus;22/10/2021;wsrubeus;17/05/2022;0
S;RB.PS.FV.001;Buscar etapa Área de interesse;"SELECT
	IDETAPA,
	NOME,
	IDPS,
	ORDEMETAPA
FROM SPSETAPAAREAOFERTADA(NOLOCK)
WHERE SPSETAPAAREAOFERTADA.IDPS = 134";120;;;;05/09/2022;wsrubeus;0;1;1;1;;;;0;f63015df-304a-49b2-acda-a85eb5c43702;0;;-7319;wsrubeus;22/10/2021;wsrubeus;05/09/2022;0
S;RB.PS.FV.002;Consulta utilizada para alocação de candidatos;"/*****
	FUNÇÃO: TRAZER DADOS PARA INSERIR LOCAL DE PROVA CANDIDATO
*****/
SELECT 
	SPSOPCAOINSCRITO.CODCOLIGADA,
	SPSOPCAOINSCRITO.IDPS,
	SPSOPCAOINSCRITO.NUMEROINSCRICAO,
	SPSOPCAOINSCRITO.ULTIMAETAPA,
	SPSOPCAOINSCRITO.IDAREAINTERESSE,
	SPSOPCAOINSCRITO.CODUSUARIOPS,
	ETAPA.IDETAPA,
	SPSLOCALPS.IDLOCALPS,
	CASE 
		WHEN :ETAPA = 2 AND SPSOPCAOINSCRITO.ULTIMAETAPA = 1 AND SPSOPCAOINSCRITO.STATUS = 16 THEN 2
	/*	WHEN :ETAPA = 3 AND SPSOPCAOINSCRITO.ULTIMAETAPA = 2 AND SPSOPCAOINSCRITO.STATUS = 16 THEN 3
		WHEN :ETAPA = 3 AND SPSOPCAOINSCRITO.ULTIMAETAPA = 3 AND SPSOPCAOINSCRITO.STATUS = 16 THEN 4	*/
	ELSE 0 END	AS PROXIMAETAPA
FROM SPSOPCAOINSCRITO(NOLOCK)
CROSS APPLY(
	SELECT 
		IDLOCALPS
	FROM SPSLOCALPS(NOLOCK) 
	WHERE IDPS = SPSOPCAOINSCRITO.IDPS 
	AND CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSLOCALPS.PRIORIDADEENSALAMENTO = 1) AS SPSLOCALPS
CROSS APPLY(
	SELECT
		IDETAPA,
		NOME,
		ORDEMETAPA
	FROM SPSETAPAAREAOFERTADA(NOLOCK)
	WHERE SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSETAPAAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND ORDEMETAPA = :ETAPA) AS ETAPA
WHERE SPSOPCAOINSCRITO.IDPS = :IDPS
AND SPSOPCAOINSCRITO.CODCOLIGADA = :CODCOLIGADA
AND SPSOPCAOINSCRITO.STATUS = 16
AND SPSOPCAOINSCRITO.ULTIMAETAPA = 1
/** REGRA DE ALOCAÇÃO **/
AND CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) 
NOT IN(SELECT CONCAT(CODCOLIGADA,'-',IDPS,'-',NUMEROINSCRICAO) FROM SPSLOCALETAPAINSCRITO(NOLOCK) WHERE IDPS = :IDPS AND IDETAPA = ETAPA.IDETAPA)";1585;;;;05/09/2022;wsrubeus;0;1;1;1;;;;0;f63015df-304a-49b2-acda-a85eb5c43702;0;;-1766;wsrubeus;22/10/2021;wsrubeus;05/09/2022;0
S;RB.PS.FV.003;Consulta classificação de candidatos- Automação da Classificação;"SELECT DISTINCT
	SPSAREAOFERTADA.CODCOLIGADA,
	SPSAREAOFERTADA.IDPS, 
	SPSAREAOFERTADA.IDAREAINTERESSE,
	SPSPROCESSOSELETIVO.CODFILIAL
	
FROM SPSAREAOFERTADA (NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO (NOLOCK)
	ON (SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON (SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS)
	
INNER JOIN SPSOPCAOINSCRITO(NOLOCK)
	ON (SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE)

INNER JOIN SPSETAPAAREAOFERTADA  (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA 
	AND SPSOPCAOINSCRITO.IDPS = SPSETAPAAREAOFERTADA.IDPS 
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE 

INNER JOIN SPSHORARIOETAPAAREAOFERTADA (NOLOCK) 
	ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA 
	AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE 
	AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS 
	AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA 

INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
	ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS 
	AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE 
	AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA 
	AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO 
	
WHERE 	
	GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIRESULTADO AND SPSPROCESSOSELETIVO.DTFIMRESULTADO
AND SPSAREAOFERTADA.UTILIZAENEM = 'F'
AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%'
AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%MESTRADO%'

ORDER BY SPSAREAOFERTADA.IDPS, SPSAREAOFERTADA.IDAREAINTERESSE";2078;;;;27/10/2021;wsrubeus;0;1;1;1;;;;0;cfe04ce6-1925-421b-b621-8b46f48e24f5;;;19744;wsrubeus;26/10/2021;wsrubeus;01/11/2021;
S;RB.PS.FV.004;Consulta chamada de candidatos - Automação da Chamada;"SELECT DISTINCT
	SPSAREAOFERTADA.IDPS, 
	SPSOPCAOINSCRITO.CODCOLIGADA,
	SPSAREAOFERTADA.IDAREAINTERESSE

FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO (NOLOCK)
	ON (SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS)

INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON (SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON (SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS)	

WHERE 
	GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIRESULTADO AND SPSPROCESSOSELETIVO.DTFIMRESULTADO
AND SPSOPCAOINSCRITO.STATUS = 10
/*AND SPSAREAOFERTADA.IDPS = 96*/

ORDER BY SPSAREAOFERTADA.IDPS, SPSAREAOFERTADA.IDAREAINTERESSE
";945;;;;26/10/2021;wsrubeus;0;1;1;1;;;;0;876c5b30-4c8f-43b9-9ab0-817e00f53a45;;;10967;wsrubeus;26/10/2021;wsrubeus;03/11/2021;
S;RB.PS.FV.005;Consulta classificação de candidatos ENEM- Automação da Classificação;"SELECT DISTINCT
	SPSAREAOFERTADA.CODCOLIGADA,
	SPSAREAOFERTADA.IDPS, 
	SPSAREAOFERTADA.IDAREAINTERESSE,
	SPSPROCESSOSELETIVO.CODFILIAL
	
FROM SPSAREAOFERTADA (NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO (NOLOCK)
	ON (SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON (SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS)
	
INNER JOIN SPSOPCAOINSCRITO(NOLOCK)
	ON (SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE)	

WHERE 
	GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIRESULTADO AND SPSPROCESSOSELETIVO.DTFIMRESULTADO
AND UTILIZAENEM	= 'T'
AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%'
AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%MESTRADO%'

ORDER BY SPSAREAOFERTADA.IDPS, SPSAREAOFERTADA.IDAREAINTERESSE";1026;;;;27/10/2021;wsrubeus;0;1;1;1;;;;0;0db829cb-da79-400a-968a-8096208893d6;;;-1278;wsrubeus;26/10/2021;wsrubeus;01/11/2021;
S;RB.PS.FV.006;Consulta classificação de candidatos ENEM- Teologia;"SELECT DISTINCT
	SPSAREAOFERTADA.CODCOLIGADA,
	SPSAREAOFERTADA.IDPS, 
	SPSAREAOFERTADA.IDAREAINTERESSE,
	SPSPROCESSOSELETIVO.CODFILIAL
	
FROM SPSAREAOFERTADA (NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO (NOLOCK)
	ON (SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON (SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS)
	
INNER JOIN SPSOPCAOINSCRITO(NOLOCK)
	ON (SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE)	

WHERE SPSPROCESSOSELETIVO.IDPS = :IDPS
AND SPSPROCESSOSELETIVO.CODCOLIGADA = :CODCOLIGADA

ORDER BY SPSAREAOFERTADA.IDPS, SPSAREAOFERTADA.IDAREAINTERESSE";889;;;;06/10/2022;shift;0;1;1;1;;;;0;0db829cb-da79-400a-968a-8096208893d6;;;-6401;wsrubeus;01/11/2021;shift;06/10/2022;
S;RB.PS.FV.007;Consulta classificação de candidatos Diplomados/Transf. - Automação da Classificação;"SELECT DISTINCT
	SPSAREAOFERTADA.CODCOLIGADA,
	SPSAREAOFERTADA.IDPS, 
	SPSAREAOFERTADA.IDAREAINTERESSE,
	SPSPROCESSOSELETIVO.CODFILIAL,
	SPSOPCAOINSCRITO.CODUSUARIOPS,
	SPSOPCAOINSCRITO.NUMEROINSCRICAO,
	SPSAREAINTERESSE.NOME AS NOMEAREA,
	SPSUSUARIO.NOME AS NOMECANDIDAATO
	
FROM SPSAREAOFERTADA (NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO (NOLOCK)
	ON (SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS)

INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON (SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE)
	
INNER JOIN SPSOPCAOINSCRITO(NOLOCK)
	ON (SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	AND SPSOPCAOINSCRITO.STATUS = 0
	AND (SELECT 
			COUNT(SPSDOCUMENTOENTREGUE.CODDOCUMENTO) AS QTD
		FROM SPSDOCUMENTOEXIGIDO (NOLOCK) 						
		INNER JOIN SDOCUMENTO (NOLOCK) 
			ON SDOCUMENTO.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
			  
		INNER JOIN SPSDOCUMENTOENTREGUE (NOLOCK) 
			ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
			AND SPSDOCUMENTOENTREGUE.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
			AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
			AND SPSDOCUMENTOENTREGUE.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
			AND SPSDOCUMENTOENTREGUE.ENTREGUE = 'F'
		WHERE SPSDOCUMENTOEXIGIDO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSDOCUMENTOEXIGIDO.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE) = 0)

INNER JOIN SPSUSUARIO(NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS

WHERE 
	GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIRESULTADO AND SPSPROCESSOSELETIVO.DTFIMRESULTADO
AND (SPSPROCESSOSELETIVO.NOME LIKE '%Diplomados%' OR SPSPROCESSOSELETIVO.NOME LIKE '%Transferência%')

ORDER BY SPSAREAOFERTADA.IDPS, SPSAREAOFERTADA.IDAREAINTERESSE";2027;;;;03/11/2021;wsrubeus;0;1;1;1;;;;0;0db829cb-da79-400a-968a-8096208893d6;;;23232;wsrubeus;01/11/2021;wsrubeus;03/11/2021;
S;RB.PS.FV.008;Consulta lookup bolsas cupom de desconto;"/**
	- TEM QUE SER A DESCRIÇÃO (PARA O NOME DA BOLSA)
**/
SELECT DISTINCT CODBOLSA,BOLSA AS DESCRICAO,CODCOLIGADA, IDPERLET, CODPERLET, NIVELENSINO FROM (
SELECT 
	SBOLSA.CODBOLSA,
	SBOLSA.NOME AS 'Bolsa',	
	SBOLSAPLETIVO.CODCOLIGADA,
	SBOLSAPLETIVO.IDPERLET,
	SPLETIVO.CODPERLET,
	STIPOCURSO.NOME AS NIVELENSINO	
FROM SBOLSAPLETIVO(NOLOCK)
INNER JOIN SBOLSA(NOLOCK)
	ON SBOLSA.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA
	AND SBOLSA.CODBOLSA = SBOLSAPLETIVO.CODBOLSA
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SBOLSAPLETIVO.IDPERLET
LEFT JOIN STIPOCURSO(NOLOCK)
	ON STIPOCURSO.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SBOLSA.CODTIPOCURSO
) TABELA ";758;;;;04/02/2022;wsrubeus;0;1;1;1;;;;0;0db829cb-da79-400a-968a-8096208893d6;;;-18141;wsrubeus;04/02/2022;wsrubeus;04/02/2022;
S;RB.PS.FV.009;Consulta dados para aplicação da bolsa;"/*****
	FUNÇÃO: CONSULTA UTILIZADA PARA INSERIR BOLSA APÓS INCLUIR O CONTRATO
*****/
SELECT DISTINCT
	ZMDCPDESCONTO.ATIVO,
	ZMDBOLSACUPOM.CODBOLSA,
	ZMDBOLSACUPOM.CODCOLIGADA,
	SCONTRATO.CODCONTRATO,
	ZMDBOLSACUPOM.CODSERVICO,
	ZMDBOLSACUPOM.ORDEM,
	ZMDBOLSACUPOM.PARCINICIAL,
	CASE 
		WHEN ZMDBOLSACUPOM.PARCFINAL < (SELECT MAX(PARCELA)
										FROM SPARCPLANO(NOLOCK) 
										WHERE SPARCPLANO.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
										AND SPARCPLANO.CODPLANOPGTO = SPLANOPGTO.CODPLANOPGTO
										AND SPARCPLANO.IDPERLET = SPLANOPGTO.IDPERLET
										AND SPARCPLANO.CODSERVICO = ZMDBOLSACUPOM.CODSERVICO) THEN ZMDBOLSACUPOM.PARCFINAL
	ELSE (SELECT MAX(PARCELA)
		  FROM SPARCPLANO(NOLOCK) 
		  WHERE SPARCPLANO.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
		  AND SPARCPLANO.CODPLANOPGTO = SPLANOPGTO.CODPLANOPGTO
		  AND SPARCPLANO.IDPERLET = SPLANOPGTO.IDPERLET
		  AND SPARCPLANO.CODSERVICO = ZMDBOLSACUPOM.CODSERVICO) END AS PARCFINAL,
	ZMDBOLSACUPOM.VALOR,
	ZMDBOLSACUPOM.IDPERLET,
	SCONTRATO.RA,
	IIF(ZMDBOLSACUPOM.TIPODESCONTO = 'P','Percentual','Valor') AS TIPODESCONTO,
	GETDATE() AS DATA,
	'wsrubeus' AS USUARIO
	
FROM SMATRICPL(NOLOCK)
INNER JOIN SPSINSCAREAOFERTACOMPL (NOLOCK) 
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPSINSCAREAOFERTACOMPL.IDPS = SMATRICPL.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SMATRICPL.NUMEROINSCRICAO
	
INNER JOIN ZMDCPDESCONTO(NOLOCK)
	ON ZMDCPDESCONTO.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA
	AND ZMDCPDESCONTO.CODCUPOM = SPSINSCAREAOFERTACOMPL.VOUCHER
	/**VALIDAR QTD USADA**/
	AND ZMDCPDESCONTO.QTDCUPOM >= (SELECT COUNT(*) FROM SPSINSCAREAOFERTACOMPL(NOLOCK) WHERE VOUCHER = ZMDCPDESCONTO.CODCUPOM)
	
INNER JOIN ZMDBOLSACUPOM(NOLOCK)
	ON ZMDBOLSACUPOM.CODCOLIGADA = ZMDCPDESCONTO.CODCOLIGADA
	AND ZMDBOLSACUPOM.IDCUPOM = ZMDCPDESCONTO.ID
	AND ZMDBOLSACUPOM.IDPERLET = SMATRICPL.IDPERLET
/**
	REGRAS DE DESCONTO: O DESCONTO SERÁ APLICADO PARA UM CURSO OU PLANO DE PAGTO
	SE HOUVER PLANO E CURSO O CURSO SERÁ IGNORADO
**/
INNER JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.DTCANCELAMENTO IS NULL

INNER JOIN SPLANOPGTO(NOLOCK)
	ON SPLANOPGTO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPLANOPGTO.CODPLANOPGTO = SCONTRATO.CODPLANOPGTO
	AND SPLANOPGTO.IDPERLET = SCONTRATO.IDPERLET
	
INNER JOIN SPARCPLANO(NOLOCK)
	ON SPARCPLANO.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
	AND SPARCPLANO.CODPLANOPGTO = SPLANOPGTO.CODPLANOPGTO
	AND SPARCPLANO.IDPERLET = SPLANOPGTO.IDPERLET
	AND SPARCPLANO.PARCELA BETWEEN ZMDBOLSACUPOM.PARCINICIAL AND ZMDBOLSACUPOM.PARCFINAL	
	AND SPARCPLANO.CODSERVICO = ZMDBOLSACUPOM.CODSERVICO

OUTER APPLY (
	SELECT
		ZMDPLANOCUPOM.CODPLANO,
		ZMDPLANOCUPOM.CODCOLIGADA
	FROM ZMDPLANOCUPOM(NOLOCK)
	WHERE ZMDPLANOCUPOM.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
	AND ZMDPLANOCUPOM.IDPERLET = SPLANOPGTO.IDPERLET
	AND ZMDPLANOCUPOM.CODPLANO = SPLANOPGTO.CODPLANOPGTO
	AND ZMDPLANOCUPOM.IDCUPOM = ZMDCPDESCONTO.ID 
	) AS ZMDPLANOCUPOM

OUTER APPLY (
	SELECT 
		ZMDCURSOCUPOM.CODCURSO
	FROM SHABILITACAOFILIAL(NOLOCK)
	INNER JOIN ZMDCURSOCUPOM(NOLOCK)
		ON ZMDCURSOCUPOM.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND ZMDCURSOCUPOM.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	WHERE SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND ZMDPLANOCUPOM.CODPLANO IS NULL
	AND ZMDCURSOCUPOM.IDCUPOM = ZMDCPDESCONTO.ID
) AS SCURSO
	
WHERE SMATRICPL.RA = :RA
AND SMATRICPL.CODCOLIGADA = :CODCOLIGADA
AND SMATRICPL.IDPERLET = :IDPERLET
AND GETDATE() BETWEEN DATAINICIAL AND DATAFINAL
AND ATIVO = 1
ORDER BY ORDEM";3871;;;;18/05/2022;shift;0;1;1;1;;;;0;0db829cb-da79-400a-968a-8096208893d6;;;-28009;wsrubeus;07/02/2022;shift;18/05/2022;
S;RB.PS.FV.009.1;Consulta dados para aplicação da bolsa;"/*****
	FUNÇÃO: CONSULTA UTILIZADA PARA INSERIR BOLSA APÓS INCLUIR O CONTRATO
*****/
SELECT DISTINCT
	/*ZMDCPDESCONTO.ATIVO,
	ZMDBOLSACUPOM.CODBOLSA,
	ZMDBOLSACUPOM.CODCOLIGADA,
	SCONTRATO.CODCONTRATO,
	ZMDBOLSACUPOM.CODSERVICO,
	ZMDBOLSACUPOM.ORDEM,
	ZMDBOLSACUPOM.PARCINICIAL,
	CASE 
		WHEN ZMDBOLSACUPOM.PARCFINAL < (SELECT MAX(PARCELA)
										FROM SPARCPLANO(NOLOCK) 
										WHERE SPARCPLANO.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
										AND SPARCPLANO.CODPLANOPGTO = SPLANOPGTO.CODPLANOPGTO
										AND SPARCPLANO.IDPERLET = SPLANOPGTO.IDPERLET
										AND SPARCPLANO.CODSERVICO = ZMDBOLSACUPOM.CODSERVICO) THEN ZMDBOLSACUPOM.PARCFINAL
	ELSE (SELECT MAX(PARCELA)
		  FROM SPARCPLANO(NOLOCK) 
		  WHERE SPARCPLANO.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
		  AND SPARCPLANO.CODPLANOPGTO = SPLANOPGTO.CODPLANOPGTO
		  AND SPARCPLANO.IDPERLET = SPLANOPGTO.IDPERLET
		  AND SPARCPLANO.CODSERVICO = ZMDBOLSACUPOM.CODSERVICO) END AS PARCFINAL,
	ZMDBOLSACUPOM.VALOR,
	ZMDBOLSACUPOM.IDPERLET,
	SCONTRATO.RA,
	IIF(ZMDBOLSACUPOM.TIPODESCONTO = 'P','Percentual','Valor') AS TIPODESCONTO,
	GETDATE() AS DATA,*/
	'wsrubeus' AS USUARIO
	
FROM SMATRICPL(NOLOCK)
INNER JOIN SPSINSCAREAOFERTACOMPL (NOLOCK) 
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPSINSCAREAOFERTACOMPL.IDPS = SMATRICPL.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SMATRICPL.NUMEROINSCRICAO
	
INNER JOIN ZMDCPDESCONTO(NOLOCK)
	ON ZMDCPDESCONTO.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA
	AND ZMDCPDESCONTO.CODCUPOM = SPSINSCAREAOFERTACOMPL.VOUCHER
	/**VALIDAR QTD USADA**/
	/*AND ZMDCPDESCONTO.QTDCUPOM >= (SELECT COUNT(*) FROM SPSINSCAREAOFERTACOMPL(NOLOCK) WHERE VOUCHER = ZMDCPDESCONTO.CODCUPOM)*/
	
LEFT JOIN ZMDBOLSACUPOM(NOLOCK)
	ON ZMDBOLSACUPOM.CODCOLIGADA = ZMDCPDESCONTO.CODCOLIGADA
	AND ZMDBOLSACUPOM.IDCUPOM = ZMDCPDESCONTO.ID
	AND ZMDBOLSACUPOM.IDPERLET = SMATRICPL.IDPERLET
/**
	REGRAS DE DESCONTO: O DESCONTO SERÁ APLICADO PARA UM CURSO OU PLANO DE PAGTO
	SE HOUVER PLANO E CURSO O CURSO SERÁ IGNORADO
**/
LEFT JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.DTCANCELAMENTO IS NULL

LEFT JOIN SPLANOPGTO(NOLOCK)
	ON SPLANOPGTO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPLANOPGTO.CODPLANOPGTO = SCONTRATO.CODPLANOPGTO
	AND SPLANOPGTO.IDPERLET = SCONTRATO.IDPERLET
	
LEFT JOIN SPARCPLANO(NOLOCK)
	ON SPARCPLANO.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
	AND SPARCPLANO.CODPLANOPGTO = SPLANOPGTO.CODPLANOPGTO
	AND SPARCPLANO.IDPERLET = SPLANOPGTO.IDPERLET
	AND SPARCPLANO.PARCELA BETWEEN ZMDBOLSACUPOM.PARCINICIAL AND ZMDBOLSACUPOM.PARCFINAL	
	AND SPARCPLANO.CODSERVICO = ZMDBOLSACUPOM.CODSERVICO

OUTER APPLY (
	SELECT
		ZMDPLANOCUPOM.CODPLANO,
		ZMDPLANOCUPOM.CODCOLIGADA
	FROM ZMDPLANOCUPOM(NOLOCK)
	WHERE ZMDPLANOCUPOM.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
	AND ZMDPLANOCUPOM.IDPERLET = SPLANOPGTO.IDPERLET
	AND ZMDPLANOCUPOM.CODPLANO = SPLANOPGTO.CODPLANOPGTO
	AND ZMDPLANOCUPOM.IDCUPOM = ZMDCPDESCONTO.ID 
	) AS ZMDPLANOCUPOM

OUTER APPLY (
	SELECT 
		ZMDCURSOCUPOM.CODCURSO
	FROM SHABILITACAOFILIAL(NOLOCK)
	INNER JOIN ZMDCURSOCUPOM(NOLOCK)
		ON ZMDCURSOCUPOM.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND ZMDCURSOCUPOM.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	WHERE SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND ZMDPLANOCUPOM.CODPLANO IS NULL
	AND ZMDCURSOCUPOM.IDCUPOM = ZMDCPDESCONTO.ID
) AS SCURSO
	
WHERE SMATRICPL.RA = '037172'
AND SMATRICPL.CODCOLIGADA = 1
AND SMATRICPL.IDPERLET = 1007
/*AND GETDATE() BETWEEN DATAINICIAL AND DATAFINAL
AND ATIVO = 1*/";3852;;;;09/06/2022;shift;0;1;1;1;;;;0;0db829cb-da79-400a-968a-8096208893d6;;;28077;shift;09/06/2022;shift;09/06/2022;
S;RB.PS.IM;Consultas para captação Inscrições e Matrículas;"SELECT 	TOP 1		
		MATRICULADO.CODCURSO	    
	FROM SALUNO(NOLOCK)
	INNER JOIN PPESSOA (NOLOCK)
		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	OUTER APPLY (
			SELECT TOP 1
				MAX(SHABILITACAOALUNO.RECCREATEDON) AS DTMATRICULA,
				SHABILITACAOFILIAL.CODCURSO
			FROM SHABILITACAOALUNO(NOLOCK)
			INNER JOIN SHABILITACAOFILIAL(NOLOCK)
				ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
				AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
			INNER JOIN SCURSO(NOLOCK)
				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
				AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
				AND PATINDEX(SCURSO.NOME, '%PENSIONATO%') = 0
			WHERE SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA			
			AND SHABILITACAOALUNO.RA = '010385'
			GROUP BY SHABILITACAOFILIAL.CODCURSO
	)MATRICULADO		
	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = '05695032300'/*COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)*/
	
	
/***
RA
040729
181049
010385
183589
189825
007341
020020
060409
161997
017540
013293
032891
044724
011395
180172
044463
182124
043659
048355
148594
021156
***/	
/*SELECT DISTINCT RA,CODFILIAL FROM SMATRICPL WHERE RA IN ('040729','181049','010385','183589','189825','007341','020020','060409','161997','017540','013293','032891',
'044724','011395','180172','044463','182124','043659','048355','148594','021156')*/
";1417;;;;06/10/2022;shift;0;1;1;1;;;;0;65beec11-e53b-4827-a180-d37b0cbf22f0;0;;26708;wsrubeus;27/09/2021;shift;06/10/2022;0
S;RB.PS.IM.001;Buscar processo;"/****
	Função: Atualizar dados das Inscrições e Matrículas, por exemplo o nome do PS, caso eles alterem no TOTVS e queiram sincronizar no painel da aplicação.
****/
SELECT
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.CODFILIAL) AS CODUNIDADE,
	SPSPROCESSOSELETIVO.NOME,
	FILIAL.NOME AS NOMEUNIDADE,
	CONVERT(VARCHAR,SPSPROCESSOSELETIVO.CODCOLIGADA)+'-'+CONVERT(VARCHAR,SPSPROCESSOSELETIVO.IDPS) AS CODEXTERNO
FROM SPSPROCESSOSELETIVO(NOLOCK)
OUTER APPLY(SELECT NOME, CODFILIAL FROM GFILIAL(NOLOCK) WHERE CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA AND CODFILIAL = SPSPROCESSOSELETIVO.CODFILIAL) AS FILIAL
WHERE 
	SPSPROCESSOSELETIVO.STATUS = 'T'
AND CONVERT(VARCHAR,SPSPROCESSOSELETIVO.CODCOLIGADA)+'-'+CONVERT(VARCHAR,SPSPROCESSOSELETIVO.IDPS) = :CODEXTERNO";791;;;;13/09/2021;wsrubeus;0;1;1;1;;;;0;104a851f-4244-4d52-bf71-9987143401c5;;;13872;wsrubeus;13/09/2021;wsrubeus;13/09/2021;
S;RB.PS.IM.002;Listar processos no portal;"/****
	Função: Lista os PS dentro do Inscrições e Matrículas para configuração.
****/
SELECT
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.CODFILIAL) AS CODUNIDADE,
	SPSPROCESSOSELETIVO.NOME,
	FILIAL.NOME AS NOMEUNIDADE,
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS) AS CODEXTERNO
FROM SPSPROCESSOSELETIVO(NOLOCK)
OUTER APPLY(SELECT NOME, CODFILIAL FROM GFILIAL(NOLOCK) WHERE CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA AND CODFILIAL = SPSPROCESSOSELETIVO.CODFILIAL) AS FILIAL
WHERE
	SPSPROCESSOSELETIVO.STATUS = 'T'
/*AND GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO*/";672;;;;25/02/2022;wsrubeus;0;1;1;1;;;;0;85a6ed5c-2814-4063-9ce7-9b2a8e146a99;;;-25591;wsrubeus;13/09/2021;wsrubeus;25/02/2022;
S;RB.PS.IM.003;Listar processos disponíveis por candidato;"/****
	Função: Lista os PS abertos (dentro do período de inscrição) para o candidato iniciar a inscrição.
****/
DECLARE @IDPROCESSO INT, @MOD VARCHAR(15), @INGRESSO VARCHAR(30);

SET @IDPROCESSO = :IDPS;
SET @MOD = :MODALIDADE;
SET @INGRESSO = :FORMAINGRESSO;

SELECT
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.CODFILIAL) AS CODUNIDADE,
	SPSPROCESSOSELETIVO.NOME,
	FILIAL.NOME AS NOMEUNIDADE,
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS) AS CODEXTERNO,
	MODALIDADE.CODINTERNO
FROM SPSPROCESSOSELETIVO(NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS	
CROSS APPLY(
	SELECT 
		CODINTERNO,
		DESCRICAO,
		CODTABELA 
	FROM GCONSIST (NOLOCK)
	WHERE CODTABELA = 'MODALIDADE'	
	AND CODINTERNO = SPSPROCSELCOMPL.MODALIDADEPS
	) AS MODALIDADE
OUTER APPLY(SELECT NOME, CODFILIAL FROM GFILIAL(NOLOCK) WHERE CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA AND CODFILIAL = SPSPROCESSOSELETIVO.CODFILIAL) AS FILIAL
WHERE
	SPSPROCESSOSELETIVO.STATUS = 'T'
AND GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO
AND (SPSPROCESSOSELETIVO.IDPS = CASE WHEN @IDPROCESSO = '' THEN SPSPROCESSOSELETIVO.IDPS ELSE @IDPROCESSO END
AND SPSPROCESSOSELETIVO.NOME LIKE '%'+ (CASE WHEN @INGRESSO = '' THEN SPSPROCESSOSELETIVO.NOME ELSE @INGRESSO END) +'%'
AND MODALIDADE.CODINTERNO = (CASE WHEN @MOD = 'EAD' THEN 1 WHEN @MOD = 'PRESENCIAL' THEN 2 ELSE SPSPROCSELCOMPL.MODALIDADEPS END)
)
";1594;;;;26/01/2022;wsrubeus;0;1;1;1;;;;0;2d34c4f7-e056-4cdd-a987-7dd70243b27e;;;-2976;wsrubeus;13/09/2021;wsrubeus;26/01/2022;
S;RB.PS.IM.003.1;Listar processos disponíveis por candidato - BK 24/11;"/****
	Função: Lista os PS abertos (dentro do período de inscrição) para o candidato iniciar a inscrição.
****/
SELECT
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.CODFILIAL) AS CODUNIDADE,
	SPSPROCESSOSELETIVO.NOME,
	FILIAL.NOME AS NOMEUNIDADE,
	CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SPSPROCESSOSELETIVO.IDPS) AS CODEXTERNO
FROM SPSPROCESSOSELETIVO(NOLOCK)
OUTER APPLY(SELECT NOME, CODFILIAL FROM GFILIAL(NOLOCK) WHERE CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA AND CODFILIAL = SPSPROCESSOSELETIVO.CODFILIAL) AS FILIAL
WHERE
	SPSPROCESSOSELETIVO.STATUS = 'T'
AND GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO
";696;;;;24/11/2021;wsrubeus;0;1;1;1;;;;0;2d34c4f7-e056-4cdd-a987-7dd70243b27e;;;2548;wsrubeus;22/11/2021;wsrubeus;24/11/2021;
S;RB.PS.IM.004;Login portal do candidato - Graduação;"/****
	Função: Retornar dados de login
****/
SELECT 
	CASE WHEN SPSUSUARIO.CODUSUARIOPS = 6156 THEN 6157 ELSE SPSUSUARIO.CODUSUARIOPS END AS 'CODUSUARIOPS',
	SPSUSUARIO.NOME AS NOME,
	SPSUSUARIO.EMAIL AS EMAIL,
	CASE 
	    WHEN LEN(SPSUSUARIO.TELEFONE1) = 11 THEN SPSUSUARIO.TELEFONE1
	    WHEN LEN(SPSUSUARIO.TELEFONE2) = 11 THEN SPSUSUARIO.TELEFONE2
	    ELSE ''
	END AS TELEFONE,
	SPSUSUARIO.DTNASCIMENTO AS DTNASCIMENTO,
	SPSUSUARIO.CPF AS CPF,
	ISNULL(INSCRICOES.CODINSCRICAOPS,0) AS CODINSCRICAOPS,
	ISNULL(INSCRICOES.CODEXTERNO,0) AS CODEXTERNO,
	INSCRICOES.NOMECURSO AS NOMECURSO 
FROM SPSUSUARIO (NOLOCK)

OUTER APPLY (
    SELECT 
        CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO) AS CODINSCRICAOPS,
        CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS) AS CODEXTERNO,
         SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO AS NUMEROINSCRICAO,
         CONCAT(SCURSO.COMPLEMENTO,' - ', STURNO.NOME) AS NOMECURSO,
         SPSINSCRICAOAREAOFERTADA.DATAINSCRICAO,
         SPSINSCRICAOAREAOFERTADA.IDPS,
         SPSPROCSELCOMPL.PSRUBEUS
    FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)
     INNER JOIN SPSPROCESSOSELETIVO (NOLOCK)
       ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
       AND SPSPROCESSOSELETIVO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
       AND SPSPROCESSOSELETIVO.STATUS = 'T'
       AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%POS%'
     INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
		ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
		AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS	
     
     INNER JOIN SPSFORMAINSCRICAOPS(NOLOCK)
        ON SPSFORMAINSCRICAOPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
       AND SPSFORMAINSCRICAOPS.IDPS = SPSPROCESSOSELETIVO.IDPS
     
     /*JOIN PRO NOME DO CURSO*/
     
    INNER JOIN SPSOPCAOINSCRITO(NOLOCK)
        ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
        AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
        AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
        
    INNER JOIN SPSAREAOFERTADA(NOLOCK)
        ON SPSAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
        AND SPSAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
        AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
        
    INNER JOIN SPSAREAINTERESSE (NOLOCK)
        ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
        
     INNER JOIN SHABILITACAOFILIAL (NOLOCK)
        ON SHABILITACAOFILIAL.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL
       AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
       
	INNER JOIN STURNO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
		
     INNER JOIN SHABILITACAO (NOLOCK)
          ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
          AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
          AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
          
     INNER JOIN SCURSO (NOLOCK)
        ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
       AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
     WHERE 
         SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
        AND SPSINSCRICAOAREAOFERTADA.STATUS != 8
) AS INSCRICOES
WHERE (COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE) = REPLACE(REPLACE(:LOGIN, '-', ''), '.', '') OR SPSUSUARIO.EMAIL = :LOGIN)
AND CONVERT(VARCHAR(10), SPSUSUARIO.DTNASCIMENTO, 120)  = :DATANASCIMENTO
AND INSCRICOES.PSRUBEUS = 'T'
/*AND INSCRICOES.IDPS IN (60,61,62,63,64,69,70,71,72,76)*/
ORDER BY INSCRICOES.DATAINSCRICAO DESC;";3894;;;;02/08/2022;wsrubeus;0;1;1;1;;;;0;67210c9a-24a7-4e8c-bf00-7a828ed36fe9;;;-20757;wsrubeus;13/09/2021;wsrubeus;02/08/2022;
S;RB.PS.IM.004.1;Login portal do candidato- Pós graduação;"/****
	Função: Retornar dados de login
****/
SELECT 
	CASE WHEN SPSUSUARIO.CODUSUARIOPS = 6156 THEN 6157 ELSE SPSUSUARIO.CODUSUARIOPS END AS 'CODUSUARIOPS',
	SPSUSUARIO.NOME AS NOME,
	SPSUSUARIO.EMAIL AS EMAIL,
	CASE 
	    WHEN LEN(SPSUSUARIO.TELEFONE1) = 11 THEN SPSUSUARIO.TELEFONE1
	    WHEN LEN(SPSUSUARIO.TELEFONE2) = 11 THEN SPSUSUARIO.TELEFONE2
	    ELSE ''
	END AS TELEFONE,
	SPSUSUARIO.DTNASCIMENTO AS DTNASCIMENTO,
	SPSUSUARIO.CPF AS CPF,
	ISNULL(INSCRICOES.CODINSCRICAOPS,0) AS CODINSCRICAOPS,
	ISNULL(INSCRICOES.CODEXTERNO,0) AS CODEXTERNO,
	INSCRICOES.NOMECURSO AS NOMECURSO 
FROM SPSUSUARIO (NOLOCK)

OUTER APPLY (
    SELECT 
        CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO) AS CODINSCRICAOPS,
        CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS) AS CODEXTERNO,
         SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO AS NUMEROINSCRICAO,
         CONCAT(SCURSO.COMPLEMENTO,' - ', STURNO.NOME) AS NOMECURSO,
         SPSINSCRICAOAREAOFERTADA.DATAINSCRICAO,
         SPSINSCRICAOAREAOFERTADA.IDPS,
         SPSPROCSELCOMPL.PSRUBEUS
    FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)
     INNER JOIN SPSPROCESSOSELETIVO (NOLOCK)
       ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
       AND SPSPROCESSOSELETIVO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
       AND SPSPROCESSOSELETIVO.STATUS = 'T'
       AND SPSPROCESSOSELETIVO.NOME LIKE '%Pós%'
       
     INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
		ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
		AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS	
     
     INNER JOIN SPSFORMAINSCRICAOPS(NOLOCK)
        ON SPSFORMAINSCRICAOPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
       AND SPSFORMAINSCRICAOPS.IDPS = SPSPROCESSOSELETIVO.IDPS
     
     /*JOIN PRO NOME DO CURSO*/
     
    INNER JOIN SPSOPCAOINSCRITO(NOLOCK)
        ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
        AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
        AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
        
    INNER JOIN SPSAREAOFERTADA(NOLOCK)
        ON SPSAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
        AND SPSAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
        AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
        
    INNER JOIN SPSAREAINTERESSE (NOLOCK)
        ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
        
     INNER JOIN SHABILITACAOFILIAL (NOLOCK)
        ON SHABILITACAOFILIAL.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL
       AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
       
	INNER JOIN STURNO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
		
     INNER JOIN SHABILITACAO (NOLOCK)
          ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
          AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
          AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
          
     INNER JOIN SCURSO (NOLOCK)
        ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
       AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
     WHERE 
         SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
        AND SPSINSCRICAOAREAOFERTADA.STATUS != 8
) AS INSCRICOES
WHERE (COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE) = REPLACE(REPLACE(:LOGIN, '-', ''), '.', '') OR SPSUSUARIO.EMAIL = :LOGIN)
AND CONVERT(VARCHAR(10), SPSUSUARIO.DTNASCIMENTO, 120)  = :DATANASCIMENTO
AND INSCRICOES.PSRUBEUS = 'T'
/*AND INSCRICOES.IDPS IN (60,61,62,63,64,69,70,71,72,76)*/
ORDER BY INSCRICOES.DATAINSCRICAO DESC;";3899;;;;10/08/2022;wsrubeus;0;1;1;1;;;;0;67210c9a-24a7-4e8c-bf00-7a828ed36fe9;;;17713;wsrubeus;09/11/2021;wsrubeus;10/08/2022;
S;RB.PS.IM.005;Dados do portal do candidato;"/****
	Função: Toda vez que o candidato logar ele executa logo em seguida essa consulta para buscar dados no TOTVS e sincronizar no Inscrições e Matrículas, ou seja, 
	todos dados que precisam ser sincronizados entre as bases precisam estar nessa consulta.
****/
WITH DOCUMENTOS(NOMEARQUIVO,CODDOCUMENTO,OBRIGATORIO,ENTREGUE,MOTIVO) AS (
SELECT /*DISTINCT	*/
	SPSARQUIVOSCANDIDATO.NOMEARQUIVO AS NOMEARQUIVO,
	SPSDOCUMENTOEXIGIDO.CODDOCUMENTO AS CODDOCUMENTO,
	SPSDOCUMENTOEXIGIDO.OBRIGATORIO AS OBRIGATORIO,
	SPSDOCUMENTOENTREGUE.ENTREGUE AS ENTREGUE,
	SPSDOCUMENTOENTREGUE.MOTIVO AS MOTIVO
FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)

INNER JOIN SPSUSUARIO (NOLOCK) ON
  	SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
  	
INNER JOIN SPSUSUARIO AS OUTROUSUARIO(NOLOCK) ON
  	ISNULL(SPSUSUARIO.CPF, SPSUSUARIO.CODUSUARIOPS) = ISNULL(OUTROUSUARIO.CPF, OUTROUSUARIO.CODUSUARIOPS)
  	
INNER JOIN SPSOPCAOINSCRITO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

INNER JOIN  SPSDOCUMENTOEXIGIDO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE
		
INNER JOIN  SDOCUMENTO (NOLOCK) 
	ON SDOCUMENTO.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
	  
LEFT JOIN SPSDOCUMENTOENTREGUE (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSDOCUMENTOENTREGUE.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
  
LEFT JOIN SPSARQUIVOSCANDIDATO (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSARQUIVOSCANDIDATO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO
	AND SPSARQUIVOSCANDIDATO.NOMEARQUIVO LIKE '%' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.IDPS) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO)  + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODDOCUMENTO) + '.%'

WHERE
		CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) = :CODINSCRICAO
)

SELECT DISTINCT

	/*DEFAULT*/
	CURSO.NOME AS 'CURSO',
	/*IIF(SPSPROCESSOSELETIVO.NOME LIKE '%EAD%','EAD','Presencial') AS 'MODALIDADE',*/
	CASE WHEN 	CURSO.NOME LIKE '%EAD%'
		THEN 'EAD'
		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%'
			 THEN 'EAD'
			 ELSE 'Presencial'
			 END
	END AS 'MODALIDADE',
		
	SCAMPUS.DESCRICAO AS 'CAMPUS',
	SPSPROCESSOSELETIVO.NOME AS 'FORMADEINGRESSO',
	/*DEFAULT*/
	
	/*DADOS CONTATO*/
	SPSUSUARIO.CODUSUARIOPS AS 'SPSUSUARIO.CODUSUARIOPS',
	SPSUSUARIO.NPASSAPORTE AS 'SPSUSUARIO.NPASSAPORTE',
	SPSUSUARIO.NACIONALIDADE AS 'SPSUSUARIO.NACIONALIDADE',
	NACIONALIDADE.DESCRICAO AS 'SPSUSUARIO.NOMENACIONALIDADE',
	SPSUSUARIO.NOME AS 'SPSUSUARIO.NOME',
	SPSUSUARIO.EMAIL AS 'SPSUSUARIO.EMAIL',
	SPSUSUARIO.TELEFONE2 AS 'SPSUSUARIO.TELEFONE2',
	ISNULL(SPSUSUARIO.CPF,0) AS 'SPSUSUARIO.CPF',
	REPLACE(CONVERT(VARCHAR,SPSUSUARIO.DTNASCIMENTO,103),'/','') AS 'SPSUSUARIO.DTNASCIMENTOSENHA',
	SPSUSUARIO.DTNASCIMENTO AS 'SPSUSUARIO.DTNASCIMENTO',
	SPSUSUARIO.SEXO AS 'SPSUSUARIO.SEXO',
	SPSUSUARIO.NOMESOCIAL AS 'SPSUSUARIO.NOMESOCIAL',
	IIF(ISNULL(SPSUSUARIO.NOMESOCIAL,'')='','F','T') AS 'SPSUSUARIO.POSSUINOMESOCIAL',
	CASE 
        WHEN MONTH(GETDATE()) > MONTH(SPSUSUARIO.DTNASCIMENTO) OR (MONTH(GETDATE()) = MONTH(SPSUSUARIO.DTNASCIMENTO) AND DAY(GETDATE()) >= DAY(SPSUSUARIO.DTNASCIMENTO)) THEN DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) 
    ELSE DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) -1 END AS 'SPSUSUARIO.IDADE',
    
    CASE 
		WHEN (SPSOPCAOINSCRITO.STATUS = 5 OR SPSOPCAOINSCRITO.STATUS = 7) AND SPSUSUARIO.IDADE >= 18 THEN 'T'
		WHEN (SPSOPCAOINSCRITO.STATUS = 5 OR SPSOPCAOINSCRITO.STATUS = 7) AND SPSUSUARIO.IDADE < 18 AND ISNULL(SPSUSUARIOTIPORELAC.CODUSUARIOTIPORELAC,0) > 0 THEN 'T'
		ELSE 'F'
	END AS 'PREMATRICULA.DISPONIVEL',
	ISNULL(SPSUSUARIOTIPORELAC.CODUSUARIOTIPORELAC,0) AS 'FINANCEIRO.CODUSUARIOPS',
	/*DADOS CONTATO*/
	SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AS 'SPSINSCRICAOAREAOFERTADA.CODCOLIGADA',
	SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO AS 'SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO',
	IIF(SPSOPCAOINSCRITO.STATUS IN (5,11),5,SPSOPCAOINSCRITO.STATUS) AS 'SPSOPCAOINSCRITO.STATUS',	
	/*	SPSOPCAOINSCRITO.STATUS AS 'SPSOPCAOINSCRITO.STATUS',*/
	SPSINSCRICAOAREAOFERTADA.STATUS	AS 'SPSINSCRICAOAREAOFERTADA.STATUS',
	CURSO.NOMEAREAINTERESSE AS 'SPSAREAINTERESSE.NOME',
	SPSOPCAOINSCRITO.IDAREAINTERESSE AS 'SPSAREAINTERESSE.IDAREAINTERESSE',
	SPSOPCAOINSCRITO.IDAREAINTERESSE AS 'OPORTUNIDADE.IDAREAINTERESSE',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',CURSO.CODCURSO) AS 'SCURSO.CODCURSO',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',CURSO.CODCURSO) AS 'OPORTUNIDADE.CODCURSO',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'SPSOPCAOINSCRITO.CODOFERTA',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'OPORTUNIDADE.CODOFERTA',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SCAMPUS.CODCAMPUS) AS 'SCAMPUS.CODCAMPUS',
	SPSINSCAREAOFERTACOMPL.CODPOLO AS 'SPSINSCAREAOFERTACOMPL.CODPOLO',
	SPSPROCESSOSELETIVO.IDPS AS 'SPSPROCESSOSELETIVO.IDPS',
	ISNULL(CURSO.CODETD,'PRESENCIAL') AS 'COD.SCAMPUS.UF',
	CURSO.NOME AS 'SCURSO.DESCRICAO',
	CURSO.IDHABILITACAOFILIAL AS 'SHABILITACAOFILIAL.IDHABILITACAOFILIAL',
	SPLETIVO.CODPERLET AS 'SPLETIVO.CODPERLET',
	CURSO.IDPERLET AS 'SPLETIVO.IDPERLET',
	CURSO.CODFILIAL AS 'GFILIAL.CODFILIAL',
	CASE
		WHEN FLAN.IDLAN IS NULL THEN 'Sem pagamento'
		WHEN FLAN.STATUSLAN = 0  AND FLAN.VALORORIGINAL - ISNULL(FLAN.VALORDESCONTO,0) > 0 THEN 'Pendente'
		WHEN FLAN.STATUSLAN IN (1,3)  OR SPSINSCRICAOAREAOFERTADA.STATUS = 1 THEN 'Confirmado'		
	END AS 'SPSINSCRICAOAREAOFERTADA.STATUSPAGAMENTO',
	DOCUMENTOS.POSSUIDOCUMENTO AS 'SPSDOCUMENTOEXIGIDO.POSSUIDOCUMENTO',
	SPSOPCAOINSCRITO.CLASSIFICACAO AS 'SPSOPCAOINSCRITO.CLASSIFICACAO',
	ISNULL(SPSOPCAOINSCRITO.PONTUACAO,0) AS 'SPSOPCAOINSCRITO.PONTUACAO',
	ISNULL(SPSINSCAREAOFERTACOMPL.VALINTER,'F') AS 'SPSINSCAREAOFERTACOMPL.VALINTER',
	ISNULL(SPSINSCAREAOFERTACOMPL.EXCEDENTE,'F') AS 'SPSINSCAREAOFERTACOMPL.EXCEDENTE',
	SPSINSCAREAOFERTACOMPL.PENSIONATO AS 'SPSINSCAREAOFERTACOMPL.PENSIONATO',
	ISNULL(SPSPARAMETROSAREAOFERTADA.CODTURMA,ISNULL(TURMA.CODTURMA,'')) AS 'STURMA.CODTURMA',
	CURSO.CODTIPOCURSO AS 'STIPOCURSOFILIAL.CODTIPOCURSO',
	CASE 
		WHEN SPSUSUARIO.NACIONALIDADE  = 10 OR SPSUSUARIO.NACIONALIDADE  = 20 THEN 'T'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 OR SPSUSUARIO.NACIONALIDADE != 20 THEN 'F'
	END AS 'PREMATRICULA.ESTRANGEIRO',
	CASE 
		WHEN SPSUSUARIO.NACIONALIDADE = 10 THEN 'T'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 AND SPSINSCAREAOFERTACOMPL.VALINTER = 'F' THEN 'F'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 AND SPSINSCAREAOFERTACOMPL.VALINTER = 'T' THEN 'T'
	END AS 'SPSINSCAREAOFERTACOMPL.INSCRICAOVALIDADA',	
	
	/*PROVA*/
	
	/** FEEDBACK PROVA TEOLOGIA **/
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS = 3 THEN 'Reprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (5,7) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 4 THEN 'Aprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (5,7) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 3 THEN 'Aprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (0,16) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 3 THEN 'Aguardando entrevista'		
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS = 16 AND SPSOPCAOINSCRITO.ULTIMAETAPA >= 2 THEN 'Aprovado 1º Fase'		
	END AS 'BPROVA.STATUS',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS1,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS1',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS2,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS2',
	PROVA.NOME AS 'BPROVA.NOME',
	PROVA.CODPROVA AS 'BPROVA.CODPROVA',
	ISNULL(PROVA.IDEXECPROVA, '')  AS 'BEXECPROVA.IDEXECPROVA',
	/*PROVA.IDEXECPROVA1 AS 'BEXECPROVA.IDEXECPROVA1',
	PROVA.IDEXECPROVA2 AS 'BEXECPROVA.IDEXECPROVA2',*/
	PROVA.IDPROVA AS 'BEXECPROVA.IDPROVA',
	PROVA.IDPROVAINSCRITO AS 'BPROVA.IDPROVAINSCRITO',
	PROVA.HORAINICIOETAPA,
	PROVA.HORAFIMETAPA,
	
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' AND PROVA.IDEXECPROVA IS NOT NULL THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1, PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL',
	/*CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1,PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL1',
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1, PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL2',*/
	CONVERT(VARCHAR(10),PROVA.DATAAGENDAMENTO,120) AS 'SPSAGENDARECURSOPS.DATAAGENDAMENTO',
	PROVA.HORAINICIOAGENDA AS 'SPSAGENDARECURSOPS.HORAINICIO',
	PROVA.HORAFIMAGENDA AS 'SPSAGENDARECURSOPS.HORAFIM',
	IIF(ISNULL(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,103),'') = '','',CONCAT(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,103),' de ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAINICIOAGENDA,0))),' às ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAFIMAGENDA,0))))) AS 'SPSAGENDARECURSOPS.DATAHORAAGENDAMENTO',
	IIF(ISNULL(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,23),'') = '','',CONCAT(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAINICIOAGENDA,0))), ':00')) AS 'SPSAGENDARECURSOPS.AGENDAMENTOCRM',
	
	/*FIM PROVA*/
	
	/*IIF(GETDATE() < ISNULL(SPSPROCSELCOMPL.DTLIMITEALTINSCRICAO, GETDATE() +1),'T','F') AS 'SPSPROCSELCOMPL.DTLIMITEALTINSCRICAO',*/
	
	/*DADOS MATRICULA*/
	MATRICULA.CODCONTRATO AS 'SCONTRATO.CODCONTRATO',
	CASE WHEN MATRICULA.RA IS NULL THEN ' ' ELSE MATRICULA.RA END AS 'SALUNO.RA',
	MATRICULA.CODCFO AS 'FCFO.CODCFO',
	IIF(ISNULL(MATRICULA.CONTRATOASSINADO,'N') = 'N', 0, 1) AS 'SCONTRATO.ASSINADO',
	MATRICULA.CONTRATODTASSINATURA AS 'SCONTRATO.DTASSINATURA',
	MATRICULA.MATRICULADO AS 'SMATRICPL.MATRICULADO',
	/** DOCUMENTOS DE INSCRICAO **/
	CASE 
		/** PENDENTE ENVIO **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NULL AND ISNULL(ENTREGUE,'F') = 'F') > 0 THEN 'Pendente envio'
		/** PENDENTE ENVIO (RECUSADO) **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ISNULL(ENTREGUE,'F') = 'F' AND MOTIVO IS NOT NULL) > 0 THEN 'Pendente envio (Recusado)'
		/** EM ANALISE **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ISNULL(ENTREGUE,'F') = 'F' AND ISNULL(MOTIVO,'') = '') > 0 THEN 'Em analise'
		/** ENTREGUES **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ENTREGUE = 'T' AND ISNULL(MOTIVO,'') = '') > 0 THEN 'Documentos entregues'
		/** SE NÃO TIVER DOCUMENTOS **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS) <= 0 THEN 'Documentos entregues'
	END AS 'DOCUMENTOS.STATUS',
	

	/** DOCUMENTOS DE MATRICULA **/
	CASE        
		/**Se todos ja foram aceitos, retornar que os docs foram aceitos**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO	
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 3
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Documentos entregues'
       
		/**Se tiver 1 documento faltando envio, precisa retornar que existe doc pendente envio**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 0
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Pendente envio'
       
       /**Se tiver algum doc recusado, precisa retornar q tem doc pendente**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 2
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Pendente envio (Recusado)'
       
       /**Se todos ja tiverem sido enviados mais ainda nao foram aceitos, precisa retornar que esta em analise**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1		
		WHERE SDOCALUNO.STATUS = 1
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Em analise' 
       	
       	/**Se não houver documentos**/
		WHEN ISNULL((SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO	
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1
		LEFT JOIN SARQUIVOS (NOLOCK) ON
			SARQUIVOS.CHAVERM =  CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)	  
		INNER JOIN SDOCUMENTO AS SDOCUMENTOMATRICULA (NOLOCK)
			ON SDOCUMENTOMATRICULA.CODDOCUMENTO = SDOCALUNO.CODDOCUMENTO 			
		WHERE SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA    
           AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL
       GROUP BY SDOCALUNO.RA),0) = 0 THEN 'Não possui documentos'
       END AS 'SMATRICPL.DOCUMENTOMATRICULA',
       
       CASE WHEN LANMATRICULA.STATUSLAN IN (1,3)
       		THEN 1
       		ELSE 0
       END AS 'STATUSPAGAMENTO.MATRICULA',
       MATRICULA.LANCMATRICULA AS 'FLANMATRICULA.IDLAN',
       IIF(PROVA.DATAETAPA = '','F', CASE WHEN CONVERT(DATE,PROVA.DATAETAPA) <= CONVERT(DATE,GETDATE()) THEN 'T' ELSE 'F' END ) AS 'PROVA.DATAETAPA',
       CASE WHEN PROVA.DATAETAPA <= GETDATE() THEN 'T' ELSE 'F' END as 'teste',
       
       ISNULL(SPSINSCAREAOFERTACOMPL.EXALUNO,'F') AS 'SPSINSCAREAOFERTACOMPL.EXALUNO',
       IIF(GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO,'T','F') AS 'PROVA.DISPONIVEL',
       LANMATRICULA.VENCIDO AS 'LANMATRICULA.VENCIDO',
       IIF(EXALUNO.CODTURMA IS NULL,'F','T') AS 'SMATRICPL.EXALUNO',
       
       CASE 
			WHEN SPSPARAMETROPS.LOGINCPF = 'T' AND SPSUSUARIO.CPF IS NOT NULL THEN CAST(SPSUSUARIO.CPF AS VARCHAR)
			WHEN SPSPARAMETROPS.LOGINEMAIL = 'T' AND SPSUSUARIO.EMAIL IS NOT NULL THEN CAST(SPSUSUARIO.EMAIL AS VARCHAR)
			WHEN SPSPARAMETROPS.LOGINRG = 'T' AND SPSUSUARIO.CARTIDENTIDADE IS NOT NULL THEN CAST(SPSUSUARIO.CARTIDENTIDADE AS VARCHAR)
			WHEN SPSPARAMETROPS.LOGINCODUSUARIO = 'T' AND SPSUSUARIO.CODUSUARIOPS IS NOT NULL THEN CAST(SPSUSUARIO.CODUSUARIOPS AS VARCHAR)
			ELSE CAST(SPSUSUARIO.CODUSUARIOPS AS VARCHAR)
		END AS 'TIPO.LOGINEDUCONNECTEPIX',
		CASE 
			WHEN SPSPARAMETROPS.LOGINCPF = 'T' AND SPSUSUARIO.CPF IS NOT NULL THEN 0
			WHEN SPSPARAMETROPS.LOGINEMAIL = 'T' AND SPSUSUARIO.EMAIL IS NOT NULL THEN 3
			WHEN SPSPARAMETROPS.LOGINRG = 'T' AND SPSUSUARIO.CARTIDENTIDADE IS NOT NULL THEN 1
			WHEN SPSPARAMETROPS.LOGINCODUSUARIO = 'T' AND SPSUSUARIO.CODUSUARIOPS IS NOT NULL THEN 2
			ELSE 2
		END AS 'TIPO.AUTEDUCONNECT',
       CASE 
       	WHEN CURSO.CODCURSO = MATRICULADOCURSO.CODCURSO THEN 'T'
       ELSE 'F' END 'SPSINSCRICAOAREAOFERTADA.MATRICULADOMESMOCURSO'		
      
	
FROM SPSPROCESSOSELETIVO(NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
	
INNER JOIN SPSPARAMETROPS (NOLOCK)
	ON SPSPARAMETROPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPARAMETROPS.IDPS = SPSPROCESSOSELETIVO.IDPS
	
INNER JOIN SPSINSCRICAOAREAOFERTADA (NOLOCK) 
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS





LEFT JOIN SPSINSCAREAOFERTACOMPL (NOLOCK) 
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	
INNER JOIN SCAMPUS (NOLOCK)
    ON SCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO
    
    
/*INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS*/
CROSS APPLY 
(
	SELECT SPSUSUARIO.*, 
	CASE
        WHEN MONTH(GETDATE()) > MONTH(SPSUSUARIO.DTNASCIMENTO) OR (MONTH(GETDATE()) = MONTH(SPSUSUARIO.DTNASCIMENTO) AND DAY(GETDATE()) >= DAY(SPSUSUARIO.DTNASCIMENTO)) THEN DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) 
    ELSE DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) -1 END AS 'IDADE'
	FROM SPSUSUARIO (NOLOCK) 
	WHERE
		SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
) AS SPSUSUARIO	

CROSS APPLY(
	SELECT 
		PCODNACAO.CODCLIENTE,
		PCODNACAO.DESCRICAO
	FROM PCODNACAO(NOLOCK) 
	WHERE CODCLIENTE = SPSUSUARIO.NACIONALIDADE) AS NACIONALIDADE

LEFT JOIN SPSUSUARIOTIPORELAC (NOLOCK)
	ON SPSUSUARIOTIPORELAC.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
	AND SPSUSUARIOTIPORELAC.TIPORELAC = 3	

INNER JOIN SPSOPCAOINSCRITO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	
INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
LEFT JOIN SPSPARAMETROSAREAOFERTADA (NOLOCK)
	ON SPSPARAMETROSAREAOFERTADA.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
    AND SPSPARAMETROSAREAOFERTADA.IDPS = SPSAREAOFERTADA.IDPS
    AND SPSPARAMETROSAREAOFERTADA.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
/** DADOS CURSO **/
CROSS APPLY(		
	SELECT DISTINCT
		SPSAREAINTERESSE.IDAREAINTERESSE,
		SPSAREAINTERESSE.NOME AS NOMEAREAINTERESSE,
		SCURSO.CODCURSO,
		SCURSO.NOME,
		SCURSO.CURPRESDIST,
		SCURSO.CODMODALIDADECURSO AS MODALIDADE,
		STURNO.NOME AS TURNO,
		SHABILITACAOFILIAL.IDHABILITACAOFILIAL,		
		SHABILITACAOFILIALPL.IDPERLET,
		SHABILITACAOFILIAL.CODTIPOCURSO,
		SHABILITACAOFILIALPL.CODFILIAL AS CODFILIAL,
		SCURSO.CODCOLIGADA,
		GETD.CODETD AS CODETD,
		GETD.NOME AS NOMEETD
	FROM SPSAREAINTERESSE (NOLOCK)
	INNER JOIN SHABILITACAOFILIAL (NOLOCK)
		ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
  		AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SCURSO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	INNER JOIN STURNO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
	LEFT JOIN SHABILITACAOFILIALPL(NOLOCK)
		ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	
	/**VINCULO DE CAMPUS COM HABILITACAO PARA PEGAR CAMPUS x MATRIZ APLICADA**/
	INNER JOIN SHABILITACAOFILIALCAMPUS(NOLOCK)
		ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		AND SHABILITACAOFILIALCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO
	INNER JOIN SCAMPUS(NOLOCK)
		ON SCAMPUS.CODCAMPUS = SHABILITACAOFILIALCAMPUS.CODCAMPUS
		AND ISNULL(SCAMPUS.ATIVO, 'N') = 'S'	
		AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCAMPUS.UF IS NOT NULL THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%EAD%' THEN 1 
			ELSE 0 END) = 1
	LEFT JOIN GETD (NOLOCK)
	  	ON GETD.CODETD = SCAMPUS.UF		
WHERE SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE

) AS CURSO

OUTER APPLY (
SELECT TOP 1
	STURMA.CODTURMA AS CODTURMA,
	STURMA.NOME AS NOMETURMA
FROM
	STURMA	(NOLOCK)			
	INNER JOIN STURMACOMPL (NOLOCK)
		ON STURMA.CODCOLIGADA = STURMACOMPL.CODCOLIGADA
		AND STURMA.CODTURMA = STURMACOMPL.CODTURMA
		AND STURMA.CODFILIAL = STURMACOMPL.CODFILIAL
		/*AND STURMA.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO*/
		AND STURMACOMPL.INGRESSANTE = 'T'
		
	
	WHERE
		STURMA.CODCOLIGADA = CURSO.CODCOLIGADA
		AND STURMA.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL
		AND STURMA.IDPERLET  = CURSO.IDPERLET
	
	) AS TURMA

LEFT JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = CURSO.IDPERLET
	
/** DADOS LANCAMENTO/BOLETO INSCRICAO **/
OUTER APPLY(
	SELECT 
		FLAN.IDLAN,
		FLAN.CODCOLIGADA,
		FLAN.CODCFO,
		FLAN.CODCOLCFO,
		FLAN.CODCXA,
		FBOLETO.CNABSTATUS,
		FBOLETO.NOSSONUMERO AS NUMERODOCUMENTO,
		FLAN.CODCOLCXA,	
		FLAN.VALORORIGINAL,
		FLAN.VALORDESCONTO,
		FLAN.STATUSLAN,
		FLAN.IDBOLETO
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO (NOLOCK) 
		ON FLAN.IDLAN = FLANBOLETO.IDLAN
		AND FLAN.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FLAN.CODCOLIGADA = dbo.FLANBOLETO.CODCOLIGADA	
	INNER JOIN FBOLETO (NOLOCK) 
		ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
		AND FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
		AND FBOLETO.STATUS <> 2
	WHERE FLAN.IDLAN = SPSINSCRICAOAREAOFERTADA.IDLAN
	AND FLAN.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN
	AND FLAN.STATUSLAN = 0
) AS FLAN

/**DADOS PROVA**/
OUTER APPLY(
	SELECT TOP 1 
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA AS 'IDPROVA',
		/*IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 1,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA',
		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 2,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA1',
		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 3,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA2',*/
		ISNULL(BEXECPROVA.IDEXECPROVA,'') AS IDEXECPROVA,
		BPROVA.CODPROVA AS 'CODPROVA',
		BPROVA.NOME AS 'NOME',
		ISNULL(SPSAGENDARECURSOPS.HORAINICIO,SPSHORARIOETAPAAREAOFERTADA.HORAINICIO) AS 'HORAINICIOAGENDA',
		ISNULL(SPSAGENDARECURSOPS.HORAFIM,SPSHORARIOETAPAAREAOFERTADA.HORAFIM) AS 'HORAFIMAGENDA',
		SPSHORARIOETAPAAREAOFERTADA.HORAINICIO AS 'HORAINICIOETAPA',
		SPSHORARIOETAPAAREAOFERTADA.HORAFIM AS 'HORAFIMETAPA',
		ISNULL(SPSAGENDARECURSOPS.DATAAGENDAMENTO,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA) AS 'DATAAGENDAMENTO', 
		CASE WHEN SPSOPCAOINSCRITO.ULTIMAETAPA = 1 THEN SPSHORARIOETAPAAREAOFERTADA.DATAETAPA
		ELSE ''
		END AS 'DATAETAPA',
		CONVERT(VARCHAR,ISNULL(SPSAGENDARECURSOPS.DATAAGENDAMENTO, SPSHORARIOETAPAAREAOFERTADA.DATAETAPA), 103) AS 'DATAPROVA'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA	
	INNER JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA		
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BEXECPROVA.ID
	LEFT JOIN SPSAGENDARECURSOPS AS SPSAGENDARECURSOPS (NOLOCK)
		ON SPSAGENDARECURSOPS.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
		AND SPSAGENDARECURSOPS.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSAGENDARECURSOPS.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS			
	WHERE 
			SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA
		AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSETAPAAREAOFERTADA.IDPS
		AND CURSO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
	    AND ISNULL(SPSOPCAOINSCRITO.ULTIMAETAPA,0)+1 = SPSETAPAAREAOFERTADA.ORDEMETAPA
		/** VALIDACOES TEOLOGIA **/
		/*AND (CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103) = CONVERT(VARCHAR(10),GETDATE(),103) THEN 0 ELSE 1 END) = 1*/
		/*AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),GETDATE(),103) <= CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103)
				AND (SPSHORARIOETAPAAREAOFERTADA.HORAFIM/60) <= LEFT(CONVERT(TIME,GETDATE()),2) THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 1
			ELSE 0 END) = 1*/
		/*AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103) = CONVERT(VARCHAR(10),GETDATE(),103)
				AND LEFT(CONVERT(TIME,GETDATE()),2) BETWEEN (SPSHORARIOETAPAAREAOFERTADA.HORAINICIO/60) AND (SPSHORARIOETAPAAREAOFERTADA.HORAFIM/60) THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 1
			ELSE 0 END) = 1*/
) AS PROVA

OUTER APPLY(
	SELECT 
		IIF(COUNT(SPSDOCUMENTOEXIGIDO.CODDOCUMENTO) > 0,'T','F') AS POSSUIDOCUMENTO
	FROM 
		SPSDOCUMENTOEXIGIDO (NOLOCK)
	WHERE
		SPSDOCUMENTOEXIGIDO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSDOCUMENTOEXIGIDO.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
) AS DOCUMENTOS

/****/

/*Matricula*/
OUTER APPLY (
	SELECT 
		SCONTRATO.CODCOLIGADA,
		SMATRICPL.IDPERLET,	
	    CASE WHEN SMATRICPL.CODSTATUS IN (27) THEN 'T'
	    	";;;;;;;;;;;;;;;;;;;;;;;
LSE 'F';;;;;;;;;;;;;;;;;;;;;;;;;;
"	    END	AS 'MATRICULADO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SCONTRATO.CODCONTRATO AS 'CODCONTRATO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SMATRICPL.RA AS 'RA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SALUNO.CODCFO AS 'CODCFO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SCONTRATO.ASSINADO AS 'CONTRATOASSINADO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    CONCAT(CONVERT(VARCHAR,SCONTRATO.DTASSINATURA,103), ' ', CONVERT(VARCHAR,SCONTRATO.DTASSINATURA,8)) AS 'CONTRATODTASSINATURA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    PPESSOA.NACIONALIDADE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SLAN.IDLAN AS LANCMATRICULA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN PPESSOA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON PPESSOA.CODIGO = SALUNO.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SHABILITACAOALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOALUNO.RA = SALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*AND SHABILITACAOALUNO.RECCREATEDON >= SPSINSCRICAOAREAOFERTADA.RECCREATEDON*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SMATRICPL (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SMATRICPL.RA = SALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SMATRICPL.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL /*alteração feita dia 12/07 por conta de matriculas feitas em outra matriz*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SMATRICPL.RA = SHABILITACAOALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SCONTRATO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.RA = SMATRICPL.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.DTCANCELAMENTO IS NULL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SPARCELA (NOLOCK) ON";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.RA = SCONTRATO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.PARCELA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SLAN (NOLOCK) ON";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SLAN.IDPARCELA = SPARCELA.IDPARCELA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SSTATUS (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS MATRICULA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
/** DADOS PAGAMENTO LANCAMENTO/BOLETO MATRICULA **/;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT DISTINCT";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.IDLAN,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLIGADA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCFO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLCFO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCXA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FBOLETO.CNABSTATUS,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FBOLETO.NOSSONUMERO AS NUMERODOCUMENTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLCXA,	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.VALORORIGINAL,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.VALORDESCONTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.STATUSLAN,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.IDBOLETO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		IIF(CONVERT (DATE,GETDATE()) > CONVERT (DATE,FBOLETO.VENCIMENTO),'T','F') AS VENCIDO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM FLAN(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN FLANBOLETO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON FLAN.IDLAN = FLANBOLETO.IDLAN";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLAN.IDBOLETO = FLANBOLETO.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLAN.CODCOLIGADA = dbo.FLANBOLETO.CODCOLIGADA	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN FBOLETO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FBOLETO.STATUS <> 2";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE FLAN.IDLAN = MATRICULA.LANCMATRICULA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND FLAN.CODCOLIGADA = MATRICULA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	/*AND FLAN.STATUSLAN = 1*/";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS LANMATRICULA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
/**;;;;;;;;;;;;;;;;;;;;;;;;;;
"	- LAERTE";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CONSULTA PARA VERIFICAR SE O ALUNO JÁ TEVE VINCULO NA IES";;;;;;;;;;;;;;;;;;;;;;;;;;
**/;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY (;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT 	TOP 1		";;;;;;;;;;;;;;;;;;;;;;;;;;
"		MATRICULADO.CODTURMA	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN PPESSOA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON PPESSOA.CODIGO = SALUNO.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	OUTER APPLY (";;;;;;;;;;;;;;;;;;;;;;;;;;
"			SELECT TOP 1 CODTURMA FROM v_unasp_SMATRICPL WHERE RA = SALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	)MATRICULADO	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS EXALUNO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"SELECT 	TOP 1		";;;;;;;;;;;;;;;;;;;;;;;;;;
"		MATRICULADO.CODCURSO	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN PPESSOA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON PPESSOA.CODIGO = SALUNO.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	OUTER APPLY (";;;;;;;;;;;;;;;;;;;;;;;;;;
"			SELECT TOP 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"				MAX(SHABILITACAOALUNO.RECCREATEDON) AS DTMATRICULA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"				SHABILITACAOFILIAL.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"			FROM SHABILITACAOALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"			INNER JOIN SHABILITACAOFILIAL(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"				ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"				AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"			INNER JOIN SCURSO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"				AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"				AND PATINDEX(SCURSO.NOME, '%PENSIONATO%') = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"			WHERE SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA			";;;;;;;;;;;;;;;;;;;;;;;;;;
"			AND SHABILITACAOALUNO.RA = SALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"			GROUP BY SHABILITACAOFILIAL.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	)MATRICULADO		";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS MATRICULADOCURSO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"WHERE CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO) = :CODINSCRICAO	";;;;;;;;;;;;;;;;;;;;;;;;;;
AND SPSPROCSELCOMPL.PSRUBEUS = 'T';;;;;;;;;;;;;;;;;;;;;;;;;;
"/*AND SPSPROCESSOSELETIVO.IDPS IN (60,61,62,63,64,69,70,71,72,76)*/""";37534;;;;16/11/2022;crmrubeus;0;1;1;1;;;;0;b028f231-cf3e-4100-bfec-d389273bf994;;;21616;wsrubeus;13/09/2021;crmrubeus;16/11/2022;;;;
S;RB.PS.IM.005.1;Dados do portal do candidato - Homolog;"/****
	Função: Toda vez que o candidato logar ele executa logo em seguida essa consulta para buscar dados no TOTVS e sincronizar no Inscrições e Matrículas, ou seja, 
	todos dados que precisam ser sincronizados entre as bases precisam estar nessa consulta.
****/
WITH DOCUMENTOS(NOMEARQUIVO,CODDOCUMENTO,OBRIGATORIO,ENTREGUE,MOTIVO) AS (
SELECT /*DISTINCT	*/
	SPSARQUIVOSCANDIDATO.NOMEARQUIVO AS NOMEARQUIVO,
	SPSDOCUMENTOEXIGIDO.CODDOCUMENTO AS CODDOCUMENTO,
	SPSDOCUMENTOEXIGIDO.OBRIGATORIO AS OBRIGATORIO,
	SPSDOCUMENTOENTREGUE.ENTREGUE AS ENTREGUE,
	SPSDOCUMENTOENTREGUE.MOTIVO AS MOTIVO
FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)

INNER JOIN SPSUSUARIO (NOLOCK) ON
  	SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
  	
INNER JOIN SPSUSUARIO AS OUTROUSUARIO(NOLOCK) ON
  	ISNULL(SPSUSUARIO.CPF, SPSUSUARIO.CODUSUARIOPS) = ISNULL(OUTROUSUARIO.CPF, OUTROUSUARIO.CODUSUARIOPS)
  	
INNER JOIN SPSOPCAOINSCRITO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

INNER JOIN  SPSDOCUMENTOEXIGIDO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE
		
INNER JOIN  SDOCUMENTO (NOLOCK) 
	ON SDOCUMENTO.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
	  
LEFT JOIN SPSDOCUMENTOENTREGUE (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSDOCUMENTOENTREGUE.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
  
LEFT JOIN SPSARQUIVOSCANDIDATO (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSARQUIVOSCANDIDATO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO
	AND SPSARQUIVOSCANDIDATO.NOMEARQUIVO LIKE '%' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.IDPS) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO)  + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODDOCUMENTO) + '.%'

WHERE
		CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) = :CODINSCRICAO
)

SELECT DISTINCT

	/*DEFAULT*/
	CURSO.NOME AS 'CURSO',
	/*IIF(SPSPROCESSOSELETIVO.NOME LIKE '%EAD%','EAD','Presencial') AS 'MODALIDADE',*/
	CASE WHEN 	CURSO.NOME LIKE '%EAD%'
		THEN 'EAD'
		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%'
			 THEN 'EAD'
			 ELSE 'Presencial'
			 END
	END AS 'MODALIDADE',
		
	SCAMPUS.DESCRICAO AS 'CAMPUS',
	SPSPROCESSOSELETIVO.NOME AS 'FORMADEINGRESSO',
	/*DEFAULT*/
	
	/*DADOS CONTATO*/
	SPSUSUARIO.CODUSUARIOPS AS 'SPSUSUARIO.CODUSUARIOPS',
	SPSUSUARIO.NPASSAPORTE AS 'SPSUSUARIO.NPASSAPORTE',
	SPSUSUARIO.NACIONALIDADE AS 'SPSUSUARIO.NACIONALIDADE',
	NACIONALIDADE.DESCRICAO AS 'SPSUSUARIO.NOMENACIONALIDADE',
	SPSUSUARIO.NOME AS 'SPSUSUARIO.NOME',
	SPSUSUARIO.EMAIL AS 'SPSUSUARIO.EMAIL',
	SPSUSUARIO.TELEFONE2 AS 'SPSUSUARIO.TELEFONE2',
	ISNULL(SPSUSUARIO.CPF,0) AS 'SPSUSUARIO.CPF',
	REPLACE(CONVERT(VARCHAR,SPSUSUARIO.DTNASCIMENTO,103),'/','') AS 'SPSUSUARIO.DTNASCIMENTOSENHA',
	SPSUSUARIO.DTNASCIMENTO AS 'SPSUSUARIO.DTNASCIMENTO',
	SPSUSUARIO.SEXO AS 'SPSUSUARIO.SEXO',
	SPSUSUARIO.NOMESOCIAL AS 'SPSUSUARIO.NOMESOCIAL',
	IIF(ISNULL(SPSUSUARIO.NOMESOCIAL,'')='','F','T') AS 'SPSUSUARIO.POSSUINOMESOCIAL',
	CASE 
        WHEN MONTH(GETDATE()) > MONTH(SPSUSUARIO.DTNASCIMENTO) OR (MONTH(GETDATE()) = MONTH(SPSUSUARIO.DTNASCIMENTO) AND DAY(GETDATE()) >= DAY(SPSUSUARIO.DTNASCIMENTO)) THEN DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) 
    ELSE DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) -1 END AS 'SPSUSUARIO.IDADE',
    
    CASE 
		WHEN (SPSOPCAOINSCRITO.STATUS = 5 OR SPSOPCAOINSCRITO.STATUS = 7) AND SPSUSUARIO.IDADE >= 18 THEN 'T'
		WHEN (SPSOPCAOINSCRITO.STATUS = 5 OR SPSOPCAOINSCRITO.STATUS = 7) AND SPSUSUARIO.IDADE < 18 AND ISNULL(SPSUSUARIOTIPORELAC.CODUSUARIOTIPORELAC,0) > 0 THEN 'T'
		ELSE 'F'
	END AS 'PREMATRICULA.DISPONIVEL',
	ISNULL(SPSUSUARIOTIPORELAC.CODUSUARIOTIPORELAC,0) AS 'FINANCEIRO.CODUSUARIOPS',
	/*DADOS CONTATO*/
	SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AS 'SPSINSCRICAOAREAOFERTADA.CODCOLIGADA',
	SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO AS 'SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO',
	IIF(SPSOPCAOINSCRITO.STATUS IN (5,11),5,SPSOPCAOINSCRITO.STATUS) AS 'SPSOPCAOINSCRITO.STATUS',	
	/*	SPSOPCAOINSCRITO.STATUS AS 'SPSOPCAOINSCRITO.STATUS',*/
	SPSINSCRICAOAREAOFERTADA.STATUS	AS 'SPSINSCRICAOAREAOFERTADA.STATUS',
	CURSO.NOMEAREAINTERESSE AS 'SPSAREAINTERESSE.NOME',
	SPSOPCAOINSCRITO.IDAREAINTERESSE AS 'SPSAREAINTERESSE.IDAREAINTERESSE',
	SPSOPCAOINSCRITO.IDAREAINTERESSE AS 'OPORTUNIDADE.IDAREAINTERESSE',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',CURSO.CODCURSO) AS 'SCURSO.CODCURSO',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',CURSO.CODCURSO) AS 'OPORTUNIDADE.CODCURSO',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'SPSOPCAOINSCRITO.CODOFERTA',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'OPORTUNIDADE.CODOFERTA',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SCAMPUS.CODCAMPUS) AS 'SCAMPUS.CODCAMPUS',
	SPSINSCAREAOFERTACOMPL.CODPOLO AS 'SPSINSCAREAOFERTACOMPL.CODPOLO',
	SPSPROCESSOSELETIVO.IDPS AS 'SPSPROCESSOSELETIVO.IDPS',
	ISNULL(CURSO.CODETD,'PRESENCIAL') AS 'COD.SCAMPUS.UF',
	CURSO.NOME AS 'SCURSO.DESCRICAO',
	CURSO.IDHABILITACAOFILIAL AS 'SHABILITACAOFILIAL.IDHABILITACAOFILIAL',
	SPLETIVO.CODPERLET AS 'SPLETIVO.CODPERLET',
	CURSO.IDPERLET AS 'SPLETIVO.IDPERLET',
	CURSO.CODFILIAL AS 'GFILIAL.CODFILIAL',
	CASE
		WHEN FLAN.IDLAN IS NULL THEN 'Sem pagamento'
		WHEN FLAN.STATUSLAN = 0  AND FLAN.VALORORIGINAL - ISNULL(FLAN.VALORDESCONTO,0) > 0 THEN 'Pendente'
		WHEN FLAN.STATUSLAN IN (1,3)  OR SPSINSCRICAOAREAOFERTADA.STATUS = 1 THEN 'Confirmado'		
	END AS 'SPSINSCRICAOAREAOFERTADA.STATUSPAGAMENTO',
	DOCUMENTOS.POSSUIDOCUMENTO AS 'SPSDOCUMENTOEXIGIDO.POSSUIDOCUMENTO',
	SPSOPCAOINSCRITO.CLASSIFICACAO AS 'SPSOPCAOINSCRITO.CLASSIFICACAO',
	ISNULL(SPSOPCAOINSCRITO.PONTUACAO,0) AS 'SPSOPCAOINSCRITO.PONTUACAO',
	ISNULL(SPSINSCAREAOFERTACOMPL.VALINTER,'F') AS 'SPSINSCAREAOFERTACOMPL.VALINTER',
	SPSINSCAREAOFERTACOMPL.PENSIONATO AS 'SPSINSCAREAOFERTACOMPL.PENSIONATO',
	ISNULL(SPSPARAMETROSAREAOFERTADA.CODTURMA,ISNULL(TURMA.CODTURMA,'')) AS 'STURMA.CODTURMA',
	CURSO.CODTIPOCURSO AS 'STIPOCURSOFILIAL.CODTIPOCURSO',
	CASE 
		WHEN SPSUSUARIO.NACIONALIDADE  = 10 OR SPSUSUARIO.NACIONALIDADE  = 20 THEN 'T'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 OR SPSUSUARIO.NACIONALIDADE != 20 THEN 'F'
	END AS 'PREMATRICULA.ESTRANGEIRO',
	CASE 
		WHEN SPSUSUARIO.NACIONALIDADE = 10 THEN 'T'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 AND SPSINSCAREAOFERTACOMPL.VALINTER = 'F' THEN 'F'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 AND SPSINSCAREAOFERTACOMPL.VALINTER = 'T' THEN 'T'
	END AS 'SPSINSCAREAOFERTACOMPL.INSCRICAOVALIDADA',	
	
	/*PROVA*/
	
	/** FEEDBACK PROVA TEOLOGIA **/
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS = 3 THEN 'Reprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (5,7) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 4 THEN 'Aprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (5,7) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 3 THEN 'Aprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (0,16) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 3 THEN 'Aguardando entrevista'		
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS = 16 AND SPSOPCAOINSCRITO.ULTIMAETAPA >= 2 THEN 'Aprovado 1º Fase'		
	END AS 'BPROVA.STATUS',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS1,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS1',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS2,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS2',
	PROVA.NOME AS 'BPROVA.NOME',
	PROVA.CODPROVA AS 'BPROVA.CODPROVA',
	PROVA.IDEXECPROVA AS 'BEXECPROVA.IDEXECPROVA',
	PROVA.IDEXECPROVA1 AS 'BEXECPROVA.IDEXECPROVA1',
	PROVA.IDEXECPROVA2 AS 'BEXECPROVA.IDEXECPROVA2',
	PROVA.IDPROVA AS 'BEXECPROVA.IDPROVA',
	PROVA.IDPROVAINSCRITO AS 'BPROVA.IDPROVAINSCRITO',
	PROVA.HORAINICIOETAPA,
	PROVA.HORAFIMETAPA,
	
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' AND PROVA.IDEXECPROVA IS NOT NULL THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1, PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL',
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1,PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL1',
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1, PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL2',
	CONVERT(VARCHAR(10),PROVA.DATAAGENDAMENTO,120) AS 'SPSAGENDARECURSOPS.DATAAGENDAMENTO',
	PROVA.HORAINICIOAGENDA AS 'SPSAGENDARECURSOPS.HORAINICIO',
	PROVA.HORAFIMAGENDA AS 'SPSAGENDARECURSOPS.HORAFIM',
	IIF(ISNULL(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,103),'') = '','',CONCAT(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,103),' de ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAINICIOAGENDA,0))),' às ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAFIMAGENDA,0))))) AS 'SPSAGENDARECURSOPS.DATAHORAAGENDAMENTO',
	IIF(ISNULL(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,23),'') = '','',CONCAT(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAINICIOAGENDA,0))), ':00')) AS 'SPSAGENDARECURSOPS.AGENDAMENTOCRM',
	
	/*FIM PROVA*/
	
	/*IIF(GETDATE() < ISNULL(SPSPROCSELCOMPL.DTLIMITEALTINSCRICAO, GETDATE() +1),'T','F') AS 'SPSPROCSELCOMPL.DTLIMITEALTINSCRICAO',*/
	
	/*DADOS MATRICULA*/
	MATRICULA.CODCONTRATO AS 'SCONTRATO.CODCONTRATO',
	CASE WHEN MATRICULA.RA IS NULL THEN ' ' ELSE MATRICULA.RA END AS 'SALUNO.RA',
	MATRICULA.CODCFO AS 'FCFO.CODCFO',
	IIF(ISNULL(MATRICULA.CONTRATOASSINADO,'N') = 'N', 0, 1) AS 'SCONTRATO.ASSINADO',
	MATRICULA.CONTRATODTASSINATURA AS 'SCONTRATO.DTASSINATURA',
	MATRICULA.MATRICULADO AS 'SMATRICPL.MATRICULADO',
	/** DOCUMENTOS DE INSCRICAO **/
	CASE 
		/** PENDENTE ENVIO **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NULL AND ISNULL(ENTREGUE,'F') = 'F') > 0 THEN 'Pendente envio'
		/** PENDENTE ENVIO (RECUSADO) **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ISNULL(ENTREGUE,'F') = 'F' AND MOTIVO IS NOT NULL) > 0 THEN 'Pendente envio (Recusado)'
		/** EM ANALISE **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ISNULL(ENTREGUE,'F') = 'F' AND ISNULL(MOTIVO,'') = '') > 0 THEN 'Em analise'
		/** ENTREGUES **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ENTREGUE = 'T' AND ISNULL(MOTIVO,'') = '') > 0 THEN 'Documentos entregues'
		/** SE NÃO TIVER DOCUMENTOS **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS) <= 0 THEN 'Documentos entregues'
	END AS 'DOCUMENTOS.STATUS',
	

	/** DOCUMENTOS DE MATRICULA **/
	CASE        
		/**Se todos ja foram aceitos, retornar que os docs foram aceitos**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO	
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 3
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Documentos entregues'
       
		/**Se tiver 1 documento faltando envio, precisa retornar que existe doc pendente envio**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 0
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Pendente envio'
       
       /**Se tiver algum doc recusado, precisa retornar q tem doc pendente**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 2
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Pendente envio (Recusado)'
       
       /**Se todos ja tiverem sido enviados mais ainda nao foram aceitos, precisa retornar que esta em analise**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1		
		WHERE SDOCALUNO.STATUS = 1
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Em analise' 
       	
       	/**Se não houver documentos**/
		WHEN ISNULL((SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO	
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(MATRICULA.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
					
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1
		LEFT JOIN SARQUIVOS (NOLOCK) ON
			SARQUIVOS.CHAVERM =  CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)	  
		INNER JOIN SDOCUMENTO AS SDOCUMENTOMATRICULA (NOLOCK)
			ON SDOCUMENTOMATRICULA.CODDOCUMENTO = SDOCALUNO.CODDOCUMENTO 			
		WHERE SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA    
           AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL
       GROUP BY SDOCALUNO.RA),0) = 0 THEN 'Não possui documentos'
       END AS 'SMATRICPL.DOCUMENTOMATRICULA',
       
       CASE WHEN LANMATRICULA.STATUSLAN IN (1,3)
       		THEN 1
       		ELSE 0
       END AS 'STATUSPAGAMENTO.MATRICULA',
       MATRICULA.LANCMATRICULA AS 'FLANMATRICULA.IDLAN',
       IIF(PROVA.DATAETAPA = '','F', CASE WHEN CONVERT(DATE,PROVA.DATAETAPA) <= CONVERT(DATE,GETDATE()) THEN 'T' ELSE 'F' END ) AS 'PROVA.DATAETAPA',
       CASE WHEN PROVA.DATAETAPA <= GETDATE() THEN 'T' ELSE 'F' END as 'teste',
       
       ISNULL(SPSINSCAREAOFERTACOMPL.EXALUNO,'F') AS 'SPSINSCAREAOFERTACOMPL.EXALUNO',
       IIF(GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO,'T','F') AS 'PROVA.DISPONIVEL',
       LANMATRICULA.VENCIDO AS 'LANMATRICULA.VENCIDO',
       IIF(EXALUNO.CODTURMA IS NULL,'F','T') AS 'SMATRICPL.EXALUNO',
       CASE WHEN SPSUSUARIO.CPF IS NOT NULL THEN 0
       		WHEN SPSUSUARIO.EMAIL IS NOT NULL THEN 3
       		WHEN SPSUSUARIO.CARTIDENTIDADE IS NOT NULL THEN 1
       END AS 'TIPO.AUTEDUCONNECT',
       CASE WHEN CURSO.CODCURSO <> MATRICULADOCURSO.CODCURSO THEN 'CURSO DIFERENTE'
       ELSE 'CURSO IGUAL' END 'SPSINSCRICAOAREAOFERTADA.MATRICULADOMESMOCURSO'
      
	
FROM SPSPROCESSOSELETIVO(NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
	
INNER JOIN SPSINSCRICAOAREAOFERTADA (NOLOCK) 
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS





LEFT JOIN SPSINSCAREAOFERTACOMPL (NOLOCK) 
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	
INNER JOIN SCAMPUS (NOLOCK)
    ON SCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO
    
    
/*INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS*/
CROSS APPLY 
(
	SELECT SPSUSUARIO.*, 
	CASE
        WHEN MONTH(GETDATE()) > MONTH(SPSUSUARIO.DTNASCIMENTO) OR (MONTH(GETDATE()) = MONTH(SPSUSUARIO.DTNASCIMENTO) AND DAY(GETDATE()) >= DAY(SPSUSUARIO.DTNASCIMENTO)) THEN DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) 
    ELSE DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) -1 END AS 'IDADE'
	FROM SPSUSUARIO (NOLOCK) 
	WHERE
		SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
) AS SPSUSUARIO	

CROSS APPLY(
	SELECT 
		PCODNACAO.CODCLIENTE,
		PCODNACAO.DESCRICAO
	FROM PCODNACAO(NOLOCK) 
	WHERE CODCLIENTE = SPSUSUARIO.NACIONALIDADE) AS NACIONALIDADE

LEFT JOIN SPSUSUARIOTIPORELAC (NOLOCK)
	ON SPSUSUARIOTIPORELAC.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
	AND SPSUSUARIOTIPORELAC.TIPORELAC = 3	

INNER JOIN SPSOPCAOINSCRITO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	
INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
INNER JOIN SPSPARAMETROSAREAOFERTADA (NOLOCK)
	ON SPSPARAMETROSAREAOFERTADA.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
    AND SPSPARAMETROSAREAOFERTADA.IDPS = SPSAREAOFERTADA.IDPS
    AND SPSPARAMETROSAREAOFERTADA.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
/** DADOS CURSO **/
CROSS APPLY(		
	SELECT DISTINCT
		SPSAREAINTERESSE.IDAREAINTERESSE,
		SPSAREAINTERESSE.NOME AS NOMEAREAINTERESSE,
		SCURSO.CODCURSO,
		SCURSO.NOME,
		SCURSO.CURPRESDIST,
		SCURSO.CODMODALIDADECURSO AS MODALIDADE,
		STURNO.NOME AS TURNO,
		SHABILITACAOFILIAL.IDHABILITACAOFILIAL,		
		SHABILITACAOFILIALPL.IDPERLET,
		SHABILITACAOFILIAL.CODTIPOCURSO,
		SHABILITACAOFILIALPL.CODFILIAL AS CODFILIAL,
		SCURSO.CODCOLIGADA,
		GETD.CODETD AS CODETD,
		GETD.NOME AS NOMEETD
	FROM SPSAREAINTERESSE (NOLOCK)
	INNER JOIN SHABILITACAOFILIAL (NOLOCK)
		ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
  		AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SCURSO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	INNER JOIN STURNO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
	LEFT JOIN SHABILITACAOFILIALPL(NOLOCK)
		ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	
	/**VINCULO DE CAMPUS COM HABILITACAO PARA PEGAR CAMPUS x MATRIZ APLICADA**/
	INNER JOIN SHABILITACAOFILIALCAMPUS(NOLOCK)
		ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		AND SHABILITACAOFILIALCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO
	INNER JOIN SCAMPUS(NOLOCK)
		ON SCAMPUS.CODCAMPUS = SHABILITACAOFILIALCAMPUS.CODCAMPUS
		AND ISNULL(SCAMPUS.ATIVO, 'N') = 'S'	
		AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCAMPUS.UF IS NOT NULL THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%EAD%' THEN 1 
			ELSE 0 END) = 1
	LEFT JOIN GETD (NOLOCK)
	  	ON GETD.CODETD = SCAMPUS.UF		
WHERE SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE

) AS CURSO

OUTER APPLY (
SELECT 
	STURMA.CODTURMA AS CODTURMA,
	STURMA.NOME AS NOMETURMA
FROM
	STURMA	(NOLOCK)			
	INNER JOIN STURMACOMPL (NOLOCK)
		ON STURMA.CODCOLIGADA = STURMACOMPL.CODCOLIGADA
		AND STURMA.CODTURMA = STURMACOMPL.CODTURMA
		AND STURMA.CODFILIAL = STURMACOMPL.CODFILIAL
		/*AND STURMA.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO*/
		AND STURMACOMPL.INGRESSANTE = 'T'
		
	
	WHERE
		STURMA.CODCOLIGADA = CURSO.CODCOLIGADA
		AND STURMA.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL
		AND STURMA.IDPERLET  = CURSO.IDPERLET
	
	) AS TURMA

LEFT JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = CURSO.IDPERLET
	
/** DADOS LANCAMENTO/BOLETO INSCRICAO **/
OUTER APPLY(
	SELECT 
		FLAN.IDLAN,
		FLAN.CODCOLIGADA,
		FLAN.CODCFO,
		FLAN.CODCOLCFO,
		FLAN.CODCXA,
		FBOLETO.CNABSTATUS,
		FBOLETO.NOSSONUMERO AS NUMERODOCUMENTO,
		FLAN.CODCOLCXA,	
		FLAN.VALORORIGINAL,
		FLAN.VALORDESCONTO,
		FLAN.STATUSLAN,
		FLAN.IDBOLETO
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO (NOLOCK) 
		ON FLAN.IDLAN = FLANBOLETO.IDLAN
		AND FLAN.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FLAN.CODCOLIGADA = dbo.FLANBOLETO.CODCOLIGADA	
	INNER JOIN FBOLETO (NOLOCK) 
		ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
		AND FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
		AND FBOLETO.STATUS <> 2
	WHERE FLAN.IDLAN = SPSINSCRICAOAREAOFERTADA.IDLAN
	AND FLAN.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN
	AND FLAN.STATUSLAN = 0
) AS FLAN

/**DADOS PROVA**/
OUTER APPLY(
	SELECT TOP 1 
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA AS 'IDPROVA',
		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 1,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA',
		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 2,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA1',
		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 3,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA2',
		BPROVA.CODPROVA AS 'CODPROVA',
		BPROVA.NOME AS 'NOME',
		ISNULL(SPSAGENDARECURSOPS.HORAINICIO,SPSHORARIOETAPAAREAOFERTADA.HORAINICIO) AS 'HORAINICIOAGENDA',
		ISNULL(SPSAGENDARECURSOPS.HORAFIM,SPSHORARIOETAPAAREAOFERTADA.HORAFIM) AS 'HORAFIMAGENDA',
		SPSHORARIOETAPAAREAOFERTADA.HORAINICIO AS 'HORAINICIOETAPA',
		SPSHORARIOETAPAAREAOFERTADA.HORAFIM AS 'HORAFIMETAPA',
		ISNULL(SPSAGENDARECURSOPS.DATAAGENDAMENTO,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA) AS 'DATAAGENDAMENTO', 
		CASE WHEN SPSOPCAOINSCRITO.ULTIMAETAPA = 1 THEN SPSHORARIOETAPAAREAOFERTADA.DATAETAPA
		ELSE ''
		END AS 'DATAETAPA',
		CONVERT(VARCHAR,ISNULL(SPSAGENDARECURSOPS.DATAAGENDAMENTO, SPSHORARIOETAPAAREAOFERTADA.DATAETAPA), 103) AS 'DATAPROVA'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA	
	INNER JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA		
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BEXECPROVA.ID
	LEFT JOIN SPSAGENDARECURSOPS AS SPSAGENDARECURSOPS (NOLOCK)
		ON SPSAGENDARECURSOPS.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
		AND SPSAGENDARECURSOPS.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSAGENDARECURSOPS.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS			
	WHERE 
			SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA
		AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSETAPAAREAOFERTADA.IDPS
		AND CURSO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
	    AND ISNULL(SPSOPCAOINSCRITO.ULTIMAETAPA,0)+1 = SPSETAPAAREAOFERTADA.ORDEMETAPA
		/** VALIDACOES TEOLOGIA **/
		/*AND (CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103) = CONVERT(VARCHAR(10),GETDATE(),103) THEN 0 ELSE 1 END) = 1*/
		/*AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),GETDATE(),103) <= CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103)
				AND (SPSHORARIOETAPAAREAOFERTADA.HORAFIM/60) <= LEFT(CONVERT(TIME,GETDATE()),2) THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 1
			ELSE 0 END) = 1*/
		/*AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103) = CONVERT(VARCHAR(10),GETDATE(),103)
				AND LEFT(CONVERT(TIME,GETDATE()),2) BETWEEN (SPSHORARIOETAPAAREAOFERTADA.HORAINICIO/60) AND (SPSHORARIOETAPAAREAOFERTADA.HORAFIM/60) THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 1
			ELSE 0 END) = 1*/
) AS PROVA

OUTER APPLY(
	SELECT 
		IIF(COUNT(SPSDOCUMENTOEXIGIDO.CODDOCUMENTO) > 0,'T','F') AS POSSUIDOCUMENTO
	FROM 
		SPSDOCUMENTOEXIGIDO (NOLOCK)
	WHERE
		SPSDOCUMENTOEXIGIDO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSDOCUMENTOEXIGIDO.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
) AS DOCUMENTOS

/****/

/*Matricula*/
OUTER APPLY (
	SELECT 
		SCONTRATO.CODCOLIGADA,
		SMATRICPL.IDPERLET,	
	    CASE WHEN SMATRICPL.CODSTATUS IN (27) THEN 'T'
	    	ELSE 'F'
	    END	AS 'MATRICULADO',
	    SCONTRATO.CODCONTRATO AS 'CODCONTRATO',
	    SMATRICPL.RA AS 'RA',
	    SALUNO.CODCFO AS 'CODCFO',
	    SCONTRATO.ASSINADO AS 'CONTRATOASSINADO',
	    CONCAT(CONVERT(VARCHAR,SCONTRATO.DTASSINATURA,103), ' ', CONVERT(VARCHAR,SCONTRATO.DTASSINATURA,8)) AS 'CONTRATODTASSINATURA',
	    PPESSOA.NACIONALIDADE,
	    SLAN.IDLAN AS LANCMATRICULA
	FROM SALUNO(NOLOCK)
	INNER JOIN PPESSOA (NOLOCK)
		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SHABILITACAOALUNO(NOLOCK)
		ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
		AND SHABILITACAOALUNO.RA = SALUNO.RA
		/*AND SHABILITACAOALUNO.RECCREATEDON >= SPSINSCRICAOAREAOFERTADA.RECCREATEDON*/
	INNER JOIN SMATRICPL (NOLOCK)
		ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	    AND SMATRICPL.RA = SALUNO.RA
	    AND SMATRICPL.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL /*alteração feita dia 12/07 por conta de matriculas feitas em outra matriz*/
	    AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
		AND SMA";;;;;;;;;;;;;;;;;;;;;;;
RICPL.RA = SHABILITACAOALUNO.RA;;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SCONTRATO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.RA = SMATRICPL.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.DTCANCELAMENTO IS NULL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SPARCELA (NOLOCK) ON";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.RA = SCONTRATO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.PARCELA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SLAN (NOLOCK) ON";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SLAN.IDPARCELA = SPARCELA.IDPARCELA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SSTATUS (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS MATRICULA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
/** DADOS PAGAMENTO LANCAMENTO/BOLETO MATRICULA **/;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT DISTINCT";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.IDLAN,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLIGADA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCFO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLCFO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCXA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FBOLETO.CNABSTATUS,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FBOLETO.NOSSONUMERO AS NUMERODOCUMENTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLCXA,	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.VALORORIGINAL,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.VALORDESCONTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.STATUSLAN,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.IDBOLETO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		IIF(CONVERT (DATE,GETDATE()) > CONVERT (DATE,FBOLETO.VENCIMENTO),'T','F') AS VENCIDO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM FLAN(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN FLANBOLETO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON FLAN.IDLAN = FLANBOLETO.IDLAN";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLAN.IDBOLETO = FLANBOLETO.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLAN.CODCOLIGADA = dbo.FLANBOLETO.CODCOLIGADA	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN FBOLETO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FBOLETO.STATUS <> 2";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE FLAN.IDLAN = MATRICULA.LANCMATRICULA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND FLAN.CODCOLIGADA = MATRICULA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	/*AND FLAN.STATUSLAN = 1*/";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS LANMATRICULA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
/**;;;;;;;;;;;;;;;;;;;;;;;;;;
"	- LAERTE";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CONSULTA PARA VERIFICAR SE O ALUNO JÁ TEVE VINCULO NA IES";;;;;;;;;;;;;;;;;;;;;;;;;;
**/;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY (;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT 	TOP 1		";;;;;;;;;;;;;;;;;;;;;;;;;;
"		MATRICULADO.CODTURMA	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN PPESSOA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON PPESSOA.CODIGO = SALUNO.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	OUTER APPLY (";;;;;;;;;;;;;;;;;;;;;;;;;;
"			SELECT TOP 1 CODTURMA FROM v_unasp_SMATRICPL WHERE RA = SALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	)MATRICULADO	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS EXALUNO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"SELECT 	TOP 1		";;;;;;;;;;;;;;;;;;;;;;;;;;
"		MATRICULADO.CODCURSO	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN PPESSOA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON PPESSOA.CODIGO = SALUNO.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	OUTER APPLY (";;;;;;;;;;;;;;;;;;;;;;;;;;
"			SELECT TOP 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"				MAX(SHABILITACAOALUNO.RECCREATEDON) AS DTMATRICULA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"				SHABILITACAOFILIAL.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"			FROM SHABILITACAOALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"			INNER JOIN SHABILITACAOFILIAL(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"				ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"				AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"			INNER JOIN SCURSO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"				AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"				AND PATINDEX(SCURSO.NOME, '%PENSIONATO%') = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
"			WHERE SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA			";;;;;;;;;;;;;;;;;;;;;;;;;;
"			AND SHABILITACAOALUNO.RA = SALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"			GROUP BY SHABILITACAOFILIAL.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	)MATRICULADO		";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS MATRICULADOCURSO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"WHERE CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO) = :CODINSCRICAO	";;;;;;;;;;;;;;;;;;;;;;;;;;
AND SPSPROCSELCOMPL.PSRUBEUS = 'T';;;;;;;;;;;;;;;;;;;;;;;;;;
/*AND SPSPROCESSOSELETIVO.IDPS IN (60,61,62,63,64,69,70,71,72,76)*/;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
";36415;;;;06/10/2022;shift;0;1;1;1;;;;0;b028f231-cf3e-4100-bfec-d389273bf994;;;-10215;wsrubeus;23/02/2022;shift;06/10/2022;
S;RB.PS.IM.005.2;Dados do portal do candidato;/****";;;;;;;;;;;;;;;;;;;;;;;;;;
"	Função: Toda vez que o candidato logar ele executa logo em seguida essa consulta para buscar dados no TOTVS e sincronizar no Inscrições e Matrículas, ou seja, ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	todos dados que precisam ser sincronizados entre as bases precisam estar nessa consulta.";;;;;;;;;;;;;;;;;;;;;;;;;;
****/;;;;;;;;;;;;;;;;;;;;;;;;;;
WITH DOCUMENTOS(NOMEARQUIVO,CODDOCUMENTO,OBRIGATORIO,ENTREGUE,MOTIVO) AS (;;;;;;;;;;;;;;;;;;;;;;;;;;
"SELECT /*DISTINCT	*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	SPSARQUIVOSCANDIDATO.NOMEARQUIVO AS NOMEARQUIVO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"	SPSDOCUMENTOEXIGIDO.CODDOCUMENTO AS CODDOCUMENTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"	SPSDOCUMENTOEXIGIDO.OBRIGATORIO AS OBRIGATORIO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"	SPSDOCUMENTOENTREGUE.ENTREGUE AS ENTREGUE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"	SPSDOCUMENTOENTREGUE.MOTIVO AS MOTIVO";;;;;;;;;;;;;;;;;;;;;;;;;;
FROM SPSINSCRICAOAREAOFERTADA (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SPSUSUARIO (NOLOCK) ON;;;;;;;;;;;;;;;;;;;;;;;;;;
"  	SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"  	";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SPSUSUARIO AS OUTROUSUARIO(NOLOCK) ON;;;;;;;;;;;;;;;;;;;;;;;;;;
"  	ISNULL(SPSUSUARIO.CPF, SPSUSUARIO.CODUSUARIOPS) = ISNULL(OUTROUSUARIO.CPF, OUTROUSUARIO.CODUSUARIOPS)";;;;;;;;;;;;;;;;;;;;;;;;;;
"  	";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SPSOPCAOINSCRITO (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN  SPSDOCUMENTOEXIGIDO (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSOPCAOINSCRITO.IDPS = SPSDOCUMENTOEXIGIDO.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN  SDOCUMENTO (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SDOCUMENTO.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	  ";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPSDOCUMENTOENTREGUE (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSDOCUMENTOENTREGUE.IDPS = SPSDOCUMENTOEXIGIDO.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSDOCUMENTOENTREGUE.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO";;;;;;;;;;;;;;;;;;;;;;;;;;
  ;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPSARQUIVOSCANDIDATO (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSDOCUMENTOENTREGUE.IDPS = SPSARQUIVOSCANDIDATO.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSARQUIVOSCANDIDATO.NOMEARQUIVO LIKE '%' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.IDPS) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO)  + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODDOCUMENTO) + '.%'";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE;;;;;;;;;;;;;;;;;;;;;;;;;;
"		CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) = '1-112-1'";;;;;;;;;;;;;;;;;;;;;;;;;;
);;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"SELECT DISTINCT	";;;;;;;;;;;;;;;;;;;;;;;;;;
       CASE WHEN PROVA.DATAETAPA <= GETDATE() THEN 'T' ELSE 'F' END  AS 'PROVA.DATAETAPA',;;;;;;;;;;;;;;;;;;;;;;;;;;
       PROVA.DATAETAPA, GETDATE();;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
FROM SPSPROCESSOSELETIVO(NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SPSPROCSELCOMPL (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SPSINSCRICAOAREAOFERTADA (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPSINSCAREAOFERTACOMPL (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SCAMPUS (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
    ON SCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;
/*INNER JOIN SPSUSUARIO (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS*/";;;;;;;;;;;;;;;;;;;;;;;;;;
CROSS APPLY ;;;;;;;;;;;;;;;;;;;;;;;;;;
(;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT SPSUSUARIO.*, ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CASE";;;;;;;;;;;;;;;;;;;;;;;;;;
        WHEN MONTH(GETDATE()) > MONTH(SPSUSUARIO.DTNASCIMENTO) OR (MONTH(GETDATE()) = MONTH(SPSUSUARIO.DTNASCIMENTO) AND DAY(GETDATE()) >= DAY(SPSUSUARIO.DTNASCIMENTO)) THEN DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) ;;;;;;;;;;;;;;;;;;;;;;;;;;
    ELSE DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) -1 END AS 'IDADE';;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SPSUSUARIO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS";;;;;;;;;;;;;;;;;;;;;;;;;;
") AS SPSUSUARIO	";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
CROSS APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		PCODNACAO.CODCLIENTE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		PCODNACAO.DESCRICAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM PCODNACAO(NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE CODCLIENTE = SPSUSUARIO.NACIONALIDADE) AS NACIONALIDADE";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPSUSUARIOTIPORELAC (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSUSUARIOTIPORELAC.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSUSUARIOTIPORELAC.TIPORELAC = 3	";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SPSOPCAOINSCRITO (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
/** DADOS CURSO **/;;;;;;;;;;;;;;;;;;;;;;;;;;
"CROSS APPLY(		";;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT DISTINCT";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSAREAINTERESSE.IDAREAINTERESSE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSAREAINTERESSE.NOME AS NOMEAREAINTERESSE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.CODCURSO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.NOME,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.CURPRESDIST,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.CODMODALIDADECURSO AS MODALIDADE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		STURNO.NOME AS TURNO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SHABILITACAOFILIAL.IDHABILITACAOFILIAL,		";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SHABILITACAOFILIALPL.IDPERLET,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SHABILITACAOFILIAL.CODTIPOCURSO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SHABILITACAOFILIALPL.CODFILIAL AS CODFILIAL,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.CODCOLIGADA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		GETD.CODETD AS CODETD,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		GETD.NOME AS NOMEETD";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SPSAREAINTERESSE (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SHABILITACAOFILIAL (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"  		AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SCURSO (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN STURNO (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SHABILITACAOFILIALPL(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	/**VINCULO DE CAMPUS COM HABILITACAO PARA PEGAR CAMPUS x MATRIZ APLICADA**/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SHABILITACAOFILIALCAMPUS(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOFILIALCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SCAMPUS(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SCAMPUS.CODCAMPUS = SHABILITACAOFILIALCAMPUS.CODCAMPUS";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND ISNULL(SCAMPUS.ATIVO, 'N') = 'S'	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND (CASE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCAMPUS.UF IS NOT NULL THEN 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%EAD%' THEN 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			ELSE 0 END) = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN GETD (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	  	ON GETD.CODETD = SCAMPUS.UF		";;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
) AS CURSO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY (;;;;;;;;;;;;;;;;;;;;;;;;;;
SELECT ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	STURMA.CODTURMA AS CODTURMA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"	STURMA.NOME AS NOMETURMA";;;;;;;;;;;;;;;;;;;;;;;;;;
FROM;;;;;;;;;;;;;;;;;;;;;;;;;;
"	STURMA	(NOLOCK)			";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN STURMACOMPL (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON STURMA.CODCOLIGADA = STURMACOMPL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND STURMA.CODTURMA = STURMACOMPL.CODTURMA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND STURMA.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND STURMACOMPL.INGRESSANTE = 'T'";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		STURMA.CODCOLIGADA = CURSO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND STURMA.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND STURMA.IDPERLET  = CURSO.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	) AS TURMA";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPLETIVO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPLETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPLETIVO.IDPERLET = CURSO.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
/** DADOS LANCAMENTO/BOLETO INSCRICAO **/;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.IDLAN,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLIGADA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCFO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLCFO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCXA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FBOLETO.CNABSTATUS,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FBOLETO.NOSSONUMERO AS NUMERODOCUMENTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLCXA,	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.VALORORIGINAL,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.VALORDESCONTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.STATUSLAN,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM FLAN(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN FLANBOLETO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON FLAN.IDLAN = FLANBOLETO.IDLAN";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLAN.IDBOLETO = FLANBOLETO.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLAN.CODCOLIGADA = dbo.FLANBOLETO.CODCOLIGADA	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN FBOLETO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FBOLETO.STATUS <> 2";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE FLAN.IDLAN = SPSINSCRICAOAREAOFERTADA.IDLAN";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND FLAN.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND FLAN.STATUSLAN = 0";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS FLAN;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
/**DADOS PROVA**/;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT TOP 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA AS 'IDPROVA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 1,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 2,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA1',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 3,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA2',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		BPROVA.CODPROVA AS 'CODPROVA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		BPROVA.NOME AS 'NOME',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ISNULL(SPSAGENDARECURSOPS.HORAINICIO,SPSHORARIOETAPAAREAOFERTADA.HORAINICIO) AS 'HORAINICIOAGENDA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ISNULL(SPSAGENDARECURSOPS.HORAFIM,SPSHORARIOETAPAAREAOFERTADA.HORAFIM) AS 'HORAFIMAGENDA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSHORARIOETAPAAREAOFERTADA.HORAINICIO AS 'HORAINICIOETAPA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSHORARIOETAPAAREAOFERTADA.HORAFIM AS 'HORAFIMETAPA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ISNULL(SPSAGENDARECURSOPS.DATAAGENDAMENTO,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA) AS 'DATAAGENDAMENTO', ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSHORARIOETAPAAREAOFERTADA.DATAETAPA AS 'DATAETAPA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		CONVERT(VARCHAR,ISNULL(SPSAGENDARECURSOPS.DATAAGENDAMENTO, SPSHORARIOETAPAAREAOFERTADA.DATAETAPA), 103) AS 'DATAPROVA'";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN BPROVA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA		";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN BEXECPROVA (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BEXECPROVA.ID";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SPSAGENDARECURSOPS AS SPSAGENDARECURSOPS (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SPSAGENDARECURSOPS.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSAGENDARECURSOPS.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSAGENDARECURSOPS.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS			";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"			SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSETAPAAREAOFERTADA.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND CURSO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE";;;;;;;;;;;;;;;;;;;;;;;;;;
"	 /*  AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 1*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	   AND ISNULL(SPSOPCAOINSCRITO.ULTIMAETAPA,0)+1 = SPSETAPAAREAOFERTADA.ORDEMETAPA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/** VALIDACOES TEOLOGIA **/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*AND (CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103) = CONVERT(VARCHAR(10),GETDATE(),103) THEN 0 ELSE 1 END) = 1*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*AND (CASE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),GETDATE(),103) <= CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103)";;;;;;;;;;;;;;;;;;;;;;;;;;
"				AND (SPSHORARIOETAPAAREAOFERTADA.HORAFIM/60) <= LEFT(CONVERT(TIME,GETDATE()),2) THEN 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"			ELSE 0 END) = 1*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*AND (CASE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103) = CONVERT(VARCHAR(10),GETDATE(),103)";;;;;;;;;;;;;;;;;;;;;;;;;;
"				AND LEFT(CONVERT(TIME,GETDATE()),2) BETWEEN (SPSHORARIOETAPAAREAOFERTADA.HORAINICIO/60) AND (SPSHORARIOETAPAAREAOFERTADA.HORAFIM/60) THEN 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"			ELSE 0 END) = 1*/";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS PROVA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		IIF(COUNT(SPSDOCUMENTOEXIGIDO.CODDOCUMENTO) > 0,'T','F') AS POSSUIDOCUMENTO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSDOCUMENTOEXIGIDO (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSDOCUMENTOEXIGIDO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSDOCUMENTOEXIGIDO.IDPS = SPSOPCAOINSCRITO.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS DOCUMENTOS;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
/****/;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
/*Matricula*/;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY (;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCONTRATO.CODCOLIGADA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SMATRICPL.IDPERLET,	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    CASE WHEN SMATRICPL.CODSTATUS IN (27) THEN 'T'";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    	ELSE 'F'";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    END	AS 'MATRICULADO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SCONTRATO.CODCONTRATO AS 'CODCONTRATO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SMATRICPL.RA AS 'RA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SALUNO.CODCFO AS 'CODCFO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SCONTRATO.ASSINADO AS 'CONTRATOASSINADO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    CONCAT(CONVERT(VARCHAR,SCONTRATO.DTASSINATURA,103), ' ', CONVERT(VARCHAR,SCONTRATO.DTASSINATURA,8)) AS 'CONTRATODTASSINATURA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    PPESSOA.NACIONALIDADE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    SLAN.IDLAN AS LANCMATRICULA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN PPESSOA (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON PPESSOA.CODIGO = SALUNO.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SHABILITACAOALUNO(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOALUNO.RA = SALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		/*AND SHABILITACAOALUNO.RECCREATEDON >= SPSINSCRICAOAREAOFERTADA.RECCREATEDON*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SMATRICPL (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SMATRICPL.RA = SALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SMATRICPL.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SMATRICPL.RA = SHABILITACAOALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SCONTRATO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.RA = SMATRICPL.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SCONTRATO.DTCANCELAMENTO IS NULL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SPARCELA (NOLOCK) ON";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.RA = SCONTRATO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPARCELA.PARCELA = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"		";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SLAN (NOLOCK) ON";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SLAN.IDPARCELA = SPARCELA.IDPARCELA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN SSTATUS (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS MATRICULA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
/** DADOS PAGAMENTO LANCAMENTO/BOLETO MATRICULA **/;;;;;;;;;;;;;;;;;;;;;;;;;;
OUTER APPLY(;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.IDLAN,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLIGADA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCFO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLCFO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCXA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FBOLETO.CNABSTATUS,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FBOLETO.NOSSONUMERO AS NUMERODOCUMENTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.CODCOLCXA,	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.VALORORIGINAL,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.VALORDESCONTO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.STATUSLAN,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		FLAN.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM FLAN(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN FLANBOLETO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON FLAN.IDLAN = FLANBOLETO.IDLAN";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLAN.IDBOLETO = FLANBOLETO.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLAN.CODCOLIGADA = dbo.FLANBOLETO.CODCOLIGADA	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN FBOLETO (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND FBOLETO.STATUS <> 2";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHERE FLAN.IDLAN = MATRICULA.LANCMATRICULA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND FLAN.CODCOLIGADA = MATRICULA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND FLAN.STATUSLAN = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
) AS LANMATRICULA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"WHERE CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO) = '1-112-1'	";;;;;;;;;;;;;;;;;;;;;;;;;;
AND SPSPROCSELCOMPL.PSRUBEUS = 'T';;;;;;;;;;;;;;;;;;;;;;;;;;
/*AND SPSPROCESSOSELETIVO.IDPS IN (60,61,62,63,64,69,70,71,72,76)*/;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
";16503;;;;25/04/2022;wsrubeus;0;1;1;1;;;;0;b028f231-cf3e-4100-bfec-d389273bf994;;;-22035;wsrubeus;11/03/2022;wsrubeus;25/04/2022;
S;RB.PS.IM.006;Consulta lista ofertas;/****";;;;;;;;;;;;;;;;;;;;;;;;;;
"	Função: Retornar os cursos, local de oferta, modalidade disponíveis para o candidato escolher de acordo com o IDPS que vamos passar como parâmetro.";;;;;;;;;;;;;;;;;;;;;;;;;;
****/;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
SELECT DISTINCT;;;;;;;;;;;;;;;;;;;;;;;;;;
"	/**SALVAR NA INSCRICAO DO CANDIDATO**/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.CAMPUS AS 'DISPLAY.SPSINSCAREAOFERTACOMPL.CODPOLO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.CODCAMPUS AS 'COD.SPSINSCAREAOFERTACOMPL.CODPOLO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	/**---------**/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.NOME AS 'DISPLAY.SCURSO.CODCURSO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CONCAT(CURSO.CODCOLIGADA, '-' ,CURSO.CODCURSO) AS 'COD.SCURSO.CODCURSO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.TURNO AS 'DISPLAY.STURNO.CODTURNO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.CODTURNO AS 'COD.STURNO.CODTURNO',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.CAMPUS AS 'DISPLAY.SCAMPUS.CODCAMPUS',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CONCAT(CURSO.CODCOLIGADA, '-' , CURSO.CODCAMPUS) AS 'COD.SCAMPUS.CODCAMPUS',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CONCAT(CURSO.CODCOLIGADA, '-' ,SPSPROCESSOSELETIVO.IDPS,'-', CURSO.IDAREAINTERESSE) AS 'COD.SPSOPCAOINSCRITO.CODOFERTA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CONCAT(CURSO.CODCOLIGADA, '-' ,SPSPROCESSOSELETIVO.IDPS,'-', CURSO.IDAREAINTERESSE) AS 'DISPLAY.SPSOPCAOINSCRITO.CODOFERTA',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.IDAREAINTERESSE AS 'COD.SPSAREAINTERESSE.IDAREAINTERESSE',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.NOMEAREAINTERESSE AS 'DISPLAY.SPSAREAINTERESSE.IDAREAINTERESSE',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ISNULL(CURSO.CODETD,'PRESENCIAL') AS 'COD.SCAMPUS.UF',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ISNULL(CURSO.NOMEETD,'PRESENCIAL') AS 'DISPLAY.SCAMPUS.UF',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' THEN 'EAD'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%PRESENCIAL%' THEN 'PRESENCIAL'	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ELSE 'PRESENCIAL'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		END";;;;;;;;;;;;;;;;;;;;;;;;;;
"	END AS 'COD.SMODALIDADE.CODMODALIDADE', ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' THEN 'EAD'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%PRESENCIAL%' THEN 'Presencial'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ELSE 'Presencial'";;;;;;;;;;;;;;;;;;;;;;;;;;
"		END";;;;;;;;;;;;;;;;;;;;;;;;;;
"	END AS 'DISPLAY.SMODALIDADE.CODMODALIDADE',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.CODFILIAL AS 'COD.GFILIAL.CODFILIAL',";;;;;;;;;;;;;;;;;;;;;;;;;;
"	CURSO.CODFILIAL AS 'DISPLAY.GFILIAL.CODFILIAL'";;;;;;;;;;;;;;;;;;;;;;;;;;
FROM (SELECT CODCOLIGADA,IDPS,NOME FROM SPSPROCESSOSELETIVO(NOLOCK) WHERE SPSPROCESSOSELETIVO.IDPS = :IDPS AND SPSPROCESSOSELETIVO.CODCOLIGADA=1) AS SPSPROCESSOSELETIVO;;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SPSPROCSELCOMPL (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
" 	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
" 	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS";;;;;;;;;;;;;;;;;;;;;;;;;;
/**DADOS CURSOS**/;;;;;;;;;;;;;;;;;;;;;;;;;;
"CROSS APPLY(		";;;;;;;;;;;;;;;;;;;;;;;;;;
"	SELECT DISTINCT";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSAREAINTERESSE.IDAREAINTERESSE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SPSAREAINTERESSE.NOME AS 'NOMEAREAINTERESSE',";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.CODCOLIGADA,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.CODCURSO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.NOME,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.CURPRESDIST,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCURSO.CODMODALIDADECURSO AS MODALIDADE,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		STURNO.NOME AS TURNO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		STURNO.CODTURNO,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCAMPUS.CODCAMPUS,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SCAMPUS.DESCRICAO AS CAMPUS,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		GETD.CODETD AS CODETD,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		GETD.NOME AS NOMEETD,";;;;;;;;;;;;;;;;;;;;;;;;;;
"		SHABILITACAOFILIAL.CODFILIAL AS 'CODFILIAL'";;;;;;;;;;;;;;;;;;;;;;;;;;
"	FROM SPSAREAINTERESSE (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SHABILITACAOFILIAL (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"  		AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"  	INNER JOIN SHABILITACAO (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"  		ON 	SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"  		AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"  		AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SCURSO (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAO.CODCOLIGADA = SCURSO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAO.CODCURSO = SCURSO.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN STURNO (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SPSAREAOFERTADA(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SPSAREAOFERTADA.STATUS = 'T'";;;;;;;;;;;;;;;;;;;;;;;;;;
"	/**VINCULO DE CAMPUS COM HABILITACAO PARA PEGAR CAMPUS x MATRIZ APLICADA**/";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SHABILITACAOFILIALCAMPUS(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	INNER JOIN SCAMPUS(NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"		ON SCAMPUS.CODCAMPUS = SHABILITACAOFILIALCAMPUS.CODCAMPUS";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND CONVERT(VARCHAR, SCAMPUS.CODCAMPUS) NOT IN ('4') /* desconsidera polo UNASP EAD*/";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND ISNULL(SCAMPUS.ATIVO, 'N') = 'S'	";;;;;;;;;;;;;;;;;;;;;;;;;;
"		AND (CASE				";;;;;;;;;;;;;;;;;;;;;;;;;;
"				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCAMPUS.UF IS NOT NULL THEN 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%EAD%' THEN 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"				";;;;;;;;;;;;;;;;;;;;;;;;;;
"			ELSE 0 END) = 1";;;;;;;;;;;;;;;;;;;;;;;;;;
"			AND (CASE WHEN SPSPROCESSOSELETIVO.IDPS = 96  THEN '%#1#%'";;;;;;;;;;;;;;;;;;;;;;;;;;
"				ELSE '%#1#2#%' END ) LIKE '%#'+CONVERT(VARCHAR,SCAMPUS.TIPOCAMPUS)+'#%'";;;;;;;;;;;;;;;;;;;;;;;;;;
"	LEFT JOIN GETD (NOLOCK)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	  	ON GETD.CODETD = SCAMPUS.UF	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	  	";;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
"	) AS CURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"ORDER BY CURSO.NOME ASC, CURSO.CAMPUS ASC""";4503;;;;02/09/2022;wsrubeus;0;1;1;1;;;;0;24cb1512-7468-4115-9693-2a4e87a6802a;;;-11602;wsrubeus;13/09/2021;wsrubeus;02/09/2022;;;;
S;RB.PS.IM.006.1;Consulta lista ofertas;"/****
	Função: Retornar os cursos, local de oferta, modalidade disponíveis para o candidato escolher de acordo com o IDPS que vamos passar como parâmetro.
****/

SELECT DISTINCT
	/**SALVAR NA INSCRICAO DO CANDIDATO**/
	CURSO.CAMPUS AS 'DISPLAY.SPSINSCAREAOFERTACOMPL.CODPOLO',
	CURSO.CODCAMPUS AS 'COD.SPSINSCAREAOFERTACOMPL.CODPOLO',
	/**---------**/
	CURSO.NOME AS 'DISPLAY.SCURSO.CODCURSO',
	CONCAT(CURSO.CODCOLIGADA, '-' ,CURSO.CODCURSO) AS 'COD.SCURSO.CODCURSO',
	CURSO.TURNO AS 'DISPLAY.STURNO.CODTURNO',
	CURSO.CODTURNO AS 'COD.STURNO.CODTURNO',
	CURSO.CAMPUS AS 'DISPLAY.SCAMPUS.CODCAMPUS',
	CONCAT(CURSO.CODCOLIGADA, '-' , CURSO.CODCAMPUS) AS 'COD.SCAMPUS.CODCAMPUS',
	CONCAT(CURSO.CODCOLIGADA, '-' ,SPSPROCESSOSELETIVO.IDPS,'-', CURSO.IDAREAINTERESSE) AS 'COD.SPSOPCAOINSCRITO.CODOFERTA',
	CONCAT(CURSO.CODCOLIGADA, '-' ,SPSPROCESSOSELETIVO.IDPS,'-', CURSO.IDAREAINTERESSE) AS 'DISPLAY.SPSOPCAOINSCRITO.CODOFERTA',
	CURSO.IDAREAINTERESSE AS 'COD.SPSAREAINTERESSE.IDAREAINTERESSE',
	CURSO.NOMEAREAINTERESSE AS 'DISPLAY.SPSAREAINTERESSE.IDAREAINTERESSE',
	ISNULL(CURSO.CODETD,'PRESENCIAL') AS 'COD.SCAMPUS.UF',
	ISNULL(CURSO.NOMEETD,'PRESENCIAL') AS 'DISPLAY.SCAMPUS.UF',
	CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' THEN 'EAD'
		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%PRESENCIAL%' THEN 'PRESENCIAL'	
		ELSE 'PRESENCIAL'
		END
	END AS 'COD.SMODALIDADE.CODMODALIDADE', 
	
	CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' THEN 'EAD'
		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%PRESENCIAL%' THEN 'Presencial'
		ELSE 'Presencial'
		END
	END AS 'DISPLAY.SMODALIDADE.CODMODALIDADE',
	CURSO.CODFILIAL AS 'COD.GFILIAL.CODFILIAL',
	CURSO.CODFILIAL AS 'DISPLAY.GFILIAL.CODFILIAL'
FROM (SELECT CODCOLIGADA,IDPS,NOME FROM SPSPROCESSOSELETIVO(NOLOCK) WHERE SPSPROCESSOSELETIVO.IDPS = :IDPS AND SPSPROCESSOSELETIVO.CODCOLIGADA=1) AS SPSPROCESSOSELETIVO
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
 	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
 	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
/**DADOS CURSOS**/
CROSS APPLY(		
	SELECT DISTINCT
		SPSAREAINTERESSE.IDAREAINTERESSE,
		SPSAREAINTERESSE.NOME AS 'NOMEAREAINTERESSE',
		SCURSO.CODCOLIGADA,
		SCURSO.CODCURSO,
		SCURSO.NOME,
		SCURSO.CURPRESDIST,
		SCURSO.CODMODALIDADECURSO AS MODALIDADE,
		STURNO.NOME AS TURNO,
		STURNO.CODTURNO,
		SCAMPUS.CODCAMPUS,
		SCAMPUS.DESCRICAO AS CAMPUS,
		GETD.CODETD AS CODETD,
		GETD.NOME AS NOMEETD,
		SHABILITACAOFILIAL.CODFILIAL AS 'CODFILIAL'
	FROM SPSAREAINTERESSE (NOLOCK)
	INNER JOIN SHABILITACAOFILIAL (NOLOCK)
		ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
  		AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
  	INNER JOIN SHABILITACAO (NOLOCK)
  		ON 	SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
  		AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
  		AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	INNER JOIN SCURSO (NOLOCK)
		ON SHABILITACAO.CODCOLIGADA = SCURSO.CODCOLIGADA
		AND SHABILITACAO.CODCURSO = SCURSO.CODCURSO
	INNER JOIN STURNO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
	INNER JOIN SPSAREAOFERTADA(NOLOCK)
		ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
		AND SPSAREAOFERTADA.STATUS = 'T'
	/**VINCULO DE CAMPUS COM HABILITACAO PARA PEGAR CAMPUS x MATRIZ APLICADA**/
	INNER JOIN SHABILITACAOFILIALCAMPUS(NOLOCK)
		ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL	
	INNER JOIN SCAMPUS(NOLOCK)
		ON SCAMPUS.CODCAMPUS = SHABILITACAOFILIALCAMPUS.CODCAMPUS
		AND ISNULL(SCAMPUS.ATIVO, 'N') = 'S'	
		AND (CASE				
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCAMPUS.UF IS NOT NULL THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%EAD%' THEN 1 
				
			ELSE 0 END) = 1
			AND (CASE WHEN SPSPROCESSOSELETIVO.IDPS = 96  THEN '%#1#%'
				ELSE '%#1#2#%' END ) LIKE '%#'+CONVERT(VARCHAR,SCAMPUS.TIPOCAMPUS)+'#%'
	LEFT JOIN GETD (NOLOCK)
	  	ON GETD.CODETD = SCAMPUS.UF	
	  	
WHERE 
	SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS 
	AND SCAMPUS.CODCAMPUS IN ('1','2','3','4')
	
	
	) AS CURSO



ORDER BY CURSO.NOME ASC, CURSO.CAMPUS ASC	
	  
";4475;;;;27/07/2022;wsrubeus;0;1;1;1;;;;0;24cb1512-7468-4115-9693-2a4e87a6802a;;;-25682;wsrubeus;08/06/2022;wsrubeus;27/07/2022;
S;RB.PS.IM.006.2;Consulta lista ofertas - Processo pós EAD;"/****
	Função: Retornar os cursos, local de oferta, modalidade disponíveis para o candidato escolher de acordo com o IDPS que vamos passar como parâmetro.
****/

SELECT DISTINCT
	/**SALVAR NA INSCRICAO DO CANDIDATO**/
	CURSO.CAMPUS AS 'DISPLAY.SPSINSCAREAOFERTACOMPL.CODPOLO',
	CURSO.CODCAMPUS AS 'COD.SPSINSCAREAOFERTACOMPL.CODPOLO',
	/**---------**/
	CURSO.NOME AS 'DISPLAY.SCURSO.CODCURSO',
	CONCAT(CURSO.CODCOLIGADA, '-' ,CURSO.CODCURSO) AS 'COD.SCURSO.CODCURSO',
	CURSO.TURNO AS 'DISPLAY.STURNO.CODTURNO',
	CURSO.CODTURNO AS 'COD.STURNO.CODTURNO',
	CURSO.CAMPUS AS 'DISPLAY.SCAMPUS.CODCAMPUS',
	CONCAT(CURSO.CODCOLIGADA, '-' , CURSO.CODCAMPUS) AS 'COD.SCAMPUS.CODCAMPUS',
	CONCAT(CURSO.CODCOLIGADA, '-' ,SPSPROCESSOSELETIVO.IDPS,'-', CURSO.IDAREAINTERESSE) AS 'COD.SPSOPCAOINSCRITO.CODOFERTA',
	CONCAT(CURSO.CODCOLIGADA, '-' ,SPSPROCESSOSELETIVO.IDPS,'-', CURSO.IDAREAINTERESSE) AS 'DISPLAY.SPSOPCAOINSCRITO.CODOFERTA',
	CURSO.IDAREAINTERESSE AS 'COD.SPSAREAINTERESSE.IDAREAINTERESSE',
	CURSO.NOMEAREAINTERESSE AS 'DISPLAY.SPSAREAINTERESSE.IDAREAINTERESSE',
	ISNULL(CURSO.CODETD,'PRESENCIAL') AS 'COD.SCAMPUS.UF',
	ISNULL(CURSO.NOMEETD,'PRESENCIAL') AS 'DISPLAY.SCAMPUS.UF',
	CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' THEN 'EAD'
		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%PRESENCIAL%' THEN 'PRESENCIAL'	
		ELSE 'PRESENCIAL'
		END
	END AS 'COD.SMODALIDADE.CODMODALIDADE', 
	
	CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' THEN 'EAD'
		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%PRESENCIAL%' THEN 'Presencial'
		ELSE 'Presencial'
		END
	END AS 'DISPLAY.SMODALIDADE.CODMODALIDADE',
	CURSO.CODFILIAL AS 'COD.GFILIAL.CODFILIAL',
	CURSO.CODFILIAL AS 'DISPLAY.GFILIAL.CODFILIAL'
FROM (SELECT CODCOLIGADA,IDPS,NOME FROM SPSPROCESSOSELETIVO(NOLOCK) WHERE SPSPROCESSOSELETIVO.IDPS = :IDPS AND SPSPROCESSOSELETIVO.CODCOLIGADA=1) AS SPSPROCESSOSELETIVO
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
 	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
 	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
/**DADOS CURSOS**/
CROSS APPLY(		
	SELECT DISTINCT
		SPSAREAINTERESSE.IDAREAINTERESSE,
		SPSAREAINTERESSE.NOME AS 'NOMEAREAINTERESSE',
		SCURSO.CODCOLIGADA,
		SCURSO.CODCURSO,
		SCURSO.NOME,
		SCURSO.CURPRESDIST,
		SCURSO.CODMODALIDADECURSO AS MODALIDADE,
		STURNO.NOME AS TURNO,
		STURNO.CODTURNO,
		SCAMPUS.CODCAMPUS,
		SCAMPUS.DESCRICAO AS CAMPUS,
		GETD.CODETD AS CODETD,
		GETD.NOME AS NOMEETD,
		SHABILITACAOFILIAL.CODFILIAL AS 'CODFILIAL'
	FROM SPSAREAINTERESSE (NOLOCK)
	INNER JOIN SHABILITACAOFILIAL (NOLOCK)
		ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
  		AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
  	INNER JOIN SHABILITACAO (NOLOCK)
  		ON 	SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
  		AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
  		AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	INNER JOIN SCURSO (NOLOCK)
		ON SHABILITACAO.CODCOLIGADA = SCURSO.CODCOLIGADA
		AND SHABILITACAO.CODCURSO = SCURSO.CODCURSO
	INNER JOIN STURNO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
	INNER JOIN SPSAREAOFERTADA(NOLOCK)
		ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
		AND SPSAREAOFERTADA.STATUS = 'T'
	/**VINCULO DE CAMPUS COM HABILITACAO PARA PEGAR CAMPUS x MATRIZ APLICADA**/
	INNER JOIN SHABILITACAOFILIALCAMPUS(NOLOCK)
		ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL	
	INNER JOIN SCAMPUS(NOLOCK)
		ON SCAMPUS.CODCAMPUS = SHABILITACAOFILIALCAMPUS.CODCAMPUS
		AND SCAMPUS.CODCAMPUS = '4'
		AND ISNULL(SCAMPUS.ATIVO, 'N') = 'S'	
		/*AND (CASE				
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCAMPUS.UF IS NOT NULL THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%EAD%' THEN 1 				
			ELSE 0 END) = 1
			AND (CASE WHEN SPSPROCESSOSELETIVO.IDPS = 124  THEN '%#1#%'
				ELSE '%#1#2#%' END ) LIKE '%#'+CONVERT(VARCHAR,SCAMPUS.TIPOCAMPUS)+'#%'*/
	LEFT JOIN GETD (NOLOCK)
	  	ON GETD.CODETD = SCAMPUS.UF	
	  	
WHERE 
	SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS 
	
	
	) AS CURSO



ORDER BY CURSO.NOME ASC, CURSO.CAMPUS ASC	
	  
";4464;;;;27/07/2022;wsrubeus;0;1;1;1;;;;0;24cb1512-7468-4115-9693-2a4e87a6802a;;;21492;wsrubeus;22/06/2022;wsrubeus;27/07/2022;
S;RB.PS.IM.007;Consulta pre inscrição;"/****
	Função: Retornar dados para inserir a inscrição
****/
DECLARE @CPF_USUARIO VARCHAR(11),
@PASSAPORTE VARCHAR(MAX),
@IDPROCESSO INT,
@COLIGADA INT;

SET @CPF_USUARIO = :CPF;
SET @PASSAPORTE = :NPASSAPORTE;
SET @IDPROCESSO = :IDPS;
SET @COLIGADA = :CODCOLIGADA;

SELECT DISTINCT 
	SPSPROCESSOSELETIVO.IDPS AS 'SPSPROCESSOSELETIVO.IDPS',
	1 AS 'SPSINSCRICAOAREAOFERTADA.CODCOLIGADA',
	1 AS 'SPSOPCAOINSCRITO.NUMEROOPCAO',
	0 AS 'SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO',
	SPSFORMAINSCRICAOPS.IDFORMAINSCRICAO AS 'SPSINSCRICAOAREAOFERTADA.IDFORMAINSCRICAO',
	ISNULL(SPSUSUARIO.CODUSUARIOPS,'0') AS 'SPSUSUARIO.CODUSUARIOPS',
	SPSPREDIO.CODMUNICIPIO AS 'SPSINSCRICAOAREAOFERTADA.CODMUNICIPIO',
	SPSPREDIO.CODETDMUNICIPIO AS 'SPSINSCRICAOAREAOFERTADA.CODETDMUNICIPIO',
	SPSPREDIO.IDCAMPUS AS 'SPSPREDIO.IDCAMPUS',
	IIF(COUNT(SPSOPCAOINSCRITO.NUMEROINSCRICAO) = 0, 'F', 'T') AS 'SPSINSCRICAOAREAOFERTADA.POSSUIINSCRICAONOPS'
FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
INNER JOIN SPSFORMAINSCRICAOPS (NOLOCK)
	ON SPSFORMAINSCRICAOPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSFORMAINSCRICAOPS.IDPS = SPSPROCESSOSELETIVO.IDPS 
INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
LEFT JOIN SPSLOCALPS (NOLOCK)
	ON SPSLOCALPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSLOCALPS.IDPS = SPSPROCESSOSELETIVO.IDPS
LEFT JOIN SPSPREDIO (NOLOCK)
	ON SPSPREDIO.IDPREDIO = SPSLOCALPS.IDPREDIO	
OUTER APPLY (
	SELECT 
		MAX(CODUSUARIOPS) AS CODUSUARIOPS
	FROM SPSUSUARIO (NOLOCK)
	WHERE SPSUSUARIO.CPF = REPLACE(REPLACE(@CPF_USUARIO, '-', ''), '.', '')
	OR SPSUSUARIO.NPASSAPORTE = @PASSAPORTE
	) AS SPSUSUARIO
LEFT JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
WHERE SPSAREAOFERTADA.STATUS = 'T'
AND SPSPROCESSOSELETIVO.IDPS = @IDPROCESSO
AND SPSPROCESSOSELETIVO.CODCOLIGADA = @COLIGADA

GROUP BY
	SPSPROCESSOSELETIVO.IDPS,
	SPSFORMAINSCRICAOPS.IDFORMAINSCRICAO,
	SPSUSUARIO.CODUSUARIOPS,
	SPSPREDIO.CODMUNICIPIO,
	SPSPREDIO.CODETDMUNICIPIO,
	SPSPREDIO.IDCAMPUS,
	SPSPROCSELCOMPL.PSINDISPONIVEL;";2790;;;;26/01/2022;wsrubeus;0;1;1;1;;;;0;6cc06e1e-345b-4594-8b8e-af10e174feb5;;;31745;wsrubeus;13/09/2021;wsrubeus;26/01/2022;
S;RB.PS.IM.007.1;Consulta pre inscrição;"/****
	Função: Retornar dados para inserir a inscrição
****/
DECLARE @CPF_USUARIO VARCHAR(11),
@PASSAPORTE VARCHAR(MAX),
@IDPROCESSO INT,
@COLIGADA INT;

SET @CPF_USUARIO = :CPF;
SET @PASSAPORTE = :NPASSAPORTE;
SET @IDPROCESSO = :IDPS;
SET @COLIGADA = :CODCOLIGADA;

SELECT DISTINCT 
	SPSPROCESSOSELETIVO.IDPS AS 'SPSPROCESSOSELETIVO.IDPS',
	1 AS 'SPSINSCRICAOAREAOFERTADA.CODCOLIGADA',
	1 AS 'SPSOPCAOINSCRITO.NUMEROOPCAO',
	0 AS 'SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO',
	SPSFORMAINSCRICAOPS.IDFORMAINSCRICAO AS 'SPSINSCRICAOAREAOFERTADA.IDFORMAINSCRICAO',
	ISNULL(SPSUSUARIO.CODUSUARIOPS,'0') AS 'SPSUSUARIO.CODUSUARIOPS',
	SPSPREDIO.CODMUNICIPIO AS 'SPSINSCRICAOAREAOFERTADA.CODMUNICIPIO',
	SPSPREDIO.CODETDMUNICIPIO AS 'SPSINSCRICAOAREAOFERTADA.CODETDMUNICIPIO',
	SPSPREDIO.IDCAMPUS AS 'SPSPREDIO.IDCAMPUS',
	IIF(COUNT(SPSOPCAOINSCRITO.NUMEROINSCRICAO) = 0, 'F', 'T') AS 'SPSINSCRICAOAREAOFERTADA.POSSUIINSCRICAONOPS'
FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
INNER JOIN SPSFORMAINSCRICAOPS (NOLOCK)
	ON SPSFORMAINSCRICAOPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSFORMAINSCRICAOPS.IDPS = SPSPROCESSOSELETIVO.IDPS 
INNER JOIN SPSAREAOFERTADA (NOLOCK)
	ON SPSAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
LEFT JOIN SPSLOCALPS (NOLOCK)
	ON SPSLOCALPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSLOCALPS.IDPS = SPSPROCESSOSELETIVO.IDPS
LEFT JOIN SPSPREDIO (NOLOCK)
	ON SPSPREDIO.IDPREDIO = SPSLOCALPS.IDPREDIO	
OUTER APPLY (
	SELECT 
		MAX(CODUSUARIOPS) AS CODUSUARIOPS
	FROM SPSUSUARIO (NOLOCK)
	WHERE SPSUSUARIO.CPF = REPLACE(REPLACE(@CPF_USUARIO, '-', ''), '.', '')
	OR SPSUSUARIO.NPASSAPORTE = @PASSAPORTE
	) AS SPSUSUARIO
LEFT JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
WHERE SPSAREAOFERTADA.STATUS = 'T'
AND SPSPROCESSOSELETIVO.IDPS = @IDPROCESSO
AND SPSPROCESSOSELETIVO.CODCOLIGADA = @COLIGADA

GROUP BY
	SPSPROCESSOSELETIVO.IDPS,
	SPSFORMAINSCRICAOPS.IDFORMAINSCRICAO,
	SPSUSUARIO.CODUSUARIOPS,
	SPSPREDIO.CODMUNICIPIO,
	SPSPREDIO.CODETDMUNICIPIO,
	SPSPREDIO.IDCAMPUS,
	SPSPROCSELCOMPL.PSINDISPONIVEL;";2790;;;;25/01/2022;wsrubeus;0;1;1;1;;;;0;6cc06e1e-345b-4594-8b8e-af10e174feb5;;;31745;wsrubeus;25/01/2022;wsrubeus;25/01/2022;
S;RB.PS.IM.008;Consulta pos inscrição;"/****
	Função: Retornar os locais de provas e horários que o candidato pode escolher para fazer a prova.
****/

SELECT DISTINCT
	CONVERT(VARCHAR, SPSINSCRICAOAREAOFERTADA.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSINSCRICAOAREAOFERTADA.IDPS) + '-' + CONVERT(VARCHAR, SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO) AS 'SPSINSCRICAOAREAOFERTADA.CODINSCRICAOPS',
	SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO AS 'SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO',
	SHABILITACAOFILIAL.IDHABILITACAOFILIAL AS 'SHABILITACAOFILIAL.IDHABILITACAOFILIAL',
	SPSPROCESSOSELETIVO.NOME AS 'SPSPROCESSOSELETIVO.NOME',
	SHABILITACAOFILIAL.CODHABILITACAO AS 'SHABILITACAOFILIAL.CODHABILITACAO',
	SCURSO.NOME AS 'SCURSO.DESCRICAO',
	NACIONALIDADE.DESCRICAO AS 'SPSUSUARIO.NOMENACIONALIDADE',
	SCAMPUS.DESCRICAO AS 'GFILIAL.DESCRICAO',
	IIF(STURNO.NOME = 'NOTURNO2','NOTURNO',STURNO.NOME)AS 'STURNO.NOME',
	SPSOPCAOINSCRITO.STATUS AS 'SPSOPCAOINSCRITO.STATUS',
	SUBSTRING(SPSUSUARIO.NOME, 1, CHARINDEX(' ', SPSUSUARIO.NOME, 1)) AS 'SPSUSUARIO.PRIMEIRONOME',
	CONCAT(CONVERT(VARCHAR,SPSAGENDARECURSOPS.DATAAGENDAMENTO,103),' às ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, SPSAGENDARECURSOPS.HORAINICIO,0)))) AS 'SPSAGENDARECURSOPS.DATAHORAAGENDAMENTO',
	CONCAT(CONVERT(VARCHAR,SPSAGENDARECURSOPS.DATAAGENDAMENTO,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, SPSAGENDARECURSOPS.HORAINICIO,0))), ':00') AS 'SPSAGENDARECURSOPS.AGENDAMENTOCRM',
	PROVA.IDEXECPROVA AS 'BEXECPROVA.IDEXECPROVA',
	PROVA.IDPROVA AS 'BEXECPROVA.IDPROVA',
	PROVA.IDPROVAINSCRITO AS 'BPROVA.IDPROVAINSCRITO',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS'
	
FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
OUTER APPLY (
	SELECT 
		SPSAGENDARECURSOPS.DATAAGENDAMENTO AS DATAAGENDAMENTO,SPSAGENDARECURSOPS.HORAINICIO AS HORAINICIO
	FROM 
		SPSAGENDARECURSOPS (NOLOCK)
	WHERE
		SPSAGENDARECURSOPS.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSAGENDARECURSOPS.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSAGENDARECURSOPS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
) AS SPSAGENDARECURSOPS

INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
INNER JOIN STURNO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
INNER JOIN SCURSO (NOLOCK)
	ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SPSPROCESSOSELETIVO (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
CROSS APPLY(
	SELECT 
		PCODNACAO.CODCLIENTE,
		PCODNACAO.DESCRICAO
	FROM PCODNACAO(NOLOCK) 
	WHERE CODCLIENTE = SPSUSUARIO.NACIONALIDADE) AS NACIONALIDADE
	
INNER JOIN SPSINSCAREAOFERTACOMPL (NOLOCK)
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
INNER JOIN SCAMPUS (NOLOCK)
	ON SCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO
INNER JOIN SPSFORMAINSCRICAOPS (NOLOCK)
	ON SPSFORMAINSCRICAOPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSFORMAINSCRICAOPS.IDPS = SPSPROCESSOSELETIVO.IDPS
	
OUTER APPLY (
 SELECT 
	BEXECPROVA.IDEXECPROVA AS 'IDEXECPROVA',
	SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA AS 'IDPROVA',
	SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO'	    
FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
	ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
	AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
	AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
	AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
	ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
	AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
	AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
INNER JOIN BPROVA (NOLOCK)
	ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA	
INNER JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
	ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA	
LEFT JOIN BEXECPROVA (NOLOCK) 
	ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
	AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BEXECPROVA.ID 
) AS PROVA
	
WHERE SPSOPCAOINSCRITO.STATUS != 8
AND SPSPROCESSOSELETIVO.STATUS = 'T'
AND GETDATE() BETWEEN SPSFORMAINSCRICAOPS.DATAINICIO AND SPSFORMAINSCRICAOPS.DATAFIM
AND SPSINSCRICAOAREAOFERTADA.IDPS = :IDPS 
AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = 1
AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = :CODUSUARIOPS
AND SPSOPCAOINSCRITO.IDAREAINTERESSE = :IDAREAINTERESSE
 ORDER BY SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO DESC
 
 
 ";6494;;;;11/01/2022;wsrubeus;0;1;1;1;;;;0;d8e3d91d-0694-4f96-a8c0-941e73b75be2;;;28537;wsrubeus;13/09/2021;wsrubeus;11/01/2022;
S;RB.PS.IM.009;Consulta estado cidade;"SELECT  GETD.CODETD 'COD.SPSUSUARIO.ESTADONATAL',
		GETD.NOME AS 'DISPLAY.SPSUSUARIO.ESTADONATAL',
        GMUNICIPIO.CODMUNICIPIO 'COD.SPSUSUARIO.NATURALIDADE',
        GMUNICIPIO.NOMEMUNICIPIO 'DISPLAY.SPSUSUARIO.NATURALIDADE',
        GETD.CODETD 'COD.FINANCEIRO.ESTADONATAL',
		GETD.NOME AS 'DISPLAY.FINANCEIRO.ESTADONATAL',
        GMUNICIPIO.CODMUNICIPIO 'COD.FINANCEIRO.NATURALIDADE',
        GMUNICIPIO.NOMEMUNICIPIO 'DISPLAY.FINANCEIRO.NATURALIDADE'
FROM GMUNICIPIO
INNER JOIN GETD
ON GMUNICIPIO.CODETDMUNICIPIO = GETD.CODETD
WHERE GETD.NACIONAL = 'S'";571;;;;14/10/2021;wsrubeus;0;1;1;1;;;;0;88d6da69-41a3-410b-8dc4-188c98f8bea2;;;6257;wsrubeus;13/09/2021;wsrubeus;14/10/2021;
S;RB.PS.IM.010;Consulta necessidades especiais;"SELECT 
	IIF(CONVERT(VARCHAR,:DEFFISICA) = '1','T','F') AS 'SPSINSCRICAOAREAOFERTADA.DEFFISICA',
	IIF(CONVERT(VARCHAR,:DEFAUDITIVA) = '1','T','F') AS  'SPSINSCRICAOAREAOFERTADA.DEFAUDITIVA',
	IIF(CONVERT(VARCHAR,:DEFFALA) = '1','T','F') AS  'SPSINSCRICAOAREAOFERTADA.DEFFALA',
	IIF(CONVERT(VARCHAR,:DEFVISUAL) = '1','T','F') AS  'SPSINSCRICAOAREAOFERTADA.DEFVISUAL',
	IIF(CONVERT(VARCHAR,:DEFMENTAL) = '1','T','F') AS  'SPSINSCRICAOAREAOFERTADA.DEFMENTAL',
	IIF(CONVERT(VARCHAR,:DEFINTELECTUAL) = '1','T','F') AS  'SPSINSCRICAOAREAOFERTADA.DEFINTELECTUAL';
	";565;;;;13/09/2021;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;13384;wsrubeus;13/09/2021;wsrubeus;13/09/2021;0
S;RB.PS.IM.011;Consulta nacionalidade ;"SELECT 
	PCODNACAO.CODCLIENTE AS 'COD.SPSUSUARIO.NACIONALIDADE',
	PCODNACAO.DESCRICAO AS 'DISPLAY.SPSUSUARIO.NACIONALIDADE'
FROM PCODNACAO(NOLOCK)
	ORDER BY PCODNACAO.DESCRICAO ASC;
	";188;;;;21/09/2021;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;8919;wsrubeus;21/09/2021;wsrubeus;21/09/2021;0
S;RB.PS.IM.012;Consulta tipo rua;"SELECT 
	DTIPORUA.CODIGO AS 'COD.SPSUSUARIO.CODTIPORUA',
	DTIPORUA.DESCRICAO AS 'DISPLAY.SPSUSUARIO.CODTIPORUA'
FROM DTIPORUA(NOLOCK)
	ORDER BY DTIPORUA.DESCRICAO ASC;
	";174;;;;22/09/2021;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;-7077;wsrubeus;22/09/2021;wsrubeus;22/09/2021;0
S;RB.PS.IM.013;Consulta tipo bairro;"SELECT 
	DTIPOBAIRRO.CODIGO AS 'COD.SPSUSUARIO.CODTIPOBAIRRO',
	DTIPOBAIRRO.DESCRICAO AS 'DISPLAY.SPSUSUARIO.CODTIPOBAIRRO'
FROM DTIPOBAIRRO(NOLOCK)
	ORDER BY DTIPOBAIRRO.DESCRICAO ASC;
	";192;;;;22/09/2021;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;-18292;wsrubeus;22/09/2021;wsrubeus;22/09/2021;0
S;RB.PS.IM.014;Consulta Plano de Pagamento;"SELECT
	SPLANOPGTO.CODPLANOPGTO AS 'SPLANOPGTO.CODPLANOPGTO',
	PESSOA.CODPESSOA AS 'PPESSOA.CODIGO'
FROM SPLANOPGTO (NOLOCK)	
INNER JOIN SHABMODELOPGTO (NOLOCK)
	ON  SHABMODELOPGTO.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
	AND SHABMODELOPGTO.IDPERLET = SPLANOPGTO.IDPERLET
	AND SHABMODELOPGTO.CODPLANOPGTO = SPLANOPGTO.CODPLANOPGTO	
INNER JOIN SHABILITACAOFILIAL SHF (NOLOCK) 
	ON SHF.CODCOLIGADA = SHABMODELOPGTO.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHABMODELOPGTO.IDHABILITACAOFILIAL	
INNER JOIN SPSAREAINTERESSE (NOLOCK) 
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHF.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHF.IDHABILITACAOFILIAL
INNER JOIN SPSAREAOFERTADA (NOLOCK) 
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
INNER JOIN SPSOPCAOINSCRITO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
INNER JOIN  SPSINSCRICAOAREAOFERTADA (NOLOCK) 
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO	
INNER JOIN SPSPROCESSOSELETIVO (NOLOCK) 
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS	
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
OUTER APPLY(
	SELECT 
		MAX(PPESSOA.CODIGO) AS CODPESSOA
	FROM SPSUSUARIO(NOLOCK)
	INNER JOIN PPESSOA(NOLOCK)
		ON PPESSOA.CPF = SPSUSUARIO.CPF OR PPESSOA.NPASSAPORTE = SPSUSUARIO.NPASSAPORTE
	WHERE SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
) AS PESSOA	
	
WHERE SPSOPCAOINSCRITO.CODUSUARIOPS = :CODUSUARIOPS
AND SPSOPCAOINSCRITO.IDPS = :IDPS
AND SPLANOPGTO.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
AND SPLANOPGTO.NOME LIKE '%- Ingressante%'
";2137;;;;11/03/2022;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;-24471;wsrubeus;24/09/2021;wsrubeus;11/03/2022;0
S;RB.PS.IM.015;Consulta Documentos de Inscrição;"SELECT DISTINCT
   SDOCUMENTO.CODDOCUMENTO AS CODTIPODOCUMENTO,
   SDOCUMENTO.DESCRICAO AS DESCRICAODOCUMENTO,
   CASE 
   		WHEN SPSDOCUMENTOEXIGIDO.OBRIGATORIO = 'T' THEN 1 
   		ELSE 0 
   END AS OBRIGATORIO,
   SPSDOCUMENTOENTREGUE.MOTIVO AS MOTIVORECUSA,
   CASE
   		WHEN SPSDOCUMENTOENTREGUE.ENTREGUE = 'T' THEN 3
   		WHEN ISNULL(SPSDOCUMENTOENTREGUE.MOTIVO,'') != '' THEN 2
   		WHEN ISNULL(SPSARQUIVOSCANDIDATO.NOMEARQUIVO,'') != '' THEN 1
   		ELSE NULL
   END  AS STATUSENVIO
   

FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)

INNER JOIN SPSUSUARIO (NOLOCK) ON
  	SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
  	
INNER JOIN SPSUSUARIO AS OUTROUSUARIO(NOLOCK) ON
  	ISNULL(SPSUSUARIO.CPF, SPSUSUARIO.CODUSUARIOPS) = ISNULL(OUTROUSUARIO.CPF, OUTROUSUARIO.CODUSUARIOPS)
  	
INNER JOIN SPSOPCAOINSCRITO (NOLOCK) ON
		SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
		AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

INNER JOIN  SPSDOCUMENTOEXIGIDO (NOLOCK) ON
		SPSOPCAOINSCRITO.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
		AND SPSOPCAOINSCRITO.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
		AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE
	  
	LEFT JOIN  SPSDOCUMENTOENTREGUE (NOLOCK) ON
		SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
		AND SPSDOCUMENTOENTREGUE.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
		AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSDOCUMENTOENTREGUE.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
	  
	LEFT JOIN SPSARQUIVOSCANDIDATO (NOLOCK) ON
		SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA
		AND SPSDOCUMENTOENTREGUE.IDPS = SPSARQUIVOSCANDIDATO.IDPS
		AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO
		AND SPSARQUIVOSCANDIDATO.NOMEARQUIVO LIKE '%' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.IDPS) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO)  + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODDOCUMENTO) + '.%'
	  
	INNER JOIN  SDOCUMENTO (NOLOCK) ON
		SDOCUMENTO.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
WHERE
	SPSOPCAOINSCRITO.CODCOLIGADA = :CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = :IDPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = :NUMEROINSCRICAO
ORDER BY 
	(CASE 
   		WHEN SPSDOCUMENTOEXIGIDO.OBRIGATORIO = 'T' THEN 1 
   		ELSE 0 
  	 END) DESC;";2642;;;;28/04/2022;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;-6290;wsrubeus;04/10/2021;wsrubeus;28/04/2022;0
S;RB.PS.IM.016;Consulta dados responsável;"SELECT     
    ISNULL(RESPFINANCEIRO.CODUSUARIOPS,'0') AS 'FINANCEIRO.CODUSUARIOPS',
    ISNULL(CANDIDATO.CODUSUARIOPS,'0') AS 'SPSUSUARIO.CODUSUARIOPS'
FROM (
    SELECT
        :CPFCANDIDATO  AS 'CPFCANDIDATO',
        :CPFRESPFINANCEIRO AS 'CPFRESPFINANCEIRO'
) AS RETORNO
OUTER APPLY    (
    SELECT 
        SPSUSUARIO.CODUSUARIOPS
    FROM SPSUSUARIO(NOLOCK)
     WHERE SPSUSUARIO.CPF = REPLACE(REPLACE(RETORNO.CPFRESPFINANCEIRO, '-', ''), '.', '')
) AS RESPFINANCEIRO
OUTER APPLY    (
    SELECT 
        SPSUSUARIO.CODUSUARIOPS
    FROM SPSUSUARIO(NOLOCK)
     WHERE SPSUSUARIO.CPF = REPLACE(REPLACE(RETORNO.CPFCANDIDATO, '-', ''), '.', '')
) AS CANDIDATO";683;;;;15/10/2021;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;28927;wsrubeus;04/10/2021;wsrubeus;15/10/2021;0
S;RB.PS.IM.017;Consulta atualiza dados pós matrícula;"SELECT
        SALUNO.RA AS 'SALUNO.RA',
        SHABILITACAOFILIALPL.CODFILIAL,
        SCONTRATO.CODCONTRATO AS 'SCONTRATO.CODCONTRATO',
        SALUNO.CODPESSOA AS 'PPESSOA.CODIGO'
FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSOPCAOINSCRITO.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON SPSUSUARIO.CPF = PPESSOA.CPF
	
INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	
INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
	
INNER JOIN SPSPROCSELCOMPL(NOLOCK)
	 ON SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	
INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
		
INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SHABILITACAOFILIALPL(NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	
INNER JOIN SCONTRATO (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA  = SCONTRATO.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDPERLET = SCONTRATO.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIALPL.IDHABILITACAOFILIAL
	AND SALUNO.RA = SCONTRATO.RA
	
INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIALPL.IDHABILITACAOFILIAL
	AND SMATRICPL.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
	AND SMATRICPL.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SMATRICPL.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	
WHERE :CODINSCRICAO = CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO)";2219;;;;30/09/2022;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;-23221;wsrubeus;07/10/2021;wsrubeus;30/09/2022;0
S;RB.PS.IM.017.1;Consulta atualiza dados pós matrícula - BK 24/11;"SELECT 
	SALUNO.RA AS 'SALUNO.RA'
FROM SALUNO (NOLOCK)
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CODIGO = SALUNO.CODPESSOA
WHERE 
	PPESSOA.CPF = REPLACE(REPLACE(:CPF, '-', ''), '.', '')";189;;;;24/11/2021;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;14892;wsrubeus;24/11/2021;wsrubeus;24/11/2021;0
S;RB.PS.IM.018;Consulta componente upload arquivos de matrícula;"SELECT 
	SMOTIVOREJEICAODOCUMENTO.DESCRICAO AS MOTIVORECUSA,
	SDOCALUNO.CODDOCUMENTO AS CODTIPODOCUMENTO,
	SDOCUMENTO.DESCRICAO AS DESCRICAODOCUMENTO,
	ISNULL(SDOCEXIGIDOS.OBRIGATORIO,0) AS OBRIGATORIO,
	NULL AS PATHARQUIVO,
	ISNULL(SARQUIVOS.CHAVERM,CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)) AS CHAVERM,
	CASE
		/** NÃO ENTREGUE**/
		/*WHEN SDOCALUNO.STATUS = 0 THEN '0'*/
		/** ENTREGUE EM VALIDAÇÃO = EM ANÁLISE **/
		WHEN SDOCALUNO.STATUS = 1 THEN '1' 		
		/** RECUSADO **/
		WHEN SDOCALUNO.STATUS = 2 THEN '2'
		/** VALIDADO ***/
		WHEN SDOCALUNO.STATUS = 3 THEN '3'
	ELSE NULL END AS STATUSENVIO,
	SDOCALUNO.STATUS
FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS	
/**CASO CANDIDATO TENHA MAIS DE UM RA PEGAR O ULTIMO**/
OUTER APPLY 
		(
		SELECT TOP 1 
			MAX(SALUNO.RECCREATEDON) AS DATACRIACAO,
			SALUNO.RA,
			PPESSOA.CPF,
			SALUNO.CODCOLIGADA,
			PPESSOA.NACIONALIDADE
		FROM SALUNO(NOLOCK)
			INNER JOIN PPESSOA(NOLOCK)
				ON SALUNO.CODPESSOA = PPESSOA.CODIGO
				AND COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)
		GROUP BY SALUNO.RECCREATEDON,SALUNO.RA,PPESSOA.CPF,SALUNO.CODCOLIGADA,PPESSOA.NACIONALIDADE
		ORDER BY SALUNO.RECCREATEDON DESC) AS SALUNO
INNER JOIN SPSAREAINTERESSE (NOLOCK)   
   ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE    
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
    ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
INNER JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SALUNO.RA
	AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SCONTRATO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
INNER JOIN SDOCEXIGIDOS(NOLOCK)
	ON SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SDOCEXIGIDOS.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL	
INNER JOIN  SDOCALUNO (NOLOCK) 
	ON SDOCALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	/*AND SDOCALUNO.IDPERLET = SCONTRATO.IDPERLET*/
	AND SDOCALUNO.RA = SCONTRATO.RA
	AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
	
	
	
	AND (CASE
		    WHEN ISNULL(SALUNO.NACIONALIDADE, 10) IN (10, 20)
		        AND SDOCALUNO.CODDOCUMENTO = 105 THEN 1
		
		    WHEN SALUNO.NACIONALIDADE NOT IN (10, 20)
		        AND SDOCALUNO.CODDOCUMENTO IN (11, 107, 108) THEN 1
		
		    WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%'
		        AND ISNULL(SALUNO.NACIONALIDADE, 10) IN (10, 20)
		        AND SDOCEXIGIDOS.CODDOCUMENTO IN (3) THEN 1
		
		    WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%'
		        AND ISNULL(SALUNO.NACIONALIDADE, 10) NOT IN (10, 20)
		        AND SDOCEXIGIDOS.CODDOCUMENTO IN (107, 108) THEN 1
		 
		    ELSE 0
		END) = 1
	
	/*CASE 
			WHEN ISNULL(SALUNO.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
			WHEN SALUNO.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(SALUNO.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(SALUNO.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
		ELSE 0 END*/
		
INNER JOIN SDOCUMENTO (NOLOCK)	
	ON SDOCUMENTO.CODDOCUMENTO = SDOCALUNO.CODDOCUMENTO

LEFT JOIN SMOTIVOREJEICAODOCUMENTO(NOLOCK)
	ON SMOTIVOREJEICAODOCUMENTO.CODCOLIGADA = SDOCALUNO.CODCOLIGADA
	AND SMOTIVOREJEICAODOCUMENTO.IDMOTIVOREJEICAODOCUMENTO = SDOCALUNO.IDMOTIVOREJEICAODOCUMENTO
	
LEFT JOIN SARQUIVOS (NOLOCK) ON
	SARQUIVOS.CHAVERM =  CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)	
	
WHERE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) = :CODINSCRICAO;

";5244;;;;16/11/2022;crmrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;-7837;wsrubeus;15/10/2021;crmrubeus;16/11/2022;0
S;RB.PS.IM.018.1;Consulta componente upload arquivos de matrícula - BK 10/12;"SELECT 
	CONVERT(VARCHAR,SDOCALUNO.OBS) AS MOTIVORECUSA,
	SDOCALUNO.CODDOCUMENTO AS CODTIPODOCUMENTO,
	SDOCUMENTO.DESCRICAO AS DESCRICAODOCUMENTO,
	ISNULL(SDOCEXIGIDOS.OBRIGATORIO,0) AS OBRIGATORIO,
	NULL AS PATHARQUIVO,
	ISNULL(SARQUIVOS.CHAVERM,CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)) AS CHAVERM,
	CASE
		WHEN SDOCALUNO.DTENTREGA IS NOT NULL AND SDOCALUNO.DTENTREGA != '' THEN '3'
		WHEN CONVERT(VARCHAR,ISNULL(SDOCALUNO.OBS,'')) != '' THEN '2'
		WHEN SARQUIVOS.NOMEARQUIVO IS NOT NULL AND ISNULL(SDOCALUNO.QUANTIDADE,0) = '1' THEN '1' 
		ELSE NULL
	END AS STATUSENVIO
FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS
LEFT JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS	
/**CASO CANDIDATO TENHA MAIS DE UM RA PEGAR O ULTIMO**/
OUTER APPLY 
		(
		SELECT TOP 1 
			MAX(SALUNO.RECCREATEDON) AS DATACRIACAO,
			SALUNO.RA,
			PPESSOA.CPF,
			SALUNO.CODCOLIGADA,
			PPESSOA.NACIONALIDADE
		FROM SALUNO(NOLOCK)
			INNER JOIN PPESSOA(NOLOCK)
				ON SALUNO.CODPESSOA = PPESSOA.CODIGO
				AND PPESSOA.CPF = SPSUSUARIO.CPF
		GROUP BY SALUNO.RECCREATEDON,SALUNO.RA,PPESSOA.CPF,SALUNO.CODCOLIGADA,PPESSOA.NACIONALIDADE
		ORDER BY SALUNO.RECCREATEDON DESC) AS SALUNO
INNER JOIN SPSAREAINTERESSE (NOLOCK)   
   ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE    
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
    ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
INNER JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SALUNO.RA
	AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SCONTRATO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
INNER JOIN SDOCEXIGIDOS(NOLOCK)
	ON SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SDOCEXIGIDOS.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL	
INNER JOIN  SDOCALUNO (NOLOCK) 
	ON SDOCALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SDOCALUNO.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCALUNO.RA = SCONTRATO.RA
	AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
	AND (CASE 
			WHEN ISNULL(SALUNO.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN (11,107,108) THEN 0
			WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 0
			WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 0						
		ELSE 1 END) = 1
INNER JOIN SDOCUMENTO (NOLOCK)	
	ON SDOCUMENTO.CODDOCUMENTO = SDOCALUNO.CODDOCUMENTO
LEFT JOIN SARQUIVOS (NOLOCK) ON
	SARQUIVOS.CHAVERM =  CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)	                     
WHERE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) = :CODINSCRICAO;
";3831;;;;10/12/2021;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;6295;wsrubeus;06/12/2021;wsrubeus;10/12/2021;0
S;RB.PS.IM.019;Consulta inscrições ativas;"DECLARE @CPF_USUARIO VARCHAR(11),
		@PASSAPORTE VARCHAR(MAX),
		@COLIGADA INT,
		@IDPROCESSO INT

SET @CPF_USUARIO = :CPF;
SET @PASSAPORTE = :NPASSAPORTE;
SET @COLIGADA = :CODCOLIGADA;
SET @IDPROCESSO = :IDPS;

WITH SINSCRICOES(CODCOLIGADA,IDPS,NUMEROINSCRICAO) AS (

	SELECT 
		SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO AS NUMEROINSCRICAO,
		SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AS CODCOLIGADA,
		SPSINSCRICAOAREAOFERTADA.IDPS AS IDPS
	FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)	
	INNER JOIN SPSOPCAOINSCRITO(NOLOCK)
		ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
		AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
		AND SPSOPCAOINSCRITO.STATUS <> 8
	INNER  JOIN SPSUSUARIO(NOLOCK)
		ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
		AND (SPSUSUARIO.CPF = REPLACE(REPLACE(@CPF_USUARIO, '-', ''), '.', '')
		OR SPSUSUARIO.NPASSAPORTE = @PASSAPORTE)
	WHERE SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = @COLIGADA
	  AND SPSINSCRICAOAREAOFERTADA.IDPS = @IDPROCESSO
)
SELECT 
    IIF((SELECT COUNT(SINSCRICOES.NUMEROINSCRICAO) FROM SINSCRICOES) < SPSPROCESSOSELETIVO.LIMITEINSCRICOES, 'T','F') AS 'SPSINSCRICAOAREAOFERTADA.PERMITEREALIZARINSCRICAO',
    SPSPROCSELCOMPL.PSINDISPONIVEL AS 'SPSPROCSELCOMPL.PSINDISPONIVEL'
FROM SPSPROCESSOSELETIVO (NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK)
ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
WHERE SPSPROCESSOSELETIVO.CODCOLIGADA = @COLIGADA
    AND SPSPROCESSOSELETIVO.IDPS = @IDPROCESSO;";1662;;;;11/02/2022;wsrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;-9483;wsrubeus;19/10/2021;wsrubeus;11/02/2022;0
S;RB.PS.IM.020;Consulta débitos;"DECLARE @CPF_USUARIO VARCHAR(20),
		@PASSAPORTE VARCHAR(MAX),
		@COLIGADA INT

SET @CPF_USUARIO = :CPF;
SET @PASSAPORTE = :NPASSAPORTE;
SET @COLIGADA = :CODCOLIGADA;

SELECT TOP 1 * FROM (
SELECT 
	IIF(FLAN.IDLAN IS NULL,'F','T') AS 'FLAN.POSSUIDEBITOS'
	/*,
	FLAN.CODCOLIGADA,
	GCOLIGADA.NOMEFANTASIA NOMECOLIGADA,
	FLAN.CODFILIAL,
	GFILIAL.NOMEFANTASIA NOMEFILIAL,
	FLAN.IDLAN,
	FLAN.DATAVENCIMENTO,
	FLAN.CODCCUSTO,
	FLAN.STATUSLAN,
	FLAN.PAGREC,
	FLAN.CODCOLCFO,
	FLAN.CODCFO,
	FLAN.VALORORIGINAL,
	FCFO.NOMEFANTASIA NOMERESPONSAVEL,
	SPARCELA.PARCELA,
	SPARCELA.COTA,
	SPARCELA.CODSERVICO,
	SSERVICO.NOME NOMESERVICO,
	SPARCELA.RA,
	SALUNO.CODPESSOA,
	SCONTRATO.IDHABILITACAOFILIAL*/
FROM FLAN (NOLOCK)
INNER JOIN SLAN (NOLOCK) 
	ON FLAN.IDLAN = SLAN.IDLAN 
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA 
INNER JOIN SPARCELA (NOLOCK) 
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA  
INNER JOIN SCONTRATO (NOLOCK) 
	ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SPARCELA.RA = SCONTRATO.RA 
	AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO 
	AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET 
INNER JOIN SALUNO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA 
	AND SCONTRATO.RA = SALUNO.RA       	
INNER JOIN PPESSOA(NOLOCK)
	ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	AND (PPESSOA.CPF = REPLACE(REPLACE(@CPF_USUARIO, '.', ''), '-', '')
	OR PPESSOA.NPASSAPORTE = @PASSAPORTE)
		
INNER JOIN GCOLIGADA (NOLOCK)
	ON FLAN.CODCOLIGADA = GCOLIGADA.CODCOLIGADA 
INNER JOIN GFILIAL (NOLOCK) 
	ON FLAN.CODCOLIGADA = GFILIAL.CODCOLIGADA 
	AND FLAN.CODFILIAL = GFILIAL.CODFILIAL
INNER JOIN FCFO (NOLOCK) 
	ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO 
	AND FCFO.CODCFO = FLAN.CODCFO 
INNER JOIN SSERVICO (NOLOCK) 
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA 
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO 
LEFT JOIN SBOLSALAN (NOLOCK) 
	ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA 
	AND SLAN.IDLAN = SBOLSALAN.IDLANBOLSACREDITO
LEFT JOIN SBOLSAPLETIVO (NOLOCK) 
	ON SBOLSALAN.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA 
	AND SBOLSALAN.IDPERLET = SBOLSAPLETIVO.IDPERLET 
	AND SBOLSALAN.CODBOLSA = SBOLSAPLETIVO.CODBOLSA
LEFT JOIN SBOLSA (NOLOCK) 
	ON SBOLSA.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA 
	AND SBOLSA.CODBOLSA = SBOLSAPLETIVO.CODBOLSA
WHERE (FLAN.STATUSLAN IN (0,4) AND IDFAT IS NULL) 
AND FLAN.DATAVENCIMENTO < convert(date, GETDATE()) 
AND SSERVICO.VERIFICAINADIMPLENCIA = 'S' 
AND (SBOLSA.VERIFICAINADIMPLENCIA IS NULL OR SBOLSA.VERIFICAINADIMPLENCIA = 'S') 
AND NOT EXISTS (SELECT 1 FROM FLANBOLETO (NOLOCK)
                          WHERE FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
                          AND FLANBOLETO.IDLAN = FLAN.IDLAN)
                          AND (SPARCELA.CODCOLIGADA = @COLIGADA AND SPARCELA.RA = SALUNO.RA)
union
SELECT 
	IIF(FLAN.IDLAN IS NULL,'F','T') AS 'FLAN.POSSUIDEBITOS'
	/*,
	FLAN.CODCOLIGADA,
	GCOLIGADA.NOMEFANTASIA NOMECOLIGADA,
	FLAN.CODFILIAL,
	GFILIAL.NOMEFANTASIA   NOMEFILIAL,
	FLAN.IDLAN,
	FBOLETO.VENCIMENTO DATAVENCIMENTO,
	FLAN.CODCCUSTO,
	FLAN.STATUSLAN,
	FLAN.PAGREC,
	FLAN.CODCOLCFO,
	FLAN.CODCFO,
	FLAN.VALORORIGINAL,
	FCFO.NOMEFANTASIA NOMERESPONSAVEL,
	SPARCELA.PARCELA,
	SPARCELA.COTA,
	SPARCELA.CODSERVICO,
	SSERVICO.NOME NOMESERVICO,
	SPARCELA.RA,
	SALUNO.CODPESSOA,
	SCONTRATO.IDHABILITACAOFILIAL*/
FROM FLAN (NOLOCK) 
INNER JOIN GCOLIGADA (NOLOCK)	ON ( FLAN.CODCOLIGADA = GCOLIGADA.CODCOLIGADA )
INNER JOIN FLANBOLETO(NOLOCK)	ON ( FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA    AND FLAN.IDLAN = FLANBOLETO.IDLAN )
INNER JOIN FBOLETO (NOLOCK)	ON ( FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA    AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO )
INNER JOIN GFILIAL (NOLOCK)
	ON ( FLAN.CODCOLIGADA = GFILIAL.CODCOLIGADA 
	AND FLAN.CODFILIAL = GFILIAL.CODFILIAL )
INNER JOIN FCFO (NOLOCK)	ON ( FCFO.CODCOLIGADA = FLAN.CODCOLCFO 
	AND FCFO.CODCFO = FLAN.CODCFO )
INNER JOIN SLAN (NOLOCK)	ON ( FLAN.IDLAN = SLAN.IDLAN 
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA )
INNER JOIN SPARCELA (NOLOCK)	ON ( SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA )                            
INNER JOIN SSERVICO (NOLOCK)
	ON ( SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA 
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO )
INNER JOIN SCONTRATO (NOLOCK)	ON ( SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SPARCELA.RA = SCONTRATO.RA 
	AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO 
	AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET )
INNER JOIN SALUNO (NOLOCK)
	ON ( SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA 
	AND SCONTRATO.RA = SALUNO.RA )

INNER JOIN PPESSOA(NOLOCK)
	ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	AND (PPESSOA.CPF = REPLACE(REPLACE(@CPF_USUARIO, '.', ''), '-', '')
	OR PPESSOA.NPASSAPORTE = @PASSAPORTE)	
LEFT JOIN SBOLSALAN (NOLOCK)
	ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA 
	AND SLAN.IDLAN = SBOLSALAN.IDLANBOLSACREDITO
LEFT JOIN SBOLSAPLETIVO (NOLOCK)	ON SBOLSALAN.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA 
	AND SBOLSALAN.IDPERLET = SBOLSAPLETIVO.IDPERLET 
	AND SBOLSALAN.CODBOLSA = SBOLSAPLETIVO.CODBOLSA
LEFT JOIN SBOLSA (NOLOCK)	ON SBOLSALAN.CODCOLIGADA = SBOLSA.CODCOLIGADA 
	AND SBOLSALAN.CODBOLSA = SBOLSA.CODBOLSA
WHERE FLAN.STATUSLAN IN (0,4)
AND FBOLETO.VENCIMENTO < convert(date, GETDATE())
AND SSERVICO.VERIFICAINADIMPLENCIA = 'S' 
AND (SBOLSA.VERIFICAINADIMPLENCIA IS NULL OR SBOLSA.VERIFICAINADIMPLENCIA = 'S')AND (SPARCELA.CODCOLIGADA = @COLIGADA AND SPARCELA.RA = SALUNO.RA)
union
SELECT  
	IIF(FLAN.IDLAN IS NULL,'F','T') AS 'FLAN.POSSUIDEBITOS'
	/*,
	FLAN.CODCOLIGADA,	
	GCOLIGADA.NOMEFANTASIA NOMECOLIGADA,	
	FLAN.CODFILIAL,	
	GFILIAL.NOMEFANTASIA NOMEFILIAL,	
	FLAN.IDLAN,	
	FLAN.DATAVENCIMENTO,	
	FLAN.CODCCUSTO,	
	FLAN.STATUSLAN,	
	FLAN.PAGREC,	
	FLAN.CODCOLCFO,	
	FLAN.CODCFO,	
	FLAN.VALORORIGINAL,	
	FCFO.NOMEFANTASIA NOMERESPONSAVEL,	
	SPARCELA.PARCELA,	
	SPARCELA.COTA,	
	SPARCELA.CODSERVICO,	
	SSERVICO.NOME NOMESERVICO,	
	SPARCELA.RA,	
	SALUNO.CODPESSOA,	
	SCONTRATO.IDHABILITACAOFILIAL*/
FROM FLAN (NOLOCK) 
INNER JOIN FLANBOLETO (NOLOCK) 
	ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND FLANBOLETO.IDLAN = FLAN.IDLAN 
INNER JOIN FBOLETO (NOLOCK) 
	ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA 
	AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO  
INNER JOIN SLAN (NOLOCK) 
	ON FLAN.IDLAN = SLAN.IDLAN 
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA 
INNER JOIN SPARCELA (NOLOCK) 
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA 
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA  
INNER JOIN SCONTRATO (NOLOCK) 
	ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
	AND SPARCELA.RA = SCONTRATO.RA 
	AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO 
	AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET 
INNER JOIN SALUNO (NOLOCK) 
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA 
	AND SCONTRATO.RA = SALUNO.RA           
INNER JOIN PPESSOA(NOLOCK)
	ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	AND (PPESSOA.CPF = REPLACE(REPLACE(@CPF_USUARIO, '.', ''), '-', '')
	OR PPESSOA.NPASSAPORTE = @PASSAPORTE)
	
INNER JOIN GCOLIGADA (NOLOCK)
	ON FLAN.CODCOLIGADA = GCOLIGADA.CODCOLIGADA 
INNER JOIN GFILIAL (NOLOCK) 
	ON FLAN.CODCOLIGADA = GFILIAL.CODCOLIGADA 
	AND FLAN.CODFILIAL = GFILIAL.CODFILIAL
INNER JOIN FCFO (NOLOCK) 
	ON FCFO.CODCOLIGADA = FLAN.CODCOLCFO 
	AND FCFO.CODCFO = FLAN.CODCFO 
INNER JOIN SSERVICO (NOLOCK) 
	ON SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA 
	AND SPARCELA.CODSERVICO = SSERVICO.CODSERVICO 
LEFT JOIN SBOLSALAN (NOLOCK) 
	ON SLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA 
	AND SLAN.IDLAN = SBOLSALAN.IDLANBOLSACREDITO
LEFT JOIN SBOLSAPLETIVO (NOLOCK) 
	ON SBOLSALAN.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA 
	AND SBOLSALAN.IDPERLET = SBOLSAPLETIVO.IDPERLET 
	AND SBOLSALAN.CODBOLSA = SBOLSAPLETIVO.CODBOLSA
LEFT JOIN SBOLSA (NOLOCK) 
	ON SBOLSA.CODCOLIGADA = SBOLSAPLETIVO.CODCOLIGADA 
	AND SBOLSA.CODBOLSA = SBOLSAPLETIVO.CODBOLSA
LEFT JOIN FLANBOLETO OUTROLANBOLETO (NOLOCK) 
	ON OUTROLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA 
	AND OUTROLANBOLETO.IDLAN = FLAN.IDLAN 
	AND OUTROLANBOLETO.IDBOLETO <> FBOLETO.IDBOLETO
LEFT JOIN FBOLETO OUTROBOLETO (NOLOCK) 
	ON OUTROBOLETO.CODCOLIGADA = OUTROLANBOLETO.CODCOLIGADA 
	AND OUTROBOLETO.IDBOLETO = OUTROLANBOLETO.IDBOLETO 
	AND OUTROBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA 
	AND OUTROBOLETO.STATUS <> 2
WHERE (FLAN.STATUSLAN IN (0,4) AND IDFAT IS NULL) 
AND FLAN.DATAVENCIMENTO < convert(date, GETDATE()) 
AND FBOLETO.STATUS = 2 
AND SSERVICO.VERIFICAINADIMPLENCIA = 'S' 
AND (SBOLSA.VERIFICAINADIMPLENCIA IS NULL OR SBOLSA.VERIFICAINADIMPLENCIA = 'S') 
AND (OUTROLANBOLETO.CODCOLIGADA IS NULL AND OUTROLANBOLETO.IDBOLETO IS NULL) 
AND (OUTROBOLETO.CODCOLIGADA IS NULL AND OUTROBOLETO.IDBOLETO IS NULL)AND (SPARCELA.CODCOLIGADA = @COLIGADA AND SPARCELA.RA = SALUNO.RA) 

UNION

SELECT 'F' AS 'FLAN.POSSUIDEBITOS' ) AS FLAN";8994;;;;17/02/2022;isaldo;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;32239;wsrubeus;19/01/2022;isaldo;17/02/2022;0
S;RB.PS.IM.021;Consulta Plano de Pagamento - Pós;"SELECT
	SPLANOPGTO.CODPLANOPGTO AS 'COD.SPLANOPGTO.CODPLANOPGTOPOS',
	SPLANOPGTO.DESCRICAO AS 'DISPLAY.SPLANOPGTO.CODPLANOPGTOPOS',
	PESSOA.CODPESSOA AS 'PPESSOA.CODIGO',
	CASE WHEN SPLANOPGTO.DESCRICAO LIKE '%COMPANY%' THEN 1 ELSE 0 END 'COD.SPSPLANOPGTO.COMPANY',
	CASE WHEN SPLANOPGTO.DESCRICAO LIKE '%COMPANY%' THEN 1 ELSE 0 END 'DISPLAY.SPSPLANOPGTO.COMPANY'
	
FROM SPLANOPGTO (NOLOCK)	
INNER JOIN SHABMODELOPGTO (NOLOCK)
	ON  SHABMODELOPGTO.CODCOLIGADA = SPLANOPGTO.CODCOLIGADA
	AND SHABMODELOPGTO.IDPERLET = SPLANOPGTO.IDPERLET
	AND SHABMODELOPGTO.CODPLANOPGTO = SPLANOPGTO.CODPLANOPGTO	
INNER JOIN SHABILITACAOFILIAL SHF (NOLOCK) 
	ON SHF.CODCOLIGADA = SHABMODELOPGTO.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHABMODELOPGTO.IDHABILITACAOFILIAL	
INNER JOIN SPSAREAINTERESSE (NOLOCK) 
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHF.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHF.IDHABILITACAOFILIAL
INNER JOIN SPSAREAOFERTADA (NOLOCK) 
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
INNER JOIN SPSOPCAOINSCRITO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
INNER JOIN  SPSINSCRICAOAREAOFERTADA (NOLOCK) 
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO	
INNER JOIN SPSPROCESSOSELETIVO (NOLOCK) 
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS	
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
OUTER APPLY(
	SELECT 
		MAX(PPESSOA.CODIGO) AS CODPESSOA
	FROM SPSUSUARIO(NOLOCK)
	INNER JOIN PPESSOA(NOLOCK)
		ON PPESSOA.CPF = SPSUSUARIO.CPF OR PPESSOA.NPASSAPORTE = SPSUSUARIO.NPASSAPORTE
	WHERE SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
) AS PESSOA	
	
WHERE SPSOPCAOINSCRITO.CODUSUARIOPS = :CODUSUARIOPS
AND SPSOPCAOINSCRITO.IDPS = :IDPS
AND GETDATE() BETWEEN SPLANOPGTO.DTINICIO AND SPLANOPGTO.DTFIM
AND SPLANOPGTO.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3) 
";2428;;;;19/10/2022;crmrubeus;0;1;1;1;;;;0;5e911918-6049-4634-b6eb-842f673cc299;0;;2900;wsrubeus;27/01/2022;crmrubeus;19/10/2022;0
S;RB.PS.IM.022;Taxa de matrícula;"DECLARE @PCODCOLIGADA VARCHAR(10), @PCODCONTRATO VARCHAR(20);

SET @PCODCOLIGADA = :CODCOLIGADA;
SET @PCODCONTRATO = :CODCONTRATO;

SELECT
	FLANMATRICULA.IDLAN AS 'FLANMATRICULA.IDLAN',
	FLANMATRICULA.CODCOLIGADA AS 'FLANMATRICULA.CODCOLIGADA', 
	FLANMATRICULA.CODCFO AS 'FLANMATRICULA.CODCFO',
	FLANMATRICULA.CODCOLCFO AS 'FLANMATRICULA.CODCOLCFO',
	FLANMATRICULA.CODCXA AS 'FLANMATRICULA.CODCXA',
	FLANMATRICULA.CNABSTATUS AS 'FLANMATRICULA.CNABSTATUS',
	FLANMATRICULA.CODCOLCXA AS 'FLANMATRICULA.CODCOLCXA',	
	FLANMATRICULA.VALORORIGINALFORMATADO AS 'FLANMATRICULA.VALORORIGINALFORMATADO',
	FLANMATRICULA.VALORORIGINAL AS 'FLANMATRICULA.VALORORIGINAL',
	FLANMATRICULA.VALORCOMDESCONTOFORMATADO AS 'FLANMATRICULA.VALORCOMDESCONTOFORMATADO',
	REPLACE(FLANMATRICULA.VALORCOMDESCONTO,',','.') AS 'FLANMATRICULA.VALORCOMDESCONTOMAT',
	FLANMATRICULA.VALORDESCONTO AS 'FLANMATRICULA.VALORDESCONTO',
	FLANMATRICULA.TAXAMATRICULACENTAVOS AS 'FLANMATRICULA.TAXAMATRICULACENTAVOS',
	FLANMATRICULA.STATUSLAN AS 'FLANMATRICULA.STATUSLAN',
	FLANMATRICULA.IDBOLETO AS 'FLANMATRICULA.IDBOLETO',
	IIF(FLANMATRICULA.CNABSTATUS = 5, 'T','F') AS 'FLANMATRICULA.REGISTRADO',
	'Baixa CIELO taxa de inscrição' AS 'FLANMATRICULA.HISTORICOBAIXA'
FROM SCONTRATO (NOLOCK)
INNER JOIN SPARCELA (NOLOCK)
	ON  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
	AND SPARCELA.CODCOLIGADA = @PCODCOLIGADA
	AND SPARCELA.CODCONTRATO = @PCODCONTRATO
	AND SPARCELA.PARCELA = 1

INNER JOIN SLAN (NOLOCK)
	ON  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA

OUTER APPLY (
	SELECT 
		FLAN.IDLAN,
		FLAN.CODCOLIGADA,
		FLAN.CODCFO,
		FLAN.CODCOLCFO,
		FLAN.CODCXA,
		FBOLETO.CNABSTATUS,
		FBOLETO.STATUS AS 'REGISTRADO',
		FLAN.CODCOLCXA,	
		FORMAT(FLAN.VALORORIGINAL, 'C', 'pt-BR') AS 'VALORORIGINALFORMATADO',
		FLAN.VALORORIGINAL,
		FORMAT(FLAN.VALORORIGINAL - ISNULL(FLAN.VALORDESCONTO,0) - (FLANINTEGRACAO.VALOR), 'C', 'pt-BR') AS 'VALORCOMDESCONTOFORMATADO',
		REPLACE(CAST(FLAN.VALORORIGINAL - (ISNULL(FLAN.VALORDESCONTO,0)) - (FLANINTEGRACAO.VALOR) AS DECIMAL(10,2)),'.',',') AS VALORCOMDESCONTO,
		FLAN.VALORDESCONTO,
		CAST((CAST(FLAN.VALORORIGINAL - (ISNULL(FLAN.VALORDESCONTO,0)) - (FLANINTEGRACAO.VALOR) AS DECIMAL(10,2))  * 100)AS INT) AS 'TAXAMATRICULACENTAVOS',
		FLAN.STATUSLAN,
		FLAN.IDBOLETO
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO (NOLOCK) 
		ON FLAN.IDLAN = FLANBOLETO.IDLAN
		AND FLAN.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FLAN.CODCOLIGADA = dbo.FLANBOLETO.CODCOLIGADA	
	INNER JOIN FBOLETO (NOLOCK) 
		ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
		AND FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
		AND FBOLETO.STATUS <> 2
	OUTER APPLY (SELECT
		ISNULL(SUM(VALOR),0)AS VALOR
	FROM	
	 FLANINTEGRACAO
	WHERE FLAN.CODCOLIGADA = FLANINTEGRACAO.CODCOLIGADA
	AND FLAN.IDLAN = FLANINTEGRACAO.IDLAN) AS FLANINTEGRACAO
	WHERE FLAN.IDLAN = SLAN.IDLAN
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
	AND FLAN.STATUSLAN = 0
) AS FLANMATRICULA;";3058;;;;04/08/2022;wsrubeus;0;1;1;1;;;;0;79473773-69a7-4a6d-b715-8f32e46aabbe;0;;10057;wsrubeus;27/01/2022;wsrubeus;04/08/2022;0
S;RB.PS.IM.025;Validar cupom de desconto;"/****
	Função: Retornar se o cupom é valido ou não
****/
DECLARE @CODCUPOM VARCHAR(MAX);

SET @CODCUPOM = :CUPOM;

SELECT TOP 1 * FROM (
	SELECT
		CASE WHEN CODCUPOM IS NOT NULL THEN 'T' ELSE 'F' END 'STATUS.CUPOM',
		CODCUPOM AS 'SPSINSCRAREAOFERTACOMPL.CUPOMDESCONTO'
	FROM ZMDCPDESCONTO(NOLOCK)
	WHERE CODCUPOM = @CODCUPOM
	AND GETDATE() BETWEEN DATAINICIAL AND DATAFINAL
	AND ATIVO = 1

UNION

	SELECT 'F' AS 'STATUS.CUPOM', '' AS 'SPSINSCRAREAOFERTACOMPL.CUPOMDESCONTO'
) AS SUB
ORDER BY 1 DESC";519;;;;04/02/2022;wsrubeus;0;1;1;1;;;;0;79473773-69a7-4a6d-b715-8f32e46aabbe;0;;11108;wsrubeus;04/02/2022;wsrubeus;04/02/2022;0
S;RB.PS.IM.026;Consulta data atual;"SELECT CONCAT(CONVERT(VARCHAR,GETDATE(),103), ' ', CONVERT(VARCHAR,GETDATE(),8)) AS 'SDATA.DATAATUAL',
	   CONVERT(VARCHAR,GETDATE(),8) AS 'SDATA.HORAATUAL'";157;;;;08/02/2022;wsrubeus;0;1;1;1;;;;0;79473773-69a7-4a6d-b715-8f32e46aabbe;0;;9807;wsrubeus;08/02/2022;wsrubeus;08/02/2022;0
S;RB.PS.IM.027;Retorna as religiões;"SELECT DISTINCT
	CODINTERNO 'COD.SALUNOCOMPL.RELIGIAO',
	DESCRICAO 'DISPLAY.SALUNOCOMPL.RELIGIAO'
FROM   GCONSIST (NOLOCK)
WHERE
	CODTABELA = 'RELIGIÃO'
";159;;;;28/09/2022;wsrubeus;0;1;1;1;;;;0;1456efca-443c-4036-aba2-753485f96ed2;0;;-30282;wsrubeus;28/09/2022;wsrubeus;28/09/2022;0
S;RB.PS.IM.TESTE;Consulta testes;"/*select convert(varchar, reccreatedon) from ppessoa 
inner join saluno on saluno.codpessoa = ppessoa.codigo
where ppessoa.cpf = '51328834867'*/
select * from sdocumento where coddocumento iN (3, 218, 105)";208;;;;12/11/2022;crmrubeus;0;1;1;1;;;;0;e3311b7a-0fea-427a-ac60-c2596938d916;0;;2203;wsrubeus;06/12/2021;crmrubeus;12/11/2022;0
S;RB.PS.IM.TESTE.1;Consulta testes;"SELECT 
	SMOTIVOREJEICAODOCUMENTO.DESCRICAO AS MOTIVORECUSA,
	SDOCALUNO.CODDOCUMENTO AS CODTIPODOCUMENTO,
	SDOCUMENTO.DESCRICAO AS DESCRICAODOCUMENTO,
	ISNULL(SDOCEXIGIDOS.OBRIGATORIO,0) AS OBRIGATORIO,
	NULL AS PATHARQUIVO,
	ISNULL(SARQUIVOS.CHAVERM,CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)) AS CHAVERM,
	CASE
		/** NÃO ENTREGUE**/
		WHEN SDOCALUNO.STATUS = 0 THEN '0'
		/** ENTREGUE EM VALIDAÇÃO = EM ANÁLISE **/
		WHEN SDOCALUNO.STATUS = 1 THEN '1' 		
		/** RECUSADO **/
		WHEN SDOCALUNO.STATUS = 2 THEN '2'
		/** VALIDADO ***/
		WHEN SDOCALUNO.STATUS = 3 THEN '3'
	ELSE NULL END AS STATUSENVIO,
	SDOCALUNO.STATUS
FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSOPCAOINSCRITO.IDPS
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSOPCAOINSCRITO.IDPS	
/**CASO CANDIDATO TENHA MAIS DE UM RA PEGAR O ULTIMO**/
OUTER APPLY 
		(
		SELECT TOP 1 
			MAX(SALUNO.RECCREATEDON) AS DATACRIACAO,
			SALUNO.RA,
			PPESSOA.CPF,
			SALUNO.CODCOLIGADA,
			PPESSOA.NACIONALIDADE
		FROM SALUNO(NOLOCK)
			INNER JOIN PPESSOA(NOLOCK)
				ON SALUNO.CODPESSOA = PPESSOA.CODIGO
				AND COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)
		GROUP BY SALUNO.RECCREATEDON,SALUNO.RA,PPESSOA.CPF,SALUNO.CODCOLIGADA,PPESSOA.NACIONALIDADE
		ORDER BY SALUNO.RECCREATEDON DESC) AS SALUNO
INNER JOIN SPSAREAINTERESSE (NOLOCK)   
   ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE    
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
    ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIALPL (NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
INNER JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SCONTRATO.RA = SALUNO.RA
	AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	AND SCONTRATO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
INNER JOIN SDOCEXIGIDOS(NOLOCK)
	ON SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SDOCEXIGIDOS.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL	
INNER JOIN  SDOCALUNO (NOLOCK) 
	ON SDOCALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SDOCALUNO.IDPERLET = SCONTRATO.IDPERLET
	AND SDOCALUNO.RA = SCONTRATO.RA
	AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
	/*AND (CASE 
			WHEN ISNULL(SALUNO.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
			WHEN SALUNO.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(SALUNO.NACIONALIDADE,10) IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (3) THEN 1
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós%' AND ISNULL(SALUNO.NACIONALIDADE,10) NOT IN (10,20) AND SDOCEXIGIDOS.CODDOCUMENTO IN  (107,108) THEN 1
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
		ELSE 0 END) = 1*/
		
INNER JOIN SDOCUMENTO (NOLOCK)	
	ON SDOCUMENTO.CODDOCUMENTO = SDOCALUNO.CODDOCUMENTO

LEFT JOIN SMOTIVOREJEICAODOCUMENTO(NOLOCK)
	ON SMOTIVOREJEICAODOCUMENTO.CODCOLIGADA = SDOCALUNO.CODCOLIGADA
	AND SMOTIVOREJEICAODOCUMENTO.IDMOTIVOREJEICAODOCUMENTO = SDOCALUNO.IDMOTIVOREJEICAODOCUMENTO
	
LEFT JOIN SARQUIVOS (NOLOCK) ON
	SARQUIVOS.CHAVERM =  CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)	
	
WHERE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) = '1-137-47';

";4615;;;;18/10/2022;crmrubeus;0;1;1;1;;;;0;e3311b7a-0fea-427a-ac60-c2596938d916;0;;-32639;wsrubeus;24/03/2022;crmrubeus;18/10/2022;0
S;RBCRM.WS;Consultas CRM (NÃO UTILIZAR ESSAS CONSULTAS USAR RB.INT.CAP);"SELECT DISTINCT
	/*CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) AS 'evento.codRegistro',*/
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta'
, DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE())
FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	AND GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSUSUARIO.CODUSUARIOPS = 17932
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN( SPSPROCSELCOMPL.IDPERLET,  SPSPROCSELCOMPL.IDPERLET1,  SPSPROCSELCOMPL.IDPERLET2,  SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = 27 /**27- CURSANDO**/ 
	AND SMATRICPL.CODTIPOMAT = 4 /**4- MATRICULA**/
	/*AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL	*/

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)
/*
INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SCONTRATO.ASSINADO = 'S'

INNER JOIN SPARCELA(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SPARCELA.PARCELA = 1

INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA

INNER JOIN FLAN(NOLOCK)
	ON FLAN.IDLAN = SLAN.IDLAN
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
	AND FLAN.STATUSLAN IN (1, 3)*/
/*
LEFT JOIN SPSPARAMETROPS (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPARAMETROPS.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPARAMETROPS.IDPS 
	AND SPSPARAMETROPS.USAINTEGRACAORUBEUS = 'T'*/";4645;;;;20/04/2022;wsrubeus;0;1;1;1;;;;0;939bc439-87c1-42c0-a2f5-5b0ac36eabc5;;;-31161;rubeus;29/03/2021;shift;05/11/2022;
S;RBCRM.WS.032;Atualizar dados CRM - Fórmula Visual;"SELECT DISTINCT 
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SPSINSCRICAOAREAOFERTADA.IDPS,'-', SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-', SHABILITACAOFILIAL.CODCURSO)                                         AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    CASE 
    	WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Pós-graduação%' OR SPSPROCESSOSELETIVO.NOME LIKE '%Diplomados%' THEN 'Sem prova'
    	WHEN SPSFORMAINSCRICAOPS.OBRIGATORIOENEM = 'S' THEN 'ENEM'
    ELSE CONCAT(SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO,'-',SPSOPCAOINSCRITO.CODCOLIGADA) END    	  AS 'evento.inscricaoprova_compl_proc',
    CONVERT(VARCHAR(10),ISNULL(FLAN.DATABAIXA, SPSINSCRICAOAREAOFERTADA.DATAINSCRICAO),120)                               AS 'evento.momento',
    CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) 				  AS 'evento.codRegistro',
    CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%ead%' 
    	THEN CONCAT(SPSPROCESSOSELETIVO.CODCOLIGADA,'-',SHABILITACAOFILIALCAMPUS.CODCAMPUS )
    ELSE CASE 
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%São Paulo%' THEN '1-1' /*São Paulo*/
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Engenheiro Coelho%' THEN '1-2' /*Engenheiro Coelho*/
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Teologia%' THEN '1-2' /*Engenheiro Coelho*/
			WHEN SPSPROCESSOSELETIVO.NOME LIKE '%Hortolândia%' THEN '1-3' /*Hortolândia*/
		ELSE CONVERT(VARCHAR, SPSPROCESSOSELETIVO.CODCOLIGADA)+'-'+CONVERT(VARCHAR,SPSPROCESSOSELETIVO.CODFILIAL) END END AS 'evento.codLocalOferta'    
    
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
LEFT JOIN FLAN (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.IDLAN = FLAN.IDLAN
	AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN = FLAN.CODCOLIGADA
LEFT JOIN SPSFORMAINSCRICAOPS(NOLOCK)
	ON SPSFORMAINSCRICAOPS.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSFORMAINSCRICAOPS.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSFORMAINSCRICAOPS.IDFORMAINSCRICAO = SPSINSCRICAOAREAOFERTADA.IDFORMAINSCRICAO
LEFT JOIN SPSLOCALETAPAINSCRITO(NOLOCK)
	ON SPSLOCALETAPAINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA 
	AND SPSLOCALETAPAINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS 
	AND SPSLOCALETAPAINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
LEFT JOIN SPSLOCAL(NOLOCK)
	ON SPSLOCALETAPAINSCRITO.IDLOCALPS = SPSLOCAL.IDLOCAL
LEFT JOIN SPSPREDIO(NOLOCK)
	ON SPSPREDIO.IDPREDIO = SPSLOCAL.IDPREDIO
LEFT JOIN SPSCAMPUS(NOLOCK)
	ON SPSCAMPUS.IDCAMPUS = SPSINSCRICAOAREAOFERTADA.IDCAMPUS
LEFT JOIN SCAMPUS(NOLOCK)
	ON SPSCAMPUS.NOME = SCAMPUS.DESCRICAO
LEFT JOIN SHABILITACAOFILIALCAMPUS(NOLOCK)
	ON SHABILITACAOFILIALCAMPUS.CODCAMPUS = SCAMPUS.CODCAMPUS 
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL
	
WHERE SPSPROCESSOSELETIVO.IDPS = :IDPS
AND SPSPROCESSOSELETIVO.CODCOLIGADA = :CODCOLIGADA
AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = :NUMEROINSCRICAO";3855;;;;26/07/2021;rubeus;0;1;1;1;;;;0;1df67c98-a08c-48f5-9698-5eab56af8db5;;;-16339;rubeus;12/05/2021;rubeus;26/07/2021;
S;RBPROVA;Consulta código da prova para execução online;"SELECT DISTINCT 
	BEXECPROVA.IDEXECPROVA AS CODPROVAONLINNE
FROM SPSOPCAOINSCRITO (NOLOCK)
INNER JOIN SPSINSCRICAOAREAOFERTADA (NOLOCK)
	ON	SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND	SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	AND	SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS		

INNER JOIN  SPSAREAOFERTADA (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSETAPAAREAOFERTADA.IDPS
	AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
	AND SPSETAPAAREAOFERTADA.ORDEMETAPA = 1

INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
	ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
	AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE
	AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
	AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA

INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
	ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
	AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
	AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO

INNER JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK) 
	ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSPROVAETAPAAREA.IDPS
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADAPROVA = SPSPROVAETAPAAREA.CODCOLIGADAPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	

INNER JOIN BEXECPROVA (NOLOCK) 
	ON BEXECPROVA.CODCOLIGADA = SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA
	AND BEXECPROVA.CODPROVA = SPSCONTROLEDISTRIBUICAOPROVA.CODPROVA
	AND BEXECPROVA.ID = SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA
	AND SPSCONTROLEDISTRIBUICAOPROVA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS

WHERE 
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.IDPS) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.NUMEROINSCRICAO) + '-' + CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) =:PARAM";2793;;;;12/05/2021;rubeus;0;1;1;1;;;;0;a5225d76-6dff-427e-9151-8a1de558f631;0;;32366;rubeus;10/05/2021;rubeus;12/05/2021;0
S;Rel_Edu_050;Dados ENADE;"SELECT 
1 Total,
SALUNO.RA,
PPESSOA.NOME,
SGRADE.DESCRICAO,

PPESSOA.CPF , 
SPESSOA.ANOULTIMAINST ANOEM,
SHABILITACAOALUNO.DTINGRESSO ,
SINSTITUICAOMEC.CODINEPINSTITUICAO INSTINEP, 
SCURSOMEC.CODINEPCURSO CURSOINEP,
SCURSOMEC.DESCURSOMEC DESCCRUSOINEP,
SGRADE.MAXCREDPERIODO,
SGRADE.CARGAHORARIA,
SGRADE.TOTALCREDITOS,
SHABILITACAOALUNO.CODCAMPUS CAMPUSEAD,
CASE WHEN SMATRICPL.SELINSTENADE = 'I' THEN 'Ingressante'
     WHEN SMATRICPL.SELINSTENADE = 'C' THEN 'Concluinte'
     WHEN SMATRICPL.SELINSTENADE = 'N' THEN 'Nenhum' END AS ENADE



FROM SMATRICPL
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND SHABILITACAOALUNO.RA = SMATRICPL.RA
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN SPESSOA ON SPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA  AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN STIPOMATRICULA ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT
INNER JOIN GFILIAL ON SMATRICPL.CODCOLIGADA = GFILIAL.CODCOLIGADA AND SMATRICPL.CODFILIAL = GFILIAL.CODFILIAL
INNER JOIN SINSTITUICAOMEC ON GFILIAL.CODFILIAL = SINSTITUICAOMEC.CODFILIAL
LEFT JOIN SCURSOMEC ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
INNER JOIN SCURSO ON SCURSO.CODCURSO = SGRADE.CODCURSO 
WHERE CODPERLET LIKE '%' + :PERIODOLETIVO + '%'
AND  SSTATUS.DESCRICAO  LIKE '%' + :STATUSALUNO + '%'
AND  STIPOMATRICULA.DESCRICAO =:TIPOMATRICULA
AND  SHABILITACAOFILIAL.CODTIPOCURSO =:TIPOCURSO
AND  SHABILITACAOFILIAL.CODFILIAL =:FILIAL
AND  SCURSO.NOME LIKE  '%' + :CURSO + '%'

order by PPESSOA.NOME

 ";2445;;;;19/08/2021;mestre;0;1;1;1;;;;0;4afce4c7-028a-436a-a493-86562dc4ec36;0;;4358;mestre;19/08/2021;mestre;19/08/2021;0
S;Rel_Edu003_1;Responsáveis financeiros;"SELECT CFOALUNO.NOME AS NOMERESPALUNO,
  CFOALUNO.CGCCFO AS CPFRESPALUNO,
  CFORESPCONTRATO.NOME AS NOMERESPCONTRATO,
  CFORESPCONTRATO.CGCCFO AS CPFRESPCONTRATO,
  SRESPONSAVELCONTRATO.PERCENTUAL
FROM SCONTRATO (NOLOCK) JOIN SALUNO (NOLOCK)
     ON (SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SCONTRATO.RA = SALUNO.RA)
  JOIN FCFO CFOALUNO (NOLOCK)
     ON (SALUNO.CODCOLCFO = CFOALUNO.CODCOLIGADA
         AND SALUNO.CODCFO = CFOALUNO.CODCFO)
  LEFT JOIN SRESPONSAVELCONTRATO (NOLOCK)
     ON (SCONTRATO.CODCOLIGADA = SRESPONSAVELCONTRATO.CODCOLIGADA
         AND SCONTRATO.IDPERLET = SRESPONSAVELCONTRATO.IDPERLET
         AND SCONTRATO.CODCONTRATO = SRESPONSAVELCONTRATO.CODCONTRATO
         AND SCONTRATO.RA = SRESPONSAVELCONTRATO.RA)
  LEFT JOIN FCFO CFORESPCONTRATO (NOLOCK)
     ON (SRESPONSAVELCONTRATO.CODCOLCFO = CFORESPCONTRATO.CODCOLIGADA
         AND SRESPONSAVELCONTRATO.CODCFO = CFORESPCONTRATO.CODCFO)
WHERE SCONTRATO.CODCOLIGADA = :P_CODCOLIGADA
  AND SCONTRATO.IDPERLET = :P_IDPERLET
  AND SCONTRATO.CODCONTRATO = :P_CODCONTRATO
  AND SCONTRATO.RA = :P_RA";;;;;;;0;1;1;1;;;;;135c1bd6-063e-4c60-a209-319ef659fbe0;;;-4338;mestre;01/02/2021;mestre;16/05/2021;
S;Rel_Edu004;Declaração de Matricula;"SELECT SMATRICPL.RA,
  SMATRICPL.IDPERLET,
  SMATRICPL.CODFILIAL,
  SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
  SPLETIVO.CODPERLET,
  SPLETIVO.DTFIM,
  SPLETIVO.DTINICIO,
  STURNO.NOME AS NOMETURNO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  PPESSOA.NOME AS NOMEALUNO,
  GFILIAL.CIDADE AS CIDADEFILIAL,
  GFILIAL.NUMERO AS NUMEROFILIAL,
  GFILIAL.CEP AS CEPFILIAL,
  GFILIAL.ESTADO AS ESTADOFILIAL,
  GFILIAL.TELEFONE AS TELEFONEFILIAL,
  GFILIAL.BAIRRO AS BAIRROFILIAL,
  GFILIAL.NOME AS NOMEFILIAL,
  GFILIAL.RUA AS RUAFILIAL,
  GIMAGEM.IMAGEM,
  PPESSOASEC1.NOME AS NOMESEC1,
  PPESSOASEC1.CARTIDENTIDADE AS CARTIDENTIDADESEC1
FROM SMATRICPL (NOLOCK) JOIN SHABILITACAOFILIAL (NOLOCK)
      ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
          AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   JOIN SHABILITACAO (NOLOCK)
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
          AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
          AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN SCURSO (NOLOCK)
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
          AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   JOIN STURNO (NOLOCK)
      ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
          AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   JOIN SPLETIVO (NOLOCK)
      ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
          AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)
   JOIN SALUNO (NOLOCK)
      ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
          AND SMATRICPL.RA = SALUNO.RA)
   JOIN PPESSOA (NOLOCK)
      ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
   JOIN GFILIAL (NOLOCK)
      ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
          AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
      ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   LEFT JOIN SFILIAL (NOLOCK)
      ON (GFILIAL.CODCOLIGADA = SFILIAL.CODCOLIGADA
          AND GFILIAL.CODFILIAL = SFILIAL.CODFILIAL)
   LEFT JOIN SDIRECAOFILIAL (NOLOCK)
      ON (SFILIAL.CODCOLIGADA = SDIRECAOFILIAL.CODCOLIGADA
          AND SFILIAL.CODFILIAL = SDIRECAOFILIAL.CODFILIAL)
   LEFT JOIN PPESSOA PPESSOASEC1 (NOLOCK)
      ON (SDIRECAOFILIAL.CODPESSOASEC1 = PPESSOASEC1.CODIGO)
   JOIN SSTATUS (NOLOCK)
      ON (SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA
          AND SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS)
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND SMATRICPL.CODFILIAL = :CODFILIAL_N
  AND SMATRICPL.RA BETWEEN :RADE_S AND :RAATE_S
  AND SPLETIVO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND SPLETIVO.ENCERRADO = 'N'
  AND SSTATUS.DIINCALUNODISC = 'S'
ORDER BY PPESSOA.NOME
";;;;;;;0;1;1;1;;;;;97a28003-28fa-4d37-86fe-7513bdcc7fae;;;27509;mestre;21/01/2021;mestre;21/01/2021;
S;Rel_Edu006;Livro de Matrícula;"SELECT SMATRICPL.NUMALUNO,
  SMATRICPL.CODCOLIGADA,
  SHABILITACAOFILIAL.CODFILIAL,
  SMATRICPL.RA,
  SMATRICPL.CODTURMA,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.IDPERLET,
  SPLETIVO.CODPERLET,
  PPESSOAALUNO.NOME AS NOMEALUNO,
  PPESSOAALUNO.NOMESOCIAL AS NOMESOCIALALUNO,
  SSTATUS.DESCRICAO AS NOMESITUACAOMATRICULA,
  PPESSOAALUNO.DTNASCIMENTO AS DTNASCIMENTO,
  PPESSOAALUNO.RUA,
  PPESSOAALUNO.NUMERO,
  PPESSOAALUNO.BAIRRO,
  PPESSOAALUNO.CIDADE,
  PPESSOAALUNO.EMAIL AS EMAILALUNO,
  PPESSOAALUNO.TELEFONE1 AS TELEFONE1ALUNO,
  PPESSOAPAI.EMAIL AS EMAILPAI,
  PPESSOAPAI.TELEFONE1 AS TELEFONE1PAI,
  PPESSOAPAI.NOME AS NOMEPAI,
  PPESSOAMAE.EMAIL AS EMAILMAE,
  PPESSOAMAE.TELEFONE1 AS TELEFONE1MAE,
  PPESSOAMAE.NOME AS NOMEMAE,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM
FROM SMATRICPL (NOLOCK) JOIN SALUNO (NOLOCK)
    ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
        AND SMATRICPL.RA = SALUNO.RA)
  JOIN PPESSOA PPESSOAALUNO (NOLOCK)
    ON (SALUNO.CODPESSOA = PPESSOAALUNO.CODIGO)
  JOIN SPLETIVO (NOLOCK)
    ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)
  JOIN SSTATUS (NOLOCK)
    ON (SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA
        AND SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS)
  JOIN SHABILITACAOFILIAL (NOLOCK)
    ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
        AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN STURNO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
  JOIN SCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN SHABILITACAO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
        AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)        
  JOIN GFILIAL (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)        
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND SHABILITACAOFILIAL.CODFILIAL = :CODFILIAL_N
  AND SPLETIVO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SPLETIVO.CODPERLET BETWEEN :CODPERLETDE_S AND :CODPERLETATE_S
  AND SMATRICPL.RA BETWEEN :RADE_S AND :RAATE_S
  AND SPLETIVO.ENCERRADO = 'N'
  AND SSTATUS.DIINCALUNODISC = 'S'";;;;;;;0;1;1;1;;;;;;;12.1;-19776;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu007;Requerimento de Matrícula;"SELECT 
  SALUNO.RA,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.DTNASCIMENTO AS DTNASCIMENTOALUNO,
  PPESSOA.NATURALIDADE AS NATURALIDADEALUNO,
  PPESSOA.ESTADONATAL AS ESTADONATALALUNO,
  PPESSOA.SEXO AS SEXOALUNO,
  PPESSOA.CARTIDENTIDADE AS CARTIDENTIDADEALUNO,
  PPESSOA.DTEMISSAOIDENT AS DTEMISSAOIDENTALUNO,
  PPESSOA.ORGEMISSORIDENT AS ORGEMISSORIDENTALUNO,
  PPESSOA.UFCARTIDENT AS UFCARTIDENTALUNO,
  PPESSOA.CPF AS CPFALUNO,
  PPESSOA.RUA AS RUAALUNO,
  PPESSOA.NUMERO AS NUMEROALUNO,
  PPESSOA.COMPLEMENTO AS COMPLEMENTOALUNO,
  PPESSOA.BAIRRO AS BAIRROALUNO,
  PPESSOA.CIDADE AS CIDADEALUNO,
  PPESSOA.ESTADO AS ESTADOALUNO,
  PPESSOA.CEP AS CEPALUNO,
  SPESSOA.CERTNUMERO AS CERTNUMEROALUNO,
  SPESSOA.CERTDATA AS CERTDATAALUNO,
  SPESSOA.CERTUF AS CERTUFALUNO,
  SPESSOA.CERTLIVRO AS CERTLIVROALUNO,
  SPESSOA.CERTFOLHA AS CERTFOLHAALUNO,
  SPESSOA.CERTCARTORIO AS CERTCARTORIOALUNO,
  PPESSOA.TELEFONE1 AS TELEFONE1ALUNO,
  PPESSOA.TELEFONE2 AS TELEFONE2ALUNO,
  PPESSOA.EMAIL AS EMAILALUNO,
  PPESSOARESPACAD.NOME AS NOMERESPACADEMICO,
  FCFO.NOME AS NOMERESPFINANCEIRO,
  SALUNOFICHAMEDICA.ALERGIA AS ALERGIAALUNO,
  SALUNOFICHAMEDICA.REMEDIO AS REMEDIOALUNO,
  SALUNOFICHAMEDICA.MEDICO AS MEDICOALUNO,
  SALUNOFICHAMEDICA.TRATAMENTO AS TRATAMENTOALUNO,
  SALUNOFICHAMEDICA.SOCHOSP AS SOCHOSPALUNO,
  SALUNOFICHAMEDICA.OUTRO AS OUTROALUNO,
  PPESSOA.DEFICIENTEVISUAL AS DEFICIENTEVISUALALUNO,
  PPESSOA.DEFICIENTEFISICO AS DEFICIENTEFISICOALUNO,
  PPESSOA.DEFICIENTEAUDITIVO AS DEFICIENTEAUDITIVOALUNO,
  PPESSOA.DEFICIENTEMENTAL AS DEFICIENTEMENTALALUNO,
  PCODNACAO.DESCRICAO AS NACIONALIDADEALUNO,

  PPESSOAPAI.NOME AS NOMEPAI,
  ESTCIVILPAI.DESCRICAO AS ESTADOCIVILPAI,
  PPESSOAPAI.DTNASCIMENTO AS DTNASCIMENTOPAI,
  PPESSOAPAI.NATURALIDADE AS NATURALIDADEPAI,
  PPESSOAPAI.ESTADONATAL AS ESTADONATALPAI,
  PPESSOAPAI.CARTIDENTIDADE AS CARTIDENTIDADEPAI,
  PPESSOAPAI.DTEMISSAOIDENT AS DTEMISSAOIDENTPAI,
  PPESSOAPAI.ORGEMISSORIDENT AS ORGEMISSORIDENTPAI,
  PPESSOAPAI.UFCARTIDENT AS UFCARTIDENTPAI,
  PPESSOAPAI.CPF AS CPFPAI,
  SPESSOAPAI.EMPRESARUA AS EMPRESARUAPAI,
  SPESSOAPAI.EMPRESACOMPLEMENTO AS EMPRESACOMPLEMENTOPAI,
  SPESSOAPAI.EMPRESABAIRRO AS EMPRESABAIRROPAI,
  SPESSOAPAI.EMPRESACIDADE AS EMPRESACIDADEPAI,
  SPESSOAPAI.EMPRESANUMERO AS EMPRESANUMEROPAI,
  SPESSOAPAI.EMPRESAUF AS EMPRESAESTADOPAI,
  SPESSOAPAI.EMPRESACEP AS EMPRESACEPPAI,
  PPESSOAPAI.TELEFONE1 AS TELEFONE1PAI,
  PPESSOAPAI.TELEFONE2 AS TELEFONE2PAI,
  PPESSOAPAI.EMAIL AS EMAILPAI,
  SPESSOAPAI.EMPRESANOME AS EMPRESAPAI,
  EPROFISSPAI.DESCRICAO AS PROFISSAOPAI,
  PCODNACAOPAI.DESCRICAO AS NACIONALIDADEPAI,
  
  PPESSOAMAE.NOME AS NOMEMAE,
  ESTCIVILMAE.DESCRICAO AS ESTADOCIVILMAE,
  PPESSOAMAE.DTNASCIMENTO AS DTNASCIMENTOMAE,
  PPESSOAMAE.NATURALIDADE AS NATURALIDADEMAE,
  PPESSOAMAE.ESTADONATAL AS ESTADONATALMAE,
  PPESSOAMAE.CARTIDENTIDADE AS CARTIDENTIDADEMAE,
  PPESSOAMAE.DTEMISSAOIDENT AS DTEMISSAOIDENTMAE,
  PPESSOAMAE.ORGEMISSORIDENT AS ORGEMISSORIDENTMAE,
  PPESSOAMAE.UFCARTIDENT AS UFCARTIDENTMAE,
  PPESSOAMAE.CPF AS CPFMAE,
  SPESSOAMAE.EMPRESARUA AS EMPRESARUAMAE,
  SPESSOAMAE.EMPRESACOMPLEMENTO AS EMPRESACOMPLEMENTOMAE,
  SPESSOAMAE.EMPRESABAIRRO AS EMPRESABAIRROMAE,
  SPESSOAMAE.EMPRESACIDADE AS EMPRESACIDADEMAE,
  SPESSOAMAE.EMPRESANUMERO AS EMPRESANUMEROMAE,
  SPESSOAMAE.EMPRESAUF AS EMPRESAESTADOMAE,
  SPESSOAMAE.EMPRESACEP AS EMPRESACEPMAE,
  PPESSOAMAE.TELEFONE1 AS TELEFONE1MAE,
  PPESSOAMAE.TELEFONE2 AS TELEFONE2MAE,
  PPESSOAMAE.EMAIL AS EMAILMAE,
  SPESSOAMAE.EMPRESANOME AS EMPRESAMAE,
  EPROFISSMAE.DESCRICAO AS PROFISSAOMAE,
  PCODNACAOMAE.DESCRICAO AS NACIONALIDADEMAE,
  
  SPLETIVO.CODPERLET,
  SHABILITACAOFILIAL.CODFILIAL,
  SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDPERLET,
  SMATRICPL.IDHABILITACAOFILIAL,
  GFILIAL.CIDADE AS CIDADEFILIAL,
  GFILIAL.NOME AS NOMEFILIAL,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO
  
FROM SALUNO (NOLOCK) JOIN SPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = SPESSOA.CODIGO)
  JOIN PPESSOA (NOLOCK)
     ON (SPESSOA.CODIGO = PPESSOA.CODIGO)
  LEFT JOIN PPESSOA PPESSOARESPACAD (NOLOCK)
     ON (SALUNO.CODPESSOARACA = PPESSOARESPACAD.CODIGO)
  LEFT JOIN FCFO (NOLOCK)
     ON (SALUNO.CODCOLCFO = FCFO.CODCOLIGADA
         AND SALUNO.CODCFO = FCFO.CODCFO)
  LEFT JOIN SALUNOFICHAMEDICA (NOLOCK)
     ON (SALUNO.CODCOLIGADA = SALUNOFICHAMEDICA.CODCOLIGADA
         AND SALUNO.RA = SALUNOFICHAMEDICA.RA)
  LEFT JOIN PCODNACAO (NOLOCK)
     ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN PCODESTCIVIL ESTCIVILPAI (NOLOCK)
     ON (PPESSOAPAI.ESTADOCIVIL = ESTCIVILPAI.CODCLIENTE)
  LEFT JOIN SPESSOA SPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = SPESSOAPAI.CODIGO)
  LEFT JOIN PCODNACAO PCODNACAOPAI (NOLOCK)
     ON (PPESSOAPAI.NACIONALIDADE = PCODNACAOPAI.CODCLIENTE)  
  LEFT JOIN EPROFISS EPROFISSPAI (NOLOCK)
     ON (PPESSOAPAI.CODPROFISSAO = EPROFISSPAI.CODCLIENTE)     
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  LEFT JOIN PCODESTCIVIL ESTCIVILMAE (NOLOCK)
     ON (PPESSOAMAE.ESTADOCIVIL = ESTCIVILMAE.CODCLIENTE)     
  LEFT JOIN SPESSOA SPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = SPESSOAMAE.CODIGO)
  LEFT JOIN PCODNACAO PCODNACAOMAE (NOLOCK)
     ON (PPESSOAMAE.NACIONALIDADE = PCODNACAOMAE.CODCLIENTE)     
  LEFT JOIN EPROFISS EPROFISSMAE (NOLOCK)
     ON (PPESSOAMAE.CODPROFISSAO = EPROFISSMAE.CODCLIENTE)
  JOIN SMATRICPL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICPL.RA = SALUNO.RA)
  JOIN SPLETIVO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)
  JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN GFILIAL (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)         
  JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
  JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)     
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND SHABILITACAOFILIAL.CODFILIAL = :CODFILIAL_N
  AND SPLETIVO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SMATRICPL.RA BETWEEN :RADE_S AND :RAATE_S
ORDER BY 
  SMATRICPL.CODCOLIGADA,
  SMATRICPL.CODFILIAL,
  SMATRICPL.IDPERLET,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.RA
";;;;;;;0;1;1;1;;;;;bd2f0c5c-4f39-4349-a82f-e731ad9a359f;;;-26191;mestre;21/01/2021;mestre;21/01/2021;
S;Rel_Edu008;Ata de Resultado Final;"SELECT SPLETIVO.CODPERLET,
  STURMA.CODTURMA,
  STURMA.CODCOLIGADA,
  STURMA.CODFILIAL,
  STURMA.IDPERLET,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  STURNO.NOME AS NOMETURNO,
  SGRADE.DESCRICAO AS NOMEGRADE,
  STIPOCURSO.APRESENTACAO,
  SHABILITACAOFILIAL.CODGRADE
FROM STURMA (NOLOCK) JOIN SPLETIVO (NOLOCK)
    ON (STURMA.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND STURMA.IDPERLET = SPLETIVO.IDPERLET)
  JOIN GFILIAL (NOLOCK)
    ON (STURMA.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND STURMA.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
  LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
    ON (STURMA.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
        AND STURMA.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  LEFT JOIN SCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  LEFT JOIN SHABILITACAO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
        AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  LEFT JOIN STURNO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
  LEFT JOIN SGRADE (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
        AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
        AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE)
  JOIN STIPOCURSO (NOLOCK)
    ON (STURMA.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
        AND STURMA.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
WHERE STURMA.CODCOLIGADA = :CODCOLIGADA_N
  AND STURMA.CODFILIAL = :CODFILIAL_N
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND STURMA.CODTURMA BETWEEN :CODTURMADE_S AND :CODTURMAATE_S
ORDER BY STURMA.CODCOLIGADA,
  STURMA.CODFILIAL,
  STURMA.IDPERLET,  
  STURMA.CODTURMA
  

  ";;;;;;;0;1;1;1;;;;;;;12.1;-7751;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu0083_1;Assinatura Contrato;"SELECT GFILIAL.CGC,
       GFILIAL.NOME,
       GFILIAL.RUA,
       GFILIAL.NUMERO,
	   GIMAGEM.IMAGEM,
	   SGRADE.DESCRICAO DESCRICAOGRADE,
	   SCURSO.NOME NOMECURSO,
	   SHABILITACAO.NOME NOMEHABILITACAO,
	   SPLETIVO.CODPERLET,
	   SASSINATURACONTRATO.GUID,
	   SASSINATURACONTRATO.TOKEN,
       SASSINATURACONTRATO.EMAIL,
	   SASSINATURACONTRATO.CLIENTIP,
       SASSINATURACONTRATO.DATAHORAENVIOEMAIL,
       SASSINATURACONTRATO.DATAHORAASSINATURA,
       SASSINATURACONTRATO.CODCONTRATO,
       CASE
	     WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.NOME
	     ELSE FCFO.NOMEFANTASIA
       END RESPONSAVEL,
	   CASE
	     WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.CPF
	     ELSE FCFO.CGCCFO
       END CPF
FROM SHABILITACAOALUNO (NOLOCK)
     JOIN SHABILITACAOFILIAL (NOLOCK)
       ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
       AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL)
     JOIN GFILIAL (NOLOCK)
       ON (GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	   AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)
     LEFT JOIN GIMAGEM (NOLOCK)
       ON (GIMAGEM.ID = GFILIAL.IDIMAGEM)
     JOIN SGRADE (NOLOCK)
       ON (SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	   AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	   AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	   AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE)
     JOIN SCURSO (NOLOCK)
	   ON (SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	   AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO)
     JOIN SHABILITACAO (NOLOCK)
	   ON (SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	   AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	   AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO)
     JOIN SPLETIVO (NOLOCK)
       ON (SPLETIVO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
       AND SPLETIVO.IDPERLET = :IDPERLET)
     LEFT JOIN SASSINATURACONTRATO (NOLOCK)
	   ON (SASSINATURACONTRATO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
       AND SASSINATURACONTRATO.RA = SHABILITACAOALUNO.RA
       AND SASSINATURACONTRATO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
       AND SASSINATURACONTRATO.IDPERLET = SPLETIVO.IDPERLET)
     LEFT JOIN PPESSOA (NOLOCK)
       ON (SASSINATURACONTRATO.CODPESSOA = PPESSOA.CODIGO)
     LEFT JOIN FCFO (NOLOCK)
       ON (SASSINATURACONTRATO.CODCOLIGADACFO = FCFO.CODCOLIGADA
       AND SASSINATURACONTRATO.CODCFO = FCFO.CODCFO)
WHERE SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA
  AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
  AND SHABILITACAOALUNO.RA = :RA
ORDER BY
	  SASSINATURACONTRATO.DATAHORAASSINATURA DESC";;;;;;;0;1;1;1;;;;;4d8c5332-9644-462a-a258-ed2fb7968cc2;;;-22992;robson.canto;28/12/2021;robson.canto;29/12/2021;
S;Rel_Edu009;Ficha individual do aluno;"SELECT 
  SALUNO.RA,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  PPESSOA.RUA, 
  PPESSOA.COMPLEMENTO,
  PPESSOA.BAIRRO,
  PPESSOA.NUMERO,
  PPESSOA.CIDADE,
  PPESSOA.ESTADO,
  PPESSOA.TELEFONE1,
  PPESSOA.CPF,
  PPESSOA.CARTIDENTIDADE,
  PPESSOA.CEP,
  SPLETIVO.CODPERLET,
  STURNO.NOME AS NOMETURNO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  SMATRICPL.CODTURMA,
  SHABILITACAOFILIAL.CODGRADE,
  IMGALUNO.IMAGEM IMAGEMALUNO,
  GFILIAL.NOME AS NOMEFILIAL,
  IMGFILIAL.IMAGEM IMAGEMFILIAL,
  SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.IDPERLET,
  SHABILITACAOFILIAL.CODFILIAL,
  STIPOCURSO.APRESENTACAO
FROM SALUNO (NOLOCK) JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
  JOIN SMATRICPL (NOLOCK)
     ON (SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
         AND SALUNO.RA = SMATRICPL.RA)
  JOIN SPLETIVO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)
  JOIN STIPOCURSO (NOLOCK)
     ON (SPLETIVO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND SPLETIVO.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)         
  JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN GFILIAL (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM IMGFILIAL (NOLOCK)
     ON (GFILIAL.IDIMAGEM = IMGFILIAL.ID)
  LEFT JOIN GIMAGEM IMGALUNO (NOLOCK)
     ON (PPESSOA.IDIMAGEM = IMGALUNO.ID)  
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND SHABILITACAOFILIAL.CODFILIAL = :CODFILIAL_N
  AND SMATRICPL.RA BETWEEN :RADE_S AND :RAATE_S
  AND SPLETIVO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL_N
  AND SPLETIVO.CODPERLET = :CODPERLET_S";2546;;;;28/07/2021;mestre;0;1;1;1;;;;;dffc572f-4118-4cb5-a2e7-62c03399dd24;;;-4948;mestre;27/07/2021;mestre;28/07/2021;
S;Rel_Edu010;Diploma - Ensino Básico;"SELECT PPESSOA.NOME NOMEALUNO,
  PPESSOA.NACIONALIDADE,
  PCODNACAO.DESCRICAO NOMENACIONALIDADE,
  PPESSOA.CARTIDENTIDADE,
  PPESSOA.CPF,
  PPESSOA.DTEMISSAOIDENT,
  PPESSOA.CIDADE,
  PPESSOA.ESTADO,
  PPESSOA.DTNASCIMENTO,
  PPESSOA.ORGEMISSORIDENT,
  PPESSOAPAI.NOME NOMEPAI,
  PPESSOAMAE.NOME NOMEMAE,
  GFILIAL.NOME NOMEFILIAL,
  GFILIAL.CIDADE CIDADEFILIAL,
  GFILIAL.RUA RUAFILIAL,
  GFILIAL.COMPLEMENTO COMPLEMENTOFILIAL,
  GFILIAL.BAIRRO BAIRROFILIAL,
  GFILIAL.NUMERO NUMEROFILIAL,
  GFILIAL.ESTADO ESTADOFILIAL,
  SCURSO.NOME NOMECURSO,
  SHABILITACAOFILIAL.DECRETOCURSO DECRETO,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.IDPERLET,
  SMATRICPL.CODCOLIGADA,
  SMATRICPL.RA,
  SHABILITACAOFILIAL.CODFILIAL
FROM SALUNO (NOLOCK)
  JOIN PPESSOA (NOLOCK)
    ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
  JOIN SMATRICPL (NOLOCK)
    ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
        AND SMATRICPL.RA = SALUNO.RA)     
  JOIN SHABILITACAOFILIAL (NOLOCK)
    ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
        AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN SCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN GFILIAL (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  LEFT JOIN PCODNACAO (NOLOCK)
    ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)  
  JOIN SPLETIVO (NOLOCK)
    ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND SHABILITACAOFILIAL.CODFILIAL = :CODFILIAL_N
  AND SMATRICPL.IDHABILITACAOFILIAL BETWEEN :IDHABILITACAOFILIALDE_N AND :IDHABILITACAOFILIALATE_N
  AND SPLETIVO.CODPERLET BETWEEN :CODPERLETDE_S AND :CODPERLETATE_S";;;;;;;0;1;1;1;;;;;0127e8f2-93a8-4171-9d91-730eb1624060;;;29731;mestre;28/07/2021;mestre;28/07/2021;
S;Rel_Edu011;Declaração de presença;"SELECT PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.CARTIDENTIDADE,
  PPESSOA.DTEMISSAOIDENT,
  SALUNO.RA,
  GFILIAL.NOME AS NOMEFILIAL,
  GFILIAL.RUA,
  GFILIAL.COMPLEMENTO,
  GFILIAL.BAIRRO,
  GFILIAL.TELEFONE,
  GFILIAL.CIDADE,
  GFILIAL.ESTADO,
  GFILIAL.CEP,
  GFILIAL.NUMERO,
  GIMAGEM.IMAGEM,
  SPLETIVO.CODPERLET,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SMATRICPL.CODTURMA,
  STIPOCURSO.APRESENTACAO,
  SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDPERLET,
  SMATRICPL.IDHABILITACAOFILIAL
FROM SALUNO (NOLOCK) JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
  JOIN SMATRICPL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICPL.RA = SALUNO.RA)
  JOIN SPLETIVO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)
  JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN GFILIAL (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
  JOIN STIPOCURSO (NOLOCK)
    ON (SHABILITACAOFILIAL.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
        AND SHABILITACAOFILIAL.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N 
  AND SHABILITACAOFILIAL.CODFILIAL = :CODFILIAL_N
  AND SHABILITACAOFILIAL.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SMATRICPL.RA = :RA_S
  AND (:EXCLUIRPLENCERRADO_S = 'N' OR  SPLETIVO.ENCERRADO = 'N')
ORDER BY SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.IDPERLET,
  SMATRICPL.RA";;;;;;;0;1;1;1;;;;;68e6d336-415e-41af-8e2b-cafe4fa0b48f;;;-13990;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu013;Diário de Classe;"SELECT 
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.CODTIPOCURSO,
  STURMADISC.ATIVA,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODDISC,
  STURMADISC.CODTURMA,
  SPROFESSOR.CODPROF,
  PPESSOAPROFESSOR.NOME AS NOMEPROFESSOR,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA,
  SDISCIPLINA.CH,
  SPLETIVO.CODPERLET,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SMATRICULA.RA,
  SMATRICULA.NUMDIARIO,
  PPESSOAALUNO.NOME AS NOMEALUNO,
  PPESSOAALUNO.NOMESOCIAL AS NOMESOCIALALUNO,
  STIPOCURSO.APRESENTACAO,
  SPROFESSORTURMA.IDPROFESSORTURMA,
  SPARAMNUMCASASCH.INTEIRO NUMCASASDECCH
FROM STURMADISC (NOLOCK) JOIN SPROFESSORTURMA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)
   JOIN SPROFESSOR (NOLOCK)
     ON (SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
         AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF)
   JOIN PPESSOA PPESSOAPROFESSOR(NOLOCK)
     ON (SPROFESSOR.CODPESSOA = PPESSOAPROFESSOR.CODIGO)
   JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN SMATRICULA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA 
         AND SMATRICULA.RA = SALUNO.RA)
   JOIN PPESSOA PPESSOAALUNO (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOAALUNO.CODIGO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA  = STIPOCURSO.CODCOLIGADA AND
         STURMADISC.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   LEFT JOIN SPARAM SPARAMNUMCASASCH (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAMNUMCASASCH.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAMNUMCASASCH.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAMNUMCASASCH.CODTIPOCURSO AND
         SPARAMNUMCASASCH.ID = 'NUMCASASDECCH')
WHERE STURMADISC.CODCOLIGADA = :CODCOLIGADA_N AND
  STURMADISC.CODFILIAL = :CODFILIAL_N AND
  STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N AND
  STURMADISC.ATIVA = 'S' AND
  SSTATUS.DIINCALUNODISC = 'S' AND
  SSTATUS.PLDIARIO = 'S' AND
  SPLETIVO.ENCERRADO = 'N' AND
  SPROFESSORTURMA.CODPROF BETWEEN :CODPROFDE_S AND :CODPROFATE_S AND
  STURMADISC.IDTURMADISC BETWEEN :IDTURMADISCDE_N AND :IDTURMADISCATE_N
ORDER BY STURMADISC.IDTURMADISC, SPROFESSORTURMA.CODPROF";;;;;;;0;1;1;1;;;;;dc3b3842-a2a3-4fad-8201-7e8e93585c9c;;;-19446;mestre;27/07/2021;raphael.muzy;06/12/2021;
S;Rel_Edu013.2;Diário de Classe;"SELECT 
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.CODTIPOCURSO,
  STURMADISC.ATIVA,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODDISC,
  STURMADISC.CODTURMA,
  SPROFESSOR.CODPROF,
  PPESSOAPROFESSOR.NOME AS NOMEPROFESSOR,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA,
  SDISCIPLINA.CH,
  SPLETIVO.CODPERLET,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SMATRICULA.RA,
  SMATRICULA.NUMDIARIO,
  PPESSOAALUNO.NOME AS NOMEALUNO,
  PPESSOAALUNO.NOMESOCIAL AS NOMESOCIALALUNO,
  STIPOCURSO.APRESENTACAO,
  SPROFESSORTURMA.IDPROFESSORTURMA,
  SPARAMNUMCASASCH.INTEIRO NUMCASASDECCH
FROM STURMADISC (NOLOCK) JOIN SPROFESSORTURMA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)
   LEFT JOIN SPROFESSOR (NOLOCK)
     ON (SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
         AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF)
   LEFT JOIN PPESSOA PPESSOAPROFESSOR(NOLOCK)
     ON (SPROFESSOR.CODPESSOA = PPESSOAPROFESSOR.CODIGO)
   JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN SMATRICULA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA 
         AND SMATRICULA.RA = SALUNO.RA)
   JOIN PPESSOA PPESSOAALUNO (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOAALUNO.CODIGO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA  = STIPOCURSO.CODCOLIGADA AND
         STURMADISC.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   LEFT JOIN SPARAM SPARAMNUMCASASCH (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAMNUMCASASCH.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAMNUMCASASCH.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAMNUMCASASCH.CODTIPOCURSO AND
         SPARAMNUMCASASCH.ID = 'NUMCASASDECCH')
WHERE STURMADISC.CODCOLIGADA = :CODCOLIGADA_N AND
  /*STURMADISC.ATIVA = 'S' AND
  SSTATUS.DIINCALUNODISC = 'S' AND
  SSTATUS.PLDIARIO = 'S' AND
  SPLETIVO.ENCERRADO = 'N' AND */ 
  STURMADISC.IDTURMADISC = :IDTURMADISC_N
ORDER BY STURMADISC.CODCOLIGADA, 
  STURMADISC.IDTURMADISC, 
  SPROFESSORTURMA.IDPROFESSORTURMA, 
  SMATRICULA.NUMDIARIO";3736;;;;29/09/2021;raphael.muzy;0;1;1;1;;;;;6aee9f88-6122-43b7-8b4f-741cc1d37749;;;13950;raphael.muzy;29/09/2021;raphael.muzy;29/09/2021;
S;Rel_Edu014;Lista de classe (assinaturas) - por turma;"SELECT STURMA.CODCOLIGADA,
  STURMA.IDHABILITACAOFILIAL,
  STURMA.IDPERLET,
  SMATRICPL.RA,
  SMATRICPL.CODSTATUS,
  SMATRICPL.NUMALUNO AS NUMDIARIO,
  STURMA.CODTURMA,
  SSTATUS.DESCRICAO AS NOMESTATUS,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  SPLETIVO.CODPERLET,
  STIPOCURSO.APRESENTACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM
FROM STURMA (NOLOCK) LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMA.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMA.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN GFILIAL (NOLOCK)
     ON (STURMA.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMA.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMA.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND STURMA.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   JOIN SMATRICPL (NOLOCK)
     ON (STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
         AND STURMA.CODFILIAL = SMATRICPL.CODFILIAL
         AND STURMA.IDPERLET = SMATRICPL.IDPERLET
         AND STURMA.CODTURMA = SMATRICPL.CODTURMA)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMA.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMA.IDPERLET = SPLETIVO.IDPERLET)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICPL.RA = SALUNO.RA)
   JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)         
WHERE STURMA.CODCOLIGADA = :CODCOLIGADA_N
  AND STURMA.CODFILIAL = :CODFILIAL_N
  AND STURMA.CODTURMA BETWEEN :CODTURMADE_S AND :CODTURMAATE_S
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND SSTATUS.DIINCALUNODISC = 'S'
ORDER BY STURMA.CODCOLIGADA,
  STURMA.IDHABILITACAOFILIAL,
  STURMA.IDPERLET,
  STURMA.CODTURMA,
  SMATRICPL.NUMALUNO,
  PPESSOA.NOME   ";;;;;;;0;1;1;1;;;;;;;12.1;24856;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu015;Lista de Classe (assinaturas) por turma/discplina;"SELECT STURMADISC.CODCOLIGADA,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDPERLET,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODDISC,
  SMATRICULA.RA,
  SMATRICULA.NUMDIARIO,
  SMATRICULA.CODSTATUS,
  STURMADISC.CODTURMA,
  SSTATUS.DESCRICAO AS NOMESTATUS,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  SPLETIVO.CODPERLET,
  STIPOCURSO.APRESENTACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA
FROM STURMADISC (NOLOCK) LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND STURMADISC.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   JOIN SMATRICULA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICULA.RA = SALUNO.RA)
   JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)       
   JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
WHERE STURMADISC.CODCOLIGADA = :CODCOLIGADA_N
  AND STURMADISC.CODFILIAL = :CODFILIAL_N
  AND STURMADISC.IDTURMADISC BETWEEN :IDTURMADISCDE_N AND :IDTURMADISCATE_N
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND SSTATUS.DIINCALUNODISC = 'S'
ORDER BY STURMADISC.CODCOLIGADA,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDPERLET,
  STURMADISC.IDTURMADISC,
  SMATRICULA.NUMDIARIO,
  PPESSOA.NOME   ";;;;;;;0;1;1;1;;;;;;;12.1;-18718;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu016;Relação de alunos matriculados por curso/habilitacao/turno;"SELECT SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.IDPERLET,
  SMATRICPL.RA,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  SPLETIVO.CODPERLET,
  STIPOCURSO.APRESENTACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SHABILITACAOFILIAL.CODCURSO
FROM SMATRICPL (NOLOCK) JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN GFILIAL (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   JOIN SPLETIVO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)    
   JOIN STIPOCURSO (NOLOCK)
     ON (SPLETIVO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND SPLETIVO.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICPL.RA = SALUNO.RA)
   JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)         
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND SHABILITACAOFILIAL.CODFILIAL = :CODFILIAL_N
  AND SHABILITACAOFILIAL.CODCURSO BETWEEN :CODCURSODE_S AND :CODCURSOATE_S
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND SSTATUS.DIINCALUNODISC = 'S'
ORDER BY SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.IDPERLET,
  PPESSOA.NOME   ";;;;;;;0;1;1;1;;;;;;;12.1;1989;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu017;Relação de professores por turma/disciplina;"SELECT 
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.CODTIPOCURSO,
  STURMADISC.ATIVA,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODDISC,
  STURMADISC.CODTURMA,
  STURMADISC.IDPERLET,
  STURMADISC.IDHABILITACAOFILIAL,
  SPROFESSOR.CODPROF,
  PPESSOA.NOME AS NOMEPROFESSOR,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA,
  SPROFESSORFILIAL.CHAPA,
  SPLETIVO.CODPERLET,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  STIPOCURSO.APRESENTACAO
FROM STURMADISC (NOLOCK) JOIN SPROFESSORTURMA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)
   JOIN SPROFESSOR (NOLOCK)
     ON (SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
         AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF)
   JOIN PPESSOA (NOLOCK)
     ON (SPROFESSOR.CODPESSOA = PPESSOA.CODIGO)
   JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
   LEFT JOIN SPROFESSORFILIAL (NOLOCK)
     ON (SPROFESSOR.CODCOLIGADA = SPROFESSORFILIAL.CODCOLIGADA
         AND SPROFESSOR.CODPROF = SPROFESSORFILIAL.CODPROF
         AND STURMADISC.CODFILIAL = SPROFESSORFILIAL.CODFILIAL
         AND SPROFESSORFILIAL.ATIVO = 'S')
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND STURMADISC.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
WHERE STURMADISC.CODCOLIGADA = :CODCOLIGADA_N AND
  STURMADISC.CODFILIAL = :CODFILIAL_N AND
  STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N AND
  STURMADISC.IDTURMADISC BETWEEN :IDTURMADISCDE_N AND :IDTURMADISCATE_N
ORDER BY STURMADISC.CODCOLIGADA, 
  STURMADISC.IDPERLET, 
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDTURMADISC,
  NOMEPROFESSOR";;;;;;;0;1;1;1;;;;;;;12.1;18501;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu018;Dados do Aluno Analise Curricular;"SELECT 
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.NOME AS 'CURSO',
	SHABILITACAO.NOME AS 'HABILITACAO',
	STURNO.NOME AS 'TURNO',
	SGRADE.DESCRICAO AS 'GRADE',
	SSTATUS.DESCRICAO AS 'STATUS ALUNO',
	SMATRICPL.RA
FROM SMATRICPL
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN STURNO ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SCURSO.CODCURSO = SGRADE.CODCURSO
INNER JOIN SHABILITACAO ON SHABILITACAO.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHABILITACAO.CODCURSO = SGRADE.CODCURSO
	AND SHABILITACAO.CODHABILITACAO = SGRADE.CODHABILITACAO
	
WHERE 
  SMATRICPL.CODCOLIGADA = :CODCOLIGADA
  AND SMATRICPL.IDPERLET= :IDPERLET
  AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
  AND SMATRICPL.RA = :RA";1700;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;0;71451446-df14-4744-b2fc-6caa87145236;0;;29907;consultor1.totvs;18/08/2022;consultor1.totvs;22/08/2022;0
S;Rel_Edu018_1;Análise Curricular - Aproveitamento de Estudos;"SELECT 
  SHISTDISCAPROVESTUDOSORIGEM.CODDISC, 
  SHISTDISCAPROVESTUDOSORIGEM.DISCIPLINA, 
  SHISTDISCAPROVESTUDOSORIGEM.STATUS, 
  SHISTDISCAPROVESTUDOSORIGEM.PLETIVO, 
  SHISTDISCAPROVESTUDOSORIGEM.NOTA, 
  SHISTDISCAPROVESTUDOSORIGEM.FALTAS, 
  SHISTDISCAPROVESTUDOSORIGEM.CH,
  SHISTDISCAPROVESTUDOSORIGEM.NUMCREDITOS,
  SHISTDISCAPROVESTUDOSORIGEM.CONCEITO,
  SHISTDISCAPROVESTUDOSORIGEM.CONCEITOECTS
FROM 
  SHISTDISCAPROVESTUDOSORIGEM (NOLOCK)
WHERE
  SHISTDISCAPROVESTUDOSORIGEM.CODCOLIGADA = :P_CODCOLIGADA AND
  SHISTDISCAPROVESTUDOSORIGEM.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL AND
  SHISTDISCAPROVESTUDOSORIGEM.RA = :P_RA AND
  SHISTDISCAPROVESTUDOSORIGEM.CODDISCAPROV = :P_CODDISC";;;;;;;0;1;1;1;;;;;86f1d333-d23b-4697-b527-f652e7292aa7;;;6513;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu018_1.1;Análise Curricular - Aproveitamento de Estudos;"SELECT 
  SHISTDISCAPROVESTUDOSORIGEM.CODDISC, 
  SHISTDISCAPROVESTUDOSORIGEM.DISCIPLINA, 
  SHISTDISCAPROVESTUDOSORIGEM.STATUS, 
  SHISTDISCAPROVESTUDOSORIGEM.PLETIVO, 
  SHISTDISCAPROVESTUDOSORIGEM.NOTA, 
  SHISTDISCAPROVESTUDOSORIGEM.FALTAS, 
  SHISTDISCAPROVESTUDOSORIGEM.CH,
  SHISTDISCAPROVESTUDOSORIGEM.NUMCREDITOS,
  SHISTDISCAPROVESTUDOSORIGEM.CONCEITO,
  SHISTDISCAPROVESTUDOSORIGEM.CONCEITOECTS
FROM 
  SHISTDISCAPROVESTUDOSORIGEM (NOLOCK)
WHERE
  SHISTDISCAPROVESTUDOSORIGEM.CODCOLIGADA = :CODCOLIGADA AND
  SHISTDISCAPROVESTUDOSORIGEM.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL AND
  SHISTDISCAPROVESTUDOSORIGEM.RA = :RA AND
  SHISTDISCAPROVESTUDOSORIGEM.CODDISCAPROV = :P_CODDISC";710;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;;86f1d333-d23b-4697-b527-f652e7292aa7;;;-16922;consultor1.totvs;22/08/2022;consultor1.totvs;22/08/2022;
S;Rel_Edu018_2;Análise Curricular - Disciplinas Equivalentes;"SELECT SHISTDISCEQUIVCONCLUIDAS.CODDISC,
  SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA,
  SHISTDISCEQUIVCONCLUIDAS.PLETIVO,
  SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS,
  SHISTDISCEQUIVCONCLUIDAS.CH,
  SHISTDISCEQUIVCONCLUIDAS.FALTAS,
  SHISTDISCEQUIVCONCLUIDAS.NOTA,
  SHISTDISCEQUIVCONCLUIDAS.STATUS,
  SHISTDISCEQUIVCONCLUIDAS.CONCEITO,
  SHISTDISCEQUIVCONCLUIDAS.CONCEITOECTS,
  'CONC' AS TIPO
FROM SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = :P_CODCOLIGADA AND
  SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL AND
  SHISTDISCEQUIVCONCLUIDAS.RA = :P_RA AND
  SHISTDISCEQUIVCONCLUIDAS.GREQUIV = :P_GREQUIV 
UNION  
SELECT SHISTDISCEQUIVEMCURSO.CODDISC,
  SHISTDISCEQUIVEMCURSO.DISCIPLINA,
  SHISTDISCEQUIVEMCURSO.PLETIVO,
  SHISTDISCEQUIVEMCURSO.NUMCREDITOS,
  SHISTDISCEQUIVEMCURSO.CH,
  SHISTDISCEQUIVEMCURSO.FALTAS,
  SHISTDISCEQUIVEMCURSO.NOTA,
  SHISTDISCEQUIVEMCURSO.STATUS,
  SHISTDISCEQUIVEMCURSO.CONCEITO,
  SHISTDISCEQUIVEMCURSO.CONCEITOECTS,
  'PEND' AS TIPO
FROM SHISTDISCEQUIVEMCURSO (NOLOCK)
WHERE SHISTDISCEQUIVEMCURSO.CODCOLIGADA = :P_CODCOLIGADA AND
  SHISTDISCEQUIVEMCURSO.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL AND
  SHISTDISCEQUIVEMCURSO.RA = :P_RA AND
  SHISTDISCEQUIVEMCURSO.GREQUIV = :P_GREQUIV";;;;;;;0;1;1;1;;;;;1479bb13-2566-4bf1-823b-5268f497c0ea;;;20625;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu018_2.1;Análise Curricular - Disciplinas Equivalentes;"SELECT SHISTDISCEQUIVCONCLUIDAS.CODDISC,
  SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA,
  SHISTDISCEQUIVCONCLUIDAS.PLETIVO,
  SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS,
  SHISTDISCEQUIVCONCLUIDAS.CH,
  SHISTDISCEQUIVCONCLUIDAS.FALTAS,
  SHISTDISCEQUIVCONCLUIDAS.NOTA,
  SHISTDISCEQUIVCONCLUIDAS.STATUS,
  SHISTDISCEQUIVCONCLUIDAS.CONCEITO,
  SHISTDISCEQUIVCONCLUIDAS.CONCEITOECTS,
  'CONC' AS TIPO
FROM SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = :CODCOLIGADA AND
  SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL AND
  SHISTDISCEQUIVCONCLUIDAS.RA = :RA AND
  SHISTDISCEQUIVCONCLUIDAS.GREQUIV = :P_GREQUIV 
UNION  
SELECT SHISTDISCEQUIVEMCURSO.CODDISC,
  SHISTDISCEQUIVEMCURSO.DISCIPLINA,
  SHISTDISCEQUIVEMCURSO.PLETIVO,
  SHISTDISCEQUIVEMCURSO.NUMCREDITOS,
  SHISTDISCEQUIVEMCURSO.CH,
  SHISTDISCEQUIVEMCURSO.FALTAS,
  SHISTDISCEQUIVEMCURSO.NOTA,
  SHISTDISCEQUIVEMCURSO.STATUS,
  SHISTDISCEQUIVEMCURSO.CONCEITO,
  SHISTDISCEQUIVEMCURSO.CONCEITOECTS,
  'PEND' AS TIPO
FROM SHISTDISCEQUIVEMCURSO (NOLOCK)
WHERE SHISTDISCEQUIVEMCURSO.CODCOLIGADA = :CODCOLIGADA AND
  SHISTDISCEQUIVEMCURSO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL AND
  SHISTDISCEQUIVEMCURSO.RA = :RA AND
  SHISTDISCEQUIVEMCURSO.GREQUIV = :P_GREQUIV";1291;;;;23/08/2022;consultor1.totvs;0;1;1;1;;;;;1479bb13-2566-4bf1-823b-5268f497c0ea;;;-28389;consultor1.totvs;23/08/2022;consultor1.totvs;23/08/2022;
S;Rel_Edu018_3;Análise Curricular - Disciplinas do aluno;"SELECT ANALISECURRICULAR.CODDISC,
       ANALISECURRICULAR.DISCIPLINA,
       ISNULL(ANALISECURRICULAR.STATUS, 'A Cursar') as STATUS,
       ANALISECURRICULAR.PLETIVO,
       ANALISECURRICULAR.NUMCREDITOS,
       ANALISECURRICULAR.CH,
       ANALISECURRICULAR.NOTA,
       ANALISECURRICULAR.FALTAS,
       ANALISECURRICULAR.TIPO,
       ANALISECURRICULAR.CODCOLIGADA,
       ANALISECURRICULAR.IDHABILITACAOFILIAL,
       ANALISECURRICULAR.RA,
       ANALISECURRICULAR.GREQUIV,
       ANALISECURRICULAR.CODPERIODO,
       ANALISECURRICULAR.CONCEITO,
       ANALISECURRICULAR.CONCEITOECTS,
       ANALISECURRICULAR.MINCH,
       ANALISECURRICULAR.MINCREDITOS,
       ANALISECURRICULAR.MINDISCIPLINAS,
       ANALISECURRICULAR.NOME,
       ANALISECURRICULAR.TIPOAVALIACAO,
       CASE WHEN ANALISECURRICULAR.NOTA IS NULL THEN NULL ELSE 1 END AS CONTA
FROM   (/*Modificado em 22/03/2022 Nathan PVT - Adicionado join e case para trazer as disciplinas equivalentes concluidas. Não estáva trazendo as disciplinas equivalentes, por conta disso não trazia nenhuma concluida no relatório.*/
SELECT CASE WHEN SHISTDISCEQUIVCONCLUIDAS.CODDISC IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.CODDISC ELSE SHISTDISCCONCLUIDAS.CODDISC END CODDISC,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA ELSE SHISTDISCCONCLUIDAS.DISCIPLINA END DISCIPLINA,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.STATUS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.STATUS ELSE SHISTDISCCONCLUIDAS.STATUS END STATUS,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.PLETIVO IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.PLETIVO ELSE SHISTDISCCONCLUIDAS.PLETIVO END PLETIVO,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS ELSE SHISTDISCCONCLUIDAS.NUMCREDITOS END NUMCREDITOS,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.CH IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.CH ELSE SHISTDISCCONCLUIDAS.CH END CH,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.NOTA IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.NOTA ELSE SHISTDISCCONCLUIDAS.NOTA END NOTA,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.FALTAS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.FALTAS ELSE SHISTDISCCONCLUIDAS.FALTAS END FALTAS,
               'CONC' AS TIPO,
               SHISTDISCCONCLUIDAS.CODCOLIGADA,
               SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
               SHISTDISCCONCLUIDAS.RA,
               SHISTDISCCONCLUIDAS.GREQUIV,
               SHISTDISCCONCLUIDAS.CODPERIODO,
               SHISTDISCCONCLUIDAS.CONCEITO,
               SHISTDISCCONCLUIDAS.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCCONCLUIDAS (NOLOCK)
       	LEFT JOIN DBO.SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
              ON DBO.SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = DBO.SHISTDISCCONCLUIDAS.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = DBO.SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.RA = DBO.SHISTDISCCONCLUIDAS.RA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.GREQUIV = DBO.SHISTDISCCONCLUIDAS.GREQUIV	 
        WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = :P_CODCOLIGADA
               AND SHISTDISCCONCLUIDAS.RA = :P_RA
               AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
               AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0
        UNION
        
        
         SELECT /*Modificado em 10/08/2022 Nathan PVT - Adicionado join e case para trazer as disciplinas equivalentes*/
		CASE WHEN SHISTDISCEQUIVEMCURSO.CODDISC IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.CODDISC ELSE SHISTDISCPENDENTES.CODDISC END CODDISC,
               CASE WHEN SHISTDISCEQUIVEMCURSO.DISCIPLINA IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.DISCIPLINA ELSE SHISTDISCPENDENTES.DISCIPLINA END DISCIPLINA,
               CASE WHEN SHISTDISCEQUIVEMCURSO.STATUS IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.STATUS ELSE SHISTDISCPENDENTES.STATUS END STATUS,
               CASE WHEN SHISTDISCEQUIVEMCURSO.PLETIVO IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.PLETIVO ELSE SHISTDISCPENDENTES.PLETIVO END PLETIVO,
               CASE WHEN SHISTDISCEQUIVEMCURSO.NUMCREDITOS IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.NUMCREDITOS ELSE SHISTDISCPENDENTES.NUMCREDITOS END NUMCREDITOS,
               CASE WHEN SHISTDISCEQUIVEMCURSO.CH IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.CH ELSE SHISTDISCPENDENTES.CH END CH,
               CASE WHEN SHISTDISCEQUIVEMCURSO.NOTA IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.NOTA ELSE SHISTDISCPENDENTES.NOTA END NOTA,
               CASE WHEN SHISTDISCEQUIVEMCURSO.FALTAS IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.FALTAS ELSE SHISTDISCPENDENTES.FALTAS END FALTAS,
		

               CASE 
					WHEN SHISTDISCPENDENTES.STATUS IS NOT NULL THEN 'PEND' 
					ELSE 'CUR'
			   END AS TIPO,
               SHISTDISCPENDENTES.CODCOLIGADA,
               SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
               SHISTDISCPENDENTES.RA,
               SHISTDISCPENDENTES.GREQUIV,
               SHISTDISCPENDENTES.CODPERIODO,
               SHISTDISCPENDENTES.CONCEITO,
               SHISTDISCPENDENTES.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCPENDENTES (NOLOCK)
		LEFT JOIN DBO.SHISTDISCEQUIVEMCURSO (NOLOCK)
              ON DBO.SHISTDISCEQUIVEMCURSO.CODCOLIGADA = DBO.SHISTDISCPENDENTES.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVEMCURSO.IDHABILITACAOFILIAL = DBO.SHISTDISCPENDENTES.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVEMCURSO.RA = DBO.SHISTDISCPENDENTES.RA
                 AND DBO.SHISTDISCEQUIVEMCURSO.GREQUIV = DBO.SHISTDISCPENDENTES.GREQUIV	 
        WHERE  SHISTDISCPENDENTES.CODCOLIGADA = :P_CODCOLIGADA
               AND SHISTDISCPENDENTES.RA = :P_RA
               AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
               AND SHISTDISCPENDENTES.CODPERIODO <> 0

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               /*SHISTDISCOPTELETIVAS.STATUS,*/
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.STATUS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.STATUS ELSE SHISTDISCOPTELETIVAS.STATUS END STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELET.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELET.MINCH,
               SGRUPOOPTELET.MINCREDITOS,
               SGRUPOOPTELET.MINDISCIPLINAS,
               SGRUPOOPTELET.NOME,
               SGRUPOOPTELET.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.RA = :P_RA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL )
               JOIN SGRUPOOPTELET (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
                      AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
                      AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
                      AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
               JOIN SDISCGRUPOOPTELET (NOLOCK)
                 ON ( SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
                      AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
                      AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
                      AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
                      AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
                      
                      
               LEFT JOIN DBO.SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
              ON DBO.SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = DBO.SHISTDISCOPTELETIVAS.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = DBO.SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.RA = DBO.SHISTDISCOPTELETIVAS.RA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.GREQUIV = DBO.SHISTDISCOPTELETIVAS.GREQUIV
                      
                      
        WHERE  SPARAM.CODCOLIGADA = :P_CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL_N
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELET.EXIBEANALISE = 'S'
               AND SGRADEALUNO.RA IS NULL
               AND SHISTDISCOPTELETIVAS.RA NOT IN (SELECT SCOMPONENTECURRALUNO.RA
                                                   FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                   WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELETALUNO.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELETALUNO.MINCH,
               SGRUPOOPTELETALUNO.MINCREDITOS,
               SGRUPOOPTELETALUNO.MINDISCIPLINAS,
               SGRUPOOPTELETALUNO.NOME,
               SGRUPOOPTELETALUNO.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.RA = :P_RA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL )
               JOIN SGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
               JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
                      AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :P_CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL_N
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
               AND ( SGRADEALUNO.RA IS NOT NULL
                      OR SHISTDISCOPTELETIVAS.RA IN (SELECT SCOMPONENTECURRALUNO.RA
                                                     FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                     WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                            AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                            AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA) )) ANALISECURRICULAR                                                       
WHERE ANALISECURRICULAR.STATUS <> '*Equiv.' OR ANALISECURRICULAR.STATUS IS NULL
ORDER  BY ANALISECURRICULAR.RA,
          ANALISECURRICULAR.CODPERIODO,
          ANALISECURRICULAR.NOME";14902;;;;11/10/2022;totvs.nathan;0;1;1;1;;;;;0c489f16-d853-47a1-a978-8534e28947ad;;;4661;mestre;27/01/2021;totvs.nathan;11/10/2022;
S;Rel_Edu018_3.1;Análise Curricular - Disciplinas do aluno;"SELECT 
       CASE WHEN ANALISECURRICULAR.TIPO = 'CONC'THEN 'C'
       WHEN ANALISECURRICULAR.TIPO = 'PEND' THEN 'P' 
       END 'TIPO_6'
      
FROM   (SELECT SHISTDISCCONCLUIDAS.CODDISC,
               SHISTDISCCONCLUIDAS.DISCIPLINA,
               SHISTDISCCONCLUIDAS.STATUS,
               SHISTDISCCONCLUIDAS.PLETIVO,
               SHISTDISCCONCLUIDAS.NUMCREDITOS,
               SHISTDISCCONCLUIDAS.CH,
               SHISTDISCCONCLUIDAS.NOTA,
               SHISTDISCCONCLUIDAS.FALTAS,
               'CONC' AS TIPO,
               SHISTDISCCONCLUIDAS.CODCOLIGADA,
               SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
               SHISTDISCCONCLUIDAS.RA,
               SHISTDISCCONCLUIDAS.GREQUIV,
               SHISTDISCCONCLUIDAS.CODPERIODO,
               SHISTDISCCONCLUIDAS.CONCEITO,
               SHISTDISCCONCLUIDAS.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCCONCLUIDAS (NOLOCK)
        WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = 1
               AND SHISTDISCCONCLUIDAS.RA = 068336
               AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = 11118
               AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0
        UNION
        SELECT SHISTDISCPENDENTES.CODDISC,
               SHISTDISCPENDENTES.DISCIPLINA,
               SHISTDISCPENDENTES.STATUS,
               SHISTDISCPENDENTES.PLETIVO,
               SHISTDISCPENDENTES.NUMCREDITOS,
               SHISTDISCPENDENTES.CH,
               SHISTDISCPENDENTES.NOTA,
               SHISTDISCPENDENTES.FALTAS,
               'PEND' AS TIPO,
               SHISTDISCPENDENTES.CODCOLIGADA,
               SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
               SHISTDISCPENDENTES.RA,
               SHISTDISCPENDENTES.GREQUIV,
               SHISTDISCPENDENTES.CODPERIODO,
               SHISTDISCPENDENTES.CONCEITO,
               SHISTDISCPENDENTES.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCPENDENTES (NOLOCK)
        WHERE  SHISTDISCPENDENTES.CODCOLIGADA = 1
               AND SHISTDISCPENDENTES.RA = 068336
               AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = 11118
               AND SHISTDISCPENDENTES.CODPERIODO <> 0

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELET.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELET.MINCH,
               SGRUPOOPTELET.MINCREDITOS,
               SGRUPOOPTELET.MINDISCIPLINAS,
               SGRUPOOPTELET.NOME,
               SGRUPOOPTELET.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = 1
                      AND SHISTDISCOPTELETIVAS.RA = 068336
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = 11118 )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL )
               JOIN SGRUPOOPTELET (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
                      AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
                      AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
                      AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
               JOIN SDISCGRUPOOPTELET (NOLOCK)
                 ON ( SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
                      AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
                      AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
                      AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
                      AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = 1
               AND SPARAM.CODFILIAL = 1
               AND SPARAM.CODTIPOCURSO = 1
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELET.EXIBEANALISE = 'S'
               AND SGRADEALUNO.RA IS NULL
               AND SHISTDISCOPTELETIVAS.RA NOT IN (SELECT SCOMPONENTECURRALUNO.RA
                                                   FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                   WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELETALUNO.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELETALUNO.MINCH,
               SGRUPOOPTELETALUNO.MINCREDITOS,
               SGRUPOOPTELETALUNO.MINDISCIPLINAS,
               SGRUPOOPTELETALUNO.NOME,
               SGRUPOOPTELETALUNO.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = 1
                      AND SHISTDISCOPTELETIVAS.RA = 068336
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = 11118 )
               JOIN SGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
               JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
                      AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = 1
               AND SPARAM.CODFILIAL = 1
               AND SPARAM.CODTIPOCURSO = 1
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
               AND ( SGRADEALUNO.RA IS NOT NULL
                      OR SHISTDISCOPTELETIVAS.RA IN (SELECT SCOMPONENTECURRALUNO.RA
                                                     FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                     WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                            AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                            AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA) )) ANALISECURRICULAR
ORDER  BY ANALISECURRICULAR.RA,
          ANALISECURRICULAR.CODPERIODO,
          ANALISECURRICULAR.NOME";10128;;;;21/10/2021;consultor1.totvs;0;1;1;1;;;;;0c489f16-d853-47a1-a978-8534e28947ad;;;24294;consultor1.totvs;21/10/2021;consultor1.totvs;21/10/2021;
S;Rel_Edu018_3.2;Análise Curricular - Percentual Conclusão Aluno;"
SELECT
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SALUNO.RA,
	PPESSOA.NOME AS 'ALUNO',
	PPESSOA.CPF,
	SGRADE.DESCRICAO AS 'MATRIZ',
	SCAMPUS.DESCRICAO AS 'CAMPUS',
	SCAMPUS.CAMPUSMEC,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	SCURSOMEC.CODINEPCURSO AS 'CODEMEC CURSO',
	SINSTITUICAOMEC.CODEMEC AS 'CODEMEC INSTITUICAO',
	SINSTITUICAO.NOMEFANTASIA AS 'ESCOLA',
	SSTATUS.DESCRICAO AS 'STATUS CURSO',
	SGRAU.DESCRICAO AS 'GRAU',
	SPESSOA.ANOULTIMAINST AS 'CONCLUSAO ENSINO MEDIO',
	PENDENTES.TOTAL AS 'DISCIPLINAS PENDENTES',
	DTPERLET.DTINICIO AS 'DTINGRESSO',
	B.TCOMPOMENTE 'TOTAL O.C.C',
	B.TCOMPOMENTE AS 'TOTALCOMP',
	ISNULL(COMPCONCLUIDOS.TOTAL,0) AS 'COMPCONCLUIDOS',
	B.TCOMPOMENTE-ISNULL(COMPCONCLUIDOS.TOTAL,0) AS 'RESTCOMP',
	OBRIGATORIAS.TOTAL AS 'OBRIGATORIAS',
	CONCLUIDAS.TOTAL AS 'CONCLUIDAS',
	(OBRIGATORIAS.TOTAL - CONCLUIDAS.TOTAL) AS 'REST',
	ISNULL(OBRIGAOPT.TOTAL,0) AS 'TOTALOPT',
	ISNULL(CONCLUIDASOPT.TOTAL,0) AS 'CONCLUIDASOPT',
	(ISNULL(OBRIGAOPT.TOTAL,0) - ISNULL(CONCLUIDASOPT.TOTAL,0)) AS 'RESTOPT',
	
	ISNULL(OBRIGAELE.TOTAL,0) AS 'TOTALELE',
	ISNULL(CONCLUIDASELE.TOTAL,0) AS 'CONCLUIDASELE',
	(ISNULL(OBRIGAELE.TOTAL,0) - ISNULL(CONCLUIDASELE.TOTAL,0)) AS 'RESTELE',
	A.TOTALATIV 'O.C.C CONCLUIDOS',
	ISNULL(CAST(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2)) AS VARCHAR),0) + '%' AS 'CONCLUIDO',
	ISNULL(CAST(CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2)) AS VARCHAR),0) + '%' AS 'CONCLUIDO SEM O.C.C',
		CASE WHEN (100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2))) - A.EMCURSO < 0 THEN '0%'
	ELSE CAST((100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA - B.TCOMPOMENTE) ) AS DECIMAL(10,2))) - A.EMCURSO AS VARCHAR) + '%'
	END AS 'RESTANTE',
			CASE WHEN (100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2))) - A.EMCURSO < 0 THEN '0%'
	ELSE CAST((100 - CAST((((DISCGRADE.TDISC+ISNULL(OPT.TOPTATIVAS,0)) *100) / (SGRADE.CARGAHORARIA) ) AS DECIMAL(10,2))) - A.EMCURSO AS VARCHAR) + '%'
	END AS 'RESTANTE SEM O.C.C',
	A.EMCURSO,
	SGRADE.CARGAHORARIA
	
FROM SHISTDISCCONCLUIDAS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO



OUTER APPLY (
SELECT 
	MIN(SPLETIVO.DTINICIO) AS DTINICIO,
	SMATRICPL.RA,
	SHF.CODCURSO,
	SMATRICPL.CODCOLIGADA
FROM SMATRICPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
WHERE SMATRICPL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SMATRICPL.RA = SHISTDISCCONCLUIDAS.RA
	AND SHF.CODCURSO = SHABILITACAOFILIAL.CODCURSO
GROUP BY SHF.CODCURSO,
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA

) AS DTPERLET



LEFT JOIN (

SELECT 
	SUM(SHISTDISCOPTELETIVAS.CH) AS 'TOPTATIVAS',
	SHISTDISCOPTELETIVAS.CODCOLIGADA,
	SHISTDISCOPTELETIVAS.RA,
	SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
FROM SHISTDISCOPTELETIVAS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

OUTER APPLY(
SELECT SUM(SCP.VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR SCP
WHERE SCP.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
	AND SCP.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
) AS D

WHERE SGRADE.STATUS <> 1
AND SHISTDISCOPTELETIVAS.STATUS LIKE '%APROVADO%'
GROUP BY SHISTDISCOPTELETIVAS.CODCOLIGADA,
	SHISTDISCOPTELETIVAS.RA,
	SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL

) AS OPT ON OPT.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND OPT.RA = SHISTDISCCONCLUIDAS.RA
	AND OPT.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL


OUTER APPLY(
SELECT SUM(VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR 
WHERE SCOMPONENTECURRICULAR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCOMPONENTECURRICULAR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
) AS B


INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
LEFT JOIN SFILIAL ON SFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
	AND SFILIAL.CODFILIAL = GFILIAL.CODFILIAL
LEFT JOIN SINSTITUICAOMEC ON SINSTITUICAOMEC.CODCOLIGADA = SFILIAL.CODCOLIGADA
	AND SINSTITUICAOMEC.CODFILIAL = SFILIAL.CODFILIAL
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN STURNO ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SHISTDISCCONCLUIDAS.RA
LEFT JOIN SCAMPUS ON SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
LEFT JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
LEFT JOIN SCURSOMEC ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SALUNO.RA = SHISTDISCCONCLUIDAS.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
LEFT JOIN SPESSOA ON SPESSOA.CODIGO = PPESSOA.CODIGO
LEFT JOIN SINSTITUICAO ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
LEFT JOIN SGRAU ON SGRAU.CODGRAU = SPESSOA.GRAUULTIMAINST
	



OUTER APPLY (

SELECT 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL,
	SUM(SHD.CH) AS 'TDISC'
FROM SHISTDISCCONCLUIDAS SHD
INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHF.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHD.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC

WHERE SDGC.ZERARCREDFINRECALC IS NULL
	AND SHD.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHD.RA = SHISTDISCCONCLUIDAS.RA
	AND SHD.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL

GROUP BY SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL
) AS DISCGRADE



LEFT JOIN (

SELECT 
	/*CAST(CAST((((SUM(SHISTDISCPENDENTES.CH) + CASE WHEN ATALU.TATIV >= C.TCOMPOMENTE THEN 0 ELSE (C.TCOMPOMENTE - ATALU.TATIV) END) *100) / SGRADE.CARGAHORARIA) AS DECIMAL(10,2)) AS VARCHAR) + '%' AS 'PENDENTE',*/
	ISNULL(CAST(((SUM(SHISTDISCPENDENTES.CH) *100) / (SGRADE.CARGAHORARIA - C.TCOMPOMENTE)  ) AS DECIMAL(10,2)),0) AS 'EMCURSO',
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	SUM(SHISTDISCPENDENTES.CH) AS 'DISCEMCURSO',
	CASE WHEN ATALU.TATIV >= C.TCOMPOMENTE THEN C.TCOMPOMENTE ELSE (C.TCOMPOMENTE - ATALU.TATIV) END TOTALATIV
FROM SHISTDISCPENDENTES
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHISTDISCPENDENTES.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC


OUTER APPLY(
SELECT SUM(SC.VALORMINIMO) AS 'TCOMPOMENTE'
FROM SCOMPONENTECURRICULAR SC
WHERE SC.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SC.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
) AS C


OUTER APPLY(

SELECT SUM(CARGAHORARIAATV) AS 'TATIV'
FROM SATIVIDADEALUNO
WHERE SATIVIDADEALUNO.RA = SHISTDISCPENDENTES.RA
AND SATIVIDADEALUNO.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
AND SATIVIDADEALUNO.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
AND SATIVIDADEALUNO.CUMPRIUATIVIDADE = 'S'
) AS ATALU


WHERE SGRADE.STATUS <> 1
AND SHISTDISCPENDENTES.STATUS IS NOT NULL
AND SDGC.ZERARCREDFINRECALC IS NULL
GROUP BY SGRADE.CARGAHORARIA,
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	ATALU.TATIV,
	C.TCOMPOMENTE,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL

) AS A ON A.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND A.RA = SHISTDISCCONCLUIDAS.RA
	AND A.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	
	
	
OUTER APPLY (

SELECT 
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	COUNT(*) AS TOTAL

FROM SHISTDISCPENDENTES

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHISTDISCPENDENTES.CODDISC
LEFT JOIN SDISCGRADECOMPL SDGC ON SDG.CODCOLIGADA = SDGC.CODCOLIGADA
	AND SDG.CODCURSO = SDGC.CODCURSO
	AND SDG.CODHABILITACAO = SDGC.CODHABILITACAO
	AND SDG.CODGRADE = SDGC.CODGRADE
	AND SDG.CODPERIODO = SDGC.CODPERIODO
	AND SDG.CODDISC = SDGC.CODDISC


WHERE	 SHISTDISCPENDENTES.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
	AND SHISTDISCPENDENTES.RA = SHISTDISCCONCLUIDAS.RA
	AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
	AND SDGC.ZERARCREDFINRECALC IS NULL
GROUP BY 
	SHISTDISCPENDENTES.CODCOLIGADA,
	SHISTDISCPENDENTES.RA,
	SHISTDISCPENDENTES.IDHABILITACAOFILIAL


) AS PENDENTES
	
	
	
	
OUTER APPLY (

SELECT 
	SDG.CODCOLIGADA,
	SDG.CODGRADE,
	SDG.CODCURSO,
	SDG.CODHABILITACAO,
	COUNT(*) AS TOTAL

FROM  SDISCGRADE SDG (NOLOCK)


WHERE SDG.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SDG.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SDG.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SDG.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SDG.TIPODISC = 'B'
GROUP BY 
	SDG.CODCOLIGADA,
	SDG.CODGRADE,
	SDG.CODCURSO,
	SDG.CODHABILITACAO
) AS OBRIGATORIAS



OUTER APPLY (

SELECT 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL,
	COUNT(*) AS TOTAL

FROM SHISTDISCCONCLUIDAS SHD

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHD.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHD.CODDISC


WHERE	 SHISTDISCCONCLUIDAS.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHISTDISCCONCLUIDAS.RA = SHD.RA
	AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
GROUP BY 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL

) AS CONCLUIDAS
    
    
    
    
  OUTER APPLY (

SELECT 
	SDG.CODCOLIGADA,
	SDG.CODGRADE,
	SDG.CODCURSO,
	SDG.CODHABILITACAO,
	COUNT(*) AS TOTAL

FROM  SDISCGRADE SDG (NOLOCK)


WHERE SDG.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SDG.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SDG.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SDG.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SDG.TIPODISC = 'O'
GROUP BY 
	SDG.CODCOLIGADA,
	SDG.CODGRADE,
	SDG.CODCURSO,
	SDG.CODHABILITACAO
) AS OBRIGAOPT
	

OUTER APPLY (

SELECT 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL,
	COUNT(*) AS TOTAL

FROM SHISTDISCOPTELETIVAS SHD

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHD.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHD.CODDISC


WHERE	 SHISTDISCCONCLUIDAS.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHISTDISCCONCLUIDAS.RA = SHD.RA
	AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
	AND SDG.TIPODISC = 'O'
GROUP BY 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL

) AS CONCLUIDASOPT



    
  OUTER APPLY (

SELECT 
	SDG.CODCOLIGADA,
	SDG.CODGRADE,
	SDG.CODCURSO,
	SDG.CODHABILITACAO,
	COUNT(*) AS TOTAL

FROM  SDISCGRADE SDG (NOLOCK)


WHERE SDG.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SDG.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SDG.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SDG.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SDG.TIPODISC = 'E'
GROUP BY 
	SDG.CODCOLIGADA,
	SDG.CODGRADE,
	SDG.CODCURSO,
	SDG.CODHABILITACAO
) AS OBRIGAELE
	

OUTER APPLY (

SELECT 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL,
	COUNT(*) AS TOTAL

FROM SHISTDISCOPTELETIVAS SHD

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
INNER JOIN SDISCGRADE SDG (NOLOCK) ON SDG.CODCOLIGADA = SHD.CODCOLIGADA
	AND SDG.CODCURSO = SHF.CODCURSO
	AND SDG.CODHABILITACAO = SHF.CODHABILITACAO
	AND SDG.CODGRADE = SHF.CODGRADE
	AND SDG.CODDISC = SHD.CODDISC


WHERE	 SHISTDISCCONCLUIDAS.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHISTDISCCONCLUIDAS.RA = SHD.RA
	AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
	AND SDG.TIPODISC = 'E'
GROUP BY 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL

) AS CONCLUIDASELE


OUTER APPLY (

SELECT 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL,
	SUM(SHD.CH) AS TOTAL

FROM SHISTATVIDADEALUNO SHD

INNER JOIN SHABILITACAOFILIAL SHF ON SHF.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHF.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
WHERE	 SHISTDISCCONCLUIDAS.CODCOLIGADA = SHD.CODCOLIGADA
	AND SHISTDISCCONCLUIDAS.RA = SHD.RA
	AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHD.IDHABILITACAOFILIAL
	AND VALORMINIMO IS NOT NULL
GROUP BY 
	SHD.CODCOLIGADA,
	SHD.RA,
	SHD.IDHABILITACAOFILIAL

) AS COMPCONCLUIDOS



WHERE 
	SHISTDISCCONCLUIDAS.CODCOLIGADA = :P_CODCOLIGADA
    AND SHISTDISCCONCLUIDAS.RA = :P_RA
    AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
    

GROUP BY SGRADE.CARGAHORARIA,
A.EMCURSO,
SALUNO.RA,
SINSTITUICAO.NOMEFANTASIA,
PPESSOA.NOME,
OBRIGATORIAS.TOTAL,
CONCLUIDAS.TOTAL,
SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
PPESSOA.CPF,
A.TOTALATIV,
SSTATUS.DESCRICAO,
GFILIAL.NOMEFANTASIA,
STIPOCURSO.NOME,
SCAMPUS.DESCRICAO,
SCAMPUS.CAMPUSMEC,
OBRIGAELE.TOTAL,
CONCLUIDASELE.TOTAL,
OPT.TOPTATIVAS,
PENDENTES.TOTAL,
SCURSOMEC.CODINEPCURSO,
DISCGRADE.TDISC,
SCURSO.NOME,
DTPERLET.DTINICIO,
SGRADE.DESCRICAO,
B.TCOMPOMENTE,
OBRIGAOPT.TOTAL,
CONCLUIDASOPT.TOTAL,
COMPCONCLUIDOS.TOTAL,
SPESSOA.ANOULTIMAINST,
A.DISCEMCURSO,
STURNO.NOME,
SINSTITUICAOMEC.CODEMEC,
SGRAU.DESCRICAO
";16911;;;;23/08/2022;consultor1.totvs;0;1;1;1;;;;;0c489f16-d853-47a1-a978-8534e28947ad;;;17973;consultor1.totvs;10/08/2022;consultor1.totvs;23/08/2022;
S;Rel_Edu018_3.3;Análise Curricular - Disciplinas do aluno;"SELECT ANALISECURRICULAR.CODDISC,
       ANALISECURRICULAR.DISCIPLINA,
       ISNULL(ANALISECURRICULAR.STATUS, 'A Cursar') as STATUS,
       ANALISECURRICULAR.PLETIVO,
       ANALISECURRICULAR.NUMCREDITOS,
       ANALISECURRICULAR.CH,
       ANALISECURRICULAR.NOTA,
       ANALISECURRICULAR.FALTAS,
       ANALISECURRICULAR.TIPO,
       ANALISECURRICULAR.CODCOLIGADA,
       ANALISECURRICULAR.IDHABILITACAOFILIAL,
       ANALISECURRICULAR.RA,
       ANALISECURRICULAR.GREQUIV,
       ANALISECURRICULAR.CODPERIODO,
       ANALISECURRICULAR.CONCEITO,
       ANALISECURRICULAR.CONCEITOECTS,
       ANALISECURRICULAR.MINCH,
       ANALISECURRICULAR.MINCREDITOS,
       ANALISECURRICULAR.MINDISCIPLINAS,
       ANALISECURRICULAR.NOME,
       ANALISECURRICULAR.TIPOAVALIACAO,
       CASE WHEN ANALISECURRICULAR.NOTA IS NULL THEN NULL ELSE 1 END AS CONTA
FROM   (/*Modificado em 22/03/2022 Nathan PVT - Adicionado join e case para trazer as disciplinas equivalentes concluidas. Não estáva trazendo as disciplinas equivalentes, por conta disso não trazia nenhuma concluida no relatório.*/
SELECT CASE WHEN SHISTDISCEQUIVCONCLUIDAS.CODDISC IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.CODDISC ELSE SHISTDISCCONCLUIDAS.CODDISC END CODDISC,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA ELSE SHISTDISCCONCLUIDAS.DISCIPLINA END DISCIPLINA,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.STATUS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.STATUS ELSE SHISTDISCCONCLUIDAS.STATUS END STATUS,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.PLETIVO IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.PLETIVO ELSE SHISTDISCCONCLUIDAS.PLETIVO END PLETIVO,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS ELSE SHISTDISCCONCLUIDAS.NUMCREDITOS END NUMCREDITOS,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.CH IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.CH ELSE SHISTDISCCONCLUIDAS.CH END CH,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.NOTA IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.NOTA ELSE SHISTDISCCONCLUIDAS.NOTA END NOTA,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.FALTAS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.FALTAS ELSE SHISTDISCCONCLUIDAS.FALTAS END FALTAS,
               'CONC' AS TIPO,
               SHISTDISCCONCLUIDAS.CODCOLIGADA,
               SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
               SHISTDISCCONCLUIDAS.RA,
               SHISTDISCCONCLUIDAS.GREQUIV,
               SHISTDISCCONCLUIDAS.CODPERIODO,
               SHISTDISCCONCLUIDAS.CONCEITO,
               SHISTDISCCONCLUIDAS.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCCONCLUIDAS (NOLOCK)
       	LEFT JOIN DBO.SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
              ON DBO.SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = DBO.SHISTDISCCONCLUIDAS.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = DBO.SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.RA = DBO.SHISTDISCCONCLUIDAS.RA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.GREQUIV = DBO.SHISTDISCCONCLUIDAS.GREQUIV	 
        WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = :CODCOLIGADA
               AND SHISTDISCCONCLUIDAS.RA = :RA
               AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
               AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0
        UNION
        
        
         SELECT /*Modificado em 10/08/2022 Nathan PVT - Adicionado join e case para trazer as disciplinas equivalentes*/
		CASE WHEN SHISTDISCEQUIVEMCURSO.CODDISC IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.CODDISC ELSE SHISTDISCPENDENTES.CODDISC END CODDISC,
               CASE WHEN SHISTDISCEQUIVEMCURSO.DISCIPLINA IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.DISCIPLINA ELSE SHISTDISCPENDENTES.DISCIPLINA END DISCIPLINA,
               CASE WHEN SHISTDISCEQUIVEMCURSO.STATUS IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.STATUS ELSE SHISTDISCPENDENTES.STATUS END STATUS,
               CASE WHEN SHISTDISCEQUIVEMCURSO.PLETIVO IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.PLETIVO ELSE SHISTDISCPENDENTES.PLETIVO END PLETIVO,
               CASE WHEN SHISTDISCEQUIVEMCURSO.NUMCREDITOS IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.NUMCREDITOS ELSE SHISTDISCPENDENTES.NUMCREDITOS END NUMCREDITOS,
               CASE WHEN SHISTDISCEQUIVEMCURSO.CH IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.CH ELSE SHISTDISCPENDENTES.CH END CH,
               CASE WHEN SHISTDISCEQUIVEMCURSO.NOTA IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.NOTA ELSE SHISTDISCPENDENTES.NOTA END NOTA,
               CASE WHEN SHISTDISCEQUIVEMCURSO.FALTAS IS NOT NULL THEN SHISTDISCEQUIVEMCURSO.FALTAS ELSE SHISTDISCPENDENTES.FALTAS END FALTAS,
		

               CASE 
					WHEN SHISTDISCPENDENTES.STATUS IS NOT NULL THEN 'PEND' 
					ELSE 'CUR'
			   END AS TIPO,
               SHISTDISCPENDENTES.CODCOLIGADA,
               SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
               SHISTDISCPENDENTES.RA,
               SHISTDISCPENDENTES.GREQUIV,
               SHISTDISCPENDENTES.CODPERIODO,
               SHISTDISCPENDENTES.CONCEITO,
               SHISTDISCPENDENTES.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCPENDENTES (NOLOCK)
		LEFT JOIN DBO.SHISTDISCEQUIVEMCURSO (NOLOCK)
              ON DBO.SHISTDISCEQUIVEMCURSO.CODCOLIGADA = DBO.SHISTDISCPENDENTES.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVEMCURSO.IDHABILITACAOFILIAL = DBO.SHISTDISCPENDENTES.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVEMCURSO.RA = DBO.SHISTDISCPENDENTES.RA
                 AND DBO.SHISTDISCEQUIVEMCURSO.GREQUIV = DBO.SHISTDISCPENDENTES.GREQUIV	 
        WHERE  SHISTDISCPENDENTES.CODCOLIGADA = :CODCOLIGADA
               AND SHISTDISCPENDENTES.RA = :RA
               AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
               AND SHISTDISCPENDENTES.CODPERIODO <> 0

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELET.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELET.MINCH,
               SGRUPOOPTELET.MINCREDITOS,
               SGRUPOOPTELET.MINDISCIPLINAS,
               SGRUPOOPTELET.NOME,
               SGRUPOOPTELET.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.RA = :RA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL )
               JOIN SGRUPOOPTELET (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
                      AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
                      AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
                      AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
               JOIN SDISCGRUPOOPTELET (NOLOCK)
                 ON ( SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
                      AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
                      AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
                      AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
                      AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :$CODCOLIGADA
               AND SPARAM.CODFILIAL = :$CODFILIAL
               AND SPARAM.CODTIPOCURSO = :$CODTIPOCURSO
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELET.EXIBEANALISE = 'S'
               AND SGRADEALUNO.RA IS NULL
               AND SHISTDISCOPTELETIVAS.RA NOT IN (SELECT SCOMPONENTECURRALUNO.RA
                                                   FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                   WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELETALUNO.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELETALUNO.MINCH,
               SGRUPOOPTELETALUNO.MINCREDITOS,
               SGRUPOOPTELETALUNO.MINDISCIPLINAS,
               SGRUPOOPTELETALUNO.NOME,
               SGRUPOOPTELETALUNO.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.RA = :RA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL )
               JOIN SGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
               JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
                      AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :$CODCOLIGADA
               AND SPARAM.CODFILIAL = :$CODFILIAL
               AND SPARAM.CODTIPOCURSO = :$CODTIPOCURSO
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
               AND ( SGRADEALUNO.RA IS NOT NULL
                      OR SHISTDISCOPTELETIVAS.RA IN (SELECT SCOMPONENTECURRALUNO.RA
                                                     FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                     WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                            AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                            AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA) )) ANALISECURRICULAR                                                       
WHERE ANALISECURRICULAR.STATUS <> '*Equiv.' OR ANALISECURRICULAR.STATUS IS NULL
ORDER  BY ANALISECURRICULAR.RA,
          ANALISECURRICULAR.CODPERIODO,
          ANALISECURRICULAR.NOME";14162;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;;0c489f16-d853-47a1-a978-8534e28947ad;;;-35;consultor1.totvs;22/08/2022;consultor1.totvs;22/08/2022;
S;Rel_Edu018_4;Análise Curricular - Disciplinas eletivas e optativas do aluno;"SELECT 
  SHISTDISCOPTELETIVAS.CODDISC, 
  SHISTDISCOPTELETIVAS.DISCIPLINA, 
  SHISTDISCOPTELETIVAS.STATUS, 
  SHISTDISCOPTELETIVAS.CODSTATUSRES,    
  SHISTDISCOPTELETIVAS.PLETIVO, 
  SHISTDISCOPTELETIVAS.NUMCREDITOS,
  SHISTDISCOPTELETIVAS.CH,
  SHISTDISCOPTELETIVAS.NOTA, 
  SHISTDISCOPTELETIVAS.FALTAS, 
  SHISTDISCOPTELETIVAS.TIPO,
  SHISTDISCOPTELETIVAS.CODCOLIGADA,
  SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
  SHISTDISCOPTELETIVAS.RA,
  SHISTDISCOPTELETIVAS.GREQUIV,
  SHISTDISCOPTELETIVAS.CONCEITO,
  SHISTDISCOPTELETIVAS.CONCEITOECTS
FROM SPARAM (NOLOCK) LEFT JOIN SHISTDISCOPTELETIVAS (NOLOCK) 
    ON (SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
        AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA 
        AND SHISTDISCOPTELETIVAS.RA = :P_RA
        AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL)  
WHERE SPARAM.CODCOLIGADA = :P_CODCOLIGADA 
  AND SPARAM.CODFILIAL = :CODFILIAL_N
  AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
  AND (SPARAM.TEXTO = '0' OR SPARAM.TEXTO = 'N')
";;;;;;;0;1;1;1;;;;;e7d94947-89c0-4322-ad21-248f762e9db3;;;-20372;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu018_4.1;Análise Curricular - Disciplinas eletivas e optativas do aluno;"SELECT 
  SHISTDISCOPTELETIVAS.CODDISC, 
  SHISTDISCOPTELETIVAS.DISCIPLINA, 
  SHISTDISCOPTELETIVAS.STATUS, 
  SHISTDISCOPTELETIVAS.CODSTATUSRES,    
  SHISTDISCOPTELETIVAS.PLETIVO, 
  SHISTDISCOPTELETIVAS.NUMCREDITOS,
  SHISTDISCOPTELETIVAS.CH,
  SHISTDISCOPTELETIVAS.NOTA, 
  SHISTDISCOPTELETIVAS.FALTAS, 
  SHISTDISCOPTELETIVAS.TIPO,
  SHISTDISCOPTELETIVAS.CODCOLIGADA,
  SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
  SHISTDISCOPTELETIVAS.RA,
  SHISTDISCOPTELETIVAS.GREQUIV,
  SHISTDISCOPTELETIVAS.CONCEITO,
  SHISTDISCOPTELETIVAS.CONCEITOECTS
FROM SPARAM (NOLOCK) LEFT JOIN SHISTDISCOPTELETIVAS (NOLOCK) 
    ON (SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
        AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :CODCOLIGADA 
        AND SHISTDISCOPTELETIVAS.RA = :RA
        AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL)  
WHERE SPARAM.CODCOLIGADA = :CODCOLIGADA 
  AND SPARAM.CODFILIAL = :$CODFILIAL
  AND SPARAM.CODTIPOCURSO = :$CODTIPOCURSO
  AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
  AND (SPARAM.TEXTO = '0' OR SPARAM.TEXTO = 'N')
";1087;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;;e7d94947-89c0-4322-ad21-248f762e9db3;;;-23617;consultor1.totvs;22/08/2022;consultor1.totvs;22/08/2022;
S;Rel_Edu018_5;Análise Curricular -  Atividades Curriculares;"SELECT
  SHISTATVIDADEALUNO.MODALIDADE, 
  SHISTATVIDADEALUNO.DESCRICAO, 
  SHISTATVIDADEALUNO.PLETIVO, 
  SHISTATVIDADEALUNO.CREDITOS, 
  SHISTATVIDADEALUNO.CH, 
  SHISTATVIDADEALUNO.CODCOLIGADA,  
  SHISTATVIDADEALUNO.IDHABILITACAOFILIAL,
  SHISTATVIDADEALUNO.RA,
  SHISTATVIDADEALUNO.CUMPRIUATIVIDADE
FROM SHISTATVIDADEALUNO (NOLOCK)
WHERE SHISTATVIDADEALUNO.CODCOLIGADA = :P_CODCOLIGADA
  AND SHISTATVIDADEALUNO.RA = :P_RA
  AND SHISTATVIDADEALUNO.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL  ";;;;;;;0;1;1;1;;;;;fb5666f5-6b4b-4e5d-ae98-399d3c22fad3;;;3863;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu018_5.1;Análise Curricular -  Atividades Curriculares;"SELECT
  SHISTATVIDADEALUNO.MODALIDADE, 
  SHISTATVIDADEALUNO.DESCRICAO, 
  SHISTATVIDADEALUNO.PLETIVO, 
  SHISTATVIDADEALUNO.CREDITOS, 
  SHISTATVIDADEALUNO.CH, 
  SHISTATVIDADEALUNO.CODCOLIGADA,  
  SHISTATVIDADEALUNO.IDHABILITACAOFILIAL,
  SHISTATVIDADEALUNO.RA,
  SHISTATVIDADEALUNO.CUMPRIUATIVIDADE,
  SHISTATVIDADEALUNO.COMPONENTE,
  CASE WHEN CUMPRIUATIVIDADE = 'S' THEN CH ELSE 0 END VALORCHCONCLUIDA,
  CASE WHEN CUMPRIUATIVIDADE = 'S' THEN CREDITOS ELSE 0 END VALORCREDITOCONCLUIDO,
  SHISTATVIDADEALUNO.VALORMINIMO,
  SHISTATVIDADEALUNO.VALORMAXIMO,
  SHISTATVIDADEALUNO.VALORMINIMOCOMPONENTE,
  SHISTATVIDADEALUNO.TIPOATIVIDADECURRICULAR
FROM SHISTATVIDADEALUNO (NOLOCK)
WHERE SHISTATVIDADEALUNO.CODCOLIGADA = :CODCOLIGADA
  AND SHISTATVIDADEALUNO.RA = :RA
  AND SHISTATVIDADEALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL  ";858;;;;23/08/2022;consultor1.totvs;0;1;1;1;;;;;fb5666f5-6b4b-4e5d-ae98-399d3c22fad3;;;1871;consultor1.totvs;23/08/2022;consultor1.totvs;23/08/2022;
S;Rel_Edu018_6;Análise Curricular - Disciplinas Extras;"SELECT SDISCNAOAPROVEITADAS.CODDISC,
  SDISCIPLINA.NOME  AS DISCIPLINA,
  SPLETIVO.CODPERLET AS PLETIVO,
  SDISCNAOAPROVEITADAS.NUMCREDITOS,
  SDISCNAOAPROVEITADAS.CH,
  SDISCNAOAPROVEITADAS.FALTAS,
  SDISCNAOAPROVEITADAS.NOTA,
  SSTATUS.DESCRICAO AS STATUS,
  SDISCNAOAPROVEITADAS.CONCEITO,
  SDISCNAOAPROVEITADAS.CONCEITOECTS,
  SDISCNAOAPROVEITADAS.CUMPRIU
FROM SPARAM (NOLOCK) LEFT JOIN SDISCNAOAPROVEITADAS (NOLOCK) 
     ON (SPARAM.CODCOLIGADA = SDISCNAOAPROVEITADAS.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODCOLIGADA = :P_CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
         AND SDISCNAOAPROVEITADAS.RA = :P_RA)
  LEFT JOIN SDISCIPLINA (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODDISC = SDISCIPLINA.CODDISC)
  LEFT JOIN SSTATUS (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODSTATUS = SSTATUS.CODSTATUS)
  LEFT JOIN SPLETIVO (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.IDPERLET = SPLETIVO.IDPERLET)
WHERE SPARAM.CODCOLIGADA = :P_CODCOLIGADA
  AND SPARAM.CODFILIAL  = :CODFILIAL_N
  AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SPARAM.ID = 'EXIBIRDISCEXTRA'
  AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')";;;;;;;0;1;1;1;;;;;d8843382-40bc-4052-ba03-b35d808314e6;;;-7980;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu018_6.1;Análise Curricular - Disciplinas Extras;"SELECT SDISCNAOAPROVEITADAS.CODDISC,
  SDISCIPLINA.NOME  AS DISCIPLINA,
  SPLETIVO.CODPERLET AS PLETIVO,
  SDISCNAOAPROVEITADAS.NUMCREDITOS,
  SDISCNAOAPROVEITADAS.CH,
  SDISCNAOAPROVEITADAS.FALTAS,
  SDISCNAOAPROVEITADAS.NOTA,
  SSTATUS.DESCRICAO AS STATUS,
  SDISCNAOAPROVEITADAS.CONCEITO,
  SDISCNAOAPROVEITADAS.CONCEITOECTS,
  SDISCNAOAPROVEITADAS.CUMPRIU
FROM SPARAM (NOLOCK) LEFT JOIN SDISCNAOAPROVEITADAS (NOLOCK) 
     ON (SPARAM.CODCOLIGADA = SDISCNAOAPROVEITADAS.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODCOLIGADA = :CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
         AND SDISCNAOAPROVEITADAS.RA = :RA)
  LEFT JOIN SDISCIPLINA (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODDISC = SDISCIPLINA.CODDISC)
  LEFT JOIN SSTATUS (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODSTATUS = SSTATUS.CODSTATUS)
  LEFT JOIN SPLETIVO (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.IDPERLET = SPLETIVO.IDPERLET)
WHERE SPARAM.CODCOLIGADA = :$CODCOLIGADA
  AND SPARAM.CODFILIAL  = :$CODFILIAL
  AND SPARAM.CODTIPOCURSO = :$CODTIPOCURSO
  AND SPARAM.ID = 'EXIBIRDISCEXTRA'
  AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')";1385;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;;d8843382-40bc-4052-ba03-b35d808314e6;;;-24956;consultor1.totvs;22/08/2022;consultor1.totvs;22/08/2022;
S;Rel_Edu018_7;Análise Curricular - TCC;"SELECT 
  SHISTDISCTCC.CODCOLIGADA, 
  SHISTDISCTCC.IDHABILITACAOFILIAL, 
  SHISTDISCTCC.RA, 
  SHISTDISCTCC.CODDISC, 
  SHISTDISCTCC.IDTCC, 
  SHISTDISCTCC.CODPERIODO, 
  SHISTDISCTCC.PLETIVO, 
  SHISTDISCTCC.DISCIPLINA, 
  SHISTDISCTCC.STATUS, 
  SHISTDISCTCC.NUMCREDITOS, 
  SHISTDISCTCC.NOTA, 
  SHISTDISCTCC.CH, 
  SHISTDISCTCC.GREQUIV, 
  SHISTDISCTCC.CODSTATUS, 
  SHISTDISCTCC.FALTAS, 
  SHISTDISCTCC.CONCEITO, 
  SHISTDISCTCC.CODSTATUSMATRICULA, 
  SHISTDISCTCC.STATUSMATRICULA, 
  SHISTDISCTCC.DTMATRICULA, 
  SHISTDISCTCC.IDPERLET, 
  SHISTDISCTCC.IDHABFILIALAPROVESTUDOS, 
  SHISTDISCTCC.IDTURMADISC, 
  SHISTDISCTCC.CHHORA, 
  SHISTDISCTCC.CONCEITOECTS, 
  SHISTDISCTCC.TEMA, 
  SHISTDISCTCC.IDTIPOTCC, 
  SHISTDISCTCC.NOMETIPOTCC, 
  SHISTDISCTCC.IDLINHAPESQUISA, 
  SHISTDISCTCC.NOMELINHAPESQUISA, 
  SHISTDISCTCC.IDSTATUSTCC, 
  SHISTDISCTCC.NOMESTATUS,
  SHISTDISCTCC.IMAGEINDEX
FROM SHISTDISCTCC (NOLOCK)
WHERE SHISTDISCTCC.CODCOLIGADA = :P_CODCOLIGADA
  AND SHISTDISCTCC.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
  AND SHISTDISCTCC.RA = :P_RA
ORDER BY 
  SHISTDISCTCC.PLETIVO, SHISTDISCTCC.DISCIPLINA
";;;;;;;0;1;1;1;;;;;799ad830-471d-41a8-ac35-94ca03779518;;;-26724;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu018_7.1;Análise Curricular - TCC;"SELECT 
  SHISTDISCTCC.CODCOLIGADA, 
  SHISTDISCTCC.IDHABILITACAOFILIAL, 
  SHISTDISCTCC.RA, 
  SHISTDISCTCC.CODDISC, 
  SHISTDISCTCC.IDTCC, 
  SHISTDISCTCC.CODPERIODO, 
  SHISTDISCTCC.PLETIVO, 
  SHISTDISCTCC.DISCIPLINA, 
  SHISTDISCTCC.STATUS, 
  SHISTDISCTCC.NUMCREDITOS, 
  SHISTDISCTCC.NOTA, 
  SHISTDISCTCC.CH, 
  SHISTDISCTCC.GREQUIV, 
  SHISTDISCTCC.CODSTATUS, 
  SHISTDISCTCC.FALTAS, 
  SHISTDISCTCC.CONCEITO, 
  SHISTDISCTCC.CODSTATUSMATRICULA, 
  SHISTDISCTCC.STATUSMATRICULA, 
  SHISTDISCTCC.DTMATRICULA, 
  SHISTDISCTCC.IDPERLET, 
  SHISTDISCTCC.IDHABFILIALAPROVESTUDOS, 
  SHISTDISCTCC.IDTURMADISC, 
  SHISTDISCTCC.CHHORA, 
  SHISTDISCTCC.CONCEITOECTS, 
  SHISTDISCTCC.TEMA, 
  SHISTDISCTCC.IDTIPOTCC, 
  SHISTDISCTCC.NOMETIPOTCC, 
  SHISTDISCTCC.IDLINHAPESQUISA, 
  SHISTDISCTCC.NOMELINHAPESQUISA, 
  SHISTDISCTCC.IDSTATUSTCC, 
  SHISTDISCTCC.NOMESTATUS,
  SHISTDISCTCC.IMAGEINDEX
FROM SHISTDISCTCC (NOLOCK)
WHERE SHISTDISCTCC.CODCOLIGADA = :CODCOLIGADA
  AND SHISTDISCTCC.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
  AND SHISTDISCTCC.RA = :RA
ORDER BY 
  SHISTDISCTCC.PLETIVO, SHISTDISCTCC.DISCIPLINA
";1156;;;;23/08/2022;consultor1.totvs;0;1;1;1;;;;;799ad830-471d-41a8-ac35-94ca03779518;;;16032;consultor1.totvs;23/08/2022;consultor1.totvs;23/08/2022;
S;Rel_Edu018_8;Análise Curricular - Orientador do TCC;"SELECT 
  SPROFESSOR.CODPROF,
  PPESSOA.NOME
FROM STCCORIENTADOR (NOLOCK)
JOIN SPROFESSOR (NOLOCK)
  ON STCCORIENTADOR.CODCOLIGADA = SPROFESSOR.CODCOLIGADA AND
     STCCORIENTADOR.CODPROF     = SPROFESSOR.CODPROF
JOIN PPESSOA (NOLOCK)
  ON SPROFESSOR.CODPESSOA = PPESSOA.CODIGO
WHERE STCCORIENTADOR.CODCOLIGADA = :P_CODCOLIGADA
  AND STCCORIENTADOR.IDTCC       = :P_IDTCC
  AND STCCORIENTADOR.CONVITEACEITO = 'S'";;;;;;;0;1;1;1;;;;;0897e0b3-a5ab-446d-b61a-65790805454a;;;3879;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu018_8.1;Análise Curricular - Orientador do TCC;"SELECT 
  SPROFESSOR.CODPROF,
  PPESSOA.NOME
FROM STCCORIENTADOR (NOLOCK)
JOIN SPROFESSOR (NOLOCK)
  ON STCCORIENTADOR.CODCOLIGADA = SPROFESSOR.CODCOLIGADA AND
     STCCORIENTADOR.CODPROF     = SPROFESSOR.CODPROF
JOIN PPESSOA (NOLOCK)
  ON SPROFESSOR.CODPESSOA = PPESSOA.CODIGO
WHERE STCCORIENTADOR.CODCOLIGADA = :P_CODCOLIGADA
  AND STCCORIENTADOR.IDTCC       = :P_IDTCC
  AND STCCORIENTADOR.CONVITEACEITO = 'S'";423;;;;23/08/2022;consultor1.totvs;0;1;1;1;;;;;0897e0b3-a5ab-446d-b61a-65790805454a;;;3879;consultor1.totvs;23/08/2022;consultor1.totvs;23/08/2022;
S;Rel_Edu018_9;Análise Curricular - Banca do TCC;"SELECT STCCBANCA.CODCOLIGADA, STCCBANCA.IDBANCA, STCCBANCA.DATAHORABANCA, STCCBANCA.LOCAL
FROM STCCBANCA (NOLOCK)
WHERE STCCBANCA.CODCOLIGADA = :P_CODCOLIGADA_N
  AND STCCBANCA.IDTCC = :P_IDTCC
ORDER BY
  STCCBANCA.DATAHORABANCA DESC";;;;;;;0;1;1;1;;;;;5d38cf7b-5fb7-4555-9a14-547ad3ebbc45;;;-12619;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu018_9b;Análise Curricular - Participantes da Banca do TCC;"SELECT 
  STCCPARTICIPANTESBANCA.CODCOLIGADA, 
  STCCPARTICIPANTESBANCA.IDPARTICIPANTEBANCA, 
  STCCPARTICIPANTESBANCA.IDBANCA, 
  STCCPARTICIPANTESBANCA.CODCOLIGADAPROF, 
  STCCPARTICIPANTESBANCA.CODPROF, 
  STCCPARTICIPANTESBANCA.CODPESSOA, 
  STCCPARTICIPANTESBANCA.IDTIPOPARTICIPANTE, 
  STCCPARTICIPANTESBANCA.NOTANUMERICA, 
  STCCPARTICIPANTESBANCA.IDGRUPOCONCEITO, 
  STCCPARTICIPANTESBANCA.CODCONCEITO,   
  STCCTIPOPARTICIPANTEBANCA.NOME TIPOPARTICIPANTEBANCA,
  CASE WHEN ( STCCPARTICIPANTESBANCA.CODPROF IS NOT NULL ) 
    THEN PPESSOAPROFESSOR.NOME
    ELSE PPESSOA.NOME
  END NOMEPARTICIPANTE
FROM STCCPARTICIPANTESBANCA (NOLOCK)
JOIN STCCTIPOPARTICIPANTEBANCA (NOLOCK)
  ON STCCPARTICIPANTESBANCA.CODCOLIGADA        = STCCTIPOPARTICIPANTEBANCA.CODCOLIGADA AND
     STCCPARTICIPANTESBANCA.IDTIPOPARTICIPANTE = STCCTIPOPARTICIPANTEBANCA.IDTIPOPARTICIPANTE
LEFT JOIN PPESSOA (NOLOCK)
  ON STCCPARTICIPANTESBANCA.CODPESSOA = PPESSOA.CODIGO
LEFT JOIN SPROFESSOR (NOLOCK)
  ON STCCPARTICIPANTESBANCA.CODCOLIGADAPROF = SPROFESSOR.CODCOLIGADA AND
     STCCPARTICIPANTESBANCA.CODPROF         = SPROFESSOR.CODPROF      
LEFT JOIN PPESSOA PPESSOAPROFESSOR (NOLOCK)
  ON PPESSOAPROFESSOR.CODIGO = SPROFESSOR.CODPESSOA
WHERE STCCPARTICIPANTESBANCA.CODCOLIGADA = :P_CODCOLIGADA
  AND STCCPARTICIPANTESBANCA.IDBANCA = :P_IDBANCA";;;;;;;0;1;1;1;;;;;0b77ec57-c1cc-4355-9cff-e8529007bc97;;;-22585;mestre;27/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Edu019;Relação de alunos por situação de matricula por turma;"SELECT STURMA.CODCOLIGADA,
  STURMA.IDHABILITACAOFILIAL,
  STURMA.IDPERLET,
  SMATRICPL.RA,
  SMATRICPL.CODSTATUS,
  STURMA.CODTURMA,
  SSTATUS.DESCRICAO AS NOMESTATUS,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  SPLETIVO.CODPERLET,
  STIPOCURSO.APRESENTACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM
FROM STURMA (NOLOCK) LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMA.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMA.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN GFILIAL (NOLOCK)
     ON (STURMA.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMA.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMA.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND STURMA.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   JOIN SMATRICPL (NOLOCK)
     ON (STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
         AND STURMA.CODFILIAL = SMATRICPL.CODFILIAL
         AND STURMA.IDPERLET = SMATRICPL.IDPERLET
         AND STURMA.CODTURMA = SMATRICPL.CODTURMA)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMA.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMA.IDPERLET = SPLETIVO.IDPERLET)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICPL.RA = SALUNO.RA)
   JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)         
WHERE STURMA.CODCOLIGADA = :CODCOLIGADA_N
  AND STURMA.CODFILIAL = :CODFILIAL_N
  AND STURMA.CODTURMA BETWEEN :CODTURMADE_S AND :CODTURMAATE_S
  AND SPLETIVO.CODPERLET = :CODPERLET_S
ORDER BY STURMA.CODCOLIGADA,
  STURMA.IDHABILITACAOFILIAL,
  STURMA.IDPERLET,
  SMATRICPL.CODSTATUS,  
  STURMA.CODTURMA,
  PPESSOA.NOME   ";;;;;;;0;1;1;1;;;;;;;12.1;-9013;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu020;Relação de alunos por situação de matrícula por turma/disc;"SELECT STURMADISC.CODCOLIGADA,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDPERLET,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODDISC,
  SMATRICULA.RA,
  SMATRICULA.CODSTATUS,
  STURMADISC.CODTURMA,
  SSTATUS.DESCRICAO AS NOMESTATUS,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  SPLETIVO.CODPERLET,
  STIPOCURSO.APRESENTACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA
FROM STURMADISC (NOLOCK) LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND STURMADISC.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   JOIN SMATRICULA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICULA.RA = SALUNO.RA)
   JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)       
   JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
WHERE STURMADISC.CODCOLIGADA = :CODCOLIGADA_N
  AND STURMADISC.CODFILIAL = :CODFILIAL_N
  AND STURMADISC.IDTURMADISC BETWEEN :IDTURMADISCDE_N AND :IDTURMADISCATE_N
  AND SPLETIVO.CODPERLET = :CODPERLET_S
ORDER BY STURMADISC.CODCOLIGADA,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDPERLET,
  SMATRICULA.CODSTATUS,  
  STURMADISC.IDTURMADISC,
  PPESSOA.NOME   ";;;;;;;0;1;1;1;;;;;;;12.1;28900;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Edu026;Certificado de Conclusão de Curso;"SELECT PPESSOA.NOME ALUNO, 
  SALUNO.RA, 
  PPESSOA.DTNASCIMENTO, 
  GFILIAL.CIDADE,
  PPESSOA.NATURALIDADE, 
  SHABILITACAOFILIAL.CODTIPOCURSO,
  SCURSO.NOME CURSO, SCURSO.CODCURSO,
  PPESSOAPAI.NOME NOMEPAI,           
  PPESSOAMAE.NOME NOMEMAE,
  SCURSO.NOME, 
  SHABILITACAOFILIAL.DECRETOCURSO DECRETO,
  SHABILITACAO.NOME HABILITACAO,
  PPESSOA.CARTIDENTIDADE, 
  PPESSOA.ORGEMISSORIDENT,
  PPESSOA.UFCARTIDENT,
  PPESSOA.CPF,
  SHABILITACAOALUNO.DTCONCLUSAOCURSO, 
  SAUTORIZACAOCURSO.PORTAUTORIZACAO, 
  SAUTORIZACAOCURSO.DTDOUAUTORIZACAO,
  SAUTORIZACAOCURSO.PORTRECONHECIMENTO, 
  SAUTORIZACAOCURSO.DTDOURECONHECIMENTO, 
  SHABILITACAOALUNO.DTCOLACAOGRAU,
  SHABILITACAOFILIAL.CODCOLIGADA, 
  SHABILITACAOFILIAL.IDHABILITACAOFILIAL, 
  NULL ISMATRICPLNULL  
FROM SHABILITACAOFILIAL (NOLOCK) JOIN SHABILITACAOALUNO (NOLOCK)
      ON (SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
          AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  LEFT JOIN SAUTORIZACAOCURSO (NOLOCK)
      ON (SAUTORIZACAOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
      AND SAUTORIZACAOCURSO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
      AND SAUTORIZACAOCURSO.CODAUTORIZACURSO = (SELECT MAX(CODAUTORIZACURSO)
                                                FROM SAUTORIZACAOCURSO SAUTORIZACAOCURSO2 (NOLOCK)
                                                WHERE SAUTORIZACAOCURSO2.CODCOLIGADA = SAUTORIZACAOCURSO.CODCOLIGADA
                                                  AND SAUTORIZACAOCURSO2.IDHABILITACAOFILIAL = SAUTORIZACAOCURSO.IDHABILITACAOFILIAL))
  JOIN SALUNO (NOLOCK) 
      ON (SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA 
          AND SALUNO.RA = SHABILITACAOALUNO.RA)
  JOIN SCURSO (NOLOCK) 
      ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA 
          AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN PPESSOA (NOLOCK) 
      ON (PPESSOA.CODIGO = SALUNO.CODPESSOA)
  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  JOIN GFILIAL (NOLOCK) 
     ON (GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
         AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL)
  JOIN SHABILITACAO (NOLOCK) 
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO 
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
WHERE SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA_N
  AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO_S
  AND SHABILITACAOALUNO.RA = :RA_S
  AND SHABILITACAOFILIAL.CODHABILITACAO = :CODHABILITACAO_S";;;;;;;0;1;1;1;;;;;fd9ce231-9a19-42b7-8307-3b23167c53c2;;;15385;mestre;28/07/2021;mestre;28/07/2021;
S;Rel_Edu028_1;Histórico ES - Aproveitamento de Estudos;"SELECT 
  SHISTDISCAPROVESTUDOSORIGEM.CODDISC, 
  SHISTDISCAPROVESTUDOSORIGEM.DISCIPLINA, 
  SHISTDISCAPROVESTUDOSORIGEM.STATUS, 
  SHISTDISCAPROVESTUDOSORIGEM.PLETIVO, 
  SHISTDISCAPROVESTUDOSORIGEM.NOTA, 
  SHISTDISCAPROVESTUDOSORIGEM.FALTAS, 
  SHISTDISCAPROVESTUDOSORIGEM.CH,
  SHISTDISCAPROVESTUDOSORIGEM.NUMCREDITOS,
  SHISTDISCAPROVESTUDOSORIGEM.CONCEITO,
  SHISTDISCAPROVESTUDOSORIGEM.CONCEITOECTS,
  SHISTDISCAPROVESTUDOSORIGEM.CODDISCAPROV
FROM 
  SHISTDISCAPROVESTUDOSORIGEM (NOLOCK)
WHERE
  SHISTDISCAPROVESTUDOSORIGEM.CODCOLIGADA = :P_CODCOLIGADA AND
  SHISTDISCAPROVESTUDOSORIGEM.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL AND
  SHISTDISCAPROVESTUDOSORIGEM.RA = :P_RA";;;;;;;0;1;1;1;;;;;;;12.1.21;31478;mestre;08/03/2021;mestre;08/03/2021;
S;Rel_Edu028_2;Histórico ES - Disciplinas Equivalentes concluídas;"SELECT SHISTDISCEQUIVCONCLUIDAS.CODDISC,
  SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA,
  SHISTDISCEQUIVCONCLUIDAS.PLETIVO,
  SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS,
  SHISTDISCEQUIVCONCLUIDAS.CH,
  SHISTDISCEQUIVCONCLUIDAS.FALTAS,
  SHISTDISCEQUIVCONCLUIDAS.NOTA,
  SHISTDISCEQUIVCONCLUIDAS.STATUS,
  SHISTDISCEQUIVCONCLUIDAS.CONCEITO,
  SHISTDISCEQUIVCONCLUIDAS.CONCEITOECTS
FROM SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = :P_CODCOLIGADA AND
  SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL AND
  SHISTDISCEQUIVCONCLUIDAS.RA = :P_RA";;;;;;;0;1;1;1;;;;;;;12.1.21;32492;mestre;08/03/2021;mestre;08/03/2021;
S;Rel_Edu028_3;Histórico ES - Disciplinas concluídas;"SELECT ANALISECURRICULAR.CODDISC,
       ANALISECURRICULAR.DISCIPLINA,
       ANALISECURRICULAR.STATUS,
       ANALISECURRICULAR.PLETIVO,
       ANALISECURRICULAR.NUMCREDITOS,
       ANALISECURRICULAR.CH,
       ANALISECURRICULAR.NOTA,
       ANALISECURRICULAR.FALTAS,
       ANALISECURRICULAR.CODCOLIGADA,
       ANALISECURRICULAR.IDHABILITACAOFILIAL,
       ANALISECURRICULAR.RA,
       ANALISECURRICULAR.GREQUIV,
       ANALISECURRICULAR.CODPERIODO,
       ANALISECURRICULAR.CONCEITO,
       ANALISECURRICULAR.CONCEITOECTS,
       ANALISECURRICULAR.MINCH,
       ANALISECURRICULAR.MINCREDITOS,
       ANALISECURRICULAR.MINDISCIPLINAS,
       ANALISECURRICULAR.NOME,
       ANALISECURRICULAR.TIPOAVALIACAO
FROM   (SELECT SHISTDISCCONCLUIDAS.CODDISC,
               SHISTDISCCONCLUIDAS.DISCIPLINA,
               SHISTDISCCONCLUIDAS.STATUS,
               SHISTDISCCONCLUIDAS.PLETIVO,
               SHISTDISCCONCLUIDAS.NUMCREDITOS,
               SHISTDISCCONCLUIDAS.CH,
               SHISTDISCCONCLUIDAS.NOTA,
               SHISTDISCCONCLUIDAS.FALTAS,
               SHISTDISCCONCLUIDAS.CODCOLIGADA,
               SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
               SHISTDISCCONCLUIDAS.RA,
               SHISTDISCCONCLUIDAS.GREQUIV,
               SHISTDISCCONCLUIDAS.CODPERIODO,
               SHISTDISCCONCLUIDAS.CONCEITO,
               SHISTDISCCONCLUIDAS.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCCONCLUIDAS (NOLOCK)
        WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = :P_CODCOLIGADA
               AND SHISTDISCCONCLUIDAS.RA = :P_RA
               AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
               AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELET.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELET.MINCH,
               SGRUPOOPTELET.MINCREDITOS,
               SGRUPOOPTELET.MINDISCIPLINAS,
               SGRUPOOPTELET.NOME,
               SGRUPOOPTELET.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.RA = :P_RA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL )
               JOIN SGRUPOOPTELET (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
                      AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
                      AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
                      AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
               JOIN SDISCGRUPOOPTELET (NOLOCK)
                 ON ( SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
                      AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
                      AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
                      AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
                      AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :P_CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL_N
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND SPARAM.TEXTO = '1'
               AND SGRUPOOPTELET.EXIBEANALISE = 'S'
               AND SGRADEALUNO.RA IS NULL
               AND ((SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL)
                     OR (SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ))
               AND SHISTDISCOPTELETIVAS.RA NOT IN (SELECT SCOMPONENTECURRALUNO.RA
                                                   FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                   WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELETALUNO.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELETALUNO.MINCH,
               SGRUPOOPTELETALUNO.MINCREDITOS,
               SGRUPOOPTELETALUNO.MINDISCIPLINAS,
               SGRUPOOPTELETALUNO.NOME,
               SGRUPOOPTELETALUNO.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.RA = :P_RA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL )
               JOIN SGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
               JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
                      AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :P_CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL_N
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND SPARAM.TEXTO = '1'
               AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
               AND ((SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL)
                     OR (SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ))               
               AND ( SGRADEALUNO.RA IS NOT NULL
                      OR SHISTDISCOPTELETIVAS.RA IN (SELECT SCOMPONENTECURRALUNO.RA
                                                     FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                     WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                            AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                            AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA) )) ANALISECURRICULAR
ORDER  BY ANALISECURRICULAR.RA,
          ANALISECURRICULAR.CODPERIODO,
          ANALISECURRICULAR.NOME";;;;;;;0;1;1;1;;;;;;;12.1.21;27476;mestre;08/03/2021;mestre;08/03/2021;
S;Rel_Edu028_4;Histórico ES -  Disciplinas eletivas e optativas concluídas;"SELECT 
  SHISTDISCOPTELETIVAS.CODDISC, 
  SHISTDISCOPTELETIVAS.DISCIPLINA, 
  SHISTDISCOPTELETIVAS.STATUS, 
  SHISTDISCOPTELETIVAS.CODSTATUSRES,    
  SHISTDISCOPTELETIVAS.PLETIVO, 
  SHISTDISCOPTELETIVAS.NUMCREDITOS,
  SHISTDISCOPTELETIVAS.CH,
  SHISTDISCOPTELETIVAS.NOTA, 
  SHISTDISCOPTELETIVAS.FALTAS, 
  SHISTDISCOPTELETIVAS.TIPO,
  SHISTDISCOPTELETIVAS.CODCOLIGADA,
  SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
  SHISTDISCOPTELETIVAS.RA,
  SHISTDISCOPTELETIVAS.GREQUIV,
  SHISTDISCOPTELETIVAS.CONCEITO,
  SHISTDISCOPTELETIVAS.CONCEITOECTS
FROM SPARAM (NOLOCK) LEFT JOIN SHISTDISCOPTELETIVAS (NOLOCK) 
    ON (SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
        AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA 
        AND SHISTDISCOPTELETIVAS.RA = :P_RA
        AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
        AND ((SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL)
              OR 
             (SHISTDISCOPTELETIVAS.STATUS = '*Equiv')))
WHERE SPARAM.CODCOLIGADA = :P_CODCOLIGADA 
  AND SPARAM.CODFILIAL = :CODFILIAL_N
  AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
  AND SPARAM.TEXTO = '0' 
";;;;;;;0;1;1;1;;;;;;;12.1.21;-22798;mestre;08/03/2021;mestre;08/03/2021;
S;Rel_Edu028_5;Histórico ES -  Atividades Curriculares concluídas;"SELECT
  SHISTATVIDADEALUNO.MODALIDADE, 
  SHISTATVIDADEALUNO.DESCRICAO, 
  SHISTATVIDADEALUNO.PLETIVO, 
  SHISTATVIDADEALUNO.CREDITOS, 
  SHISTATVIDADEALUNO.CH,
  SHISTATVIDADEALUNO.CODCOLIGADA,  
  SHISTATVIDADEALUNO.IDHABILITACAOFILIAL,
  SHISTATVIDADEALUNO.RA,
  SHISTATVIDADEALUNO.CUMPRIUATIVIDADE
FROM SHISTATVIDADEALUNO (NOLOCK)
WHERE SHISTATVIDADEALUNO.CODCOLIGADA = :P_CODCOLIGADA
  AND SHISTATVIDADEALUNO.RA = :P_RA
  AND SHISTATVIDADEALUNO.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL  
  AND SHISTATVIDADEALUNO.CUMPRIUATIVIDADE = 'S'";;;;;;;0;1;1;1;;;;;;;12.1.21;-23248;mestre;08/03/2021;mestre;08/03/2021;
S;Rel_Edu028_6;Histórico ES - Disciplinas Extras Concluídas;"SELECT SDISCNAOAPROVEITADAS.CODDISC,
  SDISCIPLINA.NOME  AS DISCIPLINA,
  SPLETIVO.CODPERLET AS PLETIVO,
  SDISCNAOAPROVEITADAS.NUMCREDITOS,
  SDISCNAOAPROVEITADAS.CH,
  SDISCNAOAPROVEITADAS.FALTAS,
  SDISCNAOAPROVEITADAS.NOTA,
  SSTATUS.DESCRICAO AS STATUS,
  SDISCNAOAPROVEITADAS.CONCEITO,
  SDISCNAOAPROVEITADAS.CONCEITOECTS,
  SDISCNAOAPROVEITADAS.CUMPRIU
FROM SPARAM (NOLOCK) LEFT JOIN SDISCNAOAPROVEITADAS (NOLOCK) 
     ON (SPARAM.CODCOLIGADA = SDISCNAOAPROVEITADAS.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODCOLIGADA = :P_CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
         AND SDISCNAOAPROVEITADAS.RA = :P_RA
         AND SDISCNAOAPROVEITADAS.CUMPRIU = 'S')
  LEFT JOIN SDISCIPLINA (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODDISC = SDISCIPLINA.CODDISC)
  LEFT JOIN SSTATUS (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.CODSTATUS = SSTATUS.CODSTATUS)
  LEFT JOIN SPLETIVO (NOLOCK)
     ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SDISCNAOAPROVEITADAS.IDPERLET = SPLETIVO.IDPERLET)
WHERE SPARAM.CODCOLIGADA = :P_CODCOLIGADA
  AND SPARAM.CODFILIAL  = :CODFILIAL_N
  AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SPARAM.ID = 'EXIBIRDISCEXTRA'
  AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')";;;;;;;0;1;1;1;;;;;;;12.1.21;-29304;mestre;08/03/2021;mestre;08/03/2021;
S;Rel_Edu028_7;Histórico ES -  Professores das disciplinas;"SELECT ANALISECURRICULAR.CODDISC,
       ANALISECURRICULAR.DISCIPLINA,
       PROFESSOR.NOMEPROFESSOR,
       PROFESSOR.TITULACAO
FROM (SELECT SHISTDISCCONCLUIDAS.CODCOLIGADA,
             SHISTDISCCONCLUIDAS.RA,
             SHISTDISCCONCLUIDAS.CODDISC,
             SHISTDISCCONCLUIDAS.DISCIPLINA,
             SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
             SHISTDISCCONCLUIDAS.IDPERLET,
             SHISTDISCCONCLUIDAS.IDTURMADISC
      FROM SHISTDISCCONCLUIDAS (NOLOCK)
      WHERE SHISTDISCCONCLUIDAS.CODCOLIGADA = :P_CODCOLIGADA
        AND SHISTDISCCONCLUIDAS.RA = :P_RA
        AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
        AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0
     UNION
      SELECT SHISTDISCOPTELETIVAS.CODCOLIGADA,
             SHISTDISCOPTELETIVAS.RA,
             SHISTDISCOPTELETIVAS.CODDISC,
             SHISTDISCOPTELETIVAS.DISCIPLINA,
             SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
             SHISTDISCOPTELETIVAS.IDPERLET,
             SHISTDISCOPTELETIVAS.IDTURMADISC
      FROM SPARAM (NOLOCK)
           JOIN SHISTDISCOPTELETIVAS (NOLOCK)
             ON (SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.RA = :P_RA
             AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL)
           JOIN SHABILITACAOFILIAL (NOLOCK)
             ON (SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
             AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL )
           JOIN SGRUPOOPTELET (NOLOCK)
             ON (SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
             AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
             AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
             AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
           JOIN SDISCGRUPOOPTELET (NOLOCK)
             ON (SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
             AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
             AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
             AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
             AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
             AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
           LEFT JOIN SGRADEALUNO (NOLOCK)
             ON (SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
             AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
      WHERE SPARAM.CODCOLIGADA = :P_CODCOLIGADA
        AND SPARAM.CODFILIAL = :CODFILIAL_N
        AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
        AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
        AND SPARAM.TEXTO = '1'
        AND SGRUPOOPTELET.EXIBEANALISE = 'S'
        AND SGRADEALUNO.RA IS NULL
        AND ((SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL) OR
             (SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ))
        AND NOT EXISTS (SELECT SCOMPONENTECURRALUNO.RA
                        FROM SCOMPONENTECURRALUNO (NOLOCK)
                        WHERE SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)
     UNION
      SELECT SHISTDISCOPTELETIVAS.CODCOLIGADA,
             SHISTDISCOPTELETIVAS.RA,
             SHISTDISCOPTELETIVAS.CODDISC,
             SHISTDISCOPTELETIVAS.DISCIPLINA,
             SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
             SHISTDISCOPTELETIVAS.IDPERLET,
             SHISTDISCOPTELETIVAS.IDTURMADISC
      FROM SPARAM (NOLOCK)
           JOIN SHISTDISCOPTELETIVAS (NOLOCK)
             ON (SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.RA = :P_RA
             AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL)
           JOIN SGRUPOOPTELETALUNO (NOLOCK)
             ON (SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
             AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
           JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
             ON (SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
             AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
             AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
             AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
             AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
           LEFT JOIN SGRADEALUNO (NOLOCK)
             ON (SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
             AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
      WHERE SPARAM.CODCOLIGADA = :P_CODCOLIGADA
        AND SPARAM.CODFILIAL = :CODFILIAL_N
        AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
        AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
        AND SPARAM.TEXTO = '1'
        AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
        AND ((SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL) OR
             (SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ))               
        AND (SGRADEALUNO.RA IS NOT NULL OR 
             EXISTS (SELECT SCOMPONENTECURRALUNO.RA
                     FROM SCOMPONENTECURRALUNO (NOLOCK)
                     WHERE SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                       AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                       AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA))
     UNION
      SELECT SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA,
             SHISTDISCEQUIVCONCLUIDAS.RA,
             SHISTDISCEQUIVCONCLUIDAS.CODDISC,
             SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA,
             SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL,
             SHISTDISCEQUIVCONCLUIDAS.IDPERLET,
             SHISTDISCEQUIVCONCLUIDAS.IDTURMADISC
      FROM SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
      WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = :P_CODCOLIGADA
        AND SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
        AND SHISTDISCEQUIVCONCLUIDAS.RA = :P_RA
     UNION
      SELECT 
        SHISTDISCOPTELETIVAS.CODCOLIGADA,
        SHISTDISCOPTELETIVAS.RA,
        SHISTDISCOPTELETIVAS.CODDISC,
        SHISTDISCOPTELETIVAS.DISCIPLINA,
        SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
        SHISTDISCOPTELETIVAS.IDPERLET,
        SHISTDISCOPTELETIVAS.IDTURMADISC
      FROM SPARAM (NOLOCK)
           LEFT JOIN SHISTDISCOPTELETIVAS (NOLOCK) 
             ON (SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :P_CODCOLIGADA
             AND SHISTDISCOPTELETIVAS.RA = :P_RA
             AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
             AND ((SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL) OR 
                  (SHISTDISCOPTELETIVAS.STATUS = '*Equiv')))
      WHERE SPARAM.CODCOLIGADA = :P_CODCOLIGADA
        AND SPARAM.CODFILIAL = :CODFILIAL_N
        AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
        AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
        AND SPARAM.TEXTO = '0') ANALISECURRICULAR
     LEFT JOIN
     (SELECT SPLETIVO.CODCOLIGADA,
             SPLETIVO.IDPERLET,
	         SPROFESSORTURMA.IDTURMADISC,
             PPESSOA.NOME NOMEPROFESSOR,
             STITULACAO.NOME TITULACAO
      FROM SPLETIVO (NOLOCK)
           JOIN SPROFESSORTURMA
	         ON (SPROFESSORTURMA.CODCOLIGADA = SPLETIVO.CODCOLIGADA
             AND ((SPROFESSORTURMA.DTINICIO BETWEEN SPLETIVO.DTINICIO AND SPLETIVO.DTFIM) OR
                  (SPROFESSORTURMA.DTFIM BETWEEN SPLETIVO.DTINICIO AND SPLETIVO.DTFIM) OR
                  (SPROFESSORTURMA.DTINICIO <= SPLETIVO.DTFIM AND (SPROFESSORTURMA.DTFIM IS NULL OR SPROFESSORTURMA.DTFIM >=SPLETIVO.DTINICIO))))
	       JOIN SPROFESSOR
	         ON (SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
             AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF)
	       JOIN PPESSOA
	         ON (PPESSOA.CODIGO = SPROFESSOR.CODPESSOA)
           LEFT JOIN STITULACAO (NOLOCK)
             ON (STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO)) PROFESSOR
       ON (PROFESSOR.CODCOLIGADA = ANALISECURRICULAR.CODCOLIGADA
       AND PROFESSOR.IDPERLET = ANALISECURRICULAR.IDPERLET
       AND PROFESSOR.IDTURMADISC = ANALISECURRICULAR.IDTURMADISC)
WHERE NOT EXISTS (SELECT *
                  FROM SHISTDISCAPROVESTUDOSORIGEM (NOLOCK)
                  WHERE SHISTDISCAPROVESTUDOSORIGEM.CODCOLIGADA = ANALISECURRICULAR.CODCOLIGADA
	                AND SHISTDISCAPROVESTUDOSORIGEM.RA = ANALISECURRICULAR.RA
	                AND SHISTDISCAPROVESTUDOSORIGEM.CODDISCAPROV = ANALISECURRICULAR.CODDISC
	                AND SHISTDISCAPROVESTUDOSORIGEM.IDHABILITACAOFILIAL = ANALISECURRICULAR.IDHABILITACAOFILIAL)
UNION
SELECT SHISTDISCAPROVESTUDOSORIGEM.CODDISC,
       SHISTDISCAPROVESTUDOSORIGEM.DISCIPLINA,
       SHISTDISCFACEXTPROF.NOMEPROF NOMEPROFESSOR,
       SHISTDISCFACEXTPROF.TITULACAO
FROM SHISTDISCAPROVESTUDOSORIGEM (NOLOCK)
     LEFT JOIN SHISTDISCFACEXTPROF (NOLOCK)
      ON (SHISTDISCFACEXTPROF.CODCOLIGADA = SHISTDISCAPROVESTUDOSORIGEM.CODCOLIGADA
      AND SHISTDISCFACEXTPROF.RA = SHISTDISCAPROVESTUDOSORIGEM.RA
      AND SHISTDISCFACEXTPROF.CODDISC = SHISTDISCAPROVESTUDOSORIGEM.CODDISCAPROV
      AND SHISTDISCFACEXTPROF.IDHABILITACAOFILIAL = SHISTDISCAPROVESTUDOSORIGEM.IDHABILITACAOFILIAL)
WHERE SHISTDISCAPROVESTUDOSORIGEM.CODCOLIGADA = :P_CODCOLIGADA
  AND SHISTDISCAPROVESTUDOSORIGEM.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
  AND SHISTDISCAPROVESTUDOSORIGEM.RA = :P_RA
UNION
SELECT SDISCNAOAPROVEITADAS.CODDISC,
       SDISCIPLINA.NOME  AS DISCIPLINA,
       PPESSOA.NOME NOMEPROFESSOR,
       STITULACAO.NOME TITULACAO
FROM SDISCNAOAPROVEITADAS (NOLOCK)
     JOIN SDISCIPLINA (NOLOCK)
       ON (SDISCNAOAPROVEITADAS.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
       AND SDISCNAOAPROVEITADAS.CODDISC = SDISCIPLINA.CODDISC)
     LEFT JOIN SHISTDISCFACPROF (NOLOCK)
       ON (SHISTDISCFACPROF.CODCOLIGADA = SDISCNAOAPROVEITADAS.CODCOLIGADA
	   AND SHISTDISCFACPROF.RA = SDISCNAOAPROVEITADAS.RA
	   AND SHISTDISCFACPROF.CODDISC = SDISCNAOAPROVEITADAS.CODDISC
	   AND SHISTDISCFACPROF.IDHABILITACAOFILIAL = SDISCNAOAPROVEITADAS.IDHABILITACAOFILIAL)
     LEFT JOIN SPROFESSOR (NOLOCK)
	   ON (SPROFESSOR.CODCOLIGADA = SHISTDISCFACPROF.CODCOLIGADA
       AND SPROFESSOR.CODPROF = SHISTDISCFACPROF.CODPROF)
     LEFT JOIN PPESSOA (NOLOCK)
       ON (PPESSOA.CODIGO = SPROFESSOR.CODPESSOA)
     LEFT JOIN STITULACAO (NOLOCK)
       ON (STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO)
WHERE SDISCNAOAPROVEITADAS.CODCOLIGADA = :P_CODCOLIGADA
  AND SDISCNAOAPROVEITADAS.IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
  AND SDISCNAOAPROVEITADAS.RA = :P_RA
  AND SDISCNAOAPROVEITADAS.CUMPRIU = 'S'
  AND EXISTS(SELECT *
             FROM SPARAM (NOLOCK)
			 WHERE SDISCNAOAPROVEITADAS.CODCOLIGADA = SPARAM.CODCOLIGADA
               AND SPARAM.CODFILIAL  = :CODFILIAL_N
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO_N
               AND SPARAM.ID = 'EXIBIRDISCEXTRA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S'))";;;;;;;0;1;1;1;;;;;;;12.1.21;-29718;mestre;08/03/2021;mestre;08/03/2021;
S;Rel_Edu028_8;Histórico ES -  Situação no ENADE;"SELECT DTMATRICULA, SELINSTENADE, SELMECENADE, COMPARECEUENADE
FROM SMATRICPL (NOLOCK)
WHERE SELINSTENADE IN ('I', 'C')
  AND SELMECENADE IN ('S', 'N')
  AND CODCOLIGADA = :P_CODCOLIGADA
  AND IDHABILITACAOFILIAL = :P_IDHABILITACAOFILIAL
  AND RA = :P_RA";;;;;;;0;1;1;1;;;;;;;12.1.21;32434;mestre;08/03/2021;mestre;08/03/2021;
S;Rel_Edu029;Relação de turmas do professor;"SELECT 
  SPROFESSOR.CODCOLIGADA, 
  SPROFESSOR.CODPROF, 
  PPESSOA.NOME AS NOMEPROFESSOR
FROM SPROFESSOR (NOLOCK) JOIN PPESSOA (NOLOCK)
     ON (SPROFESSOR.CODPESSOA = PPESSOA.CODIGO)
WHERE SPROFESSOR.CODCOLIGADA = :CODCOLIGADA_N
  AND SPROFESSOR.CODPROF BETWEEN :CODPROFDE_S AND :CODPROFATE_S
  AND SPROFESSOR.CODPROF IN 
       (SELECT SPROFESSORTURMA.CODPROF
        FROM STURMADISC (NOLOCK) JOIN SPROFESSORTURMA (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND
               STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)
         JOIN SPLETIVO (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA 
               AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
         JOIN SHORARIOPROFESSOR (NOLOCK)
           ON (SPROFESSORTURMA.CODCOLIGADA = SHORARIOPROFESSOR.CODCOLIGADA
               AND SPROFESSORTURMA.IDPROFESSORTURMA = SHORARIOPROFESSOR.IDPROFESSORTURMA)
         LEFT JOIN SPARAM (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPARAM.CODCOLIGADA AND
               STURMADISC.CODFILIAL = SPARAM.CODFILIAL AND
               STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
               SPARAM.ID = 'UTITURMAGERENCIALDIG')
        WHERE SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA 
          AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
          AND (SPROFESSORTURMA.DTFIM >= :DATAATUAL_D OR SPROFESSORTURMA.DTFIM IS NULL)
          AND STURMADISC.ATIVA = 'S'
          AND (((SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S') AND 
               ((STURMADISC.GERENCIAL = 'S') OR  
                (STURMADISC.IDTURMADISC NOT IN (SELECT IDTURMADISCGERENCIADA 
                              FROM STURMADISCGERENCIADA (NOLOCK)
                           WHERE CODCOLIGADA = STURMADISC.CODCOLIGADA /*AND*/)))) OR
             ((SPARAM.TEXTO = '0' OR SPARAM.TEXTO = 'N' OR SPARAM.TEXTO IS NULL) AND STURMADISC.GERENCIAL = 'N'))
       AND STURMADISC.CODFILIAL = :CODFILIAL
       AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N
          AND SPLETIVO.CODPERLET = :CODPERLET_S /*AND*/) /*AND*/
ORDER BY SPROFESSOR.CODCOLIGADA, SPROFESSOR.CODPROF ";2159;;;;11/02/2022;lucas.ssantos;0;1;1;1;;;;;4d6ceaf4-077b-40b2-ba91-75cd434ed5c4;;;-19169;mestre;27/07/2021;lucas.ssantos;11/02/2022;
S;Rel_Edu029.1;Relação de turmas do Professor Tricamp;"SELECT DISTINCT
  SPROFESSOR.CODCOLIGADA, 
  SPROFESSOR.CODPROF, 
  PPESSOA.NOME AS NOMEPROFESSOR,
  STURMADISC.CODFILIAL
FROM SPROFESSOR (NOLOCK) JOIN PPESSOA (NOLOCK)
     ON (SPROFESSOR.CODPESSOA = PPESSOA.CODIGO)
	INNER JOIN SPROFESSORTURMA ON SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
		AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
	INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
		AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
WHERE SPROFESSOR.CODCOLIGADA = :CODCOLIGADA_N
  AND SPROFESSOR.CODPROF BETWEEN :CODPROFDE_S AND :CODPROFATE_S
  AND SPROFESSOR.CODPROF IN 
       (SELECT SPROFESSORTURMA.CODPROF
        FROM STURMADISC (NOLOCK) JOIN SPROFESSORTURMA (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND
               STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)
         JOIN SPLETIVO (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA 
               AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
         JOIN SHORARIOPROFESSOR (NOLOCK)
           ON (SPROFESSORTURMA.CODCOLIGADA = SHORARIOPROFESSOR.CODCOLIGADA
               AND SPROFESSORTURMA.IDPROFESSORTURMA = SHORARIOPROFESSOR.IDPROFESSORTURMA)
         LEFT JOIN SPARAM (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPARAM.CODCOLIGADA AND
               STURMADISC.CODFILIAL = SPARAM.CODFILIAL AND
               STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
               SPARAM.ID = 'UTITURMAGERENCIALDIG')
        WHERE SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA 
          AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
          AND (SPROFESSORTURMA.DTFIM >= :DATAATUAL_D OR SPROFESSORTURMA.DTFIM IS NULL)
          AND STURMADISC.ATIVA = 'S'
          AND (((SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S') AND 
               ((STURMADISC.GERENCIAL = 'S') OR  
                (STURMADISC.IDTURMADISC NOT IN (SELECT IDTURMADISCGERENCIADA 
                              FROM STURMADISCGERENCIADA (NOLOCK)
                           WHERE CODCOLIGADA = STURMADISC.CODCOLIGADA /*AND*/)))) OR
             ((SPARAM.TEXTO = '0' OR SPARAM.TEXTO = 'N' OR SPARAM.TEXTO IS NULL) AND STURMADISC.GERENCIAL = 'N'))
       /*AND STURMADISC.CODFILIAL = :CODFILIAL*/
       AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N
          AND SPLETIVO.CODPERLET = :CODPERLET_S /*AND*/) /*AND*/
          
          
  AND SPROFESSORTURMA.IDTURMADISC IN 
       (SELECT STURMADISC.IDTURMADISC
        FROM STURMADISC (NOLOCK) JOIN SPROFESSORTURMA (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND
               STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)
         JOIN SPLETIVO (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA 
               AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
         JOIN SHORARIOPROFESSOR (NOLOCK)
           ON (SPROFESSORTURMA.CODCOLIGADA = SHORARIOPROFESSOR.CODCOLIGADA
               AND SPROFESSORTURMA.IDPROFESSORTURMA = SHORARIOPROFESSOR.IDPROFESSORTURMA)
         LEFT JOIN SPARAM (NOLOCK)
           ON (STURMADISC.CODCOLIGADA = SPARAM.CODCOLIGADA AND
               STURMADISC.CODFILIAL = SPARAM.CODFILIAL AND
               STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
               SPARAM.ID = 'UTITURMAGERENCIALDIG')
        WHERE SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA 
          AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF
          AND (SPROFESSORTURMA.DTFIM >= :DATAATUAL_D OR SPROFESSORTURMA.DTFIM IS NULL)
          AND STURMADISC.ATIVA = 'S'
          AND (((SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S') AND 
               ((STURMADISC.GERENCIAL = 'S') OR  
                (STURMADISC.IDTURMADISC NOT IN (SELECT IDTURMADISCGERENCIADA 
                              FROM STURMADISCGERENCIADA (NOLOCK)
                           WHERE CODCOLIGADA = STURMADISC.CODCOLIGADA /*AND*/)))) OR
             ((SPARAM.TEXTO = '0' OR SPARAM.TEXTO = 'N' OR SPARAM.TEXTO IS NULL) AND STURMADISC.GERENCIAL = 'N'))
       /*AND STURMADISC.CODFILIAL = :CODFILIAL*/
       AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N
          AND SPLETIVO.CODPERLET = :CODPERLET_S /*AND*/) /*AND*/
          
          
ORDER BY SPROFESSOR.CODCOLIGADA, SPROFESSOR.CODPROF ";4337;;;;08/03/2022;consultor1.totvs;0;1;1;1;;;;0;897c175a-b5ec-4334-b568-09408ebec346;0;;11320;consultor1.totvs;22/02/2022;consultor1.totvs;08/03/2022;0
S;Rel_Edu029_1;Relação das turmas/disciplinas do professor;"SELECT 
  SPROFESSORTURMA.CODPROF,
  SPLETIVO.CODPERLET,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.IDPERLET,
  STURMADISC.CODTURMA,  
  STURMADISC.CODDISC,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA,
    ISNULL(SCURSO.NOME,'GERENCIAL') AS NOMECURSO,
  ISNULL(SHABILITACAO.NOME,'GERENCIAL') AS NOMEHABILITACAO,
  STURNO.NOME AS NOMETURNO
FROM SPROFESSORTURMA (NOLOCK) JOIN STURMADISC (NOLOCK)
    ON (SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
        AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC)
  JOIN SPLETIVO (NOLOCK)
    ON (SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
        AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET)
  JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA 
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
 /*Modificado em 22/02/2022 Nathan PVT - Deixado como left para tratar as disciplinas gerenciais que não estão vinculadas a cursos.*/
 LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
 LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
LEFT  JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
LEFT  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)         
  LEFT JOIN SPARAM (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAM.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAM.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
         SPARAM.ID = 'UTITURMAGERENCIALDIG')         
WHERE STURMADISC.CODCOLIGADA = :P_CODCOLIGADA
  AND SPROFESSORTURMA.CODPROF = :P_CODPROF
  AND STURMADISC.CODFILIAL = :CODFILIAL
  AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N
  AND STURMADISC.ATIVA = 'S'
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND (((SPARAM.TEXTO = 1) AND 
       ((STURMADISC.GERENCIAL = 'S') OR  
        (STURMADISC.IDTURMADISC NOT IN (SELECT IDTURMADISCGERENCIADA 
                               FROM STURMADISCGERENCIADA (NOLOCK)
                         WHERE CODCOLIGADA = STURMADISC.CODCOLIGADA /*AND*/)))) OR
       ((SPARAM.TEXTO = 0 OR SPARAM.TEXTO IS NULL) AND STURMADISC.GERENCIAL = 'N'))  
  AND (SPROFESSORTURMA.DTFIM IS NULL OR SPROFESSORTURMA.DTFIM >= :DATAATUAL_D)
  AND SPROFESSORTURMA.IDPROFESSORTURMA IN (SELECT SHORARIOPROFESSOR.IDPROFESSORTURMA
                                           FROM SHORARIOPROFESSOR (NOLOCK)
                                           WHERE SHORARIOPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
                                             AND SHORARIOPROFESSOR.IDPROFESSORTURMA = SPROFESSORTURMA.IDPROFESSORTURMA /*AND*/) /*AND*/
GROUP BY SPROFESSORTURMA.CODPROF,
  SPLETIVO.CODPERLET,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.IDPERLET,
  STURMADISC.CODTURMA,  
  STURMADISC.CODDISC,
  SDISCIPLINA.NOME,
  SCURSO.NOME,
  SHABILITACAO.NOME,
  STURNO.NOME
ORDER BY SPROFESSORTURMA.CODPROF ";3441;;;;22/02/2022;consultor1.totvs;0;1;1;1;;;;;5c197408-c2d5-43d9-bc6c-2cb535053e5e;;;15477;mestre;27/07/2021;consultor1.totvs;22/02/2022;
S;Rel_Edu029_1.1;Relação das turmas/disciplinas do professor Tricamp;"SELECT 
  SPROFESSORTURMA.CODPROF,
  SPLETIVO.CODPERLET,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  GFILIAL.NOMEFANTASIA AS 'NOMEFILIAL',
  STURMADISC.IDPERLET,
  STURMADISC.CODTURMA,  
  STURMADISC.CODDISC,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA,
    ISNULL(SCURSO.NOME,'GERENCIAL') AS NOMECURSO,
  ISNULL(SHABILITACAO.NOME,'GERENCIAL') AS NOMEHABILITACAO,
  STURNO.NOME AS NOMETURNO
FROM SPROFESSORTURMA (NOLOCK) JOIN STURMADISC (NOLOCK)
    ON (SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
        AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC)
  JOIN SPLETIVO (NOLOCK)
    ON (SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
        AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET)
    INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
  	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
  JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA 
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
 /*Modificado em 22/02/2022 Nathan PVT - Deixado como left para tratar as disciplinas gerenciais que não estão vinculadas a cursos.*/
 LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
 LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
LEFT  JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
LEFT  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)         
  LEFT JOIN SPARAM (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAM.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAM.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
         SPARAM.ID = 'UTITURMAGERENCIALDIG')         
WHERE STURMADISC.CODCOLIGADA = :P_CODCOLIGADA
  AND SPROFESSORTURMA.CODPROF = :P_CODPROF
  AND STURMADISC.CODFILIAL = :CODFILIAL1
  AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N
  AND STURMADISC.ATIVA = 'S'
  AND SPLETIVO.CODPERLET = :CODPERLET_S
  AND (((SPARAM.TEXTO = 1) AND 
       ((STURMADISC.GERENCIAL = 'S') OR  
        (STURMADISC.IDTURMADISC NOT IN (SELECT IDTURMADISCGERENCIADA 
                               FROM STURMADISCGERENCIADA (NOLOCK)
                         WHERE CODCOLIGADA = STURMADISC.CODCOLIGADA /*AND*/)))) OR
       ((SPARAM.TEXTO = 0 OR SPARAM.TEXTO IS NULL) AND STURMADISC.GERENCIAL = 'N'))  
  AND (SPROFESSORTURMA.DTFIM IS NULL OR SPROFESSORTURMA.DTFIM >= :DATAATUAL_D)
  AND SPROFESSORTURMA.IDPROFESSORTURMA IN (SELECT SHORARIOPROFESSOR.IDPROFESSORTURMA
                                           FROM SHORARIOPROFESSOR (NOLOCK)
                                           WHERE SHORARIOPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
                                             AND SHORARIOPROFESSOR.IDPROFESSORTURMA = SPROFESSORTURMA.IDPROFESSORTURMA /*AND*/) /*AND*/
GROUP BY SPROFESSORTURMA.CODPROF,
  SPLETIVO.CODPERLET,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.IDPERLET,
  STURMADISC.CODTURMA, 
  GFILIAL.NOMEFANTASIA,
  STURMADISC.CODDISC,
  SDISCIPLINA.NOME,
  SCURSO.NOME,
  SHABILITACAO.NOME,
  STURNO.NOME
ORDER BY SPROFESSORTURMA.CODPROF ";3624;;;;08/03/2022;consultor1.totvs;0;1;1;1;;;;0;575907a9-707a-4b98-835d-443beef132ee;0;;-15752;consultor1.totvs;22/02/2022;consultor1.totvs;08/03/2022;0
S;Rel_Edu029_1.2;Relação Horário Disciplinas TRICAMP;"SELECT 
	SHORARIO.HORAINICIAL,
	SHORARIO.HORAFINAL,
	CASE SHORARIO.DIASEMANA
		WHEN 1 THEN 'Domingo'
		WHEN 2 THEN 'Segunda'
		WHEN 3 THEN 'Terça'
		WHEN 4 THEN 'Quarta'
		WHEN 5 THEN 'Quinta'
		WHEN 6 THEN 'Sexta'
		WHEN 7 THEN 'Sábado'
		END 'DiaSemana',
	SDISCIPLINA.CODDISC + ' - '+ SDISCIPLINA.NOME + ' Data Inicial: ' + CONVERT(VARCHAR,SHORARIOTURMA.DATAINICIAL,103) + ' Data Final: ' + CONVERT(VARCHAR,SHORARIOTURMA.DATAFINAL,103) AS 'DISC'
FROM SPROFESSORTURMA
INNER JOIN SHORARIOPROFESSOR ON SHORARIOPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND SHORARIOPROFESSOR.IDPROFESSORTURMA = SPROFESSORTURMA.IDPROFESSORTURMA
INNER JOIN SHORARIOTURMA ON SHORARIOTURMA.CODCOLIGADA = SHORARIOPROFESSOR.CODCOLIGADA
	AND SHORARIOTURMA.IDHORARIOTURMA = SHORARIOPROFESSOR.IDHORARIOTURMA
INNER JOIN SHORARIO ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA
	AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
INNER JOIN SDISCIPLINA ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
WHERE SPROFESSORTURMA.CODPROF = 464
AND SPLETIVO.CODPERLET = '2022/1'
AND SDISCIPLINA.NOME IN (
'Pré-cálculo',
'Cálculo I')
AND SHORARIO.HORAINICIAL = '19:45'";1467;;;;22/02/2022;consultor1.totvs;0;1;1;1;;;;0;4dea938c-7943-4054-89f1-e61d646065ea;0;;11670;consultor1.totvs;22/02/2022;consultor1.totvs;22/02/2022;0
S;Rel_Edu034;Relação de alunos aprovados - por turma/disciplina;"SELECT SMATRICULA.RA, 
  STURMADISC.CODCOLIGADA,
  STURMADISC.IDTURMADISC,  
  STURMADISC.CODFILIAL,
  STURMADISC.CODDISC,
  SMATRICULA.IDPERLET,
  SMATRICULA.IDHABILITACAOFILIAL,
  SMATRICULA.CODSTATUSRES,
  SSTATUS.DESCRICAO AS NOMESTATUS,
  STURMADISC.CODTURMA,
  SPLETIVO.CODPERLET,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  STURNO.NOME AS NOMETURNO,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA
FROM SMATRICULA (NOLOCK) JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
         SMATRICULA.CODSTATUSRES = SSTATUS.CODSTATUS)
  JOIN STURMADISC (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
         AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC)
  JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
  JOIN SPLETIVO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SMATRICULA.IDPERLET = SPLETIVO.IDPERLET)
  JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
  JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICULA.RA = SALUNO.RA)
  JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
  JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE STURMADISC.CODCOLIGADA = :CODCOLIGADA_N
  AND STURMADISC.CODFILIAL = :CODFILIAL_N
  AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SSTATUS.RESULTADO = 'S'
  AND SSTATUS.DICREDITOCURSADO = 'S'
  AND SSTATUS.DIVALIDAPRE = 'S'
  AND SSTATUS.DIEMCURSO = 'N'
  AND STURMADISC.IDHABILITACAOFILIAL BETWEEN :IDHABILITACAOFILIALDE_N AND :IDHABILITACAOFILIALATE_N
  AND STURMADISC.CODTURMA BETWEEN :CODTURMADE_S AND :CODTURMAATE_S
ORDER BY STURMADISC.CODCOLIGADA,
  STURMADISC.IDTURMADISC,
  PPESSOA.NOME";;;;;;;0;1;1;1;;;;;;;12.1;-20294;mestre;21/01/2021;mestre;21/01/2021;
S;Rel_Edu039;Requerimento de Matrícula;"SELECT 
  SALUNO.RA,
  PPESSOA.NOME AS NOMEALUNO,
  PPESSOA.NOMESOCIAL AS NOMESOCIALALUNO,
  PPESSOA.DTNASCIMENTO AS DTNASCIMENTOALUNO,
  PPESSOA.NATURALIDADE AS NATURALIDADEALUNO,
  PPESSOA.ESTADONATAL AS ESTADONATALALUNO,
  PPESSOA.SEXO AS SEXOALUNO,
  PPESSOA.CARTIDENTIDADE AS CARTIDENTIDADEALUNO,
  PPESSOA.DTEMISSAOIDENT AS DTEMISSAOIDENTALUNO,
  PPESSOA.ORGEMISSORIDENT AS ORGEMISSORIDENTALUNO,
  PPESSOA.UFCARTIDENT AS UFCARTIDENTALUNO,
  PPESSOA.CPF AS CPFALUNO,
  PPESSOA.RUA AS RUAALUNO,
  PPESSOA.COMPLEMENTO AS COMPLEMENTOALUNO,
  PPESSOA.BAIRRO AS BAIRROALUNO,
  PPESSOA.CIDADE AS CIDADEALUNO,
  PPESSOA.ESTADO AS ESTADOALUNO,
  PPESSOA.CEP AS CEPALUNO,
  SPESSOA.CERTNUMERO AS CERTNUMEROALUNO,
  SPESSOA.CERTDATA AS CERTDATAALUNO,
  SPESSOA.CERTUF AS CERTUFALUNO,
  SPESSOA.CERTLIVRO AS CERTLIVROALUNO,
  SPESSOA.CERTFOLHA AS CERTFOLHAALUNO,
  SPESSOA.CERTCARTORIO AS CERTCARTORIOALUNO,
  PPESSOA.TELEFONE1 AS TELEFONE1ALUNO,
  PPESSOA.TELEFONE2 AS TELEFONE2ALUNO,
  PPESSOA.EMAIL AS EMAILALUNO,
  SALUNOFICHAMEDICA.ALERGIA AS ALERGIAALUNO,
  SALUNOFICHAMEDICA.REMEDIO AS REMEDIOALUNO,
  SALUNOFICHAMEDICA.MEDICO AS MEDICOALUNO,
  SALUNOFICHAMEDICA.TRATAMENTO AS TRATAMENTOALUNO,
  SALUNOFICHAMEDICA.SOCHOSP AS SOCHOSPALUNO,
  SALUNOFICHAMEDICA.OUTRO AS OUTROALUNO,
  PPESSOA.DEFICIENTEVISUAL AS DEFICIENTEVISUALALUNO,
  PPESSOA.DEFICIENTEFISICO AS DEFICIENTEFISICOALUNO,
  PPESSOA.DEFICIENTEAUDITIVO AS DEFICIENTEAUDITIVOALUNO,
  PPESSOA.DEFICIENTEMENTAL AS DEFICIENTEMENTALALUNO,
  PCODNACAO.DESCRICAO AS NACIONALIDADEALUNO,
  PPESSOAPAI.NOME AS NOMEPAI,
  PPESSOAMAE.NOME AS NOMEMAE,
  PPESSOARESPACAD.NOME AS NOMERESPACADEMICO,
  
  FCFO.NOME AS NOMERESPFINANCEIRO,
  FCFO.RUA AS RUARESP,
  FCFO.COMPLEMENTO AS COMPLEMENTORESP,
  FCFO.BAIRRO AS BAIRRORESP,
  FCFO.CIDADE AS CIDADERESP,
  FCFO.CODETD AS ESTADORESP,
  FCFO.CEP AS CEPRESP,
  FCFO.EMAIL AS EMAILRESP,
  FCFO.CGCCFO AS CPFRESP,
  FCFO.TELEFONE AS TELEFONERESP,
  FCFO.TELEFONECOMERCIAL AS TELEFONECOMERCIALRESP,
  
  SPLETIVO.CODPERLET,
  SHABILITACAOFILIAL.CODFILIAL,
  SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDPERLET,
  SMATRICPL.IDHABILITACAOFILIAL,
  GFILIAL.CIDADE AS CIDADEFILIAL,
  GFILIAL.NOME AS NOMEFILIAL,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO
  
FROM SALUNO (NOLOCK) JOIN SPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = SPESSOA.CODIGO)
  JOIN PPESSOA (NOLOCK)
     ON (SPESSOA.CODIGO = PPESSOA.CODIGO)
  LEFT JOIN PPESSOA PPESSOARESPACAD (NOLOCK)
     ON (SALUNO.CODPESSOARACA = PPESSOARESPACAD.CODIGO)
  LEFT JOIN FCFO (NOLOCK)
     ON (SALUNO.CODCOLCFO = FCFO.CODCOLIGADA
         AND SALUNO.CODCFO = FCFO.CODCFO)
  LEFT JOIN SALUNOFICHAMEDICA (NOLOCK)
     ON (SALUNO.CODCOLIGADA = SALUNOFICHAMEDICA.CODCOLIGADA
         AND SALUNO.RA = SALUNOFICHAMEDICA.RA)
  LEFT JOIN PCODNACAO (NOLOCK)
     ON (PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE)

  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)
  JOIN SMATRICPL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICPL.RA = SALUNO.RA)
  JOIN SPLETIVO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)
  JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
  JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
  JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)     
  JOIN GFILIAL (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)         
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADA_N
  AND SHABILITACAOFILIAL.CODFILIAL = :CODFILIAL_N
  AND SPLETIVO.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SMATRICPL.RA BETWEEN :RADE_S AND :RAATE_S
  AND SPLETIVO.CODPERLET BETWEEN :CODPERLETDE_S AND :CODPERLETATE_S
";;;;;;;0;1;1;1;;;;;e402f517-e307-463c-a783-afa2eb4c7beb;;;22299;mestre;21/01/2021;mestre;21/01/2021;
S;Rel_Edu043;Livro de Registro de Certifricados de Atividades Ofertadas;"SELECT 
  SREGISTROLIVRO.CODLIVRO,
  SREGISTROLIVRO.FOLHA,
  SREGISTROLIVRO.NUMREGISTRO,
  SATIVIDADE.CODCOLIGADA,
  SATIVIDADE.IDOFERTA,
  SATIVIDADE.DESCRICAO,
  SATIVIDADE.DTINICIAL,
  SATIVIDADE.DTFINAL,
  SATIVIDADE.CARGAHOR,
  SATIVIDADE.CARGAHORGRADE,
  SATIVIDADE.CODINST,
  SATIVIDADE.LOCAL,
  SATIVIDADE.CONVENIO,
  SINSTITUICAO.NOME AS NOMEINSTITUICAO,
  SCERTIFICADO.CODPESSOA,
  SCERTIFICADO.CODPROFESSOR,
  SCERTIFICADO.IDCERTIFICADO,
  SCERTIFICADO.RA,
  PPESSOAALUNO.NOME AS NOMEALUNO,
  PPESSOAPROF.NOME AS NOMEPROFESSOR,
  PPESSOA.NOME AS NOMEPESSOA 
FROM  SATIVIDADE (NOLOCK) JOIN SCERTIFICADO (NOLOCK) 
         ON (SATIVIDADE.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
             AND SATIVIDADE.IDOFERTA = SCERTIFICADO.IDOFERTA)
      JOIN SREGISTROLIVRO (NOLOCK)
         ON (SCERTIFICADO.CODCOLIGADA = SREGISTROLIVRO.CODCOLIGADA
             AND SCERTIFICADO.IDCERTIFICADO = SREGISTROLIVRO.IDCERTIFICADO)            
      LEFT JOIN SINSTITUICAO (NOLOCK)
         ON (SATIVIDADE.CODINST = SINSTITUICAO.CODINST) 
      LEFT JOIN SALUNO (NOLOCK)
         ON (SCERTIFICADO.CODCOLIGADA = SALUNO.CODCOLIGADA
             AND SCERTIFICADO.RA = SALUNO.RA)
      LEFT JOIN PPESSOA PPESSOAALUNO (NOLOCK)
         ON (SALUNO.CODPESSOA = PPESSOAALUNO.CODIGO)
      LEFT JOIN SPROFESSOR (NOLOCK)
         ON (SCERTIFICADO.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
             AND SCERTIFICADO.CODPROFESSOR = SPROFESSOR.CODPROF)
      LEFT JOIN PPESSOA PPESSOAPROF (NOLOCK)
         ON (SPROFESSOR.CODPESSOA = PPESSOAPROF.CODIGO)
      LEFT JOIN PPESSOA (NOLOCK)
         ON (SCERTIFICADO.CODPESSOA = PPESSOA.CODIGO)         
WHERE SATIVIDADE.CODCOLIGADA = :CODCOLIGADA_N
  AND SATIVIDADE.IDOFERTA = :IDOFERTA_N
  AND SATIVIDADE.CODMODALIDADE = :CODMODALIDADE_N
  AND SATIVIDADE.CODCOMPONENTE = :CODCOMPONENTE_N
ORDER BY SATIVIDADE.CODCOLIGADA,
  SATIVIDADE.IDOFERTA,
  SREGISTROLIVRO.CODLIVRO,
  SREGISTROLIVRO.FOLHA,
  SREGISTROLIVRO.NUMREGISTRO
";;;;;;;0;1;1;1;;;;;0b00f2d5-7ce6-4e82-ab9a-6412f140b17a;;;-21587;mestre;28/07/2021;mestre;28/07/2021;
S;Rel_Edu043_1;Lista de Participantes;"SELECT SPARTICIPANTE.CODTIPOPART,
  SPARTICIPANTE.CODPESSOA,
  STIPOPARTICIPACAO.DESCRICAO,
  PPESSOA.NOME
FROM SPARTICIPANTE (NOLOCK) JOIN STIPOPARTICIPACAO (NOLOCK)
    ON (SPARTICIPANTE.CODCOLIGADA = STIPOPARTICIPACAO.CODCOLIGADA
        AND SPARTICIPANTE.CODTIPOPART = STIPOPARTICIPACAO.CODTIPOPART)
  JOIN PPESSOA (NOLOCK)
    ON (SPARTICIPANTE.CODPESSOA = PPESSOA.CODIGO)
WHERE SPARTICIPANTE.CODCOLIGADA = :P_CODCOLIGADA
  AND SPARTICIPANTE.IDCERTIFICADO = :P_IDCERTIFICADO
  AND (:LISTARPARTICIPANTES_S = 'S' OR :LISTARPARTICIPANTES_S = 's')
ORDER BY ORDEM";;;;;;;0;1;1;1;;;;;7112cb7d-d451-4878-bcd6-a5acec7317e2;;;-4113;mestre;28/07/2021;mestre;28/07/2021;
S;Rel_Edu046;Relação de Alunos Bolsistas;"SELECT 
  SBOLSA.CODCOLIGADA,
  SCONTRATO.CODFILIAL,
  SBOLSA.CODBOLSA,
  SBOLSA.NOME AS NOMEBOLSA,
  SBOLSAALUNO.CODCONTRATO,
  SBOLSAALUNO.IDPERLET,
  SBOLSAALUNO.RA,
  SBOLSAALUNO.CODSERVICO,
  SBOLSAALUNO.PARCELAINICIAL,
  SBOLSAALUNO.PARCELAFINAL,
  SBOLSAALUNO.DATAAUTORIZACAO,
  SBOLSAALUNO.DATACONCESSAO,
  SBOLSAALUNO.DTFIM,
  SBOLSAALUNO.DTINICIO,
  SBOLSAALUNO.DESCONTO,
  SBOLSAALUNO.TIPODESC,
  SSERVICO.NOME AS NOMESERVICO,
  PPESSOA.NOME AS NOMEALUNO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SPLETIVO.CODPERLET
FROM SBOLSA (NOLOCK) JOIN SBOLSAALUNO (NOLOCK)
    ON (SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA
        AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA)
  JOIN SALUNO (NOLOCK)
    ON (SBOLSAALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
        AND SBOLSAALUNO.RA = SALUNO.RA)
  JOIN PPESSOA (NOLOCK)
    ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
  JOIN SCONTRATO (NOLOCK)
    ON (SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
        AND SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO
        AND SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
        AND SBOLSAALUNO.RA = SCONTRATO.RA)
  JOIN SPLETIVO (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
        AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
  JOIN SSERVICO (NOLOCK)
    ON (SBOLSAALUNO.CODCOLIGADA = SSERVICO.CODCOLIGADA
        AND SBOLSAALUNO.CODSERVICO = SSERVICO.CODSERVICO)
  JOIN GFILIAL (NOLOCK)
    ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA
        AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
  LEFT JOIN GIMAGEM (NOLOCK) 
    ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE SBOLSA.CODCOLIGADA = :CODCOLIGADA_N
  AND SBOLSA.CODTIPOCURSO = :CODTIPOCURSO_N
  AND SCONTRATO.CODFILIAL = :CODFILIAL_N
  AND SBOLSA.CODBOLSA BETWEEN :CODBOLSADE_S AND :CODBOLSAATE_S
  AND SBOLSAALUNO.RA BETWEEN :RADE_S AND :RAATE_S
  AND SBOLSAALUNO.ATIVA = 'S'
  AND SBOLSAALUNO.DATACANCELAMENTO IS NULL
  AND SCONTRATO.DTCANCELAMENTO IS NULL
ORDER BY SBOLSA.CODCOLIGADA, SBOLSA.CODBOLSA";;;;;;;0;1;1;1;;;;;f4c3f8f7-8769-46f3-bb96-667434d1ca91;;;-19259;mestre;28/07/2021;mestre;28/07/2021;
S;Rel_Edu053;Termo de Encaminhamento;"SELECT
  SVAGAS.IDVAGA, 
  SVAGAS.IDEMPRESA, 
  SVAGAS.IDCONVENIO, 
  SVAGAS.INFORMACAOVAGA, 
  SVAGAS.REQUISITOSVAGA, 
  SVAGAS.LOCALTRABALHO, 
  SVAGAS.NRVAGAS, 
  SVAGAS.NRVAGASDEFICIENTE, 
  SVAGAS.CHSEMANAL, 
  SVAGAS.CHHORASEMANAL, 
  SVAGAS.HRINICIALEXPEDIENTE, 
  SVAGAS.HRFINALEXPEDIENTE, 
  SVAGAS.HRINICIALINTERVALO, 
  SVAGAS.HRFINALINTERVALO, 
  SVAGAS.CARGO, 
  SVAGAS.DEPARTAMENTO, 
  SVAGAS.STATUS AS STATUSVAGA, 
  SVAGAS.VLRBOLSA, 
  SVAGAS.TIPOVAGA, 
  SVAGAS.DTLIMITEDIVULGACAO, 
  SVAGASCANDIDATOS.RA,
  SVAGASCANDIDATOS.STATUS AS STATUSCANDIDATO,
  PPESSOA.NOME AS NOMEALUNO,
  SEMPRESA.NOMEFANTASIA AS NOMEEMPRESA,
  CASE WHEN (SEMPRESACONVENIO.CODFILIAL IS NULL) THEN GCOLIGADA.NOMEFANTASIA
    ELSE GFILIAL.NOMEFANTASIA
  END AS NOMEINSTITUICAO,
  CASE WHEN (SEMPRESACONVENIO.CODFILIAL IS NULL) THEN GIMAGEMCOLIGADA.IMAGEM
    ELSE GIMAGEMFILIAL.IMAGEM
  END AS IMAGEMINSTITUICAO
FROM SVAGASCANDIDATOS (NOLOCK) JOIN SVAGAS (NOLOCK)
      JOIN SEMPRESA (NOLOCK)
        ON (SVAGAS.IDEMPRESA = SEMPRESA.IDEMPRESA)
      JOIN SEMPRESACONVENIO (NOLOCK)
          JOIN GCOLIGADA (NOLOCK)
              LEFT JOIN GIMAGEM GIMAGEMCOLIGADA (NOLOCK)
                ON (GCOLIGADA.IDIMAGEM = GIMAGEMCOLIGADA.ID)          
            ON (SEMPRESACONVENIO.CODCOLIGADA = GCOLIGADA.CODCOLIGADA)
          LEFT JOIN GFILIAL (NOLOCK)  
              LEFT JOIN GIMAGEM GIMAGEMFILIAL (NOLOCK)
                 ON (GFILIAL.IDIMAGEM = GIMAGEMFILIAL.ID)
            ON (SEMPRESACONVENIO.CODCOLIGADA = GFILIAL.CODCOLIGADA
                AND SEMPRESACONVENIO.CODFILIAL = GFILIAL.CODFILIAL)
        ON (SVAGAS.IDEMPRESA = SEMPRESACONVENIO.IDEMPRESA
            AND SVAGAS.IDCONVENIO = SEMPRESACONVENIO.IDCONVENIO)            
      ON (SVAGASCANDIDATOS.IDVAGA = SVAGAS.IDVAGA)
   JOIN SALUNO (NOLOCK)
      JOIN PPESSOA (NOLOCK)
        ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
      ON (SVAGASCANDIDATOS.CODCOLIGADA = SALUNO.CODCOLIGADA
          AND SVAGASCANDIDATOS.RA = SALUNO.RA)
WHERE SVAGASCANDIDATOS.IDVAGA = :IDVAGA_N
  AND SVAGASCANDIDATOS.CODCOLIGADA = :CODCOLIGADA_N
  AND SVAGASCANDIDATOS.RA = :RA_S";;;;;;;0;1;1;1;;;;;900ffa8f-2cc5-48ef-b752-18edbd759b7a;;;-10116;consultor1.totvs;13/06/2022;consultor1.totvs;13/06/2022;
S;Rel_Edu054;Termo de Compromisso de Estágio;"SELECT SESTAGIOCONTRATO.IDVAGA,
       SESTAGIOCONTRATO.CODCOLIGADA,
       SESTAGIOCONTRATO.RA,
       SESTAGIOCONTRATO.CODCONTRATO,
       SESTAGIOCONTRATO.CODFILIAL,
       SESTAGIOCONTRATO.LOCALTRABALHO,
       SESTAGIOCONTRATO.CHSEMANAL,
       SESTAGIOCONTRATO.CHHORASEMANAL,
       SESTAGIOCONTRATO.IDEMPRESA,
       SEMPRESAFUNCIONARIO.NOME RESPONSAVELLEGALEMPRESA,
       SESTAGIOCONTRATO.IDFUNCIONARIO,
       SESTAGIOCONTRATO.IDTURMADISC,
       SESTAGIOCONTRATO.RESPONSABILIDADEALUNO,
       SESTAGIOCONTRATO.RESPONSABILIDADEEMPRESA,
       SESTAGIOCONTRATO.RESPONSABILIDADEINSTITUICAO,
       SESTAGIOCONTRATO.OBJETIVO,
       SESTAGIOCONTRATO.CODPROFORIENTADOR,
       SESTAGIOCONTRATO.DEPARTAMENTO,
       SESTAGIOCONTRATO.CODRESPLEGAL,
       SESTAGIOCONTRATO.IDPLANOATIVIDADE,
       SESTAGIOCONTRATO.CARGO,
       SESTAGIOCONTRATO.HRINICIALEXPEDIENTE,
       SESTAGIOCONTRATO.HRFINALEXPEDIENTE,
       SESTAGIOCONTRATO.HRINICIALINTERVALO,
       SESTAGIOCONTRATO.HRFINALINTERVALO,
       SESTAGIOCONTRATO.DTINICIOESTAGIO,
       SESTAGIOCONTRATO.DTFINALESTAGIO,
       SESTAGIOCONTRATO.MOTIVOSRECISAO,
       SESTAGIOCONTRATO.VLRBOLSA,
       SESTAGIOCONTRATO.VLRBENEFICIOS,
       SESTAGIOCONTRATO.DTCANCELAMENTO,
       SESTAGIOCONTRATO.STATUS,
       SESTAGIOCONTRATO.DTLIMITEPLANO,
       PPESSOA.NOME             AS NOMEALUNO,
       PPESSOA.CPF,
       CASE
         WHEN SESTAGIOCONTRATO.CODFILIAL IS NULL THEN GCOLIGADA.NOMEFANTASIA
         ELSE GFILIAL.NOMEFANTASIA
       END                      AS NOMEINSTITUICAO,
       CASE
         WHEN SESTAGIOCONTRATO.CODFILIAL IS NULL THEN GCOLIGADA.CGC
         ELSE GFILIAL.CGC
       END                      AS CNPJINSTITUICAO,
       CASE
         WHEN CODRESPLEGAL IS NULL THEN PPESSOA.NOME
         ELSE PPESSOARESP.NOME
       END                      AS NOMERESPLEGAL,
       SEMPRESA.NOMEFANTASIA    AS NOMEEMPRESA,
       SEMPRESA.CNPJ            AS CNPJEMPRESA,
       CASE
         WHEN SESTAGIOCONTRATO.CODFILIAL IS NULL THEN GIMAGEMCOLIGADA.IMAGEM
         ELSE GIMAGEMFILIAL.IMAGEM
       END                      AS IMAGEMINSTITUICAO,
       CASE
         WHEN SESTAGIOCONTRATO.DOMINGO = 'S' THEN 1
         ELSE 0
       END                      AS DOMINGO,
       CASE
         WHEN SESTAGIOCONTRATO.SEGUNDA = 'S' THEN 1
         ELSE 0
       END                      AS SEGUNDA,
       CASE
         WHEN SESTAGIOCONTRATO.TERCA = 'S' THEN 1
         ELSE 0
       END                      AS TERCA,
       CASE
         WHEN SESTAGIOCONTRATO.QUARTA = 'S' THEN 1
         ELSE 0
       END                      AS QUARTA,
       CASE
         WHEN SESTAGIOCONTRATO.QUINTA = 'S' THEN 1
         ELSE 0
       END                      AS QUINTA,
       CASE
         WHEN SESTAGIOCONTRATO.SEXTA = 'S' THEN 1
         ELSE 0
       END                      AS SEXTA,
       CASE
         WHEN SESTAGIOCONTRATO.SABADO = 'S' THEN 1
         ELSE 0
       END                      AS SABADO       
FROM   SESTAGIOCONTRATO (NOLOCK)
       JOIN SEMPRESA (NOLOCK)
         ON ( SESTAGIOCONTRATO.IDEMPRESA = SEMPRESA.IDEMPRESA )
       LEFT JOIN GFILIAL (NOLOCK)
                 LEFT JOIN GIMAGEM GIMAGEMFILIAL (NOLOCK)
                   ON ( GFILIAL.IDIMAGEM = GIMAGEMFILIAL.ID )
         ON ( SESTAGIOCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA
              AND SESTAGIOCONTRATO.CODFILIAL = GFILIAL.CODFILIAL )
       JOIN GCOLIGADA (NOLOCK)
            LEFT JOIN GIMAGEM GIMAGEMCOLIGADA (NOLOCK)
              ON ( GCOLIGADA.IDIMAGEM = GIMAGEMCOLIGADA.ID )
         ON ( SESTAGIOCONTRATO.CODCOLIGADA = GCOLIGADA.CODCOLIGADA )
       JOIN SALUNO (NOLOCK)
            JOIN PPESSOA (NOLOCK)
              ON ( SALUNO.CODPESSOA = PPESSOA.CODIGO )
         ON ( SESTAGIOCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
              AND SESTAGIOCONTRATO.RA = SALUNO.RA )
       LEFT JOIN PPESSOA PPESSOARESP (NOLOCK)
         ON ( SESTAGIOCONTRATO.CODRESPLEGAL = PPESSOARESP.CODIGO )
       LEFT JOIN SEMPRESAFUNCIONARIO (NOLOCK)
         ON ( SEMPRESAFUNCIONARIO.IDEMPRESA = SESTAGIOCONTRATO.IDEMPRESA
              AND ( SEMPRESAFUNCIONARIO.FUNCAO = 3
                     OR SEMPRESAFUNCIONARIO.FUNCAO = 4 ) )
WHERE  SESTAGIOCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
       AND SESTAGIOCONTRATO.RA = :RA_S
       AND SESTAGIOCONTRATO.IDESTAGIOCONTRATO = :IDESTAGIOCONTRATO_N 
";;;;;;;0;1;1;1;;;;;e5ac549c-11b9-485b-bc83-4645f202c43a;;;26325;consultor1.totvs;13/06/2022;consultor1.totvs;13/06/2022;
S;Rel_Edu055;Listagem dos Termos de Compromisso de Estágio;"SELECT SESTAGIOCONTRATO.RA,
  SESTAGIOCONTRATO.CODCONTRATO,
  SESTAGIOCONTRATO.DTINICIOESTAGIO,
  SESTAGIOCONTRATO.DTFINALESTAGIO,
  SESTAGIOCONTRATO.IDEMPRESA,
  SESTAGIOCONTRATO.CODCOLIGADA,
  SEMPRESA.NOMEFANTASIA AS NOMEEMPRESA,
  PPESSOA.NOME AS NOMEALUNO,
  GCOLIGADA.NOMEFANTASIA AS NOMECOLIGADA,
  SEMPRESACONVENIO.NUMEROCONVENIO,
  GIMAGEM.IMAGEM
FROM SESTAGIOCONTRATO (NOLOCK) JOIN SALUNO (NOLOCK)
      JOIN PPESSOA (NOLOCK)
        ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
    ON (SESTAGIOCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA
        AND SESTAGIOCONTRATO.RA = SALUNO.RA)
  JOIN SEMPRESA (NOLOCK)
    ON (SESTAGIOCONTRATO.IDEMPRESA = SEMPRESA.IDEMPRESA)
  JOIN GCOLIGADA (NOLOCK)
      LEFT JOIN GIMAGEM (NOLOCK)
        ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
    ON (SESTAGIOCONTRATO.CODCOLIGADA = GCOLIGADA.CODCOLIGADA)
  JOIN SVAGAS (NOLOCK)
      JOIN SEMPRESACONVENIO (NOLOCK)
        ON (SVAGAS.IDEMPRESA = SEMPRESACONVENIO.IDEMPRESA
            AND SVAGAS.IDCONVENIO = SEMPRESACONVENIO.IDCONVENIO)
    ON (SESTAGIOCONTRATO.IDVAGA = SVAGAS.IDVAGA)
WHERE SESTAGIOCONTRATO.CODCOLIGADA = :CODCOLIGADA_N
  AND SESTAGIOCONTRATO.DTINICIOESTAGIO >= :DTINICIOESTAGIO_D
  AND SESTAGIOCONTRATO.DTCANCELAMENTO IS NULL";;;;;;;0;1;1;1;;;;;d946cda5-8d30-4fcd-9c4a-484b33242c84;;;26961;consultor1.totvs;13/06/2022;consultor1.totvs;13/06/2022;
S;Rel_Edu077;Diario de Classe - Frequência;"SELECT
  AUX.CODCOLIGADA,
  AUX.CODFILIAL,
  AUX.CODTIPOCURSO,
  AUX.IDHABILITACAOFILIAL,
  AUX.IDTURMADISC,
  AUX.CODDISC,
  AUX.CODTURMA,
  /*AUX.CODPROF,
  AUX.NOMEPROFESSOR,*/
  AUX.NOMEDISCIPLINA,
  AUX.CH,
  AUX.CODPERLET,
  AUX.NOMETURNO,
  AUX.NOMECURSO,
  AUX.NOMEHABILITACAO,
  AUX.NOMEFILIAL,
  AUX.IMAGEM,
  AUX.RA,
  AUX.NUMDIARIO,
  AUX.NOMEALUNO,
  AUX.APRESENTACAO,
  /*AUX.IDPROFESSORTURMA,*/
  CASE WHEN  CAST(AUX.NOTACONCEITO AS DECIMAL(10,1)) > 10 THEN 10 ELSE CAST(AUX.NOTACONCEITO AS DECIMAL(10,1)) END AS NOTACONCEITO,
    CASE 
	WHEN AUX.NOMEETAPA LIKE '%FINAL%' THEN ' MF' 
	WHEN AUX.NOMEETAPA LIKE '%RECUPE%' THEN 'RP' 
	ELSE 'NT' END AS 'NOMEPROVA',
  AUX.NOMEPROVA AS 'LEGENDA',  
  AUX.NOMEETAPA,
  AUX.CODETAPA,
  AUX.NOMESTATUSRES,
  AUX.AULASDADAS,
  AUX.AULASPREVISTAS,  
  AUX.DTINICIO,
  AUX.QUEBRA,
  AUX.NUMCASASDECCH,
  AUX.STATUSALUNO
FROM (
SELECT 
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.CODTIPOCURSO,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODDISC,
  STURMADISC.CODTURMA,
  /*SPROFESSOR.CODPROF,
  PPESSOAPROFESSOR.NOME AS NOMEPROFESSOR,*/
  SDISCIPLINA.NOME AS NOMEDISCIPLINA,
  CASE WHEN (STIPOCURSO.APRESENTACAO = 0) THEN
    SDISCGRADE.CH
  ELSE
    SDISCIPLINA.CH
  END AS CH,
  SPLETIVO.CODPERLET,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SMATRICULA.RA,
  SMATRICULA.NUMDIARIO,
  PPESSOAALUNO.NOME AS NOMEALUNO,
  PPESSOAALUNO.NOMESOCIAL AS NOMESOCIALALUNO,
  STIPOCURSO.APRESENTACAO,
  /*SPROFESSORTURMA.IDPROFESSORTURMA,*/
  CASE 
	WHEN  SDISCIPLINA.TIPONOTA = 'C' THEN SNOTAETAPA.CODCONCEITO
	WHEN  SDISCIPLINA.TIPONOTA = 'N' THEN SNOTAETAPA.NOTAFALTA

  END AS NOTACONCEITO,

  SNOTAETAPA.CODETAPA AS CODPROVA,
  SETAPAS.DESCRICAO NOMEPROVA,
  SETAPAS.DESCRICAO AS NOMEETAPA,
  SETAPAS.CODETAPA,
  SETAPAS.AULASDADAS,
  SETAPAS.AULASPREVISTAS,
  SETAPAS.DTINICIO,
  SSTATUSRES.DESCRICAO AS NOMESTATUSRES,
  SSTATUS.DESCRICAO AS STATUSALUNO,
  CAST(STURMADISC.IDTURMADISC AS VARCHAR(10)) + CAST(CEILING(ROW_NUMBER() OVER(PARTITION BY STURMADISC.IDTURMADISC, /*PPESSOAPROFESSOR.NOME,*/ PPESSOAALUNO.NOME ORDER BY STURMADISC.IDTURMADISC, SNOTAETAPA.CODETAPA) / 7.0) AS VARCHAR(10)) AS QUEBRA,
  SPARAMNUMCASASCH.INTEIRO NUMCASASDECCH
FROM STURMADISC (NOLOCK) JOIN SETAPAS (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC)
   /*JOIN SPROFESSORTURMA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)         
   JOIN SPROFESSOR (NOLOCK)
     ON (SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
         AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF)
   JOIN PPESSOA PPESSOAPROFESSOR(NOLOCK)
     ON (SPROFESSOR.CODPESSOA = PPESSOAPROFESSOR.CODIGO)*/
   JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN SMATRICULA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA 
         AND SMATRICULA.RA = SALUNO.RA)
   JOIN PPESSOA PPESSOAALUNO (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOAALUNO.CODIGO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA  = STIPOCURSO.CODCOLIGADA 
         AND STURMADISC.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
         

         
   LEFT JOIN SNOTAETAPA ON SNOTAETAPA.CODCOLIGADA = SETAPAS.CODCOLIGADA
		AND SNOTAETAPA.IDTURMADISC = SETAPAS.IDTURMADISC
		AND SNOTAETAPA.CODETAPA = SETAPAS.CODETAPA
		AND SNOTAETAPA.TIPOETAPA = SETAPAS.TIPOETAPA
		AND SNOTAETAPA.RA = SMATRICULA.RA
         
   LEFT JOIN SSTATUS SSTATUSRES (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUSRES.CODCOLIGADA
         AND SMATRICULA.CODSTATUSRES = SSTATUSRES.CODSTATUS)
   LEFT JOIN SDISCGRADE (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SDISCGRADE.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
         AND SHABILITACAOFILIAL.CODGRADE = SDISCGRADE.CODGRADE
         AND STURMADISC.CODDISC = SDISCGRADE.CODDISC)
   LEFT JOIN SPARAM SPARAMNUMCASASCH (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAMNUMCASASCH.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAMNUMCASASCH.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAMNUMCASASCH.CODTIPOCURSO AND
         SPARAMNUMCASASCH.ID = 'NUMCASASDECCH')         
WHERE STURMADISC.CODCOLIGADA = :P_CODCOLIGADA
  AND STURMADISC.CODFILIAL = :P_CODFILIAL
  /*AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N */
  AND STURMADISC.ATIVA = 'S' 
  /*AND SSTATUS.DIINCALUNODISC = 'S' */
  /*AND SSTATUS.PLDIARIO = 'S' */
  AND SETAPAS.TIPOETAPA = 'N'
  AND SPLETIVO.ENCERRADO = 'N' 
  /*AND SETAPAS.CODETAPA = :CODETAPA_N
  AND SPROFESSORTURMA.CODPROF BETWEEN :CODPROFDE_S AND :CODPROFATE_S */
  AND STURMADISC.IDTURMADISC = :P_IDTURMADISC

) AUX
WHERE AUX.STATUSALUNO NOT IN ('Cancelado','Trancado','Abandono','Reserva de Vaga','Cancelamento de Disciplinas')
AND AUX.NOMEETAPA LIKE '%FINAL%'
/*WHERE AUX.QUEBRA = :P_QUEBRA*/

UNION ALL

SELECT
  AUX.CODCOLIGADA,
  AUX.CODFILIAL,
  AUX.CODTIPOCURSO,
  AUX.IDHABILITACAOFILIAL,
  AUX.IDTURMADISC,
  AUX.CODDISC,
  AUX.CODTURMA,
  /*AUX.CODPROF,
  AUX.NOMEPROFESSOR,*/
  AUX.NOMEDISCIPLINA,
  AUX.CH,
  AUX.CODPERLET,
  AUX.NOMETURNO,
  AUX.NOMECURSO,
  AUX.NOMEHABILITACAO,
  AUX.NOMEFILIAL,
  AUX.IMAGEM,
  AUX.RA,
  AUX.NUMDIARIO,
  AUX.NOMEALUNO,
  AUX.APRESENTACAO,
  /*AUX.IDPROFESSORTURMA,*/
   CASE WHEN  CAST(AUX.NOTACONCEITO AS DECIMAL(10,1)) > 10 THEN 10 ELSE CAST(AUX.NOTACONCEITO AS DECIMAL(10,1)) END AS NOTACONCEITO,
    CASE 
	WHEN AUX.NOMEETAPA LIKE '%REC%' THEN 'RP' +CAST(AUX.CODPROVA AS VARCHAR)
	ELSE 'AV'+CAST(AUX.CODPROVA AS VARCHAR) END AS 'NOMEPROVA',
  AUX.NOMEPROVA AS 'LEGENDA',  
  AUX.NOMEETAPA,
  AUX.CODETAPA,
  AUX.NOMESTATUSRES,
  AUX.AULASDADAS,
  AUX.AULASPREVISTAS,  
  AUX.DTINICIO,
  AUX.QUEBRA,
  AUX.NUMCASASDECCH,
  AUX.STATUSALUNO
FROM (
SELECT 
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.CODTIPOCURSO,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODDISC,
  STURMADISC.CODTURMA,
  /*SPROFESSOR.CODPROF,
  PPESSOAPROFESSOR.NOME AS NOMEPROFESSOR,*/
  SDISCIPLINA.NOME AS NOMEDISCIPLINA,
  CASE WHEN (STIPOCURSO.APRESENTACAO = 0) THEN
    SDISCGRADE.CH
  ELSE
    SDISCIPLINA.CH
  END AS CH,
  SPLETIVO.CODPERLET,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SMATRICULA.RA,
  SMATRICULA.NUMDIARIO,
  PPESSOAALUNO.NOME AS NOMEALUNO,
  PPESSOAALUNO.NOMESOCIAL AS NOMESOCIALALUNO,
  STIPOCURSO.APRESENTACAO,
  /*SPROFESSORTURMA.IDPROFESSORTURMA,*/
  CASE 
    WHEN STIPOCURSO.APRESENTACAO = 0 AND SDISCGRADE.TIPONOTA  = 'N' THEN SNOTAS.NOTA 
    WHEN STIPOCURSO.APRESENTACAO = 0 AND SDISCGRADE.TIPONOTA  = 'C' THEN SNOTAS.CODCONCEITO 
    WHEN STIPOCURSO.APRESENTACAO = 1 AND SDISCIPLINA.TIPONOTA = 'N' THEN SNOTAS.NOTA 
    WHEN STIPOCURSO.APRESENTACAO = 1 AND SDISCIPLINA.TIPONOTA = 'C' THEN SNOTAS.CODCONCEITO 
  END AS NOTACONCEITO,

  SPROVAS.CODPROVA,
  SPROVAS.DESCRICAO AS NOMEPROVA,
  SETAPAS.DESCRICAO AS NOMEETAPA,
  SETAPAS.CODETAPA,
  SETAPAS.AULASDADAS,
  SETAPAS.AULASPREVISTAS,
  SETAPAS.DTINICIO,
  SSTATUSRES.DESCRICAO AS NOMESTATUSRES,
  SSTATUS.DESCRICAO AS STATUSALUNO,
  CAST(STURMADISC.IDTURMADISC AS VARCHAR(10)) + CAST(CEILING(ROW_NUMBER() OVER(PARTITION BY STURMADISC.IDTURMADISC, /*PPESSOAPROFESSOR.NOME,*/ PPESSOAALUNO.NOME ORDER BY STURMADISC.IDTURMADISC, SPROVAS.CODPROVA) / 7.0) AS VARCHAR(10)) AS QUEBRA,
  SPARAMNUMCASASCH.INTEIRO NUMCASASDECCH
FROM STURMADISC (NOLOCK) JOIN SETAPAS (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC)
   /*JOIN SPROFESSORTURMA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)         
   JOIN SPROFESSOR (NOLOCK)
     ON (SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
         AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF)
   JOIN PPESSOA PPESSOAPROFESSOR(NOLOCK)
     ON (SPROFESSOR.CODPESSOA = PPESSOAPROFESSOR.CODIGO)*/
   JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN SMATRICULA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA 
         AND SMATRICULA.RA = SALUNO.RA)
   JOIN PPESSOA PPESSOAALUNO (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOAALUNO.CODIGO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA  = STIPOCURSO.CODCOLIGADA 
         AND STURMADISC.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
         
   LEFT JOIN SPROVAS (NOLOCK)
     ON (SPROVAS.CODCOLIGADA = SETAPAS.CODCOLIGADA 
         AND SPROVAS.IDTURMADISC = SETAPAS.IDTURMADISC 
         AND SPROVAS.CODETAPA  = SETAPAS.CODETAPA 
         AND SPROVAS.TIPOETAPA = SETAPAS.TIPOETAPA)
         
   LEFT JOIN SNOTAS (NOLOCK)
     ON (SNOTAS.CODCOLIGADA = SPROVAS.CODCOLIGADA 
         AND SNOTAS.IDTURMADISC = SPROVAS.IDTURMADISC
         AND SNOTAS.CODETAPA    = SPROVAS.CODETAPA 
         AND SNOTAS.TIPOETAPA   = SPROVAS.TIPOETAPA
         AND SNOTAS.CODPROVA    = SPROVAS.CODPROVA
         AND SNOTAS.RA = SMATRICULA.RA)
         

         
   LEFT JOIN SSTATUS SSTATUSRES (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUSRES.CODCOLIGADA
         AND SMATRICULA.CODSTATUSRES = SSTATUSRES.CODSTATUS)
   LEFT JOIN SDISCGRADE (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SDISCGRADE.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
         AND SHABILITACAOFILIAL.CODGRADE = SDISCGRADE.CODGRADE
         AND STURMADISC.CODDISC = SDISCGRADE.CODDISC)
   LEFT JOIN SPARAM SPARAMNUMCASASCH (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAMNUMCASASCH.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAMNUMCASASCH.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAMNUMCASASCH.CODTIPOCURSO AND
         SPARAMNUMCASASCH.ID = 'NUMCASASDECCH')         
WHERE STURMADISC.CODCOLIGADA = :P_CODCOLIGADA
  AND STURMADISC.CODFILIAL = :P_CODFILIAL
  /*AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N */
  AND STURMADISC.ATIVA = 'S' 
  /*AND SSTATUS.DIINCALUNODISC = 'S' */
  /*AND SSTATUS.PLDIARIO = 'S' */
  AND SETAPAS.TIPOETAPA = 'N'
  AND SPLETIVO.ENCERRADO = 'N' 
  AND SETAPAS.DESCRICAO NOT LIKE '%FINAL%'
  /*AND SETAPAS.CODETAPA = :CODETAPA_N
  AND SPROFESSORTURMA.CODPROF BETWEEN :CODPROFDE_S AND :CODPROFATE_S */
  AND STURMADISC.IDTURMADISC = :P_IDTURMADISC

) AUX
WHERE AUX.STATUSALUNO NOT IN ('Cancelado','Trancado','Abandono','Reserva de Vaga','Cancelamento de Disciplinas')
/*WHERE AUX.QUEBRA = :P_QUEBRA*/


ORDER BY AUX.NOMEALUNO,
AUX.CODCOLIGADA, 
  AUX.IDTURMADISC, 
  /*AUX.IDPROFESSORTURMA, */
  AUX.NUMDIARIO,
  AUX.DTINICIO,
  /*AUX.CODPROVA,*/
  AUX.NOMEPROVA
";14165;;;;12/07/2022;consultor1.totvs;0;1;1;1;;;;;72d6333b-3428-4f51-b856-60bd4466ab01;;;21713;lilian.buzetti;18/10/2021;consultor1.totvs;12/07/2022;
S;Rel_Edu077_1;Buscar nr de quebras do relatório;"SELECT DISTINCT CAST(AUX.IDTURMADISC AS VARCHAR(10)) + CAST(CEILING(ROW_NUMBER() OVER(PARTITION BY AUX.IDTURMADISC, AUX.NOMEPROFESSOR, AUX.NOMEALUNO ORDER BY AUX.IDTURMADISC, AUX.CODPROVA) / 7.0) AS VARCHAR(10))
 AS QUEBRA, CIDADEFILIAL,
 CIDADEFILIAL + ', ' +  CONVERT(VARCHAR,GETDATE(),103) AS CIDADEDATA
FROM (
SELECT DISTINCT SPROVAS.CODPROVA, STURMADISC.IDTURMADISC, GFILIAL.CIDADE CIDADEFILIAL, PPESSOAALUNO.NOME NOMEALUNO, PPESSOAPROFESSOR.NOME NOMEPROFESSOR
FROM STURMADISC (NOLOCK) JOIN SPROFESSORTURMA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)
   JOIN SETAPAS (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC)
   JOIN SMATRICULA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA 
         AND SMATRICULA.RA = SALUNO.RA)
   JOIN PPESSOA PPESSOAALUNO (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOAALUNO.CODIGO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   JOIN SPLETIVO 
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)           
   JOIN SPROVAS (NOLOCK)
     ON (SPROVAS.CODCOLIGADA = SETAPAS.CODCOLIGADA 
         AND SPROVAS.IDTURMADISC = SETAPAS.IDTURMADISC 
         AND SPROVAS.CODETAPA  = SETAPAS.CODETAPA 
         AND SPROVAS.TIPOETAPA = SETAPAS.TIPOETAPA)         
   JOIN SPROFESSOR (NOLOCK)
     ON (SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
         AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF)
   JOIN PPESSOA PPESSOAPROFESSOR (NOLOCK)
     ON (PPESSOAPROFESSOR.CODIGO = SPROFESSOR.CODPESSOA)         
         
WHERE STURMADISC.CODCOLIGADA = :P_CODCOLIGADA
  AND STURMADISC.CODFILIAL = :P_CODFILIAL
  /*AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N */
  AND STURMADISC.ATIVA = 'S' 
  /*AND SSTATUS.DIINCALUNODISC = 'S' */
  /*AND SSTATUS.PLDIARIO = 'S' */
  AND SETAPAS.TIPOETAPA = 'N'
  AND SPLETIVO.ENCERRADO = 'N' 
  AND SETAPAS.CODETAPA = :CODETAPA_N
  AND SPROFESSORTURMA.CODPROF BETWEEN :CODPROFDE_S AND :CODPROFATE_S 
  AND STURMADISC.IDTURMADISC = :P_IDTURMADISC ) AS AUX
ORDER BY QUEBRA";2592;;;;06/04/2022;consultor1.totvs;0;1;1;1;;;;;40a00d0e-af56-4fb7-b38b-37eedd1ff1f1;;;-26565;lilian.buzetti;18/10/2021;consultor1.totvs;06/04/2022;
S;Rel_Edu077_1.1;Legendas Provas;"SELECT 
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.CODTIPOCURSO,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDTURMADISC,
  
  STURMADISC.CODTURMA,
     CASE 
	WHEN SETAPAS.DESCRICAO LIKE '%REC%' THEN 'RP' +CAST(SPROVAS.CODPROVA AS VARCHAR)
	ELSE 'AV'+CAST(SPROVAS.CODPROVA AS VARCHAR) END AS 'CODPRO',
	
   /*'AV'+CAST(SPROVAS.CODPROVA AS VARCHAR) AS 'CODPRO',*/
  SPROVAS.CODPROVA,
    CASE WHEN SETAPAS.DESCRICAO LIKE '%NOTA%'
  THEN  CASE WHEN SPROVASCOMPL.TIPO = 'C' THEN SPROVAS.DESCRICAO + ' (Peso '+CAST(SPROVASCOMPL.PESO AS VARCHAR)+')'
		WHEN  SPROVASCOMPL.TIPO = 'S' THEN SPROVAS.DESCRICAO + ' (Bônus)'
		ELSE  SPROVAS.DESCRICAO END
		ELSE  SPROVAS.DESCRICAO END 
  
  AS NOMEPROVA,
  /*SPROVAS.DESCRICAO AS NOMEPROVA,*/
  SETAPAS.DESCRICAO AS NOMEETAPA,
  SETAPAS.CODETAPA
FROM STURMADISC (NOLOCK) JOIN SETAPAS (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC)
   
 
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
         
   LEFT JOIN SPROVAS (NOLOCK)
     ON (SPROVAS.CODCOLIGADA = SETAPAS.CODCOLIGADA 
         AND SPROVAS.IDTURMADISC = SETAPAS.IDTURMADISC 
         AND SPROVAS.CODETAPA  = SETAPAS.CODETAPA 
         AND SPROVAS.TIPOETAPA = SETAPAS.TIPOETAPA)
         
		    LEFT JOIN SPROVASCOMPL (NOLOCK)
	ON (SPROVASCOMPL.CODCOLIGADA = SPROVAS.CODCOLIGADA
		AND SPROVASCOMPL.IDTURMADISC = SPROVAS.IDTURMADISC
		AND SPROVASCOMPL.CODETAPA = SPROVAS.CODETAPA
		AND SPROVASCOMPL.TIPOETAPA = SPROVAS.TIPOETAPA
		AND SPROVASCOMPL.CODPROVA = SPROVAS.CODPROVA)
 
   LEFT JOIN SPARAM SPARAMNUMCASASCH (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAMNUMCASASCH.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAMNUMCASASCH.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAMNUMCASASCH.CODTIPOCURSO AND
         SPARAMNUMCASASCH.ID = 'NUMCASASDECCH')         
WHERE STURMADISC.CODCOLIGADA = :P_CODCOLIGADA
  AND STURMADISC.CODFILIAL = :P_CODFILIAL
  /*AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N */
  AND STURMADISC.ATIVA = 'S' 
  /*AND SSTATUS.DIINCALUNODISC = 'S' */
  /*AND SSTATUS.PLDIARIO = 'S' */
  AND SETAPAS.TIPOETAPA = 'N'
  AND SPLETIVO.ENCERRADO = 'N' 
  AND SPROVAS.CODPROVA IS NOT NULL
  /*AND SETAPAS.CODETAPA = :CODETAPA_N*/
  AND STURMADISC.IDTURMADISC = :P_IDTURMADISC

UNION ALL


 SELECT 
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.CODTIPOCURSO,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDTURMADISC,
  
  STURMADISC.CODTURMA,
	    CASE 
	WHEN SETAPAS.DESCRICAO LIKE '%FINAL%' THEN 'MF' 
	WHEN SETAPAS.DESCRICAO LIKE '%RECUPE%' THEN 'RP' 
	ELSE 'NT' END AS 'CODPRO',
  SETAPAS.CODETAPA,
  SETAPAS.DESCRICAO AS NOMEPROVA,
  SETAPAS.DESCRICAO AS NOMEETAPA,
  SETAPAS.CODETAPA
FROM STURMADISC (NOLOCK) JOIN SETAPAS (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC)
   
 
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
         
	

 
   LEFT JOIN SPARAM SPARAMNUMCASASCH (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAMNUMCASASCH.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAMNUMCASASCH.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAMNUMCASASCH.CODTIPOCURSO AND
         SPARAMNUMCASASCH.ID = 'NUMCASASDECCH')         
WHERE STURMADISC.CODCOLIGADA = :P_CODCOLIGADA
  AND STURMADISC.CODFILIAL = :P_CODFILIAL
  /*AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N */
  AND STURMADISC.ATIVA = 'S' 
  /*AND SSTATUS.DIINCALUNODISC = 'S' */
  /*AND SSTATUS.PLDIARIO = 'S' */
  AND SETAPAS.TIPOETAPA = 'N'
  AND SPLETIVO.ENCERRADO = 'N' 
  /*AND SETAPAS.CODETAPA = :CODETAPA_N*/
  AND STURMADISC.IDTURMADISC = :P_IDTURMADISC
  AND SETAPAS.DESCRICAO LIKE '%FINAL%'

 ORDER BY 3,4,5,6";4276;;;;07/04/2022;consultor1.totvs;0;1;1;1;;;;;40a00d0e-af56-4fb7-b38b-37eedd1ff1f1;;;-29721;consultor1.totvs;29/03/2022;consultor1.totvs;07/04/2022;
S;Rel_Filiais;Dados da Filial;"SELECT GFILIAL.NOME, GIMAGEM.IMAGEM, GFILIAL.CODCOLIGADA, GFILIAL.CODFILIAL
FROM GFILIAL (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE GFILIAL.CODCOLIGADA = :CODCOLIGADA AND
  GFILIAL.CODFILIAL = :CODFILIAL";;;;;;;0;1;1;1;;;;;458bb327-96bb-4d39-8937-31ed612296ee;;;27351;mestre;21/01/2021;lilian.buzetti;21/10/2021;
S;Rel_Filiais.1;Dados da Filial;"SELECT GFILIAL.NOME, GIMAGEM.IMAGEM, GFILIAL.CODCOLIGADA, GFILIAL.CODFILIAL
FROM GFILIAL (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE GFILIAL.CODCOLIGADA = :CODCOLIGADA AND
  GFILIAL.CODFILIAL = :CODFILIAL";243;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;;458bb327-96bb-4d39-8937-31ed612296ee;;;27351;consultor1.totvs;22/08/2022;consultor1.totvs;22/08/2022;
S;Rel_Filiais.4;Dados da Filial;"SELECT GFILIAL.NOME, GIMAGEM.IMAGEM, GFILIAL.CODCOLIGADA, GFILIAL.CODFILIAL
FROM GFILIAL (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE GFILIAL.CODCOLIGADA = :CODCOLIGADA AND
  GFILIAL.CODFILIAL = :CODFILIAL";;;;;;;0;1;1;1;;;;;;;12.1;28443;mestre;27/07/2021;mestre;27/07/2021;
S;Rel_Filiais.4.1;Dados da Filial;"SELECT GFILIAL.NOME, GIMAGEM.IMAGEM, GFILIAL.CODCOLIGADA, GFILIAL.CODFILIAL
FROM GFILIAL (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE GFILIAL.CODCOLIGADA = :$CODCOLIGADA AND
  GFILIAL.CODFILIAL = :$CODFILIAL";245;;;;22/08/2022;consultor1.totvs;0;1;1;1;;;;0;3fc5fa60-8ae7-45d1-a9ec-d9ff94ffee6b;0;;13722;consultor1.totvs;22/08/2022;consultor1.totvs;22/08/2022;0
S;Rel_Filiais.9;Dados da Filial;"SELECT GFILIAL.NOME, GIMAGEM.IMAGEM, GFILIAL.CODCOLIGADA, GFILIAL.CODFILIAL
FROM GFILIAL (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
WHERE GFILIAL.CODCOLIGADA = :CODCOLIGADA AND
  GFILIAL.CODFILIAL = :CODFILIAL ";244;;;;11/02/2022;lucas.ssantos;0;1;1;1;;;;;137eee65-a0d9-45d3-948c-fc5975d6115e;;;-10173;mestre;27/07/2021;lucas.ssantos;11/02/2022;
S;Rel_Filiais.9.1;Dados Coligada;"SELECT GCOLIGADA.NOME, GIMAGEM.IMAGEM, GCOLIGADA.CODCOLIGADA
FROM GCOLIGADA (NOLOCK) LEFT JOIN GIMAGEM (NOLOCK)
  ON (GCOLIGADA.IDIMAGEM = GIMAGEM.ID)
WHERE GCOLIGADA.CODCOLIGADA = :CODCOLIGADA";196;;;;22/02/2022;consultor1.totvs;0;1;1;1;;;;0;b2a8232a-0ac7-4264-8fb2-d9690ece0aee;0;;-18034;consultor1.totvs;22/02/2022;consultor1.totvs;22/02/2022;0
S;REQ.007;Localiza Professor da Disciplina;"SELECT
  SDISCIPLINA.CODDISC,
  SDISCIPLINA.NOME DISCIPLINA
 
 FROM
  SMATRICPL (NOLOCK)
  
  INNER JOIN SMATRICULA (NOLOCK)			ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 											   SMATRICULA.IDPERLET = SMATRICPL.IDPERLET AND 
 											   SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 											   SMATRICULA.RA = SMATRICPL.RA
 
  INNER JOIN STURMADISC (NOLOCK)			ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 											   STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC 
 											   
  INNER JOIN SDISCIPLINA (NOLOCK)			ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND 
 											   STURMADISC.CODDISC = SDISCIPLINA.CODDISC

 WHERE	SMATRICULA.CODCOLIGADA = :$CODCOLIGADA
	AND SMATRICULA.IDTURMADISC = :$CODTIPOCURSO";802;;;;10/02/2021;mestre;0;1;1;1;;;;0;220d13ff-8380-4751-b068-6bd68ebfabb7;0;;-16153;mestre;10/02/2021;mestre;10/02/2021;0
S;RespFinanceiro;Termo de Responsabilidade Financeira;"SELECT SALUNO.CODCOLIGADA,
       SALUNO.RA,
       B.NOME         RESPONSAVELACADEMICO,
       PPESSOA.NOME   NOMEALUNO,
       GCOLIGADA.NOME NOMEINSTITUICAO,
       GIMAGEM.IMAGEM,
       GCOLIGADA.CIDADE
FROM   SALUNO (NOLOCK)
       INNER JOIN SPESSOA
         ON SALUNO.CODPESSOA = SPESSOA.CODIGO
       INNER JOIN PPESSOA
         ON SPESSOA.CODIGO = PPESSOA.CODIGO
       INNER JOIN SPESSOA C (NOLOCK)
         ON SALUNO.CODPESSOARACA = C.CODIGO
       INNER JOIN PPESSOA B (NOLOCK)
         ON C.CODIGO = B.CODIGO
       INNER JOIN GCOLIGADA (NOLOCK)
         ON SALUNO.CODCOLIGADA = GCOLIGADA.CODCOLIGADA
       LEFT JOIN GIMAGEM (NOLOCK)
         ON GCOLIGADA.IDIMAGEM = GIMAGEM.ID";;;;;;;0;1;1;1;;;;;;;;17098;RM;30/05/2012;RM;30/05/2012;
S;RP_RECIBO;Reports Recibo Portal;"SELECT DISTINCT
  SUM(FLANBAIXA.VALORBAIXA) VALORBAIXA,
  FCFO.NOME,
  FLAN.IDLAN,
  FLAN.DATAEMISSAO, 
  FLAN.DATAVENCIMENTO, 
  FLANBAIXA.DATABAIXA,
  FLAN.VALORORIGINAL,  
  SPARCELA.PARCELA,
  SSERVICO.NOME SERVICO,
  /*FLANBAIXA.VALORBAIXA,*/
  TFORMAPAGTO.DESCFORMAPAGTO FORMAPAGTO,  
  SCONTRATO.RA +' - '+PPESSOA.NOME        AS ALUNO,
  PPESSOA.NOMESOCIAL  AS NOMESOCIALALUNO,
  FLAN.VALORBAIXADO,
  GFILIAL.NOME +' - '+ GFILIAL.CIDADE AS FILIAL,
  FLANBAIXA.IDTRANSACAO,
  SCURSO.CODCURSO,
  SCURSO.NOME Curso
  
FROM FLANBAIXA    (NOLOCK) 
	INNER JOIN TFORMAPAGTO  (NOLOCK) 
			ON FLANBAIXA.IDFORMAPAGTO   = TFORMAPAGTO.IDFORMAPAGTO 
			AND FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA 
	INNER JOIN FLAN      (NOLOCK) 
			ON FLANBAIXA.IDLAN = FLAN.IDLAN  
			AND FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA    
	INNER JOIN FCFO      (NOLOCK) 
			ON FCFO.CODCFO = FLAN.CODCFO 
			AND FCFO.CODCOLIGADA = FLAN.CODCOLCFO
	INNER JOIN SLAN      (NOLOCK) 
			ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA    
			AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA  (NOLOCK) 
			ON SPARCELA.CODCOLIGADA    = SLAN.CODCOLIGADA   
			AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
	INNER JOIN SCONTRATO (NOLOCK) 
			ON SCONTRATO.CODCOLIGADA   = SPARCELA.CODCOLIGADA  
			AND SCONTRATO.RA  = SPARCELA.RA  
			AND SCONTRATO.IDPERLET  = SPARCELA.IDPERLET  
			AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	INNER JOIN SPLETIVO  (NOLOCK) 
			ON SCONTRATO.CODCOLIGADA   = SPLETIVO.CODCOLIGADA  
			AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET
	INNER JOIN SMATRICPL (NOLOCK) 
			ON SMATRICPL.RA = SCONTRATO.RA 
			AND SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
			AND SMATRICPL.CODFILIAL = SCONTRATO.CODFILIAL 
			AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
			AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	INNER JOIN GFILIAL   (NOLOCK) 
			ON SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA    
			AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL
	LEFT  JOIN GIMAGEM   (NOLOCK) 
			ON GFILIAL.IDIMAGEM = GIMAGEM.ID
	INNER JOIN SALUNO    (NOLOCK) 
			ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA  
			AND SCONTRATO.RA = SALUNO.RA
	INNER JOIN PPESSOA   (NOLOCK) 
			ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	LEFT JOIN FXCX      (NOLOCK) 
			ON FXCX.IDXCX = FLANBAIXA.IDXCX 
			AND FXCX.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
	INNER JOIN SSERVICO  (NOLOCK) 
			ON  SPARCELA.CODSERVICO = SSERVICO.CODSERVICO 
			AND SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
	LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
			ON SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	LEFT JOIN SCURSO (NOLOCK)
			ON SCURSO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	INNER JOIN SHABILITACAO (NOLOCK)
			ON SHABILITACAO.CODCOLIGADA=SMATRICPL.CODCOLIGADA
			AND SHABILITACAO.CODHABILITACAO=SHABILITACAOFILIAL.CODHABILITACAO
			AND SHABILITACAO.CODCURSO = SCURSO.CODCURSO	
	
WHERE
	FLAN.CODCOLIGADA = 1 
	AND FLAN.IDLAN = :IDLAN1

GROUP BY  FCFO.NOME,
  		  FLAN.IDLAN,
  		  FLAN.DATAEMISSAO, 
  		  FLAN.DATAVENCIMENTO, 
  		  FLANBAIXA.DATABAIXA,
  		  FLAN.VALORORIGINAL,  
  		  SPARCELA.PARCELA,
  		  SSERVICO.NOME,
  		  /*FLANBAIXA.VALORBAIXA,*/
  		  TFORMAPAGTO.DESCFORMAPAGTO,  
  		  SCONTRATO.RA,
  		  PPESSOA.NOME,
  		  PPESSOA.NOMESOCIAL,
  		  FLAN.VALORBAIXADO,
  		  GFILIAL.NOME,
  		  GFILIAL.CIDADE,
  		  FLANBAIXA.IDTRANSACAO,
		  SCURSO.CODCURSO,
		  SCURSO.NOME



	";3579;;;;18/04/2022;wsrubeus;0;1;1;1;;;;;0ebfe225-5ea3-4e64-8ec7-b8ddaaa02011;;;-20119;totvs;24/06/2021;wsrubeus;18/04/2022;
S;RP_RECIBO2;Reports Relatório Recibo portal 2;"SELECT DISTINCT

  /*FLANBAIXA.IDBAIXA,*/
  FLANBAIXA.VALORBAIXA,
  /* FLANBAIXA.IDXCX,*/
  FLANBAIXA.IDFORMAPAGTO,
  TFORMAPAGTO.DESCFORMAPAGTO FORMAPAGTO,
  CASE
	WHEN TFORMAPAGTO.IDFORMAPAGTO = 3 THEN 
		COUNT (FLANBAIXA.IDXCX) 
	ELSE 
		NULL 
	END VEZES,
  CASE
	WHEN TFORMAPAGTO.IDFORMAPAGTO = 3 THEN 
		'Parcela(s)' 
	ELSE	
		NULL 
	END PARCELAS
  
FROM  FLANBAIXA    (NOLOCK) 
	INNER JOIN TFORMAPAGTO  (NOLOCK) 
		ON FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO 
		AND FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA 
	INNER JOIN FLAN (NOLOCK) 
		ON FLANBAIXA.IDLAN = FLAN.IDLAN  
		AND FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA    
	INNER JOIN FCFO (NOLOCK) 
		ON FCFO.CODCFO = FLAN.CODCFO 
		AND FCFO.CODCOLIGADA = FLAN.CODCOLCFO
	INNER JOIN SLAN (NOLOCK) 
		ON (SLAN.CODCOLIGADA = FLAN.CODCOLIGADA    
		AND SLAN.IDLAN = FLAN.IDLAN) 
	INNER JOIN SPARCELA  (NOLOCK) 
		ON (SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA   
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA)
	INNER JOIN SCONTRATO (NOLOCK) 
		ON (SCONTRATO.CODCOLIGADA  = SPARCELA.CODCOLIGADA  
		AND SCONTRATO.RA  = SPARCELA.RA  
		AND SCONTRATO.IDPERLET  = SPARCELA.IDPERLET  
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO)
	INNER JOIN SPLETIVO  (NOLOCK) 
		ON (SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA  
		AND SCONTRATO.IDPERLET = SPLETIVO.IDPERLET)
	/*INNER JOIN SMATRICPL (NOLOCK) 
		ON (SMATRICPL.RA = SCONTRATO.RA 
		AND SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
		AND SMATRICPL.CODFILIAL = SCONTRATO.CODFILIAL 
		AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET)*/
	INNER JOIN GFILIAL   (NOLOCK) 
		ON (SCONTRATO.CODCOLIGADA = GFILIAL.CODCOLIGADA    
		AND SCONTRATO.CODFILIAL = GFILIAL.CODFILIAL)
	LEFT  JOIN GIMAGEM   (NOLOCK) 
		ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
	INNER JOIN SALUNO    (NOLOCK) 
		ON (SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA  
		AND SCONTRATO.RA = SALUNO.RA)
	INNER JOIN PPESSOA   (NOLOCK) 
		ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)
	INNER JOIN FXCX      (NOLOCK) 
		ON (FXCX.IDXCX = FLANBAIXA.IDXCX 
		AND FXCX.CODCOLIGADA = FLANBAIXA.CODCOLIGADA)
	INNER JOIN SSERVICO  (NOLOCK) 
		ON  SPARCELA.CODSERVICO = SSERVICO.CODSERVICO 
		AND SPARCELA.CODCOLIGADA = SSERVICO.CODCOLIGADA
  
WHERE
	FLAN.CODCOLIGADA = :CODCOLIGADA1
	AND FLAN.IDLAN = :IDLAN1


GROUP BY 
	FLANBAIXA.VALORBAIXA
	,FLANBAIXA.IDFORMAPAGTO
	,TFORMAPAGTO.DESCFORMAPAGTO
	,TFORMAPAGTO.IDFORMAPAGTO


";;;;;;;0;1;1;1;;;;;faaa118e-5c79-4889-99f5-bbd83fc4230f;;;-32230;totvs;24/06/2021;totvs;24/06/2021;
S;Secretaria.6.4.1;Matrizes Optativas;"
select 	
	CODPERIODO,
	CODDISC,
	NOME,
	NUMCREDITOS,
	CH,
	IDGRUPO Eletiva,
	A.NOMEDISC,
	A.PROF,
	A.CODPERLET,
	A.NOTA,
	A.STATUS

from 
	v_unasp_sdiscgrade

INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = v_unasp_sdiscgrade.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = v_unasp_sdiscgrade.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = v_unasp_sdiscgrade.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = v_unasp_sdiscgrade.CODGRADE
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
	
OUTER APPLY(SELECT 
	SHISTDISCFACEXT.NOMEDISC,
	CAST(SHISTDISCFAC.NOTA AS DECIMAL(10,2)) AS 'NOTA',
	SPLETIVO.CODPERLET,
	SSTATUS.DESCRICAO AS 'STATUS',
	PPESSOA.NOME AS 'PROF'
from SHISTDISCFAC 

LEFT JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHISTDISCFAC.CODSTATUS
	
LEFT JOIN SHISTDISCFACEXT ON SHISTDISCFACEXT.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SHISTDISCFACEXT.RA = SHISTDISCFAC.RA
	AND SHISTDISCFACEXT.IDPERLET = SHISTDISCFAC.IDPERLET
	AND SHISTDISCFACEXT.CODDISC = SHISTDISCFAC.CODDISC
	AND SHISTDISCFACEXT.IDHABILITACAOFILIAL = SHISTDISCFAC.IDHABILITACAOFILIAL
	
LEFT JOIN SHISTDISCFACPROF ON SHISTDISCFACPROF.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SHISTDISCFACPROF.RA = SHISTDISCFAC.RA
	AND SHISTDISCFACPROF.CODDISC = SHISTDISCFAC.CODDISC
	AND SHISTDISCFACPROF.IDPERLET = SHISTDISCFAC.IDPERLET
	AND SHISTDISCFACPROF.IDHABILITACAOFILIAL = SHISTDISCFAC.IDHABILITACAOFILIAL
LEFT JOIN SPROFESSOR ON SPROFESSOR.CODCOLIGADA = SHISTDISCFACPROF.CODCOLIGADA
	AND SPROFESSOR.CODPROF = SHISTDISCFACPROF.CODPROF
LEFT JOIN PPESSOA ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA

INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SHISTDISCFAC.IDPERLET
WHERE SHISTDISCFAC.CODCOLIGADA = :CODCOLIGADA3
AND SHISTDISCFAC.RA = :RA1
AND SHISTDISCFAC.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
AND SHISTDISCFAC.CODDISC = v_unasp_sdiscgrade.CODDISC
) AS A

	

WHERE 
	SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA3
	AND SHABILITACAOALUNO.RA = :RA1
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
	And IDGRUPO != 0
	and v_unasp_sdiscgrade.codperiodo = :codperiodo1
";2376;;;;01/06/2022;consultor1.totvs;0;1;1;1;;;;0;d8129040-81fe-4f4c-8d1b-ca0ff1951a2d;0;;16759;consultor1.totvs;23/05/2022;consultor1.totvs;01/06/2022;0
S;SH;Consultas desenvolvidas pela Shift;"SELECT 
	SPSOPCAOINSCRITO.IDPS,
	SPSOPCAOINSCRITO.NUMEROINSCRICAO,
	SPSUSUARIO.NOME,
	SPSOPCAOINSCRITO.STATUS AS STATUSOPCAO,
	SPSSTATUSOPCAO.DESCRICAO AS STATUS,
	SPSOPCAOINSCRITO.RECCREATEDON
FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSUSUARIO(NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
CROSS APPLY(
	SELECT
		DESCRICAO
	FROM SPSSTATUSOPCAO(NOLOCK)
	WHERE SPSSTATUSOPCAO.CODIGO = SPSOPCAOINSCRITO.STATUS
	AND SPSSTATUSOPCAO.CODCOLIGADA = 0
) AS SPSSTATUSOPCAO
WHERE IDPS = 124
AND SPSOPCAOINSCRITO.CODUSUARIOPS IN (
SELECT DISTINCT
	CODUSUARIOPS
FROM SPSUSUARIO(NOLOCK)
WHERE EMAIL IN ('drianaaraujo@hotmail.com',
'dri_izacbr@yahoo.com.br',
'sandro352018@gmail.com',
'admacalux@terra.com.br',
'sarah.psic7@gmail.com',
'denisemkt@hotmail.com',
'teste@teste.com',
'bentocandido0@gmail.com',
'Andsalima@hotmail.com',
'Lhaysled@hotmail.com',
'comercial.mkt@adventistas.org',
'viviamuninter@gmail.com',
'adenisia.psi@gmail.com',
'profjulianadias@hotmail.com',
'milca.souza@hotmail.com',
'jvibcunha@gmail.com',
'Marlopdut@gmail.com',
'nydia_med@yahoo.com.br',
'pollyspaes@gmail.com',
'alinesdantas44@gmail.com',
'Elcilenegoncalves41@gmail.com',
'julianadantas2110@gmail.com',
'Elcilenegoncalves41@gmail.com',
'britonacir@gmail.com',
'cintia.sandes.v@gmail.com',
'psantosloia@gmail.com',
'scp_t@hotmail.com',
'karinygdelima@gmail.com',
'Sarithamelo@gmail.com',
'lidiaallasilva@gmail.com',
'dridalloca@gmail.com',
'Evellybbb@gmail.com',
'lucianypaes@gmail.com',
'pharaujo7@gmail.com',
'Michaelcgodoy@hotmail.com',
'sayuriishihara155@gmal.com',
'giraoalynne@gmail.com',
'ingrid.pacheco2015@gmail.com',
'josilene.passos@hotmail.com',
'artesiaesc@gmail.com',
'pri.nabarrete@gmail.com',
'alinema_1907@hotmail.com',
'alyne.psico@gmail.com',
'dayannesousa41077@gmail.com',
'joelma.carlos@hotmail.com',
'ariane.b.oliveira@hotmail.com',
'Robson.nunciato@hotmail.com',
'neusavcf@gmail.com',
'josielconchal@gmail.com',
'aleferreira9293@gmail.com',
'marceloacuap@gmail.com',
'victor.trivelato@adventistas.org',
'victor.trivelato@adventistas.org',
'lilian.aquinosantos@gmail.com',
'neillyse.farias@proasa.org.br',
'victor.trivelato@adventistas.org',
'jonathan.222@live.com',
'ciany_lucy@hotmail.com',
'renilson_pvh@hotmail.com',
'matheussilva.adm@hotmail.com',
'sememail@rubeus.com.br',
'daianaalicem@gmail.com',
'amandacassimirosilva@hotmail.com',
'Betchisanha572@gmail.com',
'camilahaho27@gmail.com',
'j.alencarbegnalia@yahoo.com.br',
'lourdesmariasr10@gmail.com',
'sememail@rubeus.com.br',
'roselanne_rodrigues@hotmail.com',
'jeferson.construtorajmj@gmail.com',
'clarisseleitao13@hotmail.com',
'fabipera_almeida@hotmail.com',
'chamilly_santos98@outlook.com',
'michele.silva@unasp.edu.br',
'laisefarias07@gmail.com',
'josynhaluminares3@gmail.com',
'cassiamsjones7@gmail.com',
'cassiamsjones7@gmail.com',
'mayck.cipra@gmail.com',
'masheiderich@gmail.com',
'claudio.knoener@gmail.com',
'tatiana.guimaraes@mundial.com',
'paula.ric.s@gmail.com',
'roniufg@gmail.com',
'ninhaalvarenga@hotmail.com'))";3108;;;;27/10/2022;shift;0;1;1;1;;;;0;f75ac1df-1b56-4653-96e0-272d730de230;;;-19252;shift;14/04/2022;shift;27/10/2022;
S;SH.CB;Consultas utilizadas em cubos;;0;;;;14/04/2022;shift;0;1;1;1;;;;0;659862ba-6cba-41b5-b9ba-d8f7d1285d03;0;;-4790;shift;14/04/2022;shift;14/04/2022;0
S;SH.CB.001;Consultas utilizadas em cubos;"/******
	AUTOR: LAERTE
	FUNÇÃO: TRAZER DADOS PARA A EXECUÇÃO DO PROCESSO DE CONFIRMAÇÃO DE MATRÍCULA
	
	
	1- GRADUAÇÃO
******/
SELECT
	PPESSOA.NOME AS 'Aluno',
	CONVERT(VARCHAR,DTINICIOALTERACAOPROGRAMA,103) AS 'Data de início matrícula',
	CONVERT(VARCHAR,DTFIMALTERACAOPROGRAMA,103) AS 'Data de encerramento matrícula',
	'GRADUAÇÃO' AS 'Nível de ensino',
	SMATRICPL.IDHABILITACAOFILIAL AS 'Id. Matriz aplicada',
	SPLETIVO.CODPERLET AS 'Período letivo',
	SMATRICPL.RA AS 'Registro acadêmico',
	(SELECT NOME FANTASIA FROM GFILIAL(NOLOCK) WHERE CODFILIAL = SMATRICPL.CODFILIAL) AS 'Filial',
	FLAN.IDLAN AS 'Ref. Lançamento',
	FLAN.PARCELA AS 'Parcela',
	FLAN.CODSERVICO AS 'Cod. serviço',
	FLAN.SERVICO AS 'Serviço',
	CONVERT(VARCHAR,FLAN.DATABAIXA,103) AS 'Data de pagamento',
	1 AS 'Contador'
FROM SMATRICPL(NOLOCK)
INNER JOIN SHABILITACAOFILIALPL(NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
CROSS APPLY(
	SELECT
		PPESSOA.NOME,
		PPESSOA.EMAIL
	FROM SALUNO(NOLOCK)
	INNER JOIN PPESSOA(NOLOCK)
		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	WHERE SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
) AS PPESSOA	
CROSS APPLY (
	SELECT 
		FLAN.CODCOLIGADA,
		FLAN.IDLAN,
		SCONTRATO.CODCONTRATO,
		SCONTRATO.IDPERLET,
		SPARCELA.PARCELA,
		SSERVICO.CODSERVICO,
		SSERVICO.NOME AS SERVICO,
		FLAN.DATABAIXA
	FROM FLAN(NOLOCK)
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
		AND SPARCELA.PARCELA = 1		
		AND SPARCELA.CODSERVICO IN ( 1,/* - Mensalidade Graduação UNASP-SP*/
									 2,/* - Mensalidade Pensionato UNASP-SP*/
									29,/* - Mensalidade Graduação UNASP-EC*/
									38,/* - Mensalidade Graduação UNASP-HT*/
									39,/* - Mensalidade Graduação UNASP-EAD*/
									92,/* - Mensalidade Graduação UNASP-EC - 1º Parcela*/
									93,/* - Mensalidade Graduação UNASP-HT - 1º Parcela*/ 
									94,/* - Mensalidade Graduação UNASP-SP - 1º Parcela*/
									95,/* - Mensalidade Graduação UNASP- EAD - 1º Parcela*/
									102,/* - Mensalidade Pensionato UNASP-HT*/
									103,/* - Mensalidade Pensionato UNASP-SP - 1ª Parcela*/
									104,/* - Mensalidade Pensionato UNASP-HT - 1ª Parcela*/
									101,/* - Mensalidade Pensionato UNASP-EC*/
									106,/* - Mensalidade Pensionato UNASP-EC - 1ª Parcela*/
									113,/*-  Mensalidade Graduação UNASP- EAD - 1º Parc. Ingressantes*/
									114,/*- Mensalidade Graduação UNASP-EC - 1º Parc. Ingressantes*/
									115,/*- Mensalidade Graduação UNASP-HT - 1º Parc. Ingressantes*/
									116 /*- Mensalidade Graduação UNASP-SP - 1º Parc. Ingressantes*/)
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.RA = SPARCELA.RA
	INNER JOIN SSERVICO(NOLOCK)
		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	WHERE FLAN.PAGREC = 1 AND FLAN.STATUSLAN = 1
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SPARCELA.RA = SMATRICPL.RA
	/*AND DATEDIFF(DAY,FLAN.DATABAIXA,GETDATE()) <= 8*/
) AS FLAN
WHERE 
	SMATRICPL.CODSTATUS = 19
AND SPLETIVO.CODTIPOCURSO = 1
/*AND SMATRICPL.IDHABILITACAOFILIAL = 15886*/
/**VALIDAR PERIODO DE MATRICULA**/
/*AND CONVERT (DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA)*/

UNION
/**
	2 - (Pós - Graduação)
**/
SELECT
	PPESSOA.NOME AS 'Aluno',
	CONVERT(VARCHAR,DTINICIOALTERACAOPROGRAMA,103) AS 'Data de início matrícula',
	CONVERT(VARCHAR,DTFIMALTERACAOPROGRAMA,103) AS 'Data de encerramento matrícula',
	'PÓS-GRADUAÇÃO' AS 'Nível de ensino',
	SMATRICPL.IDHABILITACAOFILIAL AS 'Id. Matriz aplicada',
	SPLETIVO.CODPERLET AS 'Período letivo',
	SMATRICPL.RA AS 'Registro acadêmico',
	(SELECT NOME FANTASIA FROM GFILIAL(NOLOCK) WHERE CODFILIAL = SMATRICPL.CODFILIAL) AS 'Filial',
	FLAN.IDLAN AS 'Ref. Lançamento',
	FLAN.PARCELA AS 'Parcela',
	FLAN.CODSERVICO AS 'Cod. serviço',
	FLAN.SERVICO AS 'Serviço',
	CONVERT(VARCHAR,FLAN.DATABAIXA,103) AS 'Data de pagamento',
	1 AS 'Contador'
FROM SMATRICPL(NOLOCK)
INNER JOIN SHABILITACAOFILIALPL(NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
CROSS APPLY(
	SELECT
		PPESSOA.NOME,
		PPESSOA.EMAIL
	FROM SALUNO(NOLOCK)
	INNER JOIN PPESSOA(NOLOCK)
		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	WHERE SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
) AS PPESSOA		
CROSS APPLY (
	SELECT 
		FLAN.CODCOLIGADA,
		FLAN.IDLAN,
		SCONTRATO.CODCONTRATO,
		SCONTRATO.IDPERLET,
		SPARCELA.PARCELA,
		SSERVICO.CODSERVICO,
		SSERVICO.NOME AS SERVICO,
		FLAN.DATABAIXA
	FROM FLAN(NOLOCK)
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
		AND SPARCELA.PARCELA = 1		
		AND SPARCELA.CODSERVICO IN (11,/* - Mensalidade Pós UNASP-SP*/							
									32,/* - Mensalidade Pós UNASP-EC*/
									42,/* - Mensalidade Pós UNASP-HT*/
									61,/* - Mensalidade Pós UNASP-EAD*/
									96,/* - Mensalidade Pós UNASP-EAD - 1º Parcela*/
									97,/* - Mensalidade Pós UNASP-EC - 1º Parcela*/
									98,/* - Mensalidade Pós UNASP-HT - 1º Parcela*/
									99 /*- Mensalidade Pós UNASP-SP - 1º Parcela*/)
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.RA = SPARCELA.RA
	INNER JOIN SSERVICO(NOLOCK)
		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	WHERE FLAN.PAGREC = 1 AND FLAN.STATUSLAN = 1
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SPARCELA.RA = SMATRICPL.RA
	/*AND DATEDIFF(DAY,FLAN.DATABAIXA,GETDATE()) <= 8*/
) AS FLAN
WHERE 
	SMATRICPL.CODSTATUS = 35/* - Contrato Assinado*/
AND SPLETIVO.CODTIPOCURSO = 2
/**VALIDAR PERIODO DE MATRICULA**/
/*AND CONVERT (DATE, FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA)*/
		  
UNION
/**
	3 - (Extensão/Livre)
**/
SELECT
	PPESSOA.NOME AS 'Aluno',
	CONVERT(VARCHAR,DTINICIOALTERACAOPROGRAMA,103) AS 'Data de início matrícula',
	CONVERT(VARCHAR,DTFIMALTERACAOPROGRAMA,103) AS 'Data de encerramento matrícula',
	'EXTENSÃO/LIVRE' AS 'Nível de ensino',
	SMATRICPL.IDHABILITACAOFILIAL AS 'Id. Matriz aplicada',
	SPLETIVO.CODPERLET AS 'Período letivo',
	SMATRICPL.RA AS 'Registro acadêmico',
	(SELECT NOME FANTASIA FROM GFILIAL(NOLOCK) WHERE CODFILIAL = SMATRICPL.CODFILIAL) AS 'Filial',
	FLAN.IDLAN AS 'Ref. Lançamento',
	FLAN.PARCELA AS 'Parcela',
	FLAN.CODSERVICO AS 'Cod. serviço',
	FLAN.SERVICO AS 'Serviço',
	CONVERT(VARCHAR,FLAN.DATABAIXA,103) AS 'Data de pagamento',
	1 AS 'Contador'
FROM SMATRICPL(NOLOCK)
INNER JOIN SHABILITACAOFILIALPL(NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
CROSS APPLY(
	SELECT
		PPESSOA.NOME,
		PPESSOA.EMAIL
	FROM SALUNO(NOLOCK)
	INNER JOIN PPESSOA(NOLOCK)
		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	WHERE SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
) AS PPESSOA		
CROSS APPLY (
	SELECT 
		FLAN.CODCOLIGADA,
		FLAN.IDLAN,
		SCONTRATO.CODCONTRATO,
		SCONTRATO.IDPERLET,
		SPARCELA.PARCELA,
		SSERVICO.CODSERVICO,
		SSERVICO.NOME AS SERVICO,
		FLAN.DATABAIXA
	FROM FLAN(NOLOCK)
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
		AND SPARCELA.PARCELA = 1		
		AND SPARCELA.CODSERVICO IN (21,/* - Mens. Escola de Esportes - UNASP-SP*/
									23,/* - Mens. Centro de Linguas - UNASP-SP*/
									25,/* - Mens. Clínica de Saúde e Bem Estar - UNASP-SP*/
									34,/* - Mens. Centro de Linguas - UNASP-EC*/									
									35,/* - Mens. Escola de Artes - UNASP-EC*/									
									36,/* - Mens. Escola de Esportes - UNASP-EC*/									
									45,/* - Mens. Centro de Linguas - UNASP-HT*/
									46,/* - Mens. Escola de Artes - UNASP-HT*/
									47,/* - Mens. Escola de Esportes - UNASP-HT*/
									58,/* - Cursos de Extensão Diversos*/
									119,/* - Mens. Intercâmbio Adventista*/
									120,/* - Mens. Intercâmbio Adventista - Cartão 12x*/
									159/* - Mens. Intercâmbio Adventista - Cartão 6x*/ )
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.RA = SPARCELA.RA
	INNER JOIN SSERVICO(NOLOCK)
		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	WHERE FLAN.PAGREC = 1 AND FLAN.STATUSLAN = 1
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SPARCELA.RA = SMATRICPL.RA
	/*AND DATEDIFF(DAY,FLAN.DATABAIXA,GETDATE()) <= 8*/
) AS FLAN
WHERE 
	SMATRICPL.CODSTATUS IN (22,/* - Reserva de Vaga*/
							37,/* - Contrato Assinado*/
							69 /*- Inscrição confirmada*/)
AND SPLETIVO.CODTIPOCURSO = 3";10311;;;;14/04/2022;shift;0;1;1;1;;;;0;659862ba-6cba-41b5-b9ba-d8f7d1285d03;0;;29215;shift;14/04/2022;shift;14/04/2022;0
S;SH.CORRECOES;Consultas desenvolvidas pela Shift;SELECT * FROM SSTATUS WHERE CODSTATUS = 45;42;;;;05/11/2022;shift;0;1;1;1;;;;0;f75ac1df-1b56-4653-96e0-272d730de230;;;23969;shift;02/11/2022;shift;05/11/2022;
S;SH.CORRECOES.01;Envio inscritos;"SELECT DISTINCT 
	/** DADOS CONTATO **/
	CONVERT(VARCHAR,SPSOPCAOINSCRITO.CODUSUARIOPS) AS 'contato.codigo',
	ISNULL(SPSUSUARIO.NOME,SPSUSUARIO.NOMESOCIAL) 'contato.nome',
	CONVERT(VARCHAR(10),SPSUSUARIO.DTNASCIMENTO,121) 'contato.dataNascimento',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE1,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE1,'(',''),')',''),' ','') END 'contato.telefonePrincipal',
	CASE WHEN SPSUSUARIO.EMAIL IS NULL AND SPSUSUARIO.EMAIL NOT LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', SPSUSUARIO.EMAIL) = 1
         THEN  'sememail@rubeus.com.br' 
    ELSE REPLACE(REPLACE(SPSUSUARIO.EMAIL,' ',''),' ','') COLLATE SQL_Latin1_General_CP1251_CS_AS END AS 'contato.emailPrincipal',
    REPLACE(REPLACE(LTRIM(RTRIM(SPSUSUARIO.EMAIL)),' ',''),' ',''),
	CASE WHEN SPSUSUARIO.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(SPSUSUARIO.CPF) <  11
		THEN NULL 
	ELSE SPSUSUARIO.CPF END 'contato.cpf',
	SPSUSUARIO.RUA 'contato.endereco',
	SPSUSUARIO.CEP 'contato.cep',
	SPSUSUARIO.NUMERO 'contato.numero',
	SPSUSUARIO.BAIRRO 'contato.bairro',
	SPSUSUARIO.CIDADE 'contato.cidade',
	SPSUSUARIO.ESTADO 'contato.estado',
	
	CASE SPSUSUARIO.SEXO WHEN 'M' THEN 1 ELSE 2 END AS 'contato.sexo',
	CASE 
		WHEN SPSUSUARIO.ESTADOCIVIL = 'C' THEN 1 /*Casado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'D' THEN 2 /*Desquitado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'E' THEN 3 /*União Estável*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'I' THEN 4 /*Divorciado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'O' THEN 5 /*Outros*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'P' THEN 6 /*Separado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'S' THEN 7 /*Solteiro*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'V' THEN 8 /*Viúvo*/
	ELSE NULL END AS 'contato.estadocivil',
	CASE 
		WHEN SPSINSCRICAOAREAOFERTADA.DEFFISICA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFAUDITIVA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFVISUAL = 'T' THEN 1	
		WHEN SPSINSCRICAOAREAOFERTADA.DEFMENTAL = 'T'	THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFINTELECTUAL = 'T' THEN 1
	ELSE NULL END AS 'contato.deficiencias',
	
	/**DADOS EVENTO **/
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                        AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    SPSINSCRICAOAREAOFERTADA.DATAINSCRICAO							                                                      AS 'evento.momento'
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.STATUS = 0
	
INNER JOIN SPSUSUARIO(NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	/*AND PATINDEX('%TESTE%', SPSUSUARIO.NOME) = 0
	AND SPSUSUARIO.CODUSUARIOPS = 20996*/
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.IDPS = 124";3852;;;;10/11/2022;shift;0;1;1;1;;;;0;f75ac1df-1b56-4653-96e0-272d730de230;;;3876;shift;02/11/2022;shift;10/11/2022;
S;SH.CORRECOES.02;Depara CRM TOTVS pós-graduação;"SELECT DISTINCT 
	/** DADOS CONTATO **/
	CONVERT(VARCHAR,SPSOPCAOINSCRITO.CODUSUARIOPS) AS 'contato.codigo',
	ISNULL(SPSUSUARIO.NOME,SPSUSUARIO.NOMESOCIAL) 'contato.nome',
	CONVERT(VARCHAR(10),SPSUSUARIO.DTNASCIMENTO,121) 'contato.dataNascimento',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE1,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE1,'(',''),')',''),' ','') END 'contato.telefonePrincipal',
	SPSUSUARIO.EMAIL AS 'contato.emailPrincipal',
	CONCAT('''',SPSUSUARIO.EMAIL,'''',',') AS EMAIL,
	CASE WHEN SPSUSUARIO.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(SPSUSUARIO.CPF) <  11
		THEN NULL 
	ELSE SPSUSUARIO.CPF END 'contato.cpf',
	SPSUSUARIO.RUA 'contato.endereco',
	SPSUSUARIO.CEP 'contato.cep',
	SPSUSUARIO.NUMERO 'contato.numero',
	SPSUSUARIO.BAIRRO 'contato.bairro',
	SPSUSUARIO.CIDADE 'contato.cidade',
	SPSUSUARIO.ESTADO 'contato.estado',
	
	CASE SPSUSUARIO.SEXO WHEN 'M' THEN 1 ELSE 2 END AS 'contato.sexo',
	CASE 
		WHEN SPSUSUARIO.ESTADOCIVIL = 'C' THEN 1 /*Casado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'D' THEN 2 /*Desquitado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'E' THEN 3 /*União Estável*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'I' THEN 4 /*Divorciado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'O' THEN 5 /*Outros*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'P' THEN 6 /*Separado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'S' THEN 7 /*Solteiro*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'V' THEN 8 /*Viúvo*/
	ELSE NULL END AS 'contato.estadocivil',
	CASE 
		WHEN SPSINSCRICAOAREAOFERTADA.DEFFISICA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFAUDITIVA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFVISUAL = 'T' THEN 1	
		WHEN SPSINSCRICAOAREAOFERTADA.DEFMENTAL = 'T'	THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFINTELECTUAL = 'T' THEN 1
	ELSE NULL END AS 'contato.deficiencias',
	SPSPROCESSOSELETIVO.NOME,
	STIPOCURSO.NOME AS 'Nivel Ensino',
	SPSAREAINTERESSE.NOME AS 'Area interesse',
	
	/**DADOS EVENTO **/
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                        AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    SPSINSCRICAOAREAOFERTADA.DATAINSCRICAO							                                                      AS 'evento.momento'
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSOPCAOINSCRITO.STATUS = 0
	
INNER JOIN SPSUSUARIO(NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	/*AND SPSUSUARIO.CODUSUARIOPS = 3584*/
	AND PATINDEX('%TESTE%',SPSUSUARIO.EMAIL) = 0
	AND PATINDEX('%TESTE%',SPSUSUARIO.NOME) = 0
	

	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.IDPS = 124

CROSS APPLY(
	SELECT
		NOME
	FROM STIPOCURSO(NOLOCK)
	WHERE CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
) AS STIPOCURSO";3910;;;;10/11/2022;shift;0;1;1;1;;;;0;f75ac1df-1b56-4653-96e0-272d730de230;;;-21184;shift;05/11/2022;shift;10/11/2022;
S;SH.CORRECOES.03;DESCRICAO DO CURSO;"SELECT DISTINCT 
	/** DADOS CONTATO **/
	CONVERT(VARCHAR,SPSOPCAOINSCRITO.CODUSUARIOPS) AS 'contato.codigo',
	ISNULL(SPSUSUARIO.NOME,SPSUSUARIO.NOMESOCIAL) 'contato.nome',
	CONVERT(VARCHAR(10),SPSUSUARIO.DTNASCIMENTO,121) 'contato.dataNascimento',
	CASE WHEN LEN(ISNULL(SPSUSUARIO.TELEFONE1,'0')) < 8 THEN '00000000000' ELSE REPLACE(REPLACE(REPLACE(SPSUSUARIO.TELEFONE1,'(',''),')',''),' ','') END 'contato.telefonePrincipal',
	CASE WHEN SPSUSUARIO.EMAIL IS NULL AND SPSUSUARIO.EMAIL NOT LIKE '%_@__%.__%' AND PATINDEX('%[^a-z,0-9,@,.,_,\-]%', SPSUSUARIO.EMAIL) = 1
         THEN  'sememail@rubeus.com.br' 
    ELSE REPLACE(REPLACE(SPSUSUARIO.EMAIL,' ',''),' ','') COLLATE SQL_Latin1_General_CP1251_CS_AS END AS 'contato.emailPrincipal',
    REPLACE(REPLACE(LTRIM(RTRIM(SPSUSUARIO.EMAIL)),' ',''),' ',''),
	CASE WHEN SPSUSUARIO.CPF IN ('00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999', '12345678909') OR LEN(SPSUSUARIO.CPF) <  11
		THEN NULL 
	ELSE SPSUSUARIO.CPF END 'contato.cpf',
	SPSUSUARIO.RUA 'contato.endereco',
	SPSUSUARIO.CEP 'contato.cep',
	SPSUSUARIO.NUMERO 'contato.numero',
	SPSUSUARIO.BAIRRO 'contato.bairro',
	SPSUSUARIO.CIDADE 'contato.cidade',
	SPSUSUARIO.ESTADO 'contato.estado',
	
	CASE SPSUSUARIO.SEXO WHEN 'M' THEN 1 ELSE 2 END AS 'contato.sexo',
	CASE 
		WHEN SPSUSUARIO.ESTADOCIVIL = 'C' THEN 1 /*Casado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'D' THEN 2 /*Desquitado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'E' THEN 3 /*União Estável*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'I' THEN 4 /*Divorciado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'O' THEN 5 /*Outros*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'P' THEN 6 /*Separado*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'S' THEN 7 /*Solteiro*/
		WHEN SPSUSUARIO.ESTADOCIVIL = 'V' THEN 8 /*Viúvo*/
	ELSE NULL END AS 'contato.estadocivil',
	CASE 
		WHEN SPSINSCRICAOAREAOFERTADA.DEFFISICA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFAUDITIVA = 'T' THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFVISUAL = 'T' THEN 1	
		WHEN SPSINSCRICAOAREAOFERTADA.DEFMENTAL = 'T'	THEN 1
		WHEN SPSINSCRICAOAREAOFERTADA.DEFINTELECTUAL = 'T' THEN 1
	ELSE NULL END AS 'contato.deficiencias',
	
	/**DADOS EVENTO **/
	CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAOFERTADA.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'evento.codOferta',
    CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO)                                        AS 'evento.codCurso',
    SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS AS 'evento.pessoa',
    SPSINSCRICAOAREAOFERTADA.DATAINSCRICAO							                                                      AS 'evento.momento'
FROM SPSINSCRICAOAREAOFERTADA(NOLOCK)
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	AND SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	/*AND SPSOPCAOINSCRITO.STATUS = 0*/
	
INNER JOIN SPSUSUARIO(NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND PATINDEX('%TESTE%', SPSUSUARIO.NOME) = 0
	AND SPSUSUARIO.CODUSUARIOPS = 24024
	
INNER JOIN SPSAREAINTERESSE (NOLOCK)
	ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
	
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.IDPS = 123";3852;;;;08/11/2022;shift.maria;0;1;1;1;;;;0;aaf353ab-13f9-47bc-bbd9-15faa6127fbb;0;;-20430;shift.maria;08/11/2022;shift.maria;08/11/2022;0
S;SH.CORRECOES.04;Envio CRM;"SELECT DISTINCT
	/*CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) AS 'evento.codRegistro',*/
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	SPSUSUARIO.NOME AS 'nome.aluno', 
	
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',		
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN IIF(SPSAREAOFERTADA_MAT.CODCOLIGADA IS NOT NULL AND SPSAREAOFERTADA_MAT.IDPS IS NOT NULL AND SPSAREAOFERTADA_MAT.IDAREAINTERESSE IS NOT NULL,
				CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),
				CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta' 

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	AND SPSPROCESSOSELETIVO.IDPS = 123
	
	
INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SPSPROCSELCOMPL.IDPERLET
	AND SMATRICPL.CODSTATUS IN (42,43) /**42 - PORTAL LIBERADO   43 - Inscrição confirmada**/
	AND SMATRICPL.CODTIPOMAT = 4 /**4 - MATRICULA**/
	/*AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL*/
	

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)

LEFT JOIN SPSPARAMETROPS (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPARAMETROPS.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPARAMETROPS.IDPS 
	AND SPSPARAMETROPS.USAINTEGRACAORUBEUS = 'T'";3854;;;;12/11/2022;shift.maria;0;1;1;1;;;;0;aaf353ab-13f9-47bc-bbd9-15faa6127fbb;0;;-16802;shift;09/11/2022;shift.maria;12/11/2022;0
S;SH.CORRECOES.05;Envio CRM;"SELECT DISTINCT
	/*CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) AS 'evento.codRegistro',*/
	SPSOPCAOINSCRITO.CODUSUARIOPS AS 'evento.pessoa',
	SPSUSUARIO.NOME AS 'nome',
	ISNULL(SMATRICPL.RECMODIFIEDON, GETDATE()) AS 'evento.data',
	CONVERT(VARCHAR, SPSOPCAOINSCRITO.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SHABILITACAOFILIAL_INSC.CODCURSO) AS 'evento.codCurso',
	CASE
		WHEN CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO) <> CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SHABILITACAOFILIAL_INSC.CODCURSO) 
		THEN 	
		ISNULL(CONCAT(SPSAREAOFERTADA_MAT.CODCOLIGADA,'-',SPSAREAOFERTADA_MAT.IDPS,'-',SPSAREAOFERTADA_MAT.IDAREAINTERESSE),CONCAT(SHABILITACAOFILIAL.CODCOLIGADA,'-',SHABILITACAOFILIAL.CODCURSO,'-','SEMPS'))
	ELSE CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE)
	END AS 'evento.codOferta'

FROM SPSOPCAOINSCRITO(NOLOCK)
INNER JOIN SPSPROCESSOSELETIVO(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSPROCESSOSELETIVO.IDPS
	AND SPSPROCESSOSELETIVO.STATUS = 'T'
	AND SPSPROCESSOSELETIVO.IDPS = 123
	AND GETDATE() BETWEEN SPSPROCESSOSELETIVO.DTINIINSCRICAO AND SPSPROCESSOSELETIVO.DTFIMINSCRICAO

INNER JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSOPCAOINSCRITO.CODUSUARIOPS
	AND SPSUSUARIO.NOME = SPSUSUARIO.NOME 
	
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CPF = SPSUSUARIO.CPF

INNER JOIN SALUNO(NOLOCK)
	ON SALUNO.CODPESSOA = PPESSOA.CODIGO
	AND SPSOPCAOINSCRITO.STATUS IN (5, 7, 10, 11)

INNER JOIN SPSPROCSELCOMPL (NOLOCK)
	ON SPSPROCESSOSELETIVO.IDPS = SPSPROCSELCOMPL.IDPS
	AND SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	

INNER JOIN SHABILITACAOALUNO(NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
	AND SHABILITACAOALUNO.RECCREATEDON >= SPSOPCAOINSCRITO.RECCREATEDON

INNER JOIN SHABILITACAOFILIAL(NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL

INNER JOIN SMATRICPL(NOLOCK)
	ON SMATRICPL.RA = SALUNO.RA
	AND SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SMATRICPL.IDPERLET IN( SPSPROCSELCOMPL.IDPERLET,  SPSPROCSELCOMPL.IDPERLET1,  SPSPROCSELCOMPL.IDPERLET2,  SPSPROCSELCOMPL.IDPERLET3)
	AND SMATRICPL.CODSTATUS = 27 /**27- CURSANDO**/ 
	AND SMATRICPL.CODTIPOMAT = 4 /**4- MATRICULA**/
	/*AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) >= :DIAINICIAL AND DATEDIFF(DAY, SMATRICPL.RECMODIFIEDON, GETDATE()) <= :DIAFINAL*/	

INNER JOIN SPSAREAOFERTADA(NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SPSAREAINTERESSE(NOLOCK)
	ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL AS SHABILITACAOFILIAL_INSC (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SHABILITACAOFILIAL_INSC.CODCOLIGADA
	AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL_INSC.IDHABILITACAOFILIAL
  
LEFT JOIN 	SPSAREAINTERESSE as SPSAREAINTERESSE_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
	AND SPSAREAINTERESSE_MAT.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
LEFT JOIN SPSAREAOFERTADA AS SPSAREAOFERTADA_MAT (NOLOCK)
	ON SPSAREAINTERESSE_MAT.IDAREAINTERESSE = SPSAREAOFERTADA_MAT.IDAREAINTERESSE
	AND CONVERT(VARCHAR, SPSAREAOFERTADA_MAT.IDPS) = CONVERT(VARCHAR, SPSAREAOFERTADA.IDPS)
/*
INNER JOIN SCONTRATO(NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SCONTRATO.ASSINADO = 'S'

INNER JOIN SPARCELA(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.RA = SPARCELA.RA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SPARCELA.PARCELA = 1

INNER JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA

INNER JOIN FLAN(NOLOCK)
	ON FLAN.IDLAN = SLAN.IDLAN
	AND FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
	AND FLAN.STATUSLAN IN (1, 3)*/
	
LEFT JOIN SPSPARAMETROPS (NOLOCK)
	ON SPSPROCESSOSELETIVO.CODCOLIGADA = SPSPARAMETROPS.CODCOLIGADA
	AND SPSPROCESSOSELETIVO.IDPS = SPSPARAMETROPS.IDPS 
	AND SPSPARAMETROPS.USAINTEGRACAORUBEUS = 'T'";4660;;;;12/11/2022;shift.maria;0;1;1;1;;;;0;aaf353ab-13f9-47bc-bbd9-15faa6127fbb;0;;-19862;shift.maria;12/11/2022;shift.maria;12/11/2022;0
S;SH.FV;Consultas utilizadas em fórmulas visuais;SELECT * FROM SCONTRATO(NOLOCK) WHERE CODCONTRATO = 171837;58;;;;09/11/2022;shift;0;1;1;1;;;;0;7eb9affb-0cfc-4343-a0b8-efbdd1c71185;0;;-1726;shift;19/05/2022;shift;09/11/2022;0
S;SH.FV.001;Consulta utilizada na FV 17 - Automação da confirmação de matrícula;"/******
	AUTOR: LAERTE
	FUNÇÃO: TRAZER DADOS PARA A EXECUÇÃO DO PROCESSO DE CONFIRMAÇÃO DE MATRÍCULA
		
	1- GRADUAÇÃO
	
	SERVIÇOS BUSCADOS:
		 1 - Mensalidade Graduação UNASP-SP
		 2 - Mensalidade Pensionato UNASP-SP
		29 - Mensalidade Graduação UNASP-EC
		38 - Mensalidade Graduação UNASP-HT
		39 - Mensalidade Graduação UNASP-EAD
		92 - Mensalidade Graduação UNASP-EC - 1º Parcela
		93 - Mensalidade Graduação UNASP-HT - 1º Parcela
		94 - Mensalidade Graduação UNASP-SP - 1º Parcela
		95 - Mensalidade Graduação UNASP- EAD - 1º Parcela
		102 - Mensalidade Pensionato UNASP-HT
		103 - Mensalidade Pensionato UNASP-SP - 1ª Parcela
		104 - Mensalidade Pensionato UNASP-HT - 1ª Parcela
		101 - Mensalidade Pensionato UNASP-EC
		106 - Mensalidade Pensionato UNASP-EC - 1ª Parcela
		113 -  Mensalidade Graduação UNASP- EAD - 1º Parc. Ingressantes
		114 - Mensalidade Graduação UNASP-EC - 1º Parc. Ingressantes
		115 - Mensalidade Graduação UNASP-HT - 1º Parc. Ingressantes
		116 - Mensalidade Graduação UNASP-SP - 1º Parc. Ingressantes
		
	DE 19 - Contrato Assinado
	PARA 2 - Cursando
******/
SELECT * FROM (
SELECT
	2 AS STATUS,
	8 AS MOTIVO,
	SPLETIVO.CODTIPOCURSO,
	SMATRICPL.CODCOLIGADA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SMATRICPL.IDPERLET,
	SMATRICPL.RA,
	SMATRICPL.CODFILIAL,
	FLAN.CODCONTRATO,
	FLAN.IDLAN,
	FLAN.PARCELA,
	FLAN.CODSERVICO,
	FLAN.SERVICO,
	FLAN.DATABAIXA,
	DTINICIOALTERACAOPROGRAMA,
	DTFIMALTERACAOPROGRAMA,
	/**VALIDAR O PAGAMENTO NO PERIODO DE MATRICULA**/
	CASE WHEN CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA) THEN 1 ELSE 0 END AS MATRICULACONFIRMADA
FROM SMATRICPL(NOLOCK)
INNER JOIN SHABILITACAOFILIALPL(NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
CROSS APPLY (
	SELECT 
		FLAN.CODCOLIGADA,
		FLAN.IDLAN,
		SCONTRATO.CODCONTRATO,
		SCONTRATO.IDPERLET,
		SPARCELA.PARCELA,
		SSERVICO.CODSERVICO,
		SSERVICO.NOME AS SERVICO,
		FLAN.DATABAIXA
	FROM FLAN(NOLOCK)
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
		AND SPARCELA.PARCELA = 1		
		AND SPARCELA.CODSERVICO IN (1,2,29,38,39,92,93,94,95,102,103,104,101,106,113,114,115,116)
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.RA = SPARCELA.RA
		AND SCONTRATO.STATUS = 'N'
		AND SCONTRATO.DTCANCELAMENTO IS NULL
	INNER JOIN SSERVICO(NOLOCK)
		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	WHERE FLAN.PAGREC = 1 AND FLAN.STATUSLAN IN (1,3)
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SPARCELA.RA = SMATRICPL.RA
	/**COMENTADO PARA OTIMIZAÇÃO DE DESEMPENHO**/
	/*AND CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA)*/
) AS FLAN
WHERE 
	SMATRICPL.CODSTATUS = 19
AND SPLETIVO.CODTIPOCURSO = 1

UNION
/**
	2 - (Pós - Graduação)
	
	SERVIÇOS BUSCADOS:
		11 - Mensalidade Pós UNASP-SP
		32 - Mensalidade Pós UNASP-EC
		42 - Mensalidade Pós UNASP-HT
		61 - Mensalidade Pós UNASP-EAD
		96 - Mensalidade Pós UNASP-EAD - 1º Parcela
		97 - Mensalidade Pós UNASP-EC - 1º Parcela
		98 - Mensalidade Pós UNASP-HT - 1º Parcela
		99 - Mensalidade Pós UNASP-SP - 1º Parcela
	
	DE 42 - Inscrito
	PARA 43 - Inscrição Confirmada
**/
SELECT
	43 AS STATUS,
	8 AS MOTIVO,
	SPLETIVO.CODTIPOCURSO,
	SMATRICPL.CODCOLIGADA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SMATRICPL.IDPERLET,
	SMATRICPL.RA,
	SMATRICPL.CODFILIAL,
	FLAN.CODCONTRATO,
	FLAN.IDLAN,
	FLAN.PARCELA,
	FLAN.CODSERVICO,
	FLAN.SERVICO,
	FLAN.DATABAIXA,
	DTINICIOALTERACAOPROGRAMA,
	DTFIMALTERACAOPROGRAMA,
	/**VALIDAR O PAGAMENTO NO PERIODO DE MATRICULA**/
	CASE WHEN CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA) THEN 1 ELSE 0 END AS MATRICULACONFIRMADA
FROM SMATRICPL(NOLOCK)
INNER JOIN SHABILITACAOFILIALPL(NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
CROSS APPLY (
	SELECT 
		FLAN.CODCOLIGADA,
		FLAN.IDLAN,
		SCONTRATO.CODCONTRATO,
		SCONTRATO.IDPERLET,
		SPARCELA.PARCELA,
		SSERVICO.CODSERVICO,
		SSERVICO.NOME AS SERVICO,
		FLAN.DATABAIXA
	FROM FLAN(NOLOCK)
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
		AND SPARCELA.PARCELA = 1		
		AND SPARCELA.CODSERVICO IN (11,32,42,61,96,97,98,99)
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.RA = SPARCELA.RA
		AND SCONTRATO.STATUS = 'N'
		AND SCONTRATO.DTCANCELAMENTO IS NULL		
	INNER JOIN SSERVICO(NOLOCK)
		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	WHERE FLAN.PAGREC = 1 AND FLAN.STATUSLAN IN (1,3)
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SPARCELA.RA = SMATRICPL.RA
	/**COMENTADO PARA OTIMIZAÇÃO DE DESEMPENHO**/
	/*AND CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA)*/
) AS FLAN
WHERE 
	SMATRICPL.CODSTATUS = 42
AND SPLETIVO.CODTIPOCURSO = 2
		  
UNION

/******
	DE 35 - Contrato Assinado
	PARA 27 - Cursando
*******/
SELECT
	27 AS STATUS,
	8 AS MOTIVO,
	SPLETIVO.CODTIPOCURSO,
	SMATRICPL.CODCOLIGADA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SMATRICPL.IDPERLET,
	SMATRICPL.RA,
	SMATRICPL.CODFILIAL,
	FLAN.CODCONTRATO,
	FLAN.IDLAN,
	FLAN.PARCELA,
	FLAN.CODSERVICO,
	FLAN.SERVICO,
	FLAN.DATABAIXA,
	DTINICIOALTERACAOPROGRAMA,
	DTFIMALTERACAOPROGRAMA,
	/**VALIDAR O PAGAMENTO NO PERIODO DE MATRICULA**/
	CASE WHEN CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA) THEN 1 ELSE 0 END AS MATRICULACONFIRMADA
FROM SMATRICPL(NOLOCK)
INNER JOIN SHABILITACAOFILIALPL(NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
CROSS APPLY (
	SELECT 
		FLAN.CODCOLIGADA,
		FLAN.IDLAN,
		SCONTRATO.CODCONTRATO,
		SCONTRATO.IDPERLET,
		SPARCELA.PARCELA,
		SSERVICO.CODSERVICO,
		SSERVICO.NOME AS SERVICO,
		FLAN.DATABAIXA
	FROM FLAN(NOLOCK)
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
		AND SPARCELA.PARCELA = 1		
		AND SPARCELA.CODSERVICO IN (11,32,42,61,96,97,98,99, /*SERVICO MESTRADO*/28,33)
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.RA = SPARCELA.RA
		AND SCONTRATO.STATUS = 'N'
		AND SCONTRATO.DTCANCELAMENTO IS NULL
	INNER JOIN SSERVICO(NOLOCK)
		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	WHERE FLAN.PAGREC = 1 AND FLAN.STATUSLAN IN (1,3)
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SPARCELA.RA = SMATRICPL.RA
	/**COMENTADO PARA OTIMIZAÇÃO DE DESEMPENHO**/
	/*AND CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA)*/
) AS FLAN
WHERE 
	SMATRICPL.CODSTATUS = 35
AND SPLETIVO.CODTIPOCURSO = 2
UNION
/**
	3 - (Extensão/Livre)
	
	SERVIÇOS BUSCADOS:
		21 - Mens. Escola de Esportes - UNASP-SP
		23 - Mens. Centro de Linguas - UNASP-SP
		25 - Mens. Clínica de Saúde e Bem Estar - UNASP-SP
		34 - Mens. Centro de Linguas - UNASP-EC						
		35 - Mens. Escola de Artes - UNASP-EC					
		36 - Mens. Escola de Esportes - UNASP-EC						
		45 - Mens. Centro de Linguas - UNASP-HT
		46 - Mens. Escola de Artes - UNASP-HT
		47 - Mens. Escola de Esportes - UNASP-HT
		58 - Cursos de Extensão Diversos
		119 - Mens. Intercâmbio Adventista
		120 - Mens. Intercâmbio Adventista - Cartão 12x
		159 - Mens. Intercâmbio Adventista - Cartão 6x
		172 - Mens. Escola de Idiomas - UNASP-SP - 1º Parcela
		173 - Mens. Escola de Esportes - UNASP-SP - 1º Parcela
		174 - Mens. Escola de Esportes - UNASP-SP - Cartão 6x
	
	DE 22 - Reserva de Vaga
	   37 - Contrato Assinado
	   69 - Inscrição confirmada
	   
	PARA 23 - Cursando
**/
SELECT
	23 AS STATUS,
	13 AS MOTIVO,
	SPLETIVO.CODTIPOCURSO,
	SMATRICPL.CODCOLIGADA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SMATRICPL.IDPERLET,
	SMATRICPL.RA,
	SMATRICPL.CODFILIAL,
	FLAN.CODCONTRATO,
	FLAN.IDLAN,
	FLAN.PARCELA,
	FLAN.CODSERVICO,
	FLAN.SERVICO,
	FLAN.DATABAIXA,
	DTINICIOALTERACAOPROGRAMA,
	DTFIMALTERACAOPROGRAMA,	
	/**VALIDAR O PAGAMENTO NO PERIODO DE MATRICULA**/
	CASE WHEN CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA) THEN 1 ELSE 0 END AS MATRICULACONFIRMADA
FROM SMATRICPL(NOLOCK)
INNER JOIN SHABILITACAOFILIALPL(NOLOCK)
	ON SHABILITACAOFILIALPL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIALPL.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
CROSS APPLY (
	SELECT 
		FLAN.CODCOLIGADA,
		FLAN.IDLAN,
		SCONTRATO.CODCONTRATO,
		SCONTRATO.IDPERLET,
		SPARCELA.PARCELA,
		SSERVICO.CODSERVICO,
		SSERVICO.NOME AS SERVICO,
		FLAN.DATABAIXA
	FROM FLAN(NOLOCK)
	INNER JOIN SLAN(NOLOCK)
		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
		AND SLAN.IDLAN = FLAN.IDLAN
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA
		AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
		AND SPARCELA.PARCELA = 1		
		AND SPARCELA.CODSERVICO IN (21,23,25,34,35,36,45,46,47,58,119,120,159,172,173,174)
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
		AND SCONTRATO.RA = SPARCELA.RA
		AND SCONTRATO.STATUS = 'N'
		AND SCONTRATO.DTCANCELAMENTO IS NULL		
	INNER JOIN SSERVICO(NOLOCK)
		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	WHERE FLAN.PAGREC = 1 AND FLAN.STATUSLAN IN (1,3)
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SPARCELA.RA = SMATRICPL.RA
	/**COMENTADO PARA OTIMIZAÇÃO DE DESEMPENHO**/
	/*AND CONVERT(DATE,FLAN.DATABAIXA) BETWEEN CONVERT(DATE,DTINICIOALTERACAOPROGRAMA) AND CONVERT(DATE,DTFIMALTERACAOPROGRAMA)*/
) AS FLAN
WHERE 
	SMATRICPL.CODSTATUS IN (22,37,69)
AND SPLETIVO.CODTIPOCURSO = 3
) SUB 
WHERE MATRICULACONFIRMADA > 0";11927;;;;05/11/2022;shift;0;1;1;1;;;;0;fcb2f070-bfd9-4194-856c-ed7152c39e06;;;3961;shift;14/04/2022;shift;05/11/2022;
S;SH.FV.002;Consulta utilizada na FV 45 - Atualizar vencimento boleto captação;"/******
	AUTOR: LAERTE
	FUNÇÃO: TRAZER DADOS PARA A EXECUÇÃO DOS PROCESSOS: CANCELAR REMESSA, CANCELAR BOLETO, INCLUIR BOLETO E ATUALIZAR O VENCIMENTO
******/
SELECT TOP 1 * FROM(
SELECT
	1 AS STATUSCONSULTA,
	FLAN.CODCOLIGADA,
	FLAN.CODFILIAL,
	FBOLETO.IDBOLETO,
	CASE WHEN FBOLETO.CNABSTATUS IN (2,5) THEN 1 ELSE 0 END AS STATUSREGISTRO,
	FLAN.IDLAN,
	FLAN.CODCFO,
	FLAN.CODCXA,
	FLAN.IDCONVENIO,
	FCONVENIO.ESPECIECNAB,
	CONCAT(CONVERT(VARCHAR,GETDATE(),23),'T00:00:00') AS DATASISTEMA,
	CONCAT(CONVERT(VARCHAR,GETDATE()+3,23),'T00:00:00') AS DATAVENCIMENTO,
	CONCAT(CONVERT(VARCHAR,GETDATE(),23),'T00:00:00-03:00') AS DATASISTEMAATUALIZACAO,
	CONCAT(CONVERT(VARCHAR,GETDATE()+3,23),'T00:00:00-03:00') AS DATAVENCIMENTOATUALIZACAO
	
FROM FLAN(NOLOCK)
INNER JOIN FLANBOLETO(NOLOCK)
	ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANBOLETO.IDLAN = FLAN.IDLAN
INNER JOIN FBOLETO(NOLOCK)
	ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
	AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
INNER JOIN FCFO(NOLOCK)
	ON FCFO.CODCFO = FLAN.CODCFO
INNER JOIN FCONVENIO(NOLOCK)
	ON FCONVENIO.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FCONVENIO.IDCONVENIO = FLAN.IDCONVENIO
WHERE FLAN.CODCOLIGADA = :CODCOLIGADA
AND FLAN.IDLAN = :IDLAN /*217331*/
AND FLANBOLETO.IDBOLETO = :IDBOLETO /*201579*/
/**BOLETO PRECISA ESTÁ VENCIDO**/
AND CONVERT (DATE,GETDATE()) > CONVERT (DATE,FBOLETO.VENCIMENTO)

UNION

SELECT
	0 AS STATUSCONSULTA,
	0 CODCOLIGADA,
	0 CODFILIAL,
	0 IDBOLETO,
	0 STATUSREGISTRO,
	0 IDLAN,
	0 CODCFO,
	'' CODCXA,
	0 IDCONVENIO,
	'' ESPECIECNAB,
	'' DATASISTEMA,
	'' DATAVENCIMENTO,
	'' DATASISTEMAATUALIZACAO,
	'' DATAVENCIMENTOATUALIZACAO
) AS SUB
ORDER BY STATUSCONSULTA DESC";1729;;;;10/05/2022;shift;0;1;1;1;;;;0;fcb2f070-bfd9-4194-856c-ed7152c39e06;;;7119;shift;27/04/2022;shift;10/05/2022;
S;SH.FV.003;Consulta utilizada na FV 45 - Atualizar vencimento boleto captação;"/******
	AUTOR: LAERTE
	FUNÇÃO: TRAZER DADOS PARA A EXECUÇÃO DOS PROCESSOS: CANCELAR REMESSA, CANCELAR BOLETO, INCLUIR BOLETO E ATUALIZAR O VENCIMENTO
******/
SELECT
	FLAN.CODCOLIGADA,
	FLAN.CODFILIAL,
	FBOLETO.IDBOLETO,
	FBOLETO.STATUS,
	CASE WHEN FBOLETO.CNABSTATUS IN (2,5) THEN 1 ELSE 0 END AS STATUSREGISTRO,
	FLAN.IDLAN,
	CONCAT(CONVERT(VARCHAR,GETDATE(),23),'T00:00:00-03:00') AS DATASISTEMA,
	CONCAT(CONVERT(VARCHAR,FBOLETO.VENCIMENTO+3,23),'T00:00:00-03:00') AS DATAVENCIMENTO
	
FROM FLAN(NOLOCK)
INNER JOIN FLANBOLETO(NOLOCK)
	ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
	AND FLANBOLETO.IDLAN = FLAN.IDLAN
INNER JOIN FBOLETO(NOLOCK)
	ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA
	AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
	AND (FBOLETO.RECCREATEDBY = 'shift' OR FBOLETO.RECCREATEDBY = 'wsrubeus')
	AND FBOLETO.STATUS = 0
WHERE FLAN.CODCOLIGADA = :CODCOLIGADA
AND FLAN.IDLAN = :IDLAN /*217331*/
ORDER BY FBOLETO.RECCREATEDON,FBOLETO.IDBOLETO";980;;;;10/05/2022;shift;0;1;1;1;;;;0;fcb2f070-bfd9-4194-856c-ed7152c39e06;;;9422;shift;29/04/2022;shift;10/05/2022;
S;SH.FV.004;Consulta utilizada na FV 47 - Enturmação de aluno captação;"/******
	AUTOR: LAERTE
	FUNÇÃO: TRAZER DADOS PARA A EXECUÇÃO DO PROCESSO: MATRICULAR ALUNO EM DISCIPLINAS
	
	- VARIAVEIS DA CONSULTA
******/
DECLARE @P1 INT = 		   :CODCOLIGADADECLARE @P2 INT = 		   :IDPERLET
DECLARE @P3 INT = 		   :IDHABILITACAOFILIAL
DECLARE @P4 VARCHAR(MAX) = :RA
DECLARE @P5 VARCHAR(MAX) = :CODTURMA

SELECT
	CASE WHEN SMATRICPL.RA IS NULL OR SDISCIPLINA.CODDISC IS NULL THEN 0 ELSE 1 END AS STATUSCONSULTA,
	STURMA.CODCOLIGADA,
	STURMA.CODFILIAL,
	STURMA.CODTURMA,
	STURMA.CODTIPOCURSO,
	CASE WHEN STURMA.CODTIPOCURSO = 1 THEN 'Nao' ELSE 'Sim' END AS GERARLANCAMENTO,
	STURMA.IDHABILITACAOFILIAL,
	SDISCIPLINA.CODDISC,
	SDISCIPLINA.IDTURMADISC,
	SDISCIPLINA.NOME AS NOMEDISC,
	LEFT(SDISCIPLINA.CH,2) AS CH,
	REPLACE(SDISCIPLINA.NUMCREDITOS,',','.') AS NUMCREDITOS,
	SMATRICPL.RA,
	SMATRICPL.CODCONTRATO,
	SMATRICPL.CODPLANOPGTO,
	SMATRICPL.CODSTATUS,
	STURMA.IDPERLET,
	SMATRICPL.CODTIPOMAT,
	CONCAT(CONVERT(VARCHAR,GETDATE(),23),'T',CONVERT(TIME,GETDATE()),'-03:00') AS DATAMATRICULA
	
FROM STURMA(NOLOCK)
/**DADOS MATRICULA**/
OUTER APPLY(
	SELECT
		SMATRICPL.CODCOLIGADA,
		SMATRICPL.RA,
		SCONTRATO.CODCONTRATO,
		SCONTRATO.CODPLANOPGTO,
		SMATRICPL.CODSTATUS,
		SMATRICPL.CODTIPOMAT
	FROM SMATRICPL(NOLOCK)
	INNER JOIN SCONTRATO(NOLOCK)
		ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
		AND SCONTRATO.RA = SMATRICPL.RA
		AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
		AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	WHERE SMATRICPL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SMATRICPL.CODFILIAL = STURMA.CODFILIAL
	AND SMATRICPL.IDHABILITACAOFILIAL = STURMA.IDHABILITACAOFILIAL
	AND SMATRICPL.IDPERLET = STURMA.IDPERLET
	AND SMATRICPL.RA = @P4
) AS SMATRICPL 

/**VALIDACAO PARA IGNORAR DISCIPLINAS EM CURSO OU JA CURSADAS**/
OUTER APPLY(
	SELECT 
		SDISCIPLINA.NOME,
		SDISCIPLINA.CH,
		NUMCREDITOS,
		SDISCIPLINA.CODDISC,
		STURMADISC.IDTURMADISC
	FROM SDISCIPLINA(NOLOCK)
	INNER JOIN STURMADISC(NOLOCK)
		ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
		AND STURMADISC.CODFILIAL = STURMA.CODFILIAL
		AND STURMADISC.IDPERLET = STURMA.IDPERLET
		AND STURMADISC.CODTURMA = STURMA.CODTURMA
		AND STURMADISC.IDHABILITACAOFILIAL = STURMA.IDHABILITACAOFILIAL
		AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
	WHERE SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA	
	AND SDISCIPLINA.CODTIPOCURSO = STURMA.CODTIPOCURSO
	/**VALIDAR CASO HAJA CURSADO DISCIPLINA NO MESMO NIVEL DE ENSINO**/
	AND SDISCIPLINA.CODDISC NOT IN (
									/**DISCIPLINAS CONCLUIDAS**/
									SELECT
										CASE 
											WHEN SDISCIPLINA.CODDISC IN ('G0196.1','G0196.2','G0196.3','G0196.4','G0196.5','G0196.6','G0196.7') THEN SDISCIPLINA.CODDISC
										ELSE SHISTDISCCONCLUIDAS.CODDISC END AS CODDISC
									FROM SHISTDISCCONCLUIDAS(NOLOCK) 									
									WHERE SHISTDISCCONCLUIDAS.CODCOLIGADA = @P1
									AND RA = @P4
									UNION
									/**DISCIPLINAS PENDENTES**/
									SELECT
										SHISTDISCPENDENTES.CODDISC
									FROM SHISTDISCPENDENTES(NOLOCK)
									WHERE SHISTDISCPENDENTES.CODCOLIGADA = @P1
									AND SHISTDISCPENDENTES.RA = @P4
									AND SHISTDISCPENDENTES.STATUS = 'Cursando'
									UNION
									/**EQUIVALENCIAS CONCLUIDAS**/
									SELECT 
										SHISTDISCEQUIVCONCLUIDAS.CODDISC
									FROM SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
									WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = @P1
									  AND SHISTDISCEQUIVCONCLUIDAS.RA = @P4
									UNION
									SELECT 
										CASE WHEN SHISTDISCEQUIVCONCLUIDAS.CODDISC IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.CODDISC ELSE SHISTDISCCONCLUIDAS.CODDISC END CODDISC						               
							        FROM SHISTDISCCONCLUIDAS (NOLOCK)
							       	LEFT JOIN SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
							       		ON SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
							       		AND SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
							       		AND SHISTDISCEQUIVCONCLUIDAS.RA = SHISTDISCCONCLUIDAS.RA
							       		AND SHISTDISCEQUIVCONCLUIDAS.GREQUIV = SHISTDISCCONCLUIDAS.GREQUIV	 
							        WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = @P1
							               AND SHISTDISCCONCLUIDAS.RA = @P4
							               AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0
									UNION  
									/**EQUIVALENCIAS EM CURSO**/
									SELECT 
										SHISTDISCEQUIVEMCURSO.CODDISC
									FROM SHISTDISCEQUIVEMCURSO (NOLOCK)
									WHERE SHISTDISCEQUIVEMCURSO.CODCOLIGADA = @P1
									AND SHISTDISCEQUIVEMCURSO.RA = @P4
									
									UNION
									/**EM ULTIMO RECURSO BUSCAR NA SMATRICULA**/
									SELECT
										STURMADISC.CODDISC
									FROM SMATRICULA(NOLOCK) 
									INNER JOIN STURMADISC(NOLOCK)
										ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
										AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
										AND STURMADISC.IDPERLET = SMATRICULA.IDPERLET
									INNER JOIN SSTATUS(NOLOCK)
										ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
										AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
										AND SSTATUS.CODTIPOCURSO = STURMA.CODTIPOCURSO
										AND SSTATUS.DESCRICAO IN ('Cursando','Aprovado')
									WHERE SMATRICULA.CODCOLIGADA = @P1
									AND RA = @P4									)
	/**VALIDAR CASO JÁ POSSUA MATRICULA NO PERIODO LETIVO**/
	AND SDISCIPLINA.CODDISC NOT IN (SELECT 
										STURMADISC.CODDISC
									FROM SMATRICULA(NOLOCK) 
									INNER JOIN STURMADISC(NOLOCK)
										ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
										AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
										AND STURMADISC.IDPERLET = SMATRICULA.IDPERLET
									INNER JOIN SSTATUS(NOLOCK)
										ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
										AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
										AND SSTATUS.CODTIPOCURSO = STURMA.CODTIPOCURSO
									WHERE SMATRICULA.CODCOLIGADA = @P1
									AND RA = @P4
									AND STURMADISC.CODTURMA = @P5
									AND SMATRICULA.IDPERLET = @P2)					
) AS SDISCIPLINA

WHERE STURMA.CODCOLIGADA = @P1
AND STURMA.IDPERLET = @P2
AND STURMA.IDHABILITACAOFILIAL = @P3
AND STURMA.CODTURMA = @P5 ";6258;;;;21/06/2022;shift;0;1;1;1;;;;0;fcb2f070-bfd9-4194-856c-ed7152c39e06;;;-31570;shift;12/05/2022;shift;21/06/2022;
S;SH.FV.005;Consulta utilizada na FV 47 - Enturmação de aluno captação;"/******
	AUTOR: LAERTE
	FUNÇÃO: TRAZER DADOS PARA A EXECUÇÃO DO PROCESSO: MATRICULAR ALUNO EM DISCIPLINAS
	
	- VARIAVEIS DA CONSULTA
******/
DECLARE @P1 INT = /*1*/ :CODCOLIGADADECLARE @P2 INT = /*991 */:IDPERLET
DECLARE @P3 INT = /*15855*/ :IDHABILITACAOFILIAL
DECLARE @P4 VARCHAR(MAX) = /*'058421'*/ :RA

SELECT
	SPARCELA.CODCOLIGADA,
	SPARCELA.IDPARCELA,
	SCONTRATO.CODFILIAL,
	SCONTRATO.CODTIPOCURSO,
	CASE WHEN SCONTRATO.CODTIPOCURSO = 2 AND SLAN.IDLAN IS NULL THEN 1 ELSE 0 END GERARLANCAMENTO
FROM SPARCELA(NOLOCK)
INNER JOIN SCONTRATO(NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = @P3
	AND SCONTRATO.RA = @P4
	AND SCONTRATO.DTCANCELAMENTO IS NULL
INNER JOIN SPLETIVO(NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SPARCELA.IDPERLET
LEFT JOIN SLAN(NOLOCK)
	ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
WHERE SPARCELA.CODCOLIGADA = @P1
AND SPARCELA.IDPERLET = @P2
AND SPARCELA.PARCELA = 1";1142;;;;18/08/2022;wsrubeus;0;1;1;1;;;;0;fcb2f070-bfd9-4194-856c-ed7152c39e06;;;-1435;shift;26/05/2022;wsrubeus;18/08/2022;
S;SH.FV.006;Consulta utilizada na FV 93 - Assinar contrato e gerar lançamento parcela 1;"/******
	AUTOR: LAERTE
	FUNÇÃO: TRAZER DADOS PARA A EXECUÇÃO DO PROCESSO: MATRICULAR ALUNO EM DISCIPLINAS
	
	- VARIAVEIS DA CONSULTA
******/
SELECT 
	SMATRICPL.CODCOLIGADA,
	SMATRICPL.IDPERLET,
	SMATRICPL.RA,
	SCONTRATO.CODCONTRATO,
	SCONTRATO.IDLAN,
	SCONTRATO.IDPARCELA,
	SPLETIVO.CODTIPOCURSO,
	SMATRICPL.CODFILIAL,
	'S' AS ASSINADO,
	CONCAT(CONVERT(VARCHAR(10),GETDATE(), 120),' 00:00:00') AS DATAASSINATURA
	
FROM SMATRICPL(NOLOCK)
/**
	DADOS CONTRATO
	CONTRATOS QUE NÃO TEM LANÇAMENTO GERADO NA PRIMEIRA PARCELA
**/
CROSS APPLY(
	SELECT
		SCONTRATO.CODCOLIGADA,
		SCONTRATO.CODCONTRATO,
		FLAN.IDLAN,
		SPARCELA.IDPARCELA
	FROM SCONTRATO(NOLOCK)
	INNER JOIN SPARCELA(NOLOCK)
		ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
		AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
		AND SPARCELA.PARCELA = 1
	OUTER APPLY(
		SELECT 
			SLAN.IDLAN
		FROM SLAN(NOLOCK)
		INNER JOIN FLAN(NOLOCK)
			ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
			AND FLAN.IDLAN = SLAN.IDLAN
		WHERE SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
		AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
	) AS FLAN
	WHERE SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.DTCANCELAMENTO IS NULL
	AND SCONTRATO.STATUS = 'N'
	AND FLAN.IDLAN IS NULL
) AS SCONTRATO
CROSS APPLY(
	SELECT
		CODCOLIGADA,
		IDPERLET,
		CODTIPOCURSO
	FROM SPLETIVO(NOLOCK)
	WHERE CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND IDPERLET = SMATRICPL.IDPERLET
	AND CODTIPOCURSO = 1
) AS SPLETIVO
	
WHERE CODFILIAL = 4
/*AND CODSTATUS = 19*/
AND CODTIPOMAT = 2
AND YEAR(RECCREATEDON) > 2021
AND SMATRICPL.RA = '018863'";1758;;;;09/11/2022;shift;0;1;1;1;;;;0;fcb2f070-bfd9-4194-856c-ed7152c39e06;;;25271;shift;07/11/2022;shift;09/11/2022;
S;SQLAtMatrizC;SQL Atualiza Matriz Curricular - Formado;"select shabilitacaoaluno.ra,
       ppessoa.nome as aluno,
       case when count(*) > 0 then 'Atualizado' else 'Verificar Aluno' 
       end as FORMADO
  from shabilitacaoaluno (nolock)
 inner join shabilitacaofilial (nolock) on shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada and shabilitacaoaluno.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial
 inner join saluno (nolock) on shabilitacaoaluno.codcoligada = saluno.codcoligada and shabilitacaoaluno.ra = saluno.ra
 inner join ppessoa (nolock) on saluno.codpessoa = ppessoa.codigo
 where shabilitacaoaluno.codcoligada = :CODCOLIGADA_N   
   and shabilitacaofilial.codfilial = :CODFILIAL_N
   and shabilitacaoaluno.dtcolacaograu = :DTCOLACAOGRAU_D
   and shabilitacaoaluno.codstatus = '11'
   group by shabilitacaoaluno.ra, ppessoa.nome";827;;;;23/12/2021;raphael.muzy;0;1;1;1;;;;0;615231f1-ca32-471d-90f3-2070bbe257a8;0;;-18158;raphael.muzy;23/12/2021;consultor1.totvs;04/08/2022;0
S;SQLCubDocPend;SQL Cubo Documentos Solicitados;"select gfilial.nomefantasia as filial,
	STIPOCURSO.NOME AS 'Nivel Ensino',
       sdocaluno.ra,
	   ppessoa.nome as aluno,
	   ppessoa.email,
	   ppessoa.telefone1 as 'Telefone Residencial',
	   ppessoa.telefone2 as 'Telefone Celular',
       sdocaluno.idperlet,
	   spletivo.codperlet,
	   spletivo.descricao as periodo_letivo,
	   scurso.codcurso,
	   scurso.nome as curso,
	   sstatus.descricao as 'Status no Curso',
	   sdocumento.descricao,
	   case when sdocaluno.status = '0' then 'Não Entregue'
		    when sdocaluno.status = '1' then 'Entregue em Validação'
			when sdocaluno.status = '2' then 'Recusado'
			when sdocaluno.status = '3' then 'Validado'
	   end as status,
	   smotivorejeicaodocumento.descricao as motivo_rejeicao
  from sdocaluno (nolock)
 left join sdocumento (nolock) on sdocaluno.coddocumento = sdocumento.coddocumento
 inner join saluno (nolock) on sdocaluno.codcoligada = saluno.codcoligada and sdocaluno.ra = saluno.ra
 inner join ppessoa (nolock) on saluno.codpessoa = ppessoa.codigo
 inner join spletivo (nolock) on sdocaluno.codcoligada = spletivo.codcoligada and sdocaluno.idperlet = spletivo.idperlet
 /*Modificado em 12/04/2022 Nathan PVT - Adicionado join para mostrar nivel de ensino.*/
 INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
  left join smotivorejeicaodocumento (nolock) on sdocaluno.idmotivorejeicaodocumento = smotivorejeicaodocumento.idmotivorejeicaodocumento
  left join shabilitacaoaluno (nolock) on saluno.codcoligada = shabilitacaoaluno.codcoligada and saluno.ra = shabilitacaoaluno.ra
 inner join shabilitacaofilial (nolock) on shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada and shabilitacaoaluno.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial
 inner join gfilial (nolock) on shabilitacaofilial.codcoligada = gfilial.codcoligada and shabilitacaofilial.codfilial = gfilial.codfilial
 inner join scurso (nolock) on shabilitacaofilial.codcoligada = scurso.codcoligada and shabilitacaofilial.codcurso = scurso.codcurso
 /*Modificado em 14/03/2022 Nathan PVT - Adicionado join para pegar o status do aluno no curso*/
 inner join sstatus (nolock) on sstatus.codcoligada = shabilitacaoaluno.codcoligada and sstatus.codstatus = shabilitacaoaluno.codstatus
 where shabilitacaofilial.ativo = 'S'
   and spletivo.codperlet LIKE '%' + :codperlet_S + '%'";2447;;;;18/08/2022;consultor1.totvs;0;1;1;1;;;;0;b35ac501-2b7b-4010-aa0b-e7a5c82f0c82;0;;-14210;raphael.muzy;21/12/2021;consultor1.totvs;18/08/2022;0
S;SQLFormandos;SQL Filtro Formandos;"select shabilitacaoaluno.ra
  from shabilitacaoaluno (NOLOCK)
 inner join shabilitacaofilial on shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada and shabilitacaoaluno.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial
 where shabilitacaoaluno.dtcolacaograu >= :dtcolacaograu_D
   and shabilitacaoaluno.codcoligada = :$CODCOLIGADA
   and shabilitacaofilial.codfilial = :$CODFILIAL";408;;;;08/12/2021;raphael.muzy;0;1;1;1;;;;0;5d8059b7-b75b-46b2-9bcb-f1ecaf6b7127;0;;-10662;raquel.faria;08/12/2021;raphael.muzy;08/12/2021;0
S;TESTE;TESTE - PODE LIMPAR DADOS;"SELECT *
FROM SMATRICPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
LEFT JOIN SMATRICULA ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SMATRICULA.IDPERLET = SMATRICPL.IDPERLET
	AND SMATRICULA.RA = SMATRICPL.RA
WHERE SPLETIVO.CODPERLET = '2023/1'
AND SMATRICPL.CODTIPOMAT = 2
AND SMATRICULA.CODCOLIGADA IS NULL";464;;;;10/11/2022;consultor1.totvs;0;1;1;1;;;;0;0cece68e-2f8e-4ba8-86db-a18e33e1075d;0;;-20835;mestre;11/01/2021;consultor1.totvs;10/11/2022;0
S;teste 02 dev;Teste 02 Dev;"
SELECT  STURMADISC.CODCOLIGADA,
                        STURMADISC.IDTURMADISC,
                        STURMADISC.CODTURMA,
                        STURMADISC.IDPERLET,
                        STURMADISC.IDHABILITACAOFILIAL,
                        SDISCIPLINA.CODDISC,
                        SDISCIPLINA.NOME,
                        SDISCIPLINA.NUMCREDITOS,
                        SMATRICULA.CODSTATUS,
                        SMATRICULA.CODSUBTURMA,
                        SMATRICULA.NUMDIARIO,
                        SMATRICULA.TIPOMAT,
                        SDISCGRADE.NUMCREDITOSCOB,
                        0 SELECIONADO,
                        SDISCGRADE.TIPODISC,
                        SDISCIPLINA.CH,
                        STURMADISC.CODFILIAL,
                        SDISCGRADE.CODPERIODO,
                        SPERIODO.DESCRICAO
                FROM    STURMADISC (NOLOCK)
                        JOIN SDISCIPLINA (NOLOCK)
                                ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
                                   AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
                        LEFT    JOIN (SELECT  CODCOLIGADA,
                                      IDTURMADISC,
                                      CODSTATUS,
                                      CODSUBTURMA,
                                      NUMDIARIO,
                                      TIPOMAT,
                                      NUMCREDITOSCOB
                              FROM   SMATRICULA (NOLOCK)
                              WHERE  CODCOLIGADA = 1
                                      AND RA = '018846') SMATRICULA
                          ON ( STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                              AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC )
                          LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
                            ON ( STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL )
                          LEFT JOIN SGRADE (NOLOCK)
                            ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
                                AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
                                AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
                                AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE )
                          LEFT JOIN SDISCGRADE (NOLOCK)
                            ON ( SGRADE.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
                                AND SGRADE.CODCURSO = SDISCGRADE.CODCURSO
                                AND SGRADE.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
                                AND SGRADE.CODGRADE = SDISCGRADE.CODGRADE
                                AND STURMADISC.CODDISC = SDISCGRADE.CODDISC )                           
                           LEFT JOIN SPERIODO (NOLOCK)
                             ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
			                          AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO
			                          AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
			                          AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE
			                          AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
			                          
			                          
			           
			                          
			           LEFT JOIN (
					SELECT  SHISTDISCPENDENTES.CODCOLIGADA,
									  SHISTDISCPENDENTES.RA,
									SHISTDISCPENDENTES.CODDISC
                              FROM  SHISTDISCPENDENTES
                              WHERE  SHISTDISCPENDENTES.CODCOLIGADA = 1
                                      /*AND SHISTDISCPENDENTES.RA = SMATRICPL.RA*/
									  
									  ) VALIDACAOPEND
									  ON VALIDACAOPEND.CODCOLIGADA = STURMADISC.CODCOLIGADA
										AND VALIDACAOPEND.CODDISC = STURMADISC.CODDISC   
										AND VALIDACAOPEND.RA = '018846'
			                          
			                          
			             LEFT JOIN (
					SELECT  SHISTDISCCONCLUIDAS.CODCOLIGADA,
									  SHISTDISCCONCLUIDAS.RA,
									SHISTDISCCONCLUIDAS.CODDISC
                              FROM  SHISTDISCCONCLUIDAS
                              WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = 1
                                      /*AND SHISTDISCCONCLUIDAS.RA = SMATRICPL.RA*/
									  
									  ) VALIDACAOCONC
									  ON VALIDACAOPEND.CODCOLIGADA = STURMADISC.CODCOLIGADA
										AND VALIDACAOPEND.CODDISC = STURMADISC.CODDISC 
										AND VALIDACAOCONC.RA = '018846'
			                
			                
	
										
										
			                          
                WHERE  STURMADISC.CODCOLIGADA = 1
                       AND STURMADISC.CODFILIAL = 2
                       AND STURMADISC.CODTURMA = ''
                       AND STURMADISC.IDPERLET = 1014
                       /*MODIFICADO EM 08/11/2022 NATHAN PVT - ADICIONADO VALIDAÇÃO PARA CONSIDERAR APENAS DAS TURMAS DA HABILITACAO DO ALUNO, 
                       ESTAVA PEGANDO TURMAS COM O MESMO CÓDIGO PORÉM ESTAVA EM HABILITACAO DIFERENTE*/
                       AND STURMADISC.IDHABILITACAOFILIAL = 15844
                       /**/
                       AND STURMADISC.GERENCIAL <> 'S'
                       AND VALIDACAOPEND.CODCOLIGADA IS NULL
                       AND VALIDACAOCONC.CODCOLIGADA IS NULL
                       AND STURMADISC.ATIVA = 'S'
                       AND (SDISCIPLINA.ITINERARIOFORMATIVO IS NULL OR SDISCIPLINA.ITINERARIOFORMATIVO <> 'S')  AND ((STURMADISC.DTINICIOMATPRES IS NULL AND STURMADISC.DTFIMMATPRES IS NULL) OR
                                          (GETDATE() BETWEEN STURMADISC.DTINICIOMATPRES AND STURMADISC.DTFIMMATPRES)) 
";5963;0;;;10/11/2022;consultor1.totvs;0;1;1;1;;;;0;b72a6101-a5d9-4673-addb-dfeeb0fba184;0;;21432;sergio;19/01/2021;consultor1.totvs;10/11/2022;0
S;TESTE 03;TESTE 03;"SELECT 
	SSTATUS.CODTIPOCURSO,
	SPLETIVO.CODTIPOCURSO,
	SSTATUS.DESCRICAO,
	SS.DESCRICAO,
	SS.CODSTATUS
FROM SMATRICULA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
	INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
		AND SPLETIVO.IDPERLET = SMATRICULA.IDPERLET
	INNER JOIN SSTATUS SS ON SS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
		AND SS.CODTIPOCURSO = 2
		AND SS.DESCRICAO = SSTATUS.DESCRICAO
WHERE
SSTATUS.CODTIPOCURSO <> SPLETIVO.CODTIPOCURSO
AND SPLETIVO.CODTIPOCURSO = 2";577;0;;;10/11/2022;consultor1.totvs;0;1;1;1;;;;0;4b28335c-9e73-4253-a056-2773d6878709;0;;-18812;sergio;19/01/2021;consultor1.totvs;10/11/2022;0
S;TESTE.001;TESTE FELIPE TOTVS;"
SELECT DISTINCT
/*TOP 500 (SMATRICPL.RA),*/
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA,
SMATRICPL.IDHABILITACAOFILIAL,
SMATRICPL.CODTURMA,
PPESSOA.NOME,
B.*

FROM SMATRICPL
INNER JOIN STIPOMATRICULA ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN STURMA ON STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STURMA.CODTURMA = SMATRICPL.CODTURMA
	AND STURMA.IDPERLET = SMATRICPL.IDPERLET
	AND STURMA.CODFILIAL = SMATRICPL.CODFILIAL



OUTER APPLY(

SELECT 
	SP.CODPERLET,
	STPROX.*
FROM STURMA STPROX
INNER JOIN SPLETIVO SP ON SP.CODCOLIGADA = STPROX.CODCOLIGADA
	AND SP.IDPERLET = STPROX.IDPERLET
WHERE 
	STPROX.CODCOLIGADA = STURMA.CODCOLIGADA
	AND STPROX.CODTURMA = STURMA.CODTURMAPROX
	AND SP.IDPERLETANT = SPLETIVO.IDPERLET

	) AS A
	
	
	
	/*Consulta pega pelo Profile que o Sistema executa para pegar as disciplinas para vincular ao aluno*/
OUTER APPLY(

SELECT  STURMADISC.CODCOLIGADA,
                        STURMADISC.IDTURMADISC,
                        STURMADISC.CODTURMA,
                        STURMADISC.IDPERLET,
                        STURMADISC.IDHABILITACAOFILIAL,
                        SDISCIPLINA.CODDISC,
                        SDISCIPLINA.NOME,
                        SDISCIPLINA.NUMCREDITOS,
                        SMATRICULA.CODSTATUS,
                        SMATRICULA.CODSUBTURMA,
                        SMATRICULA.NUMDIARIO,
                        SMATRICULA.TIPOMAT,
                        SDISCGRADE.NUMCREDITOSCOB,
                        0 SELECIONADO,
                        SDISCGRADE.TIPODISC,
                        SDISCIPLINA.CH,
                        STURMADISC.CODFILIAL,
                        SDISCGRADE.CODPERIODO,
                        SPERIODO.DESCRICAO
                FROM    STURMADISC (NOLOCK)
                        JOIN SDISCIPLINA (NOLOCK)
                                ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
                                   AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
                        LEFT    JOIN (SELECT  CODCOLIGADA,
                                      IDTURMADISC,
                                      CODSTATUS,
                                      CODSUBTURMA,
                                      NUMDIARIO,
                                      TIPOMAT,
                                      NUMCREDITOSCOB
                              FROM   SMATRICULA (NOLOCK)
                              WHERE  CODCOLIGADA = 1
                                      AND RA = SMATRICPL.RA) SMATRICULA
                          ON ( STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                              AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC )
                          LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
                            ON ( STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL )
                          LEFT JOIN SGRADE (NOLOCK)
                            ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
                                AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
                                AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
                                AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE )
                          LEFT JOIN SDISCGRADE (NOLOCK)
                            ON ( SGRADE.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
                                AND SGRADE.CODCURSO = SDISCGRADE.CODCURSO
                                AND SGRADE.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
                                AND SGRADE.CODGRADE = SDISCGRADE.CODGRADE
                                AND STURMADISC.CODDISC = SDISCGRADE.CODDISC )                           
                           LEFT JOIN SPERIODO (NOLOCK)
                             ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
			                          AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO
			                          AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
			                          AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE
			                          AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
			                          
			                          
			                     OUTER APPLY (
					SELECT  SHISTDISCPENDENTES.CODCOLIGADA,
									  SHISTDISCPENDENTES.RA,
									SHISTDISCPENDENTES.CODDISC
                              FROM  SHISTDISCPENDENTES (NOLOCK)
                              WHERE  SHISTDISCPENDENTES.CODCOLIGADA = STURMADISC.CODCOLIGADA
							  AND SHISTDISCPENDENTES.CODDISC = STURMADISC.CODDISC
							  AND SHISTDISCPENDENTES.RA = SMATRICPL.RA
									  
									  ) VALIDACAOPEND
			           

			                          
			                  OUTER APPLY (
					SELECT  SHISTDISCCONCLUIDAS.CODCOLIGADA,
									  SHISTDISCCONCLUIDAS.RA,
									SHISTDISCCONCLUIDAS.CODDISC
                              FROM  SHISTDISCCONCLUIDAS (NOLOCK)
                              WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
							  AND SHISTDISCCONCLUIDAS.CODDISC = STURMADISC.CODDISC
							  AND SHISTDISCCONCLUIDAS.RA = SMATRICPL.RA
									  
									  ) VALIDACAOCONC
			                
			                
	
										
										
			                          
                WHERE  STURMADISC.CODCOLIGADA = 1
                       AND STURMADISC.CODFILIAL = SMATRICPL.CODFILIAL
                       AND STURMADISC.CODTURMA = STURMA.CODTURMAPROX
                       AND STURMADISC.IDPERLET = A.IDPERLET
                       /*MODIFICADO EM 08/11/2022 NATHAN PVT - ADICIONADO VALIDAÇÃO PARA CONSIDERAR APENAS DAS TURMAS DA HABILITACAO DO ALUNO, 
                       ESTAVA PEGANDO TURMAS COM O MESMO CÓDIGO PORÉM ESTAVA EM HABILITACAO DIFERENTE*/
                       AND STURMADISC.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
                       /**/
                       AND STURMADISC.GERENCIAL <> 'S'
                       AND VALIDACAOPEND.CODCOLIGADA IS NULL
                       AND VALIDACAOCONC.CODCOLIGADA IS NULL
                       AND STURMADISC.ATIVA = 'S'
                       AND (SDISCIPLINA.ITINERARIOFORMATIVO IS NULL OR SDISCIPLINA.ITINERARIOFORMATIVO <> 'S')  AND ((STURMADISC.DTINICIOMATPRES IS NULL AND STURMADISC.DTFIMMATPRES IS NULL) OR
                                          (GETDATE() BETWEEN STURMADISC.DTINICIOMATPRES AND STURMADISC.DTFIMMATPRES)) 

) AS B
	

WHERE SMATRICPL.CODSTATUS IN (2, 23 , 27)
AND SMATRICPL.CODFILIAL =2
AND SPLETIVO.CODPERLET ='2022/2'
AND SHABILITACAOFILIAL.CODTIPOCURSO =1
/*AND SMATRICPL.RA = '018846'*/
AND SHABILITACAOFILIAL.CODCURSO NOT IN ('EC-GPENS','HT-GPENS','SP-GPENS')
AND A.CODCOLIGADA IS NOT NULL
AND B.CODCOLIGADA IS NOT NULL
AND STIPOMATRICULA.DESCRICAO IN ('Rematrícula','Matrícula')
/*
AND SMATRICPL.RA NOT IN ( SELECT RA FROM SMATRICPL 
						  INNER JOIN SPLETIVO PL ON 
						  PL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
						  PL.IDPERLET = SMATRICPL.IDPERLET
						  INNER JOIN SHABILITACAOFILIAL ON 
						  SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
						  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
						  WHERE PL.IDPERLETANT = SPLETIVO.IDPERLET
						  AND SHABILITACAOFILIAL.CODCURSO NOT IN ('EC-GPENS','HT-GPENS','SP-GPENS', 'SP-LEFIS','SP-BEFIS','SP-BCBIO','SP-LCBIO'))*/";8109;;;;10/11/2022;consultor1.totvs;0;1;1;1;;;;0;8acf614d-c7ae-4aec-ba5f-842a2deaa166;0;;-6178;totvs;23/06/2021;consultor1.totvs;10/11/2022;0
S;TESTELM;Chamada;"select distinct
	CODFILIAL ,NomFilial Campus,RA,Nome,NomDisciplina Disciplina,' ' Segunda, ' ' Terça,' ' Quarta,' ' Quinta,' ' Sexta
from 
	v_unasp_smatricula
where
	CODCOLIGADA = :CODCOLIGADA1
	and IDTURMADISC = :IDTURMADISC1
	and codtipocurso = 3
	and NomCurso = 'escola de esportes'
	and NomStatus = 'cursando'
order by
	NomFilial,NomDisciplina, Nome";364;;;;28/07/2022;lucas.marques;0;1;1;1;;;;0;e9f2e52e-deeb-42a8-9ac7-0e39686ebbd3;0;;-8910;lucas.marques;28/07/2022;lucas.marques;28/07/2022;0
S;TESTETOTVS;Teste;"
SELECT 
	DISTINCT BHISTORICO.CODPESSOA,
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	BHISTRESPPROVA.CODRESPOSTA,
	BHISTRESPPROVA.CODQUESTAO
	/*COUNT(DISTINCT BHISTORICO.CODPESSOA) AS 'TOTALRESPONDIDO'*/
FROM BHISTORICO (NOLOCK)

INNER JOIN BHISTRESPPROVA (NOLOCK) ON BHISTORICO.CODCOLIGADA = BHISTRESPPROVA.CODCOLIGADA
		AND BHISTORICO.CODAREA = BHISTRESPPROVA.CODAREA
		AND BHISTORICO.CODMATERIA = BHISTRESPPROVA.CODMATERIA
		AND BHISTORICO.CODQUESTAO = BHISTRESPPROVA.CODQUESTAO
		AND BHISTORICO.CODPROVA = BHISTRESPPROVA.CODPROVA
		AND BHISTORICO.ID = BHISTRESPPROVA.ID
		AND BHISTRESPPROVA.CODRESPOSTA IS NULL
		/*AND BHISTRESPPROVA.IDMEMORESPABERTA IS NULL*/

INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BHISTORICO.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BHISTORICO.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
	


LEFT JOIN (

SELECT DISTINCT
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	BEXECPROVA.CODPESSOA
FROM BEXECPROVA (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BEXECPROVA.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BEXECPROVA.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
WHERE BEXECPROVA.CODPROVA =  15
) AS B ON B.CODCOLIGADA = BHISTORICO.CODCOLIGADA
	AND B.CURSO = SCURSO.NOME
	AND B.TURNO = STURNO.NOME
	AND B.CODTURMA = STURMADISC.CODTURMA
	AND B.CODCURSO = SCURSO.CODCURSO
	AND B.CODPESSOA = BHISTORICO.CODPESSOA
	
	
WHERE 
BHISTORICO.CODPROVA = 15
/*AND BHISTORICO.CODPESSOA = 186651*/
AND B.CODPESSOA IS NULL

AND STURMADISC.CODTURMA = 'GBDIRE03S-11'

/*
GROUP BY
	BHISTORICO.CODCOLIGADA,
	STURMADISC.CODTURMA,
	STURNO.NOME,
	SCURSO.CODCURSO,
	SCURSO.NOME*/";3348;;;;04/10/2022;consultor1.totvs;0;1;1;1;;;;0;1e2145df-43f8-4fc6-9b11-d318d401a2fb;0;;27571;consultor1.totvs;22/02/2022;consultor1.totvs;04/10/2022;0
S;TESTEWS;TESTE CONSULTA WS;"
SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.STATUS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.STATUS ELSE SHISTDISCOPTELETIVAS.STATUS END STATUS,
              
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELET.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELET.MINCH,
               SGRUPOOPTELET.MINCREDITOS,
               SGRUPOOPTELET.MINDISCIPLINAS,
               SGRUPOOPTELET.NOME,
               SGRUPOOPTELET.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = 1
                      AND SHISTDISCOPTELETIVAS.RA = '055432'
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = 13642 )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL )
               JOIN SGRUPOOPTELET (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
                      AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
                      AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
                      AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
               JOIN SDISCGRUPOOPTELET (NOLOCK)
                 ON ( SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
                      AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
                      AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
                      AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
                      AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
             LEFT JOIN DBO.SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
              ON DBO.SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = DBO.SHISTDISCOPTELETIVAS.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = DBO.SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.RA = DBO.SHISTDISCOPTELETIVAS.RA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.GREQUIV = DBO.SHISTDISCOPTELETIVAS.GREQUIV	 
                      
        WHERE  SPARAM.CODCOLIGADA = 1
               AND SPARAM.CODFILIAL = 2
               AND SPARAM.CODTIPOCURSO = 1
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELET.EXIBEANALISE = 'S'
               AND SGRADEALUNO.RA IS NULL
               AND SHISTDISCOPTELETIVAS.RA NOT IN (SELECT SCOMPONENTECURRALUNO.RA
                                                   FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                   WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)
                                                          
                                                          
                                                          
                                                          
/*                                                          
                                                      SELECT CASE WHEN SHISTDISCEQUIVCONCLUIDAS.CODDISC IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.CODDISC ELSE SHISTDISCCONCLUIDAS.CODDISC END CODDISC,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.DISCIPLINA ELSE SHISTDISCCONCLUIDAS.DISCIPLINA END DISCIPLINA,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.STATUS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.STATUS ELSE SHISTDISCCONCLUIDAS.STATUS END STATUS,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.PLETIVO IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.PLETIVO ELSE SHISTDISCCONCLUIDAS.PLETIVO END PLETIVO,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS ELSE SHISTDISCCONCLUIDAS.NUMCREDITOS END NUMCREDITOS,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.CH IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.CH ELSE SHISTDISCCONCLUIDAS.CH END CH,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.NOTA IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.NOTA ELSE SHISTDISCCONCLUIDAS.NOTA END NOTA,
               CASE WHEN SHISTDISCEQUIVCONCLUIDAS.FALTAS IS NOT NULL THEN SHISTDISCEQUIVCONCLUIDAS.FALTAS ELSE SHISTDISCCONCLUIDAS.FALTAS END FALTAS,
               'CONC' AS TIPO,
               SHISTDISCCONCLUIDAS.CODCOLIGADA,
               SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
               SHISTDISCCONCLUIDAS.RA,
               SHISTDISCCONCLUIDAS.GREQUIV,
               SHISTDISCCONCLUIDAS.CODPERIODO,
               SHISTDISCCONCLUIDAS.CONCEITO,
               SHISTDISCCONCLUIDAS.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCCONCLUIDAS (NOLOCK)
       	LEFT JOIN DBO.SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
              ON DBO.SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = DBO.SHISTDISCCONCLUIDAS.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = DBO.SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.RA = DBO.SHISTDISCCONCLUIDAS.RA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.GREQUIV = DBO.SHISTDISCCONCLUIDAS.GREQUIV	 
        WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = 1
               AND SHISTDISCCONCLUIDAS.RA = '055432'
               AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = 13642
               /*AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0*/*/";7390;;;;11/10/2022;totvs.nathan;0;1;1;1;;;;0;9d188adb-f958-4a21-89f2-a612dcf7663c;0;;-25881;mestre;26/01/2021;totvs.nathan;11/10/2022;0
S;TESTEWS2;TESTE 2;SELECT CODCOLIGADA, RA, CODPESSOA FROM SALUNO;45;;;;26/01/2021;mestre;0;1;1;1;;;;0;e59fae1e-3ef0-42d3-acbd-73488a994b29;0;;-14683;mestre;26/01/2021;mestre;26/01/2021;0
S;TOTVS020.1.1;MATRICULA - INFO MATRIZ;"
SELECT SALUNO.CODCOLIGADA,
       SALUNO.RA,
       PPESSOA.CODIGO,
       PPESSOA.NOME,
       PPESSOA.CARTIDENTIDADE,
       PPESSOA.UFCARTIDENT,
       PPESSOA.ORGEMISSORIDENT,
       PPESSOA.DTEMISSAOIDENT,
       PPESSOA.CPF,
       SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
       SHABILITACAOFILIAL.CODFILIAL,
       SHABILITACAOFILIAL.CODCURSO,
       SHABILITACAOFILIAL.CODHABILITACAO,
       SHABILITACAOFILIAL.CODGRADE,
       SGRADE.DESCRICAO DECRICAOGRADE,
       SCURSO.NOME NOMECURSO,
       SMATRICPL.IDPERLET,
       SMATRICPL.CODTURMA,
       STURMA.NOME NOMETURMA,
       SMATRICPL.DTMATRICULA,
       SMATRICPL.CODSTATUS,
       SPLETIVO.CODPERLET,
       SHABILITACAO.NOME AS NOMEHABILITACAO,
       SPLETIVO.DESCRICAO PERLETIVO,
       PPESSOAPAI.NOME AS NOMEPAI,
       PPESSOAMAE.NOME AS NOMEMAE,
  	   PPESSOARESPACAD.NOME AS NOMERESPACADEMICO,
       FCFO.NOME AS NOMERESPFINANCEIRO,
       GFILIAL.NOME NOMEFILIAL,
       GFILIAL.CIDADE,
       GFILIAL.ESTADO,
       GFILIAL.CIDADE + '/' + GFILIAL.ESTADO AS CIDADEUF     
  FROM SHABILITACAOALUNO
 INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                              AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
 INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                  AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
                  AND SGRADE.CODGRADE= SHABILITACAOFILIAL.CODGRADE
 INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                  AND SALUNO.RA = SHABILITACAOALUNO.RA 
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                     AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                     AND SMATRICPL.RA = SHABILITACAOALUNO.RA
                     AND SMATRICPL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
 INNER JOIN STURMA ON STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                  AND STURMA.CODFILIAL = SMATRICPL.CODFILIAL
                  AND STURMA.IDPERLET = SMATRICPL.IDPERLET
                  AND STURMA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
                  AND STURMA.CODTURMA = SMATRICPL.CODTURMA
 INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET                  

  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)    
  LEFT JOIN FCFO (NOLOCK)
     ON (SALUNO.CODCOLCFO = FCFO.CODCOLIGADA
         AND SALUNO.CODCFO = FCFO.CODCFO)
  LEFT JOIN PPESSOA PPESSOARESPACAD (NOLOCK)
     ON (SALUNO.CODPESSOARACA = PPESSOARESPACAD.CODIGO)
     
  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)

  JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
              AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
                                 
WHERE SHABILITACAOALUNO.RA = :RA
  AND SHABILITACAOALUNO.CODCOLIGADA = :$CODCOLIGADA
  AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL";4684;;;;03/02/2021;mestre;0;1;1;1;;;;0;795c5576-7f2b-4589-ac61-6630c0c440ea;0;;21776;mestre;21/01/2021;mestre;03/02/2021;0
S;TOTVS020.1.2;MATRICULA - INFO DISCIPLINAS;"SELECT SGRADE.CODGRADE, SGRADE.DESCRICAO MATRIZ, SMATRICPL.CODTURMA,
SMATRICULA.CODSTATUS,
SMATRICULA.IDTURMADISC,
SMATRICULA.DTMATRICULA,
SMATRICULA.NUMCREDITOSCOB,
SMATRICULA.TIPOMAT,
SDISCIPLINA.NOME DISCIPLINA,
SDISCIPLINA.NUMCREDITOS,
SDISCIPLINA.CODTIPOCURSO,
SDISCIPLINA.CODDISC,
CASE WHEN SDISCGRADE.TIPODISC = 'B' THEN 'Obrigatória'
     WHEN SDISCGRADE.TIPODISC = 'O' THEN 'Optativa'
     WHEN SDISCGRADE.TIPODISC = 'E' THEN 'Eletiva'
     ELSE '' END TIPODISCIPLINA,
     
CASE WHEN (SELECT count(0)  
  FROM SDISCGRUPOEQ (NOLOCK)
 WHERE SDISCGRUPOEQ.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
   AND SDISCGRUPOEQ.CODDISC = SDISCIPLINA.CODDISC) > 0 THEN 'Sim'
   ELSE 'Não' END EQUIVALENTE,
   SSTATUS.DESCRICAO DESCSTATUS,
   STIPOMATRICULA.DESCRICAO TIPOMATRICULA
  FROM SMATRICPL 
 INNER JOIN SMATRICULA ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                      AND SMATRICULA.RA = SMATRICPL.RA
                      AND SMATRICULA.IDPERLET = SMATRICPL.IDPERLET
                      AND SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
 INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                      AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
                      AND STURMADISC.CODTURMA = SMATRICPL.CODTURMA
                      AND STURMADISC.IDPERLET = SMATRICPL.IDPERLET                     
 INNER JOIN SDISCIPLINA ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                       AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC                      
 INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                              AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
 INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE   
                  AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO  
JOIN SDISCGRADE (NOLOCK) ON (SDISCGRADE.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA 
                        AND SDISCGRADE.CODDISC = SDISCIPLINA.CODDISC
                        AND SDISCGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
            		    AND SDISCGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
            			AND SDISCGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
            			AND SDISCGRADE.CODDISC = SDISCIPLINA.CODDISC)
 JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                      AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS  
 LEFT OUTER JOIN STIPOMATRICULA (NOLOCK) ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                                        AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT                    
 WHERE SMATRICULA.CODCOLIGADA = :$CODCOLIGADA
   AND SMATRICULA.IDPERLET = :IDPERLET
   AND SMATRICULA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
   AND SMATRICULA.RA = :RA";2974;;;;04/02/2021;mestre;0;1;1;1;;;;0;cbb9da3f-0e09-4a2b-8c62-0fc29a0f0459;0;;24346;mestre;21/01/2021;mestre;04/02/2021;0
S;TOTVS020.2.1;MATRICULA - INFO MATRIZ;"
SELECT SALUNO.CODCOLIGADA,
       SALUNO.RA,
       PPESSOA.CODIGO,
       PPESSOA.NOME,
       PPESSOA.CARTIDENTIDADE,
       PPESSOA.UFCARTIDENT,
       PPESSOA.ORGEMISSORIDENT,
       PPESSOA.DTEMISSAOIDENT,
       PPESSOA.CPF,
       SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
       SHABILITACAOFILIAL.CODFILIAL,
       SHABILITACAOFILIAL.CODCURSO,
       SHABILITACAOFILIAL.CODHABILITACAO,
       SHABILITACAOFILIAL.CODGRADE,
       SGRADE.DESCRICAO DECRICAOGRADE,
       SCURSO.NOME NOMECURSO,
       SMATRICPL.IDPERLET,
       SMATRICPL.CODTURMA,
       STURMA.NOME NOMETURMA,
       SMATRICPL.DTMATRICULA,
       SMATRICPL.CODSTATUS,
       SPLETIVO.CODPERLET,
       SHABILITACAO.NOME AS NOMEHABILITACAO,
       SPLETIVO.DESCRICAO PERLETIVO,
       PPESSOAPAI.NOME AS NOMEPAI,
       PPESSOAMAE.NOME AS NOMEMAE,
  	   PPESSOARESPACAD.NOME AS NOMERESPACADEMICO,
       FCFO.NOME AS NOMERESPFINANCEIRO,
       GFILIAL.NOME NOMEFILIAL,
       GFILIAL.CIDADE,
       GFILIAL.ESTADO,
       GFILIAL.CIDADE + '/' + GFILIAL.ESTADO AS CIDADEUF     
  FROM SHABILITACAOALUNO
 INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                              AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
 INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                  AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
                  AND SGRADE.CODGRADE= SHABILITACAOFILIAL.CODGRADE
 INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                  AND SALUNO.RA = SHABILITACAOALUNO.RA 
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
 INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                     AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                     AND SMATRICPL.RA = SHABILITACAOALUNO.RA
                     AND SMATRICPL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
 INNER JOIN STURMA ON STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                  AND STURMA.CODFILIAL = SMATRICPL.CODFILIAL
                  AND STURMA.IDPERLET = SMATRICPL.IDPERLET
                  AND STURMA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
                  AND STURMA.CODTURMA = SMATRICPL.CODTURMA
 INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET                  

  LEFT JOIN VFILIACAO VFILIACAOPAI (NOLOCK)
     ON (VFILIACAOPAI.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOPAI.TIPORELACIONAMENTO = 'P'
     AND VFILIACAOPAI.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOPAI.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'P'))
  LEFT JOIN PPESSOA PPESSOAPAI (NOLOCK)
     ON (PPESSOAPAI.CODIGO = VFILIACAOPAI.CODPESSOAFILIACAO)
  LEFT JOIN VFILIACAO VFILIACAOMAE (NOLOCK)
     ON (VFILIACAOMAE.CODPESSOAFILHO = SALUNO.CODPESSOA
     AND VFILIACAOMAE.TIPORELACIONAMENTO = 'M'
     AND VFILIACAOMAE.CODFILIACAO = (SELECT MIN(VFILIACAO.CODFILIACAO)
                                     FROM VFILIACAO (NOLOCK)
                                     WHERE VFILIACAO.CODPESSOAFILHO = VFILIACAOMAE.CODPESSOAFILHO
                                       AND VFILIACAO.TIPORELACIONAMENTO = 'M'))
  LEFT JOIN PPESSOA PPESSOAMAE (NOLOCK)
     ON (PPESSOAMAE.CODIGO = VFILIACAOMAE.CODPESSOAFILIACAO)    
  LEFT JOIN FCFO (NOLOCK)
     ON (SALUNO.CODCOLCFO = FCFO.CODCOLIGADA
         AND SALUNO.CODCFO = FCFO.CODCFO)
  LEFT JOIN PPESSOA PPESSOARESPACAD (NOLOCK)
     ON (SALUNO.CODPESSOARACA = PPESSOARESPACAD.CODIGO)
     
  JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)

  JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
              AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
                                 
WHERE SHABILITACAOALUNO.RA = :RA
  AND SHABILITACAOALUNO.CODCOLIGADA = :$CODCOLIGADA
  AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL";;;;;;;0;1;1;1;;;;;e0d420d2-68ac-4dc1-82e4-156b7ddef579;;;19426;mestre;03/02/2021;mestre;03/02/2021;
S;TOTVS020.2.2;MATRICULA - INFO DISCIPLINAS;"SELECT SGRADE.CODGRADE, SGRADE.DESCRICAO MATRIZ, SMATRICPL.CODTURMA,
SMATRICULA.CODSTATUS,
SMATRICULA.IDTURMADISC,
SMATRICULA.DTMATRICULA,
SMATRICULA.NUMCREDITOSCOB,
SMATRICULA.TIPOMAT,
SDISCIPLINA.NOME DISCIPLINA,
SDISCIPLINA.NUMCREDITOS,
SDISCIPLINA.CODTIPOCURSO,
SDISCIPLINA.CODDISC,
CASE WHEN SDISCGRADE.TIPODISC = 'B' THEN 'Obrigatória'
     WHEN SDISCGRADE.TIPODISC = 'O' THEN 'Optativa'
     WHEN SDISCGRADE.TIPODISC = 'E' THEN 'Eletiva'
     ELSE '' END TIPODISCIPLINA,
     
CASE WHEN (SELECT count(0)  
  FROM SDISCGRUPOEQ (NOLOCK)
 WHERE SDISCGRUPOEQ.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
   AND SDISCGRUPOEQ.CODDISC = SDISCIPLINA.CODDISC) > 0 THEN 'Sim'
   ELSE 'Não' END EQUIVALENTE,
   SSTATUS.DESCRICAO DESCSTATUS,
   STIPOMATRICULA.DESCRICAO TIPOMATRICULA
  FROM SMATRICPL 
 INNER JOIN SMATRICULA ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                      AND SMATRICULA.RA = SMATRICPL.RA
                      AND SMATRICULA.IDPERLET = SMATRICPL.IDPERLET
                      AND SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
 INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                      AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
                      AND STURMADISC.CODTURMA = SMATRICPL.CODTURMA
                      AND STURMADISC.IDPERLET = SMATRICPL.IDPERLET                     
 INNER JOIN SDISCIPLINA ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                       AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC                      
 INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                              AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
 INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE   
                  AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO  
JOIN SDISCGRADE (NOLOCK) ON (SDISCGRADE.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA 
                        AND SDISCGRADE.CODDISC = SDISCIPLINA.CODDISC
                        AND SDISCGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
            		    AND SDISCGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
            			AND SDISCGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
            			AND SDISCGRADE.CODDISC = SDISCIPLINA.CODDISC)
 JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                      AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS  
 LEFT OUTER JOIN STIPOMATRICULA (NOLOCK) ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                                        AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT                    
 WHERE SMATRICULA.CODCOLIGADA = :$CODCOLIGADA
   AND SMATRICULA.IDPERLET = :IDPERLET
   AND SMATRICULA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
   AND SMATRICULA.RA = :RA";2974;;;;04/02/2021;mestre;0;1;1;1;;;;;dbc79acf-6196-4d0d-a2d9-e79577f5caf4;;;-13605;mestre;03/02/2021;mestre;04/02/2021;
S;TOTVS021.3.1;HISTORICO ESCOLAR GRADUACAO;"SELECT STURMADISC.CODCOLIGADA, 
                SMATRICULA.IDTURMADISC,
                SETAPAS.CODETAPA, 
                SETAPAS.TIPOETAPA, 
                SETAPAS.MEDIA,
                SETAPAS.DESCRICAO ETAPA, 
                SETAPAS.PONTDIST,
                (CASE WHEN SETAPAS.NOMEREDUZIDO IS NULL
                                 THEN SETAPAS.DESCRICAO
                                 ELSE SETAPAS.NOMEREDUZIDO
                               END) NOMEREDUZIDO,
                STURMADISC.CODDISC, 
                STURMADISC.CODTURMA, 
                SDISCIPLINA.NOME DISCIPLINA, 

                 SSTATUS.DESCRICAO, 
                SNOTAETAPA.NOTAFALTA NOTA, 
                SNOTAETAPA.CODCONCEITO NOTACONCEITUAL,
                SNOTAETAPA.CONCEITOECTS,
                (SELECT RES.DESCRICAO
                 FROM   SSTATUS RES(NOLOCK)
                 WHERE  SMATRICULA.CODCOLIGADA = RES.CODCOLIGADA
                        AND SMATRICULA.CODSTATUSRES = RES.CODSTATUS)  DESCRESULT,
                 SETAPAS.ETAPAFINAL, 
                 STURMADISC.IDTURMADISC, 
                 STURMADISC.IDPERLET, 
                 SMATRICULA.RA, 
                 SNOTAETAPA.NOTAFALTA, 
                 SDISCIPLINA.CH, SDISCIPLINA.NUMCREDITOS, 
                 SMATRICULA.DTMATRICULA,
                 SPROFESSORTURMA.CODPROF,
                 STURMADISC.VALORCREDITO,
                 PPESSOA.NOME NOMEPROFESSOR,
                 STITULACAO.NOME TITULACAO,
                 SMATRICULA.NUMCREDITOSCOB,
                 SDISCIPLINA.NUMCREDITOS,
                 SDISCIPLINA.CH,
                 SPLETIVO.CODPERLET,
                 SPLETIVO.DESCRICAO PERIODOLETIVO
            FROM STURMADISC (NOLOCK)
                 JOIN SDISCIPLINA (NOLOCK)
                    ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND 
                       STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND 
                       STURMADISC.CODTIPOCURSO = SDISCIPLINA.CODTIPOCURSO
                 JOIN GFILIAL (NOlOCK)
                    ON STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
                       STURMADISC.CODFILIAL = GFILIAL.CODFILIAL
                 JOIN SMATRICULA (NOLOCK)
                    ON STURMADISC.CODCOLIGADA  = SMATRICULA.CODCOLIGADA AND 
                       STURMADISC.IDTURMADISC  = SMATRICULA.IDTURMADISC
                 JOIN SSTATUS (NOLOCK)
                    ON SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND 
                       SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS

				JOIN SETAPAS (NOLOCK) 
                    ON STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA AND 
                       STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC
                LEFT JOIN SNOTAETAPA (NOLOCK) 
                    ON (SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
                        SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
                        SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
                        SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
                        SMATRICULA.RA = SNOTAETAPA.RA)
               /* LEFT JOIN SNOTAETAPACOMENTARIO (NOLOCK)
                  ON (SNOTAETAPACOMENTARIO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                      AND SNOTAETAPACOMENTARIO.CODETAPA = SETAPAS.CODETAPA
                      AND SNOTAETAPACOMENTARIO.TIPOETAPA = SETAPAS.TIPOETAPA
                      AND SNOTAETAPACOMENTARIO.IDTURMADISC = SMATRICULA.IDTURMADISC
                      AND SNOTAETAPACOMENTARIO.RA = SMATRICULA.RA) */
                      
                LEFT JOIN SPROFESSORTURMA ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                                         AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
                LEFT JOIN SPROFESSOR ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
                                    AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
                LEFT JOIN PPESSOA ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
                
                LEFT JOIN STITULACAO ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO
                
                INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
                                   AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
                
                WHERE STURMADISC.CODCOLIGADA = 1                        
				  AND SETAPAS.TIPOETAPA = 'N'
                ORDER BY SETAPAS.CODETAPA,
                         STURMADISC.CODDISC, 
                         STURMADISC.CODTURMA,
                         SSTATUS.DIINCALUNODISC DESC,
                         SETAPAS.TIPOETAPA DESC";4717;0;;;04/02/2021;mestre;0;1;1;1;;;;0;89b708c9-9ab6-4a26-a0ce-fb86512a73a8;0;;-26326;mestre;04/02/2021;mestre;04/02/2021;0
S;TOTVSIP.001;RELATÓRIO FORMADOS COM DATA DE COLAÇÃO DE GRAU;"
SELECT DISTINCT SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
 /* SMATRICPL.IDPERLET,
   SPLETIVO.CODPERLET,
 */
 GFILIAL.NOMEFANTASIA AS 'UNIDADE',
 SHABILITACAOFILIAL.CODTIPOCURSO,
  SMATRICPL.RA,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  SCURSO.NOME AS NOMECURSO,
  STURNO.NOME AS NOMETURNO,
  PPESSOA.NOME AS NOMEALUNO,

  STIPOCURSO.APRESENTACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  SHABILITACAOFILIAL.CODCURSO,
  shabilitacaoaluno.dtcolacaograu
FROM SMATRICPL (NOLOCK) JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN GFILIAL (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL)
   JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                         AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                         AND SHABILITACAOALUNO.RA = SMATRICPL.RA
   JOIN SPLETIVO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET)    
   JOIN STIPOCURSO (NOLOCK)
     ON (SPLETIVO.CODCOLIGADA = STIPOCURSO.CODCOLIGADA
         AND SPLETIVO.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA
         AND SMATRICPL.RA = SALUNO.RA)
   JOIN PPESSOA (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOA.CODIGO)         
WHERE SMATRICPL.CODCOLIGADA = :$CODCOLIGADA
  /*AND SHABILITACAOFILIAL.CODFILIAL = :$CODCOLIGADA*/
  AND shabilitacaoaluno.dtcolacaograu BETWEEN :DTCOLAGRAUINI_D AND :DTCOLAGRAUFIN_D
  AND SCURSO.NOME LIKE '%' + :NOMECURSO_S + '%'
  and SHABILITACAOFILIAL.CODTIPOCURSO like :NIVELENSINO_S
  AND GFILIAL.CODFILIAL LIKE '%' + :CAMPUS_S + '%'
/*  AND SSTATUS.DIINCALUNODISC = 'S'
ORDER BY SMATRICPL.CODCOLIGADA,
  SMATRICPL.IDHABILITACAOFILIAL,
  SMATRICPL.IDPERLET,
  PPESSOA.NOME   */
";2762;;;;10/05/2022;consultor1.totvs;0;1;1;1;;;;0;d9173337-66e8-4820-ae5a-4028671892bf;0;;27925;edison.pitoli;02/05/2022;consultor1.totvs;10/05/2022;0
S;TOTVSIP.CAB;CABEÇALHO DO RELATORIO;"SELECT 
	   GCOLIGADA.CODCOLIGADA,
       GCOLIGADA.NOME,
       GCOLIGADA.CGC,
       GCOLIGADA.INSCRICAOESTADUAL,
       GCOLIGADA.TELEFONE,
       GCOLIGADA.EMAIL,
       GCOLIGADA.RUA,
       GCOLIGADA.NUMERO,
       GCOLIGADA.COMPLEMENTO,
       GCOLIGADA.BAIRRO,
       GCOLIGADA.CIDADE,
       GCOLIGADA.ESTADO,
       GCOLIGADA.CEP,
       GIMAGEM.IMAGEM,
       
       CASE GCOLIGADA.CODCOLIGADA
			WHEN '0' THEN 'GLOBAL'
       		WHEN '1' THEN 'UNASP-SP'
       		WHEN '2' THEN 'UNASP-EC'
       		WHEN '3' THEN 'UNASP-HT'
       		WHEN '4' THEN 'UNASP-EAD'
       		WHEN '5' THEN 'UNASP-REITORIA'
        END CAMPUS
       
  FROM GCOLIGADA
 LEFT OUTER JOIN GIMAGEM ON GIMAGEM.ID = GCOLIGADA.IDIMAGEM
 WHERE GCOLIGADA.CODCOLIGADA = :$CODCOLIGADA";784;0;;;24/03/2021;lucas.ssantos;0;1;1;1;;;;0;0c9fbdba-fb58-405c-ba20-1e5c31e80773;0;;-21535;mestre;21/01/2021;lucas.ssantos;24/03/2021;0
S;totvsteste;teste;"SELECT *
FROM SNOTAS
WHERE RA = '055432'
AND IDTURMADISC = 285736";68;;;;18/10/2022;consultor1.totvs;0;1;1;1;;;;0;26f184ae-101b-4d9c-a70b-be4e6789f37b;0;;7103;mestre;02/03/2021;consultor1.totvs;18/10/2022;0
S;TOTVSTESTE1;TESTE;"SELECT *
FROM SMATRICULA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICULA.IDPERLET
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
WHERE RA = '011129'
AND SPLETIVO.CODPERLET = '2021/1'
AND STURMADISC.CODDISC IN (
'G0569.6',
'G4499.5')";378;;;;18/10/2022;consultor1.totvs;0;1;1;1;;;;0;e6a1d7c6-fd2e-49fd-9391-5b1fbdfd725c;0;;15568;edison.pitoli;02/05/2022;consultor1.totvs;18/10/2022;0
S;V_POLOS_INCORRET;Visão com Alunos que estão com polo diferente do Processo Seletivo;"SELECT SPSINSCRICAOAREAOFERTADA.IDPS,
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO,
SALUNO.RA,
PPESSOA.NOME,
CODPOLO CODPOLO_PS, 
A.CODCAMPUS CODPOLO_EDU, 
A.RECCREATEDON, 
A.RECMODIFIEDON
FROM SPSINSCRICAOAREAOFERTADA
		INNER JOIN SPSINSCAREAOFERTACOMPL ON
			SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
			AND SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
			AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO		
		INNER JOIN SHABILITACAOFILIAL ON 
			SPSINSCRICAOAREAOFERTADA.IDHABFILIALMAT = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		INNER JOIN SPSUSUARIO ON 
			SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
		INNER JOIN PPESSOA ON 
			PPESSOA.CPF = SPSUSUARIO.CPF
		INNER JOIN SALUNO ON 
			SALUNO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA 
			AND SALUNO.RA = SPSINSCRICAOAREAOFERTADA.RAMAT
		INNER JOIN SHABILITACAOALUNO A ON 
			A.CODCOLIGADA = SALUNO.CODCOLIGADA 
			AND A.RA = SALUNO.RA 
			AND SPSINSCRICAOAREAOFERTADA.IDHABFILIALMAT = A.IDHABILITACAOFILIAL
WHERE CODPOLO != A.CODCAMPUS
AND SHABILITACAOFILIAL.CODFILIAL = 4
ORDER BY SPSINSCRICAOAREAOFERTADA.IDPS,
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO";1244;;;;20/01/2022;consultor1.totvs;0;1;1;1;;;;0;f702db66-e387-45a6-90a4-3019f4bf1a04;0;;22769;consultor1.totvs;20/01/2022;consultor1.totvs;20/01/2022;0
S;ZSPVOUCHERSALDO;EXECUTA PROCEDURE ATUALIZA VOUCHER;SELECT * FROM GCOLIGADA WHERE CODCOLIGADA = 0;45;;;;04/05/2021;mestre;0;1;1;1;;;;0;c1ddd77f-dd75-4203-b508-8f4f75655e4a;0;;-22830;mestre;04/05/2021;mestre;04/05/2021;0
T;111;FATURA_MOVIMENTO;"SELECT IDMOV, CODCOLIGADA, CODTMV 
FROM TMOV 
WHERE IDMOV = :IDMOV 
AND CODCOLIGADA = :CODCOLIGADA";101;;;;25/02/2021;mestre;0;1;1;1;;;;0;360bf3ca-2bb2-48b4-aa90-b46ab7986e47;;;7383;mestre;25/02/2021;mestre;25/02/2021;
T;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
T;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
T;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
T;FLT001;Livro Fiscal;"SELECT NF.Numeronfse,
       NF.PROTOCOLO,
       L.IDLAN,
       T.IDMOV,
       L.HISTORICO,
       L.VALORORIGINAL,
       L.codfilial,
       L.CODTDO,
       L.MESDECOMPETENCIA,
       TM.STATUS,
       F.NOMEFANTASIA AS 'Responsável',
       F.CGCCFO       AS 'CPF/CNPJ',
		L.VALORDESCONTO,
		I.valor,
		L.VALORORIGINAL - I.valor as 'Valor Líquido'
		
FROM   Flan L (NOLOCK)
       INNER JOIN Flanintegracao I (NOLOCK)
               ON I.IDLAN = L.IDLAN
       INNER JOIN TMOVLAN T (NOLOCK)
               ON T.IDLAN = L.IDLAN
       INNER JOIN TMOV TM (NOLOCK)
               ON TM.idmov = T.idmov
       FULL JOIN TNFEMUNICIPAL NF
              ON NF.IDMOV = TM.IDMOV
       INNER JOIN FCFO F
               ON F.CODCFO = TM.CODCFO
WHERE  L.MESDECOMPETENCIA >= :DataIni_D
       AND L.MESDECOMPETENCIA <= :DataFIm_D
       AND L.CODFILIAL = :CODFILIAL
       AND TM.STATUS = 'F' 
";920;;;;05/09/2022;joel.silvano;0;1;1;1;;;;1;728fd1e0-0e7a-44e0-880b-4bf0b0463425;0;;-26626;joel.silvano;28/08/2022;joel.silvano;05/09/2022;0
T;FLT002;Livro Fiscal 2;"SELECT DISTINCT L.idlan,
                T.IDMOV,
                L.historico,
                NF.protocolo,
                NUMERONFSE                        AS 'Nro Nf',
                L.VALORORIGINAL                   AS 'Valor Nota',
                TM.STATUS,
                G.NOMEFANTASIA                    AS 'Responsável',
                G.CGCCFO                          AS 'CPF/CNPJ',
                L.MESDECOMPETENCIA                AS 'Mês Competência',
                L.valordesconto                   AS 'Desc. Incond',
                L.VALORORIGINAL - L.VALORDESCONTO AS 'Valor Previsto',
                L.CODTDO                          AS 'Tipo Documento'
FROM   FLANINTEGRACAO F (NOLOCK)
       INNER JOIN FLAN L (NOLOCK)
               ON F.IDLAN = L.IDLAN
       INNER JOIN TMOVLAN T (NOLOCK)
               ON T.IDLAN = L.IDLAN
       INNER JOIN TMOV TM (NOLOCK)
               ON TM.idmov = T.idmov
       FULL JOIN TNFEMUNICIPAL NF (NOLOCK)
              ON NF.IDMOV = TM.IDMOV
       INNER JOIN FCFO G (NOLOCK)
               ON G.CODCFO = TM.CODCFO
WHERE  L.MESDECOMPETENCIA BETWEEN :DataIni_D AND :DataFIm_D
       AND L.CODFILIAL = :CODFILIAL
       AND TM.STATUS = 'F'
/*AND f.idlan = '283696'*/
";1260;;;;06/09/2022;joel.silvano;0;1;1;1;;;;1;37d1235f-ca71-4cf1-9236-45aae34e8cca;0;;1405;karilene.silva;28/08/2022;joel.silvano;06/09/2022;0
T;GLOBAIS.002;GLOBAIS.002;"SELECT GCOLIGADA.CODCOLIGADA,
 GCOLIGADA.NOMEFANTASIA,
 GCANALRSS.TITULO AS TITULOCANAL,
 GCANALRSS.DESCRICAO AS DESCRICAOCANAL,
 GCANALRSS.URL AS URLCANAL
 
FROM GCANALRSS
 
 JOIN GCOLIGADA ON
 GCOLIGADA.CODCOLIGADA = GCANALRSS.CODCOLIGADA";;;;;;;0;1;1;1;;;;;;;12.1;-19859;mestre;01/03/2021;mestre;01/03/2021;
T;PLNORC_001;Nome/CNPJ Empresa;"SELECT GCOLIGADA.NOMEFANTASIA || ' (' || CAST(GCOLIGADA.CODCOLIGADA AS VARCHAR(15)) || ')' AS NOMEFANTASIA,
       GCOLIGADA.CGC,
       GCOLIGADA.TELEFONE,
       GCOLIGADA.RUA || ', ' || 
       GCOLIGADA.NUMERO || ' - ' || 
       GCOLIGADA.BAIRRO || ' - ' || 
       GCOLIGADA.CIDADE || '/' || 
       GCOLIGADA.ESTADO || 
       ' (' || GCOLIGADA.CEP || ')' AS ENDERECO,
       GCOLIGADA.EMAIL
FROM GCOLIGADA (NOLOCK)
JOIN TCCOTACAO (NOLOCK)
ON TCCOTACAO.CODCOLIGADA = GCOLIGADA.CODCOLIGADA AND TCCOTACAO.CODFILIAL IS NULL
WHERE CODCOTACAO = :CODCOTACAO_S
UNION ALL
SELECT GFILIAL.NOMEFANTASIA || ' (' || CAST(GFILIAL.CODCOLIGADA AS VARCHAR(15)) || ')' AS NOMEFANTASIA,
       GFILIAL.CGC,
       GFILIAL.TELEFONE,
       GFILIAL.RUA || ', ' || 
       GFILIAL.NUMERO || ' - ' || 
       GFILIAL.BAIRRO || ' - ' || 
       GFILIAL.CIDADE || '/' || 
       GFILIAL.ESTADO || 
       ' (' || GFILIAL.CEP || ')' AS ENDERECO,
       GFILIAL.EMAIL
FROM GFILIAL (NOLOCK)
JOIN TCCOTACAO (NOLOCK)
ON TCCOTACAO.CODCOLIGADA = GFILIAL.CODCOLIGADA AND TCCOTACAO.CODFILIAL = GFILIAL.CODFILIAL
WHERE CODCOTACAO = :CODCOTACAO_S";1145;;;;25/02/2021;mestre;0;1;1;1;;;;0;216c0800-a276-438d-b74e-60fd9736e968;;;-22339;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_002;Dados Cotação;"SELECT DATCOTACAO,
       DATLIMRESPTA,
       TVEN.NOME
FROM   TCCOTACAO (NOLOCK)
       LEFT JOIN TVEN (NOLOCK)
         ON ( TCCOTACAO.CODCOLIGADA = TVEN.CODCOLIGADA
              AND CODCOMPRADOR = CODVEN )
WHERE  CODCOTACAO = :CODCOTACAO_S
       AND TCCOTACAO.CODCOLIGADA = :CODCOLIGADA_N
";304;;;;25/02/2021;mestre;0;1;1;1;;;;0;925678e0-e1e5-4866-920e-a1d7f80a2a3a;;;-10737;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_003;Dados Fornecedor;"SELECT NOMEFANTASIA,
       CGCCFO,
       CONTATO,
       TELEFONE,
       EMAIL
FROM   FCFO (NOLOCK)
WHERE  CODCOLIGADA = :CODCOLCFO_N
       AND CODCFO = :CODCFO_S 
";176;;;;25/02/2021;mestre;0;1;1;1;;;;0;ca04ca80-ded8-4769-96b3-32afdfe740f0;;;-515;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_005;Dados Orçamento;"SELECT CASE
         WHEN TCORCAMENTO.VALTRB < 0 THEN 0
         ELSE TCORCAMENTO.VALTRB
       END                                             AS VALTRB,
       TCORCAMENTO.VALICMSST,
       TCORCAMENTO.CODMOVIMENTOCFO,
       TCORCAMENTO.CODMOEDA || ' | ' || GMOEDA.DESCRICAO AS CODMOEDA,
       TCORCAMENTO.CODCPG || ' | ' || TCPG.NOME          AS CODCPG,
       TCORCAMENTO.VALFRETE,
       TCORCAMENTO.VALORFRETE,
       TCORCAMENTO.FRETECIFOUFOB,
       TCORCAMENTO.CODTRA || ' | ' || TTRA.NOME          AS CODTRA,
       TCORCAMENTO.VALORDESOCRC,
       TCORCAMENTO.PERCDESCORC,
       TCORCAMENTO.VALORDESCNEG,
       TCORCAMENTO.PERCDESCNEG,
       TCORCAMENTO.DESPESA,
       CASE
         WHEN TCORCAMENTO.VALPRAZOVALIDADE < 0 THEN 0
         ELSE TCORCAMENTO.VALPRAZOVALIDADE
       END                                             AS VALPRAZOVALIDADE,
       TCORCAMENTO.VALPRAZOENTREGA
FROM   TCORCAMENTO (NOLOCK)
       LEFT JOIN TCCOTACAO (NOLOCK)
         ON ( TCORCAMENTO.CODCOLIGADA = TCCOTACAO.CODCOLIGADA
              AND TCORCAMENTO.CODCOTACAO = TCCOTACAO.CODCOTACAO )
       LEFT JOIN GMOEDA (NOLOCK)
         ON ( TCORCAMENTO.CODMOEDA = GMOEDA.SIMBOLO )
       LEFT JOIN TCPG (NOLOCK)
         ON ( TCORCAMENTO.CODCPG = TCPG.CODCPG
              AND TCORCAMENTO.CODCOLIGADA = TCPG.CODCOLIGADA )
       LEFT JOIN TTRA (NOLOCK)
         ON ( TCORCAMENTO.CODTRA = TTRA.CODTRA
              AND TCORCAMENTO.CODCOLIGADA = TTRA.CODCOLIGADA )
WHERE  TCORCAMENTO.CODCOTACAO = :CODCOTACAO_S
       AND TCORCAMENTO.CODCOLIGADA = :CODCOLIGADA_N
       AND TCORCAMENTO.CODCFO = :CODCFO_S 
	   AND TCORCAMENTO.CODCOLCFO = :CODCOLCFO_N";1682;;;;25/02/2021;mestre;0;1;1;1;;;;0;7e3b1ace-8252-4f7b-87e3-c55668b1486a;;;26538;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_007;Dados Chave;"SELECT DISTINCT CODCOLIGADA,
                CODCOLCFO,
                CODCFO,
                CODCOTACAO
FROM   TCITMORCAMENTO (NOLOCK)
WHERE  CODCOTACAO = :CODCOTACAO_S
	   AND CODCOLIGADA = :CODCOLIGADA_N
       AND CODCOLCFO = :CODCOLCFO_N
       AND CODCFO = :CODCFO_S 
";285;;;;25/02/2021;mestre;0;1;1;1;;;;0;9311954f-6c6c-46c8-aa59-febe4218038d;;;24159;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_03;Itens Cotação/Negociação;"SELECT TCITMORCAMENTO.IDMOV,
       TCITMORCAMENTO.CODCOLMOV,
       TCITMORCAMENTO.NSEQITMMOV,
       TPRODUTO.CODIGOPRD,
       TPRODUTO.NOMEFANTASIA,
	   CAST(TMARCA.IDMARCA AS VARCHAR(5)) || ' | ' || TMARCA.DESCMARCA AS CODMARCA,
	   CAST(MARCAORC.IDMARCA AS VARCHAR(5)) || ' | ' || MARCAORC.DESCMARCA AS MARCAORC,
	   CAST(MARCANEG.IDMARCA AS VARCHAR(5))  || ' | ' || MARCANEG.DESCMARCA AS MARCANEG,       
       TCITMORCAMENTO.CODUND
        || ' | '
        || TUND.DESCRICAO                                                                                                                                                          AS CODUND,
       TCITMORCAMENTO.CODUNDORC
        || ' | '
        || TUND2.DESCRICAO                                                                                                                                                         AS CODUNDORC,
       TITMMOV.QUANTIDADE,
       TCITMORCAMENTO.QUANTIDADEORC,
       TCITMORCAMENTO.CODCPG
        || ' | '
        || TCPG.NOME                                                                                                                                                               AS CODCPG,
       TCITMORCAMENTO.VALCOTACAO,
       TCITMORCAMENTO.VALTOTCOTACAO,
       TCITMORCAMENTO.CODMOEDA
        || ' | '
        || GMOEDA.DESCRICAO                                                                                                                                                        AS CODMOEDA,
       TCITMORCAMENTO.VALTRB,
       TCITMORCAMENTO.PERCICMSITMORC,
       TCITMORCAMENTO.VALICMSST,
       TCITMORCAMENTO.MARGEMICMSST,
       TCITMORCAMENTO.DESCONTO,
       TCITMORCAMENTO.PERCDESCONTO,
       TCITMORCAMENTO.DESPESA,
       TCITMORCAMENTO.VALORDESPITMORC,
       TCITMORCAMENTO.DATAENTREGA,
       TCITMORCAMENTO.OBSERVACAO,
       TCITMORCAMENTO.CODUNDNEG
        || ' | '
        || TUND3.DESCRICAO                                                                                                                                                         AS CODUNDNEG,
       TCITMORCAMENTO.QUANTIDADENEG,
       TCITMORCAMENTO.CODCPGNEGOCIADA
        || ' | '
        || TCPG.NOME                                                                                                                                                               AS CODCPGNEGOCIADA,
       TCITMORCAMENTO.VALNEGOCIADO,
       TCITMORCAMENTO.VALTOTCOTACAONEG,
       TCITMORCAMENTO.VALORDESPITMNEG,
       TCITMORCAMENTO.PERCDESPITMNEG,
       TCITMORCAMENTO.DESCONTONEGOCIADO,
       TCITMORCAMENTO.PERCDESCONTONEGOCIADO,
       0 INDISPONIVEL,
       TCITMORCAMENTO.IDPRD
FROM   TCITMORCAMENTO (NOLOCK)
       LEFT JOIN TPRODUTO (NOLOCK)
         ON ( TCITMORCAMENTO.IDPRD = TPRODUTO.IDPRD )
       LEFT JOIN TCCOTACAOITMMOV (NOLOCK)
         ON ( TCITMORCAMENTO.CODCOTACAO = TCCOTACAOITMMOV.CODCOTACAO
              AND TCITMORCAMENTO.IDMOV = TCCOTACAOITMMOV.IDMOV
              AND TCITMORCAMENTO.NSEQITMMOV = TCCOTACAOITMMOV.NSEQITMMOV
              AND TCITMORCAMENTO.CODCOLIGADA = TCCOTACAOITMMOV.CODCOLIGADA
              AND TCITMORCAMENTO.CODCOLMOV = TCCOTACAOITMMOV.CODCOLMOV )
       LEFT JOIN TITMMOV (NOLOCK)
         ON ( TCCOTACAOITMMOV.CODCOLMOV = TITMMOV.CODCOLIGADA
              AND TCCOTACAOITMMOV.IDMOV = TITMMOV.IDMOV
              AND TCCOTACAOITMMOV.NSEQITMMOV = TITMMOV.NSEQITMMOV )
       LEFT JOIN TUND (NOLOCK)
         ON ( TCITMORCAMENTO.CODUND = TUND.CODUND )
       LEFT JOIN TUND TUND2 (NOLOCK)
         ON ( TCITMORCAMENTO.CODUNDORC = TUND2.CODUND )
       LEFT JOIN TUND TUND3 (NOLOCK)
         ON ( TCITMORCAMENTO.CODUNDNEG = TUND3.CODUND )
       LEFT JOIN TCPG (NOLOCK)
         ON ( TCITMORCAMENTO.CODCPG = TCPG.CODCPG
              AND TCITMORCAMENTO.CODCOLIGADA = TCPG.CODCOLIGADA )
       LEFT JOIN GMOEDA (NOLOCK)
         ON ( TCITMORCAMENTO.CODMOEDA = GMOEDA.SIMBOLO )
	   LEFT JOIN TMARCA (NOLOCK) 
	     ON	TMARCA.CODCOLIGADA = TITMMOV.CODCOLMARCA AND
			TMARCA.IDMARCA = TITMMOV.IDMARCA
	   LEFT JOIN TMARCA MARCAORC(NOLOCK) 
	     ON MARCAORC.CODCOLIGADA = TCITMORCAMENTO.CODCOLMARCAORC AND
			MARCAORC.IDMARCA = TCITMORCAMENTO.IDMARCAORC
	   LEFT JOIN TMARCA MARCANEG(NOLOCK) 
	     ON MARCANEG.CODCOLIGADA = TCITMORCAMENTO.CODCOLMARCANEG AND
			MARCANEG.IDMARCA = TCITMORCAMENTO.IDMARCANEG         
WHERE  TCITMORCAMENTO.CODCOTACAO = :CODCOTACAO_S
       AND TCITMORCAMENTO.CODCOLCFO = :CODCOLCFO_N
       AND TCITMORCAMENTO.CODCFO = :CODCFO_S
       AND TCITMORCAMENTO.CODCOLIGADA = :CODCOLIGADA_N
       AND STSITEM BETWEEN :STSITEMINI_S AND :STSITEMFIM_S
ORDER  BY TPRODUTO.CODIGOPRD,
          TCITMORCAMENTO.NSEQITMMOV 
";4760;;;;25/02/2021;mestre;0;1;1;1;;;;0;17214168-d938-4a8b-ab43-f1ce0ba19faa;;;32647;mestre;25/02/2021;mestre;25/02/2021;
T;TOTVSTESTE;TESTE;"select tmov.*
FROM TMOV (NOLOCK)
                          INNER JOIN FCFO (NOLOCK) ON (FCFO.CODCOLIGADA = TMOV.CODCOLCFO AND FCFO.CODCFO = TMOV.CODCFO)
                          INNER JOIN GCOLIGADA (NOLOCK) ON GCOLIGADA.CODCOLIGADA = TMOV.CODCOLIGADA
                          INNER JOIN GFILIAL (NOLOCK) ON TMOV.CODCOLIGADA = GFILIAL.CODCOLIGADA AND TMOV.CODFILIAL = GFILIAL.CODFILIAL
                          WHERE TMOV.CODCOLIGADA = 1
                            AND TMOV.IDMOV       = 63528";503;;;;03/05/2022;edison.pitoli;0;1;1;1;;;;0;17c93b84-938c-4c57-9e76-6b11a389d268;0;;-5007;edison.pitoli;02/03/2022;edison.pitoli;03/05/2022;0
U;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
U;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
U;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
V;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
V;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
V;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
V;RhuGrafForaTabS;Gráfico de Funcionários fora da Tabela Salarial;"SELECT 'FORA', COUNT(1)
FROM PFUNC, VTABELASALARIAL
WHERE PFUNC.REGATUAL = 1
AND PFUNC.CODSITUACAO <> 'D'
AND VTABELASALARIAL.CODCOLIGADA = PFUNC.CODCOLIGADA
AND VTABELASALARIAL.CODTABELA = PFUNC.CODTABELASALARIAL
AND VTABELASALARIAL.NIVEL = PFUNC.CODNIVELSAL
AND VTABELASALARIAL.FAIXA = PFUNC.GRUPOSALARIAL
AND VTABELASALARIAL.SALARIO <> PFUNC.SALARIO
AND VTABELASALARIAL.CODCOLIGADA = :CODCOLIGADA
AND VTABELASALARIAL.CODTABELA = :CODTABELA
UNION
SELECT 'DENTRO', COUNT(1)
FROM PFUNC, VTABELASALARIAL
WHERE PFUNC.REGATUAL = 1
AND PFUNC.CODSITUACAO <> 'D'
AND VTABELASALARIAL.CODCOLIGADA = PFUNC.CODCOLIGADA
AND VTABELASALARIAL.CODTABELA = PFUNC.CODTABELASALARIAL
AND VTABELASALARIAL.NIVEL = PFUNC.CODNIVELSAL
AND VTABELASALARIAL.FAIXA = PFUNC.GRUPOSALARIAL
AND VTABELASALARIAL.SALARIO = PFUNC.SALARIO
AND VTABELASALARIAL.CODCOLIGADA = :CODCOLIGADA
AND VTABELASALARIAL.CODTABELA = :CODTABELA";;0;;;;;0;1;1;1;;;;0;;;;24286;RM;30/05/2012;RM;30/05/2012;
V;RhuGrafFuncNivel;Gráfico de Funcionários por Nível;"SELECT N.NOMENIVEL, COUNT(PFUNC.CHAPA) NUM
FROM VNIVELFUNCAO N, PFUNC
WHERE N.CODCOLIGADA = :CODCOLIGADA AND
PFUNC.CODTABELASALARIAL = :CODTABELASALARIAL AND
N.CODCOLIGADA = PFUNC.CODCOLIGADA AND
N.CODNIVEL = PFUNC.CODNIVELSAL AND
PFUNC.CODSITUACAO <> 'D' AND
PFUNC.REGATUAL = 1
GROUP BY N.NOMENIVEL";;0;;;;;0;1;1;1;;;;0;;;;-30049;RM;30/05/2012;RM;30/05/2012;
V;RhuTPAluno;Consulta se a pessoa é um aluno(TOTVS Educacional);"SELECT
		1
	FROM
		PPESSOA(NOLOCK),
		SALUNO(NOLOCK)
	WHERE
			PPESSOA.CODIGO = SALUNO.CODPESSOA
		AND PPESSOA.CODIGO = :CODPESSOA";;0;;;;;0;1;1;1;;;;0;;;;28548;;;;;
V;RhuTPCandidato;Consulta se a pessoa é um candidato;"SELECT
		1
	FROM
		PPESSOA(NOLOCK),
		VCANDIDATOS(NOLOCK)
	WHERE
			PPESSOA.CODIGO = VCANDIDATOS.CODPESSOA
		AND PPESSOA.CODIGO = :CODPESSOA";;0;;;;;0;1;1;1;;;;0;;;;19675;;;;;
V;RhuTPExFunc;Consulta se a pessoa é um ex-funcionário;"SELECT
		1
	FROM
		PPESSOA(NOLOCK),
		PFUNC(NOLOCK)
	WHERE
			PPESSOA.CODIGO = PFUNC.CODPESSOA
		AND PFUNC.CODSITUACAO = 'D'
		AND PPESSOA.CODIGO = :CODPESSOA";;0;;;;;0;1;1;1;;;;0;;;;-17882;;;;;
V;RhuTPFunc;Consulta se a pessoa é um funcionário;"SELECT
		1
	FROM
		PPESSOA(NOLOCK),
		PFUNC(NOLOCK)
	WHERE
			PPESSOA.CODIGO = PFUNC.CODPESSOA
		AND PFUNC.CODSITUACAO <> 'D'
		AND PPESSOA.CODIGO = :CODPESSOA";;0;;;;;0;1;1;1;;;;0;;;;-18408;;;;;
W;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
W;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
W;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
X;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
X;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
X;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
Y;EDUSQL001;Boletim;"SELECT 
  SMATRICULA.RA , 
  PPESSOA.NOME Aluno,	
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC, */
  SDISCIPLINA.NOME AS Disciplina,  
  Av1 = MAX(CASE WHEN SETAPAS.CODETAPA = 1 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av2 = MAX(CASE WHEN SETAPAS.CODETAPA = 2 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av3 = MAX(CASE WHEN SETAPAS.CODETAPA = 3 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  Av4 = MAX(CASE WHEN SETAPAS.CODETAPA = 4 AND SETAPAS.TIPOETAPA = 'N' THEN CONVERT(NUMERIC(10,2), NOTAFALTA) END),
  SSTATUS.DESCRICAO AS Situacao
FROM   
  Saluno,
  ppessoa,
  STURMADISC,
  SDISCIPLINA,
  SSTATUS,
  SMATRICULA 
  LEFT JOIN SETAPAS ON
      SMATRICULA.CODCOLIGADA = SETAPAS.CODCOLIGADA AND
      SMATRICULA.IDTURMADISC = SETAPAS.IDTURMADISC 
  LEFT JOIN SNOTAETAPA ON
      SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA AND
      SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC AND
      SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA AND
      SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA AND
	  SETAPAS.TIPOETAPA = 'N' AND
      SNOTAETAPA.CODCOLIGADA = 1 AND
      SNOTAETAPA.RA = '0000000001'

WHERE 
  SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
  SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC AND
  STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
  STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND
  SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS AND
  SMATRICULA.CODCOLIGADA = 1 AND 
  SMATRICULA.IDPERLET = 1 AND 
  SMATRICULA.IDHABILITACAOFILIAL =27 AND
  SMATRICULA.RA = '0000000001' and
  smatricula.ra=saluno.ra and
  saluno.codpessoa=ppessoa.codigo
GROUP BY
  SMATRICULA.RA, 
	ppessoa.nome,
/*
  STURMADISC.CODTURMA,
  SDISCIPLINA.CODDISC,*/
  SDISCIPLINA.NOME,
  SSTATUS.DESCRICAO
ORDER BY SDISCIPLINA.NOME";1917;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-12426;RM;30/05/2012;RM;30/05/2012;
Y;EDUSQL002;Lista de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo,
  SOCORRENCIATIPO.DESCRICAO Tipo,
  SOCORRENCIAALUNO.DATAOCORRENCIA Data,
  SOCORRENCIAALUNO.OBSERVACOES Obs
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA";718;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;-30602;RM;30/05/2012;RM;30/05/2012;
Y;EDUSQL003;Total de Ocorrências;"SELECT
  SOCORRENCIAGRUPO.DESCRICAO Grupo, COUNT(*) Total  
FROM
  SOCORRENCIAALUNO (NOLOCK),
  SOCORRENCIAGRUPO (NOLOCK),
  SOCORRENCIATIPO (NOLOCK)
WHERE
  SOCORRENCIAALUNO.CODCOLIGADA        = SOCORRENCIATIPO.CODCOLIGADA AND
  SOCORRENCIAALUNO.CODOCORRENCIAGRUPO = SOCORRENCIATIPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODOCORRENCIATIPO  = SOCORRENCIATIPO.CODOCORRENCIATIPO AND
  SOCORRENCIATIPO.CODCOLIGADA        = SOCORRENCIAGRUPO.CODCOLIGADA AND
  SOCORRENCIATIPO.CODOCORRENCIAGRUPO = SOCORRENCIAGRUPO.CODOCORRENCIAGRUPO AND
  SOCORRENCIAALUNO.CODCOLIGADA = :CODCOLIGADA AND
  SOCORRENCIAALUNO.RA = :RA
GROUP BY
  SOCORRENCIAGRUPO.DESCRICAO";663;;;;09/11/2010;mestre;0;1;1;1;;;;0;;;;17341;RM;30/05/2012;RM;30/05/2012;
B;1;SELECT PARA OBTER NÚMERO DE CANDIDATOS POR ÁREA OFERTADA;"SELECT SPSAREAINTERESSE.NOME,
       COUNT(*) CANDIDATOSINSCRITOS
FROM SPSINSCRICAOAREAOFERTADA (NOLOCK),
     SPSOPCAOINSCRITO (NOLOCK),
     SPSAREAOFERTADA (NOLOCK),
     SPSAREAINTERESSE (NOLOCK) 
WHERE SPSINSCRICAOAREAOFERTADA.IDPS = :IDPS
      AND SPSINSCRICAOAREAOFERTADA.STATUS <> 8
      AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
      AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
      AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
      AND SPSINSCRICAOAREAOFERTADA.CODPESSOA = SPSOPCAOINSCRITO.CODPESSOA
      AND SPSOPCAOINSCRITO.NUMEROOPCAO = 1
      AND SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
      AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
      AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
      AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
GROUP BY SPSAREAINTERESSE.IDAREAINTERESSE,
	 SPSAREAINTERESSE.NOME
ORDER BY SPSAREAINTERESSE.NOME";1031;;;;14/05/2021;mestre;1;1;1;1;;;;0;70ebb568-2dc2-44a3-86d0-6c82844199b5;;12.1;-21952;mestre;14/05/2021;mestre;14/05/2021;
B;FILTRO.003;Candidatos com inscrição isenta;"SELECT DISTINCT SPSUSUARIO.NOME FROM FLAN
INNER JOIN SPSINSCRICAOAREAOFERTADA ON SPSINSCRICAOAREAOFERTADA.IDLAN = FLAN.IDLAN AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN = FLAN.CODCOLIGADA
INNER JOIN SPSUSUARIO ON SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
WHERE CODTDO = 'SELETIVO' AND FLAN.VALORORIGINAL = FLAN.VALORDESCONTO AND DATABAIXA =:DATAISENCAO";377;;;;09/08/2021;mestre;1;1;1;1;;;;0;50faf37f-5b2b-4292-9e56-f27728973d98;0;;-10740;mestre;09/08/2021;mestre;09/08/2021;0
B;FILTRO.004;Candidatos por processo;"SELECT
 /*SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO*/
 SPSUSUARIO.NOME
 
FROM
 SPSINSCRICAOAREAOFERTADA (NOLOCK)
 
 INNER JOIN SPSUSUARIO (NOLOCK)		ON SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
 INNER JOIN SPSPROCESSOSELETIVO     ON SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS
 
WHERE	SPSPROCESSOSELETIVO.NOME LIKE '%' + :NomedoProcesso + '%'";385;;;;20/09/2021;lilian.buzetti;1;1;1;1;;;;0;992794ab-f390-4639-b91c-1a7a80038142;0;;-27723;lilian.buzetti;20/09/2021;lilian.buzetti;20/09/2021;0
B;Prova.001;Correção - Redação;"SELECT AB.VALMEMO AS REDAÇÃO
    FROM BHISTORICO 					HIS    
    LEFT JOIN BPROVA 	  	 	  		PRT (NOLOCK) ON 
    PRT.CODCOLIGADA = HIS.CODCOLIGADA   AND 
    PRT.CODPROVA    = HIS.CODPROVA
    
    LEFT JOIN BDEFQUESTAO 	 	  		DEF (NOLOCK) ON 
    PRT.CODCOLIGADA = DEF.CODCOLIGADA AND 
    PRT.CODPROVA    = DEF.CODPROVA   
    
    LEFT JOIN BDEFQUESTAOCONDICIONAL 	COND(NOLOCK) ON 
    COND.CODCOLIGADA = DEF.CODCOLIGADA AND 
    COND.CODPROVA = DEF.CODPROVA AND 
    COND.CODAREA = DEF.CODAREA AND 
    COND.CODMATERIA = DEF.CODMATERIA AND 
    COND.CODQUESTAO = DEF.CODQUESTAO 
    
     
    LEFT JOIN BQUESTAO    	 			QST (NOLOCK) ON 
    QST.CODCOLIGADA = COND.CODCOLIGADA AND 
    QST.CODQUESTAO  = COND.CODQUESTAO  AND 
    QST.CODAREA    = COND.CODAREA AND 
    QST.CODMATERIA = COND.CODMATERIA
    
    LEFT JOIN BHISTRESPPROVA 			RES (NOLOCK) ON 
    RES.CODCOLIGADA = HIS.CODCOLIGADA AND 
    RES.CODPROVA    = HIS.CODPROVA    AND 
    RES.CODQUESTAO = HIS.CODQUESTAO AND 
    RES.CODAREA = HIS.CODAREA AND 
    RES.CODMATERIA = HIS.CODMATERIA AND 
    RES.ID	    = HIS.ID
    
  
    
    LEFT JOIN BMEMO                 	AB  (NOLOCK) ON 
    AB.ID = RES.IDMEMORESPABERTA
  
    WHERE HIS.ID =:ID AND
    HIS.CODCOLIGADA =:CODCOLIGADA AND 
    HIS.CODPROVA =:CODPROVA
	

";1329;;;;14/09/2021;lucas.ssantos;1;1;1;1;;;;0;c8d28ea6-8153-42eb-87a1-0459324cd97a;0;;25821;mestre;23/05/2021;lucas.ssantos;14/09/2021;0
C;0;Consulta que retorna o FIES por aluno e CPF;"SELECT CPARTIDA.CODFILIAL, CPARTIDA.CODLOTE, FLAN.IDLAN, CPARTIDA.DEBITO, CPARTIDA.DATA, CPARTIDA.VALOR, 'FIES ' + FCFO.CGCCFO + ' - ' + FCFO.NOME HISTORICO

FROM CPARTIDA, FLAN, FCFO

WHERE CPARTIDA.INTEGRAAPLICACAO='F'
AND   CPARTIDA.INTEGRACHAVE LIKE 'I%'
AND   CPARTIDA.DEBITO LIKE '1.1.39.005.%'
AND   SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = FLAN.IDLAN
AND   CPARTIDA.CODCOLIGADA = FLAN.CODCOLIGADA
AND   FLAN.CODCOLCFO = FCFO.CODCOLIGADA
AND   FLAN.CODCFO = FCFO.CODCFO
AND   CPARTIDA.DATA>=:DATA_INICIAL_D
AND   CPARTIDA.DATA<=:DATA_FINAL_D

ORDER BY CPARTIDA.CODFILIAL, CPARTIDA.DATA
";607;;;;09/11/2021;carla.ozelo;1;1;1;1;;;;1;521404f9-cc4d-4ca8-acda-fabf9b2a5641;0;;-31457;carla.ozelo;09/11/2021;carla.ozelo;09/11/2021;0
C;1;Filtro tela de Lote que retorna lancamentos de baixa por data e forma pagto;"SELECT P.IDPARTIDA
FROM CPARTIDA P (NOLOCK), FLANBAIXA B (NOLOCK)
WHERE P.CODCOLIGADA = B.CODCOLIGADA
AND   P.INTEGRAAPLICACAO = 'F'
AND   SUBSTRING(P.INTEGRACHAVE,1,1) = 'B'
AND   SUBSTRING(P.INTEGRACHAVE,2,20) = B.IDLAN
AND   P.DATA>=:DATA_INICIAL_D
AND   P.DATA<=:DATA_FINAL_D
AND   P.CODCOLIGADA=1
AND   B.CODCXA=:CODCXA
AND   B.IDFORMAPAGTO=:FORMA_PAGTO
";370;;;;16/11/2021;carla.ozelo;1;1;1;1;;;;0;f2ee7589-5654-4ccc-a168-f35532143d25;0;;26695;carla.ozelo;25/10/2021;carla.ozelo;16/11/2021;0
C;2;Filtro dentro do lote por data de baixa, conta caixa e forma de pagamento;"SELECT CPARTIDA.INTEGRACHAVE
FROM FLAN (NOLOCK)
INNER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='I' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
INNER JOIN FLANBAIXA (NOLOCK) ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND FLAN.IDLAN = FLANBAIXA.IDLAN
WHERE FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN <> 2
AND   FLANBAIXA.STATUS=0
AND   FLANBAIXA.DATABAIXA>=:DATA_INICIAL
AND   FLANBAIXA.DATABAIXA<=:DATA_FINAL
AND   FLANBAIXA.IDFORMAPAGTO=:FORMA_PAGTO
AND   FLANBAIXA.CODCXA=:CONTA_CAIXA";602;;;;16/11/2021;carla.ozelo;1;1;1;1;;;;0;d6dfda8e-b752-46ba-a6af-6cc5b481a955;0;;23799;carla.ozelo;16/11/2021;carla.ozelo;16/11/2021;0
C;3;Filtro tela de Lote que retorna lancamentos de baixa por IDSESSAO;"SELECT P.IDPARTIDA
FROM CPARTIDA P (NOLOCK), FLANBAIXA B (NOLOCK), FXCX (NOLOCK)
WHERE P.CODCOLIGADA = B.CODCOLIGADA
AND   P.INTEGRAAPLICACAO = 'F'
AND   SUBSTRING(P.INTEGRACHAVE,1,1) = 'B'
AND   SUBSTRING(P.INTEGRACHAVE,2,20) = B.IDLAN
AND   B.CODCOLIGADA = FXCX.CODCOLIGADA
AND   B.IDXCX = FXCX.IDXCX
AND   P.CODCOLIGADA=1
AND   FXCX.IDSESSAO=:IDSESSAO
";365;;;;16/11/2021;carla.ozelo;1;1;1;1;;;;0;11647d3a-a30a-4b19-835d-7288137a4302;0;;-10143;carla.ozelo;16/11/2021;carla.ozelo;16/11/2021;0
C;4;Filtro tela de Lote que retorna lancamentos de baixa por conta caixa e data;"SELECT CPARTIDA.INTEGRACHAVE
FROM FLAN (NOLOCK)
INNER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='B' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
INNER JOIN FLANBAIXA (NOLOCK) ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND FLAN.IDLAN = FLANBAIXA.IDLAN
WHERE FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN <> 2
AND   FLANBAIXA.STATUS=0
AND   FLANBAIXA.DATABAIXA>=:DATA_INICIAL
AND   FLANBAIXA.DATABAIXA<=:DATA_FINAL
AND   FLANBAIXA.CODCXA=:CONTA_CAIXA
AND   SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='B'";607;;;;16/12/2021;carla.ozelo;1;1;1;1;;;;0;3088e111-b1eb-416d-aa94-834b439295e8;0;;6393;carla.ozelo;16/11/2021;carla.ozelo;16/12/2021;0
C;004.1;Filtro tela de Lote/Lancamentos que retorna recebim por conta caixa, data, filial, forma das parcelas de acordo;"SELECT CPARTIDA.INTEGRACHAVE
FROM FLAN (NOLOCK)
INNER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='B' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
INNER JOIN FLANBAIXA (NOLOCK) ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND FLAN.IDLAN = FLANBAIXA.IDLAN
WHERE FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.CLASSIFICACAO=15
AND   FLANBAIXA.STATUS=0
AND   FLANBAIXA.DATABAIXA>=:DATA_INICIAL
AND   FLANBAIXA.DATABAIXA<=:DATA_FINAL
AND   FLANBAIXA.CODCXA=:CONTA_CAIXA
AND   FLANBAIXA.IDFORMAPAGTO=:FORMA
AND   FLAN.CODFILIAL=:FILIAL
AND   SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='B'";676;;;;16/12/2021;carla.ozelo;1;1;1;1;;;;0;54ba2f80-3ccb-4a76-b02a-009dace49634;0;;-3720;carla.ozelo;16/12/2021;carla.ozelo;16/12/2021;0
C;1;TESYR;;0;;;;05/10/2022;joel.silvano;1;1;1;1;;;;0;b7c5f30c-a8ca-4307-b743-0851267419b8;0;;5585;joel.silvano;05/10/2022;joel.silvano;05/10/2022;0
C;FLT003;Cadastro de Clientes ;"SELECT DISTINCT ( f.nomefantasia ),
                f.NOME,
                F.CGCCFO
FROM   FCFO F (NOLOCK)
";112;;;;08/09/2022;joel.silvano;1;1;1;1;;;;1;1783d78d-6a73-4dc0-ad1f-9761258872c9;0;;23445;joel.silvano;08/09/2022;joel.silvano;08/09/2022;0
C;PVT.016.6;Relatorio Inadimplencia ligado à FLAN;"SELECT ENTIDADE, CODCONTA,
ISNULL(SUM(SALDO_ANTERIOR), 0.0000) SALDO_ANTERIOR,
ISNULL(SUM(ARECEBER), 0.0000) ARECEBER, 
ISNULL(SUM(RECEBIDOS), 0.0000) RECEBIDOS,  
ISNULL(SUM(SALDO_ATUAL), 0.0000) SALDO_ATUAL
FROM (
		/*################################################################
				VALOR A RECEBER
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, 0.0000 SALDO_ANTERIOR, P.VALOR AS ARECEBER, 0.0000 RECEBIDOS, 0.0000 SALDO_ATUAL
			FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		INNER JOIN FLAN L(NOLOCK) ON (P.CODCOLIGADA = L.CODCOLIGADA AND (P.INTEGRAAPLICACAO<>'F' OR (P.INTEGRAAPLICACAO='F' AND SUBSTRING(P.INTEGRACHAVE,1,1)='I' 
		                                   AND SUBSTRING(P.INTEGRACHAVE,2,10) = CAST(L.IDLAN AS VARCHAR(10)) AND L.MESDECOMPETENCIA>=:DATA_INICIAL_D 
										   AND L.MESDECOMPETENCIA<=:DATA_FINAL_D )))
		
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO >=:CONTA_INICIAL
		AND P.DEBITO <=:CONTA_FINAL
		AND P.DATA >=:DATA_INICIAL_D
		AND P.DATA <=:DATA_FINAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR RECEBIDOS
		################################################################*/
		
		/* Lançamentos a Crédito na conta */
		SELECT 
			 G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, 0.0000 SALDO_ANTERIOR, 0.0000 AS ARECEBER, P.VALOR * -1 RECEBIDOS, 0.0000 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO = C.CODCOLIGADA AND P.CREDITO = C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA = G.CODCOLIGADA AND P.CODFILIAL = G.CODFILIAL)
		INNER JOIN FLAN L(NOLOCK) ON (P.CODCOLIGADA = L.CODCOLIGADA AND (P.INTEGRAAPLICACAO<>'F' OR (P.INTEGRAAPLICACAO='F' AND SUBSTRING(P.INTEGRACHAVE,1,1)='B' 
		                                   AND SUBSTRING(P.INTEGRACHAVE,2,10) = CAST(L.IDLAN AS VARCHAR(10)) AND L.MESDECOMPETENCIA>=:DATA_INICIAL_D 
										   AND L.MESDECOMPETENCIA<=:DATA_FINAL_D )))
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO >=:CONTA_INICIAL
		AND P.CREDITO <=:CONTA_FINAL
		AND P.DATA >=:DATA_INICIAL_D
		AND P.DATA <=:DATA_FINAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL
		/*################################################################
				VALOR SALDO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, 0.0000 SALDO_ANTERIOR, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, P.VALOR SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO >=:CONTA_INICIAL
		AND P.DEBITO <=:CONTA_FINAL
		AND P.DATA <=:DATA_FINAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, 0.0000 SALDO_ANTERIOR, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, P.VALOR * -1 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO >=:CONTA_INICIAL
		AND P.CREDITO <=:CONTA_FINAL
		AND P.DATA <=:DATA_FINAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, P.VALOR SALDO_ANTERIOR, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, 0.0000 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO >=:CONTA_INICIAL
		AND P.DEBITO <=:CONTA_FINAL
		AND P.DATA <:DATA_INICIAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, C.CODCONTA, P.VALOR * -1 SALDO_ANTERIOR, 0.0000 AS ARECEBER, 0.0000 RECEBIDOS, 0.0000 SALDO_ATUAL
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO >=:CONTA_INICIAL
		AND P.CREDITO <=:CONTA_FINAL
		AND P.DATA <:DATA_INICIAL_D
		AND P.CODLOTE >= 0
		AND G.CODFILIAL = :CODFILIAL
	
		
	) AS SALDO
	
	GROUP BY ENTIDADE, CODCONTA
";4995;;;;18/10/2022;carla.ozelo;1;1;1;1;;;;0;ced91caa-6328-47b2-9fe7-79fcd27b1544;0;;-28408;carla.ozelo;18/10/2022;carla.ozelo;18/10/2022;0
C;PVT.018.EC2;RELATÓRIO RECEITA CURSO EXTRA CURRICULARES 2;"SELECT ENTIDADE, ISNULL(SUM(CURSOARTES), 0.0000) CURSOARTES, ISNULL(SUM(CURSOEXTENSAO), 0.0000) CURSOEXTENSAO
FROM (
		/*################################################################
				CURSO ARTES
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS CURSOARTES, 0.0000 CURSOEXTENSAO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.02.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS CURSOARTES, 0.0000 CURSOEXTENSAO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.02.00000000000101'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS CURSOARTES, 0.0000 CURSOEXTENSAO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					       )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.02.00000000000101'

		UNION ALL
		/*################################################################
				CURSOS EXTENSAO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOARTES, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) CURSOEXTENSAO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.86.006.02.00000000000104'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 AS CURSOARTES, (P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) CURSOEXTENSAO
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.86.006.02.00000000000104'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, 0.0000 CURSOARTES, VALOR AS CURSOEXTENSAO
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					       )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.86.006.02.00000000000103'

	) SALDO
	GROUP BY ENTIDADE
";3711;;;;05/10/2022;joel.silvano;1;1;1;1;;;;0;de09d56f-ff30-4751-8cb1-c81f3c1794ed;0;;-4828;joel.silvano;05/10/2022;joel.silvano;05/10/2022;0
C;PVT022;Teste;"SELECT ENTIDADE, ISNULL(SUM(DESCONTOSFINANCEIRO), 0.0000) DESCONTOSFINANCEIRO, ISNULL(SUM(DESCONTOSINCONDICIONAIS), 0.0000) DESCONTOSINCONDICIONAIS, ISNULL(SUM(DESCONTOSCONDICIONAIS), 0.0000) DESCONTOSCONDICIONAIS
FROM (
		/*################################################################
				DESCONTOS FINANCEIRO
		################################################################*/
		/* Lançamentos a Débito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE, (P.VALOR * CASE WHEN C.NATUREZA=1 THEN 1 ELSE -1 END) AS DESCONTOSFINANCEIRO, 0.0000 DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLDEBITO=C.CODCOLIGADA AND P.DEBITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.DEBITO = '3.1.87.518'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos a Crédito na conta */
		SELECT 
			G.NOMEFANTASIA AS ENTIDADE,(P.VALOR * CASE WHEN C.NATUREZA=0 THEN 1 ELSE -1 END) AS DESCONTOSFINANCEIRO, 0.0000 DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CPARTIDA P(NOLOCK)
		JOIN CCONTA C(NOLOCK) ON (P.CODCOLCREDITO=C.CODCOLIGADA AND P.CREDITO=C.CODCONTA)
		JOIN GFILIAL G(NOLOCK) ON (P.CODCOLIGADA=G.CODCOLIGADA AND P.CODFILIAL=G.CODFILIAL)
		WHERE P.CODCOLIGADA = 1
		AND P.CREDITO = '3.1.87.518'
		AND P.DATA <= :Data_D
		AND P.CODLOTE = 0
		AND G.CODFILIAL = :CODFILIAL

		UNION ALL

		/* Lançamentos de Saldo anterior na conta */
		SELECT
			G.NOMEFANTASIA AS ENTIDADE, VALOR AS DESCONTOSFINANCEIRO, 0.0000 DESCONTOSINCONDICIONAIS, 0.0000 DESCONTOSCONDICIONAIS
		FROM CSALDOEXERCICIO S(NOLOCK)
		JOIN GFILIAL G(NOLOCK) ON (S.CODCOLIGADA=G.CODCOLIGADA AND S.CODFILIAL=G.CODFILIAL)
		WHERE IDEXERCICIO = (
                         SELECT MAX(MAXIMO.IDEXERCICIO) FROM CSALDOEXERCICIO MAXIMO (NOLOCK)
                         WHERE S.CODCOLIGADA = MAXIMO.CODCOLIGADA
					        )
		AND S.CODCOLIGADA = 1
		AND S.CODCONTA = '3.1.87.518'

		UNION ALL
		";2073;;;;20/05/2022;joel.silvano;1;1;1;1;;;;0;49eb59c5-4a33-4547-b03d-ad920d0a9890;0;;-25190;joel.silvano;20/05/2022;joel.silvano;20/05/2022;0
D;EXCEL0005;Listagem Lançamentos Fiscais CONFERÊNCIA DIRF - 8045;"SELECT 
    Y.CODRECEITA,
    Y.CODCFO,
    Y.NOME,
    Y.CGCCFO,
    SUM(VR_JAN) AS VR_JAN,
    SUM(VR_TRB_JAN) AS VR_TRB_JAN,
    
    SUM(VR_FEV) AS VR_FEV,
    SUM(VR_TRB_FEV) AS VR_TRB_FEV,
    
    SUM(VR_MAR) AS VR_MAR,
    SUM(VR_TRB_MAR) AS VR_TRB_MAR,
    
    SUM(VR_ABR) AS VR_ABR,
    SUM(VR_TRB_ABR) AS VR_TRB_ABR,
    
    SUM(VR_MAI) AS VR_MAI,
    SUM(VR_TRB_MAI) AS VR_TRB_MAI,
    
    SUM(VR_JUN) AS VR_JUN,
    SUM(VR_TRB_JUN) AS VR_TRB_JUN,
    
    SUM(VR_JUL) AS VR_JUL,
    SUM(VR_TRB_JUL) AS VR_TRB_JUL,
    
    SUM(VR_AGO) AS VR_AGO,
    SUM(VR_TRB_AGO) AS VR_TRB_AGO,
    
    SUM(VR_SET) AS VR_SET,
    SUM(VR_TRB_SET) AS VR_TRB_SET,
    
    SUM(VR_OUT) AS VR_OUT,
    SUM(VR_TRB_OUT) AS VR_TRB_OUT,
    
    SUM(VR_NOV) AS VR_NOV,
    SUM(VR_TRB_NOV) AS VR_TRB_NOV,
    
    SUM(VR_DEZ) AS VR_DEZ,
    SUM(VR_TRB_DEZ) AS VR_TRB_DEZ
    
  FROM
(
SELECT 
    X.CODRECEITA,
    X.CODCFO, 
    X.NOME,
    X.CGCCFO,
    CASE WHEN MES = 1 THEN X.BASE    ELSE 0 END AS VR_JAN,
    CASE WHEN MES = 1 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JAN,
    
    CASE WHEN MES = 2 THEN X.BASE    ELSE 0 END AS VR_FEV,
    CASE WHEN MES = 2 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_FEV,

    CASE WHEN MES = 3 THEN X.BASE    ELSE 0 END AS VR_MAR,
    CASE WHEN MES = 3 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_MAR,

    CASE WHEN MES = 4 THEN X.BASE    ELSE 0 END AS VR_ABR,
    CASE WHEN MES = 4 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_ABR,

    CASE WHEN MES = 5 THEN X.BASE    ELSE 0 END AS VR_MAI,
    CASE WHEN MES = 5 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_MAI,

    CASE WHEN MES = 6 THEN X.BASE    ELSE 0 END AS VR_JUN,
    CASE WHEN MES = 6 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JUN,

    CASE WHEN MES = 7 THEN X.BASE    ELSE 0 END AS VR_JUL,
    CASE WHEN MES = 7 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JUL,

    CASE WHEN MES = 8 THEN X.BASE    ELSE 0 END AS VR_AGO,
    CASE WHEN MES = 8 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_AGO,

    CASE WHEN MES = 9 THEN X.BASE    ELSE 0 END AS VR_SET,
    CASE WHEN MES = 9 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_SET,

    CASE WHEN MES = 10 THEN X.BASE    ELSE 0 END AS VR_OUT,
    CASE WHEN MES = 10 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_OUT,

    CASE WHEN MES = 11 THEN X.BASE    ELSE 0 END AS VR_NOV,
    CASE WHEN MES = 11 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_NOV,

    CASE WHEN MES = 12 THEN X.BASE    ELSE 0 END AS VR_DEZ,
    CASE WHEN MES = 12 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_DEZ

  FROM
(
SELECT 
    DTRBITEM.CODRECEITA,
    DLAF.DATAES,
    MONTH(DLAF.DATAES) AS MES,
    DTRBITEM.BASETRB   AS BASE,
    DTRBITEM.VALORTRB  AS VR_TRB,
    DLAF.CODCFO,
    FCFO.NOME,
    FCFO.CGCCFO
  FROM DLAF, FCFO, DTRBITEM
 WHERE DLAF.CODCOLCFO = FCFO.CODCOLIGADA
   AND DLAF.CODCFO    = FCFO.CODCFO
   AND DLAF.CODCOLIGADA = DTRBITEM.CODCOLIGADA
   AND DLAF.IDLAF       = DTRBITEM.IDLAF
   AND DLAF.DATAES >=:DATA_INICIAL
   AND DLAF.DATAES <=:DATA_FINAL
   AND DLAF.STATUSLF <>'C'
   AND DTRBITEM.CODTRB = 'IRRFPJ'
   AND DTRBITEM.CODRECEITA = '8045'
) X
) Y
GROUP BY Y.CODRECEITA, Y.CODCFO, Y.NOME, Y.CGCCFO
ORDER BY 3";3168;;;;24/02/2021;mestre;1;1;1;1;;;;0;c6ec5fc9-d46a-407c-b3fb-4184a82a7653;;;-2159;mestre;24/02/2021;mestre;24/02/2021;
D;EXCEL0006;Listagem Lançamentos Fiscais CONFERÊNCIA DIRF - 1708;"SELECT 
    Y.CODRECEITA,
    Y.CODCFO,
    Y.NOME,
    Y.CGCCFO,
    SUM(VR_JAN) AS VR_JAN,
    SUM(VR_TRB_JAN) AS VR_TRB_JAN,
    
    SUM(VR_FEV) AS VR_FEV,
    SUM(VR_TRB_FEV) AS VR_TRB_FEV,
    
    SUM(VR_MAR) AS VR_MAR,
    SUM(VR_TRB_MAR) AS VR_TRB_MAR,
    
    SUM(VR_ABR) AS VR_ABR,
    SUM(VR_TRB_ABR) AS VR_TRB_ABR,
    
    SUM(VR_MAI) AS VR_MAI,
    SUM(VR_TRB_MAI) AS VR_TRB_MAI,
    
    SUM(VR_JUN) AS VR_JUN,
    SUM(VR_TRB_JUN) AS VR_TRB_JUN,
    
    SUM(VR_JUL) AS VR_JUL,
    SUM(VR_TRB_JUL) AS VR_TRB_JUL,
    
    SUM(VR_AGO) AS VR_AGO,
    SUM(VR_TRB_AGO) AS VR_TRB_AGO,
    
    SUM(VR_SET) AS VR_SET,
    SUM(VR_TRB_SET) AS VR_TRB_SET,
    
    SUM(VR_OUT) AS VR_OUT,
    SUM(VR_TRB_OUT) AS VR_TRB_OUT,
    
    SUM(VR_NOV) AS VR_NOV,
    SUM(VR_TRB_NOV) AS VR_TRB_NOV,
    
    SUM(VR_DEZ) AS VR_DEZ,
    SUM(VR_TRB_DEZ) AS VR_TRB_DEZ
    
  FROM
(
SELECT 
    X.CODRECEITA,
    X.CODCFO, 
    X.NOME,
    X.CGCCFO,
    CASE WHEN MES = 1 THEN X.BASE    ELSE 0 END AS VR_JAN,
    CASE WHEN MES = 1 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JAN,
    
    CASE WHEN MES = 2 THEN X.BASE    ELSE 0 END AS VR_FEV,
    CASE WHEN MES = 2 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_FEV,

    CASE WHEN MES = 3 THEN X.BASE    ELSE 0 END AS VR_MAR,
    CASE WHEN MES = 3 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_MAR,

    CASE WHEN MES = 4 THEN X.BASE    ELSE 0 END AS VR_ABR,
    CASE WHEN MES = 4 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_ABR,

    CASE WHEN MES = 5 THEN X.BASE    ELSE 0 END AS VR_MAI,
    CASE WHEN MES = 5 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_MAI,

    CASE WHEN MES = 6 THEN X.BASE    ELSE 0 END AS VR_JUN,
    CASE WHEN MES = 6 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JUN,

    CASE WHEN MES = 7 THEN X.BASE    ELSE 0 END AS VR_JUL,
    CASE WHEN MES = 7 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JUL,

    CASE WHEN MES = 8 THEN X.BASE    ELSE 0 END AS VR_AGO,
    CASE WHEN MES = 8 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_AGO,

    CASE WHEN MES = 9 THEN X.BASE    ELSE 0 END AS VR_SET,
    CASE WHEN MES = 9 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_SET,

    CASE WHEN MES = 10 THEN X.BASE    ELSE 0 END AS VR_OUT,
    CASE WHEN MES = 10 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_OUT,

    CASE WHEN MES = 11 THEN X.BASE    ELSE 0 END AS VR_NOV,
    CASE WHEN MES = 11 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_NOV,

    CASE WHEN MES = 12 THEN X.BASE    ELSE 0 END AS VR_DEZ,
    CASE WHEN MES = 12 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_DEZ

  FROM
(
SELECT 
    DTRBITEM.CODRECEITA,
    DLAF.DATAES,
    MONTH(DLAF.DATAES) AS MES,
    DTRBITEM.BASETRB   AS BASE,
    DTRBITEM.VALORTRB  AS VR_TRB,
    DLAF.CODCFO,
    FCFO.NOME,
    FCFO.CGCCFO
  FROM DLAF, FCFO, DTRBITEM
 WHERE DLAF.CODCOLCFO = FCFO.CODCOLIGADA
   AND DLAF.CODCFO    = FCFO.CODCFO
   AND DLAF.CODCOLIGADA = DTRBITEM.CODCOLIGADA
   AND DLAF.IDLAF       = DTRBITEM.IDLAF
   AND DLAF.DATAES >=:DATA_INICIAL
   AND DLAF.DATAES <=:DATA_FINAL
   AND DLAF.STATUSLF <>'C'
   AND DTRBITEM.CODTRB = 'IRRFPJ'
   AND DTRBITEM.CODRECEITA = '1708'
) X
) Y
GROUP BY Y.CODRECEITA, Y.CODCFO, Y.NOME, Y.CGCCFO
ORDER BY 3";3168;;;;24/02/2021;mestre;1;1;1;1;;;;0;64c83515-9c5d-492b-9634-94eda2d270e7;;;17615;mestre;24/02/2021;mestre;24/02/2021;
D;EXCEL0007;Listagem Lançamentos Fiscais CONFERÊNCIA DIRF - 5952;"SELECT 
    Y.CODRECEITA,
    Y.CODCFO,
    Y.NOME,
    Y.CGCCFO,
    SUM(VR_JAN) AS VR_JAN,
    SUM(VR_TRB_JAN) AS VR_TRB_JAN,
    
    SUM(VR_FEV) AS VR_FEV,
    SUM(VR_TRB_FEV) AS VR_TRB_FEV,
    
    SUM(VR_MAR) AS VR_MAR,
    SUM(VR_TRB_MAR) AS VR_TRB_MAR,
    
    SUM(VR_ABR) AS VR_ABR,
    SUM(VR_TRB_ABR) AS VR_TRB_ABR,
    
    SUM(VR_MAI) AS VR_MAI,
    SUM(VR_TRB_MAI) AS VR_TRB_MAI,
    
    SUM(VR_JUN) AS VR_JUN,
    SUM(VR_TRB_JUN) AS VR_TRB_JUN,
    
    SUM(VR_JUL) AS VR_JUL,
    SUM(VR_TRB_JUL) AS VR_TRB_JUL,
    
    SUM(VR_AGO) AS VR_AGO,
    SUM(VR_TRB_AGO) AS VR_TRB_AGO,
    
    SUM(VR_SET) AS VR_SET,
    SUM(VR_TRB_SET) AS VR_TRB_SET,
    
    SUM(VR_OUT) AS VR_OUT,
    SUM(VR_TRB_OUT) AS VR_TRB_OUT,
    
    SUM(VR_NOV) AS VR_NOV,
    SUM(VR_TRB_NOV) AS VR_TRB_NOV,
    
    SUM(VR_DEZ) AS VR_DEZ,
    SUM(VR_TRB_DEZ) AS VR_TRB_DEZ
    
  FROM
(
SELECT 
    X.CODRECEITA,
    X.CODCFO, 
    X.NOME,
    X.CGCCFO,
    CASE WHEN MES = 1 THEN X.BASE    ELSE 0 END AS VR_JAN,
    CASE WHEN MES = 1 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JAN,
    
    CASE WHEN MES = 2 THEN X.BASE    ELSE 0 END AS VR_FEV,
    CASE WHEN MES = 2 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_FEV,

    CASE WHEN MES = 3 THEN X.BASE    ELSE 0 END AS VR_MAR,
    CASE WHEN MES = 3 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_MAR,

    CASE WHEN MES = 4 THEN X.BASE    ELSE 0 END AS VR_ABR,
    CASE WHEN MES = 4 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_ABR,

    CASE WHEN MES = 5 THEN X.BASE    ELSE 0 END AS VR_MAI,
    CASE WHEN MES = 5 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_MAI,

    CASE WHEN MES = 6 THEN X.BASE    ELSE 0 END AS VR_JUN,
    CASE WHEN MES = 6 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JUN,

    CASE WHEN MES = 7 THEN X.BASE    ELSE 0 END AS VR_JUL,
    CASE WHEN MES = 7 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_JUL,

    CASE WHEN MES = 8 THEN X.BASE    ELSE 0 END AS VR_AGO,
    CASE WHEN MES = 8 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_AGO,

    CASE WHEN MES = 9 THEN X.BASE    ELSE 0 END AS VR_SET,
    CASE WHEN MES = 9 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_SET,

    CASE WHEN MES = 10 THEN X.BASE    ELSE 0 END AS VR_OUT,
    CASE WHEN MES = 10 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_OUT,

    CASE WHEN MES = 11 THEN X.BASE    ELSE 0 END AS VR_NOV,
    CASE WHEN MES = 11 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_NOV,

    CASE WHEN MES = 12 THEN X.BASE    ELSE 0 END AS VR_DEZ,
    CASE WHEN MES = 12 THEN X.VR_TRB  ELSE 0 END AS VR_TRB_DEZ

  FROM
(
SELECT 
    DTRBITEM.CODRECEITA,
    DLAF.DATAES,
    MONTH(DLAF.DATAES) AS MES,
    DTRBITEM.BASETRB   AS BASE,
    DTRBITEM.VALORTRB  AS VR_TRB,
    DLAF.CODCFO,
    FCFO.NOME,
    FCFO.CGCCFO
  FROM DLAF, FCFO, DTRBITEM
 WHERE DLAF.CODCOLCFO = FCFO.CODCOLIGADA
   AND DLAF.CODCFO    = FCFO.CODCFO
   AND DLAF.CODCOLIGADA = DTRBITEM.CODCOLIGADA
   AND DLAF.IDLAF       = DTRBITEM.IDLAF
   AND DLAF.DATAES >=:DATA_INICIAL
   AND DLAF.DATAES <=:DATA_FINAL
   AND DLAF.STATUSLF <>'C'
   AND DTRBITEM.CODTRB = 'PCC-RF'
   AND DTRBITEM.CODRECEITA = '5952'
) X
) Y
GROUP BY Y.CODRECEITA, Y.CODCFO, Y.NOME, Y.CGCCFO
ORDER BY 3";3168;;;;24/02/2021;mestre;1;1;1;1;;;;0;fa62302c-9823-4b00-9792-ac6fff93a8b9;;;-19355;mestre;24/02/2021;mestre;24/02/2021;
F;1;Consulta Lançamentos SQL;"SELECT
 flan.idlan
FROM
 FLAN (NOLOCK)
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.IDLAN IN (34482,
35941,
36101,
40942,
70505,
71030,
71578,
71984,
71985,
91916,
104035,
107221,
112871,
126515,
130841,
131374,
132008,
139369,
155895,
165955,
166372,
166431,
169823)
";291;;;;06/10/2022;joel.silvano;1;1;1;1;;;;0;2d6ef026-c8f4-420b-adf8-29b4cd69ba8e;0;;18253;joel.silvano;09/03/2022;joel.silvano;06/10/2022;0
F;1;Filtro na visão de lançamentos por conta caixa + forma de pagamento;"SELECT IDLAN 
FROM   FLANBAIXA (NOLOCK)
WHERE  CODCOLIGADA=1 
AND    IDFORMAPAGTO=:FORMA_PAGTO
AND    CODCXA=:CONTA_CAIXA
AND    DATABAIXA>=:DATA_INICIAL
AND    DATABAIXA<=:DATA_FINAL
AND    STATUS=0";206;;;;04/10/2021;carla.ozelo;1;1;1;1;;;;0;2dba6bd9-e49d-4901-8269-557258020809;0;;24686;mestre;24/06/2021;carla.ozelo;04/10/2021;0
F;001.1;Filtro na visão de lançamentos por conta caixa;"SELECT IDLAN 
FROM   FLANBAIXA (NOLOCK)
WHERE  CODCOLIGADA=1 
AND    CODCXA=:CONTA_CAIXA";91;;;;16/09/2021;carla.ozelo;1;1;1;1;;;;0;e2a5ec8b-f864-4fa0-840a-1839da50c2ec;0;;-12658;carla.ozelo;16/09/2021;carla.ozelo;16/09/2021;0
F;2;Altera o STATUS DOS LANÇAMENTOS A RECEBER para gerar as contabilizações;SELECT * FROM GCOLIGADA (NOLOCK) WHERE CODCOLIGADA=1;52;;;;06/07/2021;mestre;1;1;1;1;;;;1;8464ae5b-3718-47ec-94a9-8d904c42ed3c;0;;-15648;mestre;06/07/2021;carla.ozelo;24/11/2021;0
F;002.1;Recria os rateios por centro de custo por disciplina para gerar as contabilizações;SELECT * FROM GCOLIGADA (NOLOCK) WHERE CODCOLIGADA=1;52;;;;15/02/2022;carla.ozelo;1;1;1;1;;;;1;8464ae5b-3718-47ec-94a9-8d904c42ed3c;0;;-11682;carla.ozelo;15/02/2022;carla.ozelo;15/02/2022;0
F;3;Altera o STATUS CONTABIL do lancamento para CONTABIL;SELECT * FROM GCOLIGADA (NOLOCK) WHERE CODCOLIGADA=1;52;;;;06/07/2021;mestre;1;1;1;1;;;;1;b773f72e-bc2e-45db-ac2e-d813f396084e;0;;-24752;mestre;06/07/2021;mestre;06/07/2021;0
F;4;Filtro na visão de lançamentos, tipo = CONTABIL e não existe APROPR na CPARTIDA;"SELECT FLAN.IDLAN 
FROM FLAN (NOLOCK)
LEFT OUTER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='I' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
WHERE FLAN.CODTDO NOT IN ('SELETIVO','TAX_EXT')
AND   FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN <> 2
AND   CPARTIDA.INTEGRACHAVE IS NULL
AND   FLAN.TIPOCONTABILLAN=1";417;;;;20/10/2021;carla.ozelo;1;1;1;1;;;;0;908b9d29-6d0f-437b-9217-6d7fcdd9157c;0;;-3952;mestre;03/08/2021;carla.ozelo;20/10/2021;0
F;004.1;Filtro na visão de lançamentos, CR BAIXADOS e não existe BAIXA na CPARTIDA;"SELECT FLAN.IDLAN 
FROM FLAN (NOLOCK)
LEFT OUTER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='B' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
WHERE FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN IN (1,4)
AND   CPARTIDA.INTEGRACHAVE IS NULL
AND   FLAN.IDLAN IN (SELECT IDLAN FROM FLANBAIXA WHERE STATUSCONTABIL=1 AND IDLAN = FLAN.IDLAN AND CODCOLIGADA = FLAN.CODCOLIGADA)
";476;;;;09/12/2021;carla.ozelo;1;1;1;1;;;;0;02f362c9-d012-463a-9cd0-b6b4160a968e;0;;-146;carla.ozelo;16/09/2021;carla.ozelo;09/12/2021;0
F;004.2;Filtro na visão de lançamentos TODOS CR não existem na CPARTIDA por Competencia;"SELECT FLAN.IDLAN 
FROM FLAN (NOLOCK)
LEFT OUTER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='I' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
WHERE FLAN.CODTDO NOT IN ('SELETIVO','TAX_EXT','OUTRBAIX','CHQ_DEV')
AND   FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN <> 2
AND   CPARTIDA.INTEGRACHAVE IS NULL
AND   FLAN.MESDECOMPETENCIA >=:DATA_INICIAL
AND   FLAN.MESDECOMPETENCIA <=:DATA_FINAL
AND   FLAN.STATUSLAN<>2
AND   FLAN.CLASSIFICACAO<>15
AND   ((FLAN.PERLETIVO NOT IN ('SIGA','ADEMS','2020.6','2018-2S', '2021', '2021/1', '2021/1M', '2021/2M') AND FLAN.PERLETIVO IS NOT NULL) OR
       FLAN.PERLETIVO IS NULL)";725;;;;14/10/2022;carla.ozelo;1;1;1;1;;;;0;6ef9ffba-809e-4b3a-b4f1-be01cd8a0caa;0;;20501;carla.ozelo;20/10/2021;carla.ozelo;14/10/2022;0
F;004.3;Filtro na visão de lançamentos EXISTEM na CPARTIDA lote ZERO;"SELECT FLAN.IDLAN 
FROM FLAN (NOLOCK)
LEFT OUTER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='I' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
WHERE FLAN.CODTDO NOT IN ('SELETIVO','TAX_EXT')
AND   FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN <> 2
AND   CPARTIDA.INTEGRACHAVE IS NOT NULL
AND   CPARTIDA.CODLOTE='0'
AND   FLAN.TIPOCONTABILLAN=1";449;;;;04/11/2021;carla.ozelo;1;1;1;1;;;;0;6ef9ffba-809e-4b3a-b4f1-be01cd8a0caa;0;;21190;carla.ozelo;04/11/2021;carla.ozelo;04/11/2021;0
F;004.4;Filtro na visão de lançamentos EXISTEM na CPARTIDA <> lote ZERO;"SELECT FLAN.IDLAN 
FROM FLAN (NOLOCK)
LEFT OUTER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='I' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
WHERE FLAN.CODTDO NOT IN ('SELETIVO','TAX_EXT')
AND   FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN <> 2
AND   CPARTIDA.INTEGRACHAVE IS NOT NULL
AND   CPARTIDA.CODLOTE<>'0'
AND   FLAN.TIPOCONTABILLAN=1";450;;;;04/11/2021;carla.ozelo;1;1;1;1;;;;0;6ef9ffba-809e-4b3a-b4f1-be01cd8a0caa;0;;-10483;carla.ozelo;04/11/2021;carla.ozelo;04/11/2021;0
F;004.5;Filtro na visão de BAIXAS existem na CPARTIDA lote ZERO;"SELECT FLAN.IDLAN 
FROM FLAN (NOLOCK)
LEFT OUTER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='B' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
WHERE FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN IN (1,4)
AND   CPARTIDA.INTEGRACHAVE IS NOT NULL
AND   CPARTIDA.CODLOTE='0'

";378;;;;09/12/2021;carla.ozelo;1;1;1;1;;;;0;02f362c9-d012-463a-9cd0-b6b4160a968e;0;;-5795;carla.ozelo;04/11/2021;carla.ozelo;09/12/2021;0
F;004.6;Filtro na visão de BAIXAS existem na CPARTIDA <> lote ZERO;"SELECT FLAN.IDLAN 
FROM FLAN (NOLOCK)
LEFT OUTER JOIN CPARTIDA (NOLOCK) ON CPARTIDA.INTEGRAAPLICACAO='F' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,1,1)='B' AND SUBSTRING(CPARTIDA.INTEGRACHAVE,2,20) = CAST(FLAN.IDLAN AS VARCHAR(20))
WHERE FLAN.CODCOLIGADA=1
AND   FLAN.PAGREC=1
AND   FLAN.STATUSLAN IN (1,4)
AND   CPARTIDA.INTEGRACHAVE IS NOT NULL
AND   CPARTIDA.CODLOTE<>'0'

";379;;;;09/12/2021;carla.ozelo;1;1;1;1;;;;0;02f362c9-d012-463a-9cd0-b6b4160a968e;0;;-8330;carla.ozelo;04/11/2021;carla.ozelo;09/12/2021;0
F;5;Filtro na visão de lançamentos por IDSESSAO;"SELECT IDLAN FROM FLAN WHERE IDLAN IN (
SELECT FLANBAIXA.IDLAN
FROM   FLANBAIXA (NOLOCK), FXCX (NOLOCK)
WHERE  FLANBAIXA.CODCOLIGADA = FXCX.CODCOLIGADA
AND    FLANBAIXA.IDXCX = FXCX.IDXCX
AND    FLANBAIXA.CODCOLIGADA=1 
AND    FXCX.IDSESSAO=:IDSESSAO )
";260;;;;03/08/2021;mestre;1;1;1;1;;;;0;7f6fb34a-b18f-4ad1-aac2-74ffe294310d;0;;-5387;mestre;03/08/2021;mestre;03/08/2021;0
F;6;Consulta SQL em anexo da tela de lancamentos que retorna as bolsas;"SELECT B.CODBOLSA, B.NOME, BL.VALOR 
FROM   SBOLSALAN BL (NOLOCK), SBOLSA B (NOLOCK)
WHERE  BL.CODCOLIGADA = B.CODCOLIGADA
AND    BL.CODBOLSA = B.CODBOLSA
AND    BL.CODCOLIGADA=:CODCOLIGADA
AND    BL.IDLAN=:IDLAN";217;;;;03/08/2021;mestre;1;1;1;1;;;;0;fa922599-2d28-49d3-9df9-2fea5dec63b2;0;;25898;mestre;03/08/2021;mestre;03/08/2021;0
F;7;Filtro na visão de lançamentos por NSU do Cartão;"SELECT IDLAN FROM FLAN WHERE IDLAN IN (
SELECT FLANBAIXA.IDLAN
FROM   FLANBAIXA (NOLOCK), FXCX (NOLOCK)
WHERE  FLANBAIXA.CODCOLIGADA = FXCX.CODCOLIGADA
AND    FLANBAIXA.IDXCX = FXCX.IDXCX
AND    FLANBAIXA.CODCOLIGADA=1 
AND    FXCX.CARTAONSU=:NSU )";254;;;;04/08/2021;mestre;1;1;1;1;;;;0;98941397-4432-43c0-9b23-40021685c532;0;;-23812;mestre;04/08/2021;mestre;04/08/2021;0
F;8;Planilha NET para conferir as contabilizações por Data/Hora e Usuario de Geração;"SELECT P.CODFILIAL, P.DATA, P.CODCCUSTO, CC.NOME, P.DEBITO, D.DESCRICAO, P.CREDITO, C.DESCRICAO, P.VALOR, H.CODHISTP, H.DESCRICAO, 
       P.COMPLEMENTO, P.RECCREATEDON, P.RECCREATEDBY, 
       CASE WHEN P.INTEGRAAPLICACAO='F' THEN 'Financeiro' 
            WHEN P.INTEGRAAPLICACAO='T' THEN 'Compras/Estoque' ELSE '' END ORIGEM,
       P.INTEGRACHAVE ID_ORIGEM
FROM   CHISTP H (NOLOCK), CPARTIDA P (NOLOCK)
LEFT OUTER JOIN CCONTA D (NOLOCK) ON P.CODCOLDEBITO = D.CODCOLIGADA AND P.DEBITO = D.CODCONTA
LEFT OUTER JOIN CCONTA C (NOLOCK) ON P.CODCOLCREDITO = C.CODCOLIGADA AND P.CREDITO = C.CODCONTA
LEFT OUTER JOIN GCCUSTO CC (NOLOCK) ON P.CODCOLIGADA = CC.CODCOLIGADA AND P.CODCCUSTO = CC.CODCCUSTO
WHERE  P.CODCOLIGADA = H.CODCOLIGADA
AND    P.CODHISTP = H.CODHISTP
AND    P.RECCREATEDBY=:USUARIO
AND    P.RECCREATEDON>=:DATA_INICIAL
AND    P.RECCREATEDON<=:DATA_FINAL";881;;;;11/08/2021;mestre;1;1;1;1;;;;0;0f8483f5-152f-4ed0-8878-b274fe661977;0;;-18464;mestre;11/08/2021;mestre;11/08/2021;0
F;008.1;Planilha NET para conferir as contabilizações por Data/Hora e Usuario de Geração - RESUMO;"SELECT P.DEBITO, D.DESCRICAO, P.CREDITO, C.DESCRICAO, SUM(P.VALOR) VALOR

FROM   CHISTP H, CPARTIDA P
LEFT OUTER JOIN CCONTA D (NOLOCK) ON P.CODCOLDEBITO = D.CODCOLIGADA AND P.DEBITO = D.CODCONTA
LEFT OUTER JOIN CCONTA C (NOLOCK) ON P.CODCOLCREDITO = C.CODCOLIGADA AND P.CREDITO = C.CODCONTA
LEFT OUTER JOIN GCCUSTO CC (NOLOCK) ON P.CODCOLIGADA = CC.CODCOLIGADA AND P.CODCCUSTO = CC.CODCCUSTO

WHERE  P.CODCOLIGADA = H.CODCOLIGADA
AND    P.CODHISTP = H.CODHISTP
AND    P.RECCREATEDBY=:USUARIO
AND    P.RECCREATEDON>=:DATA_INICIAL
AND    P.RECCREATEDON<=:DATA_FINAL

GROUP BY P.DEBITO, D.DESCRICAO, P.CREDITO, C.DESCRICAO

ORDER BY 1, 3";650;;;;11/08/2021;mestre;1;1;1;1;;;;0;f32c7d81-e7c5-4fc8-aefe-fcb74662148d;0;;-25154;mestre;11/08/2021;mestre;11/08/2021;0
F;9;Lançamentos que possuem mais de uma bolsa para filtro na tela de lancamentos;"SELECT L.IDLAN
FROM FLAN L, SBOLSALAN BL, SBOLSACONT BC
WHERE L.CODCOLIGADA = BL.CODCOLIGADA
AND   L.IDLAN = BL.IDLAN
AND   BL.CODCOLIGADA = BC.CODCOLIGADA
AND   BL.CODBOLSA = BC.CODBOLSA
AND   BC.TIPO=1

GROUP BY L.IDLAN, BC.CODCONTA, BC.CLASSCONTA

HAVING COUNT(BC.CODCONTA)>1

";292;;;;11/08/2021;mestre;1;1;1;1;;;;0;387415f6-03ed-44c9-aa35-ed28455007c9;0;;26636;mestre;11/08/2021;mestre;11/08/2021;0
F;10;Filtro na visão de baixas de lançamentos por IDSESSAO;"SELECT FLANBAIXA.IDBAIXA
FROM   FLANBAIXA (NOLOCK), FXCX (NOLOCK)
WHERE  FLANBAIXA.CODCOLIGADA = FXCX.CODCOLIGADA
AND    FLANBAIXA.IDXCX = FXCX.IDXCX
AND    FLANBAIXA.CODCOLIGADA=1 
AND    FXCX.IDSESSAO=:IDSESSAO";217;;;;25/08/2021;mestre;1;1;1;1;;;;0;1f12d44c-e52d-4c48-8f4f-a6ba17cc614b;0;;-5705;mestre;25/08/2021;mestre;25/08/2021;0
F;11;"Quantidade de Bolsas ""F"" para Evento Contabil de Apropriação CR";"SELECT COUNT(BC.CLASSCONTA) AS C
FROM   SLAN SL (NOLOCK), FLAN L (NOLOCK), SBOLSALAN B (NOLOCK), SBOLSACONT BC (NOLOCK)
WHERE  L.CODCOLIGADA = SL.CODCOLIGADA
AND    L.IDLAN = SL.IDLAN
AND    SL.CODCOLIGADA = B.CODCOLIGADA
AND    SL.IDPARCELA = B.IDPARCELA
AND    B.IDLAN = L.IDLAN
AND    B.CODCOLIGADA = BC.CODCOLIGADA
AND    B.CODBOLSA = BC.CODBOLSA
AND    L.IDLAN=:FRM_IDLAN
AND    L.CODCOLIGADA=:FRM_COLIGADA
AND    BC.TIPO=1
AND    BC.CLASSCONTA='F'";465;;;;30/08/2021;mestre;1;1;1;1;;;;0;21a832c8-0f2e-43c2-9e5e-ce3dbdfd37f2;0;;25921;mestre;30/08/2021;mestre;30/08/2021;0
F;011.1;"Quantidade de Bolsas ""C"" para Evento Contabil de Apropriação CR";"SELECT COUNT(BC.CLASSCONTA) AS C
FROM   SLAN SL (NOLOCK), FLAN L (NOLOCK), SBOLSALAN B (NOLOCK), SBOLSACONT BC (NOLOCK)
WHERE  L.CODCOLIGADA = SL.CODCOLIGADA
AND    L.IDLAN = SL.IDLAN
AND    SL.CODCOLIGADA = B.CODCOLIGADA
AND    SL.IDPARCELA = B.IDPARCELA
AND    B.IDLAN = L.IDLAN
AND    B.CODCOLIGADA = BC.CODCOLIGADA
AND    B.CODBOLSA = BC.CODBOLSA
AND    L.IDLAN=:FRM_IDLAN
AND    L.CODCOLIGADA=:FRM_COLIGADA
AND    BC.TIPO=1
AND    BC.CLASSCONTA='C'";465;;;;20/04/2022;marli.oliveira;1;1;1;1;;;;0;4cefa79c-a188-4eb4-acfc-aa74a5686978;0;;-23287;mestre;30/08/2021;marli.oliveira;20/04/2022;0
F;011.2;"Quantidade de Bolsas ""RG"" para Evento Contabil de Apropriação CR";"SELECT COUNT(BC.CLASSCONTA) AS C
FROM   SLAN SL (NOLOCK), FLAN L (NOLOCK), SBOLSALAN B (NOLOCK), SBOLSACONT BC (NOLOCK)
WHERE  L.CODCOLIGADA = SL.CODCOLIGADA
AND    L.IDLAN = SL.IDLAN
AND    SL.CODCOLIGADA = B.CODCOLIGADA
AND    SL.IDPARCELA = B.IDPARCELA
AND    B.IDLAN = L.IDLAN
AND    B.CODCOLIGADA = BC.CODCOLIGADA
AND    B.CODBOLSA = BC.CODBOLSA
AND    L.IDLAN=:FRM_IDLAN
AND    L.CODCOLIGADA=:FRM_COLIGADA
AND    BC.TIPO=1
AND    BC.CLASSCONTA='RG'";466;;;;30/08/2021;mestre;1;1;1;1;;;;0;cfa3d419-f2b3-44d6-8864-7065e16a5294;0;;-9652;mestre;30/08/2021;mestre;30/08/2021;0
F;011.3;"Quantidade de Bolsas ""SP"" para Evento Contabil de Apropriação CR";"SELECT COUNT(BC.CLASSCONTA) AS C
FROM   SLAN SL (NOLOCK), FLAN L (NOLOCK), SBOLSALAN B (NOLOCK), SBOLSACONT BC (NOLOCK)
WHERE  L.CODCOLIGADA = SL.CODCOLIGADA
AND    L.IDLAN = SL.IDLAN
AND    SL.CODCOLIGADA = B.CODCOLIGADA
AND    SL.IDPARCELA = B.IDPARCELA
AND    B.IDLAN = L.IDLAN
AND    B.CODCOLIGADA = BC.CODCOLIGADA
AND    B.CODBOLSA = BC.CODBOLSA
AND    L.IDLAN=:FRM_IDLAN
AND    L.CODCOLIGADA=:FRM_COLIGADA
AND    BC.TIPO=1
AND    BC.CLASSCONTA='SP'";466;;;;30/08/2021;mestre;1;1;1;1;;;;0;78ed62fb-a98a-4447-a218-b25153ed6f03;0;;-16241;mestre;30/08/2021;mestre;30/08/2021;0
F;011.4;"Quantidade de Bolsas ""EC"" para Evento Contabil de Apropriação CR";"SELECT Count(BC.CLASSCONTA) AS C
FROM   SLAN SL (NOLOCK),
       FLAN L (NOLOCK),
       SBOLSALAN B (NOLOCK),
       SBOLSACONT BC (NOLOCK)
WHERE  L.CODCOLIGADA = SL.CODCOLIGADA
       AND L.IDLAN = SL.IDLAN
       AND SL.CODCOLIGADA = B.CODCOLIGADA
       AND SL.IDPARCELA = B.IDPARCELA
       AND B.IDLAN = L.IDLAN
       AND B.CODCOLIGADA = BC.CODCOLIGADA
       AND B.CODBOLSA = BC.CODBOLSA
       AND L.IDLAN = :FRM_IDLAN
       AND L.CODCOLIGADA = :FRM_COLIGADA
      /* AND BC.TIPO = 1*/
       AND BC.CLASSCONTA = 'EC' 
";545;;;;19/04/2022;marli.oliveira;1;1;1;1;;;;0;3e5162d6-7a4f-4878-897c-d45f87da2aac;0;;16993;mestre;30/08/2021;marli.oliveira;19/04/2022;0
F;011.5;"Quantidade de Bolsas ""HT"" para Evento Contabil de Apropriação CR";"SELECT COUNT(BC.CLASSCONTA) AS C
FROM   SLAN SL (NOLOCK), FLAN L (NOLOCK), SBOLSALAN B (NOLOCK), SBOLSACONT BC (NOLOCK)
WHERE  L.CODCOLIGADA = SL.CODCOLIGADA
AND    L.IDLAN = SL.IDLAN
AND    SL.CODCOLIGADA = B.CODCOLIGADA
AND    SL.IDPARCELA = B.IDPARCELA
AND    B.IDLAN = L.IDLAN
AND    B.CODCOLIGADA = BC.CODCOLIGADA
AND    B.CODBOLSA = BC.CODBOLSA
AND    L.IDLAN=:FRM_IDLAN
AND    L.CODCOLIGADA=:FRM_COLIGADA
AND    BC.TIPO=1
AND    BC.CLASSCONTA='HT'";466;;;;30/08/2021;mestre;1;1;1;1;;;;0;a085c9f5-e162-4464-83af-f2a9df407daa;0;;17564;mestre;30/08/2021;mestre;30/08/2021;0
F;011.6;"Quantidade de Bolsas ""EAD"" para Evento Contabil de Apropriação CR";"SELECT COUNT(BC.CLASSCONTA) AS C
FROM   SLAN SL (NOLOCK), FLAN L (NOLOCK), SBOLSALAN B (NOLOCK), SBOLSACONT BC (NOLOCK)
WHERE  L.CODCOLIGADA = SL.CODCOLIGADA
AND    L.IDLAN = SL.IDLAN
AND    SL.CODCOLIGADA = B.CODCOLIGADA
AND    SL.IDPARCELA = B.IDPARCELA
AND    B.IDLAN = L.IDLAN
AND    B.CODCOLIGADA = BC.CODCOLIGADA
AND    B.CODBOLSA = BC.CODBOLSA
AND    L.IDLAN=:FRM_IDLAN
AND    L.CODCOLIGADA=:FRM_COLIGADA
AND    BC.TIPO=1
AND    BC.CLASSCONTA='EAD'";467;;;;30/08/2021;mestre;1;1;1;1;;;;0;c2e70836-02ec-4181-b261-086abcb8f535;0;;16752;mestre;30/08/2021;mestre;30/08/2021;0
F;011.7;Consulta que retorna o VALORBAIXA das bolsas condicionais para a formula CTB01.0T;"SELECT  SUM(B.VALORBAIXA) V
FROM    SBOLSALAN B, FLANBAIXAINTEGRACAO I
WHERE   B.CODCOLIGADA = I.CODCOLIGADA
 AND    B.IDLAN = I.IDLAN
 AND    B.CODBOLSA IN ('5','6','7','8','16','19','20','21','25','26','27','28','29','32','36','92','99','102','132','133','135','136','137','165','167','168','172')
 AND    I.IDCAMPO=49
 AND    B.IDLAN=:FRM_IDLAN
 AND    I.VALOR>0
GROUP BY I.VALOR
HAVING  SUM(B.VALORBAIXA) = I.VALOR";427;;;;16/03/2022;marli.oliveira;1;1;1;1;;;;0;ca9ba8d2-13b0-4f63-91a9-f8fa7582cf35;0;;-23272;carla.ozelo;02/12/2021;marli.oliveira;16/03/2022;0
F;12;Consulta SQL em anexo da tela de extrato que retorna o IDSESSAO;"SELECT FXCX.IDSESSAO
FROM   FXCX (NOLOCK)
WHERE  FXCX.IDXCX =:IDXCX
AND    FXCX.CODCOLIGADA=:CODCOLIGADA
";109;;;;29/09/2021;carla.ozelo;1;1;1;1;;;;0;86289ab6-8dea-41db-acb6-7015bce63e49;0;;-22652;carla.ozelo;29/09/2021;carla.ozelo;29/09/2021;0
F;13;Consulta SQL em anexo da tela de lancamentos que retorna a data assin contrato;"SELECT C.DTASSINATURA [DATA ASSINATURA CONTRATO]

FROM STURMA T, SCONTRATO C, SHABILITACAOFILIAL H, SSERVICO S, 
     SPARCELA P, SLAN LS, SMATRICPL M, FLAN L

WHERE C.CODCOLIGADA = H.CODCOLIGADA
AND   C.IDHABILITACAOFILIAL = H.IDHABILITACAOFILIAL
AND   C.CODCOLIGADA = P.CODCOLIGADA
AND   C.RA = P.RA
AND   C.CODCONTRATO = P.CODCONTRATO
AND   C.IDPERLET = P.IDPERLET

AND   M.CODCOLIGADA = H.CODCOLIGADA
AND   M.IDHABILITACAOFILIAL = H.IDHABILITACAOFILIAL
AND   M.CODCOLIGADA = C.CODCOLIGADA
AND   M.IDPERLET = C.IDPERLET
AND   M.IDHABILITACAOFILIAL = C.IDHABILITACAOFILIAL
AND   M.RA = C.RA
AND   M.CODCOLIGADA = T.CODCOLIGADA
AND   M.IDPERLET = T.IDPERLET
AND   M.CODFILIAL = T.CODFILIAL
AND   M.CODTURMA = T.CODTURMA

AND   P.CODCOLIGADA = S.CODCOLIGADA
AND   P.CODSERVICO = S.CODSERVICO
AND   P.CODCOLIGADA = LS.CODCOLIGADA
AND   P.IDPARCELA = LS.IDPARCELA

AND   T.CODCOLIGADA = H.CODCOLIGADA
AND   T.IDHABILITACAOFILIAL = H.IDHABILITACAOFILIAL

AND   LS.CODCOLIGADA = L.CODCOLIGADA
AND   LS.IDLAN = L.IDLAN

AND   L.IDLAN=:IDLAN
AND   L.CODCOLIGADA=:CODCOLIGADA
";1105;;;;30/09/2021;carla.ozelo;1;1;1;1;;;;0;5ea45a97-082c-4e85-8c92-6c66fbe8253d;0;;9027;carla.ozelo;30/09/2021;carla.ozelo;30/09/2021;0
F;14;Filtro na visão de baixas, retorna os lançamentos baixados por acordo com evento incorreto;"SELECT B.IDBAIXA
FROM   FLAN L (NOLOCK), FLANBAIXA B (NOLOCK)
WHERE  L.CODCOLIGADA = B.CODCOLIGADA
AND    L.IDLAN = B.IDLAN
AND    L.STATUSLAN=3
AND    B.CODEVENTOBAIXA<>12
AND    L.CODCOLIGADA=1";201;;;;25/10/2021;carla.ozelo;1;1;1;1;;;;0;b34f9776-80a2-4b2b-bc58-d7a0e938063a;0;;-3334;carla.ozelo;25/10/2021;carla.ozelo;25/10/2021;0
F;014.1;Filtro na visão de baixas, retorna os recebim parcelas de acordo com evento incorreto;"SELECT B.IDBAIXA
FROM   FLAN L (NOLOCK), FLANBAIXA B (NOLOCK)
WHERE  L.CODCOLIGADA = B.CODCOLIGADA
AND    L.IDLAN = B.IDLAN
AND    L.CLASSIFICACAO=15
AND    B.CODEVENTOBAIXA<>18
AND    L.CODCOLIGADA=1";206;;;;16/12/2021;carla.ozelo;1;1;1;1;;;;0;b34f9776-80a2-4b2b-bc58-d7a0e938063a;0;;-3868;carla.ozelo;16/12/2021;carla.ozelo;16/12/2021;0
F;014.2;Filtro na visão de baixas, retorna os recebim parcelas de acordo;"SELECT B.IDBAIXA
FROM   FLAN L (NOLOCK), FLANBAIXA B (NOLOCK)

WHERE  L.CODCOLIGADA = B.CODCOLIGADA
AND    L.IDLAN = B.IDLAN
AND    L.CLASSIFICACAO=15
AND    B.CODEVENTOBAIXA=20
AND    L.CODCOLIGADA=1


AND 	CONVERT (CHAR(10),B.DATABAIXA,103) >= CONVERT(char(10),:DATA_INI_D,103)

AND     CONVERT (CHAR(10),B.DATABAIXA,103)<= CONVERT(char(10),:DATA_FIM_D,103)";371;;;;13/07/2022;joel.silvano;1;1;1;1;;;;0;b34f9776-80a2-4b2b-bc58-d7a0e938063a;0;;12371;joel.silvano;13/07/2022;joel.silvano;13/07/2022;0
F;15;Filtro na visão de baixas, parcelas de acordo baixadas + filial + periodo de baixa;"SELECT L.IDLAN
FROM  FLAN L (NOLOCK), FLANBAIXA B (NOLOCK)
WHERE L.CODCOLIGADA = B.CODCOLIGADA
AND   L.IDLAN = B.IDLAN
AND   L.CLASSIFICACAO=15 
AND   L.CODFILIAL=:FILIAL
AND   B.STATUS=0
AND   B.DATABAIXA>=:DATA_INICIAL_D
AND   B.DATABAIXA<=:DATA_FINAL_D";263;;;;24/11/2021;carla.ozelo;1;1;1;1;;;;0;69e9478b-9ecc-4b3c-ad32-da54e81c2708;0;;5299;carla.ozelo;24/11/2021;carla.ozelo;24/11/2021;0
F;015.1;Filtro na visão de baixas, parcelas baixadas por acordo baixadas + filial + periodo de baixa;"SELECT L.IDLAN
FROM  FLAN L (NOLOCK), FLANBAIXA B (NOLOCK)
WHERE L.CODCOLIGADA = B.CODCOLIGADA
AND   L.IDLAN = B.IDLAN
AND   L.STATUSLAN=3
AND   L.CODFILIAL=:FILIAL
AND   B.STATUS=0
AND   B.DATABAIXA>=:DATA_INICIAL_D
AND   B.DATABAIXA<=:DATA_FINAL_D";257;;;;24/11/2021;carla.ozelo;1;1;1;1;;;;0;69e9478b-9ecc-4b3c-ad32-da54e81c2708;0;;10964;carla.ozelo;24/11/2021;carla.ozelo;24/11/2021;0
F;16;Consulta toda contabilização de uma referencia;"SELECT CONVERT(VARCHAR, RECCREATEDON,103) CRIADO_EM, CONVERT(VARCHAR, RECCREATEDON,114) HORA, RECCREATEDBY CRIADO_POR, DATA, INTEGRACHAVE,  IDLANCAMENTO, IDPARTIDA, CODLOTE, CODLOTEORIGEM, DEBITO, CREDITO, VALOR, CODHISTP, COMPLEMENTO FROM CPARTIDA WHERE INTEGRAAPLICACAO='F' AND SUBSTRING(INTEGRACHAVE,1,1)='B' AND  SUBSTRING(INTEGRACHAVE,2,20)=:REFERENCIA
UNION ALL
SELECT CONVERT(VARCHAR, RECCREATEDON,103) CRIADO_EM, CONVERT(VARCHAR, RECCREATEDON,114) HORA, RECCREATEDBY CRIADO_POR, DATA, INTEGRACHAVE,  IDLANCAMENTO, IDPARTIDA, CODLOTE, CODLOTEORIGEM, DEBITO, CREDITO, VALOR, CODHISTP, COMPLEMENTO FROM CPARTIDA WHERE INTEGRAAPLICACAO='F' AND SUBSTRING(INTEGRACHAVE,1,2)='EB' AND  SUBSTRING(INTEGRACHAVE,3,20)=:REFERENCIA
UNION ALL
SELECT CONVERT(VARCHAR, RECCREATEDON,103) CRIADO_EM, CONVERT(VARCHAR, RECCREATEDON,114) HORA, RECCREATEDBY CRIADO_POR, DATA, INTEGRACHAVE, IDLANCAMENTO, IDPARTIDA, CODLOTE, CODLOTEORIGEM, DEBITO, CREDITO, VALOR, CODHISTP, COMPLEMENTO FROM CPARTIDA WHERE INTEGRAAPLICACAO='F' AND SUBSTRING(INTEGRACHAVE,1,1)='I' AND  SUBSTRING(INTEGRACHAVE,2,20)=:REFERENCIA
UNION ALL
SELECT CONVERT(VARCHAR, RECCREATEDON,103) CRIADO_EM, CONVERT(VARCHAR, RECCREATEDON,114) HORA, RECCREATEDBY CRIADO_POR, DATA, INTEGRACHAVE, IDLANCAMENTO, IDPARTIDA, CODLOTE, CODLOTEORIGEM, DEBITO, CREDITO, VALOR, CODHISTP, COMPLEMENTO FROM CPARTIDA WHERE INTEGRAAPLICACAO='F' AND SUBSTRING(INTEGRACHAVE,1,2)='EI' AND  SUBSTRING(INTEGRACHAVE,3,20)=:REFERENCIA
";1469;;;;24/11/2021;carla.ozelo;1;1;1;1;;;;1;c9e6dd93-7573-4054-ad08-20c9be904674;0;;-20028;carla.ozelo;24/11/2021;carla.ozelo;24/11/2021;0
F;17;Consulta no filtro de lancamentos que retorna vencimentos de filhos de funcionarios;"SELECT BL.IDLAN
FROM   SBOLSALAN BL (NOLOCK), SBOLSA B (NOLOCK), FLAN L (NOLOCK)
WHERE  BL.CODCOLIGADA = B.CODCOLIGADA
AND    BL.CODBOLSA = B.CODBOLSA
AND    L.CODCOLIGADA = BL.CODCOLIGADA
AND    L.IDLAN = BL.IDLAN
AND    (B.NOME LIKE '%DISS%' OR NOME LIKE '%FUNCION%')
AND    L.DATAVENCIMENTO>=:DATA_INICIAL_D
AND    L.DATAVENCIMENTO<=:DATA_FINAL_D
AND    L.CODFILIAL=:FILIAL_I
AND    L.STATUSLAN<>'2'";412;;;;06/12/2021;carla.ozelo;1;1;1;1;;;;0;1d5621c5-c6aa-4f36-8204-4c299c25c479;0;;-8120;carla.ozelo;06/12/2021;carla.ozelo;06/12/2021;0
F;18;Razao Contabil por Filial + Periodo + Conta + Referencia;"SELECT * FROM (
SELECT CODFILIAL, IDLANCAMENTO, IDPARTIDA, DATA,
CASE WHEN SUBSTRING(INTEGRACHAVE,1,1) IN ('B','I') THEN  SUBSTRING(INTEGRACHAVE,2,20)
     WHEN SUBSTRING(INTEGRACHAVE,1,2) IN ('EB','EI') THEN  SUBSTRING(INTEGRACHAVE,3,20) ELSE INTEGRACHAVE END AS REFERENCIA, INTEGRACHAVE,
       DEBITO, CREDITO, VALOR, CODHISTP, COMPLEMENTO FROM CPARTIDA WHERE DEBITO=:CONTA_CONTABIL_S AND CODFILIAL=:FILIAL_I AND DATA>=:DATA_INICIAL_D AND DATA<=:DATA_FINAL_D
UNION ALL
SELECT CODFILIAL, IDLANCAMENTO, IDPARTIDA, DATA,
CASE WHEN SUBSTRING(INTEGRACHAVE,1,1) IN ('B','I') THEN  SUBSTRING(INTEGRACHAVE,2,20)
     WHEN SUBSTRING(INTEGRACHAVE,1,2) IN ('EB','EI') THEN  SUBSTRING(INTEGRACHAVE,3,20) ELSE INTEGRACHAVE END AS REFERENCIA, INTEGRACHAVE,
       DEBITO, CREDITO, VALOR, CODHISTP, COMPLEMENTO FROM CPARTIDA WHERE CREDITO=:CONTA_CONTABIL_S AND CODFILIAL=:FILIAL_I AND DATA>=:DATA_INICIAL_D AND DATA<=:DATA_FINAL_D ) AS X
ORDER BY 5,6";948;;;;06/12/2021;carla.ozelo;1;1;1;1;;;;1;ed34e483-7dad-4ff5-ad1b-6fc777ed58a9;0;;-6847;carla.ozelo;06/12/2021;carla.ozelo;06/12/2021;0
F;19;SINTETICA Bolsas Condicionais nao contabilizadas nas baixas zeradas por Filial + Data de Baixa;"SELECT L.CODFILIAL, YEAR(B.DATABAIXA) ANO, MONTH(B.DATABAIXA) MES, SUM(ROUND(I.VALOR * (R.PERCENTUAL/100),2)) VALOR, R.CODCCUSTO, CC.NOME, R.CODNATFINANCEIRA, O.DESCRICAO, R.PERCENTUAL 
FROM  FLAN L, FLANBAIXA B, FLANBAIXAINTEGRACAO I, FLANBAIXARATCCU R, GCCUSTO CC, TTBORCAMENTO O
WHERE B.CODCOLIGADA = I.CODCOLIGADA
AND   B.IDLAN = I.IDLAN
AND   L.CODCOLIGADA = B.CODCOLIGADA
AND   L.IDLAN = B.IDLAN
AND   R.CODCOLIGADA = B.CODCOLIGADA
AND   R.IDLAN = B.IDLAN
AND   R.IDBAIXA = B.IDBAIXA
AND   R.CODCOLIGADA = CC.CODCOLIGADA
AND   R.CODCCUSTO = CC.CODCCUSTO
AND   R.CODCOLNATFINANCEIRA = O.CODCOLIGADA
AND   R.CODNATFINANCEIRA = O.CODTBORCAMENTO
AND   B.STATUS=0
AND   B.DATABAIXA>=:DATA_INICIAL_D
AND   B.DATABAIXA<=:DATA_FINAL_D
AND   I.IDCAMPO=49
AND   I.VALOR>0
AND   B.VALORBAIXA=0
AND   L.CODFILIAL=:FILIAL
GROUP BY L.CODFILIAL, YEAR(B.DATABAIXA), MONTH(B.DATABAIXA), R.CODCCUSTO, CC.NOME, R.CODNATFINANCEIRA, O.DESCRICAO, R.PERCENTUAL 
ORDER BY 1,2,3,5";982;;;;06/12/2021;carla.ozelo;1;1;1;1;;;;1;19bc9049-201d-45cd-a88b-b4acc52a0d80;0;;7436;carla.ozelo;06/12/2021;jennifer.andrade;06/12/2021;0
F;019.1;ANALITICA Bolsas Condicionais nao contabilizadas nas baixas zeradas por Filial + Data de Baixa;"SELECT L.CODFILIAL, B.IDLAN, B.DATABAIXA, ROUND(I.VALOR * (R.PERCENTUAL/100),2) VALOR, R.CODCCUSTO, CC.NOME, R.CODNATFINANCEIRA, O.DESCRICAO, R.PERCENTUAL 
FROM  FLAN L, FLANBAIXA B, FLANBAIXAINTEGRACAO I, FLANBAIXARATCCU R, GCCUSTO CC, TTBORCAMENTO O
WHERE B.CODCOLIGADA = I.CODCOLIGADA
AND   B.IDLAN = I.IDLAN
AND   L.CODCOLIGADA = B.CODCOLIGADA
AND   L.IDLAN = B.IDLAN
AND   R.CODCOLIGADA = B.CODCOLIGADA
AND   R.IDLAN = B.IDLAN
AND   R.IDBAIXA = B.IDBAIXA
AND   R.CODCOLIGADA = CC.CODCOLIGADA
AND   R.CODCCUSTO = CC.CODCCUSTO
AND   R.CODCOLNATFINANCEIRA = O.CODCOLIGADA
AND   R.CODNATFINANCEIRA = O.CODTBORCAMENTO
AND   B.STATUS=0
AND   B.DATABAIXA>=:DATA_INICIAL_D
AND   B.DATABAIXA<=:DATA_FINAL_D
AND   I.IDCAMPO=49
AND   I.VALOR>0
AND   B.VALORBAIXA=0
AND   L.CODFILIAL=:FILIAL
ORDER BY 1,2,3,5
";823;;;;06/12/2021;carla.ozelo;1;1;1;1;;;;1;19bc9049-201d-45cd-a88b-b4acc52a0d80;0;;-4176;carla.ozelo;06/12/2021;jennifer.andrade;06/12/2021;0
F;20;Planilha NET para conferir os lancamentos com desconto de funcionarios - Jocelino;"SELECT BL.IDLAN REF, L.CODFILIAL FILIAL, B.CODBOLSA [COD BOLSA], B.NOME [NOME BOLSA] , BL.VALOR [VALOR BOLSA], L.DATAVENCIMENTO VENCIMENTO, 
       L.HISTORICO, T.DESCRICAO PARENTESCO, R.CODCFO COD_RESPONS, 
       R.NOME NOME_RESPONS, R.RUA, R.NUMERO, R.CIDADE, R.CODETD UF, R.CGCCFO CPF

FROM   SBOLSALAN BL (NOLOCK), SBOLSA B (NOLOCK), FLAN L (NOLOCK), SLAN A (NOLOCK),
       SPARCELA P (NOLOCK), SALUNO AL (NOLOCK)
LEFT OUTER JOIN FCFO R (NOLOCK) ON AL.CODCOLCFO = R.CODCOLIGADA AND AL.CODCFO = R.CODCFO
LEFT OUTER JOIN SMISIPARENTESCO T (NOLOCK) ON T.CODIGO = AL.CODPARENTCFO

WHERE  BL.CODCOLIGADA = B.CODCOLIGADA
AND    BL.CODBOLSA = B.CODBOLSA
AND    L.CODCOLIGADA = BL.CODCOLIGADA
AND    L.IDLAN = BL.IDLAN
AND    L.CODCOLIGADA = A.CODCOLIGADA
AND    L.IDLAN = A.IDLAN
AND    P.CODCOLIGADA = A.CODCOLIGADA
AND    P.IDPARCELA = A.IDPARCELA
AND    P.CODCOLIGADA = AL.CODCOLIGADA
AND    P.RA = AL.RA
AND    (B.NOME LIKE '%DISS%' OR B.NOME LIKE '%FUNCION%')
AND    L.DATAVENCIMENTO>=:VECTO_INICIAL
AND    L.DATAVENCIMENTO<=:VECTO_FINAL
AND    L.CODFILIAL=:FILIAL
AND    L.STATUSLAN<>'2'
";1117;;;;16/12/2021;carla.ozelo;1;1;1;1;;;;0;1e5bc96d-3987-4719-9bb4-1c45d4c78bf0;0;;17158;carla.ozelo;16/12/2021;carla.ozelo;16/12/2021;0
F;21;Filtro na visão de lançamentos por IDSESSAO;"SELECT IDLAN FROM FLAN WHERE IDLAN IN (
SELECT FLANBAIXA.IDLAN
FROM   FLANBAIXA (NOLOCK), FXCX (NOLOCK)
WHERE  FLANBAIXA.CODCOLIGADA = FXCX.CODCOLIGADA
AND    FLANBAIXA.IDXCX = FXCX.IDXCX
AND    FLANBAIXA.CODCOLIGADA=1 
AND    FXCX.IDSESSAO=:IDSESSAO 
AND    Flanbaixa.IDFORMAPAGTO=:FORMA_PAGTO)

";306;;;;28/02/2022;joel.silvano;1;1;1;1;;;;0;7f6fb34a-b18f-4ad1-aac2-74ffe294310d;0;;11053;joel.silvano;28/02/2022;joel.silvano;28/02/2022;0
F;22;;"SELECT FLAN.IDLAN 
FROM FLANBAIXA (NOLOCK)

WHERE  FLAN.CODCOLIGADA = 1
       AND CPARTIDA.CODLOTE = 0
       AND CPARTIDA.DATA >= '2022-01-01'
       AND CPARTIDA.DATA BETWEEN :DataIni_D AND :DataFIm_D
       AND FLAN.STATUSLAN <> 2 


";248;;;;15/03/2022;joel.silvano;1;1;1;1;;;;0;f459b422-bd9b-43af-8896-28a451f27587;0;;16932;joel.silvano;15/03/2022;joel.silvano;15/03/2022;0
F;23;Altera Status do Histórico do Cartão de Crédito;SELECT * FROM GCOLIGADA (NOLOCK) WHERE CODCOLIGADA=1;52;;;;14/09/2022;robson.canto;1;1;1;1;;;;0;f401cf74-21bb-4a13-bfc9-aa97bb7eee0c;0;;-15150;robson.canto;14/09/2022;robson.canto;14/09/2022;0
F;Assinaturas;Assinaturas por filial;"SELECT 
   
   	
	(SELECT IMAGEM FROM GIMAGEM WHERE ID = 
		CASE FL.CODFILIAL
			WHEN 1 THEN 21
			WHEN 2 THEN 17
			WHEN 3 THEN 19
			WHEN 4 THEN 24
				END)		AS AssDIRETOR,
	
	(SELECT IMAGEM FROM GIMAGEM WHERE ID = 
		CASE FL.CODFILIAL
			WHEN 1 THEN 22
			WHEN 2 THEN 18
			WHEN 3 THEN 0	/* padrão 20 - retirado pra ficar só uma assinatura pro Extensão de HT */
			WHEN 4 THEN 23
				END)		AS AssTESTEMUNHA



FROM    GFILIAL FL
		   

WHERE	FL.CODFILIAL =:CODFILIAL1
";496;;;;24/08/2021;mestre;1;1;1;1;;;;0;8ea01369-0a73-4c13-9490-27e80ca31e22;0;;22938;mestre;24/08/2021;mestre;24/08/2021;0
F;DadosBoleto;Dados Boleto Em Aberto;"select flan.historico,
       flan.idboleto,
	   flan.idlan,
	   fintegracaocartao.nsu,
	   fintegracaocartao.valorpago,
	   fintegracaocartao.datahora
  from fintegracaocartao (nolock)
 inner join fboleto (nolock) on fintegracaocartao.codcoligada = fboleto.codcoligada and fintegracaocartao.idboleto = fboleto.idboleto
 inner join flan (nolock) on fboleto.codcoligada = flan.codcoligada and fboleto.idboleto = flan.idboleto
 where flan.statuslan = 0
   and fintegracaocartao.idstatus = 6";498;;;;21/12/2021;raphael.muzy;1;1;1;1;;;;0;c1908c98-23b8-4846-ab48-7b0159f6222e;0;;-15901;raphael.muzy;21/12/2021;raphael.muzy;21/12/2021;0
F;DadosCartão;Dados Cartão de Crédito;select * from dbo.fn_dadostransacao(:ID);40;;;;27/10/2021;raphael.muzy;1;1;1;1;;;;0;8bd9a7da-9de2-4fec-9026-250905bb7373;0;;-32510;lilian.buzetti;20/10/2021;raphael.muzy;27/10/2021;0
F;F10;Filtro na Forma de Pagamentos;"SELECT IDLAN 
FROM   FLANBAIXA (NOLOCK)
WHERE  CODCOLIGADA=1 
AND    IDFORMAPAGTO=:FORMA_PAGTO
";99;;;;19/08/2021;joel.silvano;1;1;1;1;;;;0;0fbdb20b-661a-4560-b8db-cdcee53006c3;0;;-32477;joel.silvano;19/08/2021;joel.silvano;19/08/2021;0
F;FFG;FIES - FUNDO GARANTIDO DO ALUNO;"SELECT SHABILITACAOALUNOCOMPL.FFG FROM FLAN
INNER JOIN SLAN ON SLAN.IDLAN = FLAN.IDLAN AND SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
INNER JOIN SHABILITACAOALUNO ON SCONTRATO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND SCONTRATO.RA = SHABILITACAOALUNO.RA AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOALUNOCOMPL ON SHABILITACAOALUNOCOMPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND SHABILITACAOALUNOCOMPL.RA = SHABILITACAOALUNO.RA
WHERE FLAN.IDLAN =:FRM_IDLAN
AND   FLAN.CODCOLIGADA =:FRM_COLIGADA";939;;;;06/09/2021;lilian.buzetti;1;1;1;1;;;;0;1b1c1909-7dbc-44bf-8f3a-6d91073058fd;0;;-8146;lilian.buzetti;06/09/2021;lilian.buzetti;06/09/2021;0
F;Filtro,011;Consulta Lançamentos SQL;"SELECT
 flan.idlan
FROM
 FLAN (NOLOCK)
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.IDLAN IN (316558,
316559,
316560,
316561,
316563,
73904,
266624,
183452,
209904,
212760,
316564,
316565,
316566,
317085,
212853,
227744,
228398,
264036,
269343,
286163,
296691,
296786,
296797,
296798,
296911,
306761,
316181,
316183,
316188,
316547,
316557,
316562,
316999,
317193)";397;;;;20/10/2022;joao.nicaretta;1;1;1;1;;;;0;2d6ef026-c8f4-420b-adf8-29b4cd69ba8e;0;;11831;robson.canto;11/01/2022;joao.nicaretta;20/10/2022;0
F;Filtro.001;Filtro por bolsa 158,160;"SELECT FLAN.IDLAN FROM FLAN (nolock)

INNER JOIN SLAN (nolock) ON 
SLAN.IDLAN = FLAN.IDLAN AND 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA

INNER JOIN SPARCELA (nolock) ON 
SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
SPARCELA.IDPARCELA = SLAN.IDPARCELA

INNER JOIN SCONTRATO (nolock) ON 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

INNER JOIN SBOLSAALUNO (nolock) ON 
SCONTRATO.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
SCONTRATO.RA = SBOLSAALUNO.RA AND 
SCONTRATO.CODCONTRATO = SBOLSAALUNO.CODCONTRATO AND 
SCONTRATO.IDPERLET = SBOLSAALUNO.IDPERLET AND 
SPARCELA.CODSERVICO = SBOLSAALUNO.CODSERVICO

WHERE CODBOLSA IN (158,160)
";775;;;;29/06/2021;mestre;1;1;1;1;;;;0;20e555c3-783b-4cd3-b105-a148d93971b8;0;;-7294;mestre;29/06/2021;mestre;29/06/2021;0
F;Filtro.002;PROBLEMAS- Analisando;"/*SELECT 
FLAN.IDLAN

FLANBOLETO.IDBOLETO , FLANBOLETOBAIXA.IDBOLETO , FLAN.CODTDO , FLANBAIXA.USUARIO , FLANBAIXA.IDBAIXA


FROM FLANBAIXA
LEFT JOIN FLANBOLETOBAIXA ON FLANBOLETOBAIXA.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND FLANBOLETOBAIXA.IDLAN = FLANBAIXA.IDLAN AND FLANBOLETOBAIXA.IDBAIXA = FLANBAIXA.IDBAIXA
LEFT JOIN FLANBOLETO ON FLANBOLETO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND  FLANBOLETO.IDLAN = FLANBAIXA.IDLAN
LEFT JOIN FLAN ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND  FLANBOLETO.IDLAN = FLAN.IDLAN
LEFT JOIN FBOLETO ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
WHERE FLANBOLETOBAIXA.IDBOLETO IS NULL AND flanbaixa.STATUS = 0
AND FLAN.IDLAN IS NOT NULL AND FBOLETO.STATUS = '1'


*/

SELECT * FROM FLANBAIXA WHERE IDLAN = 6226";809;;;;17/08/2021;mestre;1;1;1;1;;;;0;8e12b93b-a62f-4d82-a82f-209e25ff2e78;0;;24007;mestre;17/08/2021;mestre;17/08/2021;0
F;Filtro.003;Lançamentos financeiros pelo status do aluno na matrícula;"SELECT FLAN.IDLAN FROM FLAN
INNER JOIN SLAN ON SLAN.IDLAN = FLAN.IDLAN AND SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SCONTRATO.RA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
WHERE SPLETIVO.CODPERLET =:PERIODOLETIVO
AND   SSTATUS.DESCRICAO LIKE '%' + :STATUSMATRICULA + '%'
AND   SPLETIVO.CODFILIAL = :CODFILIAL
AND   SPLETIVO.CODTIPOCURSO = :CODTIPOCURSO";1029;;;;09/09/2021;gillead.goncalves;1;1;1;1;;;;0;b3986582-f6b9-4cf1-a5a8-ec011ef02f1d;0;;-21456;lilian.buzetti;06/09/2021;gillead.goncalves;09/09/2021;0
F;Filtro.004;Status do aluno na matrícula do periodo letivo;"SELECT FBOLETO.IDBOLETO FROM FLAN
INNER JOIN SLAN ON SLAN.IDLAN = FLAN.IDLAN AND SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SCONTRATO.RA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN FLANBOLETO ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN FBOLETO ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
WHERE SPLETIVO.CODPERLET =:PERIODOLETIVO
AND   SSTATUS.DESCRICAO LIKE '%' + :STATUSMATRICULA + '%'";1164;;;;06/09/2021;lilian.buzetti;1;1;1;1;;;;0;8732eced-138d-4252-9b90-92ff257b37d6;0;;-2924;lilian.buzetti;06/09/2021;lilian.buzetti;06/09/2021;0
F;Filtro.005;Taxa de Formatura;"SELECT
 FLANRATCCU.IDLAN
 
FROM
 FLANRATCCU (NOLOCK)
 
WHERE	FLANRATCCU.CODNATFINANCEIRA = '1.1.01.011' /*TAXA DE FORMATURA*/";131;;;;03/11/2021;robson.canto;1;1;1;1;;;;0;b3732e54-f458-4cbd-896a-3b1139a5a5a4;0;;-29002;robson.canto;03/11/2021;robson.canto;03/11/2021;0
F;Filtro.006;Lançamentos com valor de Multa Incorretos;"/*
SELECT 
 FLAN.IDLAN
 
FROM 
 FLAN 
 
 INNER JOIN FBOLETO ON FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 					   FBOLETO.IDBOLETO = FLAN.IDBOLETO
 
WHERE 	FLAN.CODCOLIGADA = 1
	AND FLAN.VALORMULTA > 0 
	AND FLAN.STATUSLAN = 0
*/
SELECT 
 FLAN.IDLAN
 
FROM 
 FLAN 
 
 LEFT JOIN FBOLETO ON FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 					   FBOLETO.IDBOLETO = FLAN.IDBOLETO
 
WHERE 	FLAN.CODCOLIGADA = 1
	AND FLAN.IDLAN IN (99014,99017,99018,99024,99029,99030,99034,99036,99037,99038,99039,99040,99041,99042,99043,99044,99178,100969,
100990,100991,98967,100970,98975,99095,99097,99098,99101,99102,99103,101029,101003,101014,101016,101017,101018,
101084)
";682;;;;09/11/2021;robson.canto;1;1;1;1;;;;0;ae304839-6dbc-4a68-895a-e7f08cb3c46a;0;;114;robson.canto;08/11/2021;robson.canto;09/11/2021;0
F;Filtro.007;Recorrência - Lançamento;"SELECT DISTINCT
 FLAN.IDLAN
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SALUNO (NOLOCK)						ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SALUNO.RA = SCONTRATO.RA 
 												   
 INNER JOIN PPESSOA (NOLOCK)					ON PPESSOA.CODIGO = SALUNO.CODPESSOA 												   
 
 INNER JOIN SRECORRENCIACARTAO (NOLOCK)			ON SRECORRENCIACARTAO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 												   SRECORRENCIACARTAO.RA = SCONTRATO.RA AND
 												   SRECORRENCIACARTAO.CODCONTRATO = SCONTRATO.CODCONTRATO AND
 												   SRECORRENCIACARTAO.IDPERLET = SRECORRENCIACARTAO.IDPERLET
 
 INNER JOIN FRECORRENCIACARTAO (NOLOCK)			ON FRECORRENCIACARTAO.CODCOLIGADA = SRECORRENCIACARTAO.CODCOLIGADA AND 
 												   FRECORRENCIACARTAO.IDRECORRENCIA = SRECORRENCIACARTAO.IDRECORRENCIA
 
 INNER JOIN SPLETIVO (NOLOCK)					ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 
 INNER JOIN SPARCELA (NOLOCK)					ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SPARCELA.RA = SCONTRATO.RA AND 
 												   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 												   SPARCELA.IDPERLET = SCONTRATO.IDPERLET
												   
 LEFT JOIN SLAN (NOLOCK)						ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 												   SLAN.IDPARCELA = SPARCELA.IDPARCELA 												   
 
 LEFT JOIN FLAN (NOLOCK)						ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 												   FLAN.IDLAN = SLAN.IDLAN

 LEFT JOIN FINTEGRACAOTRANSACAO (NOLOCK)		ON FINTEGRACAOTRANSACAO.CODCOLIGADA = FRECORRENCIACARTAO.CODCOLIGADA AND 
 												   FINTEGRACAOTRANSACAO.IDRECORRENCIA = FRECORRENCIACARTAO.IDRECORRENCIA

WHERE 	SCONTRATO.CODCOLIGADA = :$CODCOLIGADA
	AND SPLETIVO.CODPERLET LIKE '2021%'
 	AND FLAN.DATAVENCIMENTO >= :Data_Início
 	AND FLAN.DATAVENCIMENTO <= :Data_Fim
 	AND FLAN.STATUSLAN IN (0,4)
";1915;;;;15/12/2021;robson.canto;1;1;1;1;;;;0;ab7235ef-78a5-4c4b-9474-277b2091c0f2;0;;27339;robson.canto;15/12/2021;robson.canto;15/12/2021;0
F;Filtro.008;Recorrência - Boleto;"SELECT DISTINCT
 FLAN.IDBOLETO
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SALUNO (NOLOCK)						ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SALUNO.RA = SCONTRATO.RA 
 												   
 INNER JOIN PPESSOA (NOLOCK)					ON PPESSOA.CODIGO = SALUNO.CODPESSOA 												   
 
 INNER JOIN SRECORRENCIACARTAO (NOLOCK)			ON SRECORRENCIACARTAO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 												   SRECORRENCIACARTAO.RA = SCONTRATO.RA AND
 												   SRECORRENCIACARTAO.CODCONTRATO = SCONTRATO.CODCONTRATO AND
 												   SRECORRENCIACARTAO.IDPERLET = SRECORRENCIACARTAO.IDPERLET
 
 INNER JOIN FRECORRENCIACARTAO (NOLOCK)			ON FRECORRENCIACARTAO.CODCOLIGADA = SRECORRENCIACARTAO.CODCOLIGADA AND 
 												   FRECORRENCIACARTAO.IDRECORRENCIA = SRECORRENCIACARTAO.IDRECORRENCIA
 
 INNER JOIN SPLETIVO (NOLOCK)					ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 
 INNER JOIN SPARCELA (NOLOCK)					ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 												   SPARCELA.RA = SCONTRATO.RA AND 
 												   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 												   SPARCELA.IDPERLET = SCONTRATO.IDPERLET
												   
 LEFT JOIN SLAN (NOLOCK)						ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 												   SLAN.IDPARCELA = SPARCELA.IDPARCELA 												   
 
 LEFT JOIN FLAN (NOLOCK)						ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 												   FLAN.IDLAN = SLAN.IDLAN

 LEFT JOIN FINTEGRACAOTRANSACAO (NOLOCK)		ON FINTEGRACAOTRANSACAO.CODCOLIGADA = FRECORRENCIACARTAO.CODCOLIGADA AND 
 												   FINTEGRACAOTRANSACAO.IDRECORRENCIA = FRECORRENCIACARTAO.IDRECORRENCIA

WHERE 	SCONTRATO.CODCOLIGADA = :$CODCOLIGADA
	AND SPLETIVO.CODPERLET LIKE '2021%'
 	AND FLAN.DATAVENCIMENTO >= :Data_Início
 	AND FLAN.DATAVENCIMENTO <= :Data_Fim
 	AND FLAN.STATUSLAN IN (0,4)
";1918;;;;15/12/2021;robson.canto;1;1;1;1;;;;0;ab7235ef-78a5-4c4b-9474-277b2091c0f2;0;;3239;robson.canto;15/12/2021;robson.canto;15/12/2021;0
F;Filtro.009;Boletos a Serem Registrados para Alunos com Status Cursando por Vencto;"SELECT DISTINCT
 FBOLETO.IDBOLETO

FROM
 FBOLETO (NOLOCK)
 
 INNER JOIN FLAN (NOLOCK)		ON FLAN.CODCOLIGADA = FBOLETO.CODCOLIGADA AND
 							   	   FLAN.IDBOLETO = FBOLETO.IDBOLETO
 				   
 INNER JOIN SLAN (NOLOCK)		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 							   	   SLAN.IDLAN = FLAN.IDLAN
 					   
 INNER JOIN SPARCELA (NOLOCK)	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   SPARCELA.IDPARCELA = SLAN.IDPARCELA 							   
   							   
 INNER JOIN SCONTRATO (NOLOCK)	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 								   SCONTRATO.RA = SPARCELA.RA AND 
 								   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 								   SCONTRATO.IDPERLET = SPARCELA.IDPERLET
   							   
 INNER JOIN SMATRICPL (NOLOCK)	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 								   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 								   SMATRICPL.RA = SCONTRATO.RA 								   
 								   
 INNER JOIN SSTATUS (NOLOCK)	ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS 								   

WHERE	FBOLETO.CODCOLIGADA = 1
	AND FBOLETO.VENCIMENTO >= :Data_Início
	AND FBOLETO.VENCIMENTO <= :Data_Fim
	AND FBOLETO.STATUS = 0
	AND FBOLETO.CNABSTATUS IN (0, 7, 2, 5)
	AND SSTATUS.DESCRICAO = 'CURSANDO'
	AND SCONTRATO.CODTIPOCURSO = :NIVEL_ENSINO";1431;;;;06/04/2022;robson.canto;1;1;1;1;;;;0;a1158a02-932b-4b2b-af1a-67af1805532a;0;;15124;robson.canto;05/01/2022;robson.canto;06/04/2022;0
F;Filtro.010;Boletos para Alterar Data de Vencimento;"SELECT 
 FBOLETO.IDBOLETO

FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SPLETIVO (NOLOCK)		ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 

 INNER JOIN SPARCELA (NOLOCK)		ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SPARCELA.RA = SCONTRATO.RA AND 
 									   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 									   SPARCELA.IDPERLET = SCONTRATO.IDPERLET 									   
 									   
 INNER JOIN SLAN (NOLOCK)			ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   SLAN.IDPARCELA = SPARCELA.IDPARCELA  									   
 									   
 INNER JOIN FLAN (NOLOCK)			ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 									   FLAN.IDLAN = SLAN.IDLAN
								   
 INNER JOIN FBOLETO (NOLOCK)		ON FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   FBOLETO.IDBOLETO = FLAN.IDBOLETO AND
 									   FBOLETO.STATUS = 0
									    									   
WHERE	SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE :Periodo_Letivo + '%'
	AND SCONTRATO.CODTIPOCURSO = 1
	AND FLAN.STATUSLAN = 0
	AND FLAN.DATAVENCIMENTO = :Vencimento";1125;;;;11/01/2022;robson.canto;1;1;1;1;;;;0;3f263321-a167-40e1-85d7-e472862286cc;0;;-4606;robson.canto;11/01/2022;robson.canto;11/01/2022;0
F;Filtro.012;Boletos Cancelados, Reg. Online sem Baixa;"SELECT DISTINCT
 X.IDBOLETO

FROM
(
 SELECT DISTINCT
  FBOLETO.CODCOLIGADA,
  FBOLETO.IDBOLETO,
  FLANBOLETO.IDLAN,
  FLANBAIXA.STATUS
   
 FROM
  FBOLETO (NOLOCK)
  
  INNER JOIN FBOLETOHISTORICO (NOLOCK)	ON FBOLETOHISTORICO.CODCOLIGADA = FBOLETO.CODCOLIGADA AND
  										   FBOLETOHISTORICO.IDBOLETO = FBOLETO.IDBOLETO

  INNER JOIN FLANBOLETO (NOLOCK)		ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA AND 
  										   FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
 										   
  INNER JOIN FLAN (NOLOCK)			ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND
 									   FLAN.IDLAN = FLANBOLETO.IDLAN

  LEFT JOIN FLANBAIXA (NOLOCK)		ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   FLANBAIXA.IDLAN = FLAN.IDLAN AND
 									   FLANBAIXA.STATUS <> 1

 WHERE	FBOLETO.CODCOLIGADA = 1
   	AND FBOLETO.STATUS = 2
   	AND FBOLETOHISTORICO.ORIGEM = 10 /*REGISTRO ONLINE*/
) X

WHERE X.STATUS IS NULL";939;;;;09/05/2022;robson.canto;1;1;1;1;;;;0;c18fc4b9-8ef5-4e2e-9989-7f1289b050b2;0;;-28991;robson.canto;09/05/2022;robson.canto;09/05/2022;0
F;Filtro.013;Taxas com Vencimento Superior a 7 Dias;"SELECT DISTINCT
 FLAN.IDLAN
 
FROM
 HATENDIMENTOBASE (NOLOCK)
 
 INNER JOIN SATENDIMENTO (NOLOCK)			ON SATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 									   		   SATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 									   		   SATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 
 INNER JOIN SPARCELASOLICITACAO  (NOLOCK)	ON SPARCELASOLICITACAO.CODCOLIGADAATEND = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   SPARCELASOLICITACAO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO AND 
 											   SPARCELASOLICITACAO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
 											   
 INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SPARCELASOLICITACAO.CODCOLIGADA AND 
 											   SPARCELA.IDPARCELA = SPARCELASOLICITACAO.IDPARCELA 											   
 											   
 INNER JOIN SLAN (NOLOCK)					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SLAN.IDPARCELA = SPARCELA.IDPARCELA
 											   
 INNER JOIN FLAN (NOLOCK)					ON FLAN.IDLAN = SLAN.IDLAN AND 
 											   FLAN.CODCOLIGADA = SLAN.CODCOLIGADA  											   

 INNER JOIN FBOLETO (NOLOCK)				ON FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 											   FBOLETO.IDBOLETO = FLAN.IDBOLETO

 INNER JOIN STIPOATENDIMENTO (NOLOCK)		ON STIPOATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND
 											   STIPOATENDIMENTO.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND
 											   STIPOATENDIMENTO.AGENDALANCAMENTO = 1
 
 INNER JOIN HTAREFA (NOLOCK)				ON HTAREFA.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA AND 
 											   HTAREFA.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO AND 
 											   HTAREFA.CODTAREFA = HATENDIMENTOBASE.CODTAREFA AND
 											   HTAREFA.NOME = 'Cancelamento'
 											   
WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1
	/*AND HATENDIMENTOBASE.CODATENDIMENTO = 9693*/
	AND HATENDIMENTOBASE.CODSTATUS = 'C'
	AND FLAN.STATUSLAN = 0
	AND FBOLETO.VENCIMENTO <= DATEADD(DD, -7, GETDATE())";2007;;;;31/05/2022;robson.canto;1;1;1;1;;;;0;7cf2094a-083e-488e-b9f0-4cb2307018a9;0;;-7816;robson.canto;31/05/2022;robson.canto;31/05/2022;0
F;Filtro.014;Lançamentos EAD com Desconto de Antecipação;"SELECT 
 X.IDLAN
 
FROM
(SELECT 
  FLAN.CODCOLIGADA,
  FLAN.IDLAN,
  FLAN.IDBOLETO,
  FBOLETO.CNABSTATUS,
  SUM(ISNULL(FLANINTEGRACAO.VALOR,0)) VALOR
  
 FROM
  FLAN (NOLOCK)
  
  INNER JOIN FBOLETO (NOLOCK)		ON FLAN.CODCOLIGADA = FBOLETO.CODCOLIGADA AND
 					   				   FLAN.IDBOLETO = FBOLETO.IDBOLETO AND
 					   				   FBOLETO.CNABSTATUS NOT IN (6, 5)
 					   
  LEFT JOIN FLANINTEGRACAO (NOLOCK)	ON FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 							  		   FLANINTEGRACAO.IDLAN = FLAN.IDLAN AND
 							  		   FLANINTEGRACAO.IDCAMPO IN (48, 49) 					   

 WHERE FLAN.CODCOLIGADA = 1
   AND FLAN.CODFILIAL = 4
   /*AND FLAN.FORMULAVALOROP3 IS NOT NULL*/
   AND FLAN.DATAVENCIMENTO >= GETDATE()
   AND FLAN.STATUSLAN = 0
   AND FLAN.CLASSIFICACAO <> 15
   AND FLAN.CODTDO = 'MENS'
	
 GROUP BY FLAN.CODCOLIGADA, FLAN.IDLAN, flan.IDBOLETO, fboleto.CNABSTATUS

) X
WHERE 	X.VALOR = 0";925;;;;07/06/2022;robson.canto;1;1;1;1;;;;0;03431550-e06d-4bbb-a36c-706cbbfd0e36;0;;-2554;robson.canto;07/06/2022;robson.canto;07/06/2022;0
F;Filtro.015;Boletos Reg. OnLine com Baixa por Outros Meios de Pagto;"SELECT DISTINCT
 X.IDBOLETO

FROM
(
 SELECT DISTINCT
  FBOLETO.CODCOLIGADA,
  FBOLETO.IDBOLETO,
  FLANBOLETO.IDLAN,
  FLANBAIXA.STATUS,
  FBOLETO.CNABSTATUS
   
 FROM
  FBOLETO (NOLOCK)
  
  INNER JOIN FBOLETOHISTORICO (NOLOCK)	ON FBOLETOHISTORICO.CODCOLIGADA = FBOLETO.CODCOLIGADA AND
  										   FBOLETOHISTORICO.IDBOLETO = FBOLETO.IDBOLETO

  INNER JOIN FLANBOLETO (NOLOCK)		ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA AND 
  										   FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
 										   
  INNER JOIN FLAN (NOLOCK)			ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND
 									   FLAN.IDLAN = FLANBOLETO.IDLAN

  LEFT JOIN FLANBAIXA (NOLOCK)		ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   FLANBAIXA.IDLAN = FLAN.IDLAN AND
 									   FLANBAIXA.STATUS <> 1

 WHERE	FBOLETO.CODCOLIGADA = 1
   	AND FBOLETO.STATUS = 1
   	AND FBOLETOHISTORICO.ORIGEM = 10 /*REGISTRO ONLINE*/
   	AND FBOLETOHISTORICO.IDBOLETO NOT IN (SELECT
   										   FB.IDBOLETO
   										   
   										  FROM
   										   FBOLETOHISTORICO FB (NOLOCK)
   										   
   										  WHERE	FB.CODCOLIGADA = FBOLETOHISTORICO.CODCOLIGADA
   										  	AND FB.IDBOLETO = FBOLETOHISTORICO.IDBOLETO
   										  	AND FB.ORIGEM = 16 /*RETORNO BANCÁRIO*/)
   	
) X

WHERE X.STATUS IS NOT NULL";1341;;;;08/06/2022;robson.canto;1;1;1;1;;;;0;4e7b1771-2796-4222-872f-b77340a10b48;0;;-3075;robson.canto;08/06/2022;robson.canto;08/06/2022;0
F;Filtro.016;Lançamentos FIES;"SELECT
 FLAN.IDLAN
 
FROM
 FLAN (NOLOCK)
 
 INNER JOIN SLAN (NOLOCK)		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 								   SLAN.IDLAN = FLAN.IDLAN
 								   
 INNER JOIN SPARCELA (NOLOCK)	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   SPARCELA.IDPARCELA = SLAN.IDPARCELA 								   
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.PAGREC = 1
	AND FLAN.CODCFO = '58807'

UNION ALL

SELECT 
 FLAN.IDLAN
 
FROM
 FLAN (NOLOCK)
 
 INNER JOIN SLAN (NOLOCK)		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 								   SLAN.IDLAN = FLAN.IDLAN
 								   
 INNER JOIN SPARCELA (NOLOCK)	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   SPARCELA.IDPARCELA = SLAN.IDPARCELA 								   

 INNER JOIN SBOLSALAN (NOLOCK)	ON SBOLSALAN.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   SBOLSALAN.IDLAN = SLAN.IDLAN 
 								   
 INNER JOIN SBOLSA (NOLOCK)		ON SBOLSA.CODCOLIGADA = SBOLSALAN.CODCOLIGADA AND
 								   SBOLSA.CODBOLSA = SBOLSALAN.CODBOLSA
 								   								   
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.PAGREC = 1
	AND SBOLSA.NOME LIKE '%FIES%'
	AND FLAN.CODCFO <> '58807'";1123;;;;05/07/2022;robson.canto;1;1;1;1;;;;0;2c572637-4ce5-483c-a44a-6dc1d5e338e1;0;;-6294;robson.canto;05/07/2022;robson.canto;05/07/2022;0
F;Filtro.017;Boletos por Filial, Nível de Ensino e Período Letivo;"SELECT
 FBOLETO.IDBOLETO
 
FROM
 FBOLETO (NOLOCK)
 
 INNER JOIN FLAN (NOLOCK)		ON FLAN.CODCOLIGADA = FBOLETO.CODCOLIGADA AND
 								   FLAN.IDBOLETO = FBOLETO.IDBOLETO
 								   
 INNER JOIN SLAN (NOLOCK)		ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 								   SLAN.IDLAN = FLAN.IDLAN
 								   
 INNER JOIN SPARCELA (NOLOCK)	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 								   SPARCELA.IDPARCELA = SLAN.IDPARCELA 								    								   
 								   
 INNER JOIN SCONTRATO (NOLOCK)	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 								   SCONTRATO.RA = SPARCELA.RA AND 
 								   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 								   SCONTRATO.IDPERLET = SPARCELA.IDPERLET 								   

 INNER JOIN SPLETIVO (NOLOCK)	ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 								   
WHERE	FBOLETO.CODCOLIGADA = 1
	AND FBOLETO.CODFILIAL = :Filial
	AND SCONTRATO.CODTIPOCURSO = :Nível_Ensino
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'";1049;;;;12/07/2022;robson.canto;1;1;1;1;;;;0;e7ccef79-9aea-4071-bace-6d137e3a8ca3;0;;27510;robson.canto;12/07/2022;robson.canto;12/07/2022;0
F;Filtro.018;Lançamentos Enviados para o Jurídico Limpa Nome;"SELECT
 FLAN.IDLAN

FROM 
 FLAN(NOLOCK)

 INNER JOIN FLANCOMPL(NOLOCK)		ON FLANCOMPL.CODCOLIGADA = FLAN.CODCOLIGADA AND 
 									   FLANCOMPL.IDLAN = FLAN.IDLAN
 									   
WHERE ISNULL(FLANCOMPL.SERASALN,'0') = '1'
	AND FLAN.STATUSLAN IN (0, 4)";259;;;;03/10/2022;robson.canto;1;1;1;1;;;;0;e1ad9a8a-0b29-42b9-b2d6-5e6f264f9d5a;0;;29399;robson.canto;03/10/2022;robson.canto;03/10/2022;0
F;Filtro.023;Matriz faltando no template de acordo;"SELECT SHABILITACAOFILIALPL.IDHABILITACAOFILIAL , SHABILITACAOFILIALPL.RECMODIFIEDON , SHABILITACAOFILIALPL.RECMODIFIEDBY, SCURSO.NOME , SGRADE.DESCRICAO , STURNO.NOME ,
SPLETIVO.CODTIPOCURSO,
SPLETIVO.CODFILIAL
FROM SHABILITACAOFILIALPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
LEFT JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
LEFT JOIN SHABILITACAO ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
LEFT JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SGRADE.CODCURSO = SHABILITACAO.CODCURSO AND SGRADE.CODHABILITACAO = SHABILITACAO.CODHABILITACAO
LEFT JOIN SCURSO ON SCURSO.CODCOLIGADA = SGRADE.CODCOLIGADA AND SCURSO.CODCURSO = SGRADE.CODCURSO
LEFT JOIN STURNO ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
WHERE CODPERLET =:PERIODOLETIVO
AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL NOT IN ( SELECT IDHABILITACAOFILIAL FROM FTEMPLATEACORDOHABILITFILIAL )

";1250;;;;17/08/2021;mestre;1;1;1;1;;;;1;c99b6d45-e5c1-472a-b610-670af33c3f20;0;;17630;mestre;17/08/2021;mestre;17/08/2021;0
F;Filtro.030;Lista de Alunos com Bolsa ;"SELECT SBOLSA.NOME BOLSA ,  SBOLSALAN.VALOR , SPARCELA.PARCELA ,  SMATRICPL.RA , PPESSOA.NOME ALUNO , SBOLSALAN.IDLAN FROM SBOLSALAN
INNER JOIN SPARCELA ON SBOLSALAN.IDPARCELA = SPARCELA.IDPARCELA AND SBOLSALAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SCONTRATO.RA 
INNER JOIN SBOLSA ON SBOLSALAN.CODCOLIGADA = SBOLSA.CODCOLIGADA AND SBOLSALAN.CODBOLSA = SBOLSA.CODBOLSA
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA 
WHERE SPLETIVO.CODPERLET =:PL
AND   SMATRICPL.CODTURMA LIKE '%' + :TURMA + '%'
AND   SPARCELA.DTVENCIMENTO BETWEEN :DTINICIAL_D AND :DTFINAL_D
AND   SCONTRATO.CODFILIAL =:FILIAL";1205;;;;20/09/2021;lilian.buzetti;1;1;1;1;;;;1;2789d515-fb54-411b-8868-1c6bcc20e5ad;0;;-15249;lilian.buzetti;20/09/2021;lilian.buzetti;20/09/2021;0
F;Filtro.031;Recebimentos duplicados com cartão;"SELECT FLAN.IDLAN FROM FLAN 
INNER JOIN FLANBAIXA ON FLANBAIXA.IDLAN = FLAN.IDLAN AND FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA
WHERE STATUSLAN = 4
AND flan.PAGREC = 1
AND FLANBAIXA.CODCXA NOT LIKE '9%'";205;;;;20/09/2021;lilian.buzetti;1;1;1;1;;;;0;eef9eda2-34d6-473b-bea7-d50cb59fdeef;0;;-2771;lilian.buzetti;20/09/2021;lilian.buzetti;20/09/2021;0
F;Filtro.032;Boletos por curso;"SELECT FBOLETO.IDBOLETO FROM FBOLETO
INNER JOIN FLANBOLETO ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
INNER JOIN FLAN ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND FLANBOLETO.IDLAN = FLAN.IDLAN
INNER JOIN SLAN ON SLAN.IDLAN = FLAN.IDLAN AND SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET 
INNER JOIN SHABILITACAOFILIAL ON SCONTRATO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SGRADE.CODCOLIGADA AND SCURSO.CODCURSO = SGRADE.CODCURSO 
WHERE SCURSO.NOME LIKE '%' + :NOMECURSO + '%'";1176;;;;05/10/2021;lilian.buzetti;1;1;1;1;;;;0;55cf896e-97e7-4467-9e98-fad607bf1960;0;;-24774;lilian.buzetti;05/10/2021;lilian.buzetti;05/10/2021;0
F;Filtro.033;Boletos cancelados com transação de cartão;"SELECT  FBOLETO.IDBOLETO FROM FINTEGRACAOCARTAO 
INNER JOIN FBOLETO ON FBOLETO.CODCOLIGADA = FINTEGRACAOCARTAO.CODCOLIGADA AND FBOLETO.IDBOLETO = FINTEGRACAOCARTAO.IDBOLETO
WHERE IDSTATUS in( 4,6) AND FBOLETO.STATUS <> 1 
";225;;;;07/10/2021;lilian.buzetti;1;1;1;1;;;;0;54761582-8d1c-4c6e-b34e-aa1bc742251d;0;;17905;lilian.buzetti;07/10/2021;lilian.buzetti;07/10/2021;0
F;FINREL0012.2;Lançamentos baseados no numero do doc;"SELECT VALOR FROM FXCX WHERE NUMERODOCUMENTO =:numerodocumento	";63;;;;20/07/2021;lucas.ssantos;1;1;1;1;;;;0;b97815a8-2d09-46e1-b695-a8e3e8405f00;0;;-25976;lucas.ssantos;20/07/2021;lucas.ssantos;20/07/2021;0
F;FINREL0012.3;RECIBO;"SELECT FLANBAIXA.CODCOLIGADA,
       FLANBAIXA.IDLAN,
       FLANBAIXA.IDBAIXA,
       FLAN.DATAEMISSAO,
       FLAN.DATAVENCIMENTO,
       FLAN.CODTDO,
       FLAN.CODCOLCFO,
       FLAN.CODCFO,
       FLAN.CODCCUSTO,
       FLAN.CODFILIAL,
       FLAN.TIPOCONTABILLAN,
       FLANBAIXA.CODCOLXCX,
       FLANBAIXA.IDXCX,
       FLANBAIXA.IDFORMAPAGTO,
       FLANBAIXA.PAGREC,
       FLANBAIXA.CODMOEDABAIXA,
       FLANBAIXA.COTACAOBAIXA,
       FLANBAIXA.CODCOLCXA,
       FLANBAIXA.CODCXA,
       FLANBAIXA.IDTRANSACAO,
       FLANBAIXA.DATABAIXA,
       FLANBAIXA.DATACHEQUE,
       FLANBAIXA.DATAVENCIMENTOLANCAMENTO,
       FLANBAIXA.DATACONTABILIZBX,
       FLANBAIXA.DATACANCELBAIXA,
       FLANBAIXA.MODELOCONTABILIZACAO,
       FLANBAIXA.NUMCONTABILBX,
       FLANBAIXA.CODEVENTOBAIXA,
       FLANBAIXA.VALORBAIXA,
       FLANBAIXA.VALORORIGINAL,
       FLANBAIXA.VALORDESCONTO,
       FLANBAIXA.VALORJUROS,
       FLANBAIXA.VALORMULTA,
       FLANBAIXA.VALORCAP,
       FLANBAIXA.VALOROP1,
       FLANBAIXA.VALOROP2,
       FLANBAIXA.VALOROP3,
       FLANBAIXA.VALOROP4,
       FLANBAIXA.VALOROP5,
       FLANBAIXA.VALOROP6,
       FLANBAIXA.VALOROP7,
       FLANBAIXA.VALOROP8,
       FLANBAIXA.VALORINSS,
       FLANBAIXA.VALORIRRF,
       FLANBAIXA.VALORDEVOLUCAO,
       FLANBAIXA.VALORNOTACREDITO,
       FLANBAIXA.VALORNOTACREDITOADIANTAMENTO,
       FLANBAIXA.VALORJUROSVENDOR,
       FLANBAIXA.VALORRETENCOES,
       FLANBAIXA.USUARIO,
       FLANBAIXA.STATUS,
       FLANBAIXA.STATUSEXTRATO,
       FLANBAIXA.NUMEROCHEQUE,
       FLANBAIXA.VALORPERDAFINANCEIRA,
       FLANBAIXA.IDOPERACAO,
       FLANBAIXA.VALORSESTSENAT,
       FLANBAIXA.VALORVINCULADO,
       FLANBAIXA.VALORDESCONTOACORDO,
       FLANBAIXA.VALORJUROSACORDO,
       FLANBAIXA.VALORACRESCIMOACORDO,
       FLANBAIXA.TIPOFORMAPAGTO,
       TFFORMAPAGTO.DESCFORMAPAGTO,
       TFORMAPAGTO.CODFORMAPAGTO,
       FLANBAIXA.CODTB1FLX,
       FLANBAIXA.CODTB2FLX,
       FLANBAIXA.CODTB3FLX,
       FLANBAIXA.CODTB4FLX,
       FLANBAIXA.CODTB5FLX,
       FLANBAIXA.DATAOP1,
       FLANBAIXA.DATAOP2,
       FLANBAIXA.DATAOP3,
       FLANBAIXA.DATAOP4,
       FLANBAIXA.DATAOP5,
       FLANBAIXA.CAMPOALFAOP1,
       FLANBAIXA.CAMPOALFAOP2,
       FLANBAIXA.CAMPOALFAOP3,
       FLANBAIXA.CODDEPARTAMENTO,
       FLANBAIXA.STATUSCONTABIL,
       FLANBAIXA.VALORDESCONTOPONTUAL,
       FXCX.VALOR,
       FXCX.NUMERODOCUMENTO
FROM   FLAN (NOLOCK),
       FLANBAIXA (NOLOCK)
       LEFT JOIN TFORMAPAGTO (NOLOCK)
              ON FLANBAIXA.CODCOLIGADA = TFORMAPAGTO.CODCOLIGADA
                 AND FLANBAIXA.IDFORMAPAGTO = TFORMAPAGTO.IDFORMAPAGTO
       INNER JOIN FXCX
               ON ( FLANBAIXA.CODCOLXCX = FXCX.CODCOLIGADA )
                  AND ( FLANBAIXA.IDXCX = FXCX.IDXCX )
       INNER JOIN TFFORMAPAGTO (NOLOCK)	
       		   ON (TFFORMAPAGTO.CODCOLIGADA = FLANBAIXA.CODCOLIGADA 
       		   	  AND TFFORMAPAGTO.IDFORMAPAGTO = FLANBAIXA.IDFORMAPAGTO)
WHERE  FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA
       AND FLANBAIXA.IDLAN = FLAN.IDLAN
       AND ( FXCX.NUMERODOCUMENTO = :NUMERODOCUMENTO1 ) 
";3189;;;;20/07/2021;lucas.ssantos;1;1;1;1;;;;0;dac875bd-8cb4-450e-aa0a-47963f5f080f;0;;23524;lucas.ssantos;20/07/2021;lucas.ssantos;20/07/2021;0
F;FINREL0012.5;Formas PGTO e Valor;"SELECT Sum(LB.VALORBAIXA) VALOR,
       F.DESCFORMAPAGTO

FROM   FLAN L
       INNER JOIN FLANBAIXA LB
               ON LB.IDLAN = L.IDLAN
                  AND LB.CODCOLIGADA = L.CODCOLIGADA
       INNER JOIN TFORMAPAGTO F
               ON F.CODCOLIGADA = LB.CODCOLIGADA
                  AND F.IDFORMAPAGTO = LB.IDFORMAPAGTO

WHERE  L.IDLAN = :IDLAN1
       AND L.CODCOLIGADA = :CODCOLIGADA1

GROUP  BY F.DESCFORMAPAGTO 
";440;;;;21/07/2021;lucas.ssantos;1;1;1;1;;;;0;ce74933f-1980-4e1a-b0a6-3b4b7c3b8a5e;0;;12749;lucas.ssantos;21/07/2021;lucas.ssantos;21/07/2021;0
F;FINREL0012.6;TESTE;" SELECT
	LB.IDLAN,
	LB.IDFORMAPAGTO,
	SUM(LB.VALORBAIXA) VALOR,
	F.DESCFORMAPAGTO
	
FROM FLANBAIXA LB 
	INNER JOIN TFORMAPAGTO F ON F.CODCOLIGADA = LB.CODCOLIGADA AND F.IDFORMAPAGTO = LB.IDFORMAPAGTO

WHERE LB.IDLAN = :IDLAN
GROUP BY LB.IDLAN, LB.IDFORMAPAGTO, F.DESCFORMAPAGTO";287;;;;22/07/2021;lucas.ssantos;1;1;1;1;;;;0;274a6f46-3e46-4cc5-8774-868905b9c7af;0;;-2955;lucas.ssantos;22/07/2021;lucas.ssantos;22/07/2021;0
F;FINREL0012.7;TESTE;"SELECT
	SUM(LB.VALORBAIXA) VALOR,
	F.DESCFORMAPAGTO

FROM FLANBAIXA LB 
	INNER JOIN TFORMAPAGTO F ON F.CODCOLIGADA = LB.CODCOLIGADA AND F.IDFORMAPAGTO = LB.IDFORMAPAGTO

WHERE LB.IDLAN = :IDLAN
GROUP BY F.DESCFORMAPAGTO";227;;;;22/07/2021;lucas.ssantos;1;1;1;1;;;;0;e7795e43-c42c-40d4-9fe5-1fc0e499100e;0;;-17781;lucas.ssantos;22/07/2021;lucas.ssantos;22/07/2021;0
F;FSWIP99;Teste SQL;select * from flan where idlan = 3641;37;;;;30/06/2021;mestre;1;1;1;1;;;;0;47870a25-1f85-4c18-a3d5-ab81a4696e32;0;;31930;mestre;30/06/2021;mestre;30/06/2021;0
F;INGRESSANTE;Alunos ingressantes (parcela de alunos);"SELECT 1 INGRESSANTE FROM FLAN
INNER JOIN SLAN ON SLAN.IDLAN = FLAN.IDLAN AND SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SCONTRATO.RA
WHERE SMATRICPL.CODTIPOMAT = 1
AND FLAN.CODCOLIGADA =:frm_COLIGADA
AND FLAN.IDLAN =:frm_IDLAN";721;;;;02/09/2021;lilian.buzetti;1;1;1;1;;;;0;3aa8ba0d-c25c-4c33-b655-45f24e5e2239;0;;5324;lilian.buzetti;02/09/2021;lilian.buzetti;02/09/2021;0
F;IP004;Consulta que retorna valor para a formula IP004 - Descontos para Boleto on Line;"SELECT 
 REPLACE(CONVERT(DECIMAL(18,2), ISNULL((SELECT
  								         SUM(FLANINTEGRACAO.VALOR)
  								  
  								 		FROM
  								  		 FLANINTEGRACAO (NOLOCK)
  								  
  								 		WHERE	FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA
  								 			AND FLANINTEGRACAO.IDCAMPO = 49 
  								 			AND FLANINTEGRACAO.IDLAN IN (SELECT
  								 								  		  FL.IDLAN
  								 								  
  								 								 		 FROM
  								 								  		  FBOLETO (NOLOCK)
  								 								  
  								 								  		  INNER JOIN FLAN FL (NOLOCK)	ON FL.CODCOLIGADA = FBOLETO.CODCOLIGADA AND
  								 								  								   		   FL.IDBOLETO = FBOLETO.IDBOLETO
  								 								  								   
  								 								 		 WHERE  FBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA 
  								 								 			AND FBOLETO.IDBOLETO = FLAN.IDBOLETO
  								 								 			AND FBOLETO.STATUS <> 2
  								 								 		)
  									   ),0
  									  ) + ISNULL(:FRM_Voucher,0) + ISNULL(:FRM_Desc.Adi,0) + ISNULL(:FRM_99EAD,0)  ),'.','') AS D
 
/* 
 CASE WHEN ISNULL(I.VALOR,0) + :FRM_Voucher + :FRM_Desc.Adi + :FRM_99EAD = 0 THEN 0
 	  ELSE REPLACE(CONVERT(DECIMAL(18,2), ISNULL(I.VALOR,0) + :FRM_Voucher + :FRM_Desc.Adi + :FRM_99EAD  ),'.','') END AS D
*/

FROM 
 FLAN (NOLOCK)

WHERE 	FLAN.CODCOLIGADA = :FRM_COLIGADA
	AND FLAN.IDLAN = :FRM_IDLAN

/*

SELECT 
 REPLACE(CONVERT(DECIMAL(18,2), ISNULL(I.VALOR,0) + ISNULL(:FRM_Voucher,0) + ISNULL(:FRM_Desc.Adi,0) + ISNULL(:FRM_99EAD,0)  ),'.','') AS D

FROM FLAN L (NOLOCK)
LEFT OUTER JOIN FLANINTEGRACAO I (NOLOCK) ON L.CODCOLIGADA = I.CODCOLIGADA AND L.IDLAN = I.IDLAN AND I.IDCAMPO=49 

WHERE L.CODCOLIGADA=:FRM_COLIGADA
AND   L.IDLAN=:FRM_IDLAN
*/";1720;;;;08/02/2022;robson.canto;1;1;1;1;;;;0;ba4acba7-2522-454a-922a-5d686ca655c5;0;;-24095;mestre;18/05/2021;robson.canto;08/02/2022;0
F;jjj;testes;"SELECT * 
                                   FROM ZTNFEMUNICIPAL (NOLOCK) 
                                  WHERE CODCOLIGADA = 1 
                                    AND IDMOV = 53103 AND STATUS <> 'E'";206;;;;02/05/2022;edison.pitoli;1;1;1;1;;;;0;b15d9c67-62d7-4685-8a32-f60c5eae17d0;0;;31815;julio.lidani;23/02/2022;edison.pitoli;02/05/2022;0
F;MENS.001.4;Mensagem Boletos em Aberto por Vencimento - NAO USAR;"SELECT DISTINCT
	b.CODCOLIGADA,
	b.RECCREATEDBY CODUSUARIO,
	FCFO.EMAIL,
	p.RA,
	FCFO.NOME,
	FCFO.NOME NOMEDESTINATARIO,
	b.IDBOLETO,
	b.CODFILIAL,
	b.SACADO,
	b.VALOR
FROM
	FBOLETO				(NOLOCK)	b	
	INNER JOIN FCFO		(NOLOCK)		ON FCFO.CODCOLIGADA = b.CODCOLSACADO AND FCFO.CODCFO = b.SACADO 								   
	inner join FLAN		(NOLOCK)	fl	on fl.IDBOLETO = b.IDBOLETO
	inner join SLAN		(NOLOCK)	sl	on sl.CODCOLIGADA = fl.CODCOLIGADA and sl.IDLAN = fl.IDLAN
	inner join SPARCELA (NOLOCK)	p	on p.CODCOLIGADA = sl.CODCOLIGADA and p.IDPARCELA = sl.IDPARCELA

WHERE	b.CODCOLIGADA = 1
	AND b.STATUS = 0
	AND b.VENCIMENTO >= :Data_Início
	AND b.VENCIMENTO <= :Data_Fim";673;;;;04/04/2022;mario;1;1;1;1;;;;0;16bfbea6-7bb0-43a5-9065-c4b268dd003b;0;;-4041;robson.canto;04/03/2022;robson.canto;19/04/2022;0
F;PLN1.001;Planilha NET: 1 - Conferencia Natureza X Amarração Contábil;"SELECT T.CODTBORCAMENTO, T.DESCRICAO, 
       CASE WHEN T.SINTETICOANALITICO=0 THEN 'SINTE' ELSE 'ANALI' END AS 'SINTE/ANALI',
	   C.CODCONTA, 
	   CC.REDUZIDO,
	   CC.DESCRICAO,
	   CASE WHEN C.DEBOUCRED=1 AND T.SINTETICOANALITICO=1 THEN 'DEB' ELSE CASE WHEN C.DEBOUCRED=2 AND T.SINTETICOANALITICO=1 THEN 'CRED' ELSE '' END END 'D/C',
	   C.CLASSCONTA,
	   C.PERCENTUAL,
	   C.CODCCUSTO
FROM TTBORCAMENTO T (NOLOCK)
LEFT OUTER JOIN TTBORCAMENTOCONT C (NOLOCK) ON T.CODCOLIGADA = C.CODCOLIGADA AND T.CODTBORCAMENTO = C.CODTBORCAMENTO
LEFT OUTER JOIN CCONTA CC (NOLOCK) ON C.CODCOLCONTA = CC.CODCOLIGADA AND C.CODCONTA = CC.CODCONTA
WHERE T.CODCOLIGADA=1
ORDER BY 1, 4";680;;;;31/03/2021;mestre;1;1;1;1;;;;0;df35e484-e018-4f83-8c78-0ce00e8616cc;0;;-23503;mestre;01/03/2021;mestre;31/03/2021;0
F;PLN1.002;Planilha NET: 1 - Conferencia Filial X Amarração Contábil;"SELECT T.CODFILIAL, T.NOME,
       C.CODCONTA, 
	   CC.REDUZIDO,
	   CC.DESCRICAO,
	   CASE WHEN C.TIPO=1 THEN 'DEB' ELSE CASE WHEN C.TIPO=2 THEN 'CRED' ELSE '' END END 'D/C',
	   C.CLASSCONTA,
	   C.PERCENTUAL,
	   C.CODCCUSTO	   
FROM GFILIAL T (NOLOCK)
LEFT OUTER JOIN TFILCONT C (NOLOCK) ON T.CODCOLIGADA = C.CODCOLIGADA AND T.CODFILIAL = C.CODFILIAL
LEFT OUTER JOIN CCONTA CC (NOLOCK) ON C.CODCOLCONTA = CC.CODCOLIGADA AND C.CODCONTA = CC.CODCONTA
WHERE T.CODCOLIGADA=1
ORDER BY 1, 3";500;;;;31/03/2021;mestre;1;1;1;1;;;;0;5ff6f889-e147-49fc-bfac-540dfc01407b;0;;25300;mestre;01/03/2021;mestre;31/03/2021;0
F;PLN1.003;Planilha NET: 1 - Conferencia Bolsa X Amarração Contábil;"SELECT T.CODBOLSA, T.NOME,
       CASE WHEN T.CODTIPOCURSO = '1' THEN 'Graduação' WHEN T.CODTIPOCURSO = '2' THEN 'Pós Graduação' WHEN T.CODTIPOCURSO = '3'  THEN 'Extensão/Livre' ELSE '' END 'TIPO CURSO',
       C.CODCONTA, 
	   CC.REDUZIDO,
	   CC.DESCRICAO,
	   CASE WHEN C.TIPO=1 THEN 'DEB' ELSE CASE WHEN C.TIPO=2 THEN 'CRED' ELSE '' END END 'D/C',
	   C.CLASSCONTA,
	   C.PERCENTUAL,
	   C.CODCCUSTO	   
FROM SBOLSA T (NOLOCK)
LEFT OUTER JOIN SBOLSACONT C (NOLOCK) ON T.CODCOLIGADA = C.CODCOLIGADA AND T.CODBOLSA = C.CODBOLSA
LEFT OUTER JOIN CCONTA CC (NOLOCK) ON C.CODCOLCONTA = CC.CODCOLIGADA AND C.CODCONTA = CC.CODCONTA
WHERE T.CODCOLIGADA=1
ORDER BY 3,1,4
";679;;;;31/03/2021;mestre;1;1;1;1;;;;0;cb1eed0f-d62a-45b9-aebb-0dda1b2adb6b;0;;30853;mestre;01/03/2021;mestre;31/03/2021;0
F;PLN1.004;Planilha NET: 1 - Conferencia Cadastro de Bolsa;"SELECT T.CODBOLSA, T.NOME,
       CASE WHEN T.CODTIPOCURSO = '1' THEN 'Graduação' WHEN T.CODTIPOCURSO = '2' THEN 'Pós Graduação' WHEN T.CODTIPOCURSO = '3'  THEN 'Extensão/Livre' ELSE '' END 'TIPO CURSO',
	   T.ATIVA,
	   T.CODCFO,
       T.VALOR,
	   T.TIPODESC,
	   CB.DESCRICAO CLASSIFICACAO,
	   CASE WHEN T.VALIDADELIMITADA=0 THEN 'NAO' ELSE 'SIM' END AS 'BOLSA INCONDIC', 
	   CASE WHEN T.BOLSAFUNC=0 THEN 'NAO' ELSE 'SIM' END AS 'BOLSA FUNCION', 
	   CASE WHEN T.VERIFICAINADIMPLENCIA='S' THEN 'SIM' ELSE 'NAO' END AS 'VERIFICA INADIM',
	   CASE WHEN T.CONTABCOMPETENCIA='S' THEN 'SIM' ELSE 'NAO' END AS 'CONTAB COMPET',
	   C.CODFILIAL,
	   CASE WHEN C.TIPODESCONTONFE=1 THEN 'INCONDICION' WHEN C.TIPODESCONTONFE=2 THEN 'CONDICIONAL' ELSE '' END AS 'TIPO DESC'
FROM SBOLSA T (NOLOCK)
LEFT OUTER JOIN SCLASSIFICACAOBOLSA CB (NOLOCK) ON T.CODCOLIGADA = CB.CODCOLIGADA AND T.CODCLASSIFICACAO = CB.CODCLASSIFICACAO AND T.CODTIPOCURSO = CB.CODTIPOCURSO
LEFT OUTER JOIN SBOLSAFILIAL C (NOLOCK) ON T.CODCOLIGADA = C.CODCOLIGADA AND T.CODBOLSA = C.CODBOLSA
WHERE T.CODCOLIGADA=1
ORDER BY 3,1, 13";1111;;;;01/03/2021;mestre;1;1;1;1;;;;0;4ead8df9-c58d-4234-aa5e-0764ef811cac;0;;-6253;mestre;01/03/2021;mestre;01/03/2021;0
F;PLN1.005;Planilha NET: 1 - Conferencia Cadastro de Serviços;"SELECT T.CODSERVICO, T.NOME,
       CASE WHEN T.CODTIPOCURSO = '1' THEN 'Graduação' WHEN T.CODTIPOCURSO = '2' THEN 'Pós Graduação' WHEN T.CODTIPOCURSO = '3'  THEN 'Extensão/Livre' ELSE '' END 'TIPO CURSO',
	   T.CODTDO,
	   CASE WHEN T.VERIFICAINADIMPLENCIA='S' THEN 'SIM' ELSE 'NAO' END AS 'VERIFICA INADIM',
	   CASE WHEN T.TIPOCONTABILLAN=1 THEN 'CONTABIL' 
	        WHEN T.TIPOCONTABILLAN=3 THEN 'A CONTABILIZAR' 
	        WHEN T.TIPOCONTABILLAN=2 THEN 'BAIXA CONT' END AS 'TIPO CONT',
	   CB.DESCRICAO 'NATUR FINAN',
       CASE WHEN T.PERMITEACORDO='S' THEN 'SIM' ELSE 'NAO' END AS 'ACORDO',
	   CASE WHEN T.APROVEITACONTACORRENTE='S' THEN 'SIM' ELSE 'NAO' END AS 'C/C',
	   P.CODIGOPRD,
	   P.DESCRICAO
FROM SSERVICO T (NOLOCK)
LEFT OUTER JOIN TTBORCAMENTO CB (NOLOCK) ON T.CODCOLNATFINANCEIRA = CB.CODCOLIGADA AND T.CODNATFINANCEIRA = CB.CODTBORCAMENTO
LEFT OUTER JOIN TPRODUTO P (NOLOCK) ON T.CODCOLIGADA = P.CODCOLPRD AND T.IDPRD = P.IDPRD
WHERE T.CODCOLIGADA=1
ORDER BY 3,1";1000;;;;30/06/2021;mestre;1;1;1;1;;;;0;4ab8bce1-d841-4739-9447-5da5dd578233;0;;9699;mestre;01/03/2021;mestre;30/06/2021;0
F;RSS.001;BOLETO;SELECT * FROM FBOLETO WHERE IDBOLETO = 8008;43;;;;12/07/2021;mestre;1;1;1;1;;;;0;5d60cddb-408b-4ad0-bc1e-a78e88908044;0;;13987;mestre;12/07/2021;mestre;12/07/2021;0
F;RSS.002;Leitura RSS;SELECT * FROM FBOLETO WHERE IDBOLETO = 8008;43;;;;12/07/2021;mestre;1;1;1;1;;;;0;644b2947-92d1-4b23-b2f1-607e87b51a91;0;;26655;mestre;12/07/2021;mestre;12/07/2021;0
F;teste;teste;"
SELECT
 *
FROM
 FLAN (NOLOCK)
 
WHERE	FLAN.CODCOLIGADA = 1
	AND FLAN.IDLAN IN (104248,104535,104548,104578,104773,104798,104812,108450,108595,108733,108743,108784,108941,108958,
109055,109207,109256,109394,109611,109642,109668,110159,110255,110287,111214,111223,111415,111612,
111706,111829,111866,111898,111968,112129,112175,112345,112410,112510,112558,112580,112614,112678,
112936,113041,113129,113185,113293,113301,113306,113307,113432,113484,113547,113741,113743,113770,
113786,113847,113876,114145,114263,114341,114411,114514,114664,114669,114670,114762,114772,114773,
114952,114983,114986,115088,115124,115374,115441,115481,115483,115649,115678,115795,115804,115854,
115856,115878,115898,115899,115914,115921,115956,115960,115966,115967,115992,116062,116235,116448,
116561,116583,116655,116669,116886,116918,116921,116937,116950,116952,116976,116977,116978,117060,
117142,117216,117222,117224,117238,117260,117261,117325,117337,117361,117565,117590,117794,117831,
117881,117901,117956,118060,118077,118114,118118,118139,118178,118196,118208,118216,118324,118443,
118451,118453,118518,118535,118648,118864,118871,119009,119012,119059,119078,119320,119326,119340,
119404,119407,119434,119461,119485,119509,119525,119570,119676,119796,119843,119884,119953,119974,
119978,120038,120057,120099,120132,120203,120207,120218,120220,120228,120262,120285,120293,120298,
120314,120346,120355,120401,120505,120530,120575,120616,120639,120642,120707,120734,120888,120924,
120934,120971,120985,121007,121026,121053,121058,121086,121093,121099,121124,121139,121146,121199,
121207,121213,121227,121231,121236,121239,121245,121246,121258,121259,121264,121282,121292,121306,
121311,121346,121355,121356,121585,121642,121648,121649,121698,121733,121768,121787,121795,121801,
121810,121815,121818,121819,121850,121854,121858,121874,121954,122021,122059,122072,122080,122121,
122124,122131,122156,122165,122168,122198,122269,122275,122290,122298,122308,122325,122379,122387,
122389,122396,122399,122403,122416,122450,122494,122504,122509,122514,122516,122517,122519,122521,
122522,122631)



 /*(SELECT DISTINCT
 						  SCONTRATO.RA
 
						 FROM
 						  SCONTRATO (NOLOCK)
 
 						  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
										   							   SALUNO.RA = SCONTRATO.RA
  											   
 						  INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA  											   
 
 						  INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   							   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET 											    											   

 						  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   							   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
											   
 						  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   							   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 						  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   							   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   							   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   							   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
						   
						WHERE	SCONTRATO.CODCOLIGADA = 1 /*:Coligada*/
							AND SPLETIVO.CODPERLET LIKE '2022' /*:Período_Letivo*/ + '%'
							AND SCURSO.NOME LIKE '%PENSIONATO%')*/

";3577;0;;;08/03/2022;joel.silvano;1;1;1;1;;;;0;ac523de3-848e-44d4-a0ee-3a4a2e02df78;0;;30647;mestre;19/01/2021;joel.silvano;08/03/2022;0
F;TESTE.001FT;TESTE FELIPE TOTVS;"
SELECT FLANBAIXA.IDBAIXA FROM FLANBAIXA
LEFT JOIN FLANBAIXARATCCU ON FLANBAIXARATCCU.CODCOLIGADA = FLANBAIXA.CODCOLIGADA AND FLANBAIXARATCCU.IDLAN = FLANBAIXA.IDLAN AND FLANBAIXARATCCU.IDBAIXA = FLANBAIXA.IDBAIXA
INNER JOIN FLAN ON FLANBAIXA.IDLAN = FLAN.IDLAN
WHERE FLANBAIXARATCCU.IDLAN IS NULL AND CODTDO = 'SELETIVO'";325;;;;02/09/2021;lilian.buzetti;1;1;1;1;;;;0;6fb4ac53-ed39-408d-8c5e-8157b11d689e;0;;10416;totvs;07/07/2021;lilian.buzetti;02/09/2021;0
F;teste1;teste numero de dias;select * from ZSVOUCHERDESCONTO;31;;;;02/03/2021;mestre;1;1;1;1;;;;0;23c63b5e-00db-4187-88c6-c0a13732aed4;0;;27638;mestre;19/01/2021;mestre;02/03/2021;0
F;teste2;teste;"select * from flan where idlan IN (189673)
/*select * from flanbaixa where idbaixa in (437951,437952,437953)*/

/*select hatendimentobase.codstatus, hatendimentobase.* from hatendimentobase where codatendimento = 1850*/";222;;;;14/07/2022;marli.oliveira;1;1;1;1;;;;0;36cac358-16b5-48ca-bf51-f013deba1fa9;0;;24987;robson.canto;08/02/2022;marli.oliveira;14/07/2022;0
F;testeipl99;teste;"SELECT l.*
FROM SPSINSCAREAOFERTACOMPL

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO

INNER JOIN SPSOPCAOINSCRITO ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

LEFT JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

INNER JOIN  ZSVOUCHERDESCONTO ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 

WHERE  CAST( ZSVOUCHERDESCONTO.DATAVALFIM AS DATE) >= CAST(GETDATE () AS DATE)
AND  ((SCONTRATO.CODFILIAL IS NOT NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = ZSVOUCHERDESCONTO.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NULL) OR 
	  (ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL))
AND   (ZSVOUCHERDESCONTO.RA IS NULL OR ISNULL(SPARCELA.RA,0) = ZSVOUCHERDESCONTO.RA) 
AND   (ZSVOUCHERDESCONTO.CODCURSO IS NULL OR isnull(SHABILITACAOFILIAL.CODCURSO,'') = ZSVOUCHERDESCONTO.CODCURSO)
AND ZSVOUCHERDESCONTO.PERCDESCONTO = 100
AND L.PAGREC = 1
AND L.CODTDO = 'SELETIVO'
AND L.STATUSLAN = 0
AND   ((ZSVOUCHERDESCONTO.QUANTIDADE IS NULL) OR (ISNULL(ZSVOUCHERDESCONTO.QUANTIDADE,0) >= (

SELECT 
COUNT (ISNULL(FLAN.IDLAN,L.IDLAN)) TOTAL
FROM SPSINSCAREAOFERTACOMPL

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO

INNER JOIN SPSOPCAOINSCRITO ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO ON 
SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND 
SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

LEFT JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

INNER JOIN  ZSVOUCHERDESCONTO V ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = V.NUMEROVOUCHER 

WHERE ((SCONTRATO.CODFILIAL IS NOT NULL AND V.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = V.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND V.CODFILIAL IS NULL) OR 
	  (V.CODFILIAL IS NOT NULL))
AND   (V.RA IS NULL OR ISNULL(SPARCELA.RA,0) = V.RA) 
AND   (V.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = V.CODCURSO)
AND  ((SPARCELA.CODSERVICO IS NOT NULL AND V.CODSERVICO IS NOT NULL AND SPARCELA.CODSERVICO = V.CODSERVICO) OR
      (SPARCELA.CODSERVICO IS NULL AND V.CODSERVICO IS NULL) OR 
	  (V.CODSERVICO IS NOT NULL))
AND   (V.PARCELA IS NULL OR (ISNULL(SPARCELA.PARCELA,0) BETWEEN V.PARCELA AND V.PARCELAFIM))
AND   (ISNULL(V.QUANTIDADE,0) > 0)
AND   V.NUMEROVOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 
AND L.PAGREC = 1
AND L.CODTDO = 'SELETIVO'
AND L.STATUSLAN = 0
)))";5577;;;;27/07/2021;mestre;1;1;1;1;;;;0;5ff1db41-0cfd-4a9a-b517-ab3d1a7e3850;0;;-15373;mestre;27/07/2021;mestre;27/07/2021;0
F;testeipl999;testefrm;"/*select * from flan where idlan = 21944 and codcoligada = 1*/

select top 10 * from fsessaocaixa
order by  idsessao desc";124;;;;25/11/2021;robson.canto;1;1;1;1;;;;0;b130b61a-fa14-4f93-83f1-81ea36716d7d;0;;16117;mestre;27/07/2021;robson.canto;25/11/2021;0
F;TESTEPIX;Teste PIX;select cartaotid, data, Valor from fxcx nolock where cartaotid is not null and cartaooperadora = '12' and tipo = '5' and compensado = '0' and (stsconcilcartao is null or stsconcilcartao = '0');193;;;;14/04/2022;mario;1;1;1;1;;;;0;232af893-0c7b-4591-b28f-78cd8b2c91df;0;;-16568;mario;14/04/2022;mario;14/04/2022;0
F;testeRede;teste;select * from fn_dadostransacao(56);35;;;;26/10/2021;raphael.muzy;1;1;1;1;;;;0;5741dc48-e6b2-4a40-b465-4d5db5bb9fbe;0;;-8427;raphael.muzy;26/10/2021;raphael.muzy;26/10/2021;0
F;TVS.NUMERODOC;NUMERO DO DOCUMENTO;"SELECT FXCX.NUMERODOCUMENTO
FROM FLANBAIXA
INNER JOIN FXCX ON ( FLANBAIXA.CODCOLXCX = FXCX.CODCOLIGADA AND  FLANBAIXA.IDXCX = FXCX.IDXCX)
INNER JOIN FLAN ON (FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND FLANBAIXA.IDLAN = FLAN.IDLAN)
WHERE FLAN.IDLAN = :IDLAN1";263;;;;20/07/2021;lucas.ssantos;1;1;1;1;;;;0;197576e4-32b6-43f4-a9b6-52eae32bfd6b;0;;28993;lucas.ssantos;20/07/2021;lucas.ssantos;20/07/2021;0
F;Voucher;Voucher;"SET ANSI_WARNINGS off
SELECT 
	ZSVOUCHERDESCONTO.PERCOUVALOR TIPO , 
   	CASE 
		WHEN ZSVOUCHERDESCONTO.PERCOUVALOR = 'P' THEN 
			(L.VALORORIGINAL - L.VALORDESCONTO) * (ZSVOUCHERDESCONTO.PERCDESCONTO/100)
		ELSE 
			ZSVOUCHERDESCONTO.VALORDESCONTO
	END VL_DESCONTO
FROM SPSINSCAREAOFERTACOMPL WITH (NOLOCK)

INNER JOIN SPSINSCRICAOAREAOFERTADA WITH (NOLOCK) ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO

INNER JOIN SPSOPCAOINSCRITO WITH (NOLOCK) ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE WITH (NOLOCK) ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL WITH (NOLOCK)  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL WITH (NOLOCK) ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO WITH (NOLOCK) ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

LEFT JOIN SPARCELA WITH (NOLOCK) ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN WITH (NOLOCK) ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN WITH (NOLOCK) ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L WITH (NOLOCK) ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

INNER JOIN  ZSVOUCHERDESCONTO WITH (NOLOCK) ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 

WHERE  ISNULL(FLAN.CODCOLIGADA,L.CODCOLIGADA) =:frm_coligada
AND   ISNULL(FLAN.IDLAN,L.IDLAN) =:frm_idlan
AND   CAST( ZSVOUCHERDESCONTO.DATAVALFIM AS DATE) >= CAST(GETDATE () AS DATE)
AND  ((SCONTRATO.CODFILIAL IS NOT NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = ZSVOUCHERDESCONTO.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NULL) OR 
	  (ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL))
AND   (ZSVOUCHERDESCONTO.RA IS NULL OR ISNULL(SPARCELA.RA,0) = ZSVOUCHERDESCONTO.RA) 
AND   (ZSVOUCHERDESCONTO.CODCURSO IS NULL OR isnull(SHABILITACAOFILIAL.CODCURSO,'') = ZSVOUCHERDESCONTO.CODCURSO)

AND  ((SPARCELA.CODSERVICO IS NOT NULL AND ZSVOUCHERDESCONTO.CODSERVICO IS NOT NULL AND SPARCELA.CODSERVICO = ZSVOUCHERDESCONTO.CODSERVICO) OR
      (SPARCELA.CODSERVICO IS NULL AND ZSVOUCHERDESCONTO.CODSERVICO IS NULL) /*OR 
	  (ZSVOUCHERDESCONTO.CODSERVICO IS NOT NULL)*/)
AND   (ZSVOUCHERDESCONTO.PARCELA IS NULL OR (ISNULL(SPARCELA.PARCELA,1) BETWEEN ZSVOUCHERDESCONTO.PARCELA AND ZSVOUCHERDESCONTO.PARCELAFIM))

AND   ((ZSVOUCHERDESCONTO.QUANTIDADE IS NULL) OR (ISNULL(ZSVOUCHERDESCONTO.QUANTIDADE,0) >= (ISNULL(ZSVOUCHERDESCONTO.SALDO,0))))
";3636;;;;04/08/2021;mestre;1;1;1;1;;;;0;da6dc2b3-e4de-4932-b075-d7c5ee1f8b87;0;;-19999;mestre;23/02/2021;mestre;04/08/2021;0
F;Voucher.1;Voucher na tela boleto;"SELECT 
'Esse Boleto tem Cupom de desconto válido até o vencimento no valor de R$' DESCRICAO,
CASE WHEN ZSVOUCHERDESCONTO.PERCOUVALOR = 'P' THEN FLAN.VALORORIGINAL * (ZSVOUCHERDESCONTO.PERCDESCONTO/100) ELSE ZSVOUCHERDESCONTO.VALORDESCONTO END AS Voucher

FROM SPSINSCAREAOFERTACOMPL

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO

INNER JOIN SPSOPCAOINSCRITO ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL


LEFT JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

LEFT JOIN FLANBOLETO ON 
FLANBOLETO.IDLAN = FLAN.IDLAN AND 
FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA

INNER JOIN  ZSVOUCHERDESCONTO ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 

WHERE FLAN.CODCOLIGADA =:CODCOLIGADA
AND   FLANBOLETO.IDBOLETO =:IDBOLETO
AND   CAST( ZSVOUCHERDESCONTO.DATAVALFIM AS DATE) >= CAST(GETDATE () AS DATE)
AND  ((SCONTRATO.CODFILIAL IS NOT NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = ZSVOUCHERDESCONTO.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NULL) OR 
	  (ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL))
AND   (ZSVOUCHERDESCONTO.RA IS NULL OR ISNULL(SPARCELA.RA,0) = ZSVOUCHERDESCONTO.RA) 
AND   (ZSVOUCHERDESCONTO.CODCURSO IS NULL OR isnull(SHABILITACAOFILIAL.CODCURSO,'') = ZSVOUCHERDESCONTO.CODCURSO)
AND  ((SPARCELA.CODSERVICO IS NOT NULL AND ZSVOUCHERDESCONTO.CODSERVICO IS NOT NULL AND SPARCELA.CODSERVICO = ZSVOUCHERDESCONTO.CODSERVICO) OR
      (SPARCELA.CODSERVICO IS NULL AND ZSVOUCHERDESCONTO.CODSERVICO IS NULL) OR 
	  (ZSVOUCHERDESCONTO.CODSERVICO IS NOT NULL))
AND   (ZSVOUCHERDESCONTO.PARCELA IS NULL OR (ISNULL(SPARCELA.PARCELA,1) BETWEEN ZSVOUCHERDESCONTO.PARCELA AND ZSVOUCHERDESCONTO.PARCELAFIM))

AND   ((ZSVOUCHERDESCONTO.QUANTIDADE IS NULL) OR (ISNULL(ZSVOUCHERDESCONTO.QUANTIDADE,0) >= (

SELECT 
COUNT (ISNULL(FLAN.IDLAN,L.IDLAN)) TOTAL
FROM SPSINSCAREAOFERTACOMPL

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO


INNER JOIN SPSOPCAOINSCRITO ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO ON 
SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND 
SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

LEFT JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

INNER JOIN  ZSVOUCHERDESCONTO V ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = V.NUMEROVOUCHER 

WHERE ((SCONTRATO.CODFILIAL IS NOT NULL AND V.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = V.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND V.CODFILIAL IS NULL) OR 
	  (V.CODFILIAL IS NOT NULL))
AND   (V.RA IS NULL OR ISNULL(SPARCELA.RA,0) = V.RA) 
AND   (V.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = V.CODCURSO)
AND  ((SPARCELA.CODSERVICO IS NOT NULL AND V.CODSERVICO IS NOT NULL AND SPARCELA.CODSERVICO = V.CODSERVICO) OR
      (SPARCELA.CODSERVICO IS NULL AND V.CODSERVICO IS NULL) OR 
	  (V.CODSERVICO IS NOT NULL))
AND   (V.PARCELA IS NULL OR (ISNULL(SPARCELA.PARCELA,0) BETWEEN V.PARCELA AND V.PARCELAFIM))
AND   (ISNULL(V.QUANTIDADE,0) > 0)
AND   V.NUMEROVOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 
)))



/*FROM SPSINSCAREAOFERTACOMPL
INNER JOIN SPSINSCRICAOAREAOFERTADA ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL ON SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL and scontrato.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPARCELA.RA = SCONTRATO.RA AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SLAN ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
INNER JOIN FLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN FLANBOLETO ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN  ZSVOUCHERDESCONTO ON SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 

WHERE FLAN.CODCOLIGADA =:CODCOLIGADA
AND   FLANBOLETO.IDBOLETO =:IDBOLETO
AND   CAST( ZSVOUCHERDESCONTO.DATAVALFIM AS DATE) >= CAST(GETDATE () AS DATE)
AND   (ZSVOUCHERDESCONTO.CODFILIAL IS NULL OR SCONTRATO.CODFILIAL = ZSVOUCHERDESCONTO.CODFILIAL)
AND   (ZSVOUCHERDESCONTO.RA IS NULL OR SPARCELA.RA = ZSVOUCHERDESCONTO.RA) 
AND   (ZSVOUCHERDESCONTO.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = ZSVOUCHERDESCONTO.CODCURSO)
AND   (SPARCELA.CODSERVICO = ZSVOUCHERDESCONTO.CODSERVICO OR ZSVOUCHERDESCONTO.CODSERVICO IS NULL)
AND   (ZSVOUCHERDESCONTO.PARCELA IS NULL OR (SPARCELA.PARCELA BETWEEN ZSVOUCHERDESCONTO.PARCELA AND ZSVOUCHERDESCONTO.PARCELAFIM))
AND   ((ZSVOUCHERDESCONTO.QUANTIDADE IS NULL) OR (ISNULL(ZSVOUCHERDESCONTO.QUANTIDADE,0) >= (

SELECT 
COUNT (FLAN.IDLAN) TOTAL
FROM SPSINSCAREAOFERTACOMPL
INNER JOIN SPSINSCRICAOAREAOFERTADA ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL ON SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL and scontrato.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPARCELA.RA = SCONTRATO.RA AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SLAN ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
INNER JOIN FLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN  ZSVOUCHERDESCONTO V ON SPSINSCAREAOFERTACOMPL.VOUCHER = V.NUMEROVOUCHER 

WHERE (V.CODFILIAL IS NULL OR SCONTRATO.CODFILIAL = V.CODFILIAL)
AND   (V.RA IS NULL OR SPARCELA.RA = V.RA) 
AND   (V.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = V.CODCURSO)
AND   (SPARCELA.CODSERVICO = V.CODSERVICO OR V.CODSERVICO IS NULL)
AND   (V.PARCELA IS NULL OR (SPARCELA.PARCELA BETWEEN V.PARCELA AND V.PARCELAFIM))
AND   (ISNULL(V.QUANTIDADE,0) > 0)
AND   V.NUMEROVOUCHER =  ZSVOUCHERDESCONTO.NUMEROVOUCHER 
)
))*/";10296;;;;18/05/2021;mestre;1;1;1;1;;;;0;da6dc2b3-e4de-4932-b075-d7c5ee1f8b87;0;;-16493;mestre;01/04/2021;mestre;18/05/2021;0
F;Voucher.2;Voucher no comprovante de inscrição;"SELECT 
0 VALOR,
CASE 
	WHEN VOUCHER IS NULL THEN ''
	ELSE 'INVALIDO' END VALIDADE,
SPSINSCAREAOFERTACOMPL.VOUCHER


FROM SPSINSCAREAOFERTACOMPL
WHERE NUMEROINSCRICAO = :NUMEROINSCRICAO
AND IDPS = :IDPS
AND VOUCHER NOT IN (
SELECT 


ZSVOUCHERDESCONTO.NUMEROVOUCHER AS VOUCHER


FROM SPSINSCAREAOFERTACOMPL
INNER JOIN SPSINSCRICAOAREAOFERTADA ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL ON SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL and scontrato.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPARCELA.RA = SCONTRATO.RA AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SLAN ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
INNER JOIN FLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN FLANBOLETO ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN  ZSVOUCHERDESCONTO ON SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 

WHERE SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = :NUMEROINSCRICAO
AND   SPSINSCRICAOAREAOFERTADA.IDPS = :IDPS
AND   CAST( ZSVOUCHERDESCONTO.DATAVALFIM AS DATE) >= CAST(GETDATE () AS DATE)
AND   (ZSVOUCHERDESCONTO.CODFILIAL IS NULL OR SCONTRATO.CODFILIAL = ZSVOUCHERDESCONTO.CODFILIAL)
AND   (ZSVOUCHERDESCONTO.RA IS NULL OR SPARCELA.RA = ZSVOUCHERDESCONTO.RA) 
AND   (ZSVOUCHERDESCONTO.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = ZSVOUCHERDESCONTO.CODCURSO)
AND   (SPARCELA.CODSERVICO = ZSVOUCHERDESCONTO.CODSERVICO OR ZSVOUCHERDESCONTO.CODSERVICO IS NULL)
AND   (ZSVOUCHERDESCONTO.PARCELA IS NULL OR (SPARCELA.PARCELA BETWEEN ZSVOUCHERDESCONTO.PARCELA AND ZSVOUCHERDESCONTO.PARCELAFIM))
AND   ((ZSVOUCHERDESCONTO.QUANTIDADE IS NULL) OR (ISNULL(ZSVOUCHERDESCONTO.QUANTIDADE,0) >= (

SELECT 
COUNT (FLAN.IDLAN) TOTAL
FROM SPSINSCAREAOFERTACOMPL
INNER JOIN SPSINSCRICAOAREAOFERTADA ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL ON SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL and scontrato.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPARCELA.RA = SCONTRATO.RA AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SLAN ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
INNER JOIN FLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN  ZSVOUCHERDESCONTO V ON SPSINSCAREAOFERTACOMPL.VOUCHER = V.NUMEROVOUCHER 

WHERE (V.CODFILIAL IS NULL OR SCONTRATO.CODFILIAL = V.CODFILIAL)
AND   (V.RA IS NULL OR SPARCELA.RA = V.RA) 
AND   (V.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = V.CODCURSO)
AND   (SPARCELA.CODSERVICO = V.CODSERVICO OR V.CODSERVICO IS NULL)
AND   (V.PARCELA IS NULL OR (SPARCELA.PARCELA BETWEEN V.PARCELA AND V.PARCELAFIM))
AND   (ISNULL(V.QUANTIDADE,0) > 0)
AND   V.NUMEROVOUCHER =  ZSVOUCHERDESCONTO.NUMEROVOUCHER 
)
)))

UNION ALL

SELECT 


CASE WHEN ZSVOUCHERDESCONTO.PERCOUVALOR = 'P' THEN FLAN.VALORORIGINAL * (ZSVOUCHERDESCONTO.PERCDESCONTO/100) ELSE ZSVOUCHERDESCONTO.VALORDESCONTO END AS VALOR,
CASE WHEN ZSVOUCHERDESCONTO.NUMEROVOUCHER IS NOT NULL THEN 'VALIDO' ELSE 'INVALIDO'  END AS VALIDADE,
ZSVOUCHERDESCONTO.NUMEROVOUCHER AS VOUCHER


FROM SPSINSCAREAOFERTACOMPL
INNER JOIN SPSINSCRICAOAREAOFERTADA ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL ON SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL and scontrato.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPARCELA.RA = SCONTRATO.RA AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SLAN ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
INNER JOIN FLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN FLANBOLETO ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN  ZSVOUCHERDESCONTO ON SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 

WHERE SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO =:NUMEROINSCRICAO
AND   SPSINSCRICAOAREAOFERTADA.IDPS =:IDPS
AND   CAST( ZSVOUCHERDESCONTO.DATAVALFIM AS DATE) >= CAST(GETDATE () AS DATE)
AND   (ZSVOUCHERDESCONTO.CODFILIAL IS NULL OR SCONTRATO.CODFILIAL = ZSVOUCHERDESCONTO.CODFILIAL)
AND   (ZSVOUCHERDESCONTO.RA IS NULL OR SPARCELA.RA = ZSVOUCHERDESCONTO.RA) 
AND   (ZSVOUCHERDESCONTO.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = ZSVOUCHERDESCONTO.CODCURSO)
AND   (SPARCELA.CODSERVICO = ZSVOUCHERDESCONTO.CODSERVICO OR ZSVOUCHERDESCONTO.CODSERVICO IS NULL)
AND   (ZSVOUCHERDESCONTO.PARCELA IS NULL OR (SPARCELA.PARCELA BETWEEN ZSVOUCHERDESCONTO.PARCELA AND ZSVOUCHERDESCONTO.PARCELAFIM))
AND   ((ZSVOUCHERDESCONTO.QUANTIDADE IS NULL) OR (ISNULL(ZSVOUCHERDESCONTO.QUANTIDADE,0) >= (

SELECT 
COUNT (FLAN.IDLAN) TOTAL
FROM SPSINSCAREAOFERTACOMPL
INNER JOIN SPSINSCRICAOAREAOFERTADA ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL ON SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL and scontrato.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPARCELA.RA = SCONTRATO.RA AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SLAN ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
INNER JOIN FLAN ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN  ZSVOUCHERDESCONTO V ON SPSINSCAREAOFERTACOMPL.VOUCHER = V.NUMEROVOUCHER 

WHERE (V.CODFILIAL IS NULL OR SCONTRATO.CODFILIAL = V.CODFILIAL)
AND   (V.RA IS NULL OR SPARCELA.RA = V.RA) 
AND   (V.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = V.CODCURSO)
AND   (SPARCELA.CODSERVICO = V.CODSERVICO OR V.CODSERVICO IS NULL)
AND   (V.PARCELA IS NULL OR (SPARCELA.PARCELA BETWEEN V.PARCELA AND V.PARCELAFIM))
AND   (ISNULL(V.QUANTIDADE,0) > 0)
AND   V.NUMEROVOUCHER =  ZSVOUCHERDESCONTO.NUMEROVOUCHER 
)
))
";8786;;;;01/04/2021;lucas.ssantos;1;1;1;1;;;;0;da6dc2b3-e4de-4932-b075-d7c5ee1f8b87;0;;-18023;mestre;01/04/2021;lucas.ssantos;01/04/2021;0
F;Voucher.3;Baixar inscrições valor 0;"
SELECT 
/*ISNULL(CASE WHEN ZSVOUCHERDESCONTO.PERCOUVALOR = 'P' THEN ISNULL(FLAN.VALORORIGINAL,L.VALORORIGINAL) * (ZSVOUCHERDESCONTO.PERCDESCONTO/100) ELSE ZSVOUCHERDESCONTO.VALORDESCONTO END,0) AS Voucher*/
isnull(l.idlan,1)
FROM SPSINSCAREAOFERTACOMPL

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO

INNER JOIN SPSOPCAOINSCRITO ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL


LEFT JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

INNER JOIN  ZSVOUCHERDESCONTO ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 

WHERE  CAST( ZSVOUCHERDESCONTO.DATAVALFIM AS DATE) >= CAST(GETDATE () AS DATE)
AND  ((SCONTRATO.CODFILIAL IS NOT NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = ZSVOUCHERDESCONTO.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND ZSVOUCHERDESCONTO.CODFILIAL IS NULL) OR 
	  (ZSVOUCHERDESCONTO.CODFILIAL IS NOT NULL))
AND   (ZSVOUCHERDESCONTO.RA IS NULL OR ISNULL(SPARCELA.RA,0) = ZSVOUCHERDESCONTO.RA) 
AND   (ZSVOUCHERDESCONTO.CODCURSO IS NULL OR isnull(SHABILITACAOFILIAL.CODCURSO,'') = ZSVOUCHERDESCONTO.CODCURSO)
/*AND  ((SPARCELA.CODSERVICO IS NOT NULL AND ZSVOUCHERDESCONTO.CODSERVICO IS NOT NULL AND SPARCELA.CODSERVICO = ZSVOUCHERDESCONTO.CODSERVICO) OR
      (SPARCELA.CODSERVICO IS NULL AND ZSVOUCHERDESCONTO.CODSERVICO IS NULL) OR 
	  (ZSVOUCHERDESCONTO.CODSERVICO IS NOT NULL))
AND   (ZSVOUCHERDESCONTO.PARCELA IS NULL OR (ISNULL(SPARCELA.PARCELA,1) BETWEEN ZSVOUCHERDESCONTO.PARCELA AND ZSVOUCHERDESCONTO.PARCELAFIM))
*/
AND ZSVOUCHERDESCONTO.PERCDESCONTO = 100
AND   ((ZSVOUCHERDESCONTO.QUANTIDADE IS NULL) OR (ISNULL(ZSVOUCHERDESCONTO.QUANTIDADE,0) >= (

SELECT 
COUNT (ISNULL(FLAN.IDLAN,L.IDLAN)) TOTAL
FROM SPSINSCAREAOFERTACOMPL

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO


INNER JOIN SPSOPCAOINSCRITO ON  
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO

INNER JOIN SPSAREAINTERESSE ON 
SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND 
SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL

INNER JOIN SHABILITACAOFILIAL  ON 
SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND 
SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 

LEFT JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND 
SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND 
SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

LEFT JOIN SCONTRATO ON 
SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SCONTRATO.RA = SMATRICPL.RA AND 
SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL

LEFT JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

LEFT JOIN SLAN ON 
SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
SLAN.IDPARCELA = SPARCELA.IDPARCELA

LEFT JOIN FLAN ON 
SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND 
SLAN.IDLAN = FLAN.IDLAN

LEFT JOIN FLAN L ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN

INNER JOIN  ZSVOUCHERDESCONTO V ON 
SPSINSCAREAOFERTACOMPL.VOUCHER = V.NUMEROVOUCHER 

WHERE ((SCONTRATO.CODFILIAL IS NOT NULL AND V.CODFILIAL IS NOT NULL AND SCONTRATO.CODFILIAL = V.CODFILIAL) OR
      (SCONTRATO.CODFILIAL IS NULL AND V.CODFILIAL IS NULL) OR 
	  (V.CODFILIAL IS NOT NULL))
AND   (V.RA IS NULL OR ISNULL(SPARCELA.RA,0) = V.RA) 
AND   (V.CODCURSO IS NULL OR SHABILITACAOFILIAL.CODCURSO = V.CODCURSO)
AND  ((SPARCELA.CODSERVICO IS NOT NULL AND V.CODSERVICO IS NOT NULL AND SPARCELA.CODSERVICO = V.CODSERVICO) OR
      (SPARCELA.CODSERVICO IS NULL AND V.CODSERVICO IS NULL) OR 
	  (V.CODSERVICO IS NOT NULL))
AND   (V.PARCELA IS NULL OR (ISNULL(SPARCELA.PARCELA,0) BETWEEN V.PARCELA AND V.PARCELAFIM))
AND   (ISNULL(V.QUANTIDADE,0) > 0)
AND   V.NUMEROVOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 
)))


";6087;;;;27/05/2021;mestre;1;1;1;1;;;;0;b79c1ef5-6677-4557-b449-0e17a537ec10;0;;-21648;mestre;27/05/2021;mestre;27/05/2021;0
F;YY;SELECTS DIVERSOS;SELECT * FROM FLAN WHERE IDLAN = 70867;38;;;;18/10/2021;carla.ozelo;1;1;1;1;;;;0;eeceada8-b03e-4467-8c8a-5028858aa54f;0;;-3718;carla.ozelo;18/10/2021;carla.ozelo;18/10/2021;0
F;YYY;SELECTS DIVERSOS;"SELECT IDLAN FROM FLANBAIXA WHERE IDLAN IN (
9565,
12954,
12955,
13975,
14654,
15150,
15238,
15326,
16325,
16426,
17193,
17275,
17383,
17481,
17731,
17805,
18057,
18253,
18382,
18403,
18595,
19187,
19339,
19455,
19657,
19658,
20478,
22405,
22552,
22674,
22742,
22832,
22842,
23095,
23130,
23723,
24501,
24571,
25380,
25422,
26236,
26807,
27108,
27135,
28485,
28511,
29889,
30002,
30016,
30240,
30513,
30585,
30865,
30960,
31091,
31426,
31555,
31571,
31695,
32155,
32260,
32711,
33026,
33152,
51364,
55943,
55973,
61364,
91120)";595;;;;21/10/2021;carla.ozelo;1;1;1;1;;;;0;041684e8-6ee8-4e4e-bdd2-4ad528ec6c4d;0;;-23322;carla.ozelo;18/10/2021;carla.ozelo;21/10/2021;0
F;Z;SELECTS DIVERSOS contabilz apropriacao TAXAS;"SELECT idlan from flan where idlan in
(99092 ,
99092 ,
99090 ,
99050 ,
99022 ,
97366 ,
96892 ,
96458 ,
96458 ,
96433 ,
96176 ,
95307 ,
95117 ,
95082 ,
94624 ,
93561 ,
93539 ,
93531 ,
93355 ,
92631 ,
91938 ,
91936 ,
91725 ,
90468 ,
90316 ,
89842 ,
8848  ,
8847  ,
88010 ,
87372 ,
86856 ,
86855 ,
8383  ,
8382  ,
8278  ,
8277  ,
82360 ,
82349 ,
82314 ,
82184 ,
82135 ,
81796 ,
81795 ,
81777 ,
81712 ,
81702 ,
80889 ,
80380 ,
7917  ,
78986 ,
78900 ,
72083 ,
72082 ,
72003 ,
72002 ,
71903 ,
71837 ,
70970 ,
70888 ,
70516 ,
70345 ,
70124 ,
69964 ,
69845 ,
69807 ,
69771 ,
69770 ,
69694 ,
69693 ,
69594 ,
69528 ,
6939  ,
6938  ,
69232 ,
69131 ,
68950 ,
68264 ,
67884 ,
67870 ,
67711 ,
67489 ,
66703 ,
66658 ,
66658 ,
66581 ,
66390 ,
66106 ,
66099 ,
6464  ,
61575 ,
60954 ,
60592 ,
60569 ,
60279 ,
60008 ,
59720 ,
53932 ,
53148 ,
52881 ,
51468 ,
50887 ,
50574 ,
50573 ,
4980  ,
46139 ,
44268 ,
44266 ,
41112 ,
40882 ,
38970 ,
38969 ,
38968 ,
38967 ,
37171 ,
37022 ,
3635  ,
3634  ,
3598  ,
3596  ,
34701 ,
34700 ,
34067 ,
34066 ,
34065 ,
34064 ,
34016 ,
34015 ,
33968 ,
3396  ,
3392  ,
3389  ,
3387  ,
3386  ,
3385  ,
3383  ,
3382  ,
3379  ,
33419 ,
32454 ,
31423 ,
31422 ,
30171 ,
30170 ,
29034 ,
29033 ,
28970 ,
28969 ,
28818 ,
28818 ,
28463 ,
28462 ,
27717 ,
27716 ,
27158 ,
27157 ,
27107 ,
27106 ,
26716 ,
26632 ,
26631 ,
26481 ,
26480 ,
26479 ,
26478 ,
26133 ,
26132 ,
25930 ,
25929 ,
25279 ,
25278 ,
25277 ,
25276 ,
25275 ,
25274 ,
25273 ,
25272 ,
25271 ,
25270 ,
25269 ,
2507  ,
16258 ,
13792 ,
13791 ,
13524 ,
13523 ,
11915 ,
11914 ,
11800 ,
11799 ,
11791 ,
11790 ,
11638 ,
11637 ,
11578 ,
11577 ,
11462 ,
11461 ,
11229 ,
11227 ,
111900,
111599,
111077,
110288,
108476,
10809 ,
10808 ,
106694,
106649,
104458,
104457,
104456,
104215,
104209,
104075,
103612,
102920,
102383,
102381,
102069,
101975,
101919,
101918,
101763,
101752,
101315)
";2065;;;;15/02/2022;carla.ozelo;1;1;1;1;;;;0;e88acffd-f6ef-4bcd-9b4c-f2f73b28e1ca;0;;-16832;carla.ozelo;18/10/2021;carla.ozelo;15/02/2022;0
F;ZZ;SELECTS DIVERSOS Taxas Pensionato;"SELECT l.*
      
FROM   FLAN L
WHERE  l.IDLAN = 147871";58;;;;15/02/2022;carla.ozelo;1;1;1;1;;;;0;49101d0d-0088-4f46-a775-f7585eac19da;0;;-12073;carla.ozelo;14/10/2021;carla.ozelo;15/02/2022;0
F;ZZZ;Selects Diversos;select IDLAN from flan where idlan in (304488,304487,302732,331511,329837);74;;;;04/11/2022;carla.ozelo;1;1;1;1;;;;0;424cf83b-6ce4-47ce-9ec0-18969ce9692c;0;;13755;mestre;01/03/2021;carla.ozelo;04/11/2022;0
F;ZZZZ;Selects Diversos;"SELECT CODFILIAL, *
FROM   FLAN
WHERE  MESDECOMPETENCIA >= '20210901'
       AND MESDECOMPETENCIA <= '20210930' 
AND CODFILIAL = 3";134;;;;11/03/2022;marli.oliveira;1;1;1;1;;;;0;30b4de00-85f3-4268-96b0-79b8c1bf183b;0;;8872;carla.ozelo;02/12/2021;marli.oliveira;11/03/2022;0
G;1;Valida parametros internos;select * from FPARAM WHERE ID IN ('-150', '-149', '-148', '-147', '-146', '-145', '-144');89;;;;11/05/2021;mestre;1;1;1;1;;;;0;e79b0df1-cdfb-4baf-b295-c57207ad78e1;0;;13290;mestre;11/05/2021;mestre;11/05/2021;0
G;2;Valida filial do PS;select CODFILIAL, CODFILIALLAN, * from SPSPROCESSOSELETIVO;58;;;;11/05/2021;mestre;1;1;1;1;;;;0;93b2e79d-cce8-493b-ac0a-6fb640d6044c;0;;-29853;mestre;11/05/2021;mestre;11/05/2021;0
G;AcessoPerfil;Acesso por Perfil;"select p.*, s.NOMESISTEMA from GUSRPERFIL p inner join GSISTEMA s on s.CODSISTEMA=p.CODSISTEMA
/*where CODPERFIL=:CODPERFIL*/";126;;;;13/05/2022;maik.souza;1;1;1;1;;;;0;78454984-095b-4e45-b6e3-89ab00d87d78;0;;20294;mestre;17/08/2021;maik.souza;13/05/2022;0
G;Alunos2022/1;Alunos Cursando em 2022/1 e 2022/1M;"Select 
	* 
from 
	v_Unasp_SMATRICPL 
where 
	CODPERLET in ('2022/1','2022/1M') 
	and NomStatus='Cursando'";112;;;;11/01/2022;isaldo;1;1;1;1;;;;0;09d93d62-c60d-45ab-b768-dcc24dc96f2e;0;;25026;isaldo;11/01/2022;isaldo;11/01/2022;0
G;Cubo.0002;Cubo - Inadimplencia;"SELECT
  GCOLIGADA.NOMEFANTASIA AS COLIGADA,
  GFILIAL.NOMEFANTASIA AS FILIAL,
  STIPOCURSO.NOME AS NIVEL_ENSINO,  
  SCURSO.NOME AS CURSO,
  SHABILITACAO.NOME AS HABILITACAO,
  STURNO.NOME AS TURNO,    
  SPLETIVO.CODPERLET AS PLETIVO,
  SSTATUS.DESCRICAO AS SITUACAO,  
  FCFO.NOMEFANTASIA CLIENTE,  
  MONTH(FLAN.DATAVENCIMENTO) MES,
  FLAN.VALORORIGINAL TOTAL
FROM 
  FLAN (NOLOCK),
  SLAN (NOLOCK),
  SPARCELA (NOLOCK),
  SCONTRATO  (NOLOCK),
  SMATRICPL (NOLOCK),
  SHABILITACAO (NOLOCK),
  SHABILITACAOALUNO (NOLOCK),
  SHABILITACAOFILIAL (NOLOCK),
  SCURSO (NOLOCK),
  FCFO (NOLOCK),
  STURNO (NOLOCK),
  SPLETIVO (NOLOCK),
  GFILIAL (NOLOCK),
  GCOLIGADA (NOLOCK),
  STIPOCURSO (NOLOCK),
  SSTATUS (NOLOCK)
WHERE
  GCOLIGADA.CODCOLIGADA = FLAN.CODCOLIGADA AND  
  FLAN.CODCOLCFO = FCFO.CODCOLIGADA AND
  FLAN.CODCFO = FCFO.CODCFO AND
  FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
  FLAN.IDLAN = SLAN.IDLAN AND
  SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
  SLAN.IDPARCELA = SPARCELA.IDPARCELA AND
  SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
  SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
  SPARCELA.IDPERLET    = SCONTRATO.IDPERLET AND 
  SPARCELA.RA          = SCONTRATO.RA AND
  SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
  SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
  SCONTRATO.IDPERLET            = SMATRICPL.IDPERLET AND 
  SCONTRATO.RA                  = SMATRICPL.RA AND
  SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
  SMATRICPL.RA                  = SHABILITACAOALUNO.RA AND
  SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
  SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND  
  STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO AND
  SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
  SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND
  SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND
  SCONTRATO.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND
  SCONTRATO.IDPERLET = SPLETIVO.IDPERLET AND
  SHABILITACAOFILIAL.CODCOLIGADA = GFILIAL.CODCOLIGADA AND
  SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL AND
  STIPOCURSO.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  STIPOCURSO.CODTIPOCURSO = SCURSO.CODTIPOCURSO AND
  SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA AND
  SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS AND
  FLAN.STATUSLAN = 0 AND
  FLAN.DATAVENCIMENTO < GETDATE()";2727;;;;11/08/2021;maycon;1;1;1;1;;;;0;;;12.1;-21099;maycon;11/08/2021;maycon;11/08/2021;
G;Cubo.003;Controle Vagas (Pilates);"SELECT 
CASE WHEN SHORARIO.DIASEMANA = 2 THEN '1SEGUNDA' 
	 WHEN SHORARIO.DIASEMANA = 3 THEN '2TERÇA'
	 WHEN SHORARIO.DIASEMANA = 4 THEN '3QUARTA'
	 WHEN SHORARIO.DIASEMANA = 5 THEN '4QUINTA'
	 WHEN SHORARIO.DIASEMANA = 6 THEN '5SEXTA'
	 WHEN SHORARIO.DIASEMANA = 7 THEN '6SABADO'
	 WHEN SHORARIO.DIASEMANA = 1 THEN '7DOMINGO' END AS DIASEMANA,
SHORARIO.HORAINICIAL + '/' + SHORARIO.HORAFINAL AS HORARIO ,
COUNT(SMATRICULA.RA) AS MATRICULAS,
STURMADISC.MAXALUNOS
FROM STURMADISC
INNER JOIN SHABILITACAOFILIAL ON STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SHORARIOTURMA ON STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SHORARIO ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR
LEFT JOIN SMATRICULA ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
WHERE  
SHORARIOTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
SHORARIOTURMA.IDTURMADISC = STURMADISC.IDTURMADISC AND 
STURMADISC.CODFILIAL = 1 AND
SHABILITACAOFILIAL.CODCURSO = '1' AND 
SHABILITACAOFILIAL.CODTIPOCURSO = '3' 


GROUP BY STURMADISC.MAXALUNOS,SHORARIO.DIASEMANA,SHORARIO.HORAFINAL,SHORARIO.HORAINICIAL";1384;;;;17/02/2021;mestre;1;1;1;1;;;;0;96927624-e468-4203-b58f-f2f3a32b918c;0;;-4437;mestre;17/02/2021;mestre;17/02/2021;0
G;Cubo.004;Número de Créditos;"SELECT SCURSO.NOME                                                    [Curso],
       SCURSO.CODCURSO                                                [Codcurso],
       SGRADE.DESCRICAO                                               [Matriz],
       SGRADE.CODGRADE,
       STURNO.NOME                                                    TURNO,
       SDISCIPLINA.CODDISC                                            [Cod. disc],
       SDISCIPLINA.NOME                                               [Disciplina],
       SDISCGRADE.NUMCREDITOSCOB                                      [Credito Cobrança],
       SDISCIPLINA.NUMCREDITOS                                        [Credito Academico],
       SFAIXACRED.VALCRED                                             [Valor Credito],
       SFAIXACRED.VALCRED * SDISCGRADE.NUMCREDITOSCOB                 AS [Valor disciplina],
       :Parcelas                                                      [Numero de parcelas],
       ( SFAIXACRED.VALCRED * SDISCGRADE.NUMCREDITOSCOB ) / :Parcelas [Valor parcela],
       GFILIAL.NOMEFANTASIA                                           [Campus],
       SPLETIVO.CODPERLET,
       SPERIODO.CODPERIODO                                            PERIODO
FROM   SHABILITACAOFILIAL
       INNER JOIN STURNO
               ON STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
                  AND SHABILITACAOFILIAL.CODFILIAL = STURNO.codfilial
                  AND SHABILITACAOFILIAL.CODTIPOCURSO = STURNO.CODTIPOCURSO
       INNER JOIN SHABILITACAOFILIALPL
               ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
       INNER JOIN SGRADE
               ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                  AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
                  AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
       INNER JOIN SDISCGRADE
               ON SDISCGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                  AND SDISCGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
                  AND SDISCGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
       INNER JOIN SPERIODO
               ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
                  AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO
                  AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
                  AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE
                  AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
       INNER JOIN SCURSO
               ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
       INNER JOIN SDISCIPLINA
               ON SDISCIPLINA.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = SDISCGRADE.CODDISC
       INNER JOIN SPLETIVO
               ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
       LEFT JOIN SFAIXACRED
              ON SFAIXACRED.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                 AND SFAIXACRED.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                 AND SFAIXACRED.IDPERLET = SPLETIVO.IDPERLET
       INNER JOIN GFILIAL
               ON SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL
WHERE  SPERIODO.CODPERIODO <> 0
       AND SPLETIVO.CODPERLET LIKE '%' + :PL + '%'

UNION ALL
SELECT C.NOME                                                      [Curso],
       c.CODCURSO                                                  [Codcurso],
       SGRADE.DESCRICAO                                            [Matriz],
       SGRADE.CODGRADE,
       STURNO.NOME                                                 TURNO,
       ''                                                          [Cod. disc],
       SGRUPOOPTELET.NOME                                          [Disciplina],
       maxCred.NUMCREDITOSCOB                                      [Credito Cobrança],
       maxCred.NUMCREDITOSCOB                                      [Credito Academico],
       SFAIXACRED.VALCRED                                          [Valor Credito],
       SFAIXACRED.VALCRED * maxCred.NUMCREDITOSCOB                 [Valor disciplina],
       :Parcelas                                                   [Numero de parcelas],
       ( SFAIXACRED.VALCRED * maxCred.NUMCREDITOSCOB ) / :Parcelas [Valor parcela],
       GFILIAL.NOMEFANTASIA                                        [Campus],
       SPLETIVO.CODPERLET,
       SGRUPOOPTELET.CODPERIODO                                    PERIODO
FROM   SGRUPOOPTELET
       INNER JOIN SCURSO C
               ON SGRUPOOPTELET.CODCOLIGADA = C.CODCOLIGADA
                  AND SGRUPOOPTELET.CODCURSO = C.CODCURSO
       INNER JOIN SHABILITACAO
               ON SHABILITACAO.CODCOLIGADA = C.CODCOLIGADA
                  AND SHABILITACAO.CODCURSO = C.CODCURSO
       INNER JOIN SGRADE
               ON SGRUPOOPTELET.CODCOLIGADA = SGRADE.CODCOLIGADA
                  AND SGRUPOOPTELET.CODGRADE = SGRADE.CODGRADE
                  AND SGRUPOOPTELET.CODCURSO = SGRADE.CODCURSO
                  AND SGRUPOOPTELET.CODHABILITACAO = SGRADE.CODHABILITACAO
       INNER JOIN SHABILITACAOFILIAL
               ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
                  AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
                  AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
                  AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE
       INNER JOIN STURNO
               ON STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
                  AND SHABILITACAOFILIAL.CODFILIAL = STURNO.codfilial
                  AND SHABILITACAOFILIAL.CODTIPOCURSO = STURNO.CODTIPOCURSO
       INNER JOIN SHABILITACAOFILIALPL
               ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                  AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
       INNER JOIN GFILIAL
               ON SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL
       INNER JOIN SPLETIVO
               ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
       LEFT JOIN SFAIXACRED
              ON SFAIXACRED.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                 AND SFAIXACRED.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                 AND SFAIXACRED.IDPERLET = SPLETIVO.IDPERLET
       INNER JOIN (	SELECT goe.IDGRUPO, DG.CODGRADE, goe.CODPERIODO,
							Max(dg.NUMCREDITOSCOB) NUMCREDITOSCOB
					FROM   
							SGRUPOOPTELET goe
							inner join SDISCGRUPOOPTELET DGOE on DGOE.CODCOLIGADA = goe.CODCOLIGADA and DGOE.CODCURSO = goe.CODCURSO and dgoe.CODHABILITACAO = goe.CODHABILITACAO and dgoe.CODGRADE = goe.CODGRADE and goe.IDGRUPO = dgoe.IDGRUPO
							INNER JOIN SDISCGRADE DG
									ON DG.CODGRADE = DGOE.CODGRADE
										AND DG.CODDISC = DGOE.CODDISC
					GROUP  BY goe.IDGRUPO, DG.CODGRADE, goe.CODPERIODO
					) maxCred
               ON maxCred.IDGRUPO = SGRUPOOPTELET.IDGRUPO and maxCred.CODPERIODO = SGRUPOOPTELET.CODPERIODO and maxCred.CODGRADE = SGRADE.CODGRADE
WHERE  
	exists(Select 1 from SDISCGRUPOOPTELET dgoe 
				Where dgoe.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA 
				and dgoe.CODCURSO = SGRUPOOPTELET.CODCURSO 
				and dgoe.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO  
				and dgoe.CODGRADE = SGRUPOOPTELET.CODGRADE
				and dgoe.IDGRUPO = SGRUPOOPTELET.IDGRUPO)
	and
	SGRUPOOPTELET.CODPERIODO <> 0
       AND SPLETIVO.CODPERLET LIKE '%' + :PL + '%' 

";7911;;;;23/03/2022;isaldo;1;1;1;1;;;;0;d5d09262-53e6-4903-a700-730cab927aaa;0;;19187;mestre;17/03/2021;isaldo;23/03/2022;0
G;DEMO.076;Relação Candidatos x Vaga;"SELECT SPSAREAINTERESSE.NOME,
       CAST(
	      CAST(COUNT(*) AS DECIMAL(10,2)) / 
	      CAST(SPSAREAOFERTADA.NUMEROVAGAS AS DECIMAL(10,2)) AS DECIMAL(10,2)
	   ) CANDIDATOSPORVAGA
FROM SPSINSCRICAOAREAOFERTADA  WITH(NOLOCK/*AZURE*/),
     SPSOPCAOINSCRITO  WITH(NOLOCK/*AZURE*/),
     SPSAREAOFERTADA  WITH(NOLOCK/*AZURE*/),
     SPSAREAINTERESSE  WITH(NOLOCK/*AZURE*/) 
WHERE SPSINSCRICAOAREAOFERTADA.IDPS = :IDPS
      AND SPSINSCRICAOAREAOFERTADA.STATUS <> 8
      AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
      AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
      AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
      AND SPSINSCRICAOAREAOFERTADA.CODPESSOA = SPSOPCAOINSCRITO.CODPESSOA
      AND SPSOPCAOINSCRITO.NUMEROOPCAO = 1
      AND SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
      AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
      AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
      AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
GROUP BY SPSAREAINTERESSE.IDAREAINTERESSE,
	 SPSAREAINTERESSE.NOME,
	 SPSAREAOFERTADA.NUMEROVAGAS
ORDER BY CANDIDATOSPORVAGA";1236;;;;14/05/2021;mestre;1;1;1;1;;;;0;2528ab6e-4017-4c08-a261-3472c5ba8483;;;-30234;mestre;14/05/2021;mestre;14/05/2021;
G;DEMO.077;TOTAL DE INSCRITOS EM PS;"SELECT COUNT(*)
FROM SPSINSCRICAOAREAOFERTADA  WITH(NOLOCK/*AZURE*/)
WHERE IDPS = :IDPS
      AND STATUS <> 8";112;;;;14/05/2021;mestre;1;1;1;1;;;;0;7f4fe388-585f-4eda-8f66-a4a482637856;;;-1581;mestre;14/05/2021;mestre;14/05/2021;
G;DEMO.079;PS: PREVISTO X REALIZADO POR ÁREA OFERTADA;"SELECT SPSAREAINTERESSE.NOME,
       SUM( CASE WHEN FLAN.STATUSLAN = 1 THEN SPSINSCRICAOAREAOFERTADA.VALORINSCRICAO - SPSINSCRICAOAREAOFERTADA.VALORDESCONTO ELSE 0 END) AS REC_REALIZADAS,
	   SUM( CASE WHEN SPSOPCAOINSCRITO.NUMEROOPCAO = 1 THEN SPSINSCRICAOAREAOFERTADA.VALORINSCRICAO - SPSINSCRICAOAREAOFERTADA.VALORDESCONTO ELSE 0 END) AS REC_PREVISTAS,
	   (SUM( CASE WHEN FLAN.STATUSLAN = 1 THEN SPSINSCRICAOAREAOFERTADA.VALORINSCRICAO - SPSINSCRICAOAREAOFERTADA.VALORDESCONTO ELSE 0 END) / (SUM (CASE WHEN SPSOPCAOINSCRITO.NUMEROOPCAO = 1 THEN SPSINSCRICAOAREAOFERTADA.VALORINSCRICAO - SPSINSCRICAOAREAOFERTADA.VALORDESCONTO ELSE 0 END)+SUM( CASE WHEN FLAN.STATUSLAN = 1 THEN SPSINSCRICAOAREAOFERTADA.VALORINSCRICAO - SPSINSCRICAOAREAOFERTADA.VALORDESCONTO ELSE 0 END))) AS REC_ATINGIMENTO
FROM SPSINSCRICAOAREAOFERTADA  WITH(NOLOCK/*AZURE*/),
     SPSOPCAOINSCRITO  WITH(NOLOCK/*AZURE*/),
     SPSAREAOFERTADA  WITH(NOLOCK/*AZURE*/),
     SPSAREAINTERESSE  WITH(NOLOCK/*AZURE*/),
     FLAN  WITH(NOLOCK/*AZURE*/) 
WHERE FLAN.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN
	  AND FLAN.IDLAN = SPSINSCRICAOAREAOFERTADA.IDLAN
	  AND SPSINSCRICAOAREAOFERTADA.IDPS = :IDPS
      AND SPSINSCRICAOAREAOFERTADA.STATUS <> 8
      AND SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
      AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
      AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
      AND SPSINSCRICAOAREAOFERTADA.CODPESSOA = SPSOPCAOINSCRITO.CODPESSOA
      AND SPSOPCAOINSCRITO.NUMEROOPCAO = 1
      AND SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA
      AND SPSOPCAOINSCRITO.IDPS = SPSAREAOFERTADA.IDPS
      AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAOFERTADA.IDAREAINTERESSE
      AND SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE
GROUP BY SPSAREAINTERESSE.NOME

";1907;;;;14/05/2021;mestre;1;1;1;1;;;;0;5ecbaa4c-bf52-4721-a92d-26a11c6d92b1;;;2390;mestre;14/05/2021;mestre;14/05/2021;
G;DEMO.081;CONSULTA FUNIL DE CAPTAÇÃO;"SELECT 'PROSPECT' AS 'NOME',
       COUNT(*)   'TOTAL'
FROM   HPROSPECT (NOLOCK)
UNION ALL
SELECT 'INSCRITOS' AS 'NOME',
       COUNT (*)
FROM   SPSOPCAOINSCRITO (NOLOCK)
WHERE  CODCOLIGADA = 1
       
UNION ALL
SELECT 'CHAMADOS' AS 'NOME',
       COUNT (*)
FROM   SPSOPCAOINSCRITO (NOLOCK)
WHERE  CODCOLIGADA = 1
       AND STATUS = 1
";351;;;;14/05/2021;mestre;1;1;1;1;;;;0;7bf740fa-2c1f-43ab-b530-bdbf7241bac1;;;-12271;mestre;14/05/2021;mestre;14/05/2021;
G;DEMO.082;FUNIL POR AREA OFERTADA;"SELECT 'PROSPECT' AS 'NOME',
       SUM(CASE
             WHEN C.CODCLIENTE = '1' THEN 1
             ELSE 0
           END)   AS 'DIREITO',
       SUM(CASE
             WHEN C.CODCLIENTE = '4' THEN 1
             ELSE 0
           END)   AS 'CIÊNCIAS CONTÁBEIS',
       SUM(CASE
             WHEN C.CODCLIENTE = '3' THEN 1
             ELSE 0
           END)   AS 'ENGENHARIA'
FROM   HPROSPECT A (NOLOCK)
       JOIN HPROSPECTCOMPL B (NOLOCK)
         ON A.CODCOLIGADA = B.CODCOLIGADA
            AND A.CODPROSPECT = B.CODPROSPECT
            AND B.CURSOS IS NOT NULL
       JOIN GCONSIST C (NOLOCK)
         ON A.CODCOLIGADA = C.CODCOLIGADA
            AND B.CURSOS = C.CODCLIENTE
            AND C.CODCOLIGADA = 1
            AND C.APLICACAO = 'H'
            AND C.CODTABELA = '1'
UNION ALL
SELECT 'INSCRITOS' AS 'NOME',
       SUM(CASE
             WHEN IDAREAINTERESSE = 25 THEN 1
             ELSE 0
           END)    AS 'DIREITO',
       SUM(CASE
             WHEN IDAREAINTERESSE = 28 THEN 1
             ELSE 0
           END)    AS 'CIÊNCIAS CONTÁBEIS',
       SUM(CASE
             WHEN IDAREAINTERESSE = 27 THEN 1
             ELSE 0
           END)    AS 'ENGENHARIA'
FROM   SPSOPCAOINSCRITO
WHERE  CODCOLIGADA = 1
       AND IDPS = 18
UNION ALL
SELECT 'CHAMADOS' AS 'NOME',
       SUM(CASE
             WHEN IDAREAINTERESSE = 25 THEN 1
             ELSE 0
           END)   AS 'DIREITO',
       SUM(CASE
             WHEN IDAREAINTERESSE = 28 THEN 1
             ELSE 0
           END)   AS 'CIÊNCIAS CONTÁBEIS',
       SUM(CASE
             WHEN IDAREAINTERESSE = 27 THEN 1
             ELSE 0
           END)   AS 'ENGENHARIA'
FROM   SPSOPCAOINSCRITO
WHERE  CODCOLIGADA = 1
       AND IDPS = 18
       AND STATUS = 5 
";1795;;;;14/05/2021;mestre;1;1;1;1;;;;0;ee895d43-7c9b-4d75-b2e1-bf8a44e682d6;;;7882;mestre;14/05/2021;mestre;14/05/2021;
G;FILTRO.USER;USUÁRIOS POR PERFIL E SISTEMA;SELECT CODUSUARIO FROM GUSRPERFIL WHERE  CODSISTEMA =:SISTEMA AND CODPERFIL =:PERFIL;84;;;;27/07/2021;mestre;1;1;1;1;;;;0;3eb78081-d272-4cdf-b10c-cea1543ed23f;0;;28281;mestre;27/07/2021;mestre;27/07/2021;0
G;Grade_Horario;Grade de Horário;sp_Unasp_GradeHorario '2021/2';30;;;;22/06/2021;mestre;1;1;1;1;;;;0;c77b6ce3-26d4-42a5-94d2-b2fe980be215;0;;19209;mestre;22/06/2021;mestre;22/06/2021;0
G;HorarioAlunoPL;Horário de Aula por aluno/disciplina;select * from Fn_HorarioAlunos(:CODPERLET) order by 1, 2, 3, 4;62;;;;23/06/2021;mestre;1;1;1;1;;;;0;126fcf36-c468-463b-b903-16a4a8860b22;1;;-13695;mestre;23/06/2021;mestre;23/06/2021;1
G;IPLTESTE;SQL;"SELECT * 
  FROM GCCUSTO (NOLOCK) 
 WHERE ATIVO = 'T' 
   AND LEN(CODCCUSTO) > 12
   AND CODCCUSTO LIKE :CODCCUSTO";118;;;;23/03/2021;mestre;1;1;1;1;;;;0;c535ab20-468c-4fd6-8c2c-595a4e5cfe16;0;;-30000;mestre;23/03/2021;mestre;23/03/2021;0
G;TEST22;TESTE 2  ISALDO;select * From fn_teste2();25;;;;03/11/2021;mestre;1;1;1;1;;;;0;fa00fcd2-b9bf-4b91-961a-fd4e7e52ee34;0;;15596;mestre;03/11/2021;mestre;03/11/2021;0
G;teste;teste;select * from fn_financeiro(:Data_Início_D, :Data_Fim_D, :Ano_Período_Letivo_S);79;;;;13/12/2021;robson.canto;1;1;1;1;;;;0;d24a238c-c3be-41bc-98cd-e17368885b15;0;;-32442;robson.canto;13/12/2021;robson.canto;13/12/2021;0
G;teste2;teste2;"select * from SPSLOCALETAPAINSCRITO
where idps = 61 and idlocalps <>  316";74;;;;12/01/2022;wsrubeus;1;1;1;1;;;;0;318d0db6-faf4-411c-a92c-bdab5cb58d1e;0;;12981;wsrubeus;12/01/2022;wsrubeus;12/01/2022;0
G;TesteRaphael;teste;" SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELETALUNO.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELETALUNO.MINCH,
               SGRUPOOPTELETALUNO.MINCREDITOS,
               SGRUPOOPTELETALUNO.MINDISCIPLINAS,
               SGRUPOOPTELETALUNO.NOME,
               SGRUPOOPTELETALUNO.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = 1 )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                      AND SHABILITACAOFILIAL.CODCURSO = 'HT-BADMI' )
               JOIN SGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
               JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
                      AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = 1
               AND SPARAM.CODFILIAL = 3
               AND SPARAM.CODTIPOCURSO = 1
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
               AND ( SGRADEALUNO.RA IS NOT NULL
                      OR SHISTDISCOPTELETIVAS.RA IN (SELECT SCOMPONENTECURRALUNO.RA
                                                     FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                     WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                            AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                            AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA) )";3760;;;;30/11/2021;raphael.muzy;1;1;1;1;;;;0;24ef5c31-007f-4931-b7f2-e44fa962ba22;0;;-31487;raphael.muzy;30/11/2021;raphael.muzy;30/11/2021;0
G;testetotvs;totvs teste;"select * from spslocaletapainscrito
where idps = 61 and idlocalps is null";74;;;;12/01/2022;wsrubeus;1;1;1;1;;;;0;4ecf6c71-363f-45d0-95c8-4999fcce9f5b;0;;16442;wsrubeus;12/01/2022;wsrubeus;12/01/2022;0
G;UsuSupervisor;Usuários Supervisor;"select 
	u.CODUSUARIO
from 
	gpermis p 
	inner join GUSUARIO u on u.CODUSUARIO=p.CODUSUARIO 
	inner join GSISTEMA s on s.CODSISTEMA = p.CODSISTEMA
where 
	supervisor=1 
	and s.CODSISTEMA='S'";198;;;;14/10/2022;isaldo;1;1;1;1;;;;0;e6d42f92-3e8a-4b87-840f-7a9c4271e86b;0;;-12067;isaldo;14/10/2022;isaldo;14/10/2022;0
G;Z;SELECTS DIVERSOS;SELECT * from flanbaixaratccu where idlan=4400;46;;;;18/10/2021;carla.ozelo;1;1;1;1;;;;0;0709e9b7-ea58-4be8-a003-c459dc9cb9c3;0;;19599;carla.ozelo;18/10/2021;carla.ozelo;18/10/2021;0
H;Email. Grupo7;Lista de e-mail (Grupo Celula de Pagamento);SELECT RM.ZFC_EMAILLINHA() EMAIL FROM DUAL;42;;;;19/05/2021;mestre;1;1;1;1;;;;0;5866f6af-4036-425d-84a4-ec3864e86066;;;-24241;mestre;19/05/2021;mestre;19/05/2021;
H;EmailInfo;Lista de Emails - Excluido Requerimento Ajuste MAtricula;"select distinct 
	v.RA, 
	v.NomPessoa, 
	v.EMAIL, 
	case when v.DTNASCIMENTO is null then '12345678' else format(v.DTNASCIMENTO,'ddMMyyyy') end SenhaPadrao,
	p.CODUSUARIO	
from 
	v_Unasp_SMATRICPL 	(NOLOCK) v	
	INNER JOIN PPESSOA 	(NOLOCK) p 	ON p.CODIGO = v.CODPESSOA
where 
	v.CODTIPOCURSO = :CODTIPOCURSO 
	AND v.CODFILIAL like '%' + :CODFILIAL + '%'
	AND v.CODPERLET = :CODPERLET 
	AND v.NomStatus not in ('Trancado', 'Cancelado')
	AND v.NomStatus like '%' + :Status + '%'
	AND v.NomTipoMatricula LIKE '%' + :Tipo_Matricula + '%' 
	and v.CodCurso like '%' + :CodCurso + '%'
	AND v.RA LIKE '%' + :RA + '%'
	AND v.NomCurso NOT LIKE '%pensionato%'";666;;;;25/07/2022;isaldo;1;1;1;1;;;;0;b2d41966-73cf-4f80-a88c-ebdbcd8e9b73;0;;-5133;isaldo;25/07/2022;isaldo;25/07/2022;0
H;PARAM.001.1.1;Cursos Mestrado e Pos;"SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	AND (SCURSO.NOME LIKE '%mestra%' OR
 		SCURSO.NOME LIKE '%pos%')
 	AND SCURSO.NOME NOT LIKE '%PENSIONATO%'
)
TABELA /*WHERE*/";532;;;;30/05/2022;consultor1.totvs;1;1;1;1;;;;0;3a0509ba-fea3-4d53-ae57-ea4dae19e2e5;0;;-19570;consultor1.totvs;30/05/2022;consultor1.totvs;30/05/2022;0
H;PARAM.001.2.1;Cursos Trnasferencia EAD;"SELECT DISTINCT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.CODCURSO + ' - ' + SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	/*AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL*/
 	
 	AND SCURSO.NOME NOT LIKE '%PENSIO%'
 	AND SCURSO.NOME NOT LIKE '%TESTE%'
 	AND SCURSO.NOME NOT LIKE '%MIGRA%DADO%SIGA%'
 	AND SCURSO.NOME NOT LIKE '%CURSO%DE%CIENCIA%'
 	AND SCURSO.CODCURSO LIKE '%EAD%'
 	AND SHABILITACAOFILIAL.ATIVO = 'S'
 	AND SHABILITACAOFILIAL.CODTIPOCURSO = 1
 	AND SHABILITACAOFILIAL.CODFILIAL = 4

)
TABELA /*WHERE*/
ORDER BY 1";808;;;;29/09/2022;consultor1.totvs;1;1;1;1;;;;0;c7521d31-48f5-4fe9-bfe1-277a0e5504c4;0;;-6236;consultor1.totvs;15/09/2022;consultor1.totvs;29/09/2022;0
H;PARAM.002.1.1;Disciplina Mestrado;"SELECT DISTINCT 
 SDISCIPLINA.NOME, 
 SDISCIPLINA.CODDISC

FROM 
 SMATRICULA (NOLOCK)

 INNER JOIN STURMADISC (NOLOCK)		ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND
									   SMATRICULA.IDPERLET = STURMADISC.IDPERLET AND
									   SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
								   
 INNER JOIN SDISCIPLINA (NOLOCK)	ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND
									   STURMADISC.CODDISC = SDISCIPLINA.CODDISC
									   
 INNER JOIN SPARAM (NOLOCK)			ON SMATRICULA.CODCOLIGADA = SPARAM.CODCOLIGADA AND
									   STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
									   SPARAM.ID = 'IDPERLET'
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SPLETIVO.IDPERLET = CAST(SPARAM.TEXTO AS INT)
LEFT JOIN SPLETIVO SPT (NOLOCK) ON SPT.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPT.IDPERLET = STURMADISC.IDPERLET	
	
									   
WHERE SMATRICULA.CODCOLIGADA = :CODCOLIGADA
	AND SPT.IDPERLET IN (SPLETIVO.IDPERLET,SPLETIVO.IDPERLETANT)
	AND SMATRICULA.RA = :RA
	AND SMATRICULA.IDPERLET = :IDPERLET
	AND SMATRICULA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
	AND SDISCIPLINA.NOME NOT LIKE 'PENSIONATO%'";1189;;;;09/06/2022;consultor1.totvs;1;1;1;1;;;;0;467778c9-8271-4646-9072-e00676120847;0;;-21144;consultor1.totvs;30/05/2022;consultor1.totvs;09/06/2022;0
H;param.006.1;Cursos Interno Portal;"SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO


FROM 

 SMATRICPL (NOLOCK)	
									   
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
									   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO									  


WHERE 	
	SMATRICPL.CODCOLIGADA = :CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL 
	AND SMATRICPL.IDPERLET = :IDPERLET 
	AND SMATRICPL.RA = :RA
	
										
) TABELA /*WHERE*/				";675;;;;11/05/2022;consultor1.totvs;1;1;1;1;;;;0;f79ff808-2fa1-4661-99c5-afb070229f59;0;;13784;consultor1.totvs;11/05/2022;consultor1.totvs;11/05/2022;0
H;param.006.1.1;Curso Interno;"SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 
 FROM
  SCURSO (NOLOCK)
  
  WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SCURSO.CODCURSO LIKE (SELECT
							   CASE WHEN HATENDENTE.CODLOCAL = 1 THEN 'SP%'
							   		WHEN HATENDENTE.CODLOCAL = 2 THEN 'EC%'
							   		WHEN HATENDENTE.CODLOCAL = 3 THEN 'HT%'
							   		WHEN HATENDENTE.CODLOCAL = 4 THEN 'EAD%'
							   		WHEN HATENDENTE.CODLOCAL = 5 THEN '%' END 
							   
							  FROM
							   HATENDENTE (NOLOCK)
							   
							  WHERE	HATENDENTE.CODCOLIGADA = :CODCOLIGADA
							  	AND HATENDENTE.CODATENDENTE = :CODATENDENTE) 

 	AND SCURSO.NOME NOT LIKE ('%TESTE%')
 	AND SCURSO.NOME NOT LIKE ('%PENSIONATO%')
 	AND SCURSO.NOME NOT LIKE ('%MIGRA%')
)
TABELA /*WHERE*/";792;;;;28/07/2022;consultor1.totvs;1;1;1;1;;;;0;1197b478-5503-42ce-9a70-f75c7cef7525;0;;-3446;consultor1.totvs;28/07/2022;consultor1.totvs;28/07/2022;0
H;param.006.2;Cursos Aluno;"SELECT DISTINCT CURSO, CODCURSO FROM

(SELECT DISTINCT
  SCURSO.CODCURSO,
  SCURSO.NOME + ' - ' + GFILIAL.NOMEFANTASIA AS CURSO


FROM 

 SMATRICPL (NOLOCK)	
		
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
									   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO									  
INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL

WHERE 	
	SMATRICPL.CODCOLIGADA = :CODCOLIGADA

	AND SMATRICPL.RA = :RA
	
	 AND SCURSO.NOME NOT LIKE '%PENSIO%'
 	AND SCURSO.NOME NOT LIKE '%TESTE%'
 	AND SCURSO.NOME NOT LIKE '%MIGRA%DADO%SIGA%'
 	AND SCURSO.NOME NOT LIKE '%CURSO%DE%CIENCIA%'
	
										
) TABELA";1007;;;;09/06/2022;consultor1.totvs;1;1;1;1;;;;0;cdb9094d-42ca-4ef5-94c5-e4462f9ec7cd;0;;28312;consultor1.totvs;25/05/2022;consultor1.totvs;09/06/2022;0
H;PARAM.006.3;Cursos por Aluno;"SELECT DISTINCT CURSO, CODCURSO FROM

(SELECT DISTINCT
  SCURSO.CODCURSO,
  SCURSO.NOME + ' - ' + GFILIAL.NOMEFANTASIA AS CURSO
 
 FROM
  SMATRICPL (NOLOCK)	
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
									   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO									  
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
  
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SMATRICPL.RA = :RA
 	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
 	AND SMATRICPL.IDPERLET = :IDPERLET
 	/*MODIFICADO POR NATHAN PVT - 11/05/2022 - ADICIONADO CURSOS DE TESTE QUE NÃO DEVE APARECER*/
 	AND SCURSO.NOME NOT LIKE '%PENSIO%'
 	AND SCURSO.NOME NOT LIKE '%TESTE%'
 	AND SCURSO.NOME NOT LIKE '%MIGRA%DADO%SIGA%'
 	AND SCURSO.NOME NOT LIKE '%CURSO%DE%CIENCIA%'
 	/*AND SHABILITACAOFILIAL.ATIVO = 'S'*/

)
TABELA /*WHERE*/";1246;;;;31/08/2022;consultor1.totvs;1;1;1;1;;;;0;5292e700-5c9a-4f05-b62d-e7e948ede1bf;0;;13742;consultor1.totvs;09/06/2022;consultor1.totvs;31/08/2022;0
H;teste;teste;"/*
select * 
from hatendimentobase 
where codatendimento IN(
19088
)
*/
/*select * from rrptreport where id = 306*/

SELECT
MTCPL.CODTURMA,
	/*Parametros*/
	CT.RA,
	CT.CODCOLIGADA,
	CT.IDPERLET,
	CT.CODCONTRATO,

	/*Campos*/
	A.RA					ALUNO_RA,
	P.NOME					ALUNO_NOME,
	P.CARTIDENTIDADE		ALUNO_RG,
	P.ORGEMISSORIDENT		ALUNO_RGORGEMISSOR,
	P.UFCARTIDENT			ALUNO_UFRG,
	P.CPF					ALUNO_CPF,
	P.RUA					ALUNO_ENDERECO,
	P.NUMERO				ALUNO_ENDNUMERO,
	P.BAIRRO				ALUNO_ENDBAIRRO,
	P.CIDADE				ALUNO_ENDCIDADE,
	P.ESTADO				ALUNO_ENDESTADO,
	P.CEP					ALUNO_ENDCEP,
	P.TELEFONE1				ALUNO_TELEFONE,
	P.EMAIL					ALUNO_EMAIL,
 
 	F.CGCCFO			RESP_CPF,
 	F.PESSOAFISOUJUR	RESP_TIPO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.NOME ELSE F.NOME END						RESP_NOME,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CARTIDENTIDADE ELSE F.CIDENTIDADE END		RESP_RG,
	CASE WHEN P.CPF = F.CGCCFO THEN P.ORGEMISSORIDENT ELSE F.CI_ORGAO END		RESP_RGORGEMISSOR,
	CASE WHEN P.CPF = F.CGCCFO THEN P.UFCARTIDENT ELSE F.CI_UF END				RESP_RGUF,
	CASE WHEN P.CPF = F.CGCCFO THEN P.RUA ELSE F.RUA END						RESP_RUA,
	CASE WHEN P.CPF = F.CGCCFO THEN P.NUMERO ELSE F.NUMERO END					RESP_NUMEROCASA,
	CASE WHEN P.CPF = F.CGCCFO THEN P.BAIRRO ELSE F.BAIRRO END					RESP_BAIRRO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CIDADE ELSE F.CIDADE END					RESP_CIDADE,
	CASE WHEN P.CPF = F.CGCCFO THEN P.ESTADO ELSE F.CODETD END					RESP_ESTADO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CEP ELSE F.CEP	 END					RESP_CEP,
	CASE WHEN P.CPF = F.CGCCFO THEN P.TELEFONE1 ELSE F.TELEFONE END				RESP_TELEFONE,
	CASE WHEN P.CPF = F.CGCCFO THEN P.EMAIL ELSE F.EMAIL END					RESP_EMAIL,	

	C.NOME					CURSO_NOME,
	PGTO.DESCRICAO			CURSO_DESC,	
	PL.DESCRICAO			CURSO_ANOLETIVO,	
	CURSO_PARCELAMENSAL = (SELECT sum(VALOR) FROM SPARCELA WHERE PARCELA = '2' AND RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO),
	CURSO_VALOR = (SELECT SUM(VALOR) FROM SPARCELA WHERE RA = CT.RA	AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET	AND CODCONTRATO = CT.CODCONTRATO),		
	/*(SELECT SUM(VALOR) FROM SPARCELA WHERE	RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO) AS CURSO_VALOR,*/
	/*CPL.VALORCURSO		CURSO_VALOR,*/
	(SELECT COUNT(PARCELA) FROM SPARCELA WHERE	RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO) AS CURSO_PARCELA, /*PGTO.DESCRICAO	CURSO_PARCELAS,*/	
	T.CODTURMA				CURSO_CODTURMA,
	CT.CODCONTRATO			CURSO_CODCONTRATO,
	D.DISCIPLINAS			CURSO_DISCIPLINAS,
	C.CODMODALIDADECURSO	CURSO_MODALIDADE,
	C.CODTIPOCURSO			CURSO_TIPO,
	C.CODCURSO				CURSO_CODG,

	FL.NOMEFANTASIA			CAMPUS_NOME,
	FL.CGC					CAMPUS_CGC,
	FL.TELEFONE				CAMPUS_TELEFONE,
	FL.RUA					CAMPUS_ENDERECO,
	FL.NUMERO				CAMPUS_ENDERECO_NUMERO,
	FL.BAIRRO				CAMPUS_BAIRRO,
	FL.CIDADE				CAMPUS_CIDADE,
	UPPER(FL.CIDADE)		CAMPUS_CIDADEUPPER,
	FL.ESTADO				CAMPUS_ESTADO,
	FL.CEP					CAMPUS_CEP,

	DF.NOMEREPRES			REPRESENTANTE_NOME, 
	DF.LOGRADREPRES			REPRESENTANTE_CARGO, 
	DF.CPFREPRES			REPRESENTANTE_CPF,
	DF.NOMECONTADOR			TESTEMUNHA_NOME, 
	DF.CPFCONTADOR			TESTEMUNHA_CPF,
	
	AssDIRETOR 		= (select top 1 ass.IMAGEM from PPESSOA p inner join ZMDASSINATURAS ass on ass.CODPESSOA = p.CODIGO Where cpf = replace(replace(DF.CPFREPRES,'.',''),'-','')),
	AssTESTEMUNHA	= (select top 1 ass.IMAGEM from PPESSOA p inner join ZMDASSINATURAS ass on ass.CODPESSOA = p.CODIGO Where cpf = replace(replace(DF.CPFCONTADOR,'.',''),'-','')),
/*
	(SELECT IMAGEM FROM GIMAGEM WHERE ID = 
		CASE FL.CODFILIAL
			WHEN 1 THEN 21
			WHEN 2 THEN 17
			WHEN 3 THEN 19
			WHEN 4 THEN 24 END)	AS AssDIRETOR,
	
	(SELECT IMAGEM FROM GIMAGEM WHERE ID = 
		CASE FL.CODFILIAL
			WHEN 1 THEN 22
			WHEN 2 THEN 18
			WHEN 3 THEN 20
			WHEN 4 THEN 23 END)	AS AssTESTEMUNHA
*/

	   PL.DESCRICAO PERIODO_LETIVO,
	   SASSINATURACONTRATO.GUID ASSINATURA_GUID,
	   SASSINATURACONTRATO.TOKEN ASSINATURA_TOKEN,
       SASSINATURACONTRATO.EMAIL ASSINATURA_EMAIL,
	   SASSINATURACONTRATO.CLIENTIP ASSINATURA_CLIENTIP,
       SASSINATURACONTRATO.DATAHORAENVIOEMAIL ASSINATURA_DATAHORAENVIOEMAIL,
       SASSINATURACONTRATO.DATAHORAASSINATURA ASSINATURA_DATAHORAASSINATURA,
       CASE WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.NOME
	     	ELSE FCFO.NOMEFANTASIA END ASSINATURA_RESPONSAVEL,
	   
	   CASE WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.CPF
	     	ELSE FCFO.CGCCFO END ASSINATURA_CPF,
	     	
	   (ZMDVLMAT.VALOR * ZMDVLMAT.PARCELAS) VALOR_EAD,
	   ZMDVLMAT.PARCELAS PARCELAS_EAD  	

FROM 
	SALUNO A
	LEFT JOIN SMATRICPL MTCPL ON MTCPL.RA = A.RA AND MTCPL.CODCOLIGADA = A.CODCOLIGADA		   
	LEFT JOIN STURMA T ON T.CODCOLIGADA = MTCPL.CODCOLIGADA AND T.CODFILIAL = MTCPL.CODFILIAL AND T.CODTURMA = MTCPL.CODTURMA AND T.IDPERLET = MTCPL.IDPERLET	
	LEFT JOIN SHABILITACAOFILIAL HF ON HF.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL AND HF.CODCOLIGADA = MTCPL.CODCOLIGADA	
	LEFT JOIN SCURSO C ON C.CODCURSO = HF.CODCURSO AND C.CODCOLIGADA = HF.CODCOLIGADA	
	LEFT JOIN SCURSOCOMPL CPL ON CPL.CODCOLIGADA = C.CODCOLIGADA AND CPL.CODCURSO = C.CODCURSO
	LEFT JOIN PPESSOA P ON P.CODIGO = A.CODPESSOA
	LEFT JOIN SPESSOA PE ON PE.CODIGO = P.CODIGO
	LEFT JOIN FCFO F ON F.CODCFO = A.CODCFO AND F.CODCOLIGADA = A.CODCOLCFO	
	LEFT JOIN SCONTRATO CT ON CT.RA = MTCPL.RA AND CT.CODCOLIGADA = MTCPL.CODCOLIGADA AND CT.IDPERLET = MTCPL.IDPERLET AND CT.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL
	LEFT JOIN SFILIAL SF ON SF.CODCOLIGADA = CT.CODCOLIGADA AND SF.CODFILIAL = CT.CODFILIAL		
	LEFT JOIN GFILIAL FL ON FL.CODCOLIGADA = SF.CODCOLIGADA AND FL.CODFILIAL = SF.CODFILIAL	
	LEFT JOIN SPLETIVO PL ON PL.CODCOLIGADA = CT.CODCOLIGADA AND PL.IDPERLET = CT.IDPERLET	
	LEFT JOIN SPLANOPGTO PGTO ON PGTO.CODPLANOPGTO = CT.CODPLANOPGTO AND PGTO.CODCOLIGADA = CT.CODCOLIGADA AND PGTO.IDPERLET = CT.IDPERLET AND PGTO.CODTIPOCURSO = C.CODTIPOCURSO
	LEFT JOIN DFILIAL DF ON DF.CODFILIAL = FL.CODFILIAL			
	LEFT JOIN ( select CODCOLIGADA,IDPERLET,IDHABILITACAOFILIAL,RA, count(*) Disciplinas 
				from SMATRICULA group by CODCOLIGADA,IDPERLET,IDHABILITACAOFILIAL,RA ) D 
					ON D.CODCOLIGADA = MTCPL.CODCOLIGADA AND D.IDPERLET = MTCPL.IDPERLET AND D.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL AND D.RA = MTCPL.RA

    LEFT JOIN SHABILITACAOALUNO (NOLOCK)		ON SHABILITACAOALUNO.CODCOLIGADA = HF.CODCOLIGADA AND
    											   SHABILITACAOALUNO.IDHABILITACAOFILIAL = HF.IDHABILITACAOFILIAL AND
    											   SHABILITACAOALUNO.RA = CT.RA

    											   
    LEFT JOIN SASSINATURACONTRATO (NOLOCK) 	   ON SASSINATURACONTRATO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
       											  SASSINATURACONTRATO.RA = SHABILITACAOALUNO.RA AND 
       											  SASSINATURACONTRATO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
       											  SASSINATURACONTRATO.IDPERLET = PL.IDPERLET

    LEFT JOIN PPESSOA (NOLOCK)					ON SASSINATURACONTRATO.CODPESSOA = PPESSOA.CODIGO
    
    LEFT JOIN FCFO (NOLOCK)						ON SASSINATURACONTRATO.CODCOLIGADACFO = FCFO.CODCOLIGADA AND 
    											   SASSINATURACONTRATO.CODCFO = FCFO.CODCFO

 	LEFT JOIN ZMDVLMAT (NOLOCK)					ON ZMDVLMAT.CODCOLIGADA = CT.CODCOLIGADA AND
 												   ZMDVLMAT.FILIAL = CT.CODFILIAL AND
 												   ZMDVLMAT.IDPERLET = CT.IDPERLET AND
 												   ZMDVLMAT.IDHABILITACAOFILIAL = CT.IDHABILITACAOFILIAL   											   

WHERE	
	CT.RA = 194410 /*:RA1*/
	AND CT.CODCOLIGADA = 1 /*:CODCOLIGADA1*/
	AND CT.IDPERLET =  1014 /*:IDPERLET1*/
	AND CT.CODCONTRATO =  176507 /*:CODCONTRATO1*/";7677;;;;31/10/2022;robson.canto;1;1;1;1;;;;0;44fd2080-f2a9-4e59-b4b5-4c54d242f34d;0;;9223;mestre;19/01/2021;robson.canto;31/10/2022;0
H;Teste_Cloud;Teste_Cloud;SELECT * FROM GKNOWNJOBSERVER;29;;;;19/07/2021;mestre;1;1;1;0;;;;0;19d6553d-06c4-47d2-a5d2-67f00f4fcda6;0;;19167;mestre;19/07/2021;mestre;19/07/2021;0
H;TESTE1;TESTE;"
SELECT DISTINCT
GRUPO.NOME,
GRUPO.CODGRUPO

FROM SATENDIMENTO
INNER JOIN HATENDIMENTOBASE ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO
	AND HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL											   								   
  
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
 											   AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 
OUTER APPLY(
SELECT *
FROM HGRUPO) AS GRUPO


WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1
	AND HATENDIMENTOBASE.CODATENDIMENTO = 19088
	AND GRUPO.NOME LIKE '%COORDENA%'
	AND GRUPO.NOME LIKE '%' + LEFT(SCURSO.NOME,43) + '%'
	
UNION ALL


SELECT DISTINCT
'Secretaria Teologia' NOME,
46 CODGRUPO

FROM SATENDIMENTO
INNER JOIN HATENDIMENTOBASE ON HATENDIMENTOBASE.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
	AND HATENDIMENTOBASE.CODATENDIMENTO = SATENDIMENTO.CODATENDIMENTO
	AND HATENDIMENTOBASE.CODLOCAL = SATENDIMENTO.CODLOCAL											   								   
  
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SATENDIMENTO.CODCOLIGADA
 											   AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SATENDIMENTO.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO


WHERE	HATENDIMENTOBASE.CODCOLIGADA = 1
	AND HATENDIMENTOBASE.CODATENDIMENTO = 19088
	AND (SHABILITACAOFILIAL.CODCURSO IN ('EC-PMISS', 'EC-PETTB', 'EC-PESTM', 'EC-PETTS', 'EC-PGTEA') OR SCURSO.NOME LIKE '%TEOLOGIA%')";1746;;;;06/09/2022;consultor1.totvs;1;1;1;1;;;;0;3e9a0428-7641-4519-b3a8-428bc8f6ccb6;0;;1697;robson.canto;21/04/2022;consultor1.totvs;06/09/2022;0
S;_testeLucas;teste1;select * from saluno where ra='000001';38;;;;08/09/2022;lucas.ssantos;1;1;1;1;;;;0;f60b2f35-e234-4046-9615-e34c1b1805cd;0;;-8005;lucas.ssantos;08/09/2022;lucas.ssantos;08/09/2022;0
S;001 testembm;teste professor;"SELECT STURMADISC.IDTURMADISC
	FROM STURMADISC (NOLOCK)
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
			AND SPLETIVO.CODFILIAL = STURMADISC.CODFILIAL
			AND SPLETIVO.CODTIPOCURSO = STURMADISC.CODTIPOCURSO
		INNER JOIN SDISCIPLINA (NOLOCK) ON
			SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	    OUTER APPLY (SELECT * FROM STURMADISC.IDTURMADISC
      				 WHERE  SPROFESSORTURMA IS NOT NULL
AND SPROFESSORTURMA <> '    '
AND SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
) AS A
WHERE STURMADISC.CODCOLIGADA = :$CODCOLIGADA
AND STURMADISC.CODFILIAL = :$CODFILIAL
and SPLETIVO.CODPERLET = :CODPERLET
AND SPROFESSORTURMA.TIPOPROF = 'T'
AND A.CODCOLIGADA IS NULL
";868;;;;17/06/2022;marccella.belvedere;1;1;1;1;;;;0;e4b0ae55-be1e-41ba-a344-52426dc82dce;0;;-15531;marccella.belvedere;17/06/2022;marccella.belvedere;17/06/2022;0
S;aed;Turma disciplina Lição de Casa sem preenchimento;"SELECT STURMADISC.IDTURMADISC
FROM   STURMADISC (NOLOCK)
       INNER JOIN SPLETIVO (NOLOCK)
               ON STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
                  AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET
       LEFT JOIN SPLANOAULA (NOLOCK)
              ON SPLANOAULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                 AND SPLANOAULA.IDTURMADISC = STURMADISC.IDTURMADISC
      WHERE  SPLANOAULA.LICAOCASA IS NULL
       AND CODPERLET LIKE '%' + :PERLET + '%'
       AND SPLANOAULA.DATA <= Getdate() 
";530;;;;16/09/2022;marccella.belvedere;1;1;1;1;;;;0;0aae83e2-35b1-41b6-8fb5-4703c9092983;0;;25321;marccella.belvedere;16/09/2022;marccella.belvedere;16/09/2022;0
S;AjustaCredMatriz;Ajusta Creditos da Matriz;"Select *, :CODPERLET as CODPERLET from (
	SELECT		
		dg.CODCURSO, dg.CODHABILITACAO, dg.CODGRADE,
		'Disciplinas' Tipo, CODPERIODO, d.CODDISC, d.NOME, d.NUMCREDITOS, dg.NUMCREDITOSCOB
	FROM	
		SDISCIPLINA d
		INNER JOIN SDISCGRADE dg ON dg.CODCOLIGADA = d.CODCOLIGADA AND dg.CODDISC = d.CODDISC
	WHERE	
		dg.CODGRADE = :CODGRADE and dg.CODPERIODO>0			

	union all

	SELECT	
		dg.CODCURSO, dg.CODHABILITACAO, dg.CODGRADE,
		'Optativa/Eletiva' Tipo, gol.CODPERIODO, d.CODDISC, concat(gol.Nome, ' / ', d.NOME) NOME, d.NUMCREDITOS, dg.NUMCREDITOSCOB
	FROM	
		SGRUPOOPTELET gol
		inner join SDISCGRUPOOPTELET dgol on dgol.CODCOLIGADA = gol.CODCOLIGADA and dgol.CODCURSO = gol.CODCURSO and dgol.CODHABILITACAO = gol.CODHABILITACAO and dgol.CODGRADE = gol.CODGRADE and dgol.IDGRUPO = gol.IDGRUPO
		inner join SDISCIPLINA d on d.CODCOLIGADA=dgol.CODCOLIGADA and d.CODDISC = dgol.CODDISC
		inner join SDISCGRADE dg on dg.CODCOLIGADA = dgol.CODCOLIGADA and dg.CODCURSO=dgol.CODCURSO and dg.CODHABILITACAO = dgol.CODHABILITACAO and dg.CODGRADE = dgol.CODGRADE and dg.CODDISC = dgol.CODDISC and dg.CODPERIODO=0
	Where	
		dg.CODGRADE = :CODGRADE 
		and ( :CODGRADE = '*' or dg.CODGRADE in (select distinct CODGRADE from v_Unasp_SHABILITACAOFILIALPL Where CODPERLET = :CODPERLET ) )
) x
order by
	CODCURSO, CODHABILITACAO, CODGRADE, CODPERIODO, Tipo, NOME";1366;;;;30/09/2021;mestre;1;1;1;1;;;;0;fb2c6355-8ab5-4989-812a-e49d7c7a2151;0;;-23590;isaldo;28/09/2021;isaldo;11/08/2022;0
S;aluno 2021/2;Alunos 2021/2;"select m.RA from SMATRICPL m inner join SPLETIVO pl on pl.IDPERLET = m.IDPERLET where pl.CODPERLET in ('2021/2','2021/3M')
";123;;;;24/06/2021;lucas.biagio;1;1;1;1;;;;0;4ee3e94a-570c-4ae1-b756-f5b8509b833b;0;;9167;lucas.biagio;24/06/2021;lucas.biagio;24/06/2021;0
S;Aluno.Complemet;Dados complementares do Aluno;select ac.* from SALUNO a inner join SALUNOCOMPL ac on ac.RA=a.RA where a.RA = :RA;82;;;;06/04/2022;isaldo;1;1;1;1;;;;0;f780bf94-637a-4cf2-8b15-60c5544816f5;0;;19682;isaldo;06/04/2022;isaldo;06/04/2022;0
S;aluno2021/2;;"select m.RA from SMATRICPL m inner join SPLETIVO pl on pl.IDPERLET = m.IDPERLET where pl.CODPERLET in ('2021/2','2021/3M')
";123;;;;24/06/2021;lucas.biagio;1;1;1;1;;;;0;ca1e612c-f537-4737-8a9b-786bc5d70ad9;0;;24297;lucas.biagio;24/06/2021;lucas.biagio;24/06/2021;0
S;AlunoNovoCanvas;Alunos Novos Cursando para Mensagem Canvas;"select 
	RA, NomPessoa Aluno, EMAIL, replace(CONVERT(varchar(10), DTNASCIMENTO,103),'/','') Senha
from v_Unasp_SMATRICPL v Where 
	CODPERLET= :CODPERLET
	and NomStatus='Cursando' 
	and NomTipoMatricula='Matrícula' 
	and NomCurso not like 'pensionato%'
	and RA in (Select distinct RA from v_Unasp_SMATRICULA where CODPERLET = :CODPERLET and NomStatus = 'Cursando' and CANVAS = 'T' and isnull(IDCANVAS,'')<>'')";415;;;;07/02/2022;isaldo;1;1;1;1;;;;0;e23a71ab-d297-40ef-8dff-4041e0e70007;0;;-8734;isaldo;07/02/2022;isaldo;07/02/2022;0
S;ALunosNovosSiga;Alunos Novos Importados do SIGA;select * from v_Unasp_SMATRICPL where convert(varchar(10), convert(date,RECCREATEDON),103)=convert(varchar(10),:data,103) and RECCREATEDBY='SIGA';145;;;;26/07/2021;mestre;1;1;1;1;;;;0;fa92c360-2bc2-4b81-af14-c269a7eaa636;0;;6970;mestre;21/07/2021;mestre;26/07/2021;0
S;AlunosPensionato;Alunos Pensionato;"SELECT m.NomFilial   Filial,
       m.NomCurso    Curso,
       m.NomTurno    Turno,
       m.NomGrade    Matriz,
       m.CODPERLET   Período,
       m.NomTurma    Turma,
       m.RA,
       m.NomPessoa   Aluno,
       m.CPF,
	   m.DTNASCIMENTO,
       m.Sexo,
       m.NomStatus,
       m.Email,
       m.Rua,
       m.Numero,
       m.Cidade,
       m.Religiao,
       m.Bairro,
       m.Complemento,
       m.Telefone1,
       m.Telefone2,
       m.Telefone3,
       pai.NOME      Pai,
       pai.EMAIL     PaiEmail,
       pai.TELEFONE1 Pai_TELEFONE1,
       pai.TELEFONE2 Pai_TELEFONE2,
       pai.TELEFONE3 Pai_TELEFONE3,
       mae.NOME      Mae,
       Mae.EMAIL     MaeEmail,
       Mae.TELEFONE1 Mae_TELEFONE1,
       Mae.TELEFONE2 Mae_TELEFONE2,
       Mae.TELEFONE3 Mae_TELEFONE3,
       f.NOME        RespFinanceiro,
       CASE
         WHEN f.NOME = p.NOME THEN ''
         ELSE f.EMAIL
       END           RespFinEmail,
       CASE
         WHEN f.NOME = p.NOME THEN ''
         ELSE f.TELEFONE
       END           RespFinTel1,
       CASE
         WHEN f.NOME = p.NOME THEN ''
         ELSE f.TELEFONECOMERCIAL
       END           RespFinTel2
FROM   v_Unasp_SMATRICPL m
       INNER JOIN SALUNO a
               ON a.CODCOLIGADA = m.CODCOLIGADA
                  AND a.RA = m.RA
       INNER JOIN PPESSOA p
               ON p.CODIGO = m.CODPESSOA
       LEFT JOIN SPESSOA sp
              ON sp.CODIGO = p.CODIGO
       LEFT JOIN PPESSOA pai
              ON pai.CODIGO = sp.CODPESSOAPAI
       LEFT JOIN PPESSOA mae
              ON mae.CODIGO = sp.CODPESSOAMAE
       LEFT JOIN FCFO f
              ON f.CODCFO = a.CODCFO
WHERE  CODPERLET = :CODPERLET
       AND CODCURSO IN ( 'EC-GPENS', 'EC-PPENS', 'HT-GPENS', 'SP-GPENS' ) 
";1812;;;;30/08/2022;lucas.marques;1;1;1;1;;;;1;4fbe8d90-2718-4f0c-b06f-4b5706f73dff;0;;27724;mestre;27/07/2021;lucas.marques;30/08/2022;0
S;AlunosPeríodo;Alunos do Período (prohelp);"Select * from v_Unasp_SMATRICPLCR
where 
	/*CODPERLET in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' ))*/
	CODPERLET like '%' + :CODPERLET + '%'
	and NomStatus like '%' + :Status + '%'
";203;;;;08/11/2022;consultor1.totvs;1;1;1;1;;;;1;f5839869-087d-428a-9d1a-5c92f757b992;0;;16170;isaldo;18/01/2022;consultor1.totvs;08/11/2022;0
S;ALunosSemTurma;Alunos Sem Turma no eríodo Letivo;"select NomFilial, NomTipoCurso, NomCurso, CODGRADE, NomGrade, ra, NomPessoa, NomStatus  from v_Unasp_SMATRICPL 
Where 
	CODTURMA is null and CODPERLET = :CODPERLET
order by 
	NomFilial, NomTipoCurso, NomCurso, CODGRADE, NomPessoa";233;;;;30/06/2021;isaldo;1;1;1;1;;;;0;18c03e45-0d8c-4094-90f6-c1b9c9c72e6d;0;;-2141;isaldo;30/06/2021;isaldo;30/06/2021;0
S;AP.FECHAMENTO;Fechamento de Resultado Final ;"SELECT SMATRICPL.CODCOLIGADA,
       SMATRICPL.IDHABILITACAOFILIAL,
       SMATRICPL.RA,
       SMATRICPL.IDPERLET
FROM   SMATRICPL (NOLOCK)
       INNER JOIN SHABILITACAOFILIAL SHF (NOLOCK)
               ON SHF.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                  AND SHF.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
       INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE  SPLETIVO.CODTIPOCURSO = 1
       AND SPLETIVO.CODCOLIGADA = :$CODCOLIGADA
       AND SMATRICPL.RA LIKE :RA
       AND SPLETIVO.CODPERLET = :PERIODO_LETIVO
       AND EXISTS (SELECT 1
                   FROM   SHISTDISCCONCLUIDAS SHC(NOLOCK)
                   WHERE  SHC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                          AND SHC.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
                          AND SHC.RA = SMATRICPL.RA)";939;;;;08/09/2021;consultor1.totvs;1;1;1;1;;;;0;f326fa88-7ecd-4d05-a331-9de1028c3748;0;;-17712;consultor1.totvs;08/09/2021;consultor1.totvs;08/09/2021;0
S;ApiAControl;Controle de Acesso;"Select * from fn_Unasp_ControleAcesso(:CodFilial,:Grupo,:DataRegistro)

/*
:CodFilial
	1=sp
	2=ec
	3=ht
	4=ead
	
:Grupo
	 1=alunos ativos
	 2=alunos de graduação
	 3=alunos pós
	 4=Alunos Extensão
	 5=Internato masc
	 6=Internato fem
	 7=professores ativos
	 
:DataRegistro
	yyyy/MM/dd
	ex: 2021/06/01
*/
";327;;;;23/06/2022;joshua;1;1;1;1;;;;0;c797b6d7-9191-49bf-a08f-2aa28de1fa5a;0;;31295;lucas.ssantos;28/06/2021;joshua;23/06/2022;0
S;ApiAControlCurso;Controle de acesso Curso;"Select 
	* 
from 
	v_Unasp_ControleAcesso_Cursos 
where 
	CodPessoa= :CODPESSOA
	and CODFILIAL = :CODFILIAL";113;;;;01/06/2022;isaldo;1;1;1;1;;;;0;0b23ba3d-24fb-41e4-8235-b133d355c5ce;0;;-21352;matheus.amaral;25/03/2022;isaldo;01/06/2022;0
S;ApiAcontrolImage;Controle de acesso Foto;select IMAGEM from GIMAGEM Where id= :IDIMAGEM;46;;;;25/03/2022;matheus.amaral;1;1;1;1;;;;0;436b238a-7c50-470d-b559-aabdb1973109;0;;4569;matheus.amaral;25/03/2022;matheus.amaral;25/03/2022;0
S;ApiAControlResp;Controle de acesso responsavel;select * from v_Unasp_Responsavel where RA = :RA  order by Item;63;;;;12/05/2022;matheus.amaral;1;1;1;1;;;;0;f972e12f-0a2b-421c-acd9-9e8fa7885f66;0;;11284;matheus.amaral;12/05/2022;matheus.amaral;12/05/2022;0
S;apiEuApoio;Consulta para EuApoio;Select * from fn_Unasp_EuApoio(:CodFilial,:DataRegistro) order by Nome;70;;;;08/10/2021;isaldo;1;1;1;1;;;;0;72adf936-8852-42d1-a9cb-510e17f7e541;0;;-18746;isaldo;08/10/2021;isaldo;08/10/2021;0
S;ApiValidaAluno;Validação de Alunos pelo QRCode da declaração de matrícula;"SELECT 
	V.NomPessoa, 
	V.RA, 
	V.CPF,
	V.CARTIDENTIDADE,
	V.DTNASCIMENTO,
	I.IMAGEM,
	V.NOMCURSO,
	V.NomStatus,
	V.NomFilial

FROM
	v_Unasp_SMATRICPL V
	LEFT JOIN GIMAGEM I ON I.ID = V.IDIMAGEM
	INNER JOIN Z_Unasp_DeclaracaoMatricula Z ON Z.CODCOLIGADA = V.CODCOLIGADA AND Z.IDPERLET = V.IDPERLET AND Z.IDHABILITACAOFILIAL = V.IDHABILITACAOFILIAL AND Z.RA = V.RA

WHERE 
	Z.ID = :ID

/*
WHERE 
	V.RA = '049156' 
	AND V.IDPERLET = 476 
	AND V.IDHABILITACAOFILIAL = 14390
*/";497;;;;03/02/2022;lucas.ssantos;1;1;1;1;;;;0;a6d3c388-5369-4eab-b0e6-5237237a4c05;0;;25126;lucas.ssantos;02/02/2022;lucas.ssantos;03/02/2022;0
S;APURACAORESUL;Apuração de Resultado Período Letivo por Filial;"SELECT SMATRICPL.CODCOLIGADA , SMATRICPL.IDHABILITACAOFILIAL , RA , SMATRICPL.IDPERLET 

FROM SMATRICPL 
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON 
			SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SSTATUS (NOLOCK) ON
			SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
			AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
WHERE CODPERLET =:PERIODOLETIVO
AND   SMATRICPL.CODFILIAL = :FILIAL
AND   SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
AND   SSTATUS.DESCRICAO LIKE '%CURSANDO%'
/*AND   SMATRICPL.CODSTATUS = '2'*/ /*CURSANDO*/";801;;;;15/03/2022;consultor1.totvs;1;1;1;1;;;;0;93e78ec3-93bd-484d-a162-63ef4b591595;0;;11156;mestre;24/08/2021;consultor1.totvs;15/03/2022;0
S;APURACAORESUL2;Apuração de Resultado Período Letivo por Curso;"SELECT SMATRICPL.CODCOLIGADA , SMATRICPL.IDHABILITACAOFILIAL , RA , SMATRICPL.IDPERLET
	FROM SMATRICPL 
		INNER JOIN SPLETIVO (NOLOCK) ON 
			SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
		INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON 
			SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		INNER JOIN SCURSO (NOLOCK) ON
			SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			AND SCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
	    INNER JOIN SSTATUS (NOLOCK) ON
			SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
			AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
WHERE CODPERLET =:PERIODOLETIVO
AND   SMATRICPL.CODFILIAL = :FILIAL
AND   SHABILITACAOFILIAL.CODTIPOCURSO = :CODNIVELENSINO
/*AND   SCURSO.NOME LIKE '%' +  :NOMECURSO_S + '%'*/
AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO
AND   SSTATUS.DESCRICAO LIKE 'CURSANDO'";1084;;;;10/02/2022;consultor1.totvs;1;1;1;1;;;;0;c08ba051-57b8-4478-9440-830913c82437;0;;27848;consultor1.totvs;17/11/2021;consultor1.totvs;10/02/2022;0
S;APURACAORESULT3;Apuração de Resultado Período Letivo por RA;"SELECT SMATRICPL.CODCOLIGADA , SMATRICPL.IDHABILITACAOFILIAL , RA , SMATRICPL.IDPERLET
	FROM SMATRICPL 
		INNER JOIN SPLETIVO (NOLOCK) ON 
			SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
		INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON 
			SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		INNER JOIN SCURSO (NOLOCK) ON
			SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			AND SCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
		INNER JOIN SSTATUS (NOLOCK) ON
			SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
			AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
WHERE CODPERLET =:PERIODOLETIVO
AND   SMATRICPL.CODFILIAL = :FILIAL
AND   SHABILITACAOFILIAL.CODTIPOCURSO = :CODNIVELENSINO
AND   SMATRICPL.RA = :RA
/*AND   SSTATUS.DESCRICAO LIKE 'CURSANDO'*/";1012;;;;30/08/2022;consultor1.totvs;1;1;1;1;;;;0;c621763e-12b0-4103-a188-8c449122e268;0;;2095;consultor1.totvs;17/11/2021;consultor1.totvs;30/08/2022;0
S;APURACAORESULT4;Apuração de Resultado Período Letivo por Turma;"SELECT SMATRICPL.CODCOLIGADA , SMATRICPL.IDHABILITACAOFILIAL , RA , SMATRICPL.IDPERLET
	FROM SMATRICPL 
		INNER JOIN SPLETIVO (NOLOCK) ON 
			SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
		INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON 
			SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		INNER JOIN SCURSO (NOLOCK) ON
			SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			AND SCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
		INNER JOIN SSTATUS (NOLOCK) ON
			SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
			AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
WHERE CODPERLET =:PERIODOLETIVO
AND   SMATRICPL.CODFILIAL = :FILIAL
AND   SHABILITACAOFILIAL.CODTIPOCURSO = :CODNIVELENSINO
AND   SMATRICPL.CODTURMA = :CODTURMA
AND   SSTATUS.DESCRICAO LIKE 'CURSANDO'";1020;;;;10/02/2022;consultor1.totvs;1;1;1;1;;;;0;de5e3b14-8b5c-462d-b915-6cc7c3e104e7;0;;-29995;consultor1.totvs;10/12/2021;consultor1.totvs;10/02/2022;0
S;APURACAORESULT5;Apuração de Resultado Período Letivo (Pensionato);"SELECT SMATRICPL.CODCOLIGADA , SMATRICPL.IDHABILITACAOFILIAL , RA , SMATRICPL.IDPERLET 
	FROM SMATRICPL 
		INNER JOIN SPLETIVO ON 
			SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
		INNER JOIN SHABILITACAOFILIAL ON
			SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		INNER JOIN SCURSO ON
			SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		INNER JOIN SSTATUS (NOLOCK) ON
			SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
			AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
WHERE CODPERLET =:PERIODOLETIVO
AND   SMATRICPL.CODFILIAL = :FILIAL
AND   SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
AND   SCURSO.NOME LIKE '%Pensionato%'
AND   SSTATUS.DESCRICAO LIKE 'CURSANDO'";927;;;;10/02/2022;consultor1.totvs;1;1;1;1;;;;0;761c1485-d844-40b9-b256-6c28121dbc6c;0;;-6181;consultor1.totvs;24/01/2022;consultor1.totvs;10/02/2022;0
S;APURACAORESULT6;Apuração de Resultado Período Letivo (Curso Livre);"SELECT SMATRICPL.CODCOLIGADA , SMATRICPL.IDHABILITACAOFILIAL , SMATRICPL.RA , SMATRICPL.IDPERLET, PPESSOA.NOME
	FROM SMATRICPL 
		INNER JOIN SPLETIVO ON 
			SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
		INNER JOIN SHABILITACAOFILIAL ON
			SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		INNER JOIN SCURSO ON
			SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		INNER JOIN SSTATUS (NOLOCK) ON
			SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
			AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
		INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SALUNO.RA = SMATRICPL.RA
		INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
WHERE CODPERLET =:PERIODOLETIVO
AND   SMATRICPL.CODFILIAL = :FILIAL
AND   SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
AND   SCURSO.NOME LIKE '%' + :CURSOLIVRE + '%'
AND   SSTATUS.DESCRICAO LIKE 'CURSANDO'";1136;;;;27/04/2022;consultor1.totvs;1;1;1;1;;;;0;3ff09b1e-7ca6-4d89-b6d4-05f0bfdf4839;0;;-32188;consultor1.totvs;27/04/2022;consultor1.totvs;27/04/2022;0
S;AR.GRD.01;Apuração de Resultados - Graduação - Verifica Conclusão - Por Aluno;"SELECT SMATRICPL.CODCOLIGADA,
       SMATRICPL.IDHABILITACAOFILIAL,
       SMATRICPL.RA,
       SMATRICPL.IDPERLET
FROM   SMATRICPL (NOLOCK)
       INNER JOIN SHABILITACAOFILIAL SHF (NOLOCK)
               ON SHF.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                  AND SHF.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
       INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE  SPLETIVO.CODTIPOCURSO = 1
       AND SPLETIVO.CODCOLIGADA = :$CODCOLIGADA
       AND SMATRICPL.RA LIKE :RA
       AND SPLETIVO.CODPERLET = :PERIODO_LETIVO
       AND EXISTS (SELECT 1
                   FROM   SHISTDISCCONCLUIDAS SHC(NOLOCK)
                   WHERE  SHC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                          AND SHC.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
                          AND SHC.RA = SMATRICPL.RA)
";960;;;;22/09/2021;raquel.faria;1;1;1;1;;;;0;0e8f2cb3-2ab0-4014-91cc-52a46815e0d4;0;;5269;mestre;26/08/2021;raquel.faria;22/09/2021;0
S;AR.GRD.02;02 -  (Alunos c/ status) - Apuração de Resultados - Graduação - Verifica Conclusão - Por RA;"SELECT
/*	SUM(SNOTAS.NOTA) AS MEDIAAV,
	SNOTAS.CODETAPA AS CODETAPA,*/ 
								DISTINCT
								SMATRICULA.CODCOLIGADA,
                                SMATRICULA.RA,
                                SMATRICULA.IDTURMADISC,
                                STURMADISC.CODTURMA,
                                 SDISCIPLINA.NOME AS 'DISCIPLINA'
                                /*SNOTAETAPA.NOTAFALTA AS NOTA*/
FROM   SMATRICULA
       LEFT JOIN SNOTAETAPA (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
                  AND SMATRICULA.RA = SNOTAETAPA.RA
       LEFT JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  /*AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL*/
       LEFT JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       LEFT JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
			   
WHERE  SMATRICULA.CODCOLIGADA ='1'
       AND STURMADISC.CODFILIAL =:CODFILIAL
       AND SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
       AND SPLETIVO.CODPERLET =:CODPERELT
       /*AND STURMADISC.IDTURMADISC =:IDTURMADISC*/
       AND SMATRICULA.RA =:RA
       /*AND SMATRICULA.CODSTATUS IN  ('2','10','8','9','57','55') */
       /*AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')*/
       
       
       
/*
AND SNOTAS.TIPOETAPA = 'N'*/
/*AND SNOTAS.RA = '002762'*/
/*AND (SNOTAS.NOTA IS NOT NULL AND ISNUMERIC(SNOTAS.NOTA) = 1)*/
GROUP  BY SNOTAETAPA.CODETAPA,
          SMATRICULA.CODCOLIGADA,
          SMATRICULA.RA,
          SMATRICULA.IDTURMADISC,
          STURMADISC.CODTURMA,
          SDISCIPLINA.NOME,
           SNOTAETAPA.NOTAFALTA
";2312;;;;05/07/2022;consultor1.totvs;1;1;1;1;;;;0;0e8f2cb3-2ab0-4014-91cc-52a46815e0d4;0;;24454;consultor1.totvs;14/09/2021;consultor1.totvs;05/07/2022;0
S;AR.GRD.02.03;02 -  (Alunos c/ status) - Apuração de Resultados - Graduação - Verifica Conclusão - Por RA e Disciplinas;"SELECT
/*	SUM(SNOTAS.NOTA) AS MEDIAAV,
	SNOTAS.CODETAPA AS CODETAPA,*/ 
								DISTINCT
								SMATRICULA.CODCOLIGADA,
                                SMATRICULA.RA,
                                SMATRICULA.IDTURMADISC,
                                STURMADISC.CODTURMA,
                                 SDISCIPLINA.NOME AS 'DISCIPLINA'
                                /*SNOTAETAPA.NOTAFALTA AS NOTA*/
FROM   SMATRICULA
       LEFT JOIN SNOTAETAPA (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
                  AND SMATRICULA.RA = SNOTAETAPA.RA
       LEFT JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  /*AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL*/
       LEFT JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       LEFT JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
			   
WHERE  SMATRICULA.CODCOLIGADA ='1'
       AND STURMADISC.CODFILIAL =:CODFILIAL
       AND SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
       AND SPLETIVO.CODPERLET =:CODPERELT
       AND SDISCIPLINA.CODDISC = :CODDISC
       /*AND STURMADISC.IDTURMADISC =:IDTURMADISC*/
       AND SMATRICULA.RA =:RA
       /*AND SMATRICULA.CODSTATUS IN  ('2','10','8','9','57','55') */
       AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')
       
       
       
/*
AND SNOTAS.TIPOETAPA = 'N'*/
/*AND SNOTAS.RA = '002762'*/
/*AND (SNOTAS.NOTA IS NOT NULL AND ISNUMERIC(SNOTAS.NOTA) = 1)*/
GROUP  BY SNOTAETAPA.CODETAPA,
          SMATRICULA.CODCOLIGADA,
          SMATRICULA.RA,
          SMATRICULA.IDTURMADISC,
          STURMADISC.CODTURMA,
          SDISCIPLINA.NOME,
           SNOTAETAPA.NOTAFALTA
";2351;;;;05/07/2022;consultor1.totvs;1;1;1;1;;;;0;0e8f2cb3-2ab0-4014-91cc-52a46815e0d4;0;;-11078;consultor1.totvs;14/12/2021;consultor1.totvs;05/07/2022;0
S;AR.GRD.02.04;02 -  (Alunos c/ status) - Apuração de Resultados - Graduação - Verifica Conclusão - Disciplinas;"SELECT
/*	SUM(SNOTAS.NOTA) AS MEDIAAV,
	SNOTAS.CODETAPA AS CODETAPA,*/ 
								DISTINCT
								SMATRICULA.CODCOLIGADA,
                                SMATRICULA.RA,
                                SMATRICULA.IDTURMADISC,
                                STURMADISC.CODTURMA,
                                 SDISCIPLINA.NOME AS 'DISCIPLINA'
                                /*SNOTAETAPA.NOTAFALTA AS NOTA*/
FROM   SMATRICULA
       LEFT JOIN SNOTAETAPA (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
                  AND SMATRICULA.RA = SNOTAETAPA.RA
       LEFT JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  /*AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL*/
       LEFT JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       LEFT JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
			   
WHERE  SMATRICULA.CODCOLIGADA ='1'
       AND STURMADISC.CODFILIAL =:CODFILIAL
       AND SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
       AND SPLETIVO.CODPERLET =:CODPERELT
       AND SDISCIPLINA.CODDISC = :CODDISC
       /*AND STURMADISC.IDTURMADISC =:IDTURMADISC*/
       /*AND SNOTAETAPA.RA =:RA*/
       /*AND SMATRICULA.CODSTATUS IN  ('2','10','8','9','57','55') */
       AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')
       
       
       
/*
AND SNOTAS.TIPOETAPA = 'N'*/
/*AND SNOTAS.RA = '002762'*/
/*AND (SNOTAS.NOTA IS NOT NULL AND ISNUMERIC(SNOTAS.NOTA) = 1)*/
GROUP  BY SNOTAETAPA.CODETAPA,
          SMATRICULA.CODCOLIGADA,
          SMATRICULA.RA,
          SMATRICULA.IDTURMADISC,
          STURMADISC.CODTURMA,
          SDISCIPLINA.NOME,
           SNOTAETAPA.NOTAFALTA
";2355;;;;05/07/2022;consultor1.totvs;1;1;1;1;;;;0;0e8f2cb3-2ab0-4014-91cc-52a46815e0d4;0;;25700;consultor1.totvs;17/01/2022;consultor1.totvs;05/07/2022;0
S;AR.GRD.03;Apuração de Resultados - Graduação - Verifica Conclusão ;"SELECT DISTINCT 

CASE
   WHEN SMATRICULA.CODSTATUSRES IN ('9','36','39','53', '8','41','70','57','63','71','55','62','72') AND NOT SMATRICULA.CODSTATUSRES IS NULL THEN 'V'
   WHEN  SMATRICULA.CODSTATUSRES IS NULL THEN 'F'
   END CODSTATUSRES


FROM   SMATRICULA
       LEFT JOIN SNOTAETAPA (NOLOCK)
              ON SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
                 AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
                 AND SMATRICULA.RA = SNOTAETAPA.RA
       INNER JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
       INNER JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       INNER JOIN SPARAM (NOLOCK)			ON SMATRICULA.CODCOLIGADA = SPARAM.CODCOLIGADA AND
									   STURMADISC.CODTIPOCURSO = SPARAM.CODTIPOCURSO AND
									   SMATRICULA.IDPERLET = CAST(SPARAM.TEXTO AS INT)
									   AND SPARAM.ID = 'IDPERLET'
WHERE  1 = 1
       AND SNOTAETAPA.CODCOLIGADA = '1'
       /*AND STURMADISC.CODFILIAL = '2'
       AND SPLETIVO.CODTIPOCURSO = '1'
       AND SPLETIVO.CODPERLET = '2021/2'*/
       /*AND STURMADISC.IDTURMADISC =:FRM_IDTD*/
       AND SNOTAETAPA.RA = :FRM_RAALU
       AND SNOTAETAPA.CODETAPA = '2'
       AND SNOTAETAPA.TIPOETAPA = 'N'
   ";1700;;;;22/06/2022;consultor1.totvs;1;1;1;1;;;;0;0e8f2cb3-2ab0-4014-91cc-52a46815e0d4;0;;-20698;consultor1.totvs;22/09/2021;consultor1.totvs;22/06/2022;0
S;AR.GRD.03.1;Verifica nota Conceitual dos Alunos;"SELECT 
	SNOTAETAPA.CODCONCEITO
FROM SMATRICULA
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
INNER JOIN SDISCIPLINA ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
INNER JOIN SNOTAETAPA ON SNOTAETAPA.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SNOTAETAPA.IDTURMADISC = SMATRICULA.IDTURMADISC
	AND SNOTAETAPA.RA = SMATRICULA.RA
INNER JOIN SETAPAS ON SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
	AND SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC
	AND SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA
	AND SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA
WHERE 
	SMATRICULA.CODCOLIGADA = :$CODCOLIGADA
	AND SMATRICULA.RA = :FRM_RAALU
	AND SMATRICULA.IDTURMADISC = :FRM_IDTD
	AND SETAPAS.ETAPAFINAL = 'S'
	AND SNOTAETAPA.CODCONCEITO IS NOT NULL";870;;;;18/08/2022;consultor1.totvs;1;1;1;1;;;;0;fa9cdecd-faf9-4e28-8ce6-735487db3682;0;;14114;consultor1.totvs;22/06/2022;consultor1.totvs;18/08/2022;0
S;AR.GRD.04;03 - (Alunos c/ status) - Apuração de Resultados - Graduação - Verifica Conclusão - Por Turma;"SELECT
/*	SUM(SNOTAS.NOTA) AS MEDIAAV,
	SNOTAS.CODETAPA AS CODETAPA,*/ 
								DISTINCT
								SMATRICULA.CODCOLIGADA,
                                SMATRICULA.RA,
                                SMATRICULA.IDTURMADISC,
                                STURMADISC.CODTURMA,
                                SDISCIPLINA.NOME AS 'DISCIPLINA'
                                /*SNOTAETAPA.NOTAFALTA AS NOTA*/
FROM   SMATRICULA
       LEFT JOIN SNOTAETAPA (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
                  AND SMATRICULA.RA = SNOTAETAPA.RA
       INNER JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  /*AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL*/
       INNER JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE  SMATRICULA.CODCOLIGADA ='1'
       AND STURMADISC.CODFILIAL =:CODFILIAL
       AND SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
       AND SPLETIVO.CODPERLET =:CODPERELT
       AND STURMADISC.CODTURMA =:CODTURMA
     
       /*AND SNOTAETAPA.CODETAPA = '2'
       AND SNOTAETAPA.TIPOETAPA = 'N'*/
       /*AND SMATRICULA.CODSTATUS IN  ('2','10','8','9','57','55') */
       AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')
       
       
       
       
/*
AND SNOTAS.TIPOETAPA = 'N'*/
/*AND SNOTAS.RA = '002762'*/
/*AND (SNOTAS.NOTA IS NOT NULL AND ISNUMERIC(SNOTAS.NOTA) = 1)*/
GROUP  BY SNOTAETAPA.CODETAPA,
          SMATRICULA.CODCOLIGADA,
          SMATRICULA.RA,
          SMATRICULA.IDTURMADISC,
          STURMADISC.CODTURMA,
          SDISCIPLINA.NOME,
           SNOTAETAPA.NOTAFALTA
";2358;;;;05/07/2022;consultor1.totvs;1;1;1;1;;;;0;0e8f2cb3-2ab0-4014-91cc-52a46815e0d4;0;;3419;consultor1.totvs;23/09/2021;consultor1.totvs;05/07/2022;0
S;AR.GRD.05;01 - (Alunos c/ status) -  Apuração de Resultados - Graduação - Verifica Conclusão - Por Periodo Letivo;"SELECT
/*	SUM(SNOTAS.NOTA) AS MEDIAAV,
	SNOTAS.CODETAPA AS CODETAPA,*/ 
								DISTINCT
								SMATRICULA.CODCOLIGADA,
                                SMATRICULA.RA,
                                SMATRICULA.IDTURMADISC,
                                STURMADISC.CODTURMA,
                                SDISCIPLINA.NOME AS 'DISCIPLINA'
                                /*SNOTAETAPA.NOTAFALTA AS NOTA*/
FROM   SMATRICULA
       LEFT JOIN SNOTAETAPA (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
                  AND SMATRICULA.RA = SNOTAETAPA.RA
       INNER JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  /*AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL*/
       INNER JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE  SMATRICULA.CODCOLIGADA ='1'
       AND STURMADISC.CODFILIAL =:CODFILIAL
       AND SPLETIVO.CODTIPOCURSO = :NIVELENSINO
       AND SPLETIVO.CODPERLET =:CODPERELT
       /*Ajustado em 15/03/2022 Nathan PVT - Colocado para ser digitado o nivel de ensino, e comentado a opção de filtrar apenas pela etapa 2*/
       /*AND SNOTAETAPA.CODETAPA = '2'
       AND SNOTAETAPA.TIPOETAPA = 'N'*/       
       /*AND SMATRICULA.CODSTATUS IN  ('2','10','8','9','57','55')*/
       AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')
      
       
       
/*
AND SNOTAS.TIPOETAPA = 'N'*/
/*AND SNOTAS.RA = '002762'*/
/*AND (SNOTAS.NOTA IS NOT NULL AND ISNUMERIC(SNOTAS.NOTA) = 1)*/
GROUP  BY SNOTAETAPA.CODETAPA,
          SMATRICULA.CODCOLIGADA,
          SMATRICULA.RA,
          SMATRICULA.IDTURMADISC,
          STURMADISC.CODTURMA,
          SDISCIPLINA.NOME,
           SNOTAETAPA.NOTAFALTA
";2446;;;;05/07/2022;consultor1.totvs;1;1;1;1;;;;0;0e8f2cb3-2ab0-4014-91cc-52a46815e0d4;0;;-4931;consultor1.totvs;23/09/2021;consultor1.totvs;05/07/2022;0
S;AR.GRD.06;01 - (Alunos c/ status) -  Apuração de Resultados - Graduação - Verifica Conclusão - Por Periodo Letivo/ Curso;"SELECT
/*	SUM(SNOTAS.NOTA) AS MEDIAAV,
	SNOTAS.CODETAPA AS CODETAPA,*/ 
								DISTINCT
								SMATRICULA.CODCOLIGADA,
                                SMATRICULA.RA,
                                SMATRICULA.IDTURMADISC,
                                STURMADISC.CODTURMA,
                                SDISCIPLINA.NOME AS 'DISCIPLINA'
                                /*SNOTAETAPA.NOTAFALTA AS NOTA*/
FROM   SMATRICULA
	   INNER JOIN SMATRICPL (NOLOCK)
			   ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
				  AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
				  AND SMATRICPL.RA = SMATRICULA.RA
       INNER JOIN SHABILITACAOFILIAL (NOLOCK)
			   ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
				  AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL				  
       LEFT JOIN SNOTAETAPA (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
                  AND SMATRICULA.RA = SNOTAETAPA.RA
       INNER JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  /*AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL*/
       INNER JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS	   
WHERE  SMATRICULA.CODCOLIGADA ='1'
       AND STURMADISC.CODFILIAL =:CODFILIAL
       AND SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
       AND SPLETIVO.CODPERLET =:CODPERELT
	   AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO
       /*AND SNOTAETAPA.CODETAPA = '2'
       AND SNOTAETAPA.TIPOETAPA = 'N'   */    
       /*AND SMATRICULA.CODSTATUS IN  ('2','10','8','9','57','55')*/
       AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')";2361;;;;05/07/2022;consultor1.totvs;1;1;1;1;;;;0;c550aaa0-3896-4607-905d-3f66898b4b75;0;;-21207;consultor1.totvs;17/12/2021;consultor1.totvs;05/07/2022;0
S;AR.GRD.07;01 - Apuração de Resultados - Graduação - Por Período Letivo (Pensionato);"SELECT	DISTINCT
		SMATRICULA.CODCOLIGADA,
        SMATRICULA.RA,
        SMATRICULA.IDTURMADISC,
        STURMADISC.CODTURMA,
        SDISCIPLINA.NOME AS 'DISCIPLINA'                                
FROM   SMATRICULA
	   INNER JOIN SMATRICPL (NOLOCK)
			   ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
				  AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
				  AND SMATRICPL.RA = SMATRICULA.RA
				  AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
       INNER JOIN SHABILITACAOFILIAL (NOLOCK)
			   ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
				  AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL				  
	   INNER JOIN SCURSO (NOLOCK)
	   		   ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	   		   AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO       
       INNER JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
       INNER JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS	   
WHERE  1 = 1
       AND STURMADISC.CODFILIAL = :CODFILIAL
       AND SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
       AND SPLETIVO.CODPERLET = :CODPERELT
	   AND SCURSO.NOME LIKE '%Pensionato%'
        
       /*AND SMATRICULA.CODSTATUS IN  ('2','10','8','9','57','55')*/
       AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')";2048;;;;24/01/2022;consultor1.totvs;1;1;1;1;;;;0;9ec51ae9-6c3f-4fea-9b4c-ede7882ccf36;0;;-17854;consultor1.totvs;24/01/2022;consultor1.totvs;24/01/2022;0
S;AR.GRD.08;03 - (Alunos c/ status) - Apuração de Resultados - Graduação - Verifica Conclusão - Por (Turma Gerencial);"SELECT	
        DISTINCT
		SMATRICULA.CODCOLIGADA,
        SMATRICULA.RA,
        SMATRICULA.IDTURMADISC,
        STURMADISC.CODTURMA,
        SDISCIPLINA.NOME AS 'DISCIPLINA', 
		STURMADISC.IDTURMADISC

FROM   SMATRICULA
       LEFT JOIN SNOTAETAPA (NOLOCK) ON 
			SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
            AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
            AND SMATRICULA.RA = SNOTAETAPA.RA       
	   INNER JOIN STURMADISC (NOLOCK) ON
			STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC		
			AND STURMADISC.IDPERLET = SMATRICULA.IDPERLET
		LEFT JOIN STURMADISCGERENCIADA (NOLOCK) ON
			STURMADISCGERENCIADA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND STURMADISCGERENCIADA.IDTURMADISCGERENCIADA = STURMADISC.IDTURMADISC	
		LEFT JOIN STURMADISC STURMA_G (NOLOCK) ON
			STURMADISCGERENCIADA.CODCOLIGADA = STURMA_G.CODCOLIGADA
			AND STURMADISCGERENCIADA.IDTURMADISC = STURMA_G.IDTURMADISC
	    INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = SMATRICULA.IDPERLET       
	   INNER JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC       
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
WHERE  1 = 1
	   AND SNOTAETAPA.CODCOLIGADA ='1'
       /*AND STURMADISC.CODFILIAL = 1--:CODFILIAL*/
       AND SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
       AND SPLETIVO.CODPERLET = :CODPERELT
       AND STURMA_G.CODTURMA = :CODTURMA  	   
       AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')";1912;;;;27/01/2022;consultor1.totvs;1;1;1;1;;;;0;5fada74a-81bb-46ac-89e6-72bb1f106bad;0;;-24660;consultor1.totvs;27/01/2022;consultor1.totvs;27/01/2022;0
S;AR.GRD.09;01 - Apuração de Resultados - Graduação - Por Período Letivo (Cursos Livres);"SELECT	DISTINCT
		SMATRICULA.CODCOLIGADA,
        SMATRICULA.RA,
        SMATRICULA.IDTURMADISC,
        STURMADISC.CODTURMA,
        SDISCIPLINA.NOME AS 'DISCIPLINA',
        PPESSOA.NOME
FROM   SMATRICULA
	   INNER JOIN SMATRICPL (NOLOCK)
			   ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
				  AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
				  AND SMATRICPL.RA = SMATRICULA.RA
				  AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
       INNER JOIN SHABILITACAOFILIAL (NOLOCK)
			   ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
				  AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL				  
	   INNER JOIN SCURSO (NOLOCK)
	   		   ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	   		   AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO       
       INNER JOIN STURMADISC (NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
                  AND SMATRICULA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
       INNER JOIN SDISCIPLINA (NOLOCK)
               ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
       INNER JOIN SPLETIVO (NOLOCK)
               ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
       LEFT JOIN SSTATUS (NOLOCK) 
			   ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			   AND SSTATUS.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
			   AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS	 
	INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
		AND SALUNO.RA = SMATRICPL.RA
	INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
WHERE  1 = 1
       AND STURMADISC.CODFILIAL = :CODFILIAL
       AND SPLETIVO.CODTIPOCURSO = :CODNIVELENSINO
       AND SPLETIVO.CODPERLET = :CODPERELT
	   AND SCURSO.NOME LIKE '%' + :CURSOLIVRE + '%'
        
       /*AND SMATRICULA.CODSTATUS IN  ('2','10','8','9','57','55')*/
       AND SSTATUS.DESCRICAO IN('Cursando','Concluído','Aprovado','Reprovado','Reprovado por Nota','Reprovado por Falta')";2220;;;;27/04/2022;consultor1.totvs;1;1;1;1;;;;0;9950600d-3aac-4779-8080-4c1a09d2f5b9;0;;-16147;consultor1.totvs;27/04/2022;consultor1.totvs;27/04/2022;0
S;Atribuição;Atribuição de Professor;"select 
	CODPERLET Período, NomFilial Filial, CodCurso, NomCurso Curso, CODTURMA, NomTurma Turma, CODDISC, NomDisciplina, td.NUMCREDITOS Creditos, p.NOME Professor, pt.TIPOPROF, pt.STATUS, prof.CODTITULACAO
from 
	v_unasp_STURMADISC td
	left join SPROFESSORTURMA pt on pt.CODCOLIGADA=td.CODCOLIGADA and pt.IDTURMADISC=td.IDTURMADISC
	left join SPROFESSOR prof on prof.CODCOLIGADA = pt.CODCOLIGADA and prof.CODPROF=pt.CODPROF
	left join PPESSOA p on p.CODIGO = prof.CODPESSOA
where 
	CODPERLET = :CODPERLET and CODTIPOCURSO = :CODTIPOCURSO
order by 
	NomFilial, CodCurso, CODTURMA, CODDISC";598;;;;17/11/2021;mestre;1;1;1;1;;;;1;e1cb4d83-2222-4505-94ee-0f14f8e00122;0;;9724;mestre;17/11/2021;mestre;17/11/2021;0
S;AtuCredFinMatric;Atualiza NUMCREDITOSCOB da SDISCGRADE para Matricula ;Select * from z_Unasp_UpdateNUMCREDITOSCOB_SMATRICULA;53;;;;11/08/2022;isaldo;1;1;1;1;;;;0;2801584c-36c2-45bb-9adc-66da28adfca0;0;;-15501;isaldo;11/08/2022;isaldo;11/08/2022;0
S;AVAINST.001;Total de Respostas por Curso por Prova - Avaliação Instuticional -15, 24 e 25;"


SELECT DISTINCT
	STURMADISC.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	ISNULL(A.TOTALRESPONDIDO,0) AS 'RESP. TOTAL',
	ISNULL(C.TOTALRESPPARTE,0) AS 'RESP PARTE',
	ISNULL(B.TOTALEMEXEC,0) AS 'NAO RESPONDERAM',
	(ISNULL(A.TOTALRESPONDIDO,0) + ISNULL(C.TOTALRESPPARTE,0) + ISNULL(B.TOTALEMEXEC,0)) AS 'TOTAL LIBERADO',
	CAST(CAST(CAST((100 * ISNULL(A.TOTALRESPONDIDO,0)) AS FLOAT) / 
	CAST((ISNULL(A.TOTALRESPONDIDO,0) + ISNULL(B.TOTALEMEXEC,0) + ISNULL(C.TOTALRESPPARTE,0)) AS FLOAT) AS DECIMAL(10,2)) AS VARCHAR) + '%' AS 'PERC. RESPONDIDO'
	
FROM
STURMADISC (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO

LEFT JOIN(

SELECT 
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	COUNT(DISTINCT BHISTORICO.CODPESSOA) AS 'TOTALRESPONDIDO'
FROM BHISTORICO (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BHISTORICO.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BHISTORICO.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
	


LEFT JOIN (

SELECT DISTINCT
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	BEXECPROVA.CODPESSOA
FROM BEXECPROVA (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BEXECPROVA.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BEXECPROVA.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
WHERE BEXECPROVA.CODPROVA =  :CODPROVA
) AS B ON B.CODCOLIGADA = BHISTORICO.CODCOLIGADA
	AND B.CURSO = SCURSO.NOME
	AND B.TURNO = STURNO.NOME
	AND B.CODTURMA = STURMADISC.CODTURMA
	AND B.CODCURSO = SCURSO.CODCURSO
	AND B.CODPESSOA = BHISTORICO.CODPESSOA
	
	
WHERE 
BHISTORICO.CODPROVA = :CODPROVA
AND B.CODPESSOA IS NULL
GROUP BY
	BHISTORICO.CODCOLIGADA,
	STURMADISC.CODTURMA,
	STURNO.NOME,
	SCURSO.CODCURSO,
	SCURSO.NOME
) AS A ON A.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND A.CURSO = SCURSO.NOME
	AND A.TURNO = STURNO.NOME
	AND A.CODTURMA = STURMADISC.CODTURMA
	AND A.CODCURSO = SCURSO.CODCURSO


	
LEFT JOIN (

SELECT 
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	COUNT(DISTINCT BEXECPROVA.CODPESSOA) AS 'TOTALEMEXEC'
FROM BEXECPROVA (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BEXECPROVA.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BEXECPROVA.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
	
LEFT JOIN (

SELECT DISTINCT
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	BHISTORICO.CODPESSOA
FROM BHISTORICO (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BHISTORICO.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BHISTORICO.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
WHERE BHISTORICO.CODPROVA =  :CODPROVA
) AS B ON B.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
	AND B.CURSO = SCURSO.NOME
	AND B.TURNO = STURNO.NOME
	AND B.CODTURMA = STURMADISC.CODTURMA
	AND B.CODCURSO = SCURSO.CODCURSO
	AND B.CODPESSOA = BEXECPROVA.CODPESSOA
	
WHERE BEXECPROVA.CODPROVA = :CODPROVA
AND B.CODPESSOA IS NULL

GROUP BY
	BEXECPROVA.CODCOLIGADA,
	STURMADISC.CODTURMA,
	SCURSO.CODCURSO,
	STURNO.NOME,
	SCURSO.NOME

) AS B ON B.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND B.CURSO = SCURSO.NOME
	AND B.TURNO = STURNO.NOME
	AND B.CODTURMA = STURMADISC.CODTURMA
	AND B.CODCURSO = SCURSO.CODCURSO






LEFT JOIN(

SELECT 
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	COUNT(DISTINCT BHISTORICO.CODPESSOA) AS 'TOTALRESPPARTE'
FROM BHISTORICO (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BHISTORICO.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BHISTORICO.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
	

LEFT JOIN (

SELECT DISTINCT
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	BEXECPROVA.CODPESSOA
FROM BEXECPROVA (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BEXECPROVA.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BEXECPROVA.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
WHERE BEXECPROVA.CODPROVA =  :CODPROVA

) AS B ON B.CODCOLIGADA = BHISTORICO.CODCOLIGADA
	AND B.CURSO = SCURSO.NOME
	AND B.TURNO = STURNO.NOME
	AND B.CODTURMA = STURMADISC.CODTURMA
	AND B.CODCURSO = SCURSO.CODCURSO
	AND B.CODPESSOA = BHISTORICO.CODPESSOA
	
WHERE 
BHISTORICO.CODPROVA = :CODPROVA
AND B.CODPESSOA IS NOT NULL
GROUP BY
	BHISTORICO.CODCOLIGADA,
	STURMADISC.CODTURMA,
	STURNO.NOME,
	SCURSO.CODCURSO,
	SCURSO.NOME
) AS C ON C.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND C.CURSO = SCURSO.NOME
	AND C.TURNO = STURNO.NOME
	AND C.CODTURMA = STURMADISC.CODTURMA
	AND C.CODCURSO = SCURSO.CODCURSO


WHERE 1=1
AND (A.CODCOLIGADA IS NOT NULL OR B.CODCOLIGADA IS NOT NULL)
	
ORDER BY 2,4";9970;;;;15/06/2022;consultor1.totvs;1;1;1;1;;;;0;f8ded7de-1396-4529-a5ff-76e7125f3a5b;0;;-29869;consultor1.totvs;08/06/2022;maik.souza;31/08/2022;0
S;AVAINST.002;Total de Respostas por Curso Turma e Professor - Avaliação Institucional - 15, 24 e 25;"


SELECT DISTINCT
	STURMADISC.CODCOLIGADA,
	PPESSOA.NOME AS 'PROFESSOR',
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	ISNULL(A.TOTALRESPONDIDO,0) AS 'TOTAL RESP',
	ISNULL(B.TOTALEMEXEC,0) AS 'NAO RESPONDERAM',
	(ISNULL(A.TOTALRESPONDIDO,0) + ISNULL(B.TOTALEMEXEC,0)) AS 'TOTAL LIBERADO',
	CAST(CAST(CAST((100 * ISNULL(A.TOTALRESPONDIDO,0)) AS FLOAT) / 
	CAST((ISNULL(A.TOTALRESPONDIDO,0) + ISNULL(B.TOTALEMEXEC,0)) AS FLOAT) AS DECIMAL(10,2)) AS VARCHAR) + '%' AS 'PERC. RESPONDIDO'
	
FROM
STURMADISC (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
LEFT JOIN(

SELECT 
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	SOBJETOAVALIADO.CODPROF,
	COUNT(DISTINCT BHISTORICO.CODPESSOA) AS 'TOTALRESPONDIDO'
FROM BHISTORICO (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BHISTORICO.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BHISTORICO.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO

WHERE 
BHISTORICO.CODPROVA = :CODPROVA
GROUP BY
	BHISTORICO.CODCOLIGADA,
	STURMADISC.CODTURMA,
	STURNO.NOME,
	SOBJETOAVALIADO.CODPROF,
	SCURSO.CODCURSO,
	SCURSO.NOME
) AS A ON A.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND A.CURSO = SCURSO.NOME
	AND A.TURNO = STURNO.NOME
	AND A.CODTURMA = STURMADISC.CODTURMA
	AND A.CODCURSO = SCURSO.CODCURSO
	AND A.CODPROF = SPROFESSORTURMA.CODPROF


	
LEFT JOIN (

SELECT 
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	SOBJETOAVALIADO.CODPROF,
	COUNT(DISTINCT BEXECPROVA.CODPESSOA) AS 'TOTALEMEXEC'
FROM BEXECPROVA (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BEXECPROVA.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BEXECPROVA.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
WHERE BEXECPROVA.CODPROVA =  :CODPROVA

GROUP BY
	BEXECPROVA.CODCOLIGADA,
	STURMADISC.CODTURMA,
	SCURSO.CODCURSO,
	SOBJETOAVALIADO.CODPROF,
	STURNO.NOME,
	SCURSO.NOME

) AS B ON B.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND B.CURSO = SCURSO.NOME
	AND B.TURNO = STURNO.NOME
	AND B.CODTURMA = STURMADISC.CODTURMA
	AND B.CODCURSO = SCURSO.CODCURSO
	AND B.CODPROF = SPROFESSORTURMA.CODPROF

	
WHERE 1=1
AND (A.CODCOLIGADA IS NOT NULL OR B.CODCOLIGADA IS NOT NULL)
	
ORDER BY 2,4";4657;;;;15/06/2022;consultor1.totvs;1;1;1;1;;;;0;e18af6f6-5f4d-47c9-a562-ad93d49b3f49;0;;124;consultor1.totvs;13/06/2022;maik.souza;27/09/2022;0
S;AVAINST.003;Total Respondido Avaliação Por Curso - 23;"


SELECT DISTINCT
	SCURSO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	ISNULL(A.TOTALRESPONDIDO,0) AS 'TOTAL RESP',
	ISNULL(B.TOTALEMEXEC,0) AS 'NAO RESPONDERAM',
	(ISNULL(A.TOTALRESPONDIDO,0) + ISNULL(B.TOTALEMEXEC,0)) AS 'TOTAL LIBERADO',
	CAST(CAST(CAST((100 * ISNULL(A.TOTALRESPONDIDO,0)) AS FLOAT) / 
	CAST((ISNULL(A.TOTALRESPONDIDO,0) + ISNULL(B.TOTALEMEXEC,0)) AS FLOAT) AS DECIMAL(10,2)) AS VARCHAR) + '%' AS 'PERC. RESPONDIDO'
	
FROM
SCURSO
LEFT JOIN(

SELECT 
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	COUNT(DISTINCT BHISTORICO.CODPESSOA) AS 'TOTALRESPONDIDO'
FROM BHISTORICO (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BHISTORICO.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BHISTORICO.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND SCURSO.CODCURSO = SOBJETOAVALIADO.CODCURSO
WHERE 
BHISTORICO.CODPROVA = :CODPROVA
GROUP BY
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME
) AS A ON A.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND A.CURSO = SCURSO.NOME
	AND A.CODCURSO = SCURSO.CODCURSO


	
LEFT JOIN (

SELECT 
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	COUNT(DISTINCT BEXECPROVA.CODPESSOA) AS 'TOTALEMEXEC'
FROM BEXECPROVA (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BEXECPROVA.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BEXECPROVA.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND SCURSO.CODCURSO = SOBJETOAVALIADO.CODCURSO
WHERE BEXECPROVA.CODPROVA =  :CODPROVA

GROUP BY
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME

) AS B ON B.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND B.CURSO = SCURSO.NOME
	AND B.CODCURSO = SCURSO.CODCURSO

	
WHERE 1=1
AND (A.CODCOLIGADA IS NOT NULL OR B.CODCOLIGADA IS NOT NULL)
	
ORDER BY 2,4";2312;;;;15/06/2022;consultor1.totvs;1;1;1;1;;;;0;36453f5c-3f21-468a-ae58-c2f95b2a72bd;0;;19955;consultor1.totvs;14/06/2022;maik.souza;27/09/2022;0
S;AVAINST.004;Total Respondido por Curso e Turma - 23;"


SELECT DISTINCT
	SCURSO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURMA.CODTURMA,
	ISNULL(A.TOTALRESPONDIDO,0) AS 'TOTAL RESP',
	ISNULL(B.TOTALEMEXEC,0) AS 'NAO RESPONDERAM',
	(ISNULL(A.TOTALRESPONDIDO,0) + ISNULL(B.TOTALEMEXEC,0)) AS 'TOTAL LIBERADO',
	CAST(CAST(CAST((100 * ISNULL(A.TOTALRESPONDIDO,0)) AS FLOAT) / 
	CAST((ISNULL(A.TOTALRESPONDIDO,0) + ISNULL(B.TOTALEMEXEC,0)) AS FLOAT) AS DECIMAL(10,2)) AS VARCHAR) + '%' AS 'PERC. RESPONDIDO'
	
FROM
STURMA (NOLOCK)
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMA.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMA.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

LEFT JOIN(

SELECT 
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	SMATRICPL.CODTURMA,
	COUNT(DISTINCT BHISTORICO.CODPESSOA) AS 'TOTALRESPONDIDO'
FROM BHISTORICO (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BHISTORICO.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BHISTORICO.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND SCURSO.CODCURSO = SOBJETOAVALIADO.CODCURSO
	INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = BHISTORICO.CODCOLIGADA
	AND SALUNO.CODPESSOA = BHISTORICO.CODPESSOA
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIAL.CODCURSO = SOBJETOAVALIADO.CODCURSO
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE BHISTORICO.CODPROVA =  :CODPROVA
AND SPLETIVO.CODPERLET = :CODPERLET
/*AND SSTATUS.DESCRICAO LIKE '%CURSANDO%'*/

GROUP BY
	BHISTORICO.CODCOLIGADA,
	SCURSO.CODCURSO,
	SMATRICPL.CODTURMA,
	SCURSO.NOME
) AS A ON A.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND A.CURSO = SCURSO.NOME
	AND A.CODCURSO = SCURSO.CODCURSO
	AND A.CODTURMA = STURMA.CODTURMA


	
LEFT JOIN (
SELECT 
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SMATRICPL.CODTURMA,
	SCURSO.NOME AS 'CURSO',
	COUNT(DISTINCT BEXECPROVA.CODPESSOA) AS 'TOTALEMEXEC'
FROM BEXECPROVA (NOLOCK)
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BEXECPROVA.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BEXECPROVA.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND SCURSO.CODCURSO = SOBJETOAVALIADO.CODCURSO
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
	AND SALUNO.CODPESSOA = BEXECPROVA.CODPESSOA
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIAL.CODCURSO = SOBJETOAVALIADO.CODCURSO
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE BEXECPROVA.CODPROVA =  :CODPROVA
AND SPLETIVO.CODPERLET = :CODPERLET
/*AND SSTATUS.DESCRICAO LIKE '%CURSANDO%'*/
GROUP BY
	BEXECPROVA.CODCOLIGADA,
	SCURSO.CODCURSO,
	SMATRICPL.CODTURMA,
	SCURSO.NOME

) AS B ON B.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND B.CURSO = SCURSO.NOME
	AND B.CODCURSO = SCURSO.CODCURSO
	AND B.CODTURMA = STURMA.CODTURMA

	
WHERE 1=1
AND (A.CODCOLIGADA IS NOT NULL OR B.CODCOLIGADA IS NOT NULL)
	
ORDER BY 2,4";4880;;;;26/09/2022;maik.souza;1;1;1;1;;;;0;d691a6e6-732e-4231-a2ca-a6dcd8df4db4;0;;-27402;consultor1.totvs;14/06/2022;maik.souza;26/09/2022;0
S;AVAINST.005;Respostas por Questões e Professores Avaliação Institucional - 15, 24 e 25;"SELECT 
	BH.CODPESSOA,
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	SALUNO.RA,
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	STURNO.NOME AS 'TURNO',
	STURMADISC.CODTURMA,
	STURMADISC.CODDISC,
	SDISCIPLINA.NOME AS 'DISCIPLINA',
	P2.NOME AS 'PROFESSOR',
	BQ.CODQUESTAO,
	BQ.TEXTO AS 'QUESTAO',
	BRP.CODRESPOSTA,
	BMEMO.VALMEMO 'RESPOSTA DISSERTATIVA'
FROM 
	BHISTRESPPROVA BRP (NOLOCK)
	LEFT JOIN BMEMO (NOLOCK) ON BMEMO.ID = BRP.IDMEMORESPABERTA
		INNER JOIN BQUESTAO BQ (NOLOCK) ON BQ.CODCOLIGADA = BRP.CODCOLIGADA
		AND BQ.CODAREA = BRP.CODAREA
		AND BQ.CODMATERIA = BRP.CODMATERIA
		AND BQ.CODQUESTAO = BRP.CODQUESTAO
	INNER JOIN BDEFQUESTAO (NOLOCK) ON BDEFQUESTAO.CODCOLIGADA = BQ.CODCOLIGADA
		AND BDEFQUESTAO.CODAREA = BQ.CODAREA
		AND BDEFQUESTAO.CODMATERIA = BQ.CODMATERIA
		AND BDEFQUESTAO.CODQUESTAO = BQ.CODQUESTAO
		AND BDEFQUESTAO.CODPROVA = BRP.CODPROVA
	INNER JOIN BHISTORICO BH (NOLOCK) ON BH.CODCOLIGADA = BRP.CODCOLIGADA
		AND BH.CODAREA = BRP.CODAREA
		AND BH.CODMATERIA = BRP.CODMATERIA
		AND BH.CODQUESTAO = BRP.CODQUESTAO
		AND BH.CODPROVA = BRP.CODPROVA
		AND BH.ID = BRP.ID
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BH.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BH.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SOBJETOAVALIADO.IDTURMADISC
INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = BH.CODCOLIGADA
	AND SALUNO.CODPESSOA = BH.CODPESSOA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND SPROFESSOR.CODPROF = SOBJETOAVALIADO.CODPROF
INNER JOIN PPESSOA P2 (NOLOCK) ON P2.CODIGO = SPROFESSOR.CODPESSOA

WHERE BH.CODPROVA = :CODPROVA

ORDER BY 
SCURSO.NOME,
PPESSOA.NOME,
STURMADISC.CODDISC,
P2.NOME,
BDEFQUESTAO.SEQQUESTAOPROVA
";2955;;;;27/09/2022;consultor1.totvs;1;1;1;1;;;;0;980fae18-0846-40b4-8678-6ec5f3a2dbe9;0;;-9198;consultor1.totvs;15/06/2022;consultor1.totvs;27/09/2022;0
S;AVAINST.006;Respostas por Questões por Curso Avaliação Institucional - 23;"SELECT 
	BH.CODPESSOA,
	CASE LEFT(SCURSO.CODCURSO,2)
		WHEN 'SP' THEN 'UNASP SP'
		WHEN 'EC' THEN 'UNASP EC'
		WHEN 'HT' THEN 'UNASP HT'
		WHEN 'EA' THEN 'UNASP EAD'
		END 'UNIDADE',
	SALUNO.RA,
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.CODCURSO,
	SCURSO.NOME AS 'CURSO',
	
	SMATRICPL.CODTURMA,
	STURNO.NOME AS 'TURNO',
	BQ.CODQUESTAO,
	BQ.TEXTO AS 'QUESTAO',
	BRP.CODRESPOSTA,
	BMEMO.VALMEMO 'RESPOSTA DISSERTATIVA'
FROM 
	BHISTRESPPROVA BRP
	LEFT JOIN BMEMO (NOLOCK) ON BMEMO.ID = BRP.IDMEMORESPABERTA
		INNER JOIN BQUESTAO BQ (NOLOCK) ON BQ.CODCOLIGADA = BRP.CODCOLIGADA
		AND BQ.CODAREA = BRP.CODAREA
		AND BQ.CODMATERIA = BRP.CODMATERIA
		AND BQ.CODQUESTAO = BRP.CODQUESTAO
	INNER JOIN BDEFQUESTAO ON BDEFQUESTAO.CODCOLIGADA = BQ.CODCOLIGADA
		AND BDEFQUESTAO.CODAREA = BQ.CODAREA
		AND BDEFQUESTAO.CODMATERIA = BQ.CODMATERIA
		AND BDEFQUESTAO.CODQUESTAO = BQ.CODQUESTAO
		AND BDEFQUESTAO.CODPROVA = BRP.CODPROVA
	INNER JOIN BHISTORICO BH (NOLOCK) ON BH.CODCOLIGADA = BRP.CODCOLIGADA
		AND BH.CODAREA = BRP.CODAREA
		AND BH.CODMATERIA = BRP.CODMATERIA
		AND BH.CODQUESTAO = BRP.CODQUESTAO
		AND BH.CODPROVA = BRP.CODPROVA
		AND BH.ID = BRP.ID
INNER JOIN BOBJETOAVALIADO(NOLOCK) ON BH.CODCOLIGADA = BOBJETOAVALIADO.CODCOLIGADA
		AND BH.SEQOBJETOAVALIADO = BOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SOBJETOAVALIADO (NOLOCK) ON BOBJETOAVALIADO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
		AND BOBJETOAVALIADO.SEQOBJETOAVALIADO = SOBJETOAVALIADO.SEQOBJETOAVALIADO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SOBJETOAVALIADO.CODCOLIGADA
	AND SCURSO.CODCURSO = SOBJETOAVALIADO.CODCURSO
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = BH.CODCOLIGADA
	AND SALUNO.CODPESSOA = BH.CODPESSOA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SHABILITACAOFILIAL.CODCURSO = SOBJETOAVALIADO.CODCURSO
INNER JOIN STURNO ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE BH.CODPROVA =  :CODPROVA_N
AND SPLETIVO.CODPERLET = :CODPERLET
/*AND SSTATUS.DESCRICAO LIKE '%CURSANDO%'*/

ORDER BY 
SCURSO.NOME,
PPESSOA.NOME,
SMATRICPL.CODTURMA,
BDEFQUESTAO.SEQQUESTAOPROVA
";2970;;;;03/10/2022;maik.souza;1;1;1;1;;;;0;002be5db-0cfe-48d5-88a5-d0e6859b1e0f;0;;-31365;consultor1.totvs;15/06/2022;maik.souza;03/10/2022;0
S;BaixaDesconto;Descontos em Baixa;"SELECT
	mpl.RA, a.NOME, c.CODCONTRATO, l.MESDECOMPETENCIA, p.PARCELA,  p.DTVENCIMENTO,
	l.IDLAN, lb.IDBAIXA, s.CODSERVICO, s.NOME, s.CODCOLNATFINANCEIRA, s.CODNATFINANCEIRA, lb.VALORORIGINAL, lb.VALORDESCONTO, lb.VALORBAIXA
FROM 
	SMATRICPL				mpl	
	inner join v_Unasp_Aluno a on a.CODCOLIGADA=mpl.CODCOLIGADA and mpl.RA=a.RA
	inner join SCONTRATO	c	on c.CODCOLIGADA = mpl.CODCOLIGADA and c.IDPERLET = mpl.IDPERLET and c.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and c.RA = mpl.RA
	inner join SPARCELA		p	on p.CODCOLIGADA = c.CODCOLIGADA   and p.RA = c.RA and p.CODCONTRATO = c.CODCONTRATO and p.IDPERLET = c.IDPERLET
	inner join SSERVICO		s	on s.CODCOLIGADA = p.CODCOLIGADA and s.CODSERVICO = p.CODSERVICO
	inner join SLAN			sl	on sl.CODCOLIGADA = p.CODCOLIGADA  and sl.IDPARCELA = p.IDPARCELA
	inner join FLAN			l	on l.CODCOLIGADA = sl.CODCOLIGADA  and l.IDLAN = sl.IDLAN
	inner join FLANBAIXA	lb	on lb.CODCOLIGADA = l.CODCOLIGADA and lb.IDLAN = l.IDLAN
where 
	year(l.MESDECOMPETENCIA) = :Ano
	and Month(l.MESDECOMPETENCIA) = :Mes
	AND lb.VALORDESCONTO>0";1076;;;;08/12/2021;isaldo;1;1;1;1;;;;0;7d0d5941-ab52-4523-a788-60801aeb4f07;0;;19460;isaldo;08/12/2021;isaldo;08/12/2021;0
S;BaixasPorData;Baixas por Data;"Select 
	gf.NOME Filial, 
	pl.CODPERLET, 
	a.RA, 
	pp.Nome, 
	c.NOME Curso, 
	t.NOME Turma, 
	s.NOME Servico, 
	p.Parcela,
	fl.VALORORIGINAL,
	lb.VALORBAIXA,
	lb.DATABAIXA
FROM
	FLAN (NOLOCK)							 fl
	inner join FLANBAIXA			(NOLOCK) lb		on lb.CODCOLIGADA = fl.CODCOLIGADA and lb.IDLAN = fl.IDLAN
	inner JOIN SLAN					(NOLOCK) sl		on sl.IDLAN = fl.IDLAN AND sl.CODCOLIGADA = fl.CODCOLIGADA
	inner JOIN SPARCELA				(NOLOCK) p		on p.CODCOLIGADA = sl.CODCOLIGADA AND p.IDPARCELA = sl.IDPARCELA
	inner join SSERVICO				(NOLOCK) s		on s.CODCOLIGADA = p.CODCOLIGADA AND s.CODSERVICO = p.CODSERVICO
	inner join SCONTRATO			(NOLOCK) co		on co.CODCOLIGADA = p.CODCOLIGADA AND co.RA = p.RA AND co.CODCONTRATO = p.CODCONTRATO AND co.IDPERLET = p.IDPERLET
	inner join SMATRICPL			(NOLOCK) mpl	on mpl.CODCOLIGADA = co.CODCOLIGADA and mpl.IDPERLET=co.IDPERLET and mpl.IDHABILITACAOFILIAL = co.IDHABILITACAOFILIAL and mpl.RA=co.RA	
	inner join SHABILITACAOALUNO	(nolock) ha		on ha.CODCOLIGADA = mpl.CODCOLIGADA and ha.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and ha.RA = mpl.RA
	inner join SALUNO				(nolock) a		on a.CODCOLIGADA = ha.CODCOLIGADA and a.RA = ha.RA
	inner join PPESSOA				(nolock) pp		on pp.CODIGO=a.CODPESSOA
	inner join SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = ha.CODCOLIGADA and hf.IDHABILITACAOFILIAL = ha.IDHABILITACAOFILIAL
	inner join GFILIAL				(nolock) gf		on gf.CODCOLIGADA = fl.CODCOLIGADA and gf.CODFILIAL=fl.CODFILIAL
	inner join SCURSO				(nolock) c		on c.CODCOLIGADA = hf.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
	left  join STURMA				(nolock) t		on t.CODCOLIGADA = mpl.CODCOLIGADA and t.CODFILIAL = mpl.CODFILIAL and t.CODTURMA=mpl.CODTURMA and t.IDPERLET=mpl.IDPERLET
	inner join SPLETIVO				(NOLOCK) pl		ON pl.CODCOLIGADA = mpl.CODCOLIGADA AND pl.IDPERLET = mpl.IDPERLET
WHERE	
	fl.CODCOLIGADA = 1 AND fl.STATUSLAN <> 2 and fl.PAGREC = 1
  	AND lb.DATABAIXA >= convert(datetime, :DataInicio)
  	AND lb.DATABAIXA <= convert(datetime, :DataFim)
  	AND pl.CODPERLET LIKE :CODPERLET + '%'
	and s.NOME like '%' + :Servico + '%'
order by
	pp.NOME";2109;;;;25/03/2022;isaldo;1;1;1;1;;;;0;87fe6e98-87cf-4e77-b258-a571027bca40;0;;29302;isaldo;25/03/2022;isaldo;25/03/2022;0
S;BI_Matricula;Executa procedure para tabela do BI;select top 1 * from z_Unasp_Matricula;37;;;;23/02/2022;isaldo;1;1;1;1;;;;0;793c1c3c-63a4-4122-b348-8cacbcb89c46;0;;-7114;maycon;21/09/2021;isaldo;23/02/2022;0
S;Biblioteca.1;Alunos para Sincronizar com a biblioteca Sophia;"Select  * from v_Unasp_Biblioteca_API where DataRegistro >= :DataRegistro 
/*and CODIGO='01703464982'*/
/*
Matricula='175621'
DataRegistro >= :DataRegistro
*/";163;;;;28/07/2022;isaldo;1;1;1;1;;;;0;55ea395b-3dc3-4863-95d2-83e82e183c2c;0;;-16781;isaldo;05/04/2022;isaldo;28/07/2022;0
S;BlipCurso;Lista de Cursos Blip;"Select distinct	
	CODCURSO, NomCurso CURSO, NomTurno Turno
from 
	v_Unasp_SHABILITACAOFILIALPL
where 
	GETDATE() between PL_DTINICIO and isnull(PL_DTFIM,getdate()+1) 
	and HABILITACAOFILIAL_Ativo='S'
	and CODFILIAL = :CODFILIAL
	and CODTIPOCURSO = :CODTIPOCURSO
order by 
	NomCurso";291;;;;31/08/2022;isaldo;1;1;1;1;;;;0;381ddfe2-634f-4581-9bde-a19776dc16d2;0;;21922;isaldo;31/08/2022;isaldo;31/08/2022;0
S;Boleto;Boletos;;0;;;;23/03/2021;lucas.ssantos;1;1;1;1;;;;0;569143cb-44a7-449e-98bf-e35bebbf8b40;0;;32585;lucas.ssantos;23/03/2021;lucas.ssantos;23/03/2021;0
S;Boleto.001;Historico e Demonstrativo;"SELECT
	TOP 6 FL.CODCOLIGADA			CodColigada,
	FL.DATAEMISSAO					DataEmissao,
	FL.DATAVENCIMENTO				DataVencimento,
	FL.VALORORIGINAL				ValorOriginal,
	T.DESCRICAO						Descricao,   
	FL.STATUSLAN					CodStatus,
	PC.PARCELA						Parcela,
/*	F.RUA+ F.NUMERO+', '
		 +F.BAIRRO+'/'
		 +F.CIDADE+'-'
		 +F.ESTADO					Endereco,
*/
	ISNULL(F.RUA,'') + ', ' + ISNULL(F.NUMERO,'')+' - '
		 +ISNULL(F.BAIRRO,'')+' - '
		 +ISNULL(F.CIDADE,'')+'-'
		 +ISNULL(F.ESTADO,'')					Endereco,
	
	CASE FL.STATUSLAN 
		WHEN 0 THEN 'Aberto'
            WHEN 1 THEN 'Pago'
            WHEN 2 THEN 'Cancelado'
            WHEN 4 THEN 'Pago Parcial'
								END StatusBoleto,

    CASE FL.PAGREC 
		WHEN 1 THEN 'D'
        ELSE 'C' 
								END TipoBoleto

FROM FBOLETO B
	LEFT JOIN FLANBOLETO LB 
		ON LB.CODCOLIGADA = B.CODCOLIGADA
		AND LB.IDBOLETO = B.IDBOLETO

	LEFT JOIN FLAN FL 
		ON FL.CODCOLIGADA = LB.CODCOLIGADA
		AND FL.IDLAN = LB.IDLAN
		
	LEFT JOIN GFILIAL F
		 ON F.CODCOLIGADA = FL.CODCOLIGADA
		AND F.CODFILIAL = FL.CODFILIAL

 	LEFT JOIN FTDO T
		ON T.CODCOLIGADA = FL.CODCOLIGADA
        AND T.CODTDO = FL.CODTDO  
				
 	LEFT JOIN SLAN L
		ON L.CODCOLIGADA = FL.CODCOLIGADA
		AND L.IDLAN = FL.IDLAN  

 	LEFT JOIN SPARCELA PC
		ON PC.CODCOLIGADA = L.CODCOLIGADA
		AND PC.IDPARCELA = L.IDPARCELA 

 	LEFT JOIN SALUNO A
		ON A.CODCOLIGADA = PC.CODCOLIGADA
        AND A.RA = PC.RA

 	LEFT JOIN PPESSOA P
		ON P.CODIGO = A.CODPESSOA
        
WHERE 
	B.IDBOLETO = :IDBOLETO
	AND B.CODCOLIGADA = :CODCOLIGADA
	";1566;;;;05/05/2021;mestre;1;1;1;1;;;;0;ef5ecf7c-a3c1-447c-8a44-ff5db66dd6e1;0;;-10948;lucas.ssantos;23/03/2021;mestre;05/05/2021;0
S;Bolsa;Aplicação de Bolsa  - em lote;"SELECT SCONTRATO.CODCOLIGADA , SCONTRATO.IDPERLET, CODCONTRATO , STIPOMATRICULA.DESCRICAO , PPESSOA.NOME , SALUNO.RA, SCURSO.NOME FROM SCONTRATO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SCONTRATO.RA
INNER JOIN STIPOMATRICULA ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL  
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

WHERE SPLETIVO.CODPERLET =:PERIODOLETIVO
AND   STIPOMATRICULA.DESCRICAO LIKE '%REMATR%'
AND   SCONTRATO.CODFILIAL =:CODFILIAL
AND   SCURSO.NOME LIKE '%' + :PARTECURSO + '%'

";1227;;;;13/07/2021;mestre;1;1;1;1;;;;0;8d097734-2f2c-446c-8e8a-f4feba2837d8;0;;21043;mestre;13/07/2021;mestre;13/07/2021;0
S;BolsaFilantropia;Relatório de Bolsas Concedidas por Período (Filantropia);"Select distinct
	CODINEPALUNO CodCenso, 
	case when isnull(pp.NACIONALIDADE,10)<>10 then 'S' else 'N' end Estrangeiro,
	pp.CPF,
	resp.RespFinanceiroPrincipal,
	pp.Nome NomPessoa, 
	convert(date,  pp.DTNASCIMENTO) DTNASCIMENTO,
	'?' Emancipado,
	b.Nome Bolsa,
	pp.RUA,
	pp.CEP,
	pp.NUMERO,
	pp.BAIRRO,
	pp.CIDADE,
	pp.ESTADO,
	f.NOME		Campus,
	c.NOME		Curso	
FROM 
	SPARCELA 						(NOLOCK) p	
	inner JOIN SLAN 				(NOLOCK) sl	ON p.CODCOLIGADA = sl.CODCOLIGADA AND p.IDPARCELA = sl.IDPARCELA
	inner JOIN FLAN 				(NOLOCK) fl	ON sl.CODCOLIGADA = fl.CODCOLIGADA AND sl.IDLAN = fl.IDLAN
	inner JOIN SCONTRATO			(NOLOCK) ct	ON ct.CODCOLIGADA = p.CODCOLIGADA AND ct.RA = p.RA AND ct.CODCONTRATO = p.CODCONTRATO AND ct.IDPERLET = p.IDPERLET
	inner JOIN SMATRICPL			(NOLOCK) m	ON m.CODCOLIGADA = ct.CODCOLIGADA AND m.IDPERLET = ct.IDPERLET AND m.IDHABILITACAOFILIAL = ct.IDHABILITACAOFILIAL AND m.RA = ct.RA
	inner join GFILIAL				(NOLOCK) f	on f.CODFILIAL = m.CODFILIAL 
	inner join SALUNO				(NOLOCK) a	on a.CODCOLIGADA = m.CODCOLIGADA and a.RA = m.RA
	inner join PPESSOA				(NOLOCK) pp	on pp.CODIGO = a.CODPESSOA
	inner join SHABILITACAOFILIAL	(NOLOCK) hf	on hf.CODCOLIGADA=m.CODCOLIGADA and hf.IDHABILITACAOFILIAL = m.IDHABILITACAOFILIAL
	inner join SCURSO				(NOLOCK) c	on hf.CODCOLIGADA=c.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
	inner JOIN SPLETIVO 			(NOLOCK) pl	ON pl.CODCOLIGADA = ct.CODCOLIGADA AND pl.IDPERLET = ct.IDPERLET
	inner JOIN SSERVICO 			(NOLOCK) s	ON s.CODCOLIGADA = p.CODCOLIGADA AND s.CODSERVICO = p.CODSERVICO
	inner JOIN SSTATUS 				(NOLOCK) st	ON st.CODCOLIGADA = m.CODCOLIGADA AND st.CODSTATUS = m.CODSTATUS        
	left join  SBOLSALAN			(NOLOCK) bl on bl.CODCOLIGADA = sl.CODCOLIGADA and	bl.IDLAN = sl.IDLAN
	left join  SBOLSA				(NOLOCK) b  on bl.CODCOLIGADA = bl.CODCOLIGADA and	b.CODBOLSA = bl.CODBOLSA
	left join  SALUNOMEC			(NOLOCK) am on am.CODCOLIGADA = m.CODCOLIGADA and am.RA=m.RA
	left join (
		Select r.CODCOLIGADA, r.IDPARCELA, f.CGCCFO RespFinanceiroPrincipal from 
		(select CODCOLIGADA,	IDPARCELA, CODCFO, PERCENTUAL, row_number() over(partition by CODCOLIGADA,	IDPARCELA, CODCFO order by PERCENTUAL) Item	from sresponsavel(NOLOCK) ) r
		inner join fcfo (NOLOCK) f on f.CODCFO = r.CODCFO) resp on resp.CODCOLIGADA = p.CODCOLIGADA and resp.IDPARCELA = p.IDPARCELA
Where
	year(p.DTVENCIMENTO) = :ANO and MONTH(p.DTVENCIMENTO) in ( :MESINICIAL, :MESFINAL)
	and bl.CODBOLSA in (1,2,3,4,141,143,144)
order by pp.NOME";2492;;;;11/03/2022;isaldo;1;1;1;1;;;;0;bc407a55-6037-4e4c-ba84-92596656bb11;0;;-2748;isaldo;11/03/2022;isaldo;11/03/2022;0
S;BOLSAFUTURA;Assistente de Bolsa Futura;"SELECT DISTINCT
	SALUNO.CODCOLIGADA,
	SHABILITACAOFILIAL.CODFILIAL,
	SALUNO.RA, 
	PPESSOA.NOME 
FROM 
	SMATRICPL
	INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
	INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA 
	INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE 
	CODPERLET = :PL
	AND SHABILITACAOFILIAL.CODFILIAL = :CODFILIAL
	AND SSTATUS.DESCRICAO = 'Cursando'
	AND SHABILITACAOFILIAL.CODTIPOCURSO = :CODTIPOCURSO
";829;;;;01/04/2022;isaldo;1;1;1;1;;;;0;56f2f231-f39f-4473-9204-ea4b23096bd9;0;;-6330;mestre;02/06/2021;isaldo;01/04/2022;0
S;BolsaFutura.2;Concessão de Bolsa - Promoção rematrícula (POR MATRIZ);"SELECT SMATRICPL.CODCOLIGADA  ,  SMATRICPL.RA , PPESSOA.NOME , SHABILITACAOFILIAL.CODHABILITACAO , SGRADE.DESCRICAO FROM SMATRICPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SGRADE ON SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
WHERE SPLETIVO.CODPERLET =:PeriodoLetivo
AND   SSTATUS.DESCRICAO LIKE '%' + :STATUS + '%'
AND   SGRADE.CODGRADE =:MATRIZ

GROUP BY SMATRICPL.CODCOLIGADA  ,  SMATRICPL.RA , PPESSOA.NOME  , SHABILITACAOFILIAL.CODHABILITACAO,  SGRADE.DESCRICAO

";1104;;;;03/09/2021;lilian.buzetti;1;1;1;1;;;;0;4a4b8388-1615-471d-9480-b4f7ee429647;0;;4042;lilian.buzetti;02/09/2021;lilian.buzetti;03/09/2021;0
S;BolsaLan;Desconto comercial concedido;"Select 
	filial, RA, Aluno, MesVencimento, VALORORIGINAL, ValorDesconto, DESCONTO, TIPODESC, CODBOLSA, Bolsa, Curso, CodCLASSIFICACAO, CLASSIFICACAO
from 
	v_unasp_SBOLSALAN
where 
	CODPERLET in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' ))
	and TipoMatricula = :TipoMatricula
	and CODTIPOCURSO like :CODTIPOCURSO
	and ValorDesconto is not null
	and AnoVencimento = :AnoVencimento
	and MesVencimento = :MesVencimento	
	and CodCLASSIFICACAO = :CodCLASSIFICACAO";484;;;;29/09/2022;mestre;1;1;1;1;;;;0;7d1d303d-a8f0-455b-ba51-c6261cade508;0;;-2237;mestre;29/09/2022;mestre;29/09/2022;0
S;BolsaLanRes;Desconto comercial concedido - Resumo;"Select 
	Filial, Sum(VALORORIGINAL) VALORORIGINAL, sum(ValorDesconto) ValorDesconto, sum(ValorDesconto) * 100 /  Sum(VALORORIGINAL) Percentual
from 
	v_unasp_SBOLSALAN
where 
	CODPERLET in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' ))
	and TipoMatricula = :TipoMatricula
	and CODTIPOCURSO like :CODTIPOCURSO
	and ValorDesconto is not null
	and AnoVencimento = :AnoVencimento
	and MesVencimento = :MesVencimento	
	and CodCLASSIFICACAO = :CodCLASSIFICACAO
group by
	Filial";497;;;;29/09/2022;mestre;1;1;1;1;;;;0;21ce760c-008b-4b34-86f4-e7637f16dd96;0;;27856;mestre;28/09/2022;mestre;29/09/2022;0
S;BolsaPeriodo;Bolsas do Período;"select 
	v.NomFilial 	Filial,
	v.NomCurso		Curso,
	v.NomTurno		Turno,
	v.RA,
	v.NomPessoa		Aluno,
	v.CODPERLET		Período,
	ba.CODBOLSA,
	b.NOME			Bolsa,
	s.CODSERVICO,
	s.NOME			Serviço,
	ba.TIPODESC		Tipo,
	ba.DESCONTO		Desconto,
	ba.CODUSUARIO	Usuário,
	ba.DATACONCESSAO,
	V.NomStatus,
	1 Registro
from 
	v_Unasp_SMATRICPL v
	inner join SCONTRATO c on c.CODCOLIGADA = v.CODCOLIGADA and c.IDPERLET = v.IDPERLET and c.IDHABILITACAOFILIAL = v.IDHABILITACAOFILIAL and c.RA=v.RA
	inner join SBOLSAALUNO ba on ba.CODCOLIGADA = c.CODCOLIGADA and ba.RA = c.RA and ba.CODCONTRATO = c.CODCONTRATO and ba.IDPERLET = c.IDPERLET
	inner join SBOLSA b on b.CODCOLIGADA = ba.CODCOLIGADA and b.CODBOLSA=ba.CODBOLSA
	inner join SSERVICO s on s.CODCOLIGADA = ba.CODCOLIGADA and s.CODSERVICO=ba.CODSERVICO
where CODPERLET = :CODPERLET";838;;;;11/10/2022;robson.canto;1;1;1;1;;;;1;0ecf8332-ad39-43f4-a027-c21e13273426;0;;5967;mestre;26/11/2021;robson.canto;11/10/2022;0
S;Bolsas;Alunos x Bolsas;"Select 
	v.*, 
	1 Cursando,
	case when ba.Bolsa100>0 then 1 else 0 end TemBolsa100,
	case when ba.Bolsa50>0 then 1 else 0 end TemBolsa50,
	case when ba.Dissidio50>0 then 1 else 0 end TemDissidio50,
	case when ba.Dissidio70>0 then 1 else 0 end TemDissidio70,
	case when ba.Dissidio100>0 then 1 else 0 end TemDissidio100,
	case when ba.PROUNI100>0 then 1 else 0 end TemPROUNI100,
	case when ba.PROUNI50>0 then 1 else 0 end TemPROUNI50,
	case when ba.RA is null then 0 else 1 end TemBolsa
from 
	v_Unasp_SMATRICPL (nolock) v
	left join (	
		Select 
			c.CODCOLIGADA, c.IDPERLET, c.IDHABILITACAOFILIAL, c.RA,
			sum(case when b.NOME like '%100%' and b.NOME not like '%PROUNI%' and b.CODBOLSA not in (141,142,143,144,145,146,147,148,149,150) then 1 else 0 end) Bolsa100,
			sum(case when b.NOME like '%50%'  and b.NOME not like '%PROUNI%' then 1 else 0 end) Bolsa50,
			sum(case when b.CODBOLSA in (141,146) then 1 else 0 end) Dissidio50,
			sum(case when b.CODBOLSA in (142,145,150,147) then 1 else 0 end) Dissidio70,
			sum(case when b.CODBOLSA in (148,149,143,144) then 1 else 0 end) Dissidio100,
			
			sum(case when b.NOME like '%PROUNI 100%' then 1 else 0 end) PROUNI100,
			sum(case when b.NOME like '%PROUNI 50%' then 1 else 0 end) PROUNI50
		from 
			SCONTRATO 				(nolock) c 
			inner join SBOLSAALUNO	(nolock) ba on ba.CODCOLIGADA = c.CODCOLIGADA and ba.RA=c.RA and ba.CODCONTRATO = c.CODCONTRATO and ba.IDPERLET=c.IDPERLET
			inner join SBOLSA 		(nolock) b on b.CODBOLSA=ba.CODBOLSA
			inner join SPLETIVO 	(nolock) pl on pl.IDPERLET=ba.IDPERLET
		Where
			ba.Ativa='S'
		Group By
			c.CODCOLIGADA, c.IDPERLET, c.IDHABILITACAOFILIAL, c.RA) ba on ba.CODCOLIGADA = v.CODCOLIGADA and ba.IDPERLET = v.IDPERLET and ba.IDHABILITACAOFILIAL = v.IDHABILITACAOFILIAL and ba.RA = v.RA
Where
	CODPERLET=:CODPERLET
	and NomStatus='Cursando'";1869;;;;22/12/2021;robson.canto;1;1;1;1;;;;0;525d8a47-b700-49aa-86d3-966bc96d1a4f;0;;18346;mestre;06/08/2021;robson.canto;22/12/2021;0
S;BolsasConcedidas;Relatório de Bolsas Concedidas por Período;"Select distinct
	m.RA,
	pp.Nome, 
	pl.CODPERLET,
	YEAR(p.DTVENCIMENTO) Ano,
	MONTH(p.DTVENCIMENTO) Mes,
	p.PARCELA,
	p.DTVENCIMENTO,
	b.CODBOLSA,
	b.Nome Bolsa,
	bl.TIPOBOLSA,
	bl.TIPODESC,
	bl.VALORORIGINALPARCELA,
	bl.VALORBASECALCULO,
	bl.DESCONTO,
	c.NOME Curso,
	m.CODTURMA Turma
FROM 
	SPARCELA 						(NOLOCK) p	
	inner JOIN SLAN 				(NOLOCK) sl	ON p.CODCOLIGADA = sl.CODCOLIGADA AND p.IDPARCELA = sl.IDPARCELA
	inner JOIN FLAN 				(NOLOCK) fl	ON sl.CODCOLIGADA = fl.CODCOLIGADA AND sl.IDLAN = fl.IDLAN
	inner JOIN SCONTRATO			(NOLOCK) ct	ON ct.CODCOLIGADA = p.CODCOLIGADA AND ct.RA = p.RA AND ct.CODCONTRATO = p.CODCONTRATO AND ct.IDPERLET = p.IDPERLET
	inner JOIN SMATRICPL			(NOLOCK) m	ON m.CODCOLIGADA = ct.CODCOLIGADA AND m.IDPERLET = ct.IDPERLET AND m.IDHABILITACAOFILIAL = ct.IDHABILITACAOFILIAL AND m.RA = ct.RA
	inner join GFILIAL				(NOLOCK) f	on f.CODFILIAL = m.CODFILIAL 
	inner join SALUNO				(NOLOCK) a	on a.CODCOLIGADA = m.CODCOLIGADA and a.RA = m.RA
	inner join PPESSOA				(NOLOCK) pp	on pp.CODIGO = a.CODPESSOA
	inner join SHABILITACAOFILIAL	(NOLOCK) hf	on hf.CODCOLIGADA=m.CODCOLIGADA and hf.IDHABILITACAOFILIAL = m.IDHABILITACAOFILIAL
	inner join SCURSO				(NOLOCK) c	on hf.CODCOLIGADA=c.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
	inner JOIN SPLETIVO 			(NOLOCK) pl	ON pl.CODCOLIGADA = ct.CODCOLIGADA AND pl.IDPERLET = ct.IDPERLET
	inner JOIN SSERVICO 			(NOLOCK) s	ON s.CODCOLIGADA = p.CODCOLIGADA AND s.CODSERVICO = p.CODSERVICO
	inner JOIN SSTATUS 				(NOLOCK) st	ON st.CODCOLIGADA = m.CODCOLIGADA AND st.CODSTATUS = m.CODSTATUS        
	inner join SBOLSALAN			(NOLOCK) bl on bl.CODCOLIGADA = sl.CODCOLIGADA and	bl.IDLAN = sl.IDLAN
	left join  SBOLSA				(NOLOCK) b  on bl.CODCOLIGADA = bl.CODCOLIGADA and	b.CODBOLSA = bl.CODBOLSA
Where
	year(fl.MesDeCompetencia) = :ANO_COMPETENCIA and MONTH(fl.MesDeCompetencia) between :MESINICIAL and :MESFINAL
	and bl.DESCONTO is not null
order by pp.NOME";1940;;;;14/03/2022;isaldo;1;1;1;1;;;;1;65abd35e-753e-44cf-baa1-686830e9d2f3;0;;-16836;isaldo;11/03/2022;isaldo;14/03/2022;0
S;BuscaDisc;Pesquisa disciplina (ProHelp);"SELECT
	DISTINCT
	SPLETIVO.CODPERLET,
	HF.NomFilial,
	HF.NomTipoCurso,
	HF.NomCurso,
	STURMADISC.CODTURMA,
	STURMADISC.IDTURMADISC,
	SDISCIPLINA.NOME,
	GERENCIAL,
	ATIVA

FROM STURMADISC (NOLOCK)
	LEFT JOIN SPLETIVO  (NOLOCK) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET
	LEFT JOIN SDISCIPLINA (NOLOCK) ON STURMADISC.CODDISC = SDISCIPLINA.CODDISC AND STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
	LEFT JOIN v_Unasp_SHABILITACAOFILIAL HF(NOLOCK) ON HF.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL

WHERE SDISCIPLINA.NOME like '%' + :NomeDisciplina + '%'
/*idturmadisc = :ID_TurmaDisc*/

ORDER BY CODPERLET 

";639;;;;21/10/2022;maik.souza;1;1;1;1;;;;0;5794a725-8ffd-41ca-b0e8-f2feddbf52ac;0;;14176;maik.souza;04/08/2022;maik.souza;21/10/2022;0
S;CAND.DOC.ENTR;Candidato com o documento entregue;"SELECT DISTINCT
	ao.NUMEROINSCRICAO
FROM 
	SPSINSCRICAOAREAOFERTADA (NOLOCK) AO
	INNER JOIN SPSDOCUMENTOENTREGUE (NOLOCK) DE ON DE.CODUSUARIOPS=AO.CODUSUARIOPS AND DE.CODCOLIGADA=AO.CODCOLIGADA AND DE.IDPS=AO.IDPS AND DE.NUMEROINSCRICAO=AO.NUMEROINSCRICAO
";261;;;;07/06/2021;maycon;1;1;1;1;;;;0;87565bfe-8360-4f5f-aa09-11e260f3ecf4;0;;-30463;maycon;07/06/2021;maycon;07/06/2021;0
S;CAND.DOC.ID;Id processo seletivo de pós;"SELECT DISTINCT
	AO.IDPS
FROM
	SPSINSCRICAOAREAOFERTADA (NOLOCK) AO
	INNER JOIN SPSPROCESSOSELETIVO (NOLOCK) PS ON PS.IDPS=AO.IDPS
	INNER JOIN SPSCATEGORIAPS (NOLOCK) CP ON CP.IDCATEGORIAPS=PS.IDCATEGORIAPS
WHERE
	CP.NOME LIKE '%Pós-Graduação%'";251;;;;08/06/2021;maycon;1;1;1;1;;;;0;42e12819-eb1d-4908-9ce0-dd2d4508a799;0;;-10176;maycon;08/06/2021;maycon;08/06/2021;0
S;CandidatosSemLoc;Candidatos Sem Local de Prova;"SELECT 
	ps.IDPS,
	oi.NUMEROINSCRICAO,
	ps.NOME ProcessoSeletivo,
	u.NOME,
	fi.Nome FormaInscricao,
	iao.DATAINSCRICAO DataInscricao,
	c.DESCRICAO Polo,
	ai.Nome AreaInteresse,
	so.DESCRICAO Status,
	n.DESCRICAO Nacionalidade, 
	u.DTNASCIMENTO DataNascimento,
	u.CPF,
	u.TELEFONE1,
	u.TELEFONE2,
	u.CARTIDENTIDADE RG,
	u.NPASSAPORTE Passaporte,
	u.EMAIL,
	m.NomFilial Filial,	m.RA, m.CODCURSO,m.NomCurso, m.CODGRADE CODMATRIZ, m.NomGrade NomMatriz, m.NomTipoMatricula TipoMatricula, m.NomStatus StatusMatricula
FROM 
	SPSOPCAOINSCRITO 						(NOLOCK) oi
	INNER JOIN SPSINSCRICAOAREAOFERTADA		(NOLOCK) iao	ON iao.IDPS=oi.IDPS and iao.NUMEROINSCRICAO=oi.NUMEROINSCRICAO
	left join SPSINSCAREAOFERTACOMPL		(NOLOCK) iaoc	on iaoc.CODCOLIGADA = iao.CODCOLIGADA and iaoc.IDPS = iao.IDPS and iaoc.NUMEROINSCRICAO = iao.NUMEROINSCRICAO
	left join SCAMPUS						(NOLOCK) c		on c.CODCAMPUS = iaoc.CODPOLO
	INNER JOIN SPSUSUARIO					(NOLOCK) u		ON u.CODUSUARIOPS=iao.CODUSUARIOPS
	left  JOIN PCODNACAO					(NOLOCK) n		on n.CODCLIENTE = u.NACIONALIDADE
	left join SPSFORMAINSCRICAOPS			(NOLOCK) fi		on fi.CODCOLIGADA = iao.CODCOLIGADA and fi.IDPS=iao.IDPS and fi.IDFORMAINSCRICAO = iao.IDFORMAINSCRICAO
	left join SPSAREAOFERTADA				(NOLOCK) ao		on ao.CODCOLIGADA = oi.CODCOLIGADA and ao.IDPS = oi.IDPS and ao.IDAREAINTERESSE = oi.IDAREAINTERESSE
	left join SPSAREAINTERESSE				(NOLOCK) ai		on ai.IDAREAINTERESSE = ao.IDAREAINTERESSE
	left join SPSSTATUSOPCAO				(NOLOCK) so		on so.CODFILIAL = 1 and so.CODIGO = oi.STATUS
	left join SPSPROCESSOSELETIVO			(NOLOCK) ps		on ps.CODCOLIGADA = ao.CODCOLIGADA and ps.IDPS = ao.IDPS
	left join v_Unasp_SMATRICPL				(NOLOCK) m		on m.CODCOLIGADA=iao.CODCOLIGADAMAT and m.IDPERLET=iao.IDPERLET and m.IDHABILITACAOFILIAL=iao.IDHABFILIALMAT and m.RA=iao.RAMAT
WHERE 
	oi.IDPS = :IDPS
	and not exists(select * from SPSLOCALETAPAINSCRITO spsl where spsl.CODCOLIGADA = iao.CODCOLIGADA and spsl.IDPS = iao.IDPS and spsl.NUMEROINSCRICAO = iao.NUMEROINSCRICAO)
order by 
	u.NOME
";2032;;;;14/04/2022;isaldo;1;1;1;1;;;;0;888ef70f-514e-466a-9996-52d9054802cf;0;;859;isaldo;14/04/2022;isaldo;14/04/2022;0
S;Canvas;Sincronzação Canvas;"Select 
	Campus,
	CourseId,
	CourseName,
	Name,
	Email,
	UserName,
	Password,
	RA,
	Document, 
	Role, 
	CanvasId, 
	SendToCanvas, 
	TurmaCod, 
	TurmaNome,
	Active, 
	CODPERLET,
	JUNCAO,
	DTINICIO,
	LASTUPDATE,
	RASIGA
from 
	z_UNASP_CANVAS
Where
	DTINICIO >= :DTINICIO";292;;;;01/08/2021;mestre;1;1;1;1;;;;0;8daa68d4-31df-4400-bfc1-dfb74f2ea85f;0;;-12469;mestre;01/08/2021;mestre;01/08/2021;0
S;CC.01.003.01;Diário de Classe - Frequencia - Dados da Turma e Disciplina;"SELECT DISTINCT 
  (  SELECT TOP 1 SHORARIO.HORAINICIAL
   FROM STURMADISC TUR(NOLOCK)
     LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STURMADISC.IDTURMADISC
   AND  TUR.CODCOLIGADA=STURMADISC.CODCOLIGADA
  ) AS HORAINICIAL, 
  ( SELECT TOP 1 SHORARIO.HORAFINAL
   FROM STURMADISC TUR(NOLOCK)
     LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STURMADISC.IDTURMADISC
   AND  TUR.CODCOLIGADA = STURMADISC.CODCOLIGADA
  ) AS HORAFINAL,
  ( SELECT TOP 1 PROF.NOME PROFESSOR
   FROM STURMADISC TUR(NOLOCK)
                    LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STURMADISC.IDTURMADISC
   AND  TUR.CODCOLIGADA = STURMADISC.CODCOLIGADA
  ) AS PROFESSOR, STURMADISC.CODDISC, SDISCIPLINA.NOME DISCIPLINA, STURMADISC.CODTURMA AS CODTURMA, SPLETIVO.CODPERLET, SPLETIVO.DESCRICAO, STURMA.NOME NOMETURMA,
  STURMADISC.CODCOLIGADA, STURMADISC.IDTURMADISC, STURMADISC.CODFILIAL
FROM SALUNO (NOLOCK)                    
        INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SHABILITACAOALUNO.RA = SALUNO.RA
  INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SHABILITACAOALUNO.RA
  INNER JOIN SMATRICULA (NOLOCK) ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SMATRICPL.RA = SMATRICULA.RA AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
  INNER JOIN STURMADISC(NOLOCK) ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC  
  INNER JOIN STURMA (NOLOCK) ON STURMADISC.CODCOLIGADA = STURMA.CODCOLIGADA AND STURMADISC.CODFILIAL=STURMA.CODFILIAL AND STURMADISC.IDPERLET=STURMA.IDPERLET AND STURMADISC.CODTURMA = STURMA.CODTURMA
  INNER JOIN SPLETIVO (NOLOCK) ON SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
  INNER JOIN PPESSOA (NOLOCK) ON SALUNO.CODPESSOA = PPESSOA.CODIGO
  INNER JOIN SDISCIPLINA(NOLOCK) ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
WHERE SALUNO.CODCOLIGADA = :P_CODCOLIGADA
AND  STURMADISC.IDTURMADISC = :P_IDTURMADISC
AND  STURMADISC.CODDISC = :P_CODDISC
AND  STURMADISC.CODFILIAL = :P_CODFILIAL
ORDER BY CODTURMA";;;;;;;1;1;1;1;;;;;;;;-14115;RM;30/05/2012;RM;30/05/2012;
S;CC.01.003.02;Diário de Classe - Frequencia - Alunos;"SELECT SALUNO.RA, SMATRICULA.NUMDIARIO, PPESSOA.NOME, SSTATUS.DESCRICAO,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA1 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA1,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA2 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA2,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA3 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA3,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA4 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA4,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA5 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA5,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA6 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA6,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA7 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA7,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA8 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA8,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA9 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA9,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA10 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA10,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA11 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA11,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA12 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA12,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA13 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA13,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA14 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA14,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA15 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA15,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA16 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA16,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA17 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA17,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA18 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA18,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA19 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA19,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA20 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA20,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA21 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA21,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA22 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA22,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA23 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA23,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA24 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA24,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA25 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA25,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA26 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA26,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA27 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA27,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA28 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA28,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA29 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA29,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA30 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA30,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA31 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA31,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA32 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA32,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA33 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA33,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA34 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA34,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA35 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA35,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA36 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA36,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA37 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA37,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA38 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA38,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA39 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA39,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA40 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA40
FROM SALUNO (NOLOCK)                    
        INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SHABILITACAOALUNO.RA = SALUNO.RA
  INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SHABILITACAOALUNO.RA
  INNER JOIN SMATRICULA (NOLOCK) ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SMATRICPL.RA = SMATRICULA.RA AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
  INNER JOIN STURMADISC(NOLOCK) ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC  
  INNER JOIN STURMA (NOLOCK) ON STURMADISC.CODCOLIGADA = STURMA.CODCOLIGADA AND STURMADISC.CODFILIAL=STURMA.CODFILIAL AND STURMADISC.IDPERLET=STURMA.IDPERLET AND STURMADISC.CODTURMA = STURMA.CODTURMA
  INNER JOIN SPLETIVO (NOLOCK) ON SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
  INNER JOIN PPESSOA (NOLOCK) ON SALUNO.CODPESSOA = PPESSOA.CODIGO
  INNER JOIN SDISCIPLINA(NOLOCK) ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
  INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
  LEFT OUTER JOIN SFREQUENCIA (NOLOCK) ON SFREQUENCIA.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SFREQUENCIA.IDTURMADISC = SMATRICULA.IDTURMADISC AND SFREQUENCIA.RA = SMATRICULA.RA
WHERE SALUNO.CODCOLIGADA = :P_CODCOLIGADA
AND  STURMADISC.IDTURMADISC = :P_IDTURMADISC
AND  STURMADISC.CODFILIAL = :P_CODFILIAL
ORDER BY PPESSOA.NOME";;;;;;;1;1;1;1;;;;;;;;-10015;RM;30/05/2012;RM;30/05/2012;
S;CC.01.003.03;Diário de Classe - Frequencia - Plano de Aula;"SELECT DIA1 = MIN(CASE WHEN SPLANOAULA.AULA = 1 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES1 = MIN(CASE WHEN SPLANOAULA.AULA = 1 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA2 = MIN(CASE WHEN SPLANOAULA.AULA = 2 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES2 = MIN(CASE WHEN SPLANOAULA.AULA = 2 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA3 = MIN(CASE WHEN SPLANOAULA.AULA = 3 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES3 = MIN(CASE WHEN SPLANOAULA.AULA = 3 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA4 = MIN(CASE WHEN SPLANOAULA.AULA = 4 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES4 = MIN(CASE WHEN SPLANOAULA.AULA = 4 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA5 = MIN(CASE WHEN SPLANOAULA.AULA = 5 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES5 = MIN(CASE WHEN SPLANOAULA.AULA = 5 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA6 = MIN(CASE WHEN SPLANOAULA.AULA = 6 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES6 = MIN(CASE WHEN SPLANOAULA.AULA = 6 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA7 = MIN(CASE WHEN SPLANOAULA.AULA = 7 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES7 = MIN(CASE WHEN SPLANOAULA.AULA = 7 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA8 = MIN(CASE WHEN SPLANOAULA.AULA = 8 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES8 = MIN(CASE WHEN SPLANOAULA.AULA = 8 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA9 = MIN(CASE WHEN SPLANOAULA.AULA = 9 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES9 = MIN(CASE WHEN SPLANOAULA.AULA = 9 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA10 = MIN(CASE WHEN SPLANOAULA.AULA = 10 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES10 = MIN(CASE WHEN SPLANOAULA.AULA = 10 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA11 = MIN(CASE WHEN SPLANOAULA.AULA = 11 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES11 = MIN(CASE WHEN SPLANOAULA.AULA = 11 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA12 = MIN(CASE WHEN SPLANOAULA.AULA = 12 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES12 = MIN(CASE WHEN SPLANOAULA.AULA = 12 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA13 = MIN(CASE WHEN SPLANOAULA.AULA = 13 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES13 = MIN(CASE WHEN SPLANOAULA.AULA = 13 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA14 = MIN(CASE WHEN SPLANOAULA.AULA = 14 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES14 = MIN(CASE WHEN SPLANOAULA.AULA = 14 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA15 = MIN(CASE WHEN SPLANOAULA.AULA = 15 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES15 = MIN(CASE WHEN SPLANOAULA.AULA = 15 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA16 = MIN(CASE WHEN SPLANOAULA.AULA = 16 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES16 = MIN(CASE WHEN SPLANOAULA.AULA = 16 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA17 = MIN(CASE WHEN SPLANOAULA.AULA = 17 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES17 = MIN(CASE WHEN SPLANOAULA.AULA = 17 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA18 = MIN(CASE WHEN SPLANOAULA.AULA = 18 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES18 = MIN(CASE WHEN SPLANOAULA.AULA = 18 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA19 = MIN(CASE WHEN SPLANOAULA.AULA = 19 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES19 = MIN(CASE WHEN SPLANOAULA.AULA = 19 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA20 = MIN(CASE WHEN SPLANOAULA.AULA = 20 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES20 = MIN(CASE WHEN SPLANOAULA.AULA = 20 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA21 = MIN(CASE WHEN SPLANOAULA.AULA = 21 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES21 = MIN(CASE WHEN SPLANOAULA.AULA = 21 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA22 = MIN(CASE WHEN SPLANOAULA.AULA = 22 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES22 = MIN(CASE WHEN SPLANOAULA.AULA = 22 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA23 = MIN(CASE WHEN SPLANOAULA.AULA = 23 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES23 = MIN(CASE WHEN SPLANOAULA.AULA = 23 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA24 = MIN(CASE WHEN SPLANOAULA.AULA = 24 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES24 = MIN(CASE WHEN SPLANOAULA.AULA = 24 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA25 = MIN(CASE WHEN SPLANOAULA.AULA = 25 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES25 = MIN(CASE WHEN SPLANOAULA.AULA = 25 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA26 = MIN(CASE WHEN SPLANOAULA.AULA = 26 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES26 = MIN(CASE WHEN SPLANOAULA.AULA = 26 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA27 = MIN(CASE WHEN SPLANOAULA.AULA = 27 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES27 = MIN(CASE WHEN SPLANOAULA.AULA = 27 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA28 = MIN(CASE WHEN SPLANOAULA.AULA = 28 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES28 = MIN(CASE WHEN SPLANOAULA.AULA = 28 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA29 = MIN(CASE WHEN SPLANOAULA.AULA = 29 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES29 = MIN(CASE WHEN SPLANOAULA.AULA = 29 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA30 = MIN(CASE WHEN SPLANOAULA.AULA = 30 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES30 = MIN(CASE WHEN SPLANOAULA.AULA = 30 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA31 = MIN(CASE WHEN SPLANOAULA.AULA = 31 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES31 = MIN(CASE WHEN SPLANOAULA.AULA = 31 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA32 = MIN(CASE WHEN SPLANOAULA.AULA = 32 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES32 = MIN(CASE WHEN SPLANOAULA.AULA = 32 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA33 = MIN(CASE WHEN SPLANOAULA.AULA = 33 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES33 = MIN(CASE WHEN SPLANOAULA.AULA = 33 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA34 = MIN(CASE WHEN SPLANOAULA.AULA = 34 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES34 = MIN(CASE WHEN SPLANOAULA.AULA = 34 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA35 = MIN(CASE WHEN SPLANOAULA.AULA = 35 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES35 = MIN(CASE WHEN SPLANOAULA.AULA = 35 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA36 = MIN(CASE WHEN SPLANOAULA.AULA = 36 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES36 = MIN(CASE WHEN SPLANOAULA.AULA = 36 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA37 = MIN(CASE WHEN SPLANOAULA.AULA = 37 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES37 = MIN(CASE WHEN SPLANOAULA.AULA = 37 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA38 = MIN(CASE WHEN SPLANOAULA.AULA = 38 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES38 = MIN(CASE WHEN SPLANOAULA.AULA = 38 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA39 = MIN(CASE WHEN SPLANOAULA.AULA = 39 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES39 = MIN(CASE WHEN SPLANOAULA.AULA = 39 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA40 = MIN(CASE WHEN SPLANOAULA.AULA = 40 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES40 = MIN(CASE WHEN SPLANOAULA.AULA = 40 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  MIN(CASE WHEN SPLANOAULA.AULA = 1 THEN SPLANOAULA.DATA END) AS DATA1,
  MIN(CASE WHEN SPLANOAULA.AULA = 2 THEN SPLANOAULA.DATA END) AS DATA2,
  MIN(CASE WHEN SPLANOAULA.AULA = 3 THEN SPLANOAULA.DATA END) AS DATA3,
  MIN(CASE WHEN SPLANOAULA.AULA = 4 THEN SPLANOAULA.DATA END) AS DATA4,
  MIN(CASE WHEN SPLANOAULA.AULA = 5 THEN SPLANOAULA.DATA END) AS DATA5,
  MIN(CASE WHEN SPLANOAULA.AULA = 6 THEN SPLANOAULA.DATA END) AS DATA6,
  MIN(CASE WHEN SPLANOAULA.AULA = 7 THEN SPLANOAULA.DATA END) AS DATA7,
  MIN(CASE WHEN SPLANOAULA.AULA = 8 THEN SPLANOAULA.DATA END) AS DATA8,
  MIN(CASE WHEN SPLANOAULA.AULA = 9 THEN SPLANOAULA.DATA END) AS DATA9,
  MIN(CASE WHEN SPLANOAULA.AULA = 10 THEN SPLANOAULA.DATA END) AS DATA10,
  MIN(CASE WHEN SPLANOAULA.AULA = 11 THEN SPLANOAULA.DATA END) AS DATA11,
  MIN(CASE WHEN SPLANOAULA.AULA = 12 THEN SPLANOAULA.DATA END) AS DATA12,
  MIN(CASE WHEN SPLANOAULA.AULA = 13 THEN SPLANOAULA.DATA END) AS DATA13,
  MIN(CASE WHEN SPLANOAULA.AULA = 14 THEN SPLANOAULA.DATA END) AS DATA14,  
  MIN(CASE WHEN SPLANOAULA.AULA = 15 THEN SPLANOAULA.DATA END) AS DATA15,
  MIN(CASE WHEN SPLANOAULA.AULA = 16 THEN SPLANOAULA.DATA END) AS DATA16,
  MIN(CASE WHEN SPLANOAULA.AULA = 17 THEN SPLANOAULA.DATA END) AS DATA17,
  MIN(CASE WHEN SPLANOAULA.AULA = 18 THEN SPLANOAULA.DATA END) AS DATA18,
  MIN(CASE WHEN SPLANOAULA.AULA = 19 THEN SPLANOAULA.DATA END) AS DATA19,
  MIN(CASE WHEN SPLANOAULA.AULA = 20 THEN SPLANOAULA.DATA END) AS DATA20,
  MIN(CASE WHEN SPLANOAULA.AULA = 21 THEN SPLANOAULA.DATA END) AS DATA21,
  MIN(CASE WHEN SPLANOAULA.AULA = 22 THEN SPLANOAULA.DATA END) AS DATA22,
  MIN(CASE WHEN SPLANOAULA.AULA = 23 THEN SPLANOAULA.DATA END) AS DATA23,
  MIN(CASE WHEN SPLANOAULA.AULA = 24 THEN SPLANOAULA.DATA END) AS DATA24,
  MIN(CASE WHEN SPLANOAULA.AULA = 25 THEN SPLANOAULA.DATA END) AS DATA25,
  MIN(CASE WHEN SPLANOAULA.AULA = 26 THEN SPLANOAULA.DATA END) AS DATA26,
  MIN(CASE WHEN SPLANOAULA.AULA = 27 THEN SPLANOAULA.DATA END) AS DATA27,
  MIN(CASE WHEN SPLANOAULA.AULA = 28 THEN SPLANOAULA.DATA END) AS DATA28,
  MIN(CASE WHEN SPLANOAULA.AULA = 29 THEN SPLANOAULA.DATA END) AS DATA29,
  MIN(CASE WHEN SPLANOAULA.AULA = 30 THEN SPLANOAULA.DATA END) AS DATA30,
  MIN(CASE WHEN SPLANOAULA.AULA = 31 THEN SPLANOAULA.DATA END) AS DATA31,
  MIN(CASE WHEN SPLANOAULA.AULA = 32 THEN SPLANOAULA.DATA END) AS DATA32,
  MIN(CASE WHEN SPLANOAULA.AULA = 33 THEN SPLANOAULA.DATA END) AS DATA33,
  MIN(CASE WHEN SPLANOAULA.AULA = 34 THEN SPLANOAULA.DATA END) AS DATA34,
  MIN(CASE WHEN SPLANOAULA.AULA = 35 THEN SPLANOAULA.DATA END) AS DATA35,
  MIN(CASE WHEN SPLANOAULA.AULA = 36 THEN SPLANOAULA.DATA END) AS DATA36,
  MIN(CASE WHEN SPLANOAULA.AULA = 37 THEN SPLANOAULA.DATA END) AS DATA37,
  MIN(CASE WHEN SPLANOAULA.AULA = 38 THEN SPLANOAULA.DATA END) AS DATA38,
  MIN(CASE WHEN SPLANOAULA.AULA = 39 THEN SPLANOAULA.DATA END) AS DATA39,
  MIN(CASE WHEN SPLANOAULA.AULA = 40 THEN SPLANOAULA.DATA END) AS DATA40,
  SPLANOAULA.CODCOLIGADA, SPLANOAULA.IDTURMADISC, SPLANOAULA.CODFILIAL
FROM SPLANOAULA (NOLOCK)
WHERE SPLANOAULA.CODCOLIGADA = :P_CODCOLIGADA
AND  SPLANOAULA.IDTURMADISC = :P_IDTURMADISC
AND  SPLANOAULA.CODFILIAL = :P_CODFILIAL
GROUP BY SPLANOAULA.CODCOLIGADA, SPLANOAULA.IDTURMADISC, SPLANOAULA.CODFILIAL";;;;;;;1;1;1;1;;;;;;;;-16616;RM;30/05/2012;RM;30/05/2012;
S;CC.01.005.01;Diário de Classe - Conteúdo;"SELECT DISTINCT
	SPLANOAULA.DATA, 
    CAST(SPLANOAULA.CONTEUDOEFETIVO AS varchar(500)) AS CONTEUDOEFETIVO,
	A.TOTALT,
	ISNULL(CAST(B.TOTALP AS varchar),'--') AS TOTALP,
	C.TOTAL
	
FROM SPLANOAULA


LEFT JOIN(
SELECT 
	SPL.DATA,
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC,
	CAST(SPL.CONTEUDOEFETIVO AS varchar(500)) AS DESCRI,
	COUNT(*) AS TOTALT
FROM SPLANOAULA SPL 
WHERE CODCOLIGADA = :P_CODCOLIGADA_N
AND  IDTURMADISC = :P_IDTURMADISC_N
	AND SPL.TIPOAULA = 'T'
GROUP BY 
	SPL.DATA,
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC,
	CAST(SPL.CONTEUDOEFETIVO AS varchar(500))
) AS A ON A.CODCOLIGADA = SPLANOAULA.CODCOLIGADA
	AND A.IDTURMADISC = SPLANOAULA.IDTURMADISC
	AND A.DATA = SPLANOAULA.DATA
	AND A.DESCRI = CAST(SPLANOAULA.CONTEUDOEFETIVO AS varchar(500))


LEFT JOIN(
SELECT 
	SPL.DATA,
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC,
	CAST(SPL.CONTEUDOEFETIVO AS varchar(500)) AS DESCRI,
	COUNT(*) AS TOTALP
FROM SPLANOAULA SPL 
WHERE CODCOLIGADA = :P_CODCOLIGADA_N
AND  IDTURMADISC = :P_IDTURMADISC_N
	AND SPL.TIPOAULA <> 'T'
GROUP BY 
	SPL.DATA,
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC,
	CAST(SPL.CONTEUDOEFETIVO AS varchar(500))
) AS B ON B.CODCOLIGADA = SPLANOAULA.CODCOLIGADA
	AND B.IDTURMADISC = SPLANOAULA.IDTURMADISC
	AND B.DATA = SPLANOAULA.DATA
	AND B.DESCRI = CAST(SPLANOAULA.CONTEUDOEFETIVO AS varchar(500))
	
	
LEFT JOIN(
SELECT 
	SPL.DATA,
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC,
	CAST(SPL.CONTEUDOEFETIVO AS varchar(500)) AS DESCRI,
	COUNT(*) AS TOTAL
FROM SPLANOAULA SPL 
WHERE CODCOLIGADA = :P_CODCOLIGADA_N
AND  IDTURMADISC = :P_IDTURMADISC_N
GROUP BY 
	SPL.DATA,
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC,
	CAST(SPL.CONTEUDOEFETIVO AS varchar(500))
) AS C ON C.CODCOLIGADA = SPLANOAULA.CODCOLIGADA
	AND C.IDTURMADISC = SPLANOAULA.IDTURMADISC
	AND C.DATA = SPLANOAULA.DATA
	AND C.DESCRI = CAST(SPLANOAULA.CONTEUDOEFETIVO AS varchar(500))




WHERE SPLANOAULA.CODCOLIGADA = :P_CODCOLIGADA_N
AND  SPLANOAULA.IDTURMADISC = :P_IDTURMADISC_N
ORDER BY SPLANOAULA.DATA";2021;;;;07/04/2022;consultor1.totvs;1;1;1;1;;;;;8058b90a-095c-4903-9305-ae215ac30735;;;-18495;RM;30/05/2012;consultor1.totvs;07/04/2022;
S;CC.01.005.02;Diário de Classe - Resultado;"SELECT 
	SMATRICULA.RA,
	PPESSOA.NOME AS 'ALUNO',
	SSTATUS.DESCRICAO AS 'STATUS MATRICULA',
	ISNULL(CAST(CASE WHEN CAST(A.MEDIA AS DECIMAL(10,1)) > 10 THEN 10 ELSE CAST(A.MEDIA AS DECIMAL(10,1)) END AS VARCHAR),'--') AS MEDIA,
	CAST(ISNULL(B.FALTA,0) AS INT) AS FALTA,
	ISNULL(C.ABONO,0) AS 'ABONO'

FROM STURMADISC 
INNER JOIN SMATRICULA ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
	AND SALUNO.RA = SMATRICULA.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET


LEFT JOIN(
SELECT 
	SNOTAETAPA.CODCOLIGADA,
	SNOTAETAPA.IDTURMADISC,
	SNOTAETAPA.RA,
	SNOTAETAPA.NOTAFALTA AS 'MEDIA'
FROM SNOTAETAPA
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SNOTAETAPA.IDTURMADISC
INNER JOIN SETAPAS ON SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
	AND SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC
	AND SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA
	AND SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA
WHERE
SNOTAETAPA.TIPOETAPA = 'N'
AND SETAPAS.ETAPAFINAL = 'S'
AND SETAPAS.CODCOLIGADA = :P_CODCOLIGADA_N
AND SETAPAS.IDTURMADISC = :P_IDTURMADISC_N

) AS A ON A.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND A.IDTURMADISC = STURMADISC.IDTURMADISC
	AND A.RA = SMATRICULA.RA



LEFT JOIN(
SELECT 
	SNOTAETAPA.CODCOLIGADA,
	SNOTAETAPA.IDTURMADISC,
	SNOTAETAPA.RA,
	SNOTAETAPA.NOTAFALTA AS 'FALTA'
FROM SNOTAETAPA
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
	AND STURMADISC.IDTURMADISC = SNOTAETAPA.IDTURMADISC
INNER JOIN SETAPAS ON SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
	AND SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC
	AND SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA
	AND SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA
WHERE
SNOTAETAPA.TIPOETAPA = 'F'
AND SETAPAS.ETAPAFINAL = 'S'
AND SETAPAS.CODCOLIGADA = :P_CODCOLIGADA_N
AND SETAPAS.IDTURMADISC = :P_IDTURMADISC_N

) AS B ON A.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND B.IDTURMADISC = STURMADISC.IDTURMADISC
	AND B.RA = SMATRICULA.RA
	
	

LEFT JOIN (



SELECT
	SFREQUENCIA.CODCOLIGADA,
	SFREQUENCIA.IDTURMADISC,
	SFREQUENCIA.RA,
	COUNT(*) AS ABONO
FROM SFREQUENCIA
INNER JOIN SJUSTIFICATIVAFALTA ON SJUSTIFICATIVAFALTA.CODCOLIGADA = SFREQUENCIA.CODCOLIGADA
	AND SJUSTIFICATIVAFALTA.IDJUSTIFICATIVAFALTA = SFREQUENCIA.IDJUSTIFICATIVAFALTA
WHERE SFREQUENCIA.IDJUSTIFICATIVAFALTA IS NOT NULL
AND SFREQUENCIA.CODCOLIGADA = :P_CODCOLIGADA_N
AND SFREQUENCIA.IDTURMADISC = :P_IDTURMADISC_N

GROUP BY 
	SFREQUENCIA.CODCOLIGADA,
	SFREQUENCIA.IDTURMADISC,
	SFREQUENCIA.RA

) AS C ON C.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND C.IDTURMADISC = STURMADISC.IDTURMADISC
	AND C.RA = SMATRICULA.RA


WHERE STURMADISC.CODCOLIGADA = :P_CODCOLIGADA_N
AND  STURMADISC.IDTURMADISC = :P_IDTURMADISC_N

ORDER BY PPESSOA.NOME";3164;;;;12/07/2022;consultor1.totvs;1;1;1;1;;;;0;6825f583-76b8-474b-9ac4-7900c7186c91;0;;-31087;consultor1.totvs;29/03/2022;consultor1.totvs;12/07/2022;0
S;Certificado;Certificado;"SELECT 
  PPESSOA.NOME NOMEALUNO
  , SHABILITACAO.NOME NOMECURSO
  , SHABILITACAOFILIAL.DTAUTORIZACAO DATA
  , SHABILITACAOFILIAL.PORTAUTORIZACAO AUTORIZACAO
  , SHABILITACAOFILIAL.PORTRECONHECIMENTO RECONHECIMENTO
  , STURMADISC.CODDISC
  , SDISCIPLINA.NOME DISCIPLINA
  , SPLETIVO.CODPERLET
  , GCOLIGADA.NOME NOMEINST
  , IMGCOL.IMAGEM IMGINST
  , IMGALU.IMAGEM IMGALUNO
  , SNOTAETAPA.NOTAFALTA NOTA
  , SNOTAETAPA.CODCONCEITO CONCEITO
FROM 
  SMATRICULA (NOLOCK)
  INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON 
    SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
    AND SHABILITACAOFILIAL.CODCOLIGADA = SMATRICULA.CODCOLIGADA
  INNER JOIN SHABILITACAO (NOLOCK) ON 
    SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
    AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
    AND SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
  INNER JOIN SALUNO (NOLOCK) ON 
    SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA
    AND SMATRICULA.RA = SALUNO.RA
  INNER JOIN SPESSOA (NOLOCK) ON 
    SALUNO.CODPESSOA = SPESSOA.CODIGO
  INNER JOIN PPESSOA (NOLOCK) ON 
    SPESSOA.CODIGO = PPESSOA.CODIGO
  INNER JOIN STURMADISC (NOLOCK) ON 
    SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
    AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
  INNER JOIN SDISCIPLINA (NOLOCK) ON
    SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
    AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
  INNER JOIN SPLETIVO (NOLOCK) ON 
    SPLETIVO.IDPERLET = SMATRICULA.IDPERLET
    AND SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
  INNER JOIN GCOLIGADA (NOLOCK) ON 
    SMATRICULA.CODCOLIGADA = GCOLIGADA.CODCOLIGADA
  LEFT JOIN GIMAGEM IMGCOL (NOLOCK) ON
    GCOLIGADA.IDIMAGEM = IMGCOL.ID
  LEFT JOIN GIMAGEM IMGALU (NOLOCK) ON
    PPESSOA.IDIMAGEM = IMGALU.ID
  INNER JOIN SNOTAETAPA (NOLOCK) ON 
    SMATRICULA.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA
    AND SMATRICULA.IDTURMADISC = SNOTAETAPA.IDTURMADISC
    AND SMATRICULA.RA = SNOTAETAPA.RA
  INNER JOIN SETAPAS (NOLOCK) ON 
    SNOTAETAPA.CODCOLIGADA = SETAPAS.CODCOLIGADA
    AND SNOTAETAPA.IDTURMADISC = SETAPAS.IDTURMADISC
    AND SNOTAETAPA.CODETAPA = SETAPAS.CODETAPA
    AND SNOTAETAPA.TIPOETAPA = SETAPAS.TIPOETAPA
WHERE 
  SMATRICULA.RA = :RA 
  AND SETAPAS.ETAPAFINAL = 'S'
  AND SETAPAS.TIPOETAPA = 'N'";;;;;;;1;1;1;1;;;;;;;;25550;RM;30/05/2012;RM;30/05/2012;
S;CHIntegAluno;CH Integralizada do Aluno;"with info as (	
	Select '1-Disciplinas Concluidas' Grupo, IDHABILITACAOFILIAL, RA, CODPERIODO, PLETIVO, CODDISC Codigo, DISCIPLINA Descricao, null OBS, STATUS, NUMCREDITOS, NOTA, CH  
	from SHISTDISCCONCLUIDAS 
	Where RA = :RA
	
	union all
	
	select '2-Atividades' Grupo, al.IDHABILITACAOFILIAL, RA, null CODPERIODO, pl.CODPERLET PLETIVO, convert(varchar(20), c.CODCOMPONENTE) Codigo, c.Descricao, 
		al.Descricao OBS,
		al.CUMPRIUATIVIDADE STATUS, 
		null NUMCREDITOS,
		null NOTA,
		al.CARGAHORARIAATV CH
	FROM 
		SATIVIDADEALUNO al 
		inner join SPLETIVO pl ON al.CODCOLIGADA = pl.CODCOLIGADA AND al.IDPERLET = pl.IDPERLET
		inner join SCOMPONENTECURRICULAR cc on cc.CODCOLIGADA=al.CODCOLIGADA and al.CODCOMPONENTE = cc.CODCOMPONENTE and al.IDHABILITACAOFILIAL=cc.IDHABILITACAOFILIAL
		inner join SCOMPONENTE c on c.CODCOLIGADA=cc.CODCOLIGADA and c.CODCOMPONENTE = cc.CODCOMPONENTE
	Where RA = :RA

	union all

	select 
		'3-Disciplinas em Curso' Grupo, IDHABILITACAOFILIAL, RA, CODPERIODO, PLETIVO, CODDISC Codigo, DISCIPLINA Descricao, null OBS, STATUS, NUMCREDITOS, NOTA, CH
	from 
		SHISTDISCPENDENTES sh Where RA = :RA and sh.STATUS LIKE '%CURSANDO%'

	union all

	select 
		'4-Disciplinas Optaticas em Curso' Grupo, IDHABILITACAOFILIAL, RA, null CODPERIODO, PLETIVO, CODDISC Codigo, DISCIPLINA Descricao, null OBS, STATUS, NUMCREDITOS, NOTA, CH
	from 
		SHISTDISCOPTELETIVAS sh Where RA = :RA and sh.STATUS LIKE '%CURSANDO%'
	
	union all

	select 
		'5-Disciplinas Equivalentes em Curso' Grupo, sh.IDHABILITACAOFILIAL, sh.RA, null CODPERIODO, sh.PLETIVO, sh.CODDISC Codigo, sh.DISCIPLINA Descricao, null OBS, sh.STATUS, sh.NUMCREDITOS, sh.NOTA, 
		sum(isnull(op.CH, sh.CH)) CH
	from 
		SHISTDISCEQUIVEMCURSO sh 
		LEFT JOIN SHISTDISCOPTELETIVAS OP ON SH.RA = OP.RA AND SH.CODCOLIGADA = OP.CODCOLIGADA AND SH.IDHABILITACAOFILIAL = OP.IDHABILITACAOFILIAL AND OP.STATUS LIKE '%EQUIV%'
	Where sh.RA = :RA and sh.STATUS LIKE '%CURSANDO%'
	Group by
		sh.IDHABILITACAOFILIAL, sh.RA, sh.PLETIVO, sh.CODDISC, sh.DISCIPLINA , sh.STATUS, sh.NUMCREDITOS, sh.NOTA
)
Select 
	i.*, 
	tp.TotCHPeriodo,
	(select sum(NUMCREDITOS) from info) TotCreditos,
	(select sum(CH) from info) TotCH 
from 
	info i
	left join (Select isnull(CODPERIODO,999) CODPERIODO, sum(CH) TotCHPeriodo from info group by CODPERIODO) tp on tp.CODPERIODO=isnull(i.CODPERIODO,999)
order by
	Grupo, CODPERIODO, Codigo";2412;;;;27/10/2021;mestre;1;1;1;1;;;;0;7a21d56b-d8bc-4abd-bab5-c5d89a226008;0;;-13217;mestre;27/10/2021;mestre;27/10/2021;0
S;COBJUD;Cobrança Jurídica;"Select 
	f.IDINTEGRACAO							Num_Entidade,
	1										Cod_Tipo_Cobranca,
	concat(p.CODCONTRATO,'-', p.IDPARCELA)	Num_Cobranca,
	p.CPF									Num_CPF,
	p.Vencimento							Dat_Vencimento,
	p.VALORORIGINAL							Val_Cobranca,
	p.VALORORIGINAL+VALORJUROS				Val_Cobranca_Acao,
	0										Val_Multa,
	VALORJUROS								Val_Juros,
	DATABAIXA								Dat_Acerto_Mantenedora,
	0										Sta_Estornado,
	p.DTFIMCOBJUD							Dat_Acerto_JW_Mantenedora,
	p.VALORBAIXADO							Valor_Pago,
	1										Cod_Escola,
	p.RA									Cod_Aluno,
	p.Aluno									Nom_Aluno,
	year(p.Vencimento)						Num_Ano,
	p.PERIODO								Num_Serie,
	p.CODCONTRATO							Num_Contrato,
	case when p.TotalBolsa>0 then 1 else 0 end Sta_Bolsa,

	p.RespCPF,
	p.RespNome,

	p.RespEmail,
	p.RespTelefone,
	p.RespDTNASCIMENTO,
	p.RespRUA,
	p.RespNUMERO,
	p.RespBAIRRO,
	p.RespCEP,
	p.RespCidade,
	p.RespUF,
	p.RespDocIdentidade,
	p.RespDocEmissor,
	p.RespDocUF,
	case when p.RespReligiao like 'Adventista%' then 1 else 0 end Adventista,
	p.RespTelefone1,
	p.RespTelefone2,
	p.RespTelefone3,
	p.RespTelefone4

from 
	v_Unasp_SPARCELA p
	inner join GFILIAL f on f.CODFILIAL=p.CODFILIAL
Where 
	COBJUD=1 
	and DTINICOBJUD<getdate() and isnull(DTFIMCOBJUD, getdate())>=getdate()
";1286;;;;13/10/2022;isaldo;1;1;1;1;;;;0;2919789f-6558-4a30-90c0-f02b3999f946;0;;-29659;isaldo;13/10/2022;isaldo;13/10/2022;0
S;CODDISC_Periodo;Filtro de Disciplinas do Período;select distinct CODDISC from v_Unasp_STURMADISC where CODPERLET = :CODPERLET;76;;;;06/10/2021;mestre;1;1;1;1;;;;0;4e255cad-22fd-4aa5-b8bb-3f857817423c;0;;-14752;mestre;06/10/2021;mestre;06/10/2021;0
S;Colportor;Colportor;Select RA From SMATRICPLCOMPL mc inner join SPLETIVO pl on pl.IDPERLET=mc.IDPERLET Where CODPERLET = :CODPERLET and mc.COLPORTOR = 'T';134;;;;21/02/2022;isaldo;1;1;1;1;;;;0;56aa959f-bd2d-4db4-9566-d57d512656c9;0;;22980;isaldo;21/02/2022;isaldo;21/02/2022;0
S;Comp.Aluno.Per;Comparativo de Qtde de Alunos Período Atual/Anterior (SPS+Matric);"Select 
	Nível,
	CodFilial, CODCURSO, Curso,
	Classificado,
	PortalLiberado,
	ReservaDeVaga,
	ContratoAssinado,
	CursandoMatricula	[Cursando Matricula Atual],
	CursandoRematricula [Cursando Rematricula Atual],
	CursandoDIAP		[Cursando DIAP],
	case when isnull(CursandoMatricula,0) + isnull(CursandoRematricula,0) + isnull(CursandoDIAP,0)>0 then isnull(CursandoMatricula,0) + isnull(CursandoRematricula,0) + isnull(CursandoDIAP,0) end [Total Cursando Atual],
	[Matricula Cursando Anterior],
	[Rematrícula Cursando Anterior],
	case when isnull([Matricula Cursando Anterior],0) + isnull([Rematrícula Cursando Anterior],0)>0 then isnull([Matricula Cursando Anterior],0) + isnull([Rematrícula Cursando Anterior],0) end [Total Cursando Anterior]
from (
Select 
	v.CodFilial, NomTipoCurso Nível, v.CODCURSO, v.NomCurso Curso,
	sum(case when isnull(v.NomTipoMatricula,'Matricula') = 'Matricula' and v.CODSTATUS in (44) then 1 end)			Classificado,
	sum(case when isnull(v.NomTipoMatricula,'Matricula') = 'Matricula' and v.CODSTATUS in (45,51) then 1 end)		PortalLiberado,
	sum(case when isnull(v.NomTipoMatricula,'Matricula') = 'Matricula' and v.CODSTATUS in (1,22,26) then 1 end)		ReservaDeVaga,
	sum(case when isnull(v.NomTipoMatricula,'Matricula') = 'Matricula' and v.CODSTATUS in (19,35,37) then 1 end)		ContratoAssinado,
	sum(case when isnull(v.NomTipoMatricula,'Matricula') = 'Matricula' and v.CODSTATUS in (2,23,27) then 1 end)		CursandoMatricula,
	sum(case when v.NomTipoMatricula in ('Rematrícula') and v.CODSTATUS in (2,23,27) then 1 end)						CursandoRematricula,
	sum(case when v.NomTipoMatricula in ('DIAP') and v.CODSTATUS in (2,23,27) then 1 end)							CursandoDIAP,
	pa.[Matricula Cursando Anterior],
	pa.[Rematrícula Cursando Anterior]
from 
	v_Unasp_SMATRICPL v
	left join 
		(Select CODFILIAL, CODCURSO, 
			sum(case when tm.DESCRICAO='Matricula' then alunos end) [Matricula Cursando Anterior],
			sum(case when tm.DESCRICAO='Rematricula' then alunos end) [Rematrícula Cursando Anterior]
		from 
			z_Unasp_Matricula bi 
			inner join STIPOMATRICULA tm on tm.CODTIPOMAT=bi.CODTIPOMAT 
			inner join SSTATUS st on st.CODSTATUS = bi.CODSTATUS
		Where 
			bi.CODPERLET in (select Id from dbo.splitStringToTable(:PeriodoAnterior,',')) and bi.data=convert(date, DATEadd(year,-1, getdate())) and st.DESCRICAO='Cursando'
		group by CODFILIAL, CODCURSO) pa on pa.CODFILIAL=v.CODFILIAL and pa.CODCURSO=v.CODCURSO
Where 
	v.CODPERLET in (select Id from dbo.splitStringToTable(:PeriodoAtual,','))
group by
	v.CodFilial, NomTipoCurso, v.CODCURSO, v.NomCurso,
	pa.[Matricula Cursando Anterior],
	pa.[Rematrícula Cursando Anterior]
) x
Order by 1, 2, 3
";2696;;;;25/01/2022;isaldo;1;1;1;1;;;;1;a431b788-d968-4d8a-8073-bd799219747e;0;;-22784;isaldo;20/01/2022;isaldo;27/01/2022;0
S;Comp.Matric.Per;Comparativo de Matrículas - 3 anos;"select 
	*              
from 
	z_Unasp_ComparativoMatricula4 
where 
	Periodo = :Periodo 
	and Data = :Data";114;;;;03/08/2022;isaldo;1;1;1;1;;;;1;ac8f15bc-e838-402f-9238-03a97773c134;0;;-14412;isaldo;28/01/2022;isaldo;03/08/2022;0
S;CompCurricular;Componentes Curriculares;"Select 
	hf.NomFilial,
	hf.NomTipoCurso,
	hf.NomCurso, 
	hf.NomGrade, 
	hf.NomTurno,
	hf.Status,
	c.DESCRICAO Componente,
	cc.VALORMINIMO, 
	hf.CODCURSO, 
	hf.CODGRADE, 
	cc.CODCOMPONENTE,
	hf.HABILITACAOFILIAL_Ativo MatrizAplicadaAtiva,
	m.CODMODALIDADE,
	m.DESCRICAO Modalidade,
	ic.VALORMINIMO, ic.VALORMAXIMO,
	ic.IDHABILITACAOFILIAL
from 
	v_Unasp_SHABILITACAOFILIAL hf
	INNER JOIN SHABILITACAOFILIALPL ON SHABILITACAOFILIALPL.CODCOLIGADA = hf.CODCOLIGADA
		AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = hf.IDHABILITACAOFILIAL
	INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA
		AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
	left join SCOMPONENTECURRICULAR cc on hf.CODCOLIGADA=cc.CODCOLIGADA and hf.IDHABILITACAOFILIAL=cc.IDHABILITACAOFILIAL
	left join SCOMPONENTE c on c.CODCOLIGADA=cc.CODCOLIGADA and c.CODCOMPONENTE=cc.CODCOMPONENTE
	left join SMODALIDADE m on m.CODCOLIGADA = c.CODCOLIGADA and m.CODCOMPONENTE = c.CODCOMPONENTE
	/*MODIFICADO EM 18/05/2022 NATHAN PVT - Adicionado verificação na parametrização do curso para pegar o periodo letivo, e modificado o join
	dos itens curriculares para puxar apenas da ihdabilitacao do mesmo, pois estava gerando muitos registros.*/
	left join SITEMCURRICULAR ic on ic.CODCOLIGADA = m.CODCOLIGADA and ic.CODCOMPONENTE = m.CODCOMPONENTE and ic.CODMODALIDADE=m.CODMODALIDADE
		AND IC.IDHABILITACAOFILIAL = hf.IDHABILITACAOFILIAL
Where
	hf.CODTIPOCURSO in (1,2)
	and nomgrade like '%' + :NomeMatriz + '%'
	AND SPLETIVO.CODPERLET LIKE '%' + :CODPERLET + '%'
order by 1,2,3,4,5";1600;;;;18/05/2022;consultor1.totvs;1;1;1;1;;;;0;fc131e86-7585-4819-af51-4f5a8dc4eae7;0;;18446;mestre;25/10/2021;consultor1.totvs;18/05/2022;0
S;Concilia_Cartão;Conciliação Cartão;"SELECT
	f.NOME Filial,
	mpl.RA, a.NOME, c.CODCONTRATO, l.MESDECOMPETENCIA, p.PARCELA,  p.DTVENCIMENTO,
	l.IDLAN, lb.IDBAIXA, s.CODSERVICO, s.NOME, s.CODCOLNATFINANCEIRA, s.CODNATFINANCEIRA, lb.VALORORIGINAL, lb.VALORDESCONTO, lb.VALORBAIXA,
	fxcx.CARTAONSU, fxcx.CARTAOTID, fxcx.DATA, fxcx.VALOR, fxcx.CODCXA, fxcx.IDXCX, fxcx.IDFORMAPAGTO
FROM 
	SMATRICPL				mpl
	inner join GFILIAL		f	on f.CODCOLIGADA=mpl.CODCOLIGADA and f.CODFILIAL=mpl.CODFILIAL
	inner join v_Unasp_Aluno a	on a.CODCOLIGADA=mpl.CODCOLIGADA and mpl.RA=a.RA
	inner join SCONTRATO	c	on c.CODCOLIGADA = mpl.CODCOLIGADA and c.IDPERLET = mpl.IDPERLET and c.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and c.RA = mpl.RA
	inner join SPARCELA		p	on p.CODCOLIGADA = c.CODCOLIGADA   and p.RA = c.RA and p.CODCONTRATO = c.CODCONTRATO and p.IDPERLET = c.IDPERLET
	inner join SSERVICO		s	on s.CODCOLIGADA = p.CODCOLIGADA and s.CODSERVICO = p.CODSERVICO
	inner join SLAN			sl	on sl.CODCOLIGADA = p.CODCOLIGADA  and sl.IDPARCELA = p.IDPARCELA
	inner join FLAN			l	on l.CODCOLIGADA = sl.CODCOLIGADA  and l.IDLAN = sl.IDLAN
	inner join FLANBAIXA	lb	on lb.CODCOLIGADA = l.CODCOLIGADA and lb.IDLAN = l.IDLAN
	inner join FXCX			(NOLOCK) on lb.CODCOLIGADA = FXCX.CODCOLIGADA AND lb.IDXCX = FXCX.IDXCX
where 
	 fxcx.DATA between :DataIni and :DataFim
	 ";1321;;;;24/10/2022;isaldo;1;1;1;1;;;;0;2eb18132-6e73-4733-87ae-876b70fd351c;0;;9485;isaldo;24/10/2022;isaldo;24/10/2022;0
S;CONF;Confirmação de Matrícula por Pagamento;"SELECT 
	SMATRICPL.CODCOLIGADA,
	SMATRICPL.RA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SPLETIVO.IDPERLET,
	PPESSOA.NOME
FROM 
	SMATRICPL			(nolock)
	INNER JOIN SSTATUS	(nolock) ON SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
	INNER JOIN SPLETIVO (nolock) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	INNER JOIN SALUNO 	(nolock) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
	INNER JOIN PPESSOA 	(nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
WHERE 
	SPLETIVO.CODPERLET = :PERIODOLETIVO
	AND SMATRICPL.CODFILIAL = :CODFILIAL
	AND SPLETIVO.CODTIPOCURSO = :TIPOCURSO
	AND SSTATUS.CODSTATUS = :CODSTATUS";678;;;;25/08/2021;mestre;1;1;1;1;;;;0;c2ef7812-513d-4ed5-b255-70eac697888f;0;;8667;mestre;08/06/2021;mestre;25/08/2021;0
S;CONTACORRENTE;Alunos com conta corrente;"SELECT DISTINCT(SALUNO.RA) ,SALUNO.CODCOLIGADA , PPESSOA.NOME FROM SALUNO
INNER JOIN PPESSOA ON SALUNO.CODPESSOA = PPESSOA.CODIGO
INNER JOIN SOCORRENCIAALUNO ON SOCORRENCIAALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SOCORRENCIAALUNO.RA = SALUNO.RA";248;;;;26/07/2021;mestre;1;1;1;1;;;;0;f7108f52-3cdb-4f89-81b4-3ba9a9f5d905;0;;-805;mestre;26/07/2021;mestre;26/07/2021;0
S;ContatoCandidato;Dados de Contato a Candidatos;"select distinct
	ps.idps, ps.NOME Processo, ai.NOME AreaInteresse, c.NOME Campus, i.NUMEROINSCRICAO Inscricao, i.DATAINSCRICAO DataInscricao, U.NOME Candidato, u.TELEFONE1 Telefone, u.EMAIL Email, fi.NOME FormaInscricao, soi.DESCRICAO Status_Opcao
from 
	SPSINSCRICAOAREAOFERTADA i 
	inner join SPSPROCESSOSELETIVO ps on ps.IDPS = i.IDPS
	inner join SPSUSUARIO u on u.CODUSUARIOPS = i.CODUSUARIOPS
	left join SPSFORMAINSCRICAOPS fi on fi.CODCOLIGADA = i.CODCOLIGADA and fi.IDPS=i.IDPS and fi.IDFORMAINSCRICAO = i.IDFORMAINSCRICAO
	left join SPSOPCAOINSCRITO oi on oi.CODCOLIGADA = i.CODCOLIGADA and oi.IDPS=i.IDPS and oi.NUMEROINSCRICAO=i.NUMEROINSCRICAO
	left join SPSAREAINTERESSE ai on ai.IDAREAINTERESSE = oi.IDAREAINTERESSE
	left join SPSSTATUSOPCAO soi on soi.CODIGO=oi.STATUS
	left join SPSCAMPUS c on c.IDCAMPUS = i.IDCAMPUS
order by 
	ps.nome, u.nome";871;;;;18/10/2021;isaldo;1;1;1;1;;;;0;4c157614-c90b-4544-a0f2-bbcefbe8e933;0;;-27003;isaldo;18/10/2021;isaldo;18/10/2021;0
S;contrato000;testePortal;"SELECT SMATRICPL.CODCOLIGADA,
SMATRICPL.IDPERLET,
SMATRICPL.IDHABILITACAOFILIAL,
SMATRICPL.RA,
SCONTRATO.CODCONTRATO,
SCONTRATO.CODFILIAL,
SCONTRATO.CODTIPOCURSO
FROM SMATRICPL (NOLOCK)
JOIN SCONTRATO (NOLOCK)
ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
AND SMATRICPL.RA = SCONTRATO.RA
WHERE SMATRICPL.CODCOLIGADA = :CODCOLIGADAPARAM
AND SCONTRATO.CODFILIAL = :CODFILIALPARAM
AND CODTIPOCURSO = :CODTIPOCURSOPARAM
AND SMATRICPL.IDPERLET = :IDPERLETPARAM
AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIALPARAM
AND SMATRICPL.RA = :RAPARAM
";678;;;;26/01/2022;lucas.ssantos;1;1;1;1;;;;0;57fc6f06-2782-4b08-a050-cba44e16f35b;0;;-23199;lucas.ssantos;17/05/2021;lucas.ssantos;26/01/2022;0
S;contrato000.1;testePortal - Fonte de Dados;"SELECT 
 SMATRICPL.CODCOLIGADA,
 SMATRICPL.IDPERLET,
 SMATRICPL.IDHABILITACAOFILIAL,
 SMATRICPL.RA,
 SCONTRATO.CODCONTRATO,
 SCONTRATO.CODFILIAL,
 SCONTRATO.CODTIPOCURSO

FROM 
 SMATRICPL (NOLOCK)

 INNER JOIN SCONTRATO (NOLOCK) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								  SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 								  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 								  SMATRICPL.RA = SCONTRATO.RA
 							
WHERE 	SMATRICPL.CODCOLIGADA = :CODCOLIGADA1 /*1*/
	AND SCONTRATO.CODFILIAL =  :CODFILIAL1 /*2*/
	AND SCONTRATO.CODTIPOCURSO = :CODTIPOCURSO1 /*1*/
	AND SMATRICPL.IDPERLET = :IDPERLET1 /*1014*/ 
	AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1 /*15846*/
	AND SMATRICPL.RA =  :RA1 /*194410*/
	AND SCONTRATO.STATUS = 'N'
	";819;;;;31/10/2022;robson.canto;1;1;1;1;;;;0;57fc6f06-2782-4b08-a050-cba44e16f35b;0;;7012;robson.canto;28/12/2021;robson.canto;31/10/2022;0
S;contrato0001;contrato;"Select CODCOLIGADA, CODCONTRATO, CODFILIAL, CODTIPOCURSO, IDHABILITACAOFILIAL, IDPERLET, RA 
from scontrato";108;;;;31/10/2022;isaldo;1;1;1;1;;;;0;a8dc4225-45ae-4a84-b14e-1cad02b48c43;0;;-20182;isaldo;31/10/2022;isaldo;31/10/2022;0
S;ContratoCursando;Contratos com Status Cursando na Matricula do Período Letivo;"Select 
	c.CODCONTRATO 
From 
	SCONTRATO 				(nolock) c 
	inner join SMATRICPL 	(nolock) mpl on mpl.CODCOLIGADA = c.CODCOLIGADA and mpl.IDPERLET=c.IDPERLET and mpl.IDHABILITACAOFILIAL = c.IDHABILITACAOFILIAL and mpl.RA=c.RA
	inner join SSTATUS 		(nolock) st on st.CODCOLIGADA=mpl.CODCOLIGADA and st.CODSTATUS=mpl.CODSTATUS
Where 
	st.DESCRICAO='Cursando'";361;;;;05/08/2021;mestre;1;1;1;1;;;;0;867870c4-0a6d-46dd-b840-799d067f6724;0;;-9490;mestre;05/08/2021;mestre;05/08/2021;0
S;Contratos;Contratos ;;0;;;;25/02/2021;lucas.ssantos;1;1;1;1;;;;0;8086d80b-bcb9-45a7-a2f0-2b0599f88a3a;0;;-31185;lucas.ssantos;25/02/2021;lucas.ssantos;25/02/2021;0
S;Contratos.001;Contratos;"SELECT
	/*Parametros*/
	CT.RA,
	CT.CODCOLIGADA,
	CT.IDPERLET,
	CT.CODCONTRATO,

	/*Campos*/
	A.RA					ALUNO_RA,
	P.NOME					ALUNO_NOME,
	P.CARTIDENTIDADE		ALUNO_RG,
	P.ORGEMISSORIDENT		ALUNO_RGORGEMISSOR,
	P.UFCARTIDENT			ALUNO_UFRG,
	P.CPF					ALUNO_CPF,
	P.RUA					ALUNO_ENDERECO,
	P.NUMERO				ALUNO_ENDNUMERO,
	P.BAIRRO				ALUNO_ENDBAIRRO,
	P.CIDADE				ALUNO_ENDCIDADE,
	P.ESTADO				ALUNO_ENDESTADO,
	P.CEP					ALUNO_ENDCEP,
	P.TELEFONE1				ALUNO_TELEFONE,
	P.EMAIL					ALUNO_EMAIL,
 
 	F.CGCCFO			RESP_CPF,
 	F.PESSOAFISOUJUR	RESP_TIPO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.NOME ELSE F.NOME END						RESP_NOME,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CARTIDENTIDADE ELSE F.CIDENTIDADE END		RESP_RG,
	CASE WHEN P.CPF = F.CGCCFO THEN P.ORGEMISSORIDENT ELSE F.CI_ORGAO END		RESP_RGORGEMISSOR,
	CASE WHEN P.CPF = F.CGCCFO THEN P.UFCARTIDENT ELSE F.CI_UF END				RESP_RGUF,
	CASE WHEN P.CPF = F.CGCCFO THEN P.RUA ELSE F.RUA END						RESP_RUA,
	CASE WHEN P.CPF = F.CGCCFO THEN P.NUMERO ELSE F.NUMERO END					RESP_NUMEROCASA,
	CASE WHEN P.CPF = F.CGCCFO THEN P.BAIRRO ELSE F.BAIRRO END					RESP_BAIRRO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CIDADE ELSE F.CIDADE END					RESP_CIDADE,
	CASE WHEN P.CPF = F.CGCCFO THEN P.ESTADO ELSE F.CODETD END					RESP_ESTADO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CEP ELSE F.CEP	 END					RESP_CEP,
	CASE WHEN P.CPF = F.CGCCFO THEN P.TELEFONE1 ELSE F.TELEFONE END				RESP_TELEFONE,
	CASE WHEN P.CPF = F.CGCCFO THEN P.EMAIL ELSE F.EMAIL END					RESP_EMAIL,	

	C.NOME					CURSO_NOME,
	PGTO.DESCRICAO			CURSO_DESC,	
	PL.DESCRICAO			CURSO_ANOLETIVO,	
	CURSO_PARCELAMENSAL = (SELECT VALOR FROM SPARCELA WHERE PARCELA = '2' AND RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO),
	
	/*CURSO_VALOR = (SELECT SUM(VALOR) FROM SPARCELA WHERE RA = CT.RA	AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET	AND CODCONTRATO = CT.CODCONTRATO),*/
	CURSO_VALOR = CASE WHEN (SELECT 
							  SUM(SPARCELA.VALOR) 
				   			 
				   			 FROM 
				    		  SPARCELA (NOLOCK)
				   			 
				    		  INNER JOIN SSERVICO (NOLOCK)		ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
				    		  									   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
				   			 
				   			 WHERE SPARCELA.RA = CT.RA	
				   				AND SPARCELA.CODCOLIGADA = CT.CODCOLIGADA 
				   				AND SPARCELA.IDPERLET = CT.IDPERLET	
				   				AND SSERVICO.NOME LIKE 'MENS%'				   				
				   				AND SPARCELA.CODCONTRATO = CT.CODCONTRATO) > 0 THEN (SELECT
							  												 SUM(VALOR) 
				   			 
				   			 												FROM 
				    		  												 SPARCELA (NOLOCK)
				   			 
				   			 												WHERE RA = CT.RA	
				   																AND CODCOLIGADA = CT.CODCOLIGADA 
				   																AND IDPERLET = CT.IDPERLET	
				   																AND CODCONTRATO = CT.CODCONTRATO)
					 	ELSE (SELECT
 							   SUM(SMATRICULA.NUMCREDITOSCOB * SFAIXACRED.VALCRED) VALOR_CONTRATO
 
							  FROM
 							   SCONTRATO
 
 							   INNER JOIN SMATRICPL (NOLOCK)			ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   								   	   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 									   								   	   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 									   								   	   SMATRICPL.RA = SCONTRATO.RA
 									   
 							   INNER JOIN SMATRICULA (NOLOCK)			ON SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 									   								   	   SMATRICULA.IDPERLET = SMATRICPL.IDPERLET AND 
 									   								   	   SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 									   								   	   SMATRICULA.RA = SMATRICPL.RA 									   
								   
 							   INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND
 										   								   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
 										   
 							   INNER JOIN SFAIXACRED (NOLOCK)			ON SFAIXACRED.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										   								   SFAIXACRED.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   								   SFAIXACRED.IDPERLET = SMATRICULA.IDPERLET
  										 
							  WHERE	SCONTRATO.RA = CT.RA
							  	AND SCONTRATO.CODCOLIGADA = CT.CODCOLIGADA
							  	AND SCONTRATO.IDPERLET = CT.IDPERLET
							  	AND SCONTRATO.CODCONTRATO = CT.CODCONTRATO)
					 	
				  END,
	
	/*(SELECT SUM(VALOR) FROM SPARCELA WHERE	RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO) AS CURSO_VALOR,*/
	/*CPL.VALORCURSO		CURSO_VALOR,*/
	/*(SELECT COUNT(PARCELA) FROM SPARCELA WHERE	RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO) AS CURSO_PARCELA,*/ /*PGTO.DESCRICAO	CURSO_PARCELAS,*/	
	
	(SELECT 
	  COUNT(PARCELA) 
	 
	 FROM 
	  SPARCELA (NOLOCK)
	  
	  INNER JOIN SSERVICO (NOLOCK)	ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
	  								   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
	 
	 WHERE	SPARCELA.RA = CT.RA 
	 	AND SPARCELA.CODCOLIGADA = CT.CODCOLIGADA 
	 	AND SPARCELA.IDPERLET = CT.IDPERLET 
	 	AND SSERVICO.NOME LIKE 'MENS%'
	 	AND SPARCELA.CODCONTRATO = CT.CODCONTRATO) AS CURSO_PARCELA, /*PGTO.DESCRICAO	CURSO_PARCELAS,*/	
	
	T.CODTURMA				CURSO_CODTURMA,
	CT.CODCONTRATO			CURSO_CODCONTRATO,
	D.DISCIPLINAS			CURSO_DISCIPLINAS,
	C.CODMODALIDADECURSO	CURSO_MODALIDADE,
	case when sg.DESCRICAO like 'Residência Universitária%' then 1 else 0 end			RESIDENCIA_UNIV,
	C.CODTIPOCURSO			CURSO_TIPO,
	C.CODCURSO				CURSO_CODG,

	FL.NOMEFANTASIA			CAMPUS_NOME,
	FL.CGC					CAMPUS_CGC,
	FL.TELEFONE				CAMPUS_TELEFONE,
	FL.RUA					CAMPUS_ENDERECO,
	FL.NUMERO				CAMPUS_ENDERECO_NUMERO,
	FL.BAIRRO				CAMPUS_BAIRRO,
	FL.CIDADE				CAMPUS_CIDADE,
	UPPER(FL.CIDADE)		CAMPUS_CIDADEUPPER,
	FL.ESTADO				CAMPUS_ESTADO,
	FL.CEP					CAMPUS_CEP,

	DF.NOMEREPRES			REPRESENTANTE_NOME, 
	DF.LOGRADREPRES			REPRESENTANTE_CARGO, 
	DF.CPFREPRES			REPRESENTANTE_CPF,
	DF.NOMECONTADOR			TESTEMUNHA_NOME, 
	DF.CPFCONTADOR			TESTEMUNHA_CPF,
	
	AssDIRETOR 		= (select top 1 ass.IMAGEM from PPESSOA p inner join ZMDASSINATURAS ass on ass.CODPESSOA = p.CODIGO Where cpf = replace(replace(DF.CPFREPRES,'.',''),'-','')),
	AssTESTEMUNHA	= (select top 1 ass.IMAGEM from PPESSOA p inner join ZMDASSINATURAS ass on ass.CODPESSOA = p.CODIGO Where cpf = replace(replace(DF.CPFCONTADOR,'.',''),'-','')), 	
/*
	(SELECT IMAGEM FROM GIMAGEM WHERE ID = 
		CASE FL.CODFILIAL
			WHEN 1 THEN 21
			WHEN 2 THEN 17
			WHEN 3 THEN 19
			WHEN 4 THEN 24 END)	AS AssDIRETOR,
	
	(SELECT IMAGEM FROM GIMAGEM WHERE ID = 
		CASE FL.CODFILIAL
			WHEN 1 THEN 22
			WHEN 2 THEN 18
			WHEN 3 THEN 20
			WHEN 4 THEN 23 END)	AS AssTESTEMUNHA
*/

	   PL.DESCRICAO PERIODO_LETIVO,
/*
	   SASSINATURACONTRATO.GUID ASSINATURA_GUID,
	   SASSINATURACONTRATO.TOKEN ASSINATURA_TOKEN,
       SASSINATURACONTRATO.EMAIL ASSINATURA_EMAIL,
	   SASSINATURACONTRATO.CLIENTIP ASSINATURA_CLIENTIP,
       SASSINATURACONTRATO.DATAHORAENVIOEMAIL ASSINATURA_DATAHORAENVIOEMAIL,
       SASSINATURACONTRATO.DATAHORAASSINATURA ASSINATURA_DATAHORAASSINATURA,
*/
	   CASE WHEN SMATRICPLCOMPL.GUIDCONTRATO IS NOT NULL THEN '' /*SMATRICPLCOMPL.GUIDCONTRATO*/
	   		ELSE SASSINATURACONTRATO.GUID END ASSINATURA_GUID,

	   CASE WHEN SMATRICPLCOMPL.GUIDCONTRATO IS NOT NULL THEN SMATRICPLCOMPL.GUIDCONTRATO
	   		ELSE SASSINATURACONTRATO.TOKEN END ASSINATURA_TOKEN,

	   CASE WHEN SMATRICPLCOMPL.GUIDCONTRATO IS NOT NULL THEN P.EMAIL
	   		ELSE SASSINATURACONTRATO.EMAIL END ASSINATURA_EMAIL,

	   CASE WHEN SMATRICPLCOMPL.GUIDCONTRATO IS NOT NULL THEN SMATRICPLCOMPL.IPACEITE
	   		ELSE SASSINATURACONTRATO.CLIENTIP END ASSINATURA_CLIENTIP,

	   CASE WHEN SMATRICPLCOMPL.GUIDCONTRATO IS NOT NULL THEN CT.DTCONTRATO
	   		ELSE SASSINATURACONTRATO.DATAHORAENVIOEMAIL END ASSINATURA_DATAHORAENVIOEMAIL,

	   CASE WHEN SMATRICPLCOMPL.GUIDCONTRATO IS NOT NULL THEN CT.DTASSINATURA
	   		ELSE SASSINATURACONTRATO.DATAHORAASSINATURA END ASSINATURA_DATAHORAASSINATURA,

       CASE WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.NOME
	     	ELSE FCFO.NOMEFANTASIA END ASSINATURA_RESPONSAVEL,
	   
	   CASE WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.CPF
	     	ELSE FCFO.CGCCFO END ASSINATURA_CPF,
	     	
	   (ZMDVLMAT.VALOR * ZMDVLMAT.PARCELAS) VALOR_EAD,
	   ZMDVLMAT.PARCELAS PARCELAS_EAD  	
	     	

FROM 
	SALUNO A
	LEFT JOIN SMATRICPL MTCPL ON MTCPL.RA = A.RA AND MTCPL.CODCOLIGADA = A.CODCOLIGADA		   
	LEFT JOIN STURMA T ON T.CODCOLIGADA = MTCPL.CODCOLIGADA AND T.CODFILIAL = MTCPL.CODFILIAL AND T.CODTURMA = MTCPL.CODTURMA AND T.IDPERLET = MTCPL.IDPERLET	
	LEFT JOIN SHABILITACAOFILIAL HF ON HF.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL AND HF.CODCOLIGADA = MTCPL.CODCOLIGADA	
	LEFT JOIN SGRADE sg on sg.CODCOLIGADA=hf.CODCOLIGADA and sg.CODCURSO=hf.CODCURSO and sg.CODHABILITACAO=hf.CODHABILITACAO and sg.CODGRADE=hf.CODGRADE
	LEFT JOIN SCURSO C ON C.CODCURSO = HF.CODCURSO AND C.CODCOLIGADA = HF.CODCOLIGADA	
	LEFT JOIN SCURSOCOMPL CPL ON CPL.CODCOLIGADA = C.CODCOLIGADA AND CPL.CODCURSO = C.CODCURSO
	LEFT JOIN PPESSOA P ON P.CODIGO = A.CODPESSOA
	LEFT JOIN SPESSOA PE ON PE.CODIGO = P.CODIGO
	LEFT JOIN FCFO F ON F.CODCFO = A.CODCFO AND F.CODCOLIGADA = A.CODCOLCFO	
	LEFT JOIN SCONTRATO CT ON CT.RA = MTCPL.RA AND CT.CODCOLIGADA = MTCPL.CODCOLIGADA AND CT.IDPERLET = MTCPL.IDPERLET AND CT.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL
	LEFT JOIN SFILIAL SF ON SF.CODCOLIGADA = CT.CODCOLIGADA AND SF.CODFILIAL = CT.CODFILIAL		
	LEFT JOIN GFILIAL FL ON FL.CODCOLIGADA = SF.CODCOLIGADA AND FL.CODFILIAL = SF.CODFILIAL	
	LEFT JOIN SPLETIVO PL ON PL.CODCOLIGADA = CT.CODCOLIGADA AND PL.IDPERLET = CT.IDPERLET	
	LEFT JOIN SPLANOPGTO PGTO ON PGTO.CODPLANOPGTO = CT.CODPLANOPGTO AND PGTO.CODCOLIGADA = CT.CODCOLIGADA AND PGTO.IDPERLET = CT.IDPERLET AND PGTO.CODTIPOCURSO = C.CODTIPOCURSO
	LEFT JOIN DFILIAL DF ON DF.CODFILIAL = FL.CODFILIAL			
	LEFT JOIN ( select CODCOLIGADA,IDPERLET,IDHABILITACAOFILIAL,RA, count(*) Disciplinas 
				from SMATRICULA group by CODCOLIGADA,IDPERLET,IDHABILITACAOFILIAL,RA ) D 
					ON D.CODCOLIGADA = MTCPL.CODCOLIGADA AND D.IDPERLET = MTCPL.IDPERLET AND D.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL AND D.RA = MTCPL.RA

    LEFT JOIN SHABILITACAOALUNO (NOLOCK)		ON SHABILITACAOALUNO.CODCOLIGADA = HF.CODCOLIGADA AND
    											   SHABILITACAOALUNO.IDHABILITACAOFILIAL = HF.IDHABILITACAOFILIAL AND
    											   SHABILITACAOALUNO.RA = CT.RA
   											   
    LEFT JOIN SASSINATURACONTRATO (NOLOCK) 	    ON SASSINATURACONTRATO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
       											   SASSINATURACONTRATO.RA = SHABILITACAOALUNO.RA AND 
       											   SASSINATURACONTRATO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
       											   SASSINATURACONTRATO.IDPERLET = PL.IDPERLET

    LEFT JOIN PPESSOA (NOLOCK)					ON SASSINATURACONTRATO.CODPESSOA = PPESSOA.CODIGO
    
    LEFT JOIN FCFO (NOLOCK)						ON SASSINATURACONTRATO.CODCOLIGADACFO = FCFO.CODCOLIGADA AND 
    											   SASSINATURACONTRATO.CODCFO = FCFO.CODCFO

	LEFT JOIN SMATRICPLCOMPL (NOLOCK)			ON SMATRICPLCOMPL.CODCOLIGADA = MTCPL.CODCOLIGADA AND 
												   SMATRICPLCOMPL.IDPERLET = MTCPL.IDPERLET AND 
												   SMATRICPLCOMPL.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL AND 
												   SMATRICPLCOMPL.RA = MTCPL.RA 

 	LEFT JOIN ZMDVLMAT (NOLOCK)					ON ZMDVLMAT.CODCOLIGADA = CT.CODCOLIGADA AND
 												   ZMDVLMAT.FILIAL = CT.CODFILIAL AND
 												   ZMDVLMAT.IDPERLET = CT.IDPERLET AND
 												   ZMDVLMAT.IDHABILITACAOFILIAL = CT.IDHABILITACAOFILIAL   											   

WHERE	
	CT.RA = :RA1
	AND CT.CODCOLIGADA =:CODCOLIGADA1
	AND CT.IDPERLET =:IDPERLET1
	AND CT.CODCONTRATO =:CODCONTRATO1";11948;;;;11/10/2022;robson.canto;1;1;1;1;;;;0;6444a17f-1c95-4efd-8848-ecfaccf64e9f;0;;-24396;lucas.ssantos;25/02/2021;robson.canto;11/10/2022;0
S;Contratos.001.1;Contratos - Fonte de Dados;"SELECT
MTCPL.CODTURMA,
	/*Parametros*/
	CT.RA,
	CT.CODCOLIGADA,
	CT.IDPERLET,
	CT.CODCONTRATO,

	/*Campos*/
	A.RA					ALUNO_RA,
	P.NOME					ALUNO_NOME,
	P.CARTIDENTIDADE		ALUNO_RG,
	P.ORGEMISSORIDENT		ALUNO_RGORGEMISSOR,
	P.UFCARTIDENT			ALUNO_UFRG,
	P.CPF					ALUNO_CPF,
	P.RUA					ALUNO_ENDERECO,
	P.NUMERO				ALUNO_ENDNUMERO,
	P.BAIRRO				ALUNO_ENDBAIRRO,
	P.CIDADE				ALUNO_ENDCIDADE,
	P.ESTADO				ALUNO_ENDESTADO,
	P.CEP					ALUNO_ENDCEP,
	P.TELEFONE1				ALUNO_TELEFONE,
	P.EMAIL					ALUNO_EMAIL,
 	PL.CODFILIAL,
 	F.CGCCFO			RESP_CPF,
 	F.PESSOAFISOUJUR	RESP_TIPO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.NOME ELSE F.NOME END						RESP_NOME,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CARTIDENTIDADE ELSE F.CIDENTIDADE END		RESP_RG,
	CASE WHEN P.CPF = F.CGCCFO THEN P.ORGEMISSORIDENT ELSE F.CI_ORGAO END		RESP_RGORGEMISSOR,
	CASE WHEN P.CPF = F.CGCCFO THEN P.UFCARTIDENT ELSE F.CI_UF END				RESP_RGUF,
	CASE WHEN P.CPF = F.CGCCFO THEN P.RUA ELSE F.RUA END						RESP_RUA,
	CASE WHEN P.CPF = F.CGCCFO THEN P.NUMERO ELSE F.NUMERO END					RESP_NUMEROCASA,
	CASE WHEN P.CPF = F.CGCCFO THEN P.BAIRRO ELSE F.BAIRRO END					RESP_BAIRRO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CIDADE ELSE F.CIDADE END					RESP_CIDADE,
	CASE WHEN P.CPF = F.CGCCFO THEN P.ESTADO ELSE F.CODETD END					RESP_ESTADO,
	CASE WHEN P.CPF = F.CGCCFO THEN P.CEP ELSE F.CEP	 END					RESP_CEP,
	CASE WHEN P.CPF = F.CGCCFO THEN P.TELEFONE1 ELSE F.TELEFONE END				RESP_TELEFONE,
	CASE WHEN P.CPF = F.CGCCFO THEN P.EMAIL ELSE F.EMAIL END					RESP_EMAIL,	

	C.NOME					CURSO_NOME,
	PGTO.DESCRICAO			CURSO_DESC,	
	PL.DESCRICAO			CURSO_ANOLETIVO,	
	CURSO_PARCELAMENSAL = (SELECT sum(VALOR) FROM SPARCELA WHERE PARCELA = '2' AND RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO),
	CURSO_VALOR = (SELECT SUM(VALOR) FROM SPARCELA WHERE RA = CT.RA	AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET	AND CODCONTRATO = CT.CODCONTRATO),		
	/*(SELECT SUM(VALOR) FROM SPARCELA WHERE	RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO) AS CURSO_VALOR,*/
	/*CPL.VALORCURSO		CURSO_VALOR,*/
	(SELECT COUNT(PARCELA) FROM SPARCELA WHERE	RA = CT.RA AND CODCOLIGADA = CT.CODCOLIGADA AND IDPERLET = CT.IDPERLET AND CODCONTRATO = CT.CODCONTRATO) AS CURSO_PARCELA, /*PGTO.DESCRICAO	CURSO_PARCELAS,*/	
	T.CODTURMA				CURSO_CODTURMA,
	CT.CODCONTRATO			CURSO_CODCONTRATO,
	D.DISCIPLINAS			CURSO_DISCIPLINAS,
	C.CODMODALIDADECURSO	CURSO_MODALIDADE,
	C.CODTIPOCURSO			CURSO_TIPO,
	C.CODCURSO				CURSO_CODG,

	FL.NOMEFANTASIA			CAMPUS_NOME,
	FL.CGC					CAMPUS_CGC,
	FL.TELEFONE				CAMPUS_TELEFONE,
	FL.RUA					CAMPUS_ENDERECO,
	FL.NUMERO				CAMPUS_ENDERECO_NUMERO,
	FL.BAIRRO				CAMPUS_BAIRRO,
	FL.CIDADE				CAMPUS_CIDADE,
	UPPER(FL.CIDADE)		CAMPUS_CIDADEUPPER,
	FL.ESTADO				CAMPUS_ESTADO,
	FL.CEP					CAMPUS_CEP,

	DF.NOMEREPRES			REPRESENTANTE_NOME, 
	DF.LOGRADREPRES			REPRESENTANTE_CARGO, 
	DF.CPFREPRES			REPRESENTANTE_CPF,
	DF.NOMECONTADOR			TESTEMUNHA_NOME, 
	DF.CPFCONTADOR			TESTEMUNHA_CPF,
	
	AssDIRETOR 		= (select top 1 ass.IMAGEM from PPESSOA p inner join ZMDASSINATURAS ass on ass.CODPESSOA = p.CODIGO Where cpf = replace(replace(DF.CPFREPRES,'.',''),'-','')),
	AssTESTEMUNHA	= (select top 1 ass.IMAGEM from PPESSOA p inner join ZMDASSINATURAS ass on ass.CODPESSOA = p.CODIGO Where cpf = replace(replace(DF.CPFCONTADOR,'.',''),'-','')),
/*
	(SELECT IMAGEM FROM GIMAGEM WHERE ID = 
		CASE FL.CODFILIAL
			WHEN 1 THEN 21
			WHEN 2 THEN 17
			WHEN 3 THEN 19
			WHEN 4 THEN 24 END)	AS AssDIRETOR,
	
	(SELECT IMAGEM FROM GIMAGEM WHERE ID = 
		CASE FL.CODFILIAL
			WHEN 1 THEN 22
			WHEN 2 THEN 18
			WHEN 3 THEN 20
			WHEN 4 THEN 23 END)	AS AssTESTEMUNHA
*/

	   PL.DESCRICAO PERIODO_LETIVO,
	   SASSINATURACONTRATO.GUID ASSINATURA_GUID,
	   SASSINATURACONTRATO.TOKEN ASSINATURA_TOKEN,
       SASSINATURACONTRATO.EMAIL ASSINATURA_EMAIL,
	   SASSINATURACONTRATO.CLIENTIP ASSINATURA_CLIENTIP,
       SASSINATURACONTRATO.DATAHORAENVIOEMAIL ASSINATURA_DATAHORAENVIOEMAIL,
       SASSINATURACONTRATO.DATAHORAASSINATURA ASSINATURA_DATAHORAASSINATURA,
       CASE WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.NOME
	     	ELSE FCFO.NOMEFANTASIA END ASSINATURA_RESPONSAVEL,
	   
	   CASE WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.CPF
	     	ELSE FCFO.CGCCFO END ASSINATURA_CPF,
	     	
	   (ZMDVLMAT.VALOR * ZMDVLMAT.PARCELAS) VALOR_EAD,
	   ZMDVLMAT.PARCELAS PARCELAS_EAD  	

FROM 
	SALUNO A (NOLOCK)
	LEFT JOIN SMATRICPL MTCPL (NOLOCK) ON MTCPL.RA = A.RA AND MTCPL.CODCOLIGADA = A.CODCOLIGADA		   
	LEFT JOIN STURMA T (NOLOCK) ON T.CODCOLIGADA = MTCPL.CODCOLIGADA AND T.CODFILIAL = MTCPL.CODFILIAL AND T.CODTURMA = MTCPL.CODTURMA AND T.IDPERLET = MTCPL.IDPERLET	
	LEFT JOIN SHABILITACAOFILIAL HF (NOLOCK) ON HF.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL AND HF.CODCOLIGADA = MTCPL.CODCOLIGADA	
	LEFT JOIN SCURSO C (NOLOCK) ON C.CODCURSO = HF.CODCURSO AND C.CODCOLIGADA = HF.CODCOLIGADA	
	LEFT JOIN SCURSOCOMPL CPL (NOLOCK) ON CPL.CODCOLIGADA = C.CODCOLIGADA AND CPL.CODCURSO = C.CODCURSO
	LEFT JOIN PPESSOA P (NOLOCK) ON P.CODIGO = A.CODPESSOA
	LEFT JOIN SPESSOA PE (NOLOCK) ON PE.CODIGO = P.CODIGO
	LEFT JOIN FCFO F (NOLOCK) ON F.CODCFO = A.CODCFO AND F.CODCOLIGADA = A.CODCOLCFO	
	LEFT JOIN SCONTRATO CT (NOLOCK) ON CT.RA = MTCPL.RA AND CT.CODCOLIGADA = MTCPL.CODCOLIGADA AND CT.IDPERLET = MTCPL.IDPERLET AND CT.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL
	LEFT JOIN SFILIAL SF (NOLOCK) ON SF.CODCOLIGADA = CT.CODCOLIGADA AND SF.CODFILIAL = CT.CODFILIAL		
	LEFT JOIN GFILIAL FL (NOLOCK)ON FL.CODCOLIGADA = SF.CODCOLIGADA AND FL.CODFILIAL = SF.CODFILIAL	
	LEFT JOIN SPLETIVO PL (NOLOCK) ON PL.CODCOLIGADA = CT.CODCOLIGADA AND PL.IDPERLET = CT.IDPERLET	
	LEFT JOIN SPLANOPGTO PGTO (NOLOCK) ON PGTO.CODPLANOPGTO = CT.CODPLANOPGTO AND PGTO.CODCOLIGADA = CT.CODCOLIGADA AND PGTO.IDPERLET = CT.IDPERLET AND PGTO.CODTIPOCURSO = C.CODTIPOCURSO
	LEFT JOIN DFILIAL DF (NOLOCK) ON DF.CODFILIAL = FL.CODFILIAL			
	LEFT JOIN ( select CODCOLIGADA,IDPERLET,IDHABILITACAOFILIAL,RA, count(*) Disciplinas 
				from SMATRICULA (NOLOCK) group by CODCOLIGADA,IDPERLET,IDHABILITACAOFILIAL,RA ) D 
					ON D.CODCOLIGADA = MTCPL.CODCOLIGADA AND D.IDPERLET = MTCPL.IDPERLET AND D.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL AND D.RA = MTCPL.RA

    LEFT JOIN SHABILITACAOALUNO (NOLOCK)		ON SHABILITACAOALUNO.CODCOLIGADA = HF.CODCOLIGADA AND
    											   SHABILITACAOALUNO.IDHABILITACAOFILIAL = HF.IDHABILITACAOFILIAL AND
    											   SHABILITACAOALUNO.RA = CT.RA

    											   
    LEFT JOIN SASSINATURACONTRATO (NOLOCK) 	   ON SASSINATURACONTRATO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
       											  SASSINATURACONTRATO.RA = SHABILITACAOALUNO.RA AND 
       											  SASSINATURACONTRATO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
       											  SASSINATURACONTRATO.IDPERLET = PL.IDPERLET

    LEFT JOIN PPESSOA (NOLOCK)					ON SASSINATURACONTRATO.CODPESSOA = PPESSOA.CODIGO
    
    LEFT JOIN FCFO (NOLOCK)						ON SASSINATURACONTRATO.CODCOLIGADACFO = FCFO.CODCOLIGADA AND 
    											   SASSINATURACONTRATO.CODCFO = FCFO.CODCFO

 	LEFT JOIN ZMDVLMAT (NOLOCK)					ON ZMDVLMAT.CODCOLIGADA = CT.CODCOLIGADA AND
 												   ZMDVLMAT.FILIAL = CT.CODFILIAL AND
 												   ZMDVLMAT.IDPERLET = CT.IDPERLET AND
 												   ZMDVLMAT.IDHABILITACAOFILIAL = CT.IDHABILITACAOFILIAL   											   

WHERE	
	CT.RA =  :RA1 /*194410*/
	AND CT.CODCOLIGADA =  :CODCOLIGADA1 /*1*/
	AND CT.IDPERLET =  :IDPERLET1 /*1014 */
	AND CT.CODCONTRATO =  :CODCONTRATO1 /*176507*/";7711;;;;01/11/2022;consultor1.totvs;1;1;1;1;;;;0;0b483de9-7a7c-4d37-9861-3d9390b909f3;0;;30633;robson.canto;28/12/2021;consultor1.totvs;01/11/2022;0
S;Contratos.002;Somar valor total do contrato;"SELECT

	SUM (
		CASE
			WHEN SPARCELA.PARCELA = 1 THEN 0
			ELSE SPARCELA.VALOR
		END
	)AS VALOR_TOTAL,

	SPARCELA.CODCONTRATO CODCONTRATO
	
FROM PPESSOA
	
	INNER JOIN SALUNO ON SALUNO.CODPESSOA = PPESSOA.CODIGO	
	INNER JOIN SCONTRATO ON SCONTRATO.RA = SALUNO.RA
	INNER JOIN SPARCELA ON SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
	
	WHERE SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
	
	GROUP BY SPARCELA.CODCONTRATO";438;;;;02/03/2021;lucas.ssantos;1;1;1;1;;;;0;5b4bf00d-d2c8-4ebe-9d54-5620d1e5a95f;0;;25957;lucas.ssantos;25/02/2021;lucas.ssantos;02/03/2021;0
S;Contratos.003;Valor e Parcelas Graduação e Pós-Graduação;"SELECT

PGTO.DESCRICAO FIN_PARCELAS

FROM SALUNO A
	INNER JOIN SMATRICPL MTCPL 
			ON MTCPL.RA = A.RA
		   AND MTCPL.CODCOLIGADA = A.CODCOLIGADA
	
	INNER JOIN SHABILITACAOFILIAL HF
			ON HF.IDHABILITACAOFILIAL = MTCPL.IDHABILITACAOFILIAL
		   AND HF.CODCOLIGADA = MTCPL.CODCOLIGADA
	
	INNER JOIN SCURSO C
			ON C.CODCURSO = HF.CODCURSO
		   AND C.CODCOLIGADA = HF.CODCOLIGADA
	
	INNER JOIN SCURSOCOMPL CPL
			ON CPL.CODCOLIGADA = C.CODCOLIGADA
		   AND CPL.CODCURSO = C.CODCURSO
	
	INNER JOIN PPESSOA P 
			ON P.CODIGO = A.CODPESSOA

	INNER JOIN FCFO F 
			ON F.CODCFO = A.CODCFO
		   AND F.CODCOLIGADA = A.CODCOLCFO	

	INNER JOIN SCONTRATO CT 
			ON CT.RA = A.RA
		   AND CT.CODCOLIGADA = A.CODCOLIGADA

	INNER JOIN SPARCELA PC
			ON PC.CODCONTRATO = CT.CODCONTRATO
		   AND PC.IDPERLET = CT.IDPERLET
		   AND PC.CODCOLIGADA = CT.CODCOLIGADA
		   AND PC.RA = CT.RA
	
	INNER JOIN SPLETIVO PL
			ON PL.CODCOLIGADA = CT.CODCOLIGADA
		   AND PL.IDPERLET = CT.IDPERLET
	
	INNER JOIN SPLANOPGTO PGTO
			ON PGTO.CODPLANOPGTO = CT.CODPLANOPGTO
		   AND PGTO.CODCOLIGADA = CT.CODCOLIGADA 
		   AND PGTO.IDPERLET = CT.IDPERLET 
		   AND PGTO.CODTIPOCURSO = C.CODTIPOCURSO

WHERE
	A.RA = :RA
	AND A.CODCOLIGADA = :CODCOLIGADA
	AND PL.IDPERLET = :IDPERLET
	AND CT.CODCONTRATO = :CODCONTRATO";1331;;;;11/05/2021;lucas.ssantos;1;1;1;1;;;;0;9067bcad-1096-4095-b23e-1006635fbc8e;0;;27333;lucas.ssantos;10/05/2021;lucas.ssantos;11/05/2021;0
S;Contratos.004;Assinatura;"SELECT TOP 1
 SASSINATURACONTRATO.*

FROM
 SASSINATURACONTRATO (NOLOCK)
 
WHERE	SASSINATURACONTRATO.CODCOLIGADA = :CODCOLIGADA1
	AND SASSINATURACONTRATO.RA = :RA1
	AND SASSINATURACONTRATO.CODCONTRATO = :CODCONTRATO1
	AND SASSINATURACONTRATO.IDPERLET = :IDPERLET1
	
ORDER BY SASSINATURACONTRATO.DATAHORAASSINATURA DESC";328;;;;22/12/2021;robson.canto;1;1;1;1;;;;0;bda6f1d5-5724-4f29-853c-3028e01bd910;0;;16472;robson.canto;22/12/2021;robson.canto;22/12/2021;0
S;Contratos.005;Assinatura Detalhada;"SELECT 
 CASE WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.NOME
   	  ELSE FCFO.NOMEFANTASIA END ASSINATURA_RESPONSAVEL,

 SASSINATURACONTRATO.EMAIL ASSINATURA_EMAIL,
 
 CASE WHEN PPESSOA.CODIGO IS NOT NULL THEN PPESSOA.CPF
      ELSE FCFO.CGCCFO END ASSINATURA_CPF,

 SASSINATURACONTRATO.DATAHORAENVIOEMAIL ASSINATURA_DATAHORAENVIOEMAIL,
 SASSINATURACONTRATO.DATAHORAASSINATURA ASSINATURA_DATAHORAASSINATURA,
 SASSINATURACONTRATO.CLIENTIP ASSINATURA_CLIENTIP,
 SASSINATURACONTRATO.TOKEN ASSINATURA_TOKEN, 
 SASSINATURACONTRATO.GUID ASSINATURA_GUID,
 
 SALUNO.RA ALUNO_RA,
 PP.NOME ALUNO_NOME, 
 SCURSO.NOME CURSO_NOME,
 STURMA.CODTURMA CURSO_CODTURMA, 
 SCONTRATO.CODCONTRATO			CURSO_CODCONTRATO,
 SPLETIVO.DESCRICAO PERIODO_LETIVO
 
FROM 
 SCONTRATO (NOLOCK)
 
 INNER JOIN SALUNO (NOLOCK)					ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 								   			   SALUNO.RA = SCONTRATO.RA
 								   
 INNER JOIN PPESSOA PP (NOLOCK)				ON PP.CODIGO = SALUNO.CODPESSOA
 
 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								   			   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 								   			   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 								   				SMATRICPL.RA = SCONTRATO.RA
 
 INNER JOIN STURMA (NOLOCK)					ON STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   			   STURMA.CODFILIAL = SMATRICPL.CODFILIAL AND 
 								   			   STURMA.CODTURMA = SMATRICPL.CODTURMA AND 
 								   			   STURMA.IDPERLET = SMATRICPL.IDPERLET
 
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND
 											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
 											   
 INNER JOIN SCURSO (NOLOCK)					ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
 											   
 INNER JOIN SPLETIVO (NOLOCK)				ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 											   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET	


 INNER JOIN SHABILITACAOALUNO (NOLOCK)		ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
    										   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
    										   SHABILITACAOALUNO.RA = SCONTRATO.RA

    											   
 LEFT JOIN SASSINATURACONTRATO (NOLOCK) 	ON SASSINATURACONTRATO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
       										   SASSINATURACONTRATO.RA = SHABILITACAOALUNO.RA AND 
       										   SASSINATURACONTRATO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
       										   SASSINATURACONTRATO.IDPERLET = SPLETIVO.IDPERLET

 LEFT JOIN PPESSOA (NOLOCK)					ON SASSINATURACONTRATO.CODPESSOA = PPESSOA.CODIGO
    
 LEFT JOIN FCFO (NOLOCK)					ON SASSINATURACONTRATO.CODCOLIGADACFO = FCFO.CODCOLIGADA AND 
    										   SASSINATURACONTRATO.CODCFO = FCFO.CODCFO
											   
WHERE	SCONTRATO.RA = :RA
	AND SCONTRATO.CODCOLIGADA = :CODCOLIGADA1
	AND SCONTRATO.IDPERLET =  :IDPERLET1
	AND SCONTRATO.CODCONTRATO =  :CODCONTRATO1";3139;;;;28/02/2022;robson.canto;1;1;1;1;;;;0;80f8e1ec-2089-4170-84eb-48aff0999b2b;0;;10779;robson.canto;28/02/2022;robson.canto;28/02/2022;0
S;CUBO.00001;CH DOS ALUNOS PARA INTEGRALIZAÇÃO;"SELECT SMATRICPL.CODCOLIGADA , SMATRICPL.IDHABILITACAOFILIAL , SGRADE.DESCRICAO,
       ISNULL (CHCOMPONENTE.TOTAL,0)  																						     AS CHCOMPONENTE,
	   ISNULL(CHATIVIDADE.TOTAL,0)																								 AS CHATIVIDADES,
	   CASE WHEN SMATRICPL.CODTIPOMAT  = 1 THEN 'Ingressante' ELSE 'Veterano' END												 AS TIPOMAT	,
	   GFILIAL.NOMEFANTASIA                                                                                                      AS UNIDADE,
       SMODALIDADECURSO.DESCRICAO                                                                                                AS MODALIDADE,
       SCURSO.NOME                                                                                                               AS CURSO,
       SHABILITACAOFILIAL.CODGRADE CODMATRIZ,
       SMATRICPL.CODTURMA,
       SPLETIVO.CODPERLET                                                                                                        AS PERIODO_LETIVO,
       STATUS_CURSO.DESCRICAO                                                                                                    AS SITUACAO_CURSO,
       SHABILITACAOALUNO.DTCONCLUSAOCURSO                                                                                        AS DATA_CONCLUSAO_CURSO,
       SSTATUS.DESCRICAO                                                                                                         AS SITUAÇÃO_MAT_PERIODO_LETIVO,
       SMATRICPL.RA, PPESSOA.CPF, PPESSOA.EMAIL,
       PPESSOA.NOME,
       CASE
         WHEN PPESSOA.SEXO = 'M' THEN 'Masculino'
         ELSE 'Feminino'
       END                   SEXO,                                                                                                    
     
       STIPOINGRESSO.DESCRICAO                                                                                                   'TIPO INGRESSO',
       SMATRICPL.PERIODO                                                                                                         PERIODOALUNO,
       ULTIMOPERIODO.ULTIMOPERIODO                                                                                               QTDPERIODOGRADE,
       /*CHEMCURSO_OPT.TOTAL                                                                                                       CH_EMCURSO_OPT, 
	   ISNULL(CHEMCURSO.TOTAL, 0)  + isnull(CHEMCURSO_OPT.TOTAL,0)                                                               CH_EMCURSO_COMOPTATIVA,
       ISNULL(CHINTEGRALIZADA.TOTAL, 0) + ISNULL(CHEMCURSO_OPT.TOTAL, 0)                                                         CH_INTEGRALIZADA,
       SGRADE.CARGAHORARIA                                                                                                       CH_GRADE,
       ISNULL(CHEQV.TOTAL,0)                                                                                                     CH_CEQV,
       ISNULL(CHEQV.TOTAL,0)+ISNULL(CHEMCURSO.TOTAL, 0)+ ISNULL(CHEMCURSO_OPT.TOTAL, 0)                                          CH_EMCURSO,
       ISNULL(SGRADE.CARGAHORARIA,0) - ISNULL(CHINTEGRALIZADA.TOTAL, 0) - ( ISNULL(CHEQV.TOTAL,0)+ISNULL(CHEMCURSO.TOTAL, 0)+ ISNULL(CHEMCURSO_OPT.TOTAL, 0)  ) - ISNULL(CHEQV.TOTAL,0) A_CURSAR,
       CAST(( ( ISNULL(CHINTEGRALIZADA.TOTAL, 0) +  ISNULL(CHEQV.TOTAL,0) + ISNULL(CHEMCURSO.TOTAL, 0) + ISNULL(CHEMCURSO_OPT.TOTAL, 0) + ISNULL(CHEQV.TOTAL,0) ) / SGRADE.CARGAHORARIA ) * 100 AS DECIMAL(10, 2)) AS '% CONCLUSÃO',
	   CHINTEGRALIZADA.MEDIA MEDIA*/
	   SGRADE.CARGAHORARIA - ISNULL (CHCOMPONENTE.TOTAL,0) CH_GRADE ,
	   ISNULL(CHINTEGRALIZADA.TOTAL, 0)	                                                       CH_INTEGRALIZADA,
	   ISNULL(CHEQV.TOTAL,0)+ISNULL(CHEMCURSO.TOTAL, 0)+ ISNULL(CHEMCURSO_OPT.TOTAL, 0)                                          CH_EMCURSO,
	   
	   
       (SGRADE.CARGAHORARIA - ISNULL (CHCOMPONENTE.TOTAL,0)) -        
       (ISNULL(CHINTEGRALIZADA.TOTAL, 0) ) -
       (ISNULL(CHEQV.TOTAL,0)+ISNULL(CHEMCURSO.TOTAL, 0)+ ISNULL(CHEMCURSO_OPT.TOTAL, 0)) CH_ACURSAR
       
       

FROM   SHABILITACAOALUNO
       JOIN SHABILITACAOFILIAL (NOLOCK)
         ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
            AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
       JOIN SALUNO (NOLOCK)
         ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
            AND SALUNO.RA = SHABILITACAOALUNO.RA
       JOIN SALUNOMEC (NOLOCK)
         ON SALUNOMEC.CODCOLIGADA = SALUNO.CODCOLIGADA
            AND SALUNOMEC.RA = SALUNO.RA
       LEFT JOIN SHABILITACAOALUNOCOMPL (NOLOCK)
         ON SHABILITACAOALUNOCOMPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
            AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
            AND SHABILITACAOALUNOCOMPL.RA = SHABILITACAOALUNO.RA
       LEFT JOIN SPESSOA (NOLOCK)
         ON SALUNO.CODPESSOA = SPESSOA.CODIGO
       LEFT JOIN SINSTITUICAO (NOLOCK)
         ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
       LEFT JOIN SCURSO (NOLOCK)
         ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
            AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			
       LEFT JOIN STURNO (NOLOCK)
         ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
            AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
       JOIN SMATRICPL (NOLOCK)
         ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
              AND SMATRICPL.RA = SHABILITACAOALUNO.RA
              AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
       LEFT JOIN SGRADE (NOLOCK)
         ON ( SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
              AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
              AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
              AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE )
       LEFT JOIN SCAMPUS (NOLOCK)
         ON SHABILITACAOALUNO.CODCAMPUS = SCAMPUS.CODCAMPUS
       LEFT JOIN SMODALIDADECURSO (NOLOCK)
         ON SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA
            AND SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO
       JOIN GFILIAL (NOLOCK)
         ON SMATRICPL.CODCOLIGADA = GFILIAL.CODCOLIGADA
            AND SMATRICPL.CODFILIAL = GFILIAL.CODFILIAL
       JOIN SSTATUS (NOLOCK)
         ON SMATRICPL.CODCOLIGADA = SSTATUS.CODCOLIGADA
            AND SMATRICPL.CODSTATUS = SSTATUS.CODSTATUS
       JOIN SSTATUS STATUS_CURSO (NOLOCK)
         ON shabilitacaoaluno.CODCOLIGADA = STATUS_CURSO.CODCOLIGADA
            AND shabilitacaoaluno.CODSTATUS = STATUS_CURSO.CODSTATUS
       JOIN PPESSOA (NOLOCK)
         ON SALUNO.CODPESSOA = PPESSOA.CODIGO
       LEFT JOIN PCODINSTRUCAO PCODINSTRUCAO (NOLOCK)
         ON PCODINSTRUCAO.CODCLIENTE = PPESSOA.GRAUINSTRUCAO
       LEFT JOIN PCODNACAO (NOLOCK)
         ON PPESSOA.NACIONALIDADE = PCODNACAO.CODCLIENTE
       LEFT JOIN PCORRACA PCORRACA (NOLOCK)
         ON PCORRACA.CODCLIENTE = PPESSOA.CORRACA
       JOIN SPLETIVO (NOLOCK)
         ON SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
            AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
       LEFT JOIN STIPOINGRESSO
         ON ( STIPOINGRESSO.CODTIPOINGRESSO = SHABILITACAOALUNO.CODTIPOINGRESSO
              AND STIPOINGRESSO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA )
       
       OUTER APPLY (SELECT SUM(CH) TOTAL, 
       					   AVG(NOTA)MEDIA
                    FROM   SHISTDISCCONCLUIDAS SH
                    WHERE  SH.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                           AND SH.RA = SHABILITACAOALUNO.RA
                           AND SH.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL ) CHINTEGRALIZADA
       OUTER APPLY (SELECT SUM(CH)TOTAL, AVG(NOTA)MEDIA
                    FROM   SHISTDISCPENDENTES SH
                    WHERE  SH.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                           AND SH.RA = SHABILITACAOALUNO.RA
                           AND SH.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
                           AND SH.STATUS LIKE '%CURSANDO%') CHEMCURSO
       OUTER APPLY (SELECT MAX(CODPERIODO)ULTIMOPERIODO
                    FROM   SPERIODO(NOLOCK)
                    WHERE  SPERIODO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                           AND SPERIODO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                           AND SPERIODO.CODGRADE = SHABILITACAOFILIAL.CODGRADE
                           AND SPERIODO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO) ULTIMOPERIODO

				OUTER APPLY (SELECT SUM(CH)TOTAL, AVG(NOTA)MEDIA
                    FROM   SHISTDISCOPTELETIVAS SH
                    WHERE  SH.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                           AND SH.RA = SHABILITACAOALUNO.RA
                           AND SH.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
                           AND SH.STATUS LIKE '%CURSANDO%') CHEMCURSO_OPT
                           
                           
                    OUTER APPLY (SELECT CASE WHEN SUM(OP.CH) > 0 THEN SUM(OP.CH) ELSE SUM(SH.CH) END AS TOTAL
                    FROM   SHISTDISCEQUIVEMCURSO SH
                    LEFT JOIN SHISTDISCOPTELETIVAS OP ON SH.RA = OP.RA AND SH.CODCOLIGADA = OP.CODCOLIGADA AND SH.IDHABILITACAOFILIAL = OP.IDHABILITACAOFILIAL AND OP.STATUS LIKE '%EQUIV%'
					WHERE  SH.CODCOLIGADA =  SHABILITACAOALUNO.CODCOLIGADA
                           AND SH.RA = SHABILITACAOALUNO.RA
                           AND SH.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
                           AND SH.STATUS LIKE '%CURSANDO%') CHEQV
                    
                    OUTER APPLY (SELECT SUM(SATIVIDADEALUNO.CARGAHORARIAATV) TOTAL 
       										FROM SATIVIDADEALUNO 
       										WHERE RA = SHABILITACAOALUNO.RA AND
       										SATIVIDADEALUNO.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
       										SATIVIDADEALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA  )CHATIVIDADE
       										
       			   OUTER APPLY (SELECT SUM(VALORMINIMO) TOTAL FROM SCOMPONENTECURRICULAR
								WHERE IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL) CHCOMPONENTE


WHERE      SMATRICPL.CODCOLIGADA ='1'
       AND SPLETIVO.CODPERLET =:CODPERLET 
       AND SPLETIVO.CODTIPOCURSO = 1
	   AND SMATRICPL.CODFILIAL =:CODFILIAL 

	  
	  order by   SMATRICPL.PERIODO";10580;;;;08/11/2021;lilian.buzetti;1;1;1;1;;;;0;24437fb1-8380-4069-9084-971cac0afc46;0;;-2947;consultor1.totvs;28/09/2021;lilian.buzetti;08/11/2021;0
S;Cubo.005;Mudança número de créditos;"SELECT 
*,
ISNULL((SELECT SUM(NUMCREDITOS) FROM SDISCIPLINA 
INNER JOIN SDISCGRADE G ON G.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND G.CODDISC = SDISCIPLINA.CODDISC
WHERE G.CODGRADE = X.CODGRADE AND G.CODPERIODO = X.PERIODO AND G.CODPERIODO <> 0 ),0) +
ISNULL((SELECT SUM(SGRUPOOPTELET.MINCREDITOS) FROM SGRUPOOPTELET
WHERE CODGRADE = X.CODGRADE AND CODPERIODO = X.PERIODO),0) [Total creditos por Período] , 

  (SELECT MAX (G.CODPERIODO) FROM SDISCIPLINA 
 INNER JOIN SDISCGRADE G ON G.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND G.CODDISC = SDISCIPLINA.CODDISC
 WHERE G.CODGRADE = X.CODGRADE) [Total de períodos],
 
 
((ISNULL((SELECT SUM(NUMCREDITOS) FROM SDISCIPLINA 
INNER JOIN SDISCGRADE G ON G.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND G.CODDISC = SDISCIPLINA.CODDISC
WHERE G.CODGRADE = X.CODGRADE AND G.CODPERIODO <> 0 ),0) +
ISNULL((SELECT SUM(SGRUPOOPTELET.MINCREDITOS) FROM SGRUPOOPTELET
WHERE CODGRADE = X.CODGRADE ),0) ) /
   
 (SELECT MAX (G.CODPERIODO) FROM SDISCIPLINA 
 INNER JOIN SDISCGRADE G ON G.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND G.CODDISC = SDISCIPLINA.CODDISC
 WHERE G.CODGRADE = X.CODGRADE) )
 
 *  
 
(([Credito Academico] * 100) /
(ISNULL((SELECT SUM(NUMCREDITOS) FROM SDISCIPLINA 
INNER JOIN SDISCGRADE G ON G.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND G.CODDISC = SDISCIPLINA.CODDISC
WHERE G.CODGRADE = X.CODGRADE AND G.CODPERIODO = X.PERIODO AND G.CODPERIODO <> 0 ),0) +
ISNULL((SELECT SUM(SGRUPOOPTELET.MINCREDITOS) FROM SGRUPOOPTELET
WHERE CODGRADE = X.CODGRADE AND CODPERIODO = X.PERIODO),0))/100)  [Novo crédito disciplina]


FROM(
SELECT 
SGRADE.CODGRADE,
SCURSO.CODCURSO,
SPERIODO.CODPERIODO PERIODO,
SCURSO.NOME [Curso],
SGRADE.DESCRICAO , 
SPERIODO.CODPERIODO,
SGRADE.DESCRICAO [Matriz],
SDISCIPLINA.CODDISC [Cod. disc] ,
SDISCIPLINA.NOME [Disciplina],
SDISCGRADE.NUMCREDITOSCOB [Credito Cobrança Atual],
SDISCIPLINA.NUMCREDITOS [Credito Academico],
SDISCIPLINA.CH CHANTIGA,
SDISCIPLINA.CH CHNOVA

  
FROM  SCURSO 

INNER JOIN SHABILITACAO ON 
SHABILITACAO.CODCOLIGADA = SCURSO.CODCOLIGADA AND 
SHABILITACAO.CODCURSO = SCURSO.CODCURSO

INNER JOIN SPERIODO ON 
SPERIODO.CODCOLIGADA = SHABILITACAO.CODCOLIGADA AND 
SPERIODO.CODCURSO = SHABILITACAO.CODCURSO 

INNER JOIN SGRADE ON 
SPERIODO.CODCOLIGADA = SGRADE.CODCOLIGADA AND 
SPERIODO.CODGRADE = SGRADE.CODGRADE AND 
SPERIODO.CODCURSO = SGRADE.CODCURSO AND 
SPERIODO.CODHABILITACAO = SGRADE.CODHABILITACAO


INNER JOIN SDISCGRADE ON 
SDISCGRADE.CODCOLIGADA = SPERIODO.CODCOLIGADA AND 
SDISCGRADE.CODCURSO = SPERIODO.CODCURSO AND 
SDISCGRADE.CODHABILITACAO = SPERIODO.CODHABILITACAO AND 
SDISCGRADE.CODGRADE = SPERIODO.CODGRADE  AND 
SDISCGRADE.CODPERIODO = SPERIODO.CODPERIODO


INNER JOIN SDISCIPLINA ON 
SDISCIPLINA.CODCOLIGADA = SDISCGRADE.CODCOLIGADA AND 
SDISCIPLINA.CODDISC = SDISCGRADE.CODDISC

WHERE SCURSO.CODCURSO LIKE '%' + :CURSO + '%'
AND SGRADE.DESCRICAO LIKE '%' + :MATRIZ + '%'
AND SPERIODO.CODPERIODO <> 0


UNION ALL

SELECT 
SGRADE.CODGRADE,
SCURSO.CODCURSO,
SGRUPOOPTELET.CODPERIODO PERIODO,
SCURSO.NOME [Curso],
SGRADE.DESCRICAO , 
SGRUPOOPTELET.CODPERIODO,
SGRADE.DESCRICAO [Matriz],
'' [Cod. disc] ,
SGRUPOOPTELET.NOME [Disciplina],
SGRUPOOPTELET.MINCREDITOS [Credito Cobrança Atual],
SGRUPOOPTELET.MINCREDITOS [Credito Academico],
SGRUPOOPTELET.MINCREDITOS * 18 CHANTIGA, 
SGRUPOOPTELET.MINCREDITOS * 20 CHNOVA 

FROM SGRUPOOPTELET 

INNER JOIN SCURSO ON 
SGRUPOOPTELET.CODCOLIGADA = SCURSO.CODCOLIGADA AND 
SGRUPOOPTELET.CODCURSO = SCURSO.CODCURSO


INNER JOIN SHABILITACAO ON 
SHABILITACAO.CODCOLIGADA = SCURSO.CODCOLIGADA AND 
SHABILITACAO.CODCURSO = SCURSO.CODCURSO 

INNER JOIN SGRADE ON 
SGRUPOOPTELET.CODCOLIGADA = SGRADE.CODCOLIGADA AND 
SGRUPOOPTELET.CODGRADE = SGRADE.CODGRADE AND 
SGRUPOOPTELET.CODCURSO = SGRADE.CODCURSO AND 
SGRUPOOPTELET.CODHABILITACAO = SGRADE.CODHABILITACAO


WHERE SCURSO.CODCURSO LIKE '%' + :CURSO + '%'
AND SGRADE.DESCRICAO LIKE '%' + :MATRIZ + '%'
AND SGRUPOOPTELET.CODPERIODO <> 0



) X

ORDER BY X.PERIODO





";4098;;;;08/09/2021;lilian.buzetti;1;1;1;1;;;;0;f59e6e17-c4e1-4b3d-9870-a514f66c340b;0;;-1504;mestre;22/03/2021;lilian.buzetti;08/09/2021;0
S;Cubo.006;Conferencia Bolsa (Rematrícula);"SELECT 
1 TOTAL,SCONCESSAOBOLSA.RA, PPESSOA.NOME, SMATRICPL.CODFILIAL, SPLETIVO.CODPERLET , SBOLSA.NOME, 
SCONCESSAOBOLSA.DESCONTO, SCONCESSAOBOLSA.TIPODESC 'TIPO DESCONTO', SPLETIVO.CODTIPOCURSO NÍVEL

 FROM SCONCESSAOBOLSA

LEFT JOIN SBOLSAALUNO ON 
SCONCESSAOBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
SCONCESSAOBOLSA.RA = SBOLSAALUNO.RA AND 
SCONCESSAOBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA

INNER JOIN SBOLSA ON 
SBOLSA.CODCOLIGADA = SCONCESSAOBOLSA.CODCOLIGADA AND 
SBOLSA.CODBOLSA = SCONCESSAOBOLSA.CODBOLSA

INNER JOIN SALUNO ON 
SALUNO.CODCOLIGADA = SCONCESSAOBOLSA.CODCOLIGADA AND 
SALUNO.RA = SCONCESSAOBOLSA.RA

INNER JOIN PPESSOA ON 
PPESSOA.CODIGO = SALUNO.CODPESSOA

INNER JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA AND 
SMATRICPL.RA = SALUNO.RA

INNER JOIN SPLETIVO ON 
SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SPLETIVO.IDPERLET = SMATRICPL.IDPERLET

WHERE SBOLSAALUNO.RA IS NULL
AND   SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
						 /*IN ('2021/2' , '2021/3M')*/

GROUP BY SCONCESSAOBOLSA.RA, PPESSOA.NOME, SMATRICPL.CODFILIAL,SPLETIVO.CODPERLET , SBOLSA.NOME, SCONCESSAOBOLSA.DESCONTO, SCONCESSAOBOLSA.TIPODESC, SPLETIVO.CODTIPOCURSO

ORDER BY SMATRICPL.CODFILIAL,SCONCESSAOBOLSA.RA, PPESSOA.NOME";1288;;;;20/05/2022;robson.canto;1;1;1;1;;;;0;8eb60df3-8b83-4691-a5d0-290f6e522ff2;0;;-22843;mestre;20/06/2021;robson.canto;20/05/2022;0
S;Cubo.007;Horário por Período Letivo;"SELECT
	f.nome NomFiial,
	c.CODCURSO,
	c.NOME NomCurso,
	STURMADISC.CODTURMA,
	t.NOME NomTurma,
	case isnull(SHORARIO.DIASEMANA, 0)
		when 0 then '_Não Informado'
		when 1 then 'Domingo'
		when 2 then 'Segunda'
		when 3 then 'Terça'
		when 4 then 'Quarta'
		when 5 then 'Quinta'
		when 6 then 'Sexta'
		when 7 then 'Sábado'
	end DIASEMANA,
	isnull(SHORARIO.HORAINICIAL,'00:00') HORA,
	1 AS NomDisciplina/*SDISCIPLINA.NOME NomDisciplina*/
FROM 
	STURMADISC
	inner join STURMA (nolock) t on t.CODCOLIGADA = STURMADISC.CODCOLIGADA and t.CODFILIAL = STURMADISC.CODFILIAL and t.CODTURMA = STURMADISC.CODTURMA and t.IDPERLET = STURMADISC.IDPERLET
	inner join SHABILITACAOFILIAL (nolock) hf on hf.CODCOLIGADA = t.CODCOLIGADA and hf.IDHABILITACAOFILIAL = t.IDHABILITACAOFILIAL
	inner join GFILIAL (nolock) f on f.CODCOLIGADA=hf.CODCOLIGADA and f.CODFILIAL = hf.CODFILIAL
	inner join SCURSO (nolock) c on c.CODCOLIGADA=hf.CODCOLIGADA and c.CODCURSO=hf.CODCURSO
	INNER JOIN SPLETIVO (nolock) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET 
	INNER JOIN SDISCIPLINA (nolock) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	LEFT JOIN SHORARIOTURMA (nolock) ON STURMADISC.CODCOLIGADA =  SHORARIOTURMA.CODCOLIGADA AND STURMADISC.IDTURMADISC =  SHORARIOTURMA.IDTURMADISC 
	LEFT JOIN SHORARIO (nolock) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR
WHERE 
	CODPERLET IN (:CODPERLET)
	";1462;;;;20/06/2021;mestre;1;1;1;1;;;;0;5d4aeb49-6a34-4d49-a534-0005996834e7;0;;-20014;mestre;20/06/2021;mestre;20/06/2021;0
S;Cubo.008;Inscrições;"SELECT 
U.NOME Candidato , 
U.EMAIL [E-mail] , 
U.TELEFONE1 Telefone , 
U.CPF ,  
U.DTNASCIMENTO [Data nascimento], 
PS.NOME [Processo Seletivo],  
INS.CODETDMUNICIPIO Local,
CASE WHEN INS.STATUS = 1 THEN 'Candidato (inscrição confirmada)' ELSE 'Inscrito (pendente de confirmação do pagamento)' END AS [Status Inscricao],
ARE.NOME Curso ,
ST.DESCRICAO Status, 
INS.DATAINSCRICAO [Data Inscricao]


FROM SPSINSCRICAOAREAOFERTADA INS
INNER JOIN SPSPROCESSOSELETIVO PS ON INS.CODCOLIGADA = PS.CODCOLIGADA AND INS.IDPS = PS.IDPS
INNER JOIN SPSUSUARIO U ON INS.CODUSUARIOPS = U.CODUSUARIOPS
LEFT JOIN SPSOPCAOINSCRITO OP ON OP.CODCOLIGADA = INS.CODCOLIGADA AND OP.IDPS = INS.IDPS AND OP.NUMEROINSCRICAO = INS.NUMEROINSCRICAO
LEFT JOIN SPSAREAINTERESSE ARE ON OP.IDAREAINTERESSE = ARE.IDAREAINTERESSE
INNER jOIN SPSSTATUSOPCAO ST ON  ST.CODIGO = OP.STATUS AND ST.CODCOLIGADA = OP.CODCOLIGADA AND ST.CODFILIAL = PS.CODFILIAL


";942;;;;21/06/2021;mestre;1;1;1;1;;;;0;bb095972-70c3-4aee-ba25-20416198cd03;0;;8571;mestre;21/06/2021;mestre;21/06/2021;0
S;Cubo.009;Calculo das parcelas dos alunos;"SELECT 

SCONTRATO.RA,
PPESSOA.NOME,
DTVENCIMENTO ,
SHABILITACAO.NOME MATRIZ,
SMATRICPL.PERIODO,


CASE 

WHEN SPARCELA.VALOR = 0 AND isnull(SUM(SBOLSAALUNO.DESCONTO),0) <> 100 THEN 
(
((SELECT VALCRED FROM SFAIXACRED
WHERE IDPERLET = SCONTRATO.IDPERLET
AND   IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL)
*
(SELECT SUM(SMATRICULA.NUMCREDITOSCOB) FROM SMATRICULA
WHERE RA= SCONTRATO.RA 
AND   IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
AND   IDPERLET = SCONTRATO.IDPERLET ))

-
((SELECT VALCRED FROM SFAIXACRED
WHERE IDPERLET = SCONTRATO.IDPERLET
AND   IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL)
*
(SELECT SUM(SMATRICULA.NUMCREDITOSCOB) FROM SMATRICULA
WHERE RA= SCONTRATO.RA 
AND   IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
AND   IDPERLET = SCONTRATO.IDPERLET )
*
SUM(SPARCELA.DESCONTO)/100)
- 
(CASE WHEN SPARCELA.PARCELA >= MAX(SBOLSAALUNO.PARCELAINICIAL) AND
          SPARCELA.PARCELA <= MAX(SBOLSAALUNO.PARCELAFINAL)    AND 
          ISNULL(SBOLSAALUNO.TIPODESC,'') = 'P'
      THEN 
	((SELECT VALCRED FROM SFAIXACRED
	WHERE IDPERLET = SCONTRATO.IDPERLET
	AND   IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL)
	*
	(SELECT SUM(SMATRICULA.NUMCREDITOSCOB) FROM SMATRICULA
	WHERE RA= SCONTRATO.RA 
	AND   IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND   IDPERLET = SCONTRATO.IDPERLET ))
	* isnull((SUM(SBOLSAALUNO.DESCONTO)/100),0) ELSE ISNULL(SUM(SBOLSAALUNO.DESCONTO),0) END ))
/ CASE WHEN SCONTRATO.CODFILIAL = 4 THEN 3 ELSE 6 END


WHEN  SPARCELA.VALOR > 0 AND isnull(SUM(SBOLSAALUNO.DESCONTO),0) <> 100 THEN 
(SPARCELA.VALOR - 
SUM(SPARCELA.DESCONTO))
-
((CASE WHEN ISNULL(SBOLSAALUNO.TIPODESC,'') = 'P' THEN SPARCELA.VALOR * isnull((SUM(SBOLSAALUNO.DESCONTO)/100),0) ELSE ISNULL(SUM(SBOLSAALUNO.DESCONTO),0) END  )) 

ELSE 0 END VALORLIQUIDO  , 

ISNULL(SUM(SBOLSAALUNO.DESCONTO),0)+ SUM(SPARCELA.DESCONTO) DESCONTO , ISNULL((SBOLSAALUNO.TIPODESC),'') TIPODESC, 

CASE WHEN SPARCELA.VALOR = 0 
THEN 
   (SELECT VALCRED FROM SFAIXACRED
	WHERE IDPERLET = SCONTRATO.IDPERLET
	AND   IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL)
	*
	(SELECT SUM(SMATRICULA.NUMCREDITOSCOB) FROM SMATRICULA
	WHERE RA= SCONTRATO.RA 
	AND   IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	AND   IDPERLET = SCONTRATO.IDPERLET ) / CASE WHEN SCONTRATO.CODFILIAL = 4 THEN 3 ELSE 6 END 
ELSE 
	SPARCELA.VALOR END AS VALORORIGINAL , SMATRICPL.CODTIPOMAT


FROM SCONTRATO


INNER JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SMATRICPL.RA = SCONTRATO.RA  AND 
SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
SMATRICPL.idperlet  = SCONTRATO.idperlet


INNER JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET

INNER JOIN SPLETIVO ON 
SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPLETIVO.IDPERLET = SCONTRATO.IDPERLET

INNER JOIN SALUNO ON 
SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SALUNO.RA = SCONTRATO.RA

INNER JOIN PPESSOA ON 
PPESSOA.CODIGO = SALUNO.CODPESSOA 

LEFT JOIN SBOLSAALUNO ON 
SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SBOLSAALUNO.RA = SCONTRATO.RA AND 
SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET AND 
SBOLSAALUNO.CODSERVICO = SPARCELA.CODSERVICO 

LEFT JOIN SHABILITACAOFILIAL ON 
SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

LEFT JOIN SHABILITACAO ON 
SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO


WHERE CODPERLET =:PERIODOLETIVO
AND   SCONTRATO.CODFILIAL =:FILIAL

GROUP BY 
SCONTRATO.RA,
PPESSOA.NOME,
DTVENCIMENTO,
SHABILITACAO.NOME,
SBOLSAALUNO.TIPODESC,
SCONTRATO.IDPERLET,
SCONTRATO.IDHABILITACAOFILIAL,
SPARCELA.VALOR,
SCONTRATO.CODFILIAL,
SPARCELA.PARCELA, 
SMATRICPL.CODTIPOMAT,
SMATRICPL.PERIODO

";4182;;;;22/06/2021;mestre;1;1;1;1;;;;0;f64041a7-f0d5-47df-b7bb-4c0da0290008;0;;-5682;mestre;21/06/2021;mestre;22/06/2021;0
S;Cubo.010;Total Creditos por GradePeríodo;"Select 
	hfpl.NomFilial, hfpl.NomCurso, hfpl.NomTipoCurso, hfpl.NomTurno, hfpl.CODGRADE, hfpl.CODPERLET,
	CODPERIODO, TOT_NUMCREDITOSCOB 
from 
	v_Unasp_NUMCREDITOSCOB_TotalPorPeriodo cob
	inner join v_Unasp_SHABILITACAOFILIALPL hfpl on hfpl.CODCURSO=cob.CODCURSO and hfpl.CODGRADE=cob.CODGRADE
WHERE  
	cob.CODPERIODO>0
	and CODPERLET=:CODPERLET
order by 
	hfpl.NomFilial, hfpl.NomCurso, hfpl.NomTipoCurso, hfpl.NomTurno, hfpl.CODGRADE, hfpl.CODPERLET, cob.CODPERIODO
";480;;;;22/06/2021;mestre;1;1;1;1;;;;0;966d05c8-e575-4117-89d4-7d97c21776ad;0;;-4578;mestre;22/06/2021;mestre;22/06/2021;0
S;Cubo.011;Grade de horário por Turma;SELECT * from Z_UNASP_GRADEHORARIO;34;;;;24/06/2021;mestre;1;1;1;1;;;;0;8801ae88-0ec5-482b-91c6-d5893f7e90f1;0;;-18167;mestre;24/06/2021;mestre;24/06/2021;0
S;Cubo.012;Total de Disciplinas por Horário;"SELECT
	GFILIAL.NOMEFANTASIA AS FILIAL
	,SCURSO.CODCURSO
	,SCURSO.NOME AS NOME_CURSO
	,SDISCIPLINA.NOME AS DISCIPLINA
	,STURMADISC.CODTURMA AS COD_TURMA
	,STURMADISC.NOME AS TURMA
	,1 Registro
	,CASE
		WHEN SHORARIO.DIASEMANA = 2 THEN 'Segunda'
		WHEN SHORARIO.DIASEMANA = 3 THEN 'Terça'
		WHEN SHORARIO.DIASEMANA = 4 THEN 'Quarta'
		WHEN SHORARIO.DIASEMANA = 5 THEN 'Quinta'
		WHEN SHORARIO.DIASEMANA = 6 THEN 'Sexta'
		WHEN SHORARIO.DIASEMANA = 7 THEN 'Sábado'
		WHEN SHORARIO.DIASEMANA = 1 THEN 'Domingo'
	END DIASEMANA
	,SHORARIO.HORAINICIAL AS HORA_INICIAL
	,SPLETIVO.CODPERLET
	,STIPOCURSO.NOME AS NIVEL_ENSINO
FROM STURMADISC (NOLOCK)
	JOIN STIPOCURSO (NOLOCK)
		ON STIPOCURSO.CODCOLIGADA = STURMADISC.CODCOLIGADA 
		AND STIPOCURSO.CODTIPOCURSO = STURMADISC.CODTIPOCURSO
	JOIN STURMA (NOLOCK) 
		on STURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA 
		and STURMA.CODFILIAL = STURMADISC.CODFILIAL 
		and STURMA.CODTURMA = STURMADISC.CODTURMA 
		and STURMA.IDPERLET = STURMADISC.IDPERLET
	JOIN SHABILITACAOFILIAL (NOLOCK)  
		on SHABILITACAOFILIAL.CODCOLIGADA = STURMA.CODCOLIGADA 
		and SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMA.IDHABILITACAOFILIAL
	JOIN GFILIAL (NOLOCK)  
		on GFILIAL.CODCOLIGADA= SHABILITACAOFILIAL.CODCOLIGADA 
		and GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
	JOIN SCURSO (NOLOCK)  
		on SCURSO.CODCOLIGADA= SHABILITACAOFILIAL.CODCOLIGADA 
		and SCURSO.CODCURSO= SHABILITACAOFILIAL.CODCURSO
	JOIN SPLETIVO (NOLOCK) 
		ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET 
		AND STURMADISC.CODFILIAL = SPLETIVO.CODFILIAL 
		AND STURMADISC.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
	JOIN SDISCIPLINA (NOLOCK) 
		ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA 
		AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	LEFT JOIN SHORARIOTURMA (NOLOCK) 
		ON SHORARIOTURMA.CODCOLIGADA =  STURMADISC.CODCOLIGADA 
		AND SHORARIOTURMA.IDTURMADISC =  STURMADISC.IDTURMADISC 
	LEFT JOIN SHORARIO (NOLOCK) 
		ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA 
		AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR
WHERE 
	SPLETIVO.CODPERLET IN ('2021/2')
ORDER BY 
	SCURSO.CODCURSO ";2133;;;;24/06/2021;mestre;1;1;1;1;;;;0;1729e4f8-d206-4795-8b29-b1aa2b86b8a6;0;;-2944;mestre;24/06/2021;mestre;24/06/2021;0
S;Cubo.013;Matriculas ingressantes e veteranos por periodo;"/*Graduação*/

SELECT DISTINCT
	G.NOMEFANTASIA CAMPUS,
	SC.NOME [TIPO CURSO],
	C.NOME CURSO,
	S.DESCRICAO STATUS,
	P.CODPERLET PERIODO,
	SUM(CASE WHEN M.CODTIPOMAT = 1 THEN 1 else 0 end) INGRESSANTES,
	SUM(CASE WHEN M.CODTIPOMAT = 2 THEN 1 else 0 end) VETERENOS,
	SUM(CASE WHEN M.CODTIPOMAT = 7 THEN 1 ELSE 0 END) DIAP
FROM 
	SMATRICPL						(NOLOCK)	M
	INNER JOIN SHABILITACAOFILIAL	(NOLOCK)	HF	ON HF.IDHABILITACAOFILIAL=M.IDHABILITACAOFILIAL AND HF.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN SHABILITACAO			(NOLOCK)	H	ON H.CODHABILITACAO=HF.CODHABILITACAO AND H.CODCOLIGADA=HF.CODCOLIGADA AND H.CODCURSO=HF.CODCURSO
	INNER JOIN SCURSO				(NOLOCK)	C	ON C.CODCURSO=H.CODCURSO AND C.CODCOLIGADA=H.CODCOLIGADA
	INNER JOIN SPLETIVO				(NOLOCK)	P	ON P.IDPERLET=M.IDPERLET AND P.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN SALUNO				(NOLOCK)	A	ON A.RA=M.RA AND A.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN PPESSOA				(NOLOCK)	PP	ON PP.CODIGO=A.CODPESSOA
	INNER JOIN SSTATUS				(NOLOCK)	S	ON S.CODSTATUS=M.CODSTATUS AND S.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN STIPOCURSO			(NOLOCK)	SC	ON SC.CODTIPOCURSO=C.CODTIPOCURSO AND SC.CODCOLIGADA=C.CODCOLIGADA
	LEFT JOIN STIPOMATRICULA		(NOLOCK)	TM	ON TM.CODTIPOMAT=M.CODTIPOMAT AND TM.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN GFILIAL				(NOLOCK)	G	ON G.CODCOLIGADA=HF.CODCOLIGADA AND G.CODFILIAL=HF.CODFILIAL
WHERE
	C.CODTIPOCURSO = 1
    AND P.CODPERLET = :PERIODO_LETIVO
GROUP BY
	G.NOMEFANTASIA,
	SC.NOME,
	C.NOME,
	M.CODSTATUS,
	S.DESCRICAO,
	P.CODPERLET

	UNION

/*Pós-Graduação*/

SELECT DISTINCT
	G.NOMEFANTASIA CAMPUS,
	SC.NOME [TIPO CURSO],
	C.NOME CURSO,
	S.DESCRICAO STATUS,
	P.CODPERLET PERIODO,
	SUM(CASE WHEN M.CODTIPOMAT = 4 THEN 1 else 0 end) INGRESSANTES,
	SUM(CASE WHEN M.CODTIPOMAT = 5 THEN 1 else 0 end) VETERENOS,
	NULL DIAP
FROM 
	SMATRICPL						(NOLOCK)	M
	INNER JOIN SHABILITACAOFILIAL	(NOLOCK)	HF	ON HF.IDHABILITACAOFILIAL=M.IDHABILITACAOFILIAL AND HF.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN SHABILITACAO			(NOLOCK)	H	ON H.CODHABILITACAO=HF.CODHABILITACAO AND H.CODCOLIGADA=HF.CODCOLIGADA AND H.CODCURSO=HF.CODCURSO
	INNER JOIN SCURSO				(NOLOCK)	C	ON C.CODCURSO=H.CODCURSO AND C.CODCOLIGADA=H.CODCOLIGADA
	INNER JOIN SPLETIVO				(NOLOCK)	P	ON P.IDPERLET=M.IDPERLET AND P.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN SALUNO				(NOLOCK)	A	ON A.RA=M.RA AND A.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN PPESSOA				(NOLOCK)	PP	ON PP.CODIGO=A.CODPESSOA
	INNER JOIN SSTATUS				(NOLOCK)	S	ON S.CODSTATUS=M.CODSTATUS AND S.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN STIPOCURSO			(NOLOCK)	SC	ON SC.CODTIPOCURSO=C.CODTIPOCURSO AND SC.CODCOLIGADA=C.CODCOLIGADA
	LEFT JOIN STIPOMATRICULA		(NOLOCK)	TM	ON TM.CODTIPOMAT=M.CODTIPOMAT AND TM.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN GFILIAL				(NOLOCK)	G	ON G.CODCOLIGADA=HF.CODCOLIGADA AND G.CODFILIAL=HF.CODFILIAL
WHERE
	C.CODTIPOCURSO = 2
	AND P.CODPERLET = :PERIODO_LETIVO

GROUP BY
	G.NOMEFANTASIA,
	SC.NOME,
	C.NOME,
	M.CODSTATUS,
	S.DESCRICAO,
	P.CODPERLET

";2920;;;;25/01/2022;consultor1.totvs;1;1;1;1;;;;0;1729e4f8-d206-4795-8b29-b1aa2b86b8a6;0;;-13003;maycon;03/08/2021;consultor1.totvs;25/01/2022;0
S;Cubo.014;Alunos com saldo em Conta Corrente (Pendente);" 
SELECT 
SCONTACORRENTE.CODCOLIGADA,
SCONTACORRENTE.RA,
SCONTACORRENTE.IDCONTACORRENTE,
SCONTACORRENTE.TIPO TIPO1,
PPESSOA.NOME , 

CASE WHEN SCONTACORRENTE.NATUREZA = 'D' THEN SCONTACORRENTE.VALOR * -1
	 ELSE SCONTACORRENTE.VALOR END VALOR, 

CASE WHEN SCONTACORRENTE.NATUREZA = 'C' THEN 'Credito com Unasp' ELSE 'Debito com Unasp' END AS TIPO,

FLANRATCCU.CODCCUSTO CCUSTO,
TTBORCAMENTO.DESCRICAO AS NATUREZA,
GFILIAL.NOMEFANTASIA AS FILIAL,
GCCUSTO.NOME NOMECCUSTO





FROM SCONTACORRENTE
INNER JOIN FLAN ON SCONTACORRENTE.CODCOLIGADA = FLAN.CODCOLIGADA AND SCONTACORRENTE.IDLAN = FLAN.IDLAN
INNER JOIN FLANRATCCU ON FLANRATCCU.IDLAN = FLAN.IDLAN AND FLANRATCCU.CODCOLIGADA = FLAN.CODCOLIGADA
INNER JOIN GCCUSTO ON GCCUSTO.CODCOLIGADA = FLANRATCCU.CODCOLIGADA AND GCCUSTO.CODCCUSTO = FLANRATCCU.CODCCUSTO
INNER JOIN TTBORCAMENTO ON FLANRATCCU.CODCOLIGADA = TTBORCAMENTO.CODCOLIGADA AND FLANRATCCU.CODNATFINANCEIRA = TTBORCAMENTO.CODTBORCAMENTO
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTACORRENTE.CODCOLIGADA AND SALUNO.RA = SCONTACORRENTE.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN GFILIAL ON FLAN.CODFILIAL = GFILIAL.CODFILIAL
WHERE SCONTACORRENTE.VALOR <> 0
AND SCONTACORRENTE.TIPO IN (1, 2)";1261;;;;22/02/2022;robson.canto;1;1;1;1;;;;0;f392590a-9796-4cb6-8a4b-54d1215d0621;0;;23845;mestre;30/08/2021;robson.canto;22/02/2022;0
S;Cubo.015;Analise Financeira;"SELECT DISTINCT

SPARCELA.CODCOLIGADA,
SPARCELA.IDPERLET,
SPARCELA.PARCELA , 
SPARCELA.DTVENCIMENTO,
CAST(MONTH(SPARCELA.DTVENCIMENTO) AS VARCHAR(2)) + '/' + CAST(YEAR(SPARCELA.DTVENCIMENTO) AS VARCHAR(4)) 'MES/ANO',
SCONTRATO.CODCONTRATO,
FLAN.IDLAN REF,
SCURSO.NOME CURSO,
SMATRICPL.CODTURMA TURMA,
SSERVICO.NOME SERVICO , 
CASE WHEN B.NOME IS NULL THEN  ISNULL(SBOLSA.NOME,'') ELSE B.NOME END BOLSA, 

CASE WHEN FLAN.VALORORIGINAL IS NULL  AND SCONTRATO.STATUS = 'N' THEN ISNULL(SPARCELA.VALOR,0) ELSE ISNULL(FLAN.VALORORIGINAL,0) END AS VALORBRUTO ,

CASE WHEN FLAN.VALORDESCONTO IS NULL THEN ISNULL(SPARCELA.DESCONTO,0) ELSE FLAN.VALORDESCONTO END AS DESCFINANCEIRO ,



CASE WHEN FLAN.IDLAN IS NULL 
THEN SPARCELA.VALOR * (SBOLSAALUNO.DESCONTO / 100)
ELSE ISNULL(SBOLSALAN.VALOR,0) END  VALORBOLSA,


/*
ISNULL((CASE WHEN FLAN.VALORORIGINAL IS NULL THEN ISNULL(SPARCELA.VALOR,0) ELSE ISNULL(FLAN.VALORORIGINAL,0) END  -
CASE WHEN FLAN.VALORDESCONTO IS NULL THEN ISNULL(SPARCELA.DESCONTO,0) ELSE ISNULL(FLAN.VALORDESCONTO,0) END -
CASE WHEN FLAN.IDLAN IS NULL 
THEN ISNULL(SPARCELA.VALOR,0) * (ISNULL(SBOLSAALUNO.DESCONTO,0) / 100)
ELSE ISNULL(SBOLSALAN.VALOR,0) END ),0) VALORLIQ,
*/

CASE WHEN FLAN.VALORORIGINAL IS NULL  AND SCONTRATO.STATUS = 'N' THEN ISNULL(SPARCELA.VALOR,0) 
	 ELSE ISNULL(FLAN.VALORORIGINAL,0) END - ISNULL((SELECT
	 										   		  SUM(SBLAN.VALOR)
	 										   
	 										  		 FROM
	 										   		  SBOLSALAN SBLAN (NOLOCK)
	 										  
	 										  		 WHERE	SBLAN.CODCOLIGADA = SBOLSALAN.CODCOLIGADA
	 										  			AND SBLAN.IDPERLET = SBOLSALAN.IDPERLET
	 										  		AND SBLAN.IDPARCELA = SBOLSALAN.IDPARCELA),0) 
	 										- CASE WHEN FLAN.VALORDESCONTO IS NULL THEN ISNULL(SPARCELA.DESCONTO,0) ELSE FLAN.VALORDESCONTO END VALORLIQ,

GFILIAL.NOMEFANTASIA FILIAL,

SPARCELA.RA,
PPESSOA.NOME,
SSTATUS.DESCRICAO STATUS,
FLAN.IDLAN

FROM SPARCELA 				(NOLOCK)
LEFT JOIN SLAN 				(NOLOCK) 	ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
LEFT JOIN FLAN 				(NOLOCK)	ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
INNER JOIN SCONTRATO		(NOLOCK) 	ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
INNER JOIN SMATRICPL		(NOLOCK) 	ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SCONTRATO.RA
INNER JOIN SHABILITACAOFILIAL (NOLOCK)  ON SCONTRATO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SCONTRATO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAO 	(NOLOCK) 	ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND SHABILITACAO.codcurso = SHABILITACAOFILIAL.codcurso
INNER JOIN SCURSO 			(NOLOCK) 	ON SCURSO.CODCOLIGADA = SHABILITACAO.CODCOLIGADA AND SCURSO.CODCURSO = SHABILITACAO.CODCURSO 
LEFT JOIN SBOLSALAN 		(NOLOCK) 	ON SBOLSALAN.CODCOLIGADA = SLAN.CODCOLIGADA AND SBOLSALAN.IDLAN = SLAN.IDLAN
LEFT JOIN SBOLSA 			(NOLOCK) 	ON SBOLSALAN.CODCOLIGADA = SLAN.CODCOLIGADA AND SBOLSALAN.CODBOLSA = SBOLSA.CODBOLSA
INNER JOIN SPLETIVO 		(NOLOCK) 	ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
LEFT JOIN GFILIAL 			(NOLOCK) 	ON GFILIAL.CODFILIAL = SMATRICPL.CODFILIAL AND GFILIAL.codcoligada = SMATRICPL.codcoligada
INNER JOIN SSERVICO 		(NOLOCK) 	ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
INNER JOIN SALUNO 			(NOLOCK) 	ON SCONTRATO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SCONTRATO.RA = SALUNO.RA
INNER JOIN PPESSOA 			(NOLOCK) 	ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SSTATUS 			(NOLOCK)	ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS        
LEFT JOIN SBOLSAALUNO       (NOLOCK)    ON SBOLSAALUNO.CODSERVICO = SPARCELA.CODSERVICO AND SBOLSAALUNO.RA = SCONTRATO.RA AND SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND
			               ( 
			               (SBOLSAALUNO.PARCELAINICIAL >= SPARCELA.PARCELA  AND
			                SBOLSAALUNO.PARCELAFINAL <= SPARCELA.PARCELA) OR
			                (SBOLSAALUNO.DTINICIO >= SPARCELA.DTVENCIMENTO AND 
			                SBOLSAALUNO.DTFIM <= SPARCELA.DTVENCIMENTO)
			               )
LEFT JOIN SBOLSA   B        (NOLOCK) 	ON SBOLSAALUNO.CODCOLIGADA = B.CODCOLIGADA AND SBOLSAALUNO.CODBOLSA = B.CODBOLSA	


WHERE CODPERLET LIKE :ANO + '%' AND 
SCURSO.NOME LIKE '%' + :NOMEDOCURSO + '%'
AND SCONTRATO.TIPOCONTRATO <> 'A'";4763;;;;11/11/2021;robson.canto;1;1;1;1;;;;0;bca8484e-f4e1-4fcc-8a9a-6a28a9025e43;0;;28026;lilian.buzetti;28/10/2021;robson.canto;11/11/2021;0
S;Cubo.016;Analise Documentos Alunos;"
SELECT
	GFILIAL.NOMEFANTASIA AS 'Filial',
	PPESSOA.NOME 																				 AS 'Aluno',
	SDOCUMENTO.DESCRICAO 																		 AS 'Documento',
	SALUNO.RA 																					 AS 'RA',
	SCURSO.NOME 																		 AS 'Curso',
	SSTATUS.DESCRICAO																	 AS 'Status Curso',
	CASE 
		WHEN SDOCALUNO.STATUS = 0 THEN 'Pendente envio'
		WHEN SDOCALUNO.STATUS = 1 THEN 'Em analise'
		WHEN SDOCALUNO.STATUS = 2 THEN 'Pendente envio (Recusado)'		
		WHEN SDOCALUNO.STATUS = 3 THEN 'Documentos entregues'
	END AS 'Status envio',
	SPLETIVO.CODPERLET AS 'Periodo Letivo Documento'
	
FROM SALUNO (NOLOCK)
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
 INNER JOIN SDOCALUNO (NOLOCK) ON SDOCALUNO.CODCOLIGADA = SALUNO.CODCOLCFO
	AND SDOCALUNO.RA = SALUNO.RA
INNER JOIN SDOCUMENTO (NOLOCK) on SDOCUMENTO.CODDOCUMENTO = SDOCALUNO.CODDOCUMENTO
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SDOCALUNO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SDOCALUNO.IDPERLET
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
LEFT JOIN SMOTIVOREJEICAODOCUMENTO(NOLOCK)
	ON SMOTIVOREJEICAODOCUMENTO.CODCOLIGADA = SDOCALUNO.CODCOLIGADA
	AND SMOTIVOREJEICAODOCUMENTO.IDMOTIVOREJEICAODOCUMENTO = SDOCALUNO.IDMOTIVOREJEICAODOCUMENTO	
	
LEFT JOIN SARQUIVOS (NOLOCK) ON
	SARQUIVOS.CHAVERM =  CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)
WHERE SPLETIVO.CODPERLET = :CODPERLETDOC_S";2201;;;;14/03/2022;consultor1.totvs;1;1;1;1;;;;0;b1dbf5ae-98f9-4d24-b6fe-1e7d56d43505;0;;-15372;consultor1.totvs;14/03/2022;consultor1.totvs;14/03/2022;0
S;Cubo.017;Alunos Reprovados por disciplinas;"/*
Mostra as disciplinas que o aluno está reprovado
*/
SELECT DISTINCT nome          AS 'Nome',
                Nomstatus     AS 'Status',
                NomDisciplina AS 'Disciplinas',
                nomfilial     AS 'Filial',
                nomtipocurso  AS 'Nível',
                nomcurso      AS 'Curso',
                CODPERLET     AS 'Periodo Letivo',
                CODTURMA      AS 'Turma',
                RA,
                1 AS total 
FROM   v_Unasp_SMATRICULA
WHERE  Nomstatus = 'Reprovado por Falta'
        OR NomStatus = 'Reprovado por Nota'
GROUP  BY RA,
          nome,
          Nomstatus,
          NomDisciplina,
          nomturma,
          coddisc,
          nomfilial,
          nomtipocurso,
          nomcurso,
          codturma,
          CODPERLET 
";814;;;;27/05/2022;maik.souza;1;1;1;1;;;;0;24bd0d9f-fd8e-4dba-8d3f-d3325b5c0c3d;0;;14857;maik.souza;26/05/2022;maik.souza;27/05/2022;0
S;Cubo.018;Alunos por Curso por Mês de Aniversário;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	PPESSOA.NOME AS 'ALUNO',
	SALUNO.RA,
	CODTURMA      AS 'Turma',
	SCURSO.NOME AS 'CURSO',
	SSTATUS.DESCRICAO AS 'STATUS PERIODO LETIVO',
	1 AS TOTAL,

	CONVERT(VARCHAR,PPESSOA.DTNASCIMENTO,103) AS DTNASCIMENTO,
	MONTH(PPESSOA.DTNASCIMENTO) AS 'MESANIVERSARIO',
	YEAR(GETDATE())-YEAR(PPESSOA.DTNASCIMENTO)-IIF(MONTH(GETDATE())*32+DAY(GETDATE())<MONTH(PPESSOA.DTNASCIMENTO)*32+DAY(PPESSOA.DTNASCIMENTO),1,0) AS 'IDADE'
FROM PPESSOA (NOLOCK)
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODPESSOA = PPESSOA.CODIGO
INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE 
	SPLETIVO.CODPERLET = :CODPERLET
	AND MONTH(PPESSOA.DTNASCIMENTO) LIKE '%' + :MESNASCIMENTO + '%'
	AND SCURSO.NOME LIKE '%' + :CURSO + '%'
	AND SSTATUS.DESCRICAO IN (
	'Reserva de Vaga',
	'Cursando',
	'Pendência Financeira',
	'Concluído',
	'Cursando Intercâmbio',
	'Portal Liberado'
)";2064;;;;27/09/2022;marccella.belvedere;1;1;1;1;;;;0;7d46ee96-5459-4ef3-9fad-6aece2328c55;0;;-16357;consultor1.totvs;27/09/2022;marccella.belvedere;27/09/2022;0
S;CUPOM;Cupom de desconto;Select CODCUPOM, QTDCUPOM, (SELECT COUNT(*) FROM SPSINSCAREAOFERTACOMPL(NOLOCK) WHERE VOUCHER = ZMDCPDESCONTO.CODCUPOM) Usados from ZMDCPDESCONTO (NOLOCK);154;;;;18/05/2022;isaldo;1;1;1;1;;;;0;7dc312fd-47a0-4140-8c18-9b3f6239e884;0;;-12213;isaldo;18/05/2022;isaldo;18/05/2022;0
S;Cursando;Total de alunos cursando por Curso;"SELECT DISTINCT
	NomFilial,
	NomTipoCurso,
	NomCurso,
	NomStatus,
	CODPERLET,
	SUM(CASE WHEN NomTipoMatricula = 'Matrícula' THEN 1 else 0 end) INGRESSANTES,
	count(*) - SUM(CASE WHEN NomTipoMatricula = 'Matrícula' THEN 1 else 0 end) VETERENOS,
	Count(*) ALUNOS
FROM 
	v_Unasp_SMATRICPL
Where
	NomStatus='Cursando'
GROUP BY
	NomFilial,
	NomTipoCurso,
	NomCurso,
	NomStatus,
	CODPERLET";383;;;;05/08/2021;mestre;1;1;1;1;;;;0;fb69a036-1853-43ad-b256-1affd0fb8aaf;0;;-7497;mestre;05/08/2021;mestre;05/08/2021;0
S;Cursando.1;Alunos cursando por Curso;"SELECT DISTINCT
	NomFilial,
	NomTipoCurso,
	NomCurso,
	NomStatus,
	CODPERLET,
	isnull(NomTipoMatricula, 'Matrícula') NomTipoMatricula,
	p.NOME,
	p.EMAIL,
	Coalesce(p.Telefone1, p.Telefone2, p.Telefone3) Telefone,
	p.CPF,
	v.RA
FROM 
	v_Unasp_SMATRICPL v
	inner join PPESSOA p  on p.CODIGO=v.CODPESSOA
Where
	NomStatus='Cursando'";328;;;;05/08/2021;mestre;1;1;1;1;;;;0;fb69a036-1853-43ad-b256-1affd0fb8aaf;0;;31576;mestre;05/08/2021;mestre;05/08/2021;0
S;CURSOS;Relatórios dos Cursos;;0;;;;08/04/2021;lucas.ssantos;1;1;1;1;;;;0;84067b75-a87c-4696-94e7-64c50897469c;0;;538;lucas.ssantos;08/04/2021;lucas.ssantos;08/04/2021;0
S;CURSOS.001;Alunos Novos e Veteranos;"SELECT 
*,

CASE WHEN Aluno_status = 'Ingressante' THEN 1 ELSE 0 END Aluno_Ingressantes,
CASE WHEN Aluno_status = 'Veterano' THEN 1 ELSE 0 END Aluno_Veteranos

FROM (

SELECT DISTINCT
	P.NOME				Aluno_Nome,	
	A.RA				Aluno_RA,
	
	CASE M.CODTIPOMAT
		WHEN '1' THEN 'Ingressante'
		WHEN '3' THEN 'Ingressante'
		WHEN '4' THEN 'Ingressante'
		WHEN '2' THEN 'Veterano'
		WHEN  '5' THEN 'Veterano'
					END Aluno_Status,	
	PL.DESCRICAO		Turma_PeriodoLetivo,
	M.DTMATRICULA		Aluno_DataMatricula,
	ST.DESCRICAO		Aluno_StatusTurma,
	C.CODCURSO			Curso_Codigo,
	C.NOME				Curso_Nome,
	PL.DESCRICAO		Curso_Periodo
	
FROM 
	SHABILITACAOALUNO HA

	LEFT JOIN SALUNO A
		 ON A.CODCOLIGADA = HA.CODCOLIGADA
		AND A.RA = HA.RA

	LEFT JOIN PPESSOA P
	 	 ON P.CODIGO = A.CODPESSOA

	LEFT JOIN SMATRICPL M
		 ON M.CODCOLIGADA = HA.CODCOLIGADA
		AND M.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL
		AND M.RA = HA.RA

	LEFT JOIN SSTATUS ST
		 ON ST.CODCOLIGADA = M.CODCOLIGADA
		AND ST.CODSTATUS = M.CODSTATUS

	LEFT JOIN STIPOMATRICULA TM
		 ON TM.CODCOLIGADA = M.CODCOLIGADA
		AND TM.CODTIPOMAT = M.CODTIPOMAT

	LEFT JOIN STURMA T
		 ON T.CODCOLIGADA = M.CODCOLIGADA
		AND T.CODFILIAL = M.CODFILIAL
		AND T.CODTURMA = M.CODTURMA
		AND T.IDPERLET = M.IDPERLET

	LEFT JOIN SPLETIVO PL
		 ON PL.CODCOLIGADA = T.CODCOLIGADA
		AND PL.IDPERLET = T.IDPERLET

	LEFT JOIN SHABILITACAOFILIAL HF
		 ON HF.CODCOLIGADA = HA.CODCOLIGADA
		AND HF.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL

	LEFT JOIN SHABILITACAO H
		 ON H.CODCOLIGADA = HF.CODCOLIGADA
		AND H.CODCURSO = HF.CODCURSO
		AND H.CODHABILITACAO = HF.CODHABILITACAO

	LEFT JOIN SCURSO C
		 ON C.CODCOLIGADA = H.CODCOLIGADA
		AND C.CODCURSO = H.CODCURSO

WHERE
	C.CODCURSO = :CODCURSO
	AND PL.CODPERLET = :CODPERLET
)X
ORDER BY Aluno_Nome";1843;;;;12/04/2021;lucas.ssantos;1;1;1;1;;;;0;8e1153d6-485e-462a-b713-d27463c280d5;0;;-5377;lucas.ssantos;08/04/2021;lucas.ssantos;12/04/2021;0
S;CURSOS.002;Alunos Novos e Veteranos - Totalizador;"SELECT DISTINCT	
	ST.DESCRICAO		Aluno_StatusTurma,
	COUNT (ST.DESCRICAO) TOTAL
	
	
FROM 
	SHABILITACAOALUNO HA

	LEFT JOIN SALUNO A
		 ON A.CODCOLIGADA = HA.CODCOLIGADA
		AND A.RA = HA.RA

	LEFT JOIN PPESSOA P
	 	 ON P.CODIGO = A.CODPESSOA

	LEFT JOIN SMATRICPL M
		 ON M.CODCOLIGADA = HA.CODCOLIGADA
		AND M.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL
		AND M.RA = HA.RA

	LEFT JOIN SSTATUS ST
		 ON ST.CODCOLIGADA = M.CODCOLIGADA
		AND ST.CODSTATUS = M.CODSTATUS

	LEFT JOIN STIPOMATRICULA TM
		 ON TM.CODCOLIGADA = M.CODCOLIGADA
		AND TM.CODTIPOMAT = M.CODTIPOMAT

	LEFT JOIN STURMA T
		 ON T.CODCOLIGADA = M.CODCOLIGADA
		AND T.CODFILIAL = M.CODFILIAL
		AND T.CODTURMA = M.CODTURMA
		AND T.IDPERLET = M.IDPERLET

	LEFT JOIN SPLETIVO PL
		 ON PL.CODCOLIGADA = T.CODCOLIGADA
		AND PL.IDPERLET = T.IDPERLET
		
	LEFT JOIN SHABILITACAOFILIAL HF
		 ON HF.CODCOLIGADA = HA.CODCOLIGADA
		AND HF.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL

	LEFT JOIN SHABILITACAO H
		 ON H.CODCOLIGADA = HF.CODCOLIGADA
		AND H.CODCURSO = HF.CODCURSO
		AND H.CODHABILITACAO = HF.CODHABILITACAO

	LEFT JOIN SCURSO C
		 ON C.CODCOLIGADA = H.CODCOLIGADA
		AND C.CODCURSO = H.CODCURSO
		
WHERE
	PL.CODPERLET = :CODPERLET
	AND C.CODCURSO = :CODCURSO	

GROUP BY ST.DESCRICAO";1304;;;;09/04/2021;lucas.ssantos;1;1;1;1;;;;0;af3cff73-211e-40b6-b3b3-a652fe63236a;0;;-29251;lucas.ssantos;08/04/2021;lucas.ssantos;09/04/2021;0
S;Declarações;Declarações;;0;;;;08/03/2021;lucas.ssantos;1;1;1;1;;;;0;416b763c-e374-4386-90c5-9a1caac34679;0;;32042;lucas.ssantos;08/03/2021;lucas.ssantos;08/03/2021;0
S;Declarações.001;Declaração de Matricula;"SELECT
	HA.RA,
	MA.IDPERLET,
  	MA.IDHABILITACAOFILIAL,
  	
  	Concat ('https://validacaomatricula.unasp.edu.br/' , Z.ID) as link,
  	
	HF.CODFILIAL,
	P.NOME,
	P.CARTIDENTIDADE	Rg,
	P.ORGEMISSORIDENT	RgEmissor,
	P.UFCARTIDENT		RgUF,
	P.CPF				CPF,
	CASE P.SEXO
		WHEN 'F' THEN 'a aluna'
		WHEN 'M' THEN 'o aluno'
					END	GenAlunoA,
	CASE  P.SEXO
		WHEN 'F' THEN 'portadora'
		WHEN 'M' THEN 'portador'
					END	GenPortadorA,
	CASE  P.SEXO
		WHEN 'F' THEN 'matriculada'
		WHEN 'M' THEN 'matriculado'
					END	GenMatriculadoA,	
	PL.CODPERLET		PeriodoLetivo,
	C.NOME				Curso,
	c.CODCURSO			CodCurso,
	T.CODTURMA			CodTurma,
	T.NOME				NomeTurma,
	D.CODDISC			CodDisciplina, 
	D.NOME				NomeDisciplina,
	D.NUMCREDITOS		CredDisciplinas,	
	S.DESCRICAO			StatDisciplina,	
	M.DTMATRICULA		DataMatricula,
	TE.ETAPAS			Semestres,	
	CASE TU.TIPO
		WHEN 'I' THEN 'Integral'
		WHEN 'M' THEN 'Matutino'
		WHEN 'N' THEN 'Noturno'
		WHEN 'V' THEN 'Vespertino'
					END TurnoPeriodo,
	TU.HORINI			TurnoHoraInicial,
	TU.HORFIM			TurnoHoraFinal,
		CASE WHEN STURMACOMPL.HORTURMA IS NULL THEN 'O Horário de aulas é de ' + TU.HORINI + ' às ' +  TU.HORFIM
	ELSE STURMACOMPL.HORTURMA END AS 'HORTURMA',
	CASE MA.CODFILIAL
		WHEN '1' THEN 'São Paulo,'
		WHEN '2' THEN 'Engenheiro Coelho,'
		WHEN '3' THEN 'Hortolândia,'
					END CIDADE,
	z.ID ID
	
FROM 
	SHABILITACAOALUNO HA
	inner JOIN SALUNO A ON A.CODCOLIGADA = HA.CODCOLIGADA AND A.RA = HA.RA
	inner JOIN PPESSOA P ON P.CODIGO = A.CODPESSOA
	inner JOIN SHABILITACAOFILIAL HF ON HF.CODCOLIGADA = HA.CODCOLIGADA AND HF.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL
	inner JOIN SHABILITACAO H ON H.CODCOLIGADA = HF.CODCOLIGADA AND H.CODCURSO = HF.CODCURSO AND H.CODHABILITACAO = HF.CODHABILITACAO
	inner JOIN SCURSO C ON C.CODCOLIGADA = H.CODCOLIGADA AND C.CODCURSO = H.CODCURSO
	inner JOIN SMATRICPL MA ON MA.CODCOLIGADA = HA.CODCOLIGADA AND MA.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL AND MA.RA = HA.RA
	inner JOIN SPLETIVO PL ON PL.CODCOLIGADA = MA.CODCOLIGADA AND PL.IDPERLET = MA.IDPERLET
	inner JOIN SMATRICULA M ON M.CODCOLIGADA = MA.CODCOLIGADA AND M.IDPERLET = MA.IDPERLET AND M.IDHABILITACAOFILIAL = MA.IDHABILITACAOFILIAL AND M.RA = MA.RA 
	inner JOIN SSTATUS S ON S.CODCOLIGADA = M.CODCOLIGADA AND S.CODSTATUS = M.CODSTATUS
	inner JOIN STURMADISC TD ON TD.IDTURMADISC = M.IDTURMADISC
	inner JOIN STURMA T ON T.CODCOLIGADA =TD.CODCOLIGADA AND T.CODTURMA=TD.CODTURMA AND T.CODFILIAL = TD.CODFILIAL AND T.IDPERLET = TD.IDPERLET
	LEFT JOIN STURMACOMPL ON STURMACOMPL.CODCOLIGADA = T.CODCOLIGADA AND STURMACOMPL.CODTURMA = T.CODTURMA AND STURMACOMPL.IDPERLET = T.IDPERLET AND STURMACOMPL.CODFILIAL = T.CODFILIAL
	
	inner JOIN SDISCIPLINA D ON D.CODCOLIGADA = TD.CODCOLIGADA AND D.CODDISC = TD.CODDISC
	/*Modificado em 01/06/2022 Nathan - PVT - Colocado para olhar o turno da Matriz do aluno e não das disciplinas*/
	inner JOIN STURNO TU ON TU.CODCOLIGADA = HF.CODCOLIGADA AND TU.CODTURNO = HF.CODTURNO	
	inner join z_Unasp_DeclaracaoMatricula z on z.CODCOLIGADA = HA.CODCOLIGADA AND z.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL AND z.RA = HA.RA
		/*Modificado em 01/06/2022 Nathan - PVT - Adicionado join para validar o periodo letivo, pois estava duplicando os registros de disciplina.*/
		AND Z.IDPERLET = MA.IDPERLET
	/* apena último período que o aluno tem status cursando*/
/*	inner join (
		Select 
			mpl.CODCOLIGADA, mpl.IDHABILITACAOFILIAL, mpl.RA, max(IDPERLET) IDPERLET
		from
		    SMATRICPL mpl
		    inner join SSTATUS st on st.CODCOLIGADA=mpl.CODCOLIGADA and st.CODSTATUS=mpl.CODSTATUS
		Where
		    st.DESCRICAO='Cursando'
		group by
		    mpl.CODCOLIGADA, mpl.IDHABILITACAOFILIAL, mpl.RA) upl on upl.CODCOLIGADA = ma.CODCOLIGADA and upl.IDHABILITACAOFILIAL = ma.IDHABILITACAOFILIAL and upl.RA = ma.RA and upl.IDPERLET = ma.IDPERLET
*/			
	LEFT JOIN (
					SELECT 	
						CODCOLIGADA, CODCURSO, CODHABILITACAO, CODGRADE,
						MAX (CODPERIODO) ETAPAS
					FROM 
						v_Unasp_SDISCGRADE where CODPERIODO<99
					GROUP BY
						CODCOLIGADA, CODCURSO, CODHABILITACAO, CODGRADE
				) TE ON  TE.CODCOLIGADA = HF.CODCOLIGADA and TE.CODCURSO = HF.CODCURSO and TE.CODHABILITACAO = HF.CODHABILITACAO and TE.CODGRADE = HF.CODGRADE

WHERE 
  MA.CODCOLIGADA = :CODCOLIGADA
  AND MA.IDPERLET= :IDPERLET
  AND MA.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
  AND MA.RA = :RA
  AND S.DESCRICAO LIKE 'Cursando%'
 ";4456;;;;23/08/2022;consultor1.totvs;1;1;1;1;;;;0;3cfa6ccb-90f2-426b-9e86-e10276479c99;0;;-4612;lucas.ssantos;08/03/2021;consultor1.totvs;23/08/2022;0
S;DEMO.071;LEADS POR CURSO DE INTERESSE;"SELECT C.DESCRICAO           AS CURSO,
       COUNT (A.CODPROSPECT) AS LEADS
FROM   HPROSPECT A (NOLOCK)
       JOIN HPROSPECTCOMPL B (NOLOCK)
         ON A.CODCOLIGADA = B.CODCOLIGADA
            AND A.CODPROSPECT = B.CODPROSPECT
            AND B.CURSOS IS NOT NULL
       JOIN GCONSIST C (NOLOCK)
         ON A.CODCOLIGADA = C.CODCOLIGADA
            AND B.CURSOS = C.CODCLIENTE
            AND C.CODCOLIGADA = 1
            AND C.APLICACAO = 'H'
            AND C.CODTABELA = '1'
GROUP  BY B.CURSOS,
          C.DESCRICAO
ORDER  BY B.CURSOS DESC
";566;;;;14/05/2021;mestre;1;1;1;1;;;;0;f5fdb4c8-24ce-4538-bfa8-e73fec2beb78;;;-16189;mestre;14/05/2021;mestre;14/05/2021;
S;DEMO.083.0001;DESEMPENHO NOTAS PS;SELECT * FROM v_EST_NOTAS;25;;;;14/05/2021;mestre;1;1;1;1;;;;0;f050fd0b-f6a4-4a02-b043-1f81ca360be0;;;-24179;mestre;14/05/2021;mestre;14/05/2021;
S;Diariodeclasse;Diario de classe;"SELECT 
  AUX.CODCOLIGADA,
  AUX.CODFILIAL,
  AUX.CODTIPOCURSO,
  AUX.IDHABILITACAOFILIAL,
  AUX.IDTURMADISC,
  AUX.CODDISC,
  AUX.CODTURMA,
  AUX.CODPROF,
  AUX.NOMEPROFESSOR,
  AUX.NOMEDISCIPLINA,
  AUX.CH,
  AUX.CODPERLET,
  AUX.NOMETURNO,
  AUX.NOMECURSO,
  AUX.NOMEHABILITACAO,
  AUX.NOMEFILIAL,
  AUX.IMAGEM,
  AUX.RA,
  AUX.NUMDIARIO,
  AUX.NOMEALUNO,
  AUX.APRESENTACAO,
  AUX.IDPROFESSORTURMA,
  AUX.NOTACONCEITO,
  AUX.CODPROVA,
  AUX.NOMEPROVA,  
  AUX.NOMEETAPA,
  AUX.CODETAPA,
  AUX.NOMESTATUSRES,
  AUX.AULASDADAS,
  AUX.AULASPREVISTAS,  
  AUX.DTINICIO,
  AUX.QUEBRA,
  AUX.NUMCASASDECCH
FROM (
SELECT 
  STURMADISC.CODCOLIGADA,
  STURMADISC.CODFILIAL,
  STURMADISC.CODTIPOCURSO,
  STURMADISC.IDHABILITACAOFILIAL,
  STURMADISC.IDTURMADISC,
  STURMADISC.CODDISC,
  STURMADISC.CODTURMA,
  SPROFESSOR.CODPROF,
  PPESSOAPROFESSOR.NOME AS NOMEPROFESSOR,
  SDISCIPLINA.NOME AS NOMEDISCIPLINA,
  CASE WHEN (STIPOCURSO.APRESENTACAO = 0) THEN
    SDISCGRADE.CH
  ELSE
    SDISCIPLINA.CH
  END AS CH,
  SPLETIVO.CODPERLET,
  STURNO.NOME AS NOMETURNO,
  SCURSO.NOME AS NOMECURSO,
  SHABILITACAO.NOME AS NOMEHABILITACAO,
  GFILIAL.NOME AS NOMEFILIAL,
  GIMAGEM.IMAGEM,
  SMATRICULA.RA,
  SMATRICULA.NUMDIARIO,
  PPESSOAALUNO.NOME AS NOMEALUNO,
  PPESSOAALUNO.NOMESOCIAL AS NOMESOCIALALUNO,
  STIPOCURSO.APRESENTACAO,
  SPROFESSORTURMA.IDPROFESSORTURMA,
  CASE 
    WHEN STIPOCURSO.APRESENTACAO = 0 AND SDISCGRADE.TIPONOTA  = 'N' THEN SNOTAS.NOTA 
    WHEN STIPOCURSO.APRESENTACAO = 0 AND SDISCGRADE.TIPONOTA  = 'C' THEN SNOTAS.CODCONCEITO 
    WHEN STIPOCURSO.APRESENTACAO = 1 AND SDISCIPLINA.TIPONOTA = 'N' THEN SNOTAS.NOTA 
    WHEN STIPOCURSO.APRESENTACAO = 1 AND SDISCIPLINA.TIPONOTA = 'C' THEN SNOTAS.CODCONCEITO 
  END AS NOTACONCEITO,

  SPROVAS.CODPROVA,
  SPROVAS.DESCRICAO AS NOMEPROVA,
  SETAPAS.DESCRICAO AS NOMEETAPA,
  SETAPAS.CODETAPA,
  SETAPAS.AULASDADAS,
  SETAPAS.AULASPREVISTAS,
  SETAPAS.DTINICIO,
  SSTATUSRES.DESCRICAO AS NOMESTATUSRES,
  CAST(STURMADISC.IDTURMADISC AS VARCHAR(10)) + CAST(CEILING(ROW_NUMBER() OVER(PARTITION BY STURMADISC.IDTURMADISC, PPESSOAPROFESSOR.NOME, PPESSOAALUNO.NOME ORDER BY STURMADISC.IDTURMADISC, SPROVAS.CODPROVA) / 7.0) AS VARCHAR(10)) AS QUEBRA,
  SPARAMNUMCASASCH.INTEIRO NUMCASASDECCH
FROM STURMADISC (NOLOCK) JOIN SETAPAS (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC)
   JOIN SPROFESSORTURMA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC)         
   JOIN SPROFESSOR (NOLOCK)
     ON (SPROFESSORTURMA.CODCOLIGADA = SPROFESSOR.CODCOLIGADA
         AND SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF)
   JOIN PPESSOA PPESSOAPROFESSOR(NOLOCK)
     ON (SPROFESSOR.CODPESSOA = PPESSOAPROFESSOR.CODIGO)
   JOIN SDISCIPLINA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
         AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC)
   JOIN SPLETIVO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
         AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET)
   JOIN GFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA
         AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL)
   LEFT JOIN GIMAGEM (NOLOCK)
     ON (GFILIAL.IDIMAGEM = GIMAGEM.ID)
   LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
         AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL)
   LEFT JOIN STURNO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO)
   LEFT JOIN SCURSO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO)
   LEFT JOIN SHABILITACAO (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SHABILITACAO.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SHABILITACAO.CODHABILITACAO)
   JOIN SMATRICULA (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
         AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC)
   JOIN SALUNO (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA 
         AND SMATRICULA.RA = SALUNO.RA)
   JOIN PPESSOA PPESSOAALUNO (NOLOCK)
     ON (SALUNO.CODPESSOA = PPESSOAALUNO.CODIGO)
   JOIN SSTATUS (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA
         AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS)
   JOIN STIPOCURSO (NOLOCK)
     ON (STURMADISC.CODCOLIGADA  = STIPOCURSO.CODCOLIGADA 
         AND STURMADISC.CODTIPOCURSO = STIPOCURSO.CODTIPOCURSO)
         
   LEFT JOIN SPROVAS (NOLOCK)
     ON (SPROVAS.CODCOLIGADA = SETAPAS.CODCOLIGADA 
         AND SPROVAS.IDTURMADISC = SETAPAS.IDTURMADISC 
         AND SPROVAS.CODETAPA  = SETAPAS.CODETAPA 
         AND SPROVAS.TIPOETAPA = SETAPAS.TIPOETAPA)
         
   LEFT JOIN SNOTAS (NOLOCK)
     ON (SNOTAS.CODCOLIGADA = SPROVAS.CODCOLIGADA 
         AND SNOTAS.IDTURMADISC = SPROVAS.IDTURMADISC
         AND SNOTAS.CODETAPA    = SPROVAS.CODETAPA 
         AND SNOTAS.TIPOETAPA   = SPROVAS.TIPOETAPA
         AND SNOTAS.CODPROVA    = SPROVAS.CODPROVA
         AND SNOTAS.RA = SMATRICULA.RA)
         
   LEFT JOIN SSTATUS SSTATUSRES (NOLOCK)
     ON (SMATRICULA.CODCOLIGADA = SSTATUSRES.CODCOLIGADA
         AND SMATRICULA.CODSTATUSRES = SSTATUSRES.CODSTATUS)
   LEFT JOIN SDISCGRADE (NOLOCK)
     ON (SHABILITACAOFILIAL.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
         AND SHABILITACAOFILIAL.CODCURSO = SDISCGRADE.CODCURSO
         AND SHABILITACAOFILIAL.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
         AND SHABILITACAOFILIAL.CODGRADE = SDISCGRADE.CODGRADE
         AND STURMADISC.CODDISC = SDISCGRADE.CODDISC)
   LEFT JOIN SPARAM SPARAMNUMCASASCH (NOLOCK)
     ON (STURMADISC.CODCOLIGADA = SPARAMNUMCASASCH.CODCOLIGADA AND
         STURMADISC.CODFILIAL = SPARAMNUMCASASCH.CODFILIAL AND
         STURMADISC.CODTIPOCURSO = SPARAMNUMCASASCH.CODTIPOCURSO AND
         SPARAMNUMCASASCH.ID = 'NUMCASASDECCH')         
WHERE STURMADISC.CODCOLIGADA = :CODCOLIGADA_N 
  AND STURMADISC.CODFILIAL = :CODFILIAL_N 
  AND STURMADISC.CODTIPOCURSO = :CODTIPOCURSO_N 
  AND STURMADISC.ATIVA = 'S' 
  AND SSTATUS.DIINCALUNODISC = 'S' 
  /*AND SSTATUS.PLDIARIO = 'S' */
  AND SETAPAS.TIPOETAPA = 'N'
  AND SPLETIVO.ENCERRADO = 'N' 
  AND SETAPAS.CODETAPA = :CODETAPA_N
  AND SPROFESSORTURMA.CODPROF BETWEEN :CODPROFDE_S AND :CODPROFATE_S 
  AND STURMADISC.CODTURMA like '%' + :TURMA_N + '%'
  AND SPLETIVO.CODPERLET = :PERIODOLETIVO  
  AND SPROVAS.CODPROVA IS NOT NULL

) AUX

/*WHERE AUX.QUEBRA = :P_QUEBRA*/
ORDER BY AUX.CODCOLIGADA, 
  AUX.IDTURMADISC, 
  AUX.IDPROFESSORTURMA, 
  AUX.NUMDIARIO,
  AUX.NOMEALUNO,
  AUX.DTINICIO,
  AUX.CODPROVA,
  AUX.NOMEPROVA
";7011;;;;18/10/2021;lilian.buzetti;1;1;1;1;;;;0;deb83238-e978-4e51-96a0-ad4759889432;0;;9502;lilian.buzetti;18/10/2021;lilian.buzetti;18/10/2021;0
S;DIPLOMA.001;Diplomas Alunos por Curso;"SELECT 
	SCERTIFICADO.IDCERTIFICADO,
	SCERTIFICADO.DATACERTIFICADO,
	SCERTIFICADO.RA,
	SCERTIFICADO.STATUS,
	SCERTIFICADO.FOLHA,
	SCERTIFICADO.NUMREGISTRO,
	CAST(SCERTIFICADO.CARGAHORARIA AS INT) AS 'CARGAHORARIA',
	SCERTIFICADO.NUMPROCESSO AS 'ISEMISSAOEREGISTRO',
	SCERTIFICADO.CODLIVRO,
	SCERTIFICADO.DTCONFERENCIA,
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.NOME AS 'CURSO',
	SINSTITUICAO.NOME AS 'IESREGISTRO',
	SEMI.NOME AS 'IESEMISSAO',
	SLIVRO.DESCRICAO AS 'LIVRO'
FROM SCERTIFICADO (NOLOCK)
INNER JOIN SINSTITUICAO (NOLOCK) ON SINSTITUICAO.CODINST = SCERTIFICADO.CODINSTREGISTRO
INNER JOIN SINSTITUICAO (NOLOCK) SEMI ON SEMI.CODINST = SCERTIFICADO.CODINSTEMISSAO
INNER JOIN SLIVRO (NOLOCK) ON SCERTIFICADO.CODCOLIGADA = SLIVRO.CODCOLIGADA
	AND SCERTIFICADO.CODLIVRO = SLIVRO.CODLIVRO
INNER JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SALUNO.RA = SCERTIFICADO.RA
INNER JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHABILITACAOFILIAL.CODCOLIGADA = SCERTIFICADO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCERTIFICADO.IDHABILITACAOFILIAL
INNER JOIN GFILIAL (NOLOCK) ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
INNER JOIN STIPOCURSO (NOLOCK) ON STIPOCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
INNER JOIN SGRADE (NOLOCK) ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
WHERE SCURSO.NOME LIKE '%' + :CURSO + '%'

ORDER BY PPESSOA.NOME";;;;;;;1;1;1;1;;;;;ce15e511-48e4-4900-995f-fde65eb9b5a7;;;14075;consultor1.totvs;06/06/2022;consultor1.totvs;06/06/2022;
S;DISC_Canvas;Disciplinas para incluir no Canvas;"Select distinct
	td.IDTURMADISC,
	REPLACE(d.NOME,',',''),
	REPLACE(concat(d.NOME,' - ',t.CODTURMA),',','') NOME,
	concat(hf.CODCURSO,'-',pl.CODPERLET) ID,
	hf.NomCurso,
	hf.CODCURSO,
	hf.NomTipoCurso
from 
	STURMADISC								(nolock) td
    INNER JOIN STURMA						(nolock) t		ON t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET = td.IDPERLET
    INNER JOIN STURMADISCCOMPL				(nolock) tdPL	ON tdPL.CODCOLIGADA = td.CODCOLIGADA and tdPL.IDTURMADISC = td.IDTURMADISC
    INNER JOIN SDISCIPLINA					(nolock) d		ON d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
    inner join SPLETIVO						(nolock) pl		on pl.CODCOLIGADA=td.CODCOLIGADA and pl.IDPERLET = td.IDPERLET
	inner join v_Unasp_SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA=t.CODCOLIGADA and hf.IDHABILITACAOFILIAL=t.IDHABILITACAOFILIAL
Where
	t.CODFILIAL in (1,2,3)
	and t.CODTIPOCURSO in (1)
	and pl.CODPERLET=:CODPERLET
	and tdpl.IDCANVAS is null
	and hf.NomCurso not like '%Pensionato%'
	and td.IDTURMADISC not in (select IDTURMADISCGERENCIADA from STURMADISCGERENCIADA)";1122;;;;23/02/2022;roan.rossi;1;1;1;1;;;;0;ef9fc04d-2d69-407e-8d4d-c5b580590788;0;;-9979;mestre;27/07/2021;roan.rossi;23/02/2022;0
S;DX_HISTORICO_103;DX_V_HISTORICO_103;"SELECT
DISCIPLINA_NOME,
DISCIPLINA_PERIODO,
DISCIPLINA_CARGAHORARIA,
DISCIPLINA_NOTA,
DISCIPLINA_NOTAATECEM,
DISCIPLINA_CONCEITO,
DISCIPLINA_CONCEITORM,
DISCIPLINA_CONCEITOESPECIFICO,
DISCIPLINA_STATUS,
PROFESSOR_NOME,
PROFESSOR_TITULACAO,
PROFESSOR_LATTES,
PROFESSOR_CPF, 
ORDEM
FROM 
	DX_V_HISTORICO_103 (NOLOCK)
WHERE 
	CODCOLIGADA = 1
	AND IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL
	AND RA = :RA
ORDER BY ORDEM";415;;;;18/10/2022;isaldo;1;1;1;1;;;;0;9db06806-d1a1-4208-9dfc-8aa0c349677d;0;;-23496;isaldo;18/10/2022;isaldo;18/10/2022;0
S;EbolsaAluno;Lista de Alunos para Ebolsa;Select * from fn_Ebolsas_Aluno( :Ano, :CPF);43;;;;30/08/2022;isaldo;1;1;1;1;;;;0;9f8b4f43-4f7c-4871-a2d5-bb82a1cbb587;0;;9598;isaldo;30/08/2022;isaldo;30/08/2022;0
S;EbolsaCurso;Lista de Cursos para Ebolsa;"Select 
	CODIGO,	
	NOME,	
	STANDARDPROGRAMID
 From 
 	fn_Ebolsas_Curso(:SchoolCode, :Ano, :Semestre) ";106;;;;30/08/2022;isaldo;1;1;1;1;;;;0;34459767-28c2-4a1c-95a3-02cd467f7a3e;0;;-682;isaldo;30/08/2022;isaldo;30/08/2022;0
S;EbolsaSchoolCode;Lista de SchoolCode;"Select z.CODFILIAL, f.Nome, z.EbolsaSchoolCode 
from 
	Z_FILIAL z 
	inner join GFILIAL f on f.CODFILIAL = z.CODFILIAL
Order by
	f.Nome";139;;;;26/09/2022;mestre;1;1;1;1;;;;0;55945ad1-362e-4161-94e7-6395dea627a7;0;;7610;mestre;26/09/2022;mestre;26/09/2022;0
S;EDU.SEC017;Alunos Pensionato;"SELECT m.NomFilial   Filial,
       m.NomCurso    Curso,
       m.NomTurno    Turno,
       m.NomGrade    Matriz,
       m.CODPERLET   Período,
       m.NomTurma    Turma,
       m.RA,
       m.NomPessoa   Aluno,
       m.CPF,
	   m.DTNASCIMENTO,
       m.Sexo,
       m.NomStatus,
       m.Email,
       m.Rua,
       m.Numero,
       m.Cidade,
       m.Religiao,
       m.Bairro,
       m.Complemento,
       m.Telefone1,
       m.Telefone2,
       m.Telefone3,
       pai.NOME      Pai,
       pai.EMAIL     PaiEmail,
       pai.TELEFONE1 Pai_TELEFONE1,
       pai.TELEFONE2 Pai_TELEFONE2,
       pai.TELEFONE3 Pai_TELEFONE3,
       mae.NOME      Mae,
       Mae.EMAIL     MaeEmail,
       Mae.TELEFONE1 Mae_TELEFONE1,
       Mae.TELEFONE2 Mae_TELEFONE2,
       Mae.TELEFONE3 Mae_TELEFONE3,
       f.NOME        RespFinanceiro,
       CASE
         WHEN f.NOME = p.NOME THEN ''
         ELSE f.EMAIL
       END           RespFinEmail,
       CASE
         WHEN f.NOME = p.NOME THEN ''
         ELSE f.TELEFONE
       END           RespFinTel1,
       CASE
         WHEN f.NOME = p.NOME THEN ''
         ELSE f.TELEFONECOMERCIAL
       END           RespFinTel2
FROM   v_Unasp_SMATRICPL m
       INNER JOIN SALUNO a
               ON a.CODCOLIGADA = m.CODCOLIGADA
                  AND a.RA = m.RA
       INNER JOIN PPESSOA p
               ON p.CODIGO = m.CODPESSOA
       LEFT JOIN SPESSOA sp
              ON sp.CODIGO = p.CODIGO
       LEFT JOIN PPESSOA pai
              ON pai.CODIGO = sp.CODPESSOAPAI
       LEFT JOIN PPESSOA mae
              ON mae.CODIGO = sp.CODPESSOAMAE
       LEFT JOIN FCFO f
              ON f.CODCFO = a.CODCFO
WHERE  CODPERLET = :CODPERLET
       AND CODCURSO IN ( 'EC-GPENS', 'EC-PPENS', 'HT-GPENS', 'SP-GPENS', 'HT-PPENS', 'SP-PPENS') 
";1835;;;;08/09/2022;robson.canto;1;1;1;1;;;;1;4fbe8d90-2718-4f0c-b06f-4b5706f73dff;0;;-25781;robson.canto;08/09/2022;robson.canto;08/09/2022;0
S;EDU.SEC018;Alunos no Período Letivo;Select CODCOLIGADA, IDHABILITACAOFILIAL, RA, IDPERLET, NomPessoa from v_Unasp_SMATRICPL where CODPERLET = :CODPERLET and NomStatus = :NomStatus;143;;;;20/09/2022;isaldo;1;1;1;1;;;;0;fde2fdef-8b82-4b72-9603-9b1cd38f176b;0;;-4402;isaldo;20/09/2022;isaldo;20/09/2022;0
S;EDUC.02.008.3;RETORNA QUANTITATIVOS DE PROFESSORES DO HORÁRIO DA TURMADISC;"SELECT A.CODDISC, A.IDTURMADISC, A.CODCOLIGADA, A.IDHABILITACAOFILIAL, A.IDPERLET,
B.CODCURSO, E.NOME AS CURSO, F.NOME AS DISCIPLINA, B.CODTIPOCURSO, B.CODTURNO, B.CODFILIAL, C.CODPERLET, TURNO = D.NOME,

IMG_COLIGADA = (SELECT Z.IMAGEM FROM GCOLIGADA X
                INNER JOIN GIMAGEM Z ON Z.ID = X.IDIMAGEM
                WHERE X.CODCOLIGADA = A.CODCOLIGADA),


TOTAL_PLANO_AULA = (SELECT COUNT(*) FROM SPLANOAULA X
        WHERE X.IDTURMADISC = A.IDTURMADISC
        AND X.CODCOLIGADA = A.CODCOLIGADA
        AND X.CODFILIAL = C.CODFILIAL),

TOTAL_HORARIO_TURMA = (SELECT COUNT(*) FROM SHORARIOTURMA X
        WHERE X.IDTURMADISC = A.IDTURMADISC
        AND X.CODCOLIGADA = A.CODCOLIGADA
        AND X.CODFILIAL = C.CODFILIAL),

TOTAL_PROF_HORARIO = (SELECT COUNT(*)
        FROM SHORARIOPROFESSOR AA (NOLOCK)
        INNER JOIN SHORARIOTURMA AS BB (NOLOCK) ON (BB.CODCOLIGADA = AA.CODCOLIGADA
                                                  AND BB.IDHORARIOTURMA = AA.IDHORARIOTURMA)
        INNER JOIN STURMADISC AS CC (NOLOCK) ON (CC.CODCOLIGADA = BB.CODCOLIGADA
                                               AND CC.IDTURMADISC = BB.IDTURMADISC)
        INNER JOIN SPLETIVO AS DD (NOLOCK) ON (DD.CODCOLIGADA = CC.CODCOLIGADA
                                             AND DD.IDPERLET = CC.IDPERLET)
        INNER JOIN SHABILITACAOFILIAL AS EE (NOLOCK) ON (EE.CODCOLIGADA = CC.CODCOLIGADA
                                                       AND EE.IDHABILITACAOFILIAL = CC.IDHABILITACAOFILIAL)
        WHERE AA.CODCOLIGADA = B.CODCOLIGADA
        AND CC.CODFILIAL = B.CODFILIAL
        AND CC.CODTIPOCURSO = B.CODTIPOCURSO
        AND CC.IDTURMADISC = A.IDTURMADISC),
LANCAMENTO_NOTAS_FALTAS = (SELECT COUNT(*) FROM SFREQUENCIA X
        WHERE X.IDTURMADISC  = A.IDTURMADISC
        AND X.CODCOLIGADA = A.CODCOLIGADA)

FROM STURMADISC A (NOLOCK)
INNER JOIN SHABILITACAOFILIAL AS B (NOLOCK) ON (B.CODCOLIGADA = A.CODCOLIGADA
                AND B.IDHABILITACAOFILIAL = A.IDHABILITACAOFILIAL)
INNER JOIN SPLETIVO AS C (NOLOCK) ON (C.CODCOLIGADA = A.CODCOLIGADA
                AND C.IDPERLET = A.IDPERLET)
INNER JOIN STURNO AS D (NOLOCK) ON (D.CODCOLIGADA = B.CODCOLIGADA
                AND D.CODTURNO = B.CODTURNO)
INNER JOIN SCURSO AS E (NOLOCK) ON (E.CODCURSO = B.CODCURSO AND E.CODTIPOCURSO = B.CODTIPOCURSO AND E.CODCOLIGADA = B.CODCOLIGADA)
INNER JOIN SDISCIPLINA AS F (NOLOCK) ON (F.CODDISC = A.CODDISC AND F.CODCOLIGADA = A.CODCOLIGADA)

WHERE A.IDTURMADISC = :IDTURMADISC
AND A.CODTIPOCURSO  = :$CODTIPOCURSO
AND A.CODFILIAL = :$CODFILIAL
AND A.CODCOLIGADA = :$CODCOLIGADA";;;;;;;1;1;1;1;;;;;0fb9508f-1310-40e2-9155-f5c8000a757c;;;-13301;lucas.marques;02/08/2022;lucas.marques;02/08/2022;
S;Edufinnfe;Educacional x Financeiro x Nota Fiscal;"
	SELECT 
	1 Total,
	SPARCELA.RA,
	SPARCELA.DTVENCIMENTO,
	SPARCELA.PARCELA Parcela, 
	ISNULL(FLAN.VALORORIGINAL,0) [Valor Parcela], 
	
	isnull((SELECT SUM(SBOLSALAN.VALOR) FROM SBOLSALAN 
	INNER JOIN SBOLSA  ON SBOLSALAN.CODBOLSA = SBOLSA.CODBOLSA AND SBOLSALAN.CODCOLIGADA = SBOLSA.CODCOLIGADA
	WHERE  SBOLSALAN.CODCOLIGADA = SLAN.CODCOLIGADA AND 
	       SBOLSALAN.IDLAN = SLAN.IDLAN AND VALIDADELIMITADA = 1),0) BolsaIncondicional,
	
	isnull((SELECT SUM(SBOLSALAN.VALOR) FROM SBOLSALAN 
	INNER JOIN SBOLSA  ON SBOLSALAN.CODBOLSA = SBOLSA.CODBOLSA AND SBOLSALAN.CODCOLIGADA = SBOLSA.CODCOLIGADA
	WHERE  SBOLSALAN.CODCOLIGADA = SLAN.CODCOLIGADA AND 
	       SBOLSALAN.IDLAN = SLAN.IDLAN AND VALIDADELIMITADA = 0),0) BolsaCondicional,
	       
	isnull(FLAN.VALORORIGINAL - 
	isnull((SELECT SUM(SBOLSALAN.VALOR) FROM SBOLSALAN 
	INNER JOIN SBOLSA  ON SBOLSALAN.CODBOLSA = SBOLSA.CODBOLSA AND SBOLSALAN.CODCOLIGADA = SBOLSA.CODCOLIGADA
	WHERE  SBOLSALAN.CODCOLIGADA = SLAN.CODCOLIGADA AND 
	       SBOLSALAN.IDLAN = SLAN.IDLAN AND VALIDADELIMITADA = 1),0),0) AS [Valor Nota Calculado],
	isnull(TMOV.VALORBRUTOINTERNO,0) [Valor Nota Emitida], 
	isnull(TMOV.IDMOV,'') IDMOV , ISNULL(FLAN.IDLAN,'') IDLAN,
	PPESSOA.NOME Aluno,
	SSERVICO.NOME Serviço,
	CASE WHEN TNFEMUNICIPAL.STATUS = 'C' THEN 'Cancelada' 
	     WHEN TNFEMUNICIPAL.STATUS = 'P' THEN 'Pendente'
	     WHEN TNFEMUNICIPAL.STATUS = 'I' THEN 'Inconsistente'
	     WHEN TNFEMUNICIPAL.STATUS = 'R' THEN 'Rejeitada' 
	     WHEN TNFEMUNICIPAL.STATUS = 'A' THEN 'Autorizada' ELSE '' END StatusNF,
	SSTATUS.DESCRICAO StatusMatricula,
	CASE WHEN FLAN.IDLAN IS NULL THEN 'SemGeração' ELSE 'Gerado' END StatusGeracao,
    CASE WHEN FLAN.STATUSLAN  = 0 THEN 'Aberto' 
         WHEN FLAN.STATUSLAN  = 1 THEN 'Baixado' else 'Outros/Cancelado' end as StatusBaixa,
    CASE WHEN SCONTRATO.CODTIPOCURSO = 1 THEN 'Graduação'
         WHEN SCONTRATO.CODTIPOCURSO = 2 THEN 'Pós-Graduação'
         WHEN SCONTRATO.CODTIPOCURSO = 3 THEN 'Extensão' END TIPOCURSO
		
FROM SPARCELA (NOLOCK)
INNER JOIN SCONTRATO (NOLOCK) ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.STATUS = 'N'
LEFT JOIN SLAN (NOLOCK) ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
LEFT JOIN FLAN (NOLOCK) ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
LEFT JOIN SLANMOV (NOLOCK) ON SLAN.CODCOLIGADA = SLANMOV.CODCOLIGADA AND SLAN.IDLAN = SLANMOV.IDLAN
INNER JOIN SALUNO (NOLOCK) ON SPARCELA.CODCOLIGADA = SALUNO.CODCOLIGADA AND SPARCELA.RA = SALUNO.RA
INNER JOIN PPESSOA (NOLOCK)ON PPESSOA.CODIGO = SALUNO.CODPESSOA
LEFT JOIN TMOV (NOLOCK) ON TMOV.IDMOV = SLANMOV.IDMOV AND TMOV.CODCOLIGADA = SLANMOV.CODCOLIGADA
LEFT JOIN TNFEMUNICIPAL (NOLOCK) ON TNFEMUNICIPAL.CODCOLIGADA = TMOV.CODCOLIGADA AND TNFEMUNICIPAL.IDMOV = TMOV.IDMOV
LEFT JOIN SSERVICO (NOLOCK) ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
LEFT JOIN FLANBOLETO (NOLOCK) ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA 
INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SPLETIVO (NOLOCK) ON SMATRICPL.IDPERLET = SPLETIVO.IDPERLET 

WHERE SCONTRATO.CODFILIAL =:FILIAL
AND   MONTH(SPARCELA.DTVENCIMENTO) LIKE '%' + :MESOPCIONAL + '%'
AND   YEAR(SPARCELA.DTVENCIMENTO) =:ANO
AND   SPLETIVO.CODPERLET LIKE '%' + :PERIODOLETIVOOPCIONAL + '%'";3794;;;;26/10/2021;lilian.buzetti;1;1;1;1;;;;0;1999316f-e9c1-4726-9d16-039393c9da5d;0;;2551;mestre;28/07/2021;lilian.buzetti;26/10/2021;0
S;EDUGRA;Consultas Graduação;;0;;;;27/01/2021;lucas.ssantos;1;1;1;1;;;;0;5649cf64-ca45-4532-bd7e-c7e4887fed30;0;;-12456;lucas.ssantos;27/01/2021;lucas.ssantos;27/01/2021;0
S;EDUGRA.001;Consulta Aluno e Disciplina;"
SELECT 
SMATRICPL.RA,

PPESSOA.NOME,
CASE WHEN PPESSOA.SEXO = 'F' THEN 'feminino' 
	 WHEN PPESSOA.SEXO = 'M' THEN 'masculino' END SEXO,
PPESSOA.CARTIDENTIDADE RG,
PPESSOA.ORGEMISSORIDENT RG_ORGAO_EMISSOR,
PPESSOA.UFCARTIDENT RG_UF,
PPESSOA.DTNASCIMENTO NASCIMENTO,
PPESSOA.NATURALIDADE NATURALIDADE,
PPESSOA.ESTADONATAL ESTADO,
PPESSOA.CPF,

PCODNACAO.DESCRICAO NACIONALIDADE,

SCURSO.NOME CURSO,
SCURSO.HABILITACAO DESC_CURSO,
SHABILITACAOALUNO.DTINGRESSO,
SHABILITACAOALUNO.DTCOLACAOGRAU,
SHABILITACAOALUNO.DTEMISDIPLOMA,
SHABILITACAOALUNO.DTCONCLUSAOCURSO

FROM   SALUNO
       INNER JOIN PPESSOA
               ON PPESSOA.CODIGO = SALUNO.CODPESSOA
       INNER JOIN PCODNACAO
               ON PCODNACAO.CODCLIENTE = PPESSOA.NACIONALIDADE
       INNER JOIN SMATRICPL
               ON SMATRICPL.RA = SALUNO.RA
       INNER JOIN SHABILITACAOFILIAL
               ON SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
       INNER JOIN SCURSO
               ON SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
       INNER JOIN SHABILITACAOALUNO
               ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
              AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
              AND SHABILITACAOALUNO.RA = SMATRICPL.RA
               
          WHERE SALUNO.RA = '1'


";1374;;;;04/02/2021;mestre;1;1;1;1;;;;0;1fc796cf-7c0b-404a-b6c4-0a1b0e94156c;0;;-20985;lucas.ssantos;27/01/2021;mestre;04/02/2021;0
S;EDUHST0001A;HISTORICO ESCOLAR GRADUACAO;"/*
AUTOR: THIAGO RIBEIRO RODRIGUES
DATA CRIAÇÃO: 03/02/2022
----------------------------------------------------------------------------
NECESSIDADE: DEVIDO A VARIAS PARTICULARIDADES QUANTO A OPTATIVAS FOI CRIADO 
UMA STORAGE PROCEDURE 'SP_MONTAR_HISTORICO' QUE ESTÁ RESPOSAVEL POR EXECUTAR AS TRATATIVAS NECESSARIAS
E POPULAR A TABELA 'Z_HISTORICOFINAL'.
COMO PRECISAMOS DA MESMA TRATATIVA PARA O DIPLOMAX, DESSA FORMA SIMPLIFICAMOS A VIEW 'DX_V_HISTORICO' QUE
TRARÁ AS INFORMAÇÕES TAMBÉM BUSCANDO DA TABELA 'Z_HISTORICOFINAL'.

RESSALVA PARA EMISSÃO DE DIPLOMA: ANTES DE EFETUAR O PROCESSO DE DIPLOMAÇÃO DEVE SER EMITIDO O HISTÓRICO PARA QUE
A TABELA SEJA POPULADA.
*/

SELECT *
	FROM Z_HISTORICOFINAL (NOLOCK)
WHERE RA = :RA2
AND IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1";793;;;;07/02/2022;consultor1.totvs;1;1;1;1;;;;;7c27e7e8-a746-43b1-8766-0c13e52209db;;;-17322;mestre;24/08/2021;consultor1.totvs;07/02/2022;
S;EDUHST0001A.1;HISTORICO ESCOLAR ESPECIALIZAÇÃO;"/*
AUTOR: THIAGO RIBEIRO RODRIGUES
DATA CRIAÇÃO: 03/02/2022
----------------------------------------------------------------------------
NECESSIDADE: DEVIDO A VARIAS PARTICULARIDADES QUANTO A OPTATIVAS FOI CRIADO 
UMA STORAGE PROCEDURE 'SP_MONTAR_HISTORICO' QUE ESTÁ RESPOSAVEL POR EXECUTAR AS TRATATIVAS NECESSARIAS
E POPULAR A TABELA 'Z_HISTORICOFINAL'.
COMO PRECISAMOS DA MESMA TRATATIVA PARA O DIPLOMAX, DESSA FORMA SIMPLIFICAMOS A VIEW 'DX_V_HISTORICO' QUE
TRARÁ AS INFORMAÇÕES TAMBÉM BUSCANDO DA TABELA 'Z_HISTORICOFINAL'.

RESSALVA PARA EMISSÃO DE DIPLOMA: ANTES DE EFETUAR O PROCESSO DE DIPLOMAÇÃO DEVE SER EMITIDO O HISTÓRICO PARA QUE
A TABELA SEJA POPULADA.
*/

SELECT 
	CASE SDISCIPLINA.TIPOAULA WHEN 'T'
	THEN CASE WHEN Z_HISTORICOFINAL.NOTACONCEITUAL IS NOT NULL THEN Z_HISTORICOFINAL.NOTACONCEITUAL ELSE
	CAST(MEDIA AS varchar)
	END
	ELSE '--'
	END MEDIAT,

		CASE SDISCIPLINA.TIPOAULA WHEN 'P'
	THEN CASE WHEN Z_HISTORICOFINAL.NOTACONCEITUAL IS NOT NULL THEN Z_HISTORICOFINAL.NOTACONCEITUAL ELSE
	CAST(MEDIA AS varchar)
	END
	ELSE '--'
	END MEDIAP,

		CASE SDISCIPLINA.TIPOAULA WHEN 'T'
	THEN CAST(Z_HISTORICOFINAL.CH AS varchar)
	ELSE '--'
	END CHT,

		CASE SDISCIPLINA.TIPOAULA WHEN 'P'
	THEN CAST(Z_HISTORICOFINAL.CH AS varchar)
	ELSE '--'
	END CHP,
	
	
	CASE WHEN SHISTDISCOPTELETIVAS.CODCOLIGADA IS NOT NULL THEN 	
		ISNULL(CAST(CAST(((((SHISTDISCOPTELETIVAS.FALTAS / SHISTDISCOPTELETIVAS.CH)*100)-100)*-1) AS DECIMAL(10,2)) AS VARCHAR),'100.00') + ' %'  ELSE

		CASE WHEN SHISTDISCFAC.FALTAS IS NULL THEN 
	ISNULL(CAST(CAST(((((SHISTDISCCONCLUIDAS.FALTAS / SHISTDISCCONCLUIDAS.CH)*100)-100)*-1) AS DECIMAL(10,2)) AS VARCHAR),'100.00') + ' %' ELSE
	ISNULL(CAST(CAST(((((SHISTDISCFAC.FALTAS / SHISTDISCFAC.CARGAHORARIA)*100)-100)*-1) AS DECIMAL(10,2)) AS VARCHAR),'100.00') + ' %' END END FALTA,
	
	Z_HISTORICOFINAL.*
	FROM Z_HISTORICOFINAL (NOLOCK)
	INNER JOIN SDISCIPLINA ON SDISCIPLINA.CODCOLIGADA = Z_HISTORICOFINAL.CODCOLIGADA
		AND SDISCIPLINA.CODDISC = Z_HISTORICOFINAL.CODDISC
	LEFT JOIN SHISTDISCFAC ON SHISTDISCFAC.CODCOLIGADA = Z_HISTORICOFINAL.CODCOLIGADA
		AND SHISTDISCFAC.IDHABILITACAOFILIAL = Z_HISTORICOFINAL.IDHABILITACAOFILIAL
		AND SHISTDISCFAC.RA = Z_HISTORICOFINAL.RA
		AND SHISTDISCFAC.CODDISC = Z_HISTORICOFINAL.CODDISC
		AND SHISTDISCFAC.IDPERLET = Z_HISTORICOFINAL.IDPERLET
	LEFT JOIN SHISTDISCCONCLUIDAS ON SHISTDISCCONCLUIDAS.CODCOLIGADA = Z_HISTORICOFINAL.CODCOLIGADA
		AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = Z_HISTORICOFINAL.IDHABILITACAOFILIAL
		AND SHISTDISCCONCLUIDAS.RA = Z_HISTORICOFINAL.RA
		AND SHISTDISCCONCLUIDAS.CODDISC = Z_HISTORICOFINAL.CODDISC
		AND SHISTDISCCONCLUIDAS.IDPERLET = Z_HISTORICOFINAL.IDPERLET
	LEFT JOIN SHISTDISCOPTELETIVAS ON SHISTDISCOPTELETIVAS.CODCOLIGADA = Z_HISTORICOFINAL.CODCOLIGADA
		AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = Z_HISTORICOFINAL.IDHABILITACAOFILIAL
		AND SHISTDISCOPTELETIVAS.RA = Z_HISTORICOFINAL.RA
		AND SHISTDISCOPTELETIVAS.CODDISC = Z_HISTORICOFINAL.CODDISC
		AND SHISTDISCOPTELETIVAS.IDPERLET = Z_HISTORICOFINAL.IDPERLET
WHERE Z_HISTORICOFINAL.RA = :RA2
AND Z_HISTORICOFINAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1";3203;;;;23/06/2022;consultor1.totvs;1;1;1;1;;;;0;075fe85a-bab0-4131-9065-9518d464fd5a;0;;6223;consultor1.totvs;22/03/2022;consultor1.totvs;23/06/2022;0
S;EDUHST0001B;HISTORICO ESCOLAR GRADUACAO;"
SELECT DISTINCT  
SHABILITACAOALUNO.RA,
SHABILITACAOALUNO.CODCOLIGADA,
SHABILITACAOALUNO.IDHABILITACAOFILIAL,
SHABILITACAOFILIAL.CODFILIAL,
SCURSO.CODCURSO,
SMODALIDADECURSO.DESCRICAO + ' em ' + SHABILITACAO.NOME NOMECURSO,
/*CASE WHEN SMODALIDADECURSO.DESCRICAO = 'Pós-Graduação Lato Sensu' THEN + 'Curso de Especialização em ' + SHABILITACAO.NOME
	 ELSE SMODALIDADECURSO.DESCRICAO + ' em ' + SHABILITACAO.NOME END AS NOMECURSO,*/
SHABILITACAO.CODHABILITACAO,
SHABILITACAO.NOME NOMEHABILITACAO,
SGRADE.CODGRADE,
SGRADE.DESCRICAO DESCGRADE,
STURNO.NOME NOMETURNO,
STURNO.TIPO TIPOTURNO,
PPESSOA.NOME NOMEALUNO,
PPESSOA.CODUSUARIO,
PPESSOA.EMAIL,
PPESSOA.DTNASCIMENTO,
/*SMATRICPL.DTSOLICITACAOALTERACAO,*/
CAST((SELECT TOP 1 (OBSENADE) FROM SMATRICPL M WHERE M.RA = SMATRICPL.RA AND M.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND OBSENADE IS NOT NULL ORDER BY CONVERT(VARCHAR,OBSENADE) DESC ) AS VARCHAR(240)) OBSENADE,
STURNO.CODTURNO,
/*(SELECT DESCRICAO FROM PCODNACAO WHERE CODCLIENTE = PPESSOA.NACIONALIDADE) NACIONALIDADE,*/
/**/
(SELECT 
CASE WHEN PPESSOA.SEXO = 'F' THEN ISNULL(ZMDNACIONALIDADE.NOMEFEMININO,DESCRICAO)
	WHEN PPESSOA.SEXO = 'M' THEN ISNULL(ZMDNACIONALIDADE.NOMEMASCULINO,DESCRICAO)
	ELSE DESCRICAO END FROM PCODNACAO 
	LEFT JOIN ZMDNACIONALIDADE ON ZMDNACIONALIDADE.CODNACAO = PCODNACAO.CODCLIENTE

	WHERE CODCLIENTE = PPESSOA.NACIONALIDADE) NACIONALIDADE,
SUBSTRING(PPESSOA.CPF,1,3) + '.' + SUBSTRING(PPESSOA.CPF,4,3) + '.' + SUBSTRING(PPESSOA.CPF,7,3) + '-' + SUBSTRING(PPESSOA.CPF,10,2) CPF,
CASE
	WHEN PPESSOA.CARTIDENTIDADE IS NOT NULL THEN PPESSOA.CARTIDENTIDADE
	WHEN PPESSOA.NROREGGERAL IS NOT NULL THEN PPESSOA.NROREGGERAL
	WHEN SALUNOCOMPL.DOCESTRANGEIRO IS NOT NULL THEN SALUNOCOMPL.DOCESTRANGEIRO    
END CARTIDENTIDADE,
CASE
	WHEN PPESSOA.CARTIDENTIDADE IS NOT NULL THEN PPESSOA.UFCARTIDENT
	WHEN PPESSOA.NROREGGERAL IS NOT NULL THEN PPESSOA.ORGEMISSORRNE
	WHEN SALUNOCOMPL.DOCESTRANGEIRO IS NOT NULL THEN ''    
END UFCARTIDENT,
CASE
	WHEN PPESSOA.CARTIDENTIDADE IS NOT NULL THEN ' - ' + PPESSOA.ORGEMISSORIDENT
	WHEN PPESSOA.NROREGGERAL IS NOT NULL THEN ' - ' + PPESSOA.NRODECRETO
	WHEN SALUNOCOMPL.DOCESTRANGEIRO IS NOT NULL THEN ''    
END ORGEMISSORIDENT,

CASE
	WHEN PPESSOA.CARTIDENTIDADE IS NOT NULL THEN 'RG e Orgão Emissor'
	WHEN PPESSOA.NROREGGERAL IS NOT NULL THEN 'RNM/RNE e Orgão Emissor'
	WHEN SALUNOCOMPL.DOCESTRANGEIRO IS NOT NULL THEN SALUNOCOMPL.SIGLAESTRANGEIRO + ' e Orgão Emissor'  
END TIPDOC,

CASE WHEN GPAIS.DESCRICAO <> 'Brasil' THEN GETD.NOME ELSE
CASE WHEN ISNULL(REPLACE(PPESSOA.ESTADONATAL,'--',''),'') = '' THEN PPESSOA.NATURALIDADE
ELSE PPESSOA.NATURALIDADE + ' /' END END AS 'NATURALIDADE', 
/*MODIFICADO EM 24/05/2022 NATHAN PVT*/
CASE WHEN GPAIS.DESCRICAO <> 'Brasil' THEN GPAIS.DESCRICAO ELSE
REPLACE(PPESSOA.ESTADONATAL,'--','') END AS 'ESTADONATAL',

/*REPLACE(PPESSOA.ESTADONATAL,'--','') AS 'ESTADONATAL',*/
'Curso de ' + SCURSOMEC.DESCURSOMEC AS 'DESCURSOMEC',
SCURSOMEC.CODINEPCURSO,
GFILIAL.CIDADE,

GETDATE() HOJE,
/*'2022-07-25 09:25:06.050' HOJE,*/

CASE WHEN :DATA LIKE 'HOJE' THEN CONVERT(VARCHAR,GETDATE(),103) 
	ELSE :DATA END AS DATA2,

/*CASE Modificado em 22/08/2022 Nathan PVT - Comentado a parte de pegar a informação de outro lugar sem ser o campo complementar, Dalila informou que já acertou todos os cursos.
	WHEN SCURSO.CODCURSO NOT IN('EC-BCOSO','EC-LLPOR','EC-LLING') THEN SCURSOCOMPL.AUTORIZACAO
	ELSE (SELECT TOP 1 'Reconhecimento Renovado pela Portaria nº ' + CONVERT(varchar, ISNULL(PORTRECONHECIMENTO,'FALTA INFORMAÇÃO')) + ' de ' + 
				CONVERT(varchar,isnull(DTRECONHECIMENTO,'FALTA INFORMAÇÃO'),103) + ', publicada no DOU nº ' + CONVERT(varchar, ISNULL(NUMPUBLICACAO,'FALTA INFORMAÇÃO')) + ' de ' +
				CONVERT(varchar,isnull(DTDOURECONHECIMENTO,'FALTA INFORMAÇÃO'),103) + ' Seção ' + CONVERT(varchar, ISNULL(SECAOPUBLICACAO,'FALTA INFORMAÇÃO')) + ', Pg. ' + 
				CONVERT(varchar, ISNULL(PAGINAPUBLICACAO,'FALTA INFORMAÇÃO')) + '.'
					FROM SAUTORIZACAOCURSO
				WHERE IDHABILITACAOFILIAL = shabilitacaofilial.idhabilitacaofilial
				AND ULTIMAAUTORIZACAOVALIDA = 'S'
				ORDER BY CODAUTORIZACURSO DESC )
END */
/*SCURSOCOMPL.AUTORIZACAO AS AUTORIZACAO,
Modificado em 15/09/2022 Nathan PVT - Mudado a informação da autorização pegando dos campos da Matriz conforme solicitado. Dalila e Flávio.*/
CASE
	WHEN :$CODTIPOCURSO = 2 THEN SHABILITACAOFILIAL.DECRETOHABILITACAO + ' - ' + SHABILITACAOFILIAL.DECRETOCURSO
	ELSE SCURSOCOMPL.AUTORIZACAO END AS AUTORIZACAO,
(select top 1 cast(sautorizacaofilial.recautoriz as varchar(8000)) 
   from sautorizacaofilial 
  where sautorizacaofilial.codcoligada = shabilitacaofilial.codcoligada 
    and sautorizacaofilial.codfilial = shabilitacaofilial.codfilial
    and IDINSTITUICAOMEC is not null
    AND ULTIMAAUTORIZACAOVALIDA = 'S'
  order by sautorizacaofilial.codautorizacao desc) RECAUTORIZ,
/*'Centro Universitário Adventista de ' + GFILIAL.CIDADE + ' - Cód. e-MEC 1365' CIDADEFILIAL*/
'Centro Universitário Adventista de São Paulo - Cód. e-MEC 1365' CIDADEFILIAL,
ISNULL(CONVERT(VARCHAR, SHABILITACAOALUNO.DTPROCESSOSELETIVO, 103), '-----') DTPROCESSOSELETIVO,
ISNULL(CONVERT(VARCHAR, SHABILITACAOALUNO.DTCONCLUSAOCURSO, 103), '-----') DTCONCLUSAOCURSO,
ISNULL(CONVERT(VARCHAR, SHABILITACAOALUNO.DTCOLACAOGRAU, 103), '-----') DTCOLACAOGRAU,
SHABILITACAOALUNO.CLASSIFICACAOVESTIBULAR,
ISNULL(CONVERT(VARCHAR, SHABILITACAOALUNO.DTINGRESSO, 103), '-----') DTINGRESSO,
ISNULL(CONVERT(VARCHAR, SHABILITACAOALUNO.DTREGISTRODIPLOMA, 103), '-----') DTREGISTRODIPLOMA
,
CAST (SHABILITACAOALUNO.OBSERVACAO AS VARCHAR (2000)) AS OBS,

(SELECT TOP 1 C.NOME FROM SCOORDENADOR (NOLOCK) 
INNER JOIN PPESSOA C (NOLOCK)  ON 
C.CODIGO = SCOORDENADOR.CODPESSOA
LEFT JOIN PCODINSTRUCAO (NOLOCK) ON 
C.GRAUINSTRUCAO = PCODINSTRUCAO.CODINTERNO
WHERE 	SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
		SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
		SCOORDENADOR.FUNCAO = 'C' )COORDENADOR,

(SELECT TOP 1 PCODINSTRUCAO.DESCRICAO FROM SCOORDENADOR (NOLOCK) 
INNER JOIN PPESSOA C (NOLOCK)  ON 
C.CODIGO = SCOORDENADOR.CODPESSOA
LEFT JOIN PCODINSTRUCAO (NOLOCK) ON 
C.GRAUINSTRUCAO = PCODINSTRUCAO.CODINTERNO
WHERE 	SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
		SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
		SCOORDENADOR.FUNCAO = 'C' ) GRAUINST,

STIPOINGRESSO.DESCRICAO TIPOINGRESSO,
CASE
	WHEN :$CODTIPOCURSO = 1 AND STIPOINGRESSO.DESCRICAO LIKE '%Seletivo%' THEN ': Centro Universitário Adventista de São Paulo' 
	WHEN :$CODTIPOCURSO = 1 AND STIPOINGRESSO.DESCRICAO LIKE '%Diploma%' THEN  ': Centro Universitário Adventista de São Paulo' 
	ELSE ''
END INSTING,

SHABILITACAOALUNO.DTEMISDIPLOMA EMISSAODIPLOMA,
CASE WHEN SINSTITUICAO.NOME IS NOT NULL THEN SINSTITUICAO.NOME ELSE SHABILITACAOALUNOCOMPL.INSTORIGEM END INSTORIGEM,
case when isnull(en.IDPAIS,1)=1 then concat(PPESSOA.NATURALIDADE,' - ',PPESSOA.ESTADONATAL) else en.NOME end NaturalDe

FROM SHABILITACAOALUNO (NOLOCK)
LEFT JOIN SINSTITUICAO ON SINSTITUICAO.CODINST = SHABILITACAOALUNO.CODINST
INNER JOIN SHABILITACAOALUNOCOMPL (NOLOCK)
	ON SHABILITACAOALUNOCOMPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOALUNOCOMPL.RA = SHABILITACAOALUNO.RA
	AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
/*INNER JOIN SAUTORIZACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SAUTORIZACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODFILIAL = SAUTORIZACAOFILIAL.CODFILIAL*/

LEFT JOIN SMATRICPL (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
INNER JOIN SCURSO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	
LEFT JOIN SMODALIDADECURSO (NOLOCK) 
      ON (SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA AND 
	      SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO)
	      
INNER JOIN SCURSOCOMPL (NOLOCK)
	ON SCURSO.CODCOLIGADA = SCURSOCOMPL.CODCOLIGADA
	AND SCURSO.CODCURSO = SCURSOCOMPL.CODCURSO
INNER JOIN SHABILITACAO (NOLOCK)
	ON SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SCURSO.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAO.CODCURSO
INNER JOIN SGRADE (NOLOCK)
	ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN STURNO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
LEFT JOIN SSTATUS (NOLOCK)
	ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
LEFT JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO (NOLOCK)
	ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
LEFT JOIN SALUNOCOMPL (NOLOCK)
	ON SALUNOCOMPL.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SALUNOCOMPL.RA = SALUNO.RA
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	
	
LEFT JOIN GETD ON GETD.CODETD = .PPESSOA.ESTADONATAL
LEFT JOIN GPAIS ON GPAIS.IDPAIS = GETD.IDPAIS

LEFT JOIN SSTATUS SSTATUSRES (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SSTATUSRES.CODCOLIGADA
	AND SMATRICPL.CODSTATUSRES = SSTATUSRES.CODSTATUS
LEFT JOIN SMATRICPLITEMCNT (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SMATRICPLITEMCNT.CODCOLIGADA 
	AND SMATRICPL.IDPERLET = SMATRICPLITEMCNT.IDPERLET
	AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICPLITEMCNT.IDHABILITACAOFILIAL
	AND SMATRICPL.RA = SMATRICPLITEMCNT.RA
LEFT JOIN STIPOMATRICULA (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = STIPOMATRICULA.CODCOLIGADA
	AND SMATRICPL.CODTIPOMAT = STIPOMATRICULA.CODTIPOMAT
LEFT JOIN SCURSOMEC (NOLOCK)
    ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
    AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
LEFT JOIN GFILIAL (NOLOCK)
    ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
    AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
	
LEFT JOIN STIPOINGRESSO (NOLOCK)	ON STIPOINGRESSO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND
									   STIPOINGRESSO.CODTIPOINGRESSO = SHABILITACAOALUNO.CODTIPOINGRESSO 

left join GETD en on en.CODETD = PPESSOA.ESTADONATAL

WHERE SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA1
AND SHABILITACAOALUNO.RA = :RA2
AND SHABILITACAOALUNO.IDHABILITACAOFILIAL LIKE :IDHABILITACAOFILIAL1";11057;;;;28/09/2022;consultor1.totvs;1;1;1;1;;;;;7c27e7e8-a746-43b1-8766-0c13e52209db;;;-13498;mestre;24/08/2021;consultor1.totvs;28/09/2022;
S;EDUHST0001C;HISTORICO ESCOLAR GRADUACAO - COMPONENTE;"SELECT 
DISTINCT

'Outros Componentes Curriculares' Tipo,
SCOMPONENTE.DESCRICAO,
/*SMODALIDADE.DESCRICAO AS 'MODALIDADE',*/
SUM(SATIVIDADEALUNO.CARGAHORARIAATV) CH

FROM SATIVIDADEALUNO (NOLOCK)
/*INNER JOIN SMODALIDADE ON SMODALIDADE.CODCOLIGADA = SATIVIDADEALUNO.CODCOLIGADA AND SMODALIDADE.CODCOMPONENTE = SATIVIDADEALUNO.CODCOMPONENTE AND SMODALIDADE.CODMODALIDADE = SATIVIDADEALUNO.CODMODALIDADE*/
INNER JOIN SHABILITACAOFILIAL  (NOLOCK) ON SATIVIDADEALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
LEFT JOIN SCOMPONENTECURRICULAR(NOLOCK) ON SCOMPONENTECURRICULAR.CODCOLIGADA = SATIVIDADEALUNO.CODCOLIGADA AND SCOMPONENTECURRICULAR.IDHABILITACAOFILIAL = SATIVIDADEALUNO.IDHABILITACAOFILIAL AND SCOMPONENTECURRICULAR.CODCOMPONENTE = SATIVIDADEALUNO.CODCOMPONENTE
LEFT JOIN SCOMPONENTE (NOLOCK)          ON SCOMPONENTE.CODCOLIGADA = SCOMPONENTECURRICULAR.CODCOLIGADA AND SCOMPONENTE.CODCOMPONENTE = SCOMPONENTECURRICULAR.CODCOMPONENTE
WHERE SHABILITACAOFILIAL.CODCOLIGADA = :CODCOLIGADA1
AND SATIVIDADEALUNO.RA = :RA2 
AND SATIVIDADEALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
AND SATIVIDADEALUNO.CODMODALIDADE IS NOT NULL
GROUP BY SCOMPONENTE.DESCRICAO/*, SMODALIDADE.DESCRICAO*/



";1233;;;;20/09/2022;consultor1.totvs;1;1;1;1;;;;0;f1f9549e-161b-4a7a-8cd6-fcc3c201042e;0;;28152;lilian.buzetti;28/09/2021;consultor1.totvs;20/09/2022;0
S;EDUHST0001D;HISTÓRICO PARCIAL;"SELECT 
CASE WHEN DESCRICAO LIKE '%CURSANDO%' THEN ''
	ELSE NOTA
	END NOTAFIN,
* FROM 
( 

SELECT SHISTDISCPENDENTES.CODCOLIGADA,
	   SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
	   NULL IDTURMADISC,
	   NULL CODETAPA,
	   NULL TIPOETAPA,
	   SHISTDISCPENDENTES.NOTA MEDIA,
	   NULL ETAPA,
	   NULL PONTDIST,
	   NULL NOMEREDUZIDO,
	   SHISTDISCPENDENTES.CODDISC,
	   NULL CODTURMA,
	   SHISTDISCPENDENTES.DISCIPLINA,
	   CASE 
		   WHEN SHISTDISCPENDENTES.STATUS IS NULL AND ISNULL(SHISTDISCPENDENTES.STATUS,'') NOT LIKE '%Reprovado%' THEN 'A Cursar'
		   WHEN ISNULL(SHISTDISCPENDENTES.STATUS,'') NOT LIKE '%Reprovado%' THEN 'A Cursar'
		   ELSE SHISTDISCPENDENTES.STATUS		   
	   END DESCRICAO,
	   REPLACE(CONVERT(VARCHAR, CONVERT(DECIMAL(10,1),SHISTDISCPENDENTES.NOTA)),'.',',')  NOTA,
	   NULL NOTACONCEITUAL,
	   NULL CONCEITOECTS,
	   NULL DESCRESULT,
	   NULL ETAPAFINAL,
	   NULL IDPERLET,
	   SHISTDISCPENDENTES.RA,
	   NULL NOTAFALTA,
	   CONVERT(INT, SHISTDISCPENDENTES.CH) CH,
	   CONVERT(INT, SHISTDISCPENDENTES.NUMCREDITOS) NUMCREDITOS, 
	   NULL DTMATRICULA,
	   NULL CODPROF,
	   NULL VALORCREDITO,
	   NULL NOMEPROFESSOR,
	   NULL TITULACAO,
	   NULL NUMCREDITOCOB,
	   SHISTDISCPENDENTES.PLETIVO CODPERLET,
	   NULL PERIODOLETIVO,
	   NULL DTINICIO,
	   NULL TITULO,
	   1 CONTA,
	   SUBSTRING (SHISTDISCPENDENTES.PLETIVO ,1,4) ANO,
	   SPERIODO.DESCRICAO PERIODO,
	   SPERIODO.CODPERIODO CODPERIODO	   
	FROM SHISTDISCPENDENTES
		INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON
			SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL
	    INNER JOIN SHABILITACAO 
			ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
			AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
			AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO					
		INNER JOIN SDISCGRADE 
			ON SDISCGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
			AND SDISCGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
			AND SDISCGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO 
			AND SDISCGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE 
			AND SDISCGRADE.CODDISC = SHISTDISCPENDENTES.CODDISC		
		INNER JOIN SPERIODO 
			ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA 
			AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO 
			AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO 
			AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE 
			AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
			AND SPERIODO.CODPERIODO <> 0	
WHERE RA = :RA2
AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
AND SHISTDISCPENDENTES.CODDISC NOT IN ( SELECT CODDISC FROM SDISCGRADE WHERE SDISCGRADE.DISCIPLINATCC = 'S' )
AND SHISTDISCPENDENTES.CODDISC NOT IN ( SELECT CODDISC 
											FROM STURMADISC
												INNER JOIN SMATRICULA (NOLOCK) ON
													SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
													AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
										WHERE SMATRICULA.RA = SHISTDISCPENDENTES.RA
										AND SMATRICULA.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL )
AND SHISTDISCPENDENTES.CODDISC NOT IN (SELECT CODDISC
											FROM SHISTDISCCONCLUIDAS
										WHERE SHISTDISCCONCLUIDAS.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
										AND SHISTDISCCONCLUIDAS.RA = SHISTDISCPENDENTES.RA 
										AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL)
AND SHISTDISCPENDENTES.CODDISC NOT IN (SELECT CODDISC
											FROM SHISTDISCEQUIVCONCLUIDAS
										WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
										AND SHISTDISCEQUIVCONCLUIDAS.RA = SHISTDISCPENDENTES.RA 
										AND SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL)										
										
AND SHISTDISCPENDENTES.CODDISC NOT IN ( SELECT CODDISC FROM OPTATIVAS_ORGANIZADAS(:RA2,:IDHABILITACAOFILIAL1))
AND SHISTDISCPENDENTES.CODDISC NOT IN (SELECT CODDISC FROM SHISTDISCOPTELETIVAS WHERE RA = :RA2 AND IDHABILITACAOFILIAL= :IDHABILITACAOFILIAL1)			
AND SHISTDISCPENDENTES.CODDISC NOT IN (SELECT CODDISC 
											FROM SHISTDISCFAC
									   WHERE SHISTDISCFAC.CODCOLIGADA = SHISTDISCPENDENTES.CODCOLIGADA
									   AND SHISTDISCFAC.RA = SHISTDISCPENDENTES.RA
									   AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHISTDISCPENDENTES.IDHABILITACAOFILIAL)							


UNION

SELECT
DISTINCT 
STURMADISC.CODCOLIGADA, 
STURMADISC.IDHABILITACAOFILIAL,
SMATRICULA.IDTURMADISC,
SETAPAS.CODETAPA, 
SETAPAS.TIPOETAPA, 
SETAPAS.MEDIA,
SETAPAS.DESCRICAO ETAPA, 
SETAPAS.PONTDIST,
CASE WHEN SETAPAS.NOMEREDUZIDO IS NULL THEN SETAPAS.DESCRICAO ELSE SETAPAS.NOMEREDUZIDO END NOMEREDUZIDO,
STURMADISC.CODDISC, 
STURMADISC.CODTURMA, 
SDISCIPLINA.NOME DISCIPLINA, 
SSTATUS.DESCRICAO, 
REPLACE(CONVERT(VARCHAR, CONVERT(DECIMAL(10,1),SNOTAETAPA.NOTAFALTA)),'.',',')  NOTA, 
SNOTAETAPA.CODCONCEITO NOTACONCEITUAL,
SNOTAETAPA.CONCEITOECTS,
(SELECT RES.DESCRICAO FROM SSTATUS RES(NOLOCK) WHERE  SMATRICULA.CODCOLIGADA = RES.CODCOLIGADA AND SMATRICULA.CODSTATUSRES = RES.CODSTATUS)  DESCRESULT,
SETAPAS.ETAPAFINAL, 
STURMADISC.IDPERLET, 
SMATRICULA.RA, 
SNOTAETAPA.NOTAFALTA, 
CONVERT(INT, SDISCIPLINA.CH) CH, 
CONVERT(INT, SDISCIPLINA.NUMCREDITOS) NUMCREDITOS, 
SMATRICULA.DTMATRICULA,
SPROFESSORTURMA.CODPROF,
STURMADISC.VALORCREDITO,
PPESSOA.NOME NOMEPROFESSOR,
STITULACAO.NOME TITULACAO,
SMATRICULA.NUMCREDITOSCOB,
SPLETIVO.CODPERLET,
SPLETIVO.DESCRICAO PERIODOLETIVO,
SPLETIVO.DTINICIO,
PCODINSTRUCAO.DESCRICAO TITULO,
1 CONTA,
SUBSTRING (SPLETIVO.CODPERLET ,1,4) ANO,
CASE WHEN SPERIODO.DESCRICAO IS NULL THEN PMAT.DESCRICAO 
     WHEN SPERIODO.CODPERIODO = 0 AND OPTATIVAS.CODDISC IS NULL THEN 'Enriquecimento Curricular' 
	 WHEN SPERIODO.CODPERIODO = 0 AND OPTATIVAS.CODDISC IS NOT NULL THEN OPTATIVAS.DESCRICAO
	 ELSE SPERIODO.DESCRICAO 
END AS  PERIODO,
CASE WHEN SPERIODO.CODPERIODO IS NULL THEN PMAT.CODPERIODO 
     WHEN SPERIODO.CODPERIODO = 0 AND OPTATIVAS.CODDISC IS NULL THEN 99 
	 WHEN SPERIODO.CODPERIODO = 0 AND OPTATIVAS.CODDISC IS NOT NULL THEN OPTATIVAS.CODPERIODO
	 ELSE SPERIODO.CODPERIODO 
END AS  CODPERIODO


FROM STURMADISC (NOLOCK)
INNER JOIN SDISCIPLINA (NOLOCK)
	ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA 
	AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC 
	AND STURMADISC.CODTIPOCURSO = SDISCIPLINA.CODTIPOCURSO
INNER JOIN GFILIAL (NOlOCK)
	ON STURMADISC.CODCOLIGADA = GFILIAL.CODCOLIGADA 
	AND STURMADISC.CODFILIAL = GFILIAL.CODFILIAL
INNER JOIN SMATRICULA (NOLOCK)
    ON STURMADISC.CODCOLIGADA  = SMATRICULA.CODCOLIGADA 
	AND STURMADISC.IDTURMADISC  = SMATRICULA.IDTURMADISC
INNER JOIN SMATRICPL 
	ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA 
	AND SMATRICPL.RA = SMATRICULA.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
	AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
INNER JOIN SSTATUS (NOLOCK)
	ON SMATRICULA.CODCOLIGADA = SSTATUS.CODCOLIGADA 
	AND SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SMATRICULA.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SETAPAS (NOLOCK) 
    ON STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA 
	AND STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC
LEFT JOIN SNOTAETAPA (NOLOCK) 
    ON (SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA 
	AND SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA 
	AND SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA
	AND SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC 
	AND SMATRICULA.RA = SNOTAETAPA.RA)                    
LEFT JOIN SPROFESSORTURMA (NOLOCK)
	ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
	AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
	AND SPROFESSORTURMA.TIPOPROF = 'T'
LEFT JOIN SPROFESSOR (NOLOCK)
	ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
	AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
LEFT JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
LEFT JOIN PCODINSTRUCAO (NOLOCK)
    ON PCODINSTRUCAO.CODCLIENTE = PPESSOA.GRAUINSTRUCAO
LEFT JOIN STITULACAO  (NOLOCK)
	ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO            
INNER JOIN SPLETIVO  (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
	AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
LEFT JOIN SDISCGRADE 
	ON SDISCGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND SDISCGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
	AND SDISCGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO 
	AND SDISCGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE 
	AND SDISCGRADE.CODDISC = SDISCIPLINA.CODDISC
LEFT JOIN SPERIODO 
	ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA 
	AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO 
	AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO 
	AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE 
	AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
LEFT JOIN SPERIODO PMAT
	ON PMAT.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
	AND PMAT.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
	AND PMAT.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO 
	AND PMAT.CODGRADE = SHABILITACAOFILIAL.CODGRADE 
	AND PMAT.CODPERIODO = SMATRICPL.PERIODO
	AND SPERIODO.CODPERIODO = 0
OUTER APPLY (SELECT GRUPO.CODPERIODO,SPERIODO.DESCRICAO,DISCGRUPO.CODDISC
					FROM SGRUPOOPTELET GRUPO
						INNER JOIN SDISCGRUPOOPTELET DISCGRUPO ON
							DISCGRUPO.CODCOLIGADA = GRUPO.CODCOLIGADA
							AND DISCGRUPO.CODCURSO = GRUPO.CODCURSO
							AND DISCGRUPO.CODGRADE = GRUPO.CODGRADE
							AND DISCGRUPO.CODHABILITACAO = GRUPO.CODHABILITACAO
							AND DISCGRUPO.IDGRUPO = GRUPO.IDGRUPO
						INNER JOIN SPERIODO ON
							SPERIODO.CODCOLIGADA = GRUPO.CODCOLIGADA
							AND SPERIODO.CODCURSO = GRUPO.CODCURSO
							AND SPERIODO.CODGRADE = GRUPO.CODGRADE
							AND SPERIODO.CODHABILITACAO = GRUPO.CODHABILITACAO
							AND SPERIODO.CODPERIODO = GRUPO.CODPERIODO
				WHERE GRUPO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
				AND GRUPO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
				AND GRUPO.CODGRADE = SHABILITACAOFILIAL.CODGRADE
				AND GRUPO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
				AND DISCGRUPO.CODDISC = STURMADISC.CODDISC )OPTATIVAS
WHERE SMATRICULA.CODCOLIGADA = :CODCOLIGADA1
AND SMATRICULA.RA = :RA2
AND (SSTATUS.DESCRICAO LIKE 'CURSANDO%' OR SSTATUS.DESCRICAO LIKE 'REPROVA%')
AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
AND SETAPAS.TIPOETAPA = 'N'
/*AND NOT(SETAPAS.MEDIA IS NULL)*/
AND SETAPAS.CODETAPA = 2
AND SDISCIPLINA.NOME NOT LIKE 'ACERTOS FINANCEIROS'
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM SDISCGRADE WHERE SDISCGRADE.DISCIPLINATCC = 'S' )
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC
									FROM SHISTDISCCONCLUIDAS
								WHERE SHISTDISCCONCLUIDAS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
								AND SHISTDISCCONCLUIDAS.RA = SMATRICPL.RA 
								AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL)
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC
									FROM SHISTDISCEQUIVCONCLUIDAS
								WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
								AND SHISTDISCEQUIVCONCLUIDAS.RA = SMATRICPL.RA 
								AND SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL)


UNION 

SELECT 
DISTINCT 
SHISTDISCCONCLUIDAS.CODCOLIGADA, 
SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
SHISTDISCCONCLUIDAS.IDTURMADISC,
NULL CODETAPA, 
NULL TIPOETAPA, 
CASE 
	WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SHISTDISCEQUIVCONCLUIDAS.NOTA
	ELSE SHISTDISCCONCLUIDAS.NOTA 
END MEDIA,
NULL ETAPA, 
NULL PONTDIST,
NULL NOMEREDUZIDO,
SDISCIPLINA.CODDISC, 
NULL CODTURMA, 
SDISCIPLINA.NOME DISCIPLINA, 
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SHISTDISCEQUIVCONCLUIDAS.STATUS
	 ELSE SSTATUS.DESCRICAO
END DESCRICAO,
CASE 
	WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SHISTDISCCONCLUIDAS.CONCEITO IS NULL THEN REPLACE(CONVERT(VARCHAR, CONVERT(DECIMAL(10,1),SHISTDISCEQUIVCONCLUIDAS.NOTA)),'.',',')
	WHEN SHISTDISCCONCLUIDAS.STATUS != '*Equiv.' AND SHISTDISCCONCLUIDAS.CONCEITO IS NULL THEN REPLACE(CONVERT(VARCHAR, CONVERT(DECIMAL(10,1),SHISTDISCCONCLUIDAS.NOTA)),'.',',')
	ELSE SHISTDISCCONCLUIDAS.CONCEITO
END NOTA,
SHISTDISCCONCLUIDAS.CONCEITO NOTACONCEITUAL,
NULL CONCEITOECTS,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SHISTDISCEQUIVCONCLUIDAS.STATUS
	 ELSE SSTATUS.DESCRICAO
END DESCRESULT,
NULL ETAPAFINAL,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SHISTDISCEQUIVCONCLUIDAS.IDPERLET
	 ELSE SHISTDISCCONCLUIDAS.IDPERLET
END IDPERLET,
SHISTDISCCONCLUIDAS.RA, 
CASE 
	WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SHISTDISCEQUIVCONCLUIDAS.NOTA
	ELSE SHISTDISCCONCLUIDAS.NOTA 
END NOTAFALTA, 

/*CONVERT(INT, SDISCIPLINA.CH) CH, 
MODIFICADO EM 31/05/2022 NATHAN - AJUSTADO*/
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND YEAR(SPLETIVO_EQUIV.DTFIM) <= '2021' THEN
	 CONVERT(INT, SHISTDISCEQUIVCONCLUIDAS.CH) ELSE CONVERT(INT, SDISCIPLINA.CH)
	 END CH,
/*
CASE 
	WHEN SDISCIPLINA.NOME LIKE 'Estágio%' THEN ''
	ELSE CONVERT(varchar,CONVERT(INT, SDISCIPLINA.NUMCREDITOS)) 
END NUMCREDITOS,*/

CASE 
	WHEN SDISCIPLINA.NOME LIKE 'Estágio%' THEN ''
	ELSE CASE WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND YEAR(SPLETIVO_EQUIV.DTFIM) <= '2021' THEN
	CONVERT(varchar,CONVERT(INT, SHISTDISCEQUIVCONCLUIDAS.NUMCREDITOS)) ELSE CONVERT(varchar,CONVERT(INT, SDISCIPLINA.NUMCREDITOS)) 
END END NUMCREDITOS,

NULL DTMATRICULA,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SPROFESSOREQUIV.CODPROF IS NOT NULL THEN SPROFESSOREQUIV.CODPROF
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SPROFESSOREQUIV.CODPROF IS NULL THEN SPROFESSOREQUIV0.CODPROF
	 WHEN SPROFESSOREQUIV.CODPROF IS NULL AND SPROFESSOREQUIV0.CODPROF IS NULL AND SPROFESSORT.CODPROF IS NOT NULL THEN SPROFESSORT.CODPROF
	 ELSE SPROFESSOR.CODPROF
END CODPROF,
SHISTDISCCONCLUIDAS.NUMCREDITOS VALORCREDITO,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SPROFESSOREQUIV.CODPROF IS NOT NULL THEN PPESSOAEQUIV.NOME
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SPROFESSOREQUIV.CODPROF IS NULL THEN PPESSOAEQUIV0.NOME
	 WHEN SPROFESSOREQUIV.CODPROF IS NULL AND SPROFESSOREQUIV0.CODPROF IS NULL AND SPROFESSORT.CODPROF IS NOT NULL THEN PPESSOAT.NOME
	 ELSE PPESSOA.NOME
END NOMEPROFESSOR,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SPROFESSOREQUIV.CODPROF IS NOT NULL THEN STITULACAOEQUIV.NOME
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SPROFESSOREQUIV.CODPROF IS NULL THEN STITULACAOEQUIV0.NOME
	 WHEN SPROFESSOREQUIV.CODPROF IS NULL AND SPROFESSOREQUIV0.CODPROF IS NULL AND SPROFESSORT.CODPROF IS NOT NULL THEN STITULACAOT.NOME
	 ELSE STITULACAO.NOME
END TITULACAO, 
NULL NUMCREDITOSCOB,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SHISTDISCEQUIVCONCLUIDAS.PLETIVO
	 ELSE SPLETIVO.CODPERLET
END CODPERLET,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SPLETIVO_EQUIV.DESCRICAO
	 ELSE SPLETIVO.DESCRICAO
END PERIODOLETIVO,
SPLETIVO.DTINICIO,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SPROFESSOREQUIV.CODPROF IS NOT NULL THEN PCODINSTRUCAOEQUIV.DESCRICAO
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' AND SPROFESSOREQUIV.CODPROF IS NULL THEN PCODINSTRUCAOEQUIV0.DESCRICAO
	 WHEN SPROFESSOREQUIV.CODPROF IS NULL AND SPROFESSOREQUIV0.CODPROF IS NULL AND SPROFESSORT.CODPROF IS NOT NULL THEN PCODINSTRUCAOT.DESCRICAO
	 ELSE PCODINSTRUCAO.DESCRICAO
END TITULO,  
CASE 
	WHEN SHISTDISCCONCLUIDAS.CONCEITO IS NOT NULL THEN 0 
	ELSE 1 
END CONTA,
CASE 
	 WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SUBSTRING (SPLETIVO_EQUIV.CODPERLET ,1,4)
	 ELSE SUBSTRING (SPLETIVO.CODPERLET ,1,4)
END ANO,
CASE WHEN SDISCGRUPOOPTELET.CODDISC IS NULL THEN SPERIODO.DESCRICAO ELSE PMAT.DESCRICAO END PERIODO,
CASE WHEN SDISCGRUPOOPTELET.CODDISC IS NULL THEN SPERIODO.CODPERIODO ELSE PMAT.CODPERIODO END CODPERIODO
  
FROM   DBO.SHISTDISCCONCLUIDAS (NOLOCK)
       LEFT JOIN DBO.SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
              ON DBO.SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = DBO.SHISTDISCCONCLUIDAS.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = DBO.SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.RA = DBO.SHISTDISCCONCLUIDAS.RA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.GREQUIV = DBO.SHISTDISCCONCLUIDAS.GREQUIV	    
		INNER JOIN SDISCIPLINA (NOLOCK) ON 
			SHISTDISCCONCLUIDAS.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA 
			AND SHISTDISCCONCLUIDAS.CODDISC = SDISCIPLINA.CODDISC
		INNER JOIN SHABILITACAOFILIAL (NOLOCK)
			ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		INNER JOIN SHABILITACAO 
			ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
			AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
			AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		LEFT JOIN SGRADE 
			ON SGRADE.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
			AND SGRADE.CODCURSO = SHABILITACAO.CODCURSO 
			AND SGRADE.CODHABILITACAO = SHABILITACAO.CODHABILITACAO
		LEFT JOIN SPLETIVO (NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SHISTDISCCONCLUIDAS.IDPERLET
		LEFT JOIN SPLETIVO SPLETIVO_EQUIV (NOLOCK)
			ON SPLETIVO_EQUIV.CODCOLIGADA = SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA
			AND SPLETIVO_EQUIV.IDPERLET = SHISTDISCEQUIVCONCLUIDAS.IDPERLET
		LEFT JOIN SMATRICPL (NOLOCK)
			ON SMATRICPL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
			AND SMATRICPL.RA = SHISTDISCCONCLUIDAS.RA
			AND SMATRICPL.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
			AND SMATRICPL.IDPERLET = SHISTDISCCONCLUIDAS.IDPERLET
		LEFT JOIN SSTATUS (NOLOCK)
			ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SSTATUS.CODCOLIGADA 
			AND SHISTDISCCONCLUIDAS.CODSTATUS = SSTATUS.CODSTATUS
		/*DISCIPLINAS CONCLUIDAS APROVEITAMENTO DE ESTUDOS*/
		LEFT JOIN SHISTDISCFACPROF 
			ON SHISTDISCFACPROF.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
			AND SHISTDISCFACPROF.RA = SHISTDISCCONCLUIDAS.RA
			/*AND SHISTDISCFACPROF.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL*/
			AND SHISTDISCFACPROF.IDPERLET = SHISTDISCCONCLUIDAS.IDPERLET
			AND SHISTDISCFACPROF.CODDISC = SHISTDISCCONCLUIDAS.CODDISC
		LEFT JOIN SPROFESSOR (NOLOCK)
			ON SPROFESSOR.CODCOLIGADA = SHISTDISCFACPROF.CODCOLIGADA
			AND SPROFESSOR.CODPROF = SHISTDISCFACPROF.CODPROF
		LEFT JOIN PPESSOA (NOLOCK)
			ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
		LEFT JOIN PCODINSTRUCAO (NOLOCK)
			ON PCODINSTRUCAO.CODCLIENTE = PPESSOA.GRAUINSTRUCAO
		LEFT JOIN STITULACAO (NOLOCK)
			ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO 
		/*DISCIPLINAS CONCLUIDAS APROVEITAMENTO DE ESTUDOS POR EQUIV*/
		LEFT JOIN SHISTDISCFACPROF SHISTDISCFACPROFEQUIV ON 
		    SHISTDISCFACPROFEQUIV.CODCOLIGADA = SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA
			AND SHISTDISCFACPROFEQUIV.RA = SHISTDISCEQUIVCONCLUIDAS.RA
			/*AND SHISTDISCFACPROFEQUIV.IDHABILITACAOFILIAL = SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL*/
			AND SHISTDISCFACPROFEQUIV.IDPERLET = SHISTDISCEQUIVCONCLUIDAS.IDPERLET
			AND SHISTDISCFACPROFEQUIV.CODDISC = SHISTDISCEQUIVCONCLUIDAS.CODDISC
		LEFT JOIN SPROFESSOR SPROFESSOREQUIV0 (NOLOCK)
			ON SPROFESSOREQUIV0.CODCOLIGADA = SHISTDISCFACPROFEQUIV.CODCOLIGADA
			AND SPROFESSOREQUIV0.CODPROF = SHISTDISCFACPROFEQUIV.CODPROF
		LEFT JOIN PPESSOA PPESSOAEQUIV0 (NOLOCK)
			ON PPESSOAEQUIV0.CODIGO = SPROFESSOREQUIV0.CODPESSOA
		LEFT JOIN PCODINSTRUCAO PCODINSTRUCAOEQUIV0 (NOLOCK)
			ON PCODINSTRUCAOEQUIV0.CODCLIENTE = PPESSOAEQUIV0.GRAUINSTRUCAO
		LEFT JOIN STITULACAO STITULACAOEQUIV0 (NOLOCK)
			ON STITULACAOEQUIV0.CODTITULACAO = SPROFESSOREQUIV0.CODTITULACAO 
		/*DISCIPLINAS CONCLUIDAS POR EQUIV*/
		LEFT JOIN STURMADISC STURMADISCEQUIV (NOLOCK)
			ON STURMADISCEQUIV.CODCOLIGADA = SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA			
			AND STURMADISCEQUIV.IDPERLET = SHISTDISCEQUIVCONCLUIDAS.IDPERLET
			AND STURMADISCEQUIV.CODDISC = SHISTDISCEQUIVCONCLUIDAS.CODDISC
			AND STURMADISCEQUIV.IDTURMADISC = SHISTDISCEQUIVCONCLUIDAS.IDTURMADISC
		LEFT JOIN SPROFESSORTURMA SPROFESSORTURMAEQUIV (NOLOCK)
			ON SPROFESSORTURMAEQUIV.CODCOLIGADA = STURMADISCEQUIV.CODCOLIGADA
			AND SPROFESSORTURMAEQUIV.IDTURMADISC = STURMADISCEQUIV.IDTURMADISC
			AND SPROFESSORTURMAEQUIV.TIPOPROF = 'T'
		LEFT JOIN SPROFESSOR SPROFESSOREQUIV (NOLOCK)
			ON SPROFESSOREQUIV.CODCOLIGADA = SPROFESSORTURMAEQUIV.CODCOLIGADA
			AND SPROFESSOREQUIV.CODPROF = SPROFESSORTURMAEQUIV.CODPROF
		LEFT JOIN PPESSOA PPESSOAEQUIV (NOLOCK)
			ON PPESSOAEQUIV.CODIGO = SPROFESSOREQUIV.CODPESSOA
		LEFT JOIN PCODINSTRUCAO PCODINSTRUCAOEQUIV (NOLOCK)
			ON PCODINSTRUCAOEQUIV.CODCLIENTE = PPESSOAEQUIV.GRAUINSTRUCAO
		LEFT JOIN STITULACAO STITULACAOEQUIV (NOLOCK)
			ON STITULACAOEQUIV.CODTITULACAO = SPROFESSOREQUIV.CODTITULACAO 
		/*DISCIPLINAS CONCLUIDAS NO PERÍODO LETIVO*/		
		LEFT JOIN STURMADISC  (NOLOCK)
			ON STURMADISC.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA			
			AND STURMADISC.IDPERLET = SHISTDISCCONCLUIDAS.IDPERLET
			AND STURMADISC.CODDISC = SHISTDISCCONCLUIDAS.CODDISC
			AND STURMADISC.IDTURMADISC = SHISTDISCCONCLUIDAS.IDTURMADISC
		LEFT JOIN SPROFESSORTURMA (NOLOCK)
			ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
			AND SPROFESSORTURMA.TIPOPROF = 'T'
		LEFT JOIN SPROFESSOR SPROFESSORT (NOLOCK)
			ON SPROFESSORT.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
			AND SPROFESSORT.CODPROF = SPROFESSORTURMA.CODPROF
		LEFT JOIN PPESSOA PPESSOAT (NOLOCK)
			ON PPESSOAT.CODIGO = SPROFESSORT.CODPESSOA
		LEFT JOIN PCODINSTRUCAO PCODINSTRUCAOT (NOLOCK)
			ON PCODINSTRUCAOT.CODCLIENTE = PPESSOAT.GRAUINSTRUCAO
		LEFT JOIN STITULACAO STITULACAOT (NOLOCK)
			ON STITULACAOT.CODTITULACAO = SPROFESSORT.CODTITULACAO 
		LEFT JOIN SDISCGRADE 
			ON SDISCGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
			AND SDISCGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
			AND SDISCGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO 
			AND SDISCGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE 
			AND SDISCGRADE.CODDISC = SDISCIPLINA.CODDISC
		LEFT JOIN SPERIODO 
			ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA 
			AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO 
			AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO 
			AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE 
			AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
			AND SPERIODO.CODPERIODO <> 0
		LEFT JOIN SGRUPOOPTELET 
			ON SGRUPOOPTELET.CODCOLIGADA = SGRADE.CODCOLIGADA 
			AND SGRUPOOPTELET.CODCURSO = SGRADE.CODCURSO 
			AND SGRUPOOPTELET.CODHABILITACAO = SGRADE.CODHABILITACAO 
			AND SGRUPOOPTELET.CODGRADE = SGRADE.CODGRADE
		LEFT JOIN SDISCGRUPOOPTELET 
			ON SDISCGRUPOOPTELET.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA 
			AND SDISCGRUPOOPTELET.CODCURSO = SGRUPOOPTELET.CODCURSO 
			AND SDISCGRUPOOPTELET.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO 
			AND SDISCGRUPOOPTELET.CODGRADE = SGRUPOOPTELET.CODGRADE
			AND SDISCGRUPOOPTELET.CODDISC = SDISCIPLINA.CODDISC
			AND SDISCGRUPOOPTELET.IDGRUPO = SGRUPOOPTELET.IDGRUPO
		LEFT JOIN SPERIODO PMAT
			ON PMAT.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA 
			AND PMAT.CODCURSO = SGRUPOOPTELET.CODCURSO 
			AND PMAT.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO 
			AND PMAT.CODGRADE = SGRUPOOPTELET.CODGRADE 
			AND PMAT.CODPERIODO = SGRUPOOPTELET.CODPERIODO
			
			
			
/*MODIFICADO EM 10/05/2022 NATHAN PVT - FEITO JOIN PARA CONSIDERAR APENAS 1 DISCIPLINA COM A MAIOR NOTA QUANTO DIVER 2 EQUIVALENCIAS PARA CONSIDERAR 1 DISCIPLINA. RAQUEL*/
INNER JOIN (

SELECT 
DISTINCT 
SHISTDISCCONCLUIDAS.CODCOLIGADA, 
SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
SHISTDISCCONCLUIDAS.IDTURMADISC,
SHISTDISCCONCLUIDAS.RA,
 
CASE 
	WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN MAX(SHISTDISCEQUIVCONCLUIDAS.NOTA)
	ELSE MAX(SHISTDISCCONCLUIDAS.NOTA)
END MEDIA,
SDISCIPLINA.CODDISC

FROM   DBO.SHISTDISCCONCLUIDAS (NOLOCK)
       LEFT JOIN DBO.SHISTDISCEQUIVCONCLUIDAS (NOLOCK)
              ON DBO.SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = DBO.SHISTDISCCONCLUIDAS.CODCOLIGADA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = DBO.SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.RA = DBO.SHISTDISCCONCLUIDAS.RA
                 AND DBO.SHISTDISCEQUIVCONCLUIDAS.GREQUIV = DBO.SHISTDISCCONCLUIDAS.GREQUIV	    
		INNER JOIN SDISCIPLINA (NOLOCK) ON 
			SHISTDISCCONCLUIDAS.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA 
			AND SHISTDISCCONCLUIDAS.CODDISC = SDISCIPLINA.CODDISC
		INNER JOIN SHABILITACAOFILIAL (NOLOCK)
			ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		INNER JOIN SHABILITACAO 
			ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
			AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
			AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		LEFT JOIN SGRADE 
			ON SGRADE.CODCOLIGADA = SHABILITACAO.CODCOLIGADA 
			AND SGRADE.CODCURSO = SHABILITACAO.CODCURSO 
			AND SGRADE.CODHABILITACAO = SHABILITACAO.CODHABILITACAO
		LEFT JOIN SPLETIVO (NOLOCK)
			ON SPLETIVO.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SHISTDISCCONCLUIDAS.IDPERLET
		LEFT JOIN SPLETIVO SPLETIVO_EQUIV (NOLOCK)
			ON SPLETIVO_EQUIV.CODCOLIGADA = SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA
			AND SPLETIVO_EQUIV.IDPERLET = SHISTDISCEQUIVCONCLUIDAS.IDPERLET
		LEFT JOIN SMATRICPL (NOLOCK)
			ON SMATRICPL.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
			AND SMATRICPL.RA = SHISTDISCCONCLUIDAS.RA
			AND SMATRICPL.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
			AND SMATRICPL.IDPERLET = SHISTDISCCONCLUIDAS.IDPERLET
		LEFT JOIN SSTATUS (NOLOCK)
			ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SSTATUS.CODCOLIGADA 
			AND SHISTDISCCONCLUIDAS.CODSTATUS = SSTATUS.CODSTATUS
		/*DISCIPLINAS CONCLUIDAS APROVEITAMENTO DE ESTUDOS*/
		LEFT JOIN SHISTDISCFACPROF 
			ON SHISTDISCFACPROF.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA
			AND SHISTDISCFACPROF.RA = SHISTDISCCONCLUIDAS.RA
			/*AND SHISTDISCFACPROF.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL*/
			AND SHISTDISCFACPROF.IDPERLET = SHISTDISCCONCLUIDAS.IDPERLET
			AND SHISTDISCFACPROF.CODDISC = SHISTDISCCONCLUIDAS.CODDISC
		LEFT JOIN SPROFESSOR (NOLOCK)
			ON SPROFESSOR.CODCOLIGADA = SHISTDISCFACPROF.CODCOLIGADA
			AND SPROFESSOR.CODPROF = SHISTDISCFACPROF.CODPROF
		LEFT JOIN PPESSOA (NOLOCK)
			ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
		LEFT JOIN PCODINSTRUCAO (NOLOCK)
			ON PCODINSTRUCAO.CODCLIENTE = PPESSOA.GRAUINSTRUCAO
		LEFT JOIN STITULACAO (NOLOCK)
			ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO 
		/*DISCIPLINAS CONCLUIDAS APROVEITAMENTO DE ESTUDOS POR EQUIV*/
		LEFT JOIN SHISTDISCFACPROF SHISTDISCFACPROFEQUIV ON 
		    SHISTDISCFACPROFEQUIV.CODCOLIGADA = SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA
			AND SHISTDISCFACPROFEQUIV.RA = SHISTDISCEQUIVCONCLUIDAS.RA
			/*AND SHISTDISCFACPROFEQUIV.IDHABILITACAOFILIAL = SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL*/
			AND SHISTDISCFACPROFEQUIV.IDPERLET = SHISTDISCEQUIVCONCLUIDAS.IDPERLET
			AND SHISTDISCFACPROFEQUIV.CODDISC = SHISTDISCEQUIVCONCLUIDAS.CODDISC
		LEFT JOIN SPROFESSOR SPROFESSOREQUIV0 (NOLOCK)
			ON SPROFESSOREQUIV0.CODCOLIGADA = SHISTDISCFACPROFEQUIV.CODCOLIGADA
			AND SPROFESSOREQUIV0.CODPROF = SHISTDISCFACPROFEQUIV.CODPROF
		LEFT JOIN PPESSOA PPESSOAEQUIV0 (NOLOCK)
			ON PPESSOAEQUIV0.CODIGO = SPROFESSOREQUIV0.CODPESSOA
		LEFT JOIN PCODINSTRUCAO PCODINSTRUCAOEQUIV0 (NOLOCK)
			ON PCODINSTRUCAOEQUIV0.CODCLIENTE = PPESSOAEQUIV0.GRAUINSTRUCAO
		LEFT JOIN STITULACAO STITULACAOEQUIV0 (NOLOCK)
			ON STITULACAOEQUIV0.CODTITULACAO = SPROFESSOREQUIV0.CODTITULACAO 
		/*DISCIPLINAS CONCLUIDAS POR EQUIV*/
		LEFT JOIN STURMADISC STURMADISCEQUIV (NOLOCK)
			ON STURMADISCEQUIV.CODCOLIGADA = SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA			
			AND STURMADISCEQUIV.IDPERLET = SHISTDISCEQUIVCONCLUIDAS.IDPERLET
			AND STURMADISCEQUIV.CODDISC = SHISTDISCEQUIVCONCLUIDAS.CODDISC
			AND STURMADISCEQUIV.IDTURMADISC = SHISTDISCEQUIVCONCLUIDAS.IDTURMADISC
		LEFT JOIN SPROFESSORTURMA SPROFESSORTURMAEQUIV (NOLOCK)
			ON SPROFESSORTURMAEQUIV.CODCOLIGADA = STURMADISCEQUIV.CODCOLIGADA
			AND SPROFESSORTURMAEQUIV.IDTURMADISC = STURMADISCEQUIV.IDTURMADISC
			AND SPROFESSORTURMAEQUIV.TIPOPROF = 'T'
		LEFT JOIN SPROFESSOR SPROFESSOREQUIV (NOLOCK)
			ON SPROFESSOREQUIV.CODCOLIGADA = SPROFESSORTURMAEQUIV.CODCOLIGADA
			AND SPROFESSOREQUIV.CODPROF = SPROFESSORTURMAEQUIV.CODPROF
		LEFT JOIN PPESSOA PPESSOAEQUIV (NOLOCK)
			ON PPESSOAEQUIV.CODIGO = SPROFESSOREQUIV.CODPESSOA
		LEFT JOIN PCODINSTRUCAO PCODINSTRUCAOEQUIV (NOLOCK)
			ON PCODINSTRUCAOEQUIV.CODCLIENTE = PPESSOAEQUIV.GRAUINSTRUCAO
		LEFT JOIN STITULACAO STITULACAOEQUIV (NOLOCK)
			ON STITULACAOEQUIV.CODTITULACAO = SPROFESSOREQUIV.CODTITULACAO 
		/*DISCIPLINAS CONCLUIDAS NO PERÍODO LETIVO*/		
		LEFT JOIN STURMADISC  (NOLOCK)
			ON STURMADISC.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA			
			AND STURMADISC.IDPERLET = SHISTDISCCONCLUIDAS.IDPERLET
			AND STURMADISC.CODDISC = SHISTDISCCONCLUIDAS.CODDISC
			AND STURMADISC.IDTURMADISC = SHISTDISCCONCLUIDAS.IDTURMADISC
		LEFT JOIN SPROFESSORTURMA (NOLOCK)
			ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
			AND SPROFESSORTURMA.TIPOPROF = 'T'
		LEFT JOIN SPROFESSOR SPROFESSORT (NOLOCK)
			ON SPROFESSORT.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
			AND SPROFESSORT.CODPROF = SPROFESSORTURMA.CODPROF
		LEFT JOIN PPESSOA PPESSOAT (NOLOCK)
			ON PPESSOAT.CODIGO = SPROFESSORT.CODPESSOA
		LEFT JOIN PCODINSTRUCAO PCODINSTRUCAOT (NOLOCK)
			ON PCODINSTRUCAOT.CODCLIENTE = PPESSOAT.GRAUINSTRUCAO
		LEFT JOIN STITULACAO STITULACAOT (NOLOCK)
			ON STITULACAOT.CODTITULACAO = SPROFESSORT.CODTITULACAO 
		LEFT JOIN SDISCGRADE 
			ON SDISCGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
			AND SDISCGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO 
			AND SDISCGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO 
			AND SDISCGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE 
			AND SDISCGRADE.CODDISC = SDISCIPLINA.CODDISC
		LEFT JOIN SPERIODO 
			ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA 
			AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO 
			AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO 
			AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE 
			AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
			AND SPERIODO.CODPERIODO <> 0
		LEFT JOIN SGRUPOOPTELET 
			ON SGRUPOOPTELET.CODCOLIGADA = SGRADE.CODCOLIGADA 
			AND SGRUPOOPTELET.CODCURSO = SGRADE.CODCURSO 
			AND SGRUPOOPTELET.CODHABILITACAO = SGRADE.CODHABILITACAO 
			AND SGRUPOOPTELET.CODGRADE = SGRADE.CODGRADE
		LEFT JOIN SDISCGRUPOOPTELET 
			ON SDISCGRUPOOPTELET.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA 
			AND SDISCGRUPOOPTELET.CODCURSO = SGRUPOOPTELET.CODCURSO 
			AND SDISCGRUPOOPTELET.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO 
			AND SDISCGRUPOOPTELET.CODGRADE = SGRUPOOPTELET.CODGRADE
			AND SDISCGRUPOOPTELET.CODDISC = SDISCIPLINA.CODDISC
			AND SDISCGRUPOOPTELET.IDGRUPO = SGRUPOOPTELET.IDGRUPO
		LEFT JOIN SPERIODO PMAT
			ON PMAT.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA 
			AND PMAT.CODCURSO = SGRUPOOPTELET.CODCURSO 
			AND PMAT.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO 
			AND PMAT.CODGRADE = SGRUPOOPTELET.CODGRADE 
			AND PMAT.CODPERIODO = SGRUPOOPTELET.CODPERIODO
WHERE 1= 1 
AND SHISTDISCCONCLUIDAS.CODCOLIGADA = :CODCOLIGADA1
AND SHISTDISCCONCLUIDAS.RA = :RA2
AND (SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' OR SSTATUS.DESCRICAO LIKE '%' + :Status1 + '%' OR SSTATUS.DESCRICAO LIKE '%' + :Status2 + '%')
AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
AND SDISCIPLINA.NOME NOT LIKE 'ACERTOS FINANCEIROS'
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM SDISCGRADE WHERE SDISCGRADE.DISCIPLINATCC = 'S' )
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM OPTATIVAS_ORGANIZADAS(:RA2,:IDHABILITACAOFILIAL1))
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC FROM SHISTDISCOPTELETIVAS WHERE RA = :RA2 AND IDHABILITACAOFILIAL= :IDHABILITACAOFILIAL1)


GROUP BY 
	SHISTDISCCONCLUIDAS.CODCOLIGADA, 
SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
SHISTDISCCONCLUIDAS.IDTURMADISC,
SHISTDISCCONC";;;;;;;;;;;;;;;;;;;;;;;
UIDAS.STATUS,;;;;;;;;;;;;;;;;;;;;;;;;;;
SDISCIPLINA.CODDISC, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SDISCIPLINA.NOME,;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCCONCLUIDAS.RA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
) AS A ON A.CODCOLIGADA = SHISTDISCCONCLUIDAS.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND A.CODDISC = SHISTDISCCONCLUIDAS.CODDISC";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND A.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND A.RA = SHISTDISCCONCLUIDAS.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND A.MEDIA = CASE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' THEN SHISTDISCEQUIVCONCLUIDAS.NOTA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE SHISTDISCCONCLUIDAS.NOTA END";;;;;;;;;;;;;;;;;;;;;;;;;;
"			";;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE 1= 1 ;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHISTDISCCONCLUIDAS.CODCOLIGADA = :CODCOLIGADA1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHISTDISCCONCLUIDAS.RA = :RA2;;;;;;;;;;;;;;;;;;;;;;;;;;
AND (SHISTDISCCONCLUIDAS.STATUS = '*Equiv.' OR SSTATUS.DESCRICAO LIKE '%' + :Status1 + '%' OR SSTATUS.DESCRICAO LIKE '%' + :Status2 + '%');;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.NOME NOT LIKE 'ACERTOS FINANCEIROS';;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM SDISCGRADE WHERE SDISCGRADE.DISCIPLINATCC = 'S' );;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM OPTATIVAS_ORGANIZADAS(:RA2,:IDHABILITACAOFILIAL1));;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC FROM SHISTDISCOPTELETIVAS WHERE RA = :RA2 AND IDHABILITACAOFILIAL= :IDHABILITACAOFILIAL1);;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
UNION;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
SELECT DISTINCT SHISTDISCFAC.CODCOLIGADA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.IDHABILITACAOFILIAL,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL IDTURMADISC,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL CODETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL TIPOETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.NOTA MEDIA,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL ETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL PONTDIST,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL NOMEREDUZIDO,;;;;;;;;;;;;;;;;;;;;;;;;;;
SDISCIPLINA.CODDISC, ;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL CODTURMA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SDISCIPLINA.NOME DISCIPLINA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SSTATUS.DESCRICAO, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SHISTDISCFAC.CONCEITO IS NULL THEN REPLACE(CONVERT(VARCHAR, CONVERT(DECIMAL(10,1),SHISTDISCFAC.NOTA)),'.',',') ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE SHISTDISCFAC.CONCEITO";;;;;;;;;;;;;;;;;;;;;;;;;;
END NOTA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.CONCEITO NOTACONCEITUAL,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL CONCEITOECTS,;;;;;;;;;;;;;;;;;;;;;;;;;;
(SELECT RES.DESCRICAO FROM SSTATUS RES(NOLOCK) WHERE  SHISTDISCFAC.CODCOLIGADA = RES.CODCOLIGADA AND SHISTDISCFAC.CODSTATUS = RES.CODSTATUS)  DESCRESULT,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL ETAPAFINAL,;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.IDPERLET, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.RA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.NOTA NOTAFALTA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CONVERT(INT, SDISCIPLINA.CH) CH, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SDISCIPLINA.NOME LIKE 'Estágio%' THEN ''";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE CONVERT(varchar,CONVERT(INT, SDISCIPLINA.NUMCREDITOS)) ";;;;;;;;;;;;;;;;;;;;;;;;;;
END NUMCREDITOS,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL DTMATRICULA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPROFESSOR.CODPROF,;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.NUMCREDITOS VALORCREDITO,;;;;;;;;;;;;;;;;;;;;;;;;;;
PPESSOA.NOME NOMEPROFESSOR,;;;;;;;;;;;;;;;;;;;;;;;;;;
STITULACAO.NOME TITULACAO,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL NUMCREDITOSCOB,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.CODPERLET,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.DESCRICAO PERIODOLETIVO,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.DTINICIO,;;;;;;;;;;;;;;;;;;;;;;;;;;
PCODINSTRUCAO.DESCRICAO TITULO,;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SHISTDISCFAC.CONCEITO IS NOT NULL THEN 0 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
END CONTA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SUBSTRING (SPLETIVO.CODPERLET ,1,4) ANO,;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE WHEN SDISCGRUPOOPTELET.CODDISC IS NULL THEN SPERIODO.DESCRICAO ELSE PMAT.DESCRICAO END PERIODO,;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE WHEN SDISCGRUPOOPTELET.CODDISC IS NULL THEN SPERIODO.CODPERIODO ELSE PMAT.CODPERIODO END CODPERIODO;;;;;;;;;;;;;;;;;;;;;;;;;;
FROM SHISTDISCFAC;;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SDISCIPLINA (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHISTDISCFAC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFAC.CODDISC = SDISCIPLINA.CODDISC";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SHABILITACAOFILIAL (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHISTDISCFAC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SHABILITACAO ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SGRADE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SGRADE.CODCOLIGADA = SHABILITACAO.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SGRADE.CODCURSO = SHABILITACAO.CODCURSO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SGRADE.CODHABILITACAO = SHABILITACAO.CODHABILITACAO";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SPLETIVO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPLETIVO.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPLETIVO.IDPERLET = SHISTDISCFAC.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SMATRICPL (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SMATRICPL.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SMATRICPL.RA = SHISTDISCFAC.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SMATRICPL.IDHABILITACAOFILIAL = SHISTDISCFAC.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SMATRICPL.IDPERLET = SHISTDISCFAC.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SSTATUS (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHISTDISCFAC.CODCOLIGADA = SSTATUS.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFAC.CODSTATUS = SSTATUS.CODSTATUS";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SHISTDISCFACPROF ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHISTDISCFACPROF.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFACPROF.RA = SHISTDISCFAC.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFACPROF.IDHABILITACAOFILIAL = SHISTDISCFAC.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFACPROF.IDPERLET = SHISTDISCFAC.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFACPROF.CODDISC = SHISTDISCFAC.CODDISC";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPROFESSOR (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPROFESSOR.CODCOLIGADA = SHISTDISCFACPROF.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPROFESSOR.CODPROF = SHISTDISCFACPROF.CODPROF";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN PPESSOA (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN PCODINSTRUCAO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
    ON PCODINSTRUCAO.CODCLIENTE = PPESSOA.GRAUINSTRUCAO;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STITULACAO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO ";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SDISCGRADE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SDISCGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRADE.CODDISC = SDISCIPLINA.CODDISC";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPERIODO ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO";;;;;;;;;;;;;;;;;;;;;;;;;;
    AND SPERIODO.CODPERIODO <> 0;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SGRUPOOPTELET ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SGRUPOOPTELET.CODCOLIGADA = SGRADE.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SGRUPOOPTELET.CODCURSO = SGRADE.CODCURSO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SGRUPOOPTELET.CODHABILITACAO = SGRADE.CODHABILITACAO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SGRUPOOPTELET.CODGRADE = SGRADE.CODGRADE";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SDISCGRUPOOPTELET ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SDISCGRUPOOPTELET.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRUPOOPTELET.CODCURSO = SGRUPOOPTELET.CODCURSO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRUPOOPTELET.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRUPOOPTELET.CODGRADE = SGRUPOOPTELET.CODGRADE";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRUPOOPTELET.CODDISC = SDISCIPLINA.CODDISC";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SDISCGRUPOOPTELET.IDGRUPO = SGRUPOOPTELET.IDGRUPO";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPERIODO PMAT;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON PMAT.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND PMAT.CODCURSO = SGRUPOOPTELET.CODCURSO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND PMAT.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND PMAT.CODGRADE = SGRUPOOPTELET.CODGRADE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND PMAT.CODPERIODO = SGRUPOOPTELET.CODPERIODO";;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE SHISTDISCFAC.CODCOLIGADA = :CODCOLIGADA1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHISTDISCFAC.RA = :RA2;;;;;;;;;;;;;;;;;;;;;;;;;;
AND (SSTATUS.DESCRICAO LIKE '%' + :Status1 + '%' OR SSTATUS.DESCRICAO LIKE '%' + :Status2 + '%');;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHISTDISCFAC.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.NOME NOT LIKE 'ACERTOS FINANCEIROS';;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM SDISCGRADE WHERE SDISCGRADE.DISCIPLINATCC = 'S' );;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM OPTATIVAS_ORGANIZADAS(:RA2,:IDHABILITACAOFILIAL1));;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC FROM SHISTDISCOPTELETIVAS WHERE RA = :RA2 AND IDHABILITACAOFILIAL= :IDHABILITACAOFILIAL1);;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC;;;;;;;;;;;;;;;;;;;;;;;;;;
"									FROM SHISTDISCCONCLUIDAS (NOLOCK) ";;;;;;;;;;;;;;;;;;;;;;;;;;
"								WHERE SHISTDISCCONCLUIDAS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"								AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHISTDISCFAC.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"								AND SHISTDISCCONCLUIDAS.RA = SHISTDISCFAC.RA) ";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
UNION ;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
SELECT ;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
DISTINCT;;;;;;;;;;;;;;;;;;;;;;;;;;
STURMADISC.CODCOLIGADA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SMATRICULA.IDHABILITACAOFILIAL,;;;;;;;;;;;;;;;;;;;;;;;;;;
SMATRICULA.IDTURMADISC,;;;;;;;;;;;;;;;;;;;;;;;;;;
SETAPAS.CODETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SETAPAS.TIPOETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
/*SETAPAS.MEDIA,*/;;;;;;;;;;;;;;;;;;;;;;;;;;
SNOTAETAPA.NOTAFALTA MEDIA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SETAPAS.DESCRICAO ETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SETAPAS.PONTDIST,;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE WHEN SETAPAS.NOMEREDUZIDO IS NULL THEN SETAPAS.DESCRICAO ELSE SETAPAS.NOMEREDUZIDO END NOMEREDUZIDO,;;;;;;;;;;;;;;;;;;;;;;;;;;
STURMADISC.CODDISC, ;;;;;;;;;;;;;;;;;;;;;;;;;;
STURMADISC.CODTURMA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SDISCIPLINA.NOME DISCIPLINA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SSTATUS.DESCRICAO, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SNOTAETAPA.CODCONCEITO IS NULL THEN REPLACE(CONVERT(VARCHAR, CONVERT(DECIMAL(10,1),SNOTAETAPA.NOTAFALTA)),'.',',')";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE SNOTAETAPA.CODCONCEITO";;;;;;;;;;;;;;;;;;;;;;;;;;
END NOTA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SNOTAETAPA.CODCONCEITO NOTACONCEITUAL,;;;;;;;;;;;;;;;;;;;;;;;;;;
SNOTAETAPA.CONCEITOECTS,;;;;;;;;;;;;;;;;;;;;;;;;;;
(SELECT RES.DESCRICAO FROM SSTATUS RES(NOLOCK) WHERE  SMATRICULA.CODCOLIGADA = RES.CODCOLIGADA AND SMATRICULA.CODSTATUSRES = RES.CODSTATUS)  DESCRESULT,;;;;;;;;;;;;;;;;;;;;;;;;;;
SETAPAS.ETAPAFINAL, ;;;;;;;;;;;;;;;;;;;;;;;;;;
STURMADISC.IDPERLET, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SMATRICULA.RA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SNOTAETAPA.NOTAFALTA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CONVERT(INT, SDISCIPLINA.CH) CH, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SDISCIPLINA.NOME LIKE 'Estágio%' THEN ''";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE CONVERT(varchar,CONVERT(INT, SDISCIPLINA.NUMCREDITOS)) ";;;;;;;;;;;;;;;;;;;;;;;;;;
END NUMCREDITOS, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SMATRICULA.DTMATRICULA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPROFESSORTURMA.CODPROF,;;;;;;;;;;;;;;;;;;;;;;;;;;
STURMADISC.VALORCREDITO,;;;;;;;;;;;;;;;;;;;;;;;;;;
PPESSOA.NOME NOMEPROFESSOR,;;;;;;;;;;;;;;;;;;;;;;;;;;
STITULACAO.NOME TITULACAO,;;;;;;;;;;;;;;;;;;;;;;;;;;
SMATRICULA.NUMCREDITOSCOB,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.CODPERLET,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.DESCRICAO PERIODOLETIVO,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.DTINICIO,;;;;;;;;;;;;;;;;;;;;;;;;;;
PCODINSTRUCAO.DESCRICAO TITULO,;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SNOTAETAPA.CODCONCEITO IS NOT NULL THEN 0 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
END CONTA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SUBSTRING (SPLETIVO.CODPERLET ,1,4) ANO,;;;;;;;;;;;;;;;;;;;;;;;;;;
'Enriquecimento Curricular' PERIODO,;;;;;;;;;;;;;;;;;;;;;;;;;;
99 CODPERIODO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
FROM SHABILITACAOALUNO ;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SMATRICULA ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SMATRICULA.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SMATRICULA.RA = SHABILITACAOALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SMATRICULA.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STURMADISC ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND STURMADISC.IDPERLET = SMATRICULA.IDPERLET	";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SHABILITACAOFILIAL ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL	";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SDISCIPLINA ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON ( SDISCIPLINA.CODDISC = STURMADISC.CODDISC)";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SSTATUS ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON (SMATRICULA.CODSTATUS = SSTATUS.CODSTATUS )";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO	";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPROFESSORTURMA (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPROFESSORTURMA.TIPOPROF = 'T'";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPROFESSOR (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN PPESSOA (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN PCODINSTRUCAO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
    ON PCODINSTRUCAO.CODCLIENTE = PPESSOA.GRAUINSTRUCAO;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STITULACAO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPLETIVO ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPLETIVO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND (SPLETIVO.IDPERLET = SMATRICULA.IDPERLET)";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SETAPAS (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
    ON STURMADISC.CODCOLIGADA = SETAPAS.CODCOLIGADA ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND STURMADISC.IDTURMADISC = SETAPAS.IDTURMADISC";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SNOTAETAPA (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
    ON (SETAPAS.CODCOLIGADA = SNOTAETAPA.CODCOLIGADA ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SETAPAS.CODETAPA = SNOTAETAPA.CODETAPA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SETAPAS.TIPOETAPA = SNOTAETAPA.TIPOETAPA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SETAPAS.IDTURMADISC = SNOTAETAPA.IDTURMADISC ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SMATRICULA.RA = SNOTAETAPA.RA)        ";;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE SHABILITACAOALUNO.CODCOLIGADA = 1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHABILITACAOALUNO.RA = :RA2;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.NOME NOT LIKE 'ACERTOS FINANCEIROS';;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM SDISCGRADE WHERE SDISCGRADE.DISCIPLINATCC = 'S' );;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM OPTATIVAS_ORGANIZADAS(:RA2,:IDHABILITACAOFILIAL1));;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC FROM SHISTDISCOPTELETIVAS WHERE RA = :RA2 AND IDHABILITACAOFILIAL= :IDHABILITACAOFILIAL1);;;;;;;;;;;;;;;;;;;;;;;;;;
"AND SDISCIPLINA.CODDISC NOT IN (  	SELECT CODDISC FROM SDISCGRADE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"									WHERE SHABILITACAOFILIAL.CODCOLIGADA = SDISCGRADE.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"									AND SHABILITACAOFILIAL.CODCURSO = SDISCGRADE.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"									AND SHABILITACAOFILIAL.CODGRADE = SDISCGRADE.CODGRADE";;;;;;;;;;;;;;;;;;;;;;;;;;
"									AND SHABILITACAOFILIAL.CODHABILITACAO = SDISCGRADE.CODHABILITACAO)";;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC;;;;;;;;;;;;;;;;;;;;;;;;;;
"									FROM SHISTDISCEQUIVCONCLUIDAS";;;;;;;;;;;;;;;;;;;;;;;;;;
"								WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"								AND SHISTDISCEQUIVCONCLUIDAS.RA = SHABILITACAOALUNO.RA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"								AND SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
AND (SSTATUS.DESCRICAO LIKE '%' + :Status1 + '%' OR SSTATUS.DESCRICAO LIKE '%' + :Status2 + '%');;;;;;;;;;;;;;;;;;;;;;;;;;
AND SSTATUS.DESCRICAO NOT LIKE '%FINANC%';;;;;;;;;;;;;;;;;;;;;;;;;;
AND SETAPAS.TIPOETAPA = 'N';;;;;;;;;;;;;;;;;;;;;;;;;;
AND SETAPAS.CODETAPA = 2;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
UNION;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
SELECT ;;;;;;;;;;;;;;;;;;;;;;;;;;
DISTINCT;;;;;;;;;;;;;;;;;;;;;;;;;;
SHABILITACAOALUNO.CODCOLIGADA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHABILITACAOALUNO.IDHABILITACAOFILIAL,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL IDTURMADISC,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL CODETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL TIPOETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.NOTA MEDIA,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL ETAPA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL PONTDIST,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL NOMEREDUZIDO,;;;;;;;;;;;;;;;;;;;;;;;;;;
SDISCIPLINA.CODDISC, ;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL CODTURMA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SDISCIPLINA.NOME DISCIPLINA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SSTATUS.DESCRICAO, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SHISTDISCFAC.CONCEITO IS NULL THEN REPLACE(CONVERT(VARCHAR, CONVERT(DECIMAL(10,1),SHISTDISCFAC.NOTA)),'.',',') ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE SHISTDISCFAC.CONCEITO";;;;;;;;;;;;;;;;;;;;;;;;;;
END NOTA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.CONCEITO NOTACONCEITUAL,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL CONCEITOECTS,;;;;;;;;;;;;;;;;;;;;;;;;;;
(SELECT RES.DESCRICAO FROM SSTATUS RES(NOLOCK) WHERE  SHISTDISCFAC.CODCOLIGADA = RES.CODCOLIGADA AND SHISTDISCFAC.CODSTATUS = RES.CODSTATUS)  DESCRESULT,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL ETAPAFINAL,;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.IDPERLET, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.RA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.NOTA NOTAFALTA, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CONVERT(INT, SDISCIPLINA.CH) CH, ;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SDISCIPLINA.NOME LIKE 'Estágio%' THEN ''";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE CONVERT(varchar,CONVERT(INT, SDISCIPLINA.NUMCREDITOS)) ";;;;;;;;;;;;;;;;;;;;;;;;;;
END NUMCREDITOS,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL DTMATRICULA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPROFESSOR.CODPROF,;;;;;;;;;;;;;;;;;;;;;;;;;;
SHISTDISCFAC.NUMCREDITOS VALORCREDITO,;;;;;;;;;;;;;;;;;;;;;;;;;;
PPESSOA.NOME NOMEPROFESSOR,;;;;;;;;;;;;;;;;;;;;;;;;;;
STITULACAO.NOME TITULACAO,;;;;;;;;;;;;;;;;;;;;;;;;;;
NULL NUMCREDITOSCOB,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.CODPERLET,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.DESCRICAO PERIODOLETIVO,;;;;;;;;;;;;;;;;;;;;;;;;;;
SPLETIVO.DTINICIO,;;;;;;;;;;;;;;;;;;;;;;;;;;
PCODINSTRUCAO.DESCRICAO TITULO,;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	WHEN SHISTDISCFAC.CONCEITO IS NOT NULL THEN 0 ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	ELSE 1 ";;;;;;;;;;;;;;;;;;;;;;;;;;
END CONTA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SUBSTRING (SPLETIVO.CODPERLET ,1,4) ANO,;;;;;;;;;;;;;;;;;;;;;;;;;;
'Enriquecimento Curricular' PERIODO,;;;;;;;;;;;;;;;;;;;;;;;;;;
99 CODPERIODO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
FROM SHABILITACAOALUNO;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SHABILITACAOFILIAL ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL	";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SHISTDISCFAC ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHISTDISCFAC.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFAC.RA = SHABILITACAOALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFAC.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SDISCIPLINA ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON (SDISCIPLINA.CODDISC = SHISTDISCFAC.CODDISC )";;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SSTATUS ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON (SHISTDISCFAC.CODSTATUS = SSTATUS.CODSTATUS)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SSTATUS.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO	";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SHISTDISCFACPROF ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHISTDISCFACPROF.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFACPROF.RA = SHISTDISCFAC.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFACPROF.IDHABILITACAOFILIAL = SHISTDISCFAC.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFACPROF.IDPERLET = SHISTDISCFAC.IDPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHISTDISCFACPROF.CODDISC = SHISTDISCFAC.CODDISC	";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPROFESSOR (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPROFESSOR.CODCOLIGADA = SHISTDISCFACPROF.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SPROFESSOR.CODPROF = SHISTDISCFACPROF.CODPROF";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN PPESSOA (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN PCODINSTRUCAO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
    ON PCODINSTRUCAO.CODCLIENTE = PPESSOA.GRAUINSTRUCAO;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STITULACAO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPLETIVO ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SPLETIVO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND (SPLETIVO.IDPERLET = SHISTDISCFAC.IDPERLET)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE SHABILITACAOALUNO.CODCOLIGADA = 1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHABILITACAOALUNO.RA = :RA2;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.NOME NOT LIKE 'ACERTOS FINANCEIROS';;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM SDISCGRADE WHERE SDISCGRADE.DISCIPLINATCC = 'S' );;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN ( SELECT CODDISC FROM OPTATIVAS_ORGANIZADAS(:RA2,:IDHABILITACAOFILIAL1));;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC FROM SHISTDISCOPTELETIVAS WHERE RA = :RA2 AND IDHABILITACAOFILIAL= :IDHABILITACAOFILIAL1);;;;;;;;;;;;;;;;;;;;;;;;;;
"AND SDISCIPLINA.CODDISC NOT IN (  	SELECT CODDISC FROM SDISCGRADE ";;;;;;;;;;;;;;;;;;;;;;;;;;
"						WHERE SHABILITACAOFILIAL.CODCOLIGADA = SDISCGRADE.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"						AND SHABILITACAOFILIAL.CODCURSO = SDISCGRADE.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"						AND SHABILITACAOFILIAL.CODGRADE = SDISCGRADE.CODGRADE";;;;;;;;;;;;;;;;;;;;;;;;;;
"						AND SHABILITACAOFILIAL.CODHABILITACAO = SDISCGRADE.CODHABILITACAO)";;;;;;;;;;;;;;;;;;;;;;;;;;
AND SDISCIPLINA.CODDISC NOT IN (SELECT CODDISC;;;;;;;;;;;;;;;;;;;;;;;;;;
"									FROM SHISTDISCEQUIVCONCLUIDAS";;;;;;;;;;;;;;;;;;;;;;;;;;
"								WHERE SHISTDISCEQUIVCONCLUIDAS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"								AND SHISTDISCEQUIVCONCLUIDAS.RA = SHABILITACAOALUNO.RA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"								AND SHISTDISCEQUIVCONCLUIDAS.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL)";;;;;;;;;;;;;;;;;;;;;;;;;;
AND (SSTATUS.DESCRICAO LIKE '%' + :Status1 + '%' OR SSTATUS.DESCRICAO LIKE '%' + :Status2 + '%');;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
UNION;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
SELECT * FROM OPTATIVAS_ORGANIZADAS(:RA2,:IDHABILITACAOFILIAL1);;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
)X;;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE PERIODO IS NOT NULL;;;;;;;;;;;;;;;;;;;;;;;;;;
AND DISCIPLINA NOT LIKE   CASE ;;;;;;;;;;;;;;;;;;;;;;;;;;
"								WHEN ISNULL(MEDIA,0) = 0 AND ISNULL(NOTACONCEITUAL,'0') = '0'  AND DISCIPLINA LIKE '%Estágio%' THEN '%Estágio%'";;;;;;;;;;;;;;;;;;;;;;;;;;
"								ELSE ''";;;;;;;;;;;;;;;;;;;;;;;;;;
"						  END";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
ORDER BY PERIODO, DISCIPLINA;;;;;;;;;;;;;;;;;;;;;;;;;;
";49299;;;;31/05/2022;consultor1.totvs;1;1;1;1;;;;0;3fe72162-dec5-4891-b6ba-8f931a920bec;0;;30181;consultor1.totvs;27/01/2022;consultor1.totvs;31/05/2022;0
S;EDUHST0001E;Dados TCC;SELECT ";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
DISTINCT;;;;;;;;;;;;;;;;;;;;;;;;;;
ISNULL(STCC.TEMA,SHABILITACAOALUNOCOMPL.TEMATCC) AS TEMA , ;;;;;;;;;;;;;;;;;;;;;;;;;;
ISNULL(O.NOME,SHABILITACAOALUNOCOMPL.ORIENTADOR) AS ORIENTADOR,;;;;;;;;;;;;;;;;;;;;;;;;;;
ISNULL(PCODINSTRUCAO.DESCRICAO,SHABILITACAOALUNOCOMPL.TITULACAO) AS TITULACAOORIENTADOR,;;;;;;;;;;;;;;;;;;;;;;;;;;
ISNULL(STCCBANCA.DATAHORABANCA,SHABILITACAOALUNOCOMPL.DATADEFESA) AS DATAHORABANCA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SHABILITACAOALUNO.DTINGRESSO,;;;;;;;;;;;;;;;;;;;;;;;;;;
SHABILITACAOALUNO.DTCONCLUSAOCURSO,;;;;;;;;;;;;;;;;;;;;;;;;;;
SHABILITACAOALUNO.DTEMISDIPLOMA,;;;;;;;;;;;;;;;;;;;;;;;;;;
SCURSO.CAPES CAPESCNPQ,;;;;;;;;;;;;;;;;;;;;;;;;;;
STCCLINHAPESQUISA.NOME ARECONHECIMENTO,;;;;;;;;;;;;;;;;;;;;;;;;;;
ISNULL(STCCTIPO.NOME,SHABILITACAOALUNOCOMPL.TIPOTCC) + ': ' TIPO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
FROM SHABILITACAOALUNO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SHABILITACAOFILIAL (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SHABILITACAOALUNOCOMPL ON SHABILITACAOALUNOCOMPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA;;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHABILITACAOALUNOCOMPL.RA = SHABILITACAOALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SMATRICPL (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SMATRICPL.RA = SHABILITACAOALUNO.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STCCMATALUNO ON ;;;;;;;;;;;;;;;;;;;;;;;;;;
STCCMATALUNO.RA = SMATRICPL.RA;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STCC ON ;;;;;;;;;;;;;;;;;;;;;;;;;;
STCC.CODCOLIGADA = STCCMATALUNO.CODCOLIGADA AND ;;;;;;;;;;;;;;;;;;;;;;;;;;
STCC.IDTCC = STCCMATALUNO.IDTCC;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STCCORIENTADOR ON ;;;;;;;;;;;;;;;;;;;;;;;;;;
STCCORIENTADOR.CODCOLIGADA = STCC.CODCOLIGADA AND ;;;;;;;;;;;;;;;;;;;;;;;;;;
STCCORIENTADOR.IDTCC = STCC.IDTCC;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SPROFESSOR PROF ON ;;;;;;;;;;;;;;;;;;;;;;;;;;
PROF.CODPROF = STCCORIENTADOR.CODPROF;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN PPESSOA O ON ;;;;;;;;;;;;;;;;;;;;;;;;;;
PROF.CODPESSOA = O.CODIGO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STCCBANCA ON;;;;;;;;;;;;;;;;;;;;;;;;;;
 STCCBANCA.CODCOLIGADA = STCC.CODCOLIGADA AND ;;;;;;;;;;;;;;;;;;;;;;;;;;
 STCCBANCA.IDTCC = STCC.IDTCC;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN PCODINSTRUCAO (NOLOCK) ON ;;;;;;;;;;;;;;;;;;;;;;;;;;
O.GRAUINSTRUCAO = PCODINSTRUCAO.CODINTERNO;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
INNER JOIN SCURSO (NOLOCK);;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO";;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN SMODALIDADECURSO (NOLOCK) ;;;;;;;;;;;;;;;;;;;;;;;;;;
      ON (SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA AND ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	      SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO)";;;;;;;;;;;;;;;;;;;;;;;;;;
"	      ";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STCCLINHAPESQUISA;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON STCC.CODCOLIGADA = STCCLINHAPESQUISA.CODCOLIGADA AND ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    STCC.IDLINHAPESQUISA = STCCLINHAPESQUISA.IDLINHAPESQUISA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    ";;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT JOIN STCCTIPO ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	ON STCCTIPO.CODCOLIGADA = STCC.CODCOLIGADA AND ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	    STCCTIPO.IDTIPOTCC = STCC.IDTIPOTCC";;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;
"	";;;;;;;;;;;;;;;;;;;;;;;;;;
WHERE SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA1;;;;;;;;;;;;;;;;;;;;;;;;;;
AND SHABILITACAOALUNO.RA = :RA2;;;;;;;;;;;;;;;;;;;;;;;;;;
"AND SHABILITACAOALUNO.IDHABILITACAOFILIAL LIKE :IDHABILITACAOFILIAL1""";2606;;;;04/05/2022;consultor1.totvs;1;1;1;1;;;;0;ee7fdd67-6393-456b-b95a-e1cba7f27d3c;0;;-22134;lilian.buzetti;04/11/2021;consultor1.totvs;04/05/2022;0;;;
S;EDUPOSGRA;Consultas Pós-Graduação;;0;;;;28/01/2021;matheus.amaral;1;1;1;1;;;;0;d71be2fb-803e-4c85-a9eb-bfb9d3172ff9;0;;19986;matheus.amaral;28/01/2021;matheus.amaral;28/01/2021;0
S;EDUPOSGRA.001;Declaração de Conclusão de Curso;"SELECT PPE.NOME, PPE.CARTIDENTIDADE RG, PPE.ORGEMISSORIDENT, PPE.UFCARTIDENT, PNA.DESCRICAO NASCIONALIDADE, PPE.SEXO, PPE.DTNASCIMENTO DATANASCI, 
		PPE.NATURALIDADE, PPE.ESTADONATAL, SCU.NOME CURSO
	FROM SALUNO SAL
		INNER JOIN PPESSOA PPE ON PPE.CODIGO = SAL.CODPESSOA
		INNER JOIN PCODNACAO PNA ON PNA.CODCLIENTE = PPE.NACIONALIDADE
		INNER JOIN SMATRICPL SMP ON SMP.RA = SAL.RA
								AND SMP.CODCOLIGADA = SAL.CODCOLIGADA
		INNER JOIN SHABILITACAOFILIAL SHF ON SHF.IDHABILITACAOFILIAL = SMP.IDHABILITACAOFILIAL
								AND SHF.CODCOLIGADA = SMP.CODCOLIGADA
		INNER JOIN SCURSO SCU ON SCU.CODCURSO = SHF.CODCURSO
								AND SCU.CODCOLIGADA = SHF.CODCOLIGADA
	WHERE SAL.RA = :RA1";695;;;;29/01/2021;matheus.amaral;1;1;1;1;;;;0;570e8d12-3fb5-497b-9abd-89d6f8ff08d2;0;;-1932;matheus.amaral;28/01/2021;matheus.amaral;29/01/2021;0
S;EDUREL0047D;Relação de Alunos com Nome Social Preenchido Por Periodo Letivo;"/*ALUNOS COM NOME SOCIAL PREENCHIDO OU INCORRETO*/
SELECT	
	DISTINCT
	B.RA

FROM PPESSOA A
INNER JOIN v_Unasp_SMATRICULA B ON A.EMAIL = B.EMAIL
WHERE
	NOMESOCIAL  IS NOT NULL 
AND CODPERLET = :PERIODO_LETIVO
AND NOMSTATUS LIKE '%' + :STATUS + '%' 
	";260;;;;26/05/2022;maik.souza;1;1;1;1;;;;0;e91c2fe2-996f-4b17-8682-a1cd1144c981;0;;9946;maik.souza;06/05/2022;maik.souza;26/05/2022;0
S;EDUREL008.CC.01.;Diário de Classe - Frequencia - Dados da Turma e Disciplina;"SELECT DISTINCT 
  (  SELECT TOP 1 SHORARIO.HORAINICIAL
   FROM STURMADISC TUR(NOLOCK)
     LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STURMADISC.IDTURMADISC
   AND  TUR.CODCOLIGADA=STURMADISC.CODCOLIGADA
  ) AS HORAINICIAL, 
  ( SELECT TOP 1 SHORARIO.HORAFINAL
   FROM STURMADISC TUR(NOLOCK)
     LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STURMADISC.IDTURMADISC
   AND  TUR.CODCOLIGADA = STURMADISC.CODCOLIGADA
  ) AS HORAFINAL,
  ( SELECT TOP 1 PROF.NOME PROFESSOR
   FROM STURMADISC TUR(NOLOCK)
                    LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STURMADISC.IDTURMADISC
   AND  TUR.CODCOLIGADA = STURMADISC.CODCOLIGADA
  ) AS PROFESSOR, STURMADISC.CODDISC, SDISCIPLINA.NOME DISCIPLINA, STURMADISC.CODTURMA AS CODTURMA, SPLETIVO.CODPERLET, SPLETIVO.DESCRICAO, STURMA.NOME NOMETURMA,
  STURMADISC.CODCOLIGADA, STURMADISC.IDTURMADISC, STURMADISC.CODFILIAL
FROM SALUNO (NOLOCK)                    
        INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SHABILITACAOALUNO.RA = SALUNO.RA
  INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SHABILITACAOALUNO.RA
  INNER JOIN SMATRICULA (NOLOCK) ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SMATRICPL.RA = SMATRICULA.RA AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
  INNER JOIN STURMADISC(NOLOCK) ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC  
  INNER JOIN STURMA (NOLOCK) ON STURMADISC.CODCOLIGADA = STURMA.CODCOLIGADA AND STURMADISC.CODFILIAL=STURMA.CODFILIAL AND STURMADISC.IDPERLET=STURMA.IDPERLET AND STURMADISC.CODTURMA = STURMA.CODTURMA
  INNER JOIN SPLETIVO (NOLOCK) ON SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
  INNER JOIN PPESSOA (NOLOCK) ON SALUNO.CODPESSOA = PPESSOA.CODIGO
  INNER JOIN SDISCIPLINA(NOLOCK) ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
WHERE SALUNO.CODCOLIGADA = :P_CODCOLIGADA
AND  STURMADISC.IDTURMADISC = :P_IDTURMADISC
AND  STURMADISC.CODDISC = :P_CODDISC
AND  STURMADISC.CODFILIAL = :P_CODFILIAL
ORDER BY CODTURMA";;;;;;;1;1;1;1;;;;;;;;-14115;RM;30/05/2012;RM;30/05/2012;
S;EDUREL008.CC.01X;Diário de Classe - Frequencia - Alunos;"SELECT SALUNO.RA, SMATRICULA.NUMDIARIO, PPESSOA.NOME, SSTATUS.DESCRICAO,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA1 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA1,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA2 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA2,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA3 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA3,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA4 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA4,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA5 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA5,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA6 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA6,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA7 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA7,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA8 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA8,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA9 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA9,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA10 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA10,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA11 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA11,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA12 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA12,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA13 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA13,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA14 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA14,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA15 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA15,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA16 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA16,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA17 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA17,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA18 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA18,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA19 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA19,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA20 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA20,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA21 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA21,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA22 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA22,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA23 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA23,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA24 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA24,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA25 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA25,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA26 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA26,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA27 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA27,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA28 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA28,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA29 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA29,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA30 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA30,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA31 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA31,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA32 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA32,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA33 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA33,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA34 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA34,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA35 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA35,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA36 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA36,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA37 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA37,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA38 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA38,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA39 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA39,
  CASE 
   WHEN SFREQUENCIA.DATA = :P_DATA40 AND SFREQUENCIA.PRESENCA = 'A' THEN 'F' ELSE ''
  END AS PRESENCA40
FROM SALUNO (NOLOCK)                    
        INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SHABILITACAOALUNO.RA = SALUNO.RA
  INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SHABILITACAOALUNO.RA
  INNER JOIN SMATRICULA (NOLOCK) ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SMATRICPL.RA = SMATRICULA.RA AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
  INNER JOIN STURMADISC(NOLOCK) ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC  
  INNER JOIN STURMA (NOLOCK) ON STURMADISC.CODCOLIGADA = STURMA.CODCOLIGADA AND STURMADISC.CODFILIAL=STURMA.CODFILIAL AND STURMADISC.IDPERLET=STURMA.IDPERLET AND STURMADISC.CODTURMA = STURMA.CODTURMA
  INNER JOIN SPLETIVO (NOLOCK) ON SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
  INNER JOIN PPESSOA (NOLOCK) ON SALUNO.CODPESSOA = PPESSOA.CODIGO
  INNER JOIN SDISCIPLINA(NOLOCK) ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
  INNER JOIN SSTATUS (NOLOCK) ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
  LEFT OUTER JOIN SFREQUENCIA (NOLOCK) ON SFREQUENCIA.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SFREQUENCIA.IDTURMADISC = SMATRICULA.IDTURMADISC AND SFREQUENCIA.RA = SMATRICULA.RA
WHERE SALUNO.CODCOLIGADA = :P_CODCOLIGADA
AND  STURMADISC.IDTURMADISC = :P_IDTURMADISC
AND  STURMADISC.CODFILIAL = :P_CODFILIAL
ORDER BY PPESSOA.NOME";;;;;;;1;1;1;1;;;;;;;;-10015;RM;30/05/2012;RM;30/05/2012;
S;EDUREL008.CC.0XX;Diário de Classe - Frequencia - Plano de Aula;"SELECT DIA1 = MIN(CASE WHEN SPLANOAULA.AULA = 1 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES1 = MIN(CASE WHEN SPLANOAULA.AULA = 1 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA2 = MIN(CASE WHEN SPLANOAULA.AULA = 2 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES2 = MIN(CASE WHEN SPLANOAULA.AULA = 2 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA3 = MIN(CASE WHEN SPLANOAULA.AULA = 3 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES3 = MIN(CASE WHEN SPLANOAULA.AULA = 3 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA4 = MIN(CASE WHEN SPLANOAULA.AULA = 4 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES4 = MIN(CASE WHEN SPLANOAULA.AULA = 4 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA5 = MIN(CASE WHEN SPLANOAULA.AULA = 5 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES5 = MIN(CASE WHEN SPLANOAULA.AULA = 5 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA6 = MIN(CASE WHEN SPLANOAULA.AULA = 6 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES6 = MIN(CASE WHEN SPLANOAULA.AULA = 6 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA7 = MIN(CASE WHEN SPLANOAULA.AULA = 7 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES7 = MIN(CASE WHEN SPLANOAULA.AULA = 7 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA8 = MIN(CASE WHEN SPLANOAULA.AULA = 8 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES8 = MIN(CASE WHEN SPLANOAULA.AULA = 8 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA9 = MIN(CASE WHEN SPLANOAULA.AULA = 9 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES9 = MIN(CASE WHEN SPLANOAULA.AULA = 9 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA10 = MIN(CASE WHEN SPLANOAULA.AULA = 10 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES10 = MIN(CASE WHEN SPLANOAULA.AULA = 10 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA11 = MIN(CASE WHEN SPLANOAULA.AULA = 11 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES11 = MIN(CASE WHEN SPLANOAULA.AULA = 11 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA12 = MIN(CASE WHEN SPLANOAULA.AULA = 12 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES12 = MIN(CASE WHEN SPLANOAULA.AULA = 12 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA13 = MIN(CASE WHEN SPLANOAULA.AULA = 13 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES13 = MIN(CASE WHEN SPLANOAULA.AULA = 13 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA14 = MIN(CASE WHEN SPLANOAULA.AULA = 14 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES14 = MIN(CASE WHEN SPLANOAULA.AULA = 14 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA15 = MIN(CASE WHEN SPLANOAULA.AULA = 15 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES15 = MIN(CASE WHEN SPLANOAULA.AULA = 15 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA16 = MIN(CASE WHEN SPLANOAULA.AULA = 16 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES16 = MIN(CASE WHEN SPLANOAULA.AULA = 16 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA17 = MIN(CASE WHEN SPLANOAULA.AULA = 17 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES17 = MIN(CASE WHEN SPLANOAULA.AULA = 17 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA18 = MIN(CASE WHEN SPLANOAULA.AULA = 18 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES18 = MIN(CASE WHEN SPLANOAULA.AULA = 18 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA19 = MIN(CASE WHEN SPLANOAULA.AULA = 19 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES19 = MIN(CASE WHEN SPLANOAULA.AULA = 19 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA20 = MIN(CASE WHEN SPLANOAULA.AULA = 20 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES20 = MIN(CASE WHEN SPLANOAULA.AULA = 20 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA21 = MIN(CASE WHEN SPLANOAULA.AULA = 21 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES21 = MIN(CASE WHEN SPLANOAULA.AULA = 21 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA22 = MIN(CASE WHEN SPLANOAULA.AULA = 22 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES22 = MIN(CASE WHEN SPLANOAULA.AULA = 22 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA23 = MIN(CASE WHEN SPLANOAULA.AULA = 23 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES23 = MIN(CASE WHEN SPLANOAULA.AULA = 23 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA24 = MIN(CASE WHEN SPLANOAULA.AULA = 24 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES24 = MIN(CASE WHEN SPLANOAULA.AULA = 24 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA25 = MIN(CASE WHEN SPLANOAULA.AULA = 25 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES25 = MIN(CASE WHEN SPLANOAULA.AULA = 25 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA26 = MIN(CASE WHEN SPLANOAULA.AULA = 26 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES26 = MIN(CASE WHEN SPLANOAULA.AULA = 26 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA27 = MIN(CASE WHEN SPLANOAULA.AULA = 27 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES27 = MIN(CASE WHEN SPLANOAULA.AULA = 27 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA28 = MIN(CASE WHEN SPLANOAULA.AULA = 28 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES28 = MIN(CASE WHEN SPLANOAULA.AULA = 28 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA29 = MIN(CASE WHEN SPLANOAULA.AULA = 29 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES29 = MIN(CASE WHEN SPLANOAULA.AULA = 29 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA30 = MIN(CASE WHEN SPLANOAULA.AULA = 30 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES30 = MIN(CASE WHEN SPLANOAULA.AULA = 30 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA31 = MIN(CASE WHEN SPLANOAULA.AULA = 31 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES31 = MIN(CASE WHEN SPLANOAULA.AULA = 31 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA32 = MIN(CASE WHEN SPLANOAULA.AULA = 32 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES32 = MIN(CASE WHEN SPLANOAULA.AULA = 32 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA33 = MIN(CASE WHEN SPLANOAULA.AULA = 33 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES33 = MIN(CASE WHEN SPLANOAULA.AULA = 33 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA34 = MIN(CASE WHEN SPLANOAULA.AULA = 34 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES34 = MIN(CASE WHEN SPLANOAULA.AULA = 34 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA35 = MIN(CASE WHEN SPLANOAULA.AULA = 35 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES35 = MIN(CASE WHEN SPLANOAULA.AULA = 35 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA36 = MIN(CASE WHEN SPLANOAULA.AULA = 36 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES36 = MIN(CASE WHEN SPLANOAULA.AULA = 36 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA37 = MIN(CASE WHEN SPLANOAULA.AULA = 37 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES37 = MIN(CASE WHEN SPLANOAULA.AULA = 37 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA38 = MIN(CASE WHEN SPLANOAULA.AULA = 38 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES38 = MIN(CASE WHEN SPLANOAULA.AULA = 38 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA39 = MIN(CASE WHEN SPLANOAULA.AULA = 39 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES39 = MIN(CASE WHEN SPLANOAULA.AULA = 39 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  DIA40 = MIN(CASE WHEN SPLANOAULA.AULA = 40 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), DAY (SPLANOAULA.DATA)) END END),
  MES40 = MIN(CASE WHEN SPLANOAULA.AULA = 40 THEN CASE WHEN LEN (CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA))) = 1 THEN '0' +  CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) ELSE CONVERT (VARCHAR(2), MONTH (SPLANOAULA.DATA)) END END),
  MIN(CASE WHEN SPLANOAULA.AULA = 1 THEN SPLANOAULA.DATA END) AS DATA1,
  MIN(CASE WHEN SPLANOAULA.AULA = 2 THEN SPLANOAULA.DATA END) AS DATA2,
  MIN(CASE WHEN SPLANOAULA.AULA = 3 THEN SPLANOAULA.DATA END) AS DATA3,
  MIN(CASE WHEN SPLANOAULA.AULA = 4 THEN SPLANOAULA.DATA END) AS DATA4,
  MIN(CASE WHEN SPLANOAULA.AULA = 5 THEN SPLANOAULA.DATA END) AS DATA5,
  MIN(CASE WHEN SPLANOAULA.AULA = 6 THEN SPLANOAULA.DATA END) AS DATA6,
  MIN(CASE WHEN SPLANOAULA.AULA = 7 THEN SPLANOAULA.DATA END) AS DATA7,
  MIN(CASE WHEN SPLANOAULA.AULA = 8 THEN SPLANOAULA.DATA END) AS DATA8,
  MIN(CASE WHEN SPLANOAULA.AULA = 9 THEN SPLANOAULA.DATA END) AS DATA9,
  MIN(CASE WHEN SPLANOAULA.AULA = 10 THEN SPLANOAULA.DATA END) AS DATA10,
  MIN(CASE WHEN SPLANOAULA.AULA = 11 THEN SPLANOAULA.DATA END) AS DATA11,
  MIN(CASE WHEN SPLANOAULA.AULA = 12 THEN SPLANOAULA.DATA END) AS DATA12,
  MIN(CASE WHEN SPLANOAULA.AULA = 13 THEN SPLANOAULA.DATA END) AS DATA13,
  MIN(CASE WHEN SPLANOAULA.AULA = 14 THEN SPLANOAULA.DATA END) AS DATA14,  
  MIN(CASE WHEN SPLANOAULA.AULA = 15 THEN SPLANOAULA.DATA END) AS DATA15,
  MIN(CASE WHEN SPLANOAULA.AULA = 16 THEN SPLANOAULA.DATA END) AS DATA16,
  MIN(CASE WHEN SPLANOAULA.AULA = 17 THEN SPLANOAULA.DATA END) AS DATA17,
  MIN(CASE WHEN SPLANOAULA.AULA = 18 THEN SPLANOAULA.DATA END) AS DATA18,
  MIN(CASE WHEN SPLANOAULA.AULA = 19 THEN SPLANOAULA.DATA END) AS DATA19,
  MIN(CASE WHEN SPLANOAULA.AULA = 20 THEN SPLANOAULA.DATA END) AS DATA20,
  MIN(CASE WHEN SPLANOAULA.AULA = 21 THEN SPLANOAULA.DATA END) AS DATA21,
  MIN(CASE WHEN SPLANOAULA.AULA = 22 THEN SPLANOAULA.DATA END) AS DATA22,
  MIN(CASE WHEN SPLANOAULA.AULA = 23 THEN SPLANOAULA.DATA END) AS DATA23,
  MIN(CASE WHEN SPLANOAULA.AULA = 24 THEN SPLANOAULA.DATA END) AS DATA24,
  MIN(CASE WHEN SPLANOAULA.AULA = 25 THEN SPLANOAULA.DATA END) AS DATA25,
  MIN(CASE WHEN SPLANOAULA.AULA = 26 THEN SPLANOAULA.DATA END) AS DATA26,
  MIN(CASE WHEN SPLANOAULA.AULA = 27 THEN SPLANOAULA.DATA END) AS DATA27,
  MIN(CASE WHEN SPLANOAULA.AULA = 28 THEN SPLANOAULA.DATA END) AS DATA28,
  MIN(CASE WHEN SPLANOAULA.AULA = 29 THEN SPLANOAULA.DATA END) AS DATA29,
  MIN(CASE WHEN SPLANOAULA.AULA = 30 THEN SPLANOAULA.DATA END) AS DATA30,
  MIN(CASE WHEN SPLANOAULA.AULA = 31 THEN SPLANOAULA.DATA END) AS DATA31,
  MIN(CASE WHEN SPLANOAULA.AULA = 32 THEN SPLANOAULA.DATA END) AS DATA32,
  MIN(CASE WHEN SPLANOAULA.AULA = 33 THEN SPLANOAULA.DATA END) AS DATA33,
  MIN(CASE WHEN SPLANOAULA.AULA = 34 THEN SPLANOAULA.DATA END) AS DATA34,
  MIN(CASE WHEN SPLANOAULA.AULA = 35 THEN SPLANOAULA.DATA END) AS DATA35,
  MIN(CASE WHEN SPLANOAULA.AULA = 36 THEN SPLANOAULA.DATA END) AS DATA36,
  MIN(CASE WHEN SPLANOAULA.AULA = 37 THEN SPLANOAULA.DATA END) AS DATA37,
  MIN(CASE WHEN SPLANOAULA.AULA = 38 THEN SPLANOAULA.DATA END) AS DATA38,
  MIN(CASE WHEN SPLANOAULA.AULA = 39 THEN SPLANOAULA.DATA END) AS DATA39,
  MIN(CASE WHEN SPLANOAULA.AULA = 40 THEN SPLANOAULA.DATA END) AS DATA40,
  SPLANOAULA.CODCOLIGADA, SPLANOAULA.IDTURMADISC, SPLANOAULA.CODFILIAL
FROM SPLANOAULA (NOLOCK)
WHERE SPLANOAULA.CODCOLIGADA = :P_CODCOLIGADA
AND  SPLANOAULA.IDTURMADISC = :P_IDTURMADISC
AND  SPLANOAULA.CODFILIAL = :P_CODFILIAL
GROUP BY SPLANOAULA.CODCOLIGADA, SPLANOAULA.IDTURMADISC, SPLANOAULA.CODFILIAL";;;;;;;1;1;1;1;;;;;;;;-16616;RM;30/05/2012;RM;30/05/2012;
S;EDUREL009.CC.01.;Diário de Classe - Frequencia - Dados da Turma e Disciplina;"SELECT DISTINCT 
  (  SELECT TOP 1 SHORARIO.HORAINICIAL
   FROM STURMADISC TUR(NOLOCK)
     LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STUR.IDTURMADISC
   AND  TUR.CODCOLIGADA=STUR.CODCOLIGADA
  ) AS HORAINICIAL, 
  ( SELECT TOP 1 SHORARIO.HORAFINAL
   FROM STURMADISC TUR(NOLOCK)
     LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STUR.IDTURMADISC
   AND  TUR.CODCOLIGADA = STUR.CODCOLIGADA
  ) AS HORAFINAL,
  ( SELECT TOP 1 PROF.NOME PROFESSOR
   FROM STURMADISC TUR(NOLOCK)
                    LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STUR.IDTURMADISC
   AND  TUR.CODCOLIGADA = STUR.CODCOLIGADA
  ) AS PROFESSOR, STUR.CODDISC, SDISCIPLINA.NOME DISCIPLINA, STUR.CODTURMA AS CODTURMA, SPLETIVO.CODPERLET, SPLETIVO.DESCRICAO, STURMA.NOME NOMETURMA,
  STUR.CODCOLIGADA, STUR.IDTURMADISC, STUR.CODFILIAL,
    SUBSTRING(CODPERLET,6,1) AS SEMESTRE,
  	SUBSTRING(CODPERLET,0,5) AS ANO,
  	A.TOTALT,
  	B.TOTALP,
	DOCENTE.NOME AS 'NOMEDOCENTES',
  	CAST(SDISCIPLINA.CODDISC AS VARCHAR) + ' - ' + CAST(SDISCIPLINA.NOME AS VARCHAR(250)) AS 'NOMEDISC',
  	CAST(CAST(SDISCIPLINA.CH AS INT) AS VARCHAR) + ' H' AS CH
FROM SALUNO (NOLOCK)                    
        INNER JOIN SHABILITACAOALUNO (NOLOCK) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SHABILITACAOALUNO.RA = SALUNO.RA
  INNER JOIN SMATRICPL (NOLOCK) ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND SMATRICPL.RA = SHABILITACAOALUNO.RA
  INNER JOIN SMATRICULA (NOLOCK) ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SMATRICPL.RA = SMATRICULA.RA AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND SMATRICPL.IDPERLET = SMATRICULA.IDPERLET
  INNER JOIN STURMADISC STUR(NOLOCK) ON STUR.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND STUR.IDTURMADISC = SMATRICULA.IDTURMADISC  
  INNER JOIN STURMA (NOLOCK) ON STUR.CODCOLIGADA = STURMA.CODCOLIGADA AND STUR.CODFILIAL=STURMA.CODFILIAL AND STUR.IDPERLET=STURMA.IDPERLET AND STUR.CODTURMA = STURMA.CODTURMA
  INNER JOIN SPLETIVO (NOLOCK) ON SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
  INNER JOIN PPESSOA (NOLOCK) ON SALUNO.CODPESSOA = PPESSOA.CODIGO
  INNER JOIN SDISCIPLINA(NOLOCK) ON STUR.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA AND STUR.CODDISC = SDISCIPLINA.CODDISC
  
  
 
LEFT JOIN(
SELECT 
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC,
	COUNT(*) AS TOTALT
FROM SPLANOAULA SPL 
WHERE CODCOLIGADA = :P_CODCOLIGADA_N
AND  IDTURMADISC = :P_IDTURMADISC_N
	AND SPL.TIPOAULA = 'T'
GROUP BY 
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC
) AS A ON A.CODCOLIGADA = STUR.CODCOLIGADA
	AND A.IDTURMADISC = STUR.IDTURMADISC
	
	

LEFT JOIN(
SELECT 
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC,
	COUNT(*) AS TOTALP
FROM SPLANOAULA SPL 
WHERE CODCOLIGADA = :P_CODCOLIGADA_N
AND  IDTURMADISC = :P_IDTURMADISC_N
	AND SPL.TIPOAULA <> 'T'
GROUP BY 
	SPL.CODCOLIGADA,
	SPL.IDTURMADISC
) AS B ON B.CODCOLIGADA = STUR.CODCOLIGADA
	AND B.IDTURMADISC = STUR.IDTURMADISC

 
       OUTER APPLY (SELECT STURMADISC.CODDISC,
						   STUFF((SELECT ' / ' + PPESSOA.NOME
									FROM   STURMADISC
										JOIN SPLETIVO 
											ON SPLETIVO.CODCOLIGADA=STURMADISC.CODCOLIGADA
											AND SPLETIVO.IDPERLET=STURMADISC.IDPERLET
										LEFT JOIN SPROFESSORTURMA 
											ON SPROFESSORTURMA.CODCOLIGADA=STURMADISC.CODCOLIGADA
											AND SPROFESSORTURMA.IDTURMADISC=STURMADISC.IDTURMADISC
											AND ISNULL(SPROFESSORTURMA.TIPOPROF,'T')<>'D'
										LEFT JOIN SPROFESSOR
											ON SPROFESSOR.CODCOLIGADA=SPROFESSORTURMA.CODCOLIGADA
											AND SPROFESSOR.CODPROF=SPROFESSORTURMA.CODPROF
										LEFT JOIN STITULACAO
											ON STITULACAO.CODTITULACAO=SPROFESSOR.CODTITULACAO
										LEFT JOIN PPESSOA 
											ON PPESSOA.CODIGO=SPROFESSOR.CODPESSOA
								WHERE  STURMADISC.CODCOLIGADA= STUR.CODCOLIGADA
										AND STURMADISC.IDTURMADISC= STUR.IDTURMADISC
								ORDER BY SPROFESSORTURMA.TIPOPROF,PPESSOA.NOME	
								FOR XML PATH('')), 1, 2, '')AS NOME
		            FROM   STURMADISC 
						   JOIN SPLETIVO 
						     ON SPLETIVO.CODCOLIGADA=STURMADISC.CODCOLIGADA
							    AND SPLETIVO.IDPERLET=STURMADISC.IDPERLET
						   LEFT JOIN SPROFESSORTURMA 
						     ON SPROFESSORTURMA.CODCOLIGADA=STURMADISC.CODCOLIGADA
							    AND SPROFESSORTURMA.IDTURMADISC=STURMADISC.IDTURMADISC
							    AND ISNULL(SPROFESSORTURMA.TIPOPROF,'T')='T'
						   LEFT JOIN SPROFESSOR
						     ON SPROFESSOR.CODCOLIGADA=SPROFESSORTURMA.CODCOLIGADA
							    AND SPROFESSOR.CODPROF=SPROFESSORTURMA.CODPROF
						   LEFT JOIN PPESSOA 
						     ON PPESSOA.CODIGO=SPROFESSOR.CODPESSOA
					WHERE  STURMADISC.CODCOLIGADA= STUR.CODCOLIGADA
					       AND STURMADISC.IDTURMADISC= STUR.IDTURMADISC
				    GROUP BY STURMADISC.CODDISC) DOCENTE
  
  
WHERE SALUNO.CODCOLIGADA = :P_CODCOLIGADA
AND  STUR.IDTURMADISC = :P_IDTURMADISC
AND  STUR.CODDISC = :P_CODDISC
AND  STUR.CODFILIAL = :P_CODFILIAL
ORDER BY CODTURMA";6962;;;;06/04/2022;consultor1.totvs;1;1;1;1;;;;;945c461e-472a-49d6-8d8c-d7d103821d2f;;;-28359;RM;30/05/2012;consultor1.totvs;06/04/2022;
S;EDUREL009.CC.02;Cabeçalho Relatórios Turmas Disciplinas;"SELECT DISTINCT  
SHABILITACAOFILIAL.CODFILIAL,
SCURSO.CODCURSO,
SMODALIDADECURSO.DESCRICAO + ' em ' + SHABILITACAO.NOME NOMECURSO,
SHABILITACAO.CODHABILITACAO,
SHABILITACAO.NOME NOMEHABILITACAO,
SGRADE.CODGRADE,
SGRADE.DESCRICAO DESCGRADE,
STURNO.NOME NOMETURNO,
STURNO.TIPO TIPOTURNO,
STURNO.CODTURNO,



SCURSOMEC.DESCURSOMEC,
SCURSOMEC.CODINEPCURSO,
GFILIAL.CIDADE,
GETDATE() HOJE,

CASE 
	WHEN SCURSO.CODCURSO NOT IN('EC-BCOSO','EC-LLPOR','EC-LLING') THEN SCURSOCOMPL.AUTORIZACAO
	/*Modificado em 02/03/2022 Nathan PVT - Adicionado Isnull em todos os campos pois não estava trazendo a autorização no histórico.*/
	ELSE (SELECT TOP 1 'Reconhecimento Renovado pela Portaria nº ' + CONVERT(varchar, ISNULL(PORTRECONHECIMENTO,'FALTA INFORMAÇÃO')) + ' de ' + 
				CONVERT(varchar,isnull(DTRECONHECIMENTO,'FALTA INFORMAÇÃO'),103) + ', publicada no DOU nº ' + CONVERT(varchar, ISNULL(NUMPUBLICACAO,'FALTA INFORMAÇÃO')) + ' de ' +
				CONVERT(varchar,isnull(DTDOURECONHECIMENTO,'FALTA INFORMAÇÃO'),103) + ' Seção ' + CONVERT(varchar, ISNULL(SECAOPUBLICACAO,'FALTA INFORMAÇÃO')) + ', Pg. ' + 
				CONVERT(varchar, ISNULL(PAGINAPUBLICACAO,'FALTA INFORMAÇÃO')) + '.'
					FROM SAUTORIZACAOCURSO
				WHERE IDHABILITACAOFILIAL = shabilitacaofilial.idhabilitacaofilial
				AND ULTIMAAUTORIZACAOVALIDA = 'S'
				ORDER BY CODAUTORIZACURSO DESC )
END AUTORIZACAO,

(select top 1 cast(sautorizacaofilial.recautoriz as varchar(8000)) 
   from sautorizacaofilial 
  where sautorizacaofilial.codcoligada = shabilitacaofilial.codcoligada 
    and sautorizacaofilial.codfilial = shabilitacaofilial.codfilial
  order by sautorizacaofilial.codautorizacao desc) RECAUTORIZ,
/*'Centro Universitário Adventista de ' + GFILIAL.CIDADE + ' - Cód. e-MEC 1365' CIDADEFILIAL*/
'Centro Universitário Adventista de São Paulo - Cód. e-MEC 1365' CIDADEFILIAL,

(SELECT TOP 1 C.NOME FROM SCOORDENADOR (NOLOCK) 
INNER JOIN PPESSOA C (NOLOCK)  ON 
C.CODIGO = SCOORDENADOR.CODPESSOA
LEFT JOIN PCODINSTRUCAO (NOLOCK) ON 
C.GRAUINSTRUCAO = PCODINSTRUCAO.CODINTERNO
WHERE 	SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
		SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
		SCOORDENADOR.FUNCAO = 'C' )COORDENADOR,

(SELECT TOP 1 PCODINSTRUCAO.DESCRICAO FROM SCOORDENADOR (NOLOCK) 
INNER JOIN PPESSOA C (NOLOCK)  ON 
C.CODIGO = SCOORDENADOR.CODPESSOA
LEFT JOIN PCODINSTRUCAO (NOLOCK) ON 
C.GRAUINSTRUCAO = PCODINSTRUCAO.CODINTERNO
WHERE 	SCOORDENADOR.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
		SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
		SCOORDENADOR.FUNCAO = 'C' ) GRAUINST


FROM SHABILITACAOFILIAL (NOLOCK)
/*INNER JOIN SAUTORIZACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SAUTORIZACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODFILIAL = SAUTORIZACAOFILIAL.CODFILIAL*/

INNER JOIN SCURSO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	
LEFT JOIN SMODALIDADECURSO (NOLOCK) 
      ON (SCURSO.CODCOLIGADA = SMODALIDADECURSO.CODCOLIGADA AND 
	      SCURSO.CODMODALIDADECURSO = SMODALIDADECURSO.CODMODALIDADECURSO)
	      
INNER JOIN SCURSOCOMPL (NOLOCK)
	ON SCURSO.CODCOLIGADA = SCURSOCOMPL.CODCOLIGADA
	AND SCURSO.CODCURSO = SCURSOCOMPL.CODCURSO
INNER JOIN SHABILITACAO (NOLOCK)
	ON SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SCURSO.CODCOLIGADA = SHABILITACAO.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAO.CODCURSO
INNER JOIN SGRADE (NOLOCK)
	ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN STURNO (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO

LEFT JOIN SCURSOMEC (NOLOCK)
    ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
    AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
LEFT JOIN GFILIAL (NOLOCK)
    ON GFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
    AND GFILIAL.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
WHERE 
SHABILITACAOFILIAL.CODCOLIGADA = :P_CODCOLIGADA
AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
";4373;;;;24/03/2022;consultor1.totvs;1;1;1;1;;;;0;38d4a3b9-75a1-48d6-9c5a-12f670fbb109;0;;6544;consultor1.totvs;24/03/2022;consultor1.totvs;24/03/2022;0
S;EDUREL009.CC.03;Espaço Diversificado;"SELECT LICAOCASA,
	CASE WHEN RIGHT(CAST(SDISCIPLINA.CH / 4 AS decimal(10,1)),2) <> '.0' 
	THEN CAST(CAST((SDISCIPLINA.CH / 4) AS decimal(10,1)) AS varchar) + ' H' 
	ELSE CAST(CAST((SDISCIPLINA.CH / 4) AS INT) AS varchar) + ' H' END CH
	
	FROM SPLANOAULA
		INNER JOIN STURMADISC (NOLOCK) ON
			STURMADISC.IDTURMADISC = SPLANOAULA.IDTURMADISC
		INNER JOIN SDISCIPLINA (NOLOCK) ON
			SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
WHERE SPLANOAULA.codcoligada = :P_CODCOLIGADA_N
AND  SPLANOAULA.IDTURMADISC = :P_IDTURMADISC_N
AND LICAOCASA IS NOT NULL 
AND LICAOCASA != ''";633;;;;29/03/2022;consultor1.totvs;1;1;1;1;;;;0;f42b6190-ac11-40a3-91f3-24c3fe657203;0;;-12852;consultor1.totvs;24/03/2022;consultor1.totvs;29/03/2022;0
S;EDUREL009.CC.04;Dados Para SubRelatório;"SELECT CODCOLIGADA,IDTURMADISC
FROM STURMADISC
WHERE CODCOLIGADA = :CODCOLIGADA
	AND IDTURMADISC = :IDTURMADISC";114;;;;07/04/2022;consultor1.totvs;1;1;1;1;;;;0;61a9d52e-108e-4bc2-b384-2aef3fdb7ebc;0;;20725;consultor1.totvs;07/04/2022;consultor1.totvs;07/04/2022;0
S;EDUREL009.CC.05;Complemento Disciplinas;"SELECT 
	STUR.CODCOLIGADA,
	STUR.IDTURMADISC,
	DOCENTE.NOME AS 'NOMEDOCENTES',
	STUR.CODDISC,
	SPLETIVO.CODPERLET,
		CAST(SDISCIPLINA.NUMCREDITOS AS DECIMAL(10,2)) AS NUMCREDITO,
	CAST(CAST(SDISCIPLINA.CH AS INT) AS VARCHAR) + ' H' AS TOTALCH,
	CAST(CAST((SDISCIPLINA.CH / 4) AS INT) AS varchar) + ' H' AS CHSD,
	CAST(CAST(SDISCIPLINA.CH AS INT) - CAST((SDISCIPLINA.CH / 4) AS INT) AS VARCHAR) + ' H' AS CHSA,
	EM.DESCRICAO AS 'EMENTA',
	PE.DESCRICAO AS 'PERFILEGRESSO',
	PP.DESCRICAO AS 'COMPHAB',
	OB.DESCRICAO AS 'OBJETIVO',
	AV.DESCRICAO AS 'INSCCA',
	BB.DESCRICAO AS 'BIBLIOBASICA',
	BC.DESCRICAO AS 'BIBLIOCOMPLEMENTAR',
	IFI.DESCRICAO AS 'INTFILOSOFIA',
	RE.DESCRICAO AS 'DESCINTER',
	AC.DESCRICAO AS 'ARTCIENTIFICO',
	  ( SELECT TOP 1 PROF.NOME PROFESSOR
   FROM STURMADISC TUR(NOLOCK)
                    LEFT OUTER JOIN SHORARIOTURMA (NOLOCK) ON TUR.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SHORARIOTURMA.IDTURMADISC  
     LEFT OUTER JOIN SHORARIO (NOLOCK) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR 
     LEFT OUTER JOIN SPROFESSORTURMA (NOLOCK) ON TUR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND TUR.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC 
     LEFT OUTER JOIN SPROFESSOR (NOLOCK) ON SPROFESSOR.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA AND SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF 
     LEFT OUTER JOIN PPESSOA PROF(NOLOCK) ON PROF.CODIGO =  SPROFESSOR.CODPESSOA 
   WHERE TUR.IDTURMADISC = STUR.IDTURMADISC
   AND  TUR.CODCOLIGADA = STUR.CODCOLIGADA
  ) AS PROFESSOR,
	SDISCIPLINA.NOME AS 'DISCIPLINA'
FROM STURMADISC STUR
INNER JOIN SDISCIPLINA ON SDISCIPLINA.CODCOLIGADA = STUR.CODCOLIGADA
	AND SDISCIPLINA.CODDISC = STUR.CODDISC
 INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STUR.CODCOLIGADA
 	AND SPLETIVO.IDPERLET = STUR.IDPERLET
  
     OUTER APPLY (SELECT STURMADISC.CODDISC,
						   STUFF((SELECT ' / ' + PPESSOA.NOME
									FROM   STURMADISC
										JOIN SPLETIVO 
											ON SPLETIVO.CODCOLIGADA=STURMADISC.CODCOLIGADA
											AND SPLETIVO.IDPERLET=STURMADISC.IDPERLET
										LEFT JOIN SPROFESSORTURMA 
											ON SPROFESSORTURMA.CODCOLIGADA=STURMADISC.CODCOLIGADA
											AND SPROFESSORTURMA.IDTURMADISC=STURMADISC.IDTURMADISC
											AND ISNULL(SPROFESSORTURMA.TIPOPROF,'T')<>'D'
										LEFT JOIN SPROFESSOR
											ON SPROFESSOR.CODCOLIGADA=SPROFESSORTURMA.CODCOLIGADA
											AND SPROFESSOR.CODPROF=SPROFESSORTURMA.CODPROF
										LEFT JOIN STITULACAO
											ON STITULACAO.CODTITULACAO=SPROFESSOR.CODTITULACAO
										LEFT JOIN PPESSOA 
											ON PPESSOA.CODIGO=SPROFESSOR.CODPESSOA
								WHERE  STURMADISC.CODCOLIGADA= STUR.CODCOLIGADA
										AND STURMADISC.IDTURMADISC= STUR.IDTURMADISC
								ORDER BY SPROFESSORTURMA.TIPOPROF,PPESSOA.NOME	
								FOR XML PATH('')), 1, 2, '')AS NOME
		            FROM   STURMADISC 
						   JOIN SPLETIVO 
						     ON SPLETIVO.CODCOLIGADA=STURMADISC.CODCOLIGADA
							    AND SPLETIVO.IDPERLET=STURMADISC.IDPERLET
						   LEFT JOIN SPROFESSORTURMA 
						     ON SPROFESSORTURMA.CODCOLIGADA=STURMADISC.CODCOLIGADA
							    AND SPROFESSORTURMA.IDTURMADISC=STURMADISC.IDTURMADISC
							    AND ISNULL(SPROFESSORTURMA.TIPOPROF,'T')='T'
						   LEFT JOIN SPROFESSOR
						     ON SPROFESSOR.CODCOLIGADA=SPROFESSORTURMA.CODCOLIGADA
							    AND SPROFESSOR.CODPROF=SPROFESSORTURMA.CODPROF
						   LEFT JOIN PPESSOA 
						     ON PPESSOA.CODIGO=SPROFESSOR.CODPESSOA
					WHERE  STURMADISC.CODCOLIGADA= STUR.CODCOLIGADA
					       AND STURMADISC.IDTURMADISC= STUR.IDTURMADISC
				    GROUP BY STURMADISC.CODDISC) DOCENTE
				    
				    
				    

OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'EM'
) AS EM


OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'PE'
) AS PE
  
OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'PP'
) AS PP

OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'OB'
) AS OB


OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'AV'
) AS AV


OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'BB'
) AS BB
		
		
		
OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'BC'
) AS BC
		
		
		
OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'IF'
) AS IFI
		
		
		
OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'RE'
) AS RE
		
		
OUTER APPLY(
SELECT 
	SCOMPLDISC.*
FROM SCOMPLDISC 
WHERE SCOMPLDISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
  AND SCOMPLDISC.CODDISC = SDISCIPLINA.CODDISC
  AND SCOMPLDISC.IDPERLET = STUR.IDPERLET
  AND SCOMPLDISC.TIPO = 'AC'
) AS AC
		

		
				    
  
WHERE STUR.CODCOLIGADA = :P_CODCOLIGADA
AND  STUR.IDTURMADISC = :P_IDTURMADISC
AND  STUR.CODDISC = :P_CODDISC
AND  STUR.CODFILIAL = :P_CODFILIAL
ORDER BY CODTURMA

";6410;;;;21/06/2022;consultor1.totvs;1;1;1;1;;;;0;531a21c0-db07-446d-819e-26e1dacd0b15;0;;-25787;consultor1.totvs;07/06/2022;consultor1.totvs;21/06/2022;0
S;EDUTOTVSCAN;Consulta TOTVS/CANVAS;;0;;;;26/01/2021;matheus.amaral;1;1;1;1;;;;0;99a4d291-f994-485f-a06d-c6f23cdb8aa4;0;;-22204;matheus.amaral;26/01/2021;matheus.amaral;26/01/2021;0
S;EDUTOTVSCAN.001;Consulta Todas Disciplinas, Todos Alunos - CANVAS;"SELECT  
	Campus,
	CourseId,
	CourseName,
	Name,
	Email,
	UserName,
	Password,
	RA,
	Document,
	Role,
	CanvasId,
	SendToCanvas,
	Active,
	TurmaCod,
	TurmaNome,
	JUNCAO,	
	RASIGA,
	CODPERLET,
	PluginData,
	Session,
	max(LASTUPDATE) LASTUPDATE
FROM 
	z_UNASP_CANVAS
	
WHERE 
	(RA = :ra OR :ra = '' OR :ra = '0')
	AND (COURSEID = :coddisc OR :coddisc = '' OR :coddisc = '0')
	AND (DTINICIO >= :date OR :date = '')
	AND (CODPERLET like :codperlet OR :codperlet = '' OR :codperlet = '0')
	and (CANVASID = :canvasid OR :canvasid = '' OR :canvasid = '0')

	
	/*and name='Karla Caldas Ehrenberg'
	
	and CanvasId in (6061,6062,6063,6064)*/
	
	
Group by
	Campus, 
	CourseId,
	CourseName,
	Name,
	Email,
	UserName,
	Password,
	RA,
	Document,
	Role,
	CanvasId,
	SendToCanvas,
	Active, 
	TurmaCod,
	TurmaNome,
	JUNCAO,	
	RASIGA,
	CODPERLET,
	PluginData,
	Session
ORDER BY CourseName, Name;
";937;;;;27/04/2022;matheus.amaral;1;1;1;1;;;;0;4592b246-20e4-4fc6-9ae7-417c5d3f2b19;0;;5922;matheus.amaral;26/01/2021;matheus.amaral;27/04/2022;0
S;Email.001;Envio de e-mail - Liberação de matrícula;"SELECT 
	PPESSOA.NOME Aluno, st.DESCRICAO Status, TM.DESCRICAO Tipo , PPESSOA.EMAIL email, SCURSO.NOME Curso, GFILIAL.NOMEFANTASIA,
	CASE WHEN (
		SELECT MAX(IDENVIO) 
		FROM GMAILSEND 
		WHERE PPESSOA.EMAIL = CAST(GMAILSEND.TOADDR AS VARCHAR(100)) AND SUBJECT LIKE '%MATRICULA%') IS NOT NULL THEN 'Email enviado' ELSE 'Sem envio' END AS Envio,
	ps.NOME Processo_Seletivo
FROM SMATRICPL (nolock)
	inner join SSTATUS (nolock) st on st.CODCOLIGADA = SMATRICPL.CODCOLIGADA and st.CODSTATUS = SMATRICPL.CODSTATUS
	
	left join STIPOMATRICULA (nolock) TM ON TM.CODCOLIGADA=SMATRICPL.CODCOLIGADA AND TM.CODTIPOMAT=SMATRICPL.CODTIPOMAT
	left join SPSINSCRICAOAREAOFERTADA (nolock) insc on insc.CODCOLIGADAMAT = SMATRICPL.CODCOLIGADA and insc.IDPERLET = SMATRICPL.IDPERLET and insc.IDHABFILIALMAT = SMATRICPL.IDHABILITACAOFILIAL and insc.RAMAT = SMATRICPL.RA
	left join SPSPROCESSOSELETIVO (nolock) ps on ps.CODCOLIGADA = insc.CODCOLIGADA and ps.IDPS = insc.IDPS

	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
	INNER JOIN SHABILITACAOFILIAL (nolock) ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SCURSO (nolock) ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SPLETIVO (nolock) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	INNER JOIN GFILIAL (nolock) ON SMATRICPL.CODFILIAL = GFILIAL.CODFILIAL
WHERE 
	CODPERLET =:PeriodoLetivo
	AND SCURSO.NOME LIKE '%' + :Curso + '%'";1719;;;;24/06/2021;mestre;1;1;1;1;;;;1;9eb58445-bcf2-46de-a646-b05b45f1393d;0;;-6588;mestre;31/05/2021;mestre;24/06/2021;0
S;Email.002;Envio da email: Finalize sua Matrícula! (Graduação);"SELECT 
PPESSOA.NOME Aluno , PPESSOA.EMAIL email, SCURSO.NOME Curso,GFILIAL.NOMEFANTASIA
 
FROM SMATRICPL
INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN SHABILITACAOFILIAL (nolock) ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SCURSO (nolock) ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO (nolock) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN GFILIAL (nolock) ON SMATRICPL.CODFILIAL = GFILIAL.CODFILIAL
WHERE 
	CODPERLET = '2021/2'
	and PPESSOA.EMAIL not in (
		SELECT distinct 
			convert(varchar(100), GMAILSEND.TOADDR) Email 
		FROM 
			GMAILSEND 
		WHERE 
			SUBJECT='Finalize sua Matrícula!')
 			";986;;;;14/06/2021;maycon;1;1;1;1;;;;0;d3286acf-b08d-4781-8a12-dfaded713af1;0;;12843;mestre;02/06/2021;maycon;14/06/2021;0
S;Email.003;Envio de e-mail: O EAD mudou e agora temos um novo sistema;"SELECT 
	PPESSOA.CODUSUARIO,
	SMATRICPL.RA,
	PPESSOA.NOME NOMEALUNO,
	st.DESCRICAO Status,
	TM.DESCRICAO Tipo,
	PPESSOA.EMAIL,
	SCURSO.NOME Curso,
	GFILIAL.NOMEFANTASIA,
	CASE WHEN (
		SELECT MAX(IDENVIO) 
		FROM GMAILSEND 
		WHERE PPESSOA.EMAIL = CAST(GMAILSEND.TOADDR AS VARCHAR(100)) AND SUBJECT LIKE '%O UNASP mudou e agora temos um novo sistema%') IS NOT NULL THEN 'Email enviado' ELSE 'Sem envio' END AS Envio,
	ps.NOME Processo_Seletivo
FROM SMATRICPL (nolock)
	inner join SSTATUS (nolock) st on st.CODCOLIGADA = SMATRICPL.CODCOLIGADA and st.CODSTATUS = SMATRICPL.CODSTATUS
	
	left join STIPOMATRICULA (nolock) TM ON TM.CODCOLIGADA=SMATRICPL.CODCOLIGADA AND TM.CODTIPOMAT=SMATRICPL.CODTIPOMAT
	left join SPSINSCRICAOAREAOFERTADA (nolock) insc on insc.CODCOLIGADAMAT = SMATRICPL.CODCOLIGADA and insc.IDPERLET = SMATRICPL.IDPERLET and insc.IDHABFILIALMAT = SMATRICPL.IDHABILITACAOFILIAL and insc.RAMAT = SMATRICPL.RA
	left join SPSPROCESSOSELETIVO (nolock) ps on ps.CODCOLIGADA = insc.CODCOLIGADA and ps.IDPS = insc.IDPS

	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
	INNER JOIN SHABILITACAOFILIAL (nolock) ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SCURSO (nolock) ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SPLETIVO (nolock) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	INNER JOIN GFILIAL (nolock) ON SMATRICPL.CODFILIAL = GFILIAL.CODFILIAL
WHERE 
	CODPERLET =:PeriodoLetivo
	/*AND SCURSO.NOME LIKE '%' + :Curso + '%'*/
	/*AND st.DESCRICAO = :NomeStatus*/
	AND TM.DESCRICAO = 'Rematrícula'
	AND SMATRICPL.CODFILIAL = :CodFilial
	AND SHABILITACAOFILIAL.CODTIPOCURSO = :CodTipoCurso
	AND PPESSOA.EMAIL NOT IN (
		SELECT CAST(GMAILSEND.TOADDR AS VARCHAR(100)) EMAIL
		FROM GMAILSEND 
		WHERE SUBJECT LIKE '%O EAD mudou e agora temos um novo sistema%')";2139;;;;28/06/2021;maycon;1;1;1;1;;;;0;e8294179-46a2-4164-8f50-de19ed37c91a;0;;-9034;maycon;24/06/2021;maycon;28/06/2021;0
S;Email.003.1;Envio de e-mail: O UNASP mudou e agora temos um novo sistema;"SELECT 
	PPESSOA.CODUSUARIO,
	SMATRICPL.RA,
	PPESSOA.NOME NOMEALUNO,
	st.DESCRICAO Status,
	TM.DESCRICAO Tipo,
	PPESSOA.EMAIL,
	SCURSO.NOME Curso,
	GFILIAL.NOMEFANTASIA,
	CASE WHEN (
		SELECT MAX(IDENVIO) 
		FROM GMAILSEND 
		WHERE PPESSOA.EMAIL = CAST(GMAILSEND.TOADDR AS VARCHAR(100)) AND SUBJECT LIKE '%O UNASP mudou e agora temos um novo sistema%') IS NOT NULL THEN 'Email enviado' ELSE 'Sem envio' END AS Envio,
	ps.NOME Processo_Seletivo
FROM SMATRICPL (nolock)
	inner join SSTATUS (nolock) st on st.CODCOLIGADA = SMATRICPL.CODCOLIGADA and st.CODSTATUS = SMATRICPL.CODSTATUS
	
	left join STIPOMATRICULA (nolock) TM ON TM.CODCOLIGADA=SMATRICPL.CODCOLIGADA AND TM.CODTIPOMAT=SMATRICPL.CODTIPOMAT
	left join SPSINSCRICAOAREAOFERTADA (nolock) insc on insc.CODCOLIGADAMAT = SMATRICPL.CODCOLIGADA and insc.IDPERLET = SMATRICPL.IDPERLET and insc.IDHABFILIALMAT = SMATRICPL.IDHABILITACAOFILIAL and insc.RAMAT = SMATRICPL.RA
	left join SPSPROCESSOSELETIVO (nolock) ps on ps.CODCOLIGADA = insc.CODCOLIGADA and ps.IDPS = insc.IDPS

	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
	INNER JOIN SHABILITACAOFILIAL (nolock) ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SCURSO (nolock) ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SPLETIVO (nolock) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	INNER JOIN GFILIAL (nolock) ON SMATRICPL.CODFILIAL = GFILIAL.CODFILIAL
WHERE 
	CODPERLET =:PeriodoLetivo
	/*AND SCURSO.NOME LIKE '%' + :Curso + '%'*/
	/*AND st.DESCRICAO = :NomeStatus*/
	AND TM.DESCRICAO = 'Rematrícula'
	AND SMATRICPL.CODFILIAL = :CodFilial
	AND SHABILITACAOFILIAL.CODTIPOCURSO = :CodTipoCurso
	AND SMATRICPL.RA NOT IN (022365,057092,054619,053411,030422,043899,054944,023648,022506,026694,059827,001438,048842,047096,049820,060849,016895,035763,020308)
	AND PPESSOA.EMAIL NOT IN (
		SELECT CAST(GMAILSEND.TOADDR AS VARCHAR(100)) EMAIL
		FROM GMAILSEND 
		WHERE SUBJECT LIKE '%O UNASP mudou e agora temos um novo sistema%')";2302;;;;06/07/2021;maycon;1;1;1;1;;;;0;e8294179-46a2-4164-8f50-de19ed37c91a;0;;-31777;maycon;25/06/2021;maycon;06/07/2021;0
S;Email.004;teste ;"SELECT 
	PPESSOA.CODUSUARIO,
	SMATRICPL.RA,
	PPESSOA.NOME NOMEALUNO,
	st.DESCRICAO Status,
	TM.DESCRICAO Tipo,
	PPESSOA.EMAIL,
	SCURSO.NOME Curso,
	GFILIAL.NOMEFANTASIA,
	CASE WHEN (
		SELECT MAX(IDENVIO) 
		FROM GMAILSEND 
		WHERE PPESSOA.EMAIL = CAST(GMAILSEND.TOADDR AS VARCHAR(100)) AND SUBJECT LIKE '%O UNASP mudou e agora temos um novo sistema%') IS NOT NULL THEN 'Email enviado' ELSE 'Sem envio' END AS Envio,
	ps.NOME Processo_Seletivo
FROM SMATRICPL (nolock)
	inner join SSTATUS (nolock) st on st.CODCOLIGADA = SMATRICPL.CODCOLIGADA and st.CODSTATUS = SMATRICPL.CODSTATUS
	
	left join STIPOMATRICULA (nolock) TM ON TM.CODCOLIGADA=SMATRICPL.CODCOLIGADA AND TM.CODTIPOMAT=SMATRICPL.CODTIPOMAT
	left join SPSINSCRICAOAREAOFERTADA (nolock) insc on insc.CODCOLIGADAMAT = SMATRICPL.CODCOLIGADA and insc.IDPERLET = SMATRICPL.IDPERLET and insc.IDHABFILIALMAT = SMATRICPL.IDHABILITACAOFILIAL and insc.RAMAT = SMATRICPL.RA
	left join SPSPROCESSOSELETIVO (nolock) ps on ps.CODCOLIGADA = insc.CODCOLIGADA and ps.IDPS = insc.IDPS

	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
	INNER JOIN SHABILITACAOFILIAL (nolock) ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SCURSO (nolock) ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SPLETIVO (nolock) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	INNER JOIN GFILIAL (nolock) ON SMATRICPL.CODFILIAL = GFILIAL.CODFILIAL
WHERE 
	CODPERLET ='2021/2'
	AND PPESSOA.CODUSUARIO = '068757'
	AND GFILIAL.CODFILIAL = 3";1814;;;;24/06/2021;maycon;1;1;1;1;;;;0;f069aa2b-184a-4207-bd55-ff51bfef1938;0;;473;maycon;24/06/2021;maycon;24/06/2021;0
S;Email.005;Envio de e-mail - Somente rematrícula;"SELECT 
	PPESSOA.CODUSUARIO,
	SMATRICPL.RA,
	PPESSOA.NOME NOMEALUNO,
	st.DESCRICAO Status,
	TM.DESCRICAO Tipo,
	PPESSOA.EMAIL,
	SCURSO.NOME Curso,
	GFILIAL.NOMEFANTASIA,
	CASE WHEN (
		SELECT MAX(IDENVIO) 
		FROM GMAILSEND 
		WHERE PPESSOA.EMAIL = CAST(GMAILSEND.TOADDR AS VARCHAR(100)) AND SUBJECT LIKE '%O UNASP mudou e agora temos um novo sistema%') IS NOT NULL THEN 'Email enviado' ELSE 'Sem envio' END AS Envio,
	ps.NOME Processo_Seletivo
FROM SMATRICPL (nolock)
	inner join SSTATUS (nolock) st on st.CODCOLIGADA = SMATRICPL.CODCOLIGADA and st.CODSTATUS = SMATRICPL.CODSTATUS
	
	left join STIPOMATRICULA (nolock) TM ON TM.CODCOLIGADA=SMATRICPL.CODCOLIGADA AND TM.CODTIPOMAT=SMATRICPL.CODTIPOMAT
	left join SPSINSCRICAOAREAOFERTADA (nolock) insc on insc.CODCOLIGADAMAT = SMATRICPL.CODCOLIGADA and insc.IDPERLET = SMATRICPL.IDPERLET and insc.IDHABFILIALMAT = SMATRICPL.IDHABILITACAOFILIAL and insc.RAMAT = SMATRICPL.RA
	left join SPSPROCESSOSELETIVO (nolock) ps on ps.CODCOLIGADA = insc.CODCOLIGADA and ps.IDPS = insc.IDPS

	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
	INNER JOIN SHABILITACAOFILIAL (nolock) ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SCURSO (nolock) ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SPLETIVO (nolock) ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	INNER JOIN GFILIAL (nolock) ON SMATRICPL.CODFILIAL = GFILIAL.CODFILIAL
WHERE 
	CODPERLET =:PeriodoLetivo
	/*AND SCURSO.NOME LIKE '%' + :Curso + '%'*/
	AND st.DESCRICAO = :NomeStatus
	AND TM.DESCRICAO = 'Rematrícula'
	AND SMATRICPL.CODFILIAL = :CodFilial
	AND SHABILITACAOFILIAL.CODTIPOCURSO = :CodTipoCurso
	AND SCURSO.NOME <> 'Pensionato - EC'
";2004;;;;26/07/2021;maycon;1;1;1;1;;;;0;e8294179-46a2-4164-8f50-de19ed37c91a;0;;-18035;maycon;26/07/2021;maycon;26/07/2021;0
S;EmailAlunosCAM;Email para Alunos Com Ajuste de Matriculas;"select distinct 
	v.RA, 
	v.NomPessoa, 
	v.EMAIL, 
	case when v.DTNASCIMENTO is null then '12345678' else format(v.DTNASCIMENTO,'ddMMyyyy') end SenhaPadrao,
	p.CODUSUARIO	
from 
	v_Unasp_SMATRICPL 	(NOLOCK) v	
	INNER JOIN PPESSOA 	(NOLOCK) p 	ON p.CODIGO = v.CODPESSOA
where 
	v.CODTIPOCURSO = :CODTIPOCURSO 
	AND v.CODFILIAL like '%' + :CODFILIAL + '%'
	AND v.CODPERLET = :CODPERLET 
	AND v.NomStatus not in ('Trancado', 'Cancelado')
	AND v.NomStatus like '%' + :Status + '%'
	AND v.NomTipoMatricula LIKE '%' + :Tipo_Matricula + '%' 
	and v.CodCurso like '%' + :CodCurso + '%'
	AND v.RA LIKE '%' + :RA + '%'
	AND v.NomCurso NOT LIKE '%pensionato%'
	and v.RA in (
		SELECT
			a.RA
		FROM 
			HATENDIMENTOBASE				(NOLOCK) ab
			INNER JOIN HATENDIMENTOEXT		(NOLOCK) ae ON ab.CODCOLIGADA = ae.CODCOLIGADA AND ab.CODLOCAL = ae.CODLOCAL AND ab.CODATENDIMENTO = ae.CODATENDIMENTO
			LEFT JOIN SALUNO			    (NOLOCK) a	ON ae.COLIGADAALUNO = a.CODCOLIGADA AND ae.RAALUNO = a.RA
			LEFT JOIN PPESSOA				(NOLOCK) pp	ON pp.CODIGO = a.CODPESSOA OR pp.CODIGO = ae.CODPESSOA
			LEFT JOIN HTIPOATENDIMENTO		(NOLOCK) ta ON ta.CODCOLIGADA = ab.CODCOLIGADA AND ta.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO
			LEFT JOIN HTAREFA				(NOLOCK) t  ON t.CODCOLIGADA = ab.CODCOLIGADA AND t.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO AND t.CODTAREFA = ab.CODTAREFA              
		WHERE 
			ab.CODSTATUS = 'A' 
			AND ab.CODCOLIGADARESP = 1
			and ab.CODATENDIMENTO>101
			AND ta.NOME = 'Ajuste de Matrícula em Disciplinas/Turno/Turma'
			AND t.NOME in ('Coordenador do Curso','Secretaria'))";1584;;;;26/07/2022;isaldo;1;1;1;1;;;;0;84782bc5-8d1b-4d50-a130-a975acb1b897;0;;11173;isaldo;26/07/2022;isaldo;26/07/2022;0
S;EmailAlunosSAM;Email para Alunos Sem Ajuste de Matriculas;"select distinct 
	v.RA, 
	v.NomPessoa, 
	v.EMAIL, 
	case when v.DTNASCIMENTO is null then '12345678' else format(v.DTNASCIMENTO,'ddMMyyyy') end SenhaPadrao,
	p.CODUSUARIO	
from 
	v_Unasp_SMATRICPL 	(NOLOCK) v	
	INNER JOIN PPESSOA 	(NOLOCK) p 	ON p.CODIGO = v.CODPESSOA
where 
	v.CODTIPOCURSO = :CODTIPOCURSO 
	AND v.CODFILIAL like '%' + :CODFILIAL + '%'
	AND v.CODPERLET = :CODPERLET 
	AND v.NomStatus not in ('Trancado', 'Cancelado')
	AND v.NomStatus like '%' + :Status + '%'
	AND v.NomTipoMatricula LIKE '%' + :Tipo_Matricula + '%' 
	and v.CodCurso like '%' + :CodCurso + '%'
	AND v.RA LIKE '%' + :RA + '%'
	AND v.NomCurso NOT LIKE '%pensionato%'
	and v.RA not in (
		SELECT
			a.RA
		FROM 
			HATENDIMENTOBASE				(NOLOCK) ab
			INNER JOIN HATENDIMENTOEXT		(NOLOCK) ae ON ab.CODCOLIGADA = ae.CODCOLIGADA AND ab.CODLOCAL = ae.CODLOCAL AND ab.CODATENDIMENTO = ae.CODATENDIMENTO
			LEFT JOIN SALUNO			    (NOLOCK) a	ON ae.COLIGADAALUNO = a.CODCOLIGADA AND ae.RAALUNO = a.RA
			LEFT JOIN PPESSOA				(NOLOCK) pp	ON pp.CODIGO = a.CODPESSOA OR pp.CODIGO = ae.CODPESSOA
			LEFT JOIN HTIPOATENDIMENTO		(NOLOCK) ta ON ta.CODCOLIGADA = ab.CODCOLIGADA AND ta.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO
			LEFT JOIN HTAREFA				(NOLOCK) t  ON t.CODCOLIGADA = ab.CODCOLIGADA AND t.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO AND t.CODTAREFA = ab.CODTAREFA              
		WHERE 
			ab.CODSTATUS = 'A' 
			AND ab.CODCOLIGADARESP = 1
			and ab.CODATENDIMENTO>101
			AND ta.NOME = 'Ajuste de Matrícula em Disciplinas/Turno/Turma'
			AND t.NOME in ('Coordenador do Curso','Secretaria'))";1588;;;;26/07/2022;isaldo;1;1;1;1;;;;0;5ef165ad-2ae0-4ee1-adb7-904b11205c66;0;;22295;isaldo;26/07/2022;isaldo;26/07/2022;0
S;EmailCursando;Informações para Alunos;"select distinct 
	v.RA, 
	v.NomPessoa, 
	v.EMAIL, 
	case when v.DTNASCIMENTO is null then '12345678' else format(v.DTNASCIMENTO,'ddMMyyyy') end SenhaPadrao,
	p.CODUSUARIO	
from 
	v_Unasp_SMATRICPL 	(NOLOCK) v	
	INNER JOIN PPESSOA 	(NOLOCK) p 	ON p.CODIGO = v.CODPESSOA
where 
	v.CODTIPOCURSO = :CODTIPOCURSO 
	AND v.CODFILIAL like '%' + :CODFILIAL + '%'
	AND v.CODPERLET = :CODPERLET 
	AND v.NomStatus not in ('Trancado', 'Cancelado')
	AND v.NomStatus like '%' + :Status + '%'
	AND v.NomTipoMatricula LIKE '%' + :Tipo_Matricula + '%' 
	and v.CodCurso like '%' + :CodCurso + '%'
	AND v.RA LIKE '%' + :RA + '%'
	AND v.NomCurso NOT LIKE '%pensionato%'";666;;;;07/03/2022;isaldo;1;1;1;1;;;;0;c6af010a-b8da-4383-adfa-8ae22c38d011;0;;-13907;isaldo;15/09/2021;isaldo;07/03/2022;0
S;EmailExtensão;Email para cursos extensão (CanvasId);"select 
	name, email, username username, password 
from 
	z_UNASP_CANVAS 
WHERE 
	CanvasId=:CanvasId";105;;;;01/09/2021;mestre;1;1;1;1;;;;0;4ba19659-df9a-473d-86b7-34a2e0c07474;0;;12690;mestre;01/09/2021;isaldo;15/09/2021;0
S;EMAILRA;Envio de email com o novo RA;"SELECT
	P.NOME,
	A.RA,
	AC.RASIGA,
	REPLACE((CONVERT(VARCHAR,P.DTNASCIMENTO,103)),'/','') DATANASCIMENTO
FROM
	SALUNO	(NOLOCK) A
	INNER JOIN PPESSOA (NOLOCK) P ON P.CODIGO=A.CODPESSOA
	INNER JOIN SALUNOCOMPL (NOLOCK) AC ON AC.RA=A.RA
WHERE
	A.RA = :RA3
	AND A.CODCOLIGADA = :CODCOLIGADA1";298;;;;26/05/2021;mestre;1;1;1;1;;;;0;514c4b31-8279-4018-904f-5aa903dbec1b;0;;520;maycon;25/05/2021;mestre;26/05/2021;0
S;EmailRematricula;Alunos que não fizeram rematrícula no próximo período letivo;"SELECT DISTINCT
 X.RA,
 X.ALUNO,
 X.EMAIL,
 X.SENHAPADRAO,
 X.CODUSUARIO
 
FROM
(SELECT DISTINCT
  CASE WHEN PPESSOA.DTNASCIMENTO is null then '12345678' 
	    ELSE FORMAT(PPESSOA.DTNASCIMENTO,'ddMMyyyy') end SenhaPadrao,
  PPESSOA.CODUSUARIO,
  PPESSOA.EMAIL,
 
  CASE WHEN SHABILITACAOALUNO.CODSTATUS = 11 THEN 'FORMADO'
 	   ELSE SSTATUS.DESCRICAO END STATUS,

 SCONTRATO.CODCOLIGADA COLIGADA,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO NIVEL,
 SCONTRATO.RA,
 SCONTRATO.IDPERLET,
 SCONTRATO.IDHABILITACAOFILIAL,
 SCONTRATO.CODCONTRATO CONTRATO,
 PPESSOA.NOME ALUNO,
 SCURSO.NOME CURSO,
 SGRADE.DESCRICAO MATRIZ,
 	 	
 (SELECT DISTINCT
   'SIM' 
  
  FROM
   SMATRICPL SM (NOLOCK)
 
   INNER JOIN SCONTRATO SC (NOLOCK)	     	ON SC.CODCOLIGADA = SM.CODCOLIGADA AND 
 								   		   	   SC.IDPERLET = SM.IDPERLET AND 
 								   		   	   SC.IDHABILITACAOFILIAL = SM.IDHABILITACAOFILIAL AND 
 								   		   	   SC.RA = SM.RA
 								   
   INNER JOIN SPLETIVO SP (NOLOCK)			ON SP.CODCOLIGADA = SM.CODCOLIGADA AND 
 								   		   	   SP.IDPERLET = SM.IDPERLET
   INNER JOIN SHABILITACAOFILIAL SH (NOLOCK)ON SH.CODCOLIGADA = SC.CODCOLIGADA AND
 										   	   SH.IDHABILITACAOFILIAL = SC.IDHABILITACAOFILIAL 
  
   INNER JOIN SCURSO SCU (NOLOCK)			ON SCU.CODCOLIGADA = SH.CODCOLIGADA AND
 										   	   SCU.CODCURSO = SH.CODCURSO

  WHERE	SM.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SC.CODTIPOCURSO = SCONTRATO.CODTIPOCURSO
	AND SP.CODPERLET = :Próximo_Período
	AND SC.RA = SCONTRATO.RA
	AND SCU.NOME NOT LIKE '%pensionato%'
 	/*AND SH.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	AND SM.CODSTATUS <> 11*/
 ) MATRICULADO,
 1 QDE
 
 FROM
  SMATRICPL (NOLOCK)
 
  INNER JOIN SCONTRATO (NOLOCK)		    ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   		   SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND 
 								   		   SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 								   		   SCONTRATO.RA = SMATRICPL.RA
 								   
  INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   		   SPLETIVO.IDPERLET = SMATRICPL.IDPERLET

  INNER JOIN SSTATUS (NOLOCK)			ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   		   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS 								   

  INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   		   SALUNO.RA = SMATRICPL.RA 								   
 								   
  INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA  
 
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL 
 										   
  INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO

  INNER JOIN SGRADE (NOLOCK)				ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
  										   SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
  										   SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
  										   SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE 										   									   

  LEFT JOIN SHABILITACAOALUNO (NOLOCK)	ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
 										   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND
 										   SHABILITACAOALUNO.RA = SMATRICPL.RA

 WHERE	SMATRICPL.CODCOLIGADA = :Coligada
	AND SCONTRATO.CODTIPOCURSO = 1
	AND SPLETIVO.CODPERLET LIKE :Período_Atual
	AND SCURSO.NOME NOT LIKE '%pensionato%'
) X
WHERE X.STATUS = 'Concluído'
	AND X.MATRICULADO IS NULL
";3743;;;;05/01/2022;robson.canto;1;1;1;1;;;;0;44dc7342-a0ce-4be0-87d7-727558bc98cb;0;;-30799;robson.canto;05/01/2022;robson.canto;05/01/2022;0
S;Estatisticas 1;Total de alunos por Período letivo;"Select 
	s.DESCRICAO Status, count(*) Alunos
from 
	SMATRICPL (nolock) m 
	inner join v_UNASP_SHABILITACAOFILIAL (nolock)  hf on hf.IDHABILITACAOFILIAL=m.IDHABILITACAOFILIAL
	inner join SSTATUS (nolock)  s on s.CODSTATUS = m.CODSTATUS
	inner join SPLETIVO (nolock)  pl on pl.IDPERLET=m.IDPERLET
Where
	pl.CODPERLET='2021/1'
group By
	s.DESCRICAO
	";358;;;;12/05/2021;mestre;1;1;1;1;;;;0;758498d1-a66e-4302-b724-495b3fbe4b99;0;;18253;mestre;12/05/2021;mestre;12/05/2021;0
S;Estrangeiros;Alunos Estrangeiros Cursando em Período Aberto;"Select distinct 
	NomFilial, RA, NomPessoa, Email, Sexo, Telefone1, Telefone2, Telefone3, CPF, CARTIDENTIDADE Documento, Foto, Nacionalidade,
	NomTurma,NomTipoCurso, CODSTATUS, PERIODO, hfpl_CODPERLET, NomCurso, NomGrade, NomTurno, NomStatus
from 
	v_Unasp_SMATRICPL 
where 
	PeriodoAberto = 1 
	/*and NomStatus = 'Cursando' */
	AND hfpl_CODPERLET LIKE '%' + :CODPERLET + '%'
	and Brasileiro = 0
Order by 
	NomPessoa";427;;;;30/05/2022;consultor1.totvs;1;1;1;1;;;;0;ad3784e1-5800-4d87-be5e-10271b0ed538;0;;22452;isaldo;27/05/2022;consultor1.totvs;19/07/2022;0
S;ExcBolsa;Exclusão de Bolsa de Promoção para Alunos que possuem Bolsa 100%;"SELECT 
 SCONTRATO.CODCOLIGADA,
 SCONTRATO.RA,
 PPESSOA.NOME ALUNO,
 SCONTRATO.IDPERLET,
 SCONTRATO.CODCONTRATO,
 SBOLSAALUNO.CODBOLSA
 
FROM
 SCONTRATO (NOLOCK)
 
 INNER JOIN SALUNO (NOLOCK)		ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								   SALUNO.RA = SCONTRATO.RA
 								   
 INNER JOIN PPESSOA (NOLOCK)	ON PPESSOA.CODIGO = SALUNO.CODPESSOA  								   
 
 INNER JOIN SPLETIVO (NOLOCK)	ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								   SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
 								   
 INNER JOIN SBOLSAALUNO			ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 								   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 								   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 								   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET 								   

WHERE	SCONTRATO.CODCOLIGADA = 1
	AND SPLETIVO.CODPERLET LIKE :Período_Letivo + '%'
	AND SBOLSAALUNO.CODBOLSA = 137
	AND SBOLSAALUNO.RA IN (SELECT
							SC.RA
							
						   FROM
						    SCONTRATO SC (NOLOCK)
						    							   
							INNER JOIN SBOLSAALUNO SB (NOLOCK)	ON SB.CODCOLIGADA = SC.CODCOLIGADA AND 
																   SB.RA = SC.RA AND 
																   SB.CODCONTRATO = SC.CODCONTRATO AND 
																   SB.IDPERLET = SC.IDPERLET   
																   						    							   
						   WHERE SC.CODCOLIGADA = SCONTRATO.CODCOLIGADA 
						   		AND SC.RA = SCONTRATO.RA 
						   		AND SC.IDPERLET = SCONTRATO.IDPERLET 
						   		AND SC.CODCONTRATO = SCONTRATO.CODCONTRATO
						   		AND SB.CODBOLSA = :Codigo_Bolsa)

/*ORDER BY SCONTRATO.CODFILIAL, SCONTRATO.RA, SCONTRATO.CODCONTRATO*/
";1636;;;;09/11/2022;robson.canto;1;1;1;1;;;;0;5f9e8e08-316a-471b-8d39-10d146e0d74a;0;;-29571;robson.canto;09/11/2022;robson.canto;09/11/2022;0
S;ExcluirAtrib;Excluir Atribuição de um período Letivo;"Select pt.*
FROM 
	SPROFESSORTURMA PT 
	inner join SPROFESSORTURMACOMPL ptc on ptc.IDPROFESSORTURMA = pt.IDPROFESSORTURMA
	INNER JOIN STURMADISC TD on td.IDTURMADISC=pt.IDTURMADISC inner join SPLETIVO pl on pl.IDPERLET=td.IDPERLET
where 
	pl.CODPERLET = :CODPERLET and pl.CODPERLET = :Senha
";298;;;;21/10/2022;isaldo;1;1;1;1;;;;0;07611469-fdee-4c7b-9290-49648fa70c86;0;;20121;isaldo;21/10/2022;isaldo;21/10/2022;0
S;ExcluirCandidato;Excluir Candidato do Processo Seletivo;Select Mensagem from z_Unasp_Mensagem where Processo = 'ExcluirCandidato';73;;;;23/08/2022;isaldo;1;1;1;1;;;;0;36e9705f-9dad-4bf2-9609-c9762d427b8e;0;;11215;isaldo;23/08/2022;isaldo;23/08/2022;0
S;ExpModal;Exportação Modalidade;select descricao, null as feminino, null as masculino from smodalidadecurso;75;;;;28/09/2021;raphael.muzy;1;1;1;1;;;;0;2857bb6c-583a-4bf2-9cc5-1ffd68094041;0;;26014;raphael.muzy;28/09/2021;raphael.muzy;28/09/2021;0
S;falecido;Pessoa falecido;"/*BUSCANDO PESSOAS FALECIDAS
*/

SELECT
NOME,
FALECIDO,
PROFESSOR,
EXFUNCIONARIO,
DTNASCIMENTO,
GRAUINSTRUCAO,
ALUNO,
FUNCIONARIO

FROM
	PPESSOA (NOLOCK)
WHERE
	FALECIDO = 1 /*Pessoa Falecida = 1*/";213;;;;13/10/2022;maik.souza;1;1;1;1;;;;0;c9c42f9c-f68f-4cae-b1bf-0d09e7d6f827;0;;-14247;maik.souza;27/04/2022;maik.souza;13/10/2022;0
S;FILIAL;Filial;"SELECT
	
	F.NOME				Filial_Nome,
	F.CGC				Filial_CGC


FROM GFILIAL F";76;;;;01/04/2021;lucas.ssantos;1;1;1;1;;;;0;be47716d-2c11-445a-be90-92fc4b4a6ba2;0;;19945;lucas.ssantos;01/04/2021;lucas.ssantos;01/04/2021;0
S;FiltoAluno_99;Lista de Alunos Isaldo;Select RA from SALUNO where RA in('041377','069951','014624','021661','026052','020840','034463','031743','042783','023590','158621','027930','173286','023367','036411','054449','016220','047376','059361','038786','028781','052847','053338','026787','006451','037488','009266','007322','050181','050176','003917','173285','007973','173282','056145','047485','173288','173280','173284','016259','173277','020941','049252','030435','060996','173276','173283','049082','146821','149550','173287','150323','173281','150700','149853','150792','158622','158618','158623','158627','158628','158620','158617','158625','158624','158663','158660','158656','158655','158657','158654','158661','158653','158786','158800','158839','163991','163989','163993','163992','165430','041053','053505');781;;;;05/07/2021;isaldo;1;1;1;1;;;;0;c8e91e85-b9ae-44b4-beb3-299fc27fc4e8;0;;28833;isaldo;05/07/2021;isaldo;05/07/2021;0
S;Filtro,018;Turmas do professor;"SELECT PPESSOA.NOME , 
T.CODTURMA, 

CASE WHEN T.CODFILIAL = 1 THEN 'SP'
    WHEN T.CODFILIAL = 2 THEN 'EC'
    WHEN T.CODFILIAL = 3 THEN 'HT'
    WHEN T.CODFILIAL = 4 THEN 'EAD'END AS FILIAL,

CASE WHEN T.CODTIPOCURSO  = 1 THEN 'GRADUACAO'
    WHEN T.CODTIPOCURSO  = 2 THEN 'POS'
    WHEN T.CODTIPOCURSO  = 3 THEN 'EXTENSÃO'END AS NIVEL,
    
D.NOME DISCIPLINA,t.IDTURMADISC,
SPLETIVO.CODPERLET,
	(
		SELECT MAX(data)
		FROM (VALUES (p.RECCREATEDON),(p.RECMODIFIEDON),(tc.RECCREATEDON),(tc.RECMODIFIEDON)) AS data(data)
	) AS DataBaseCanvas,
	tc.Canvas,
	tc.IDCanvas
FROM 
	SPROFESSORTURMA P
	INNER JOIN STURMADISC		T	ON P.CODCOLIGADA = T.CODCOLIGADA AND P.IDTURMADISC = T.IDTURMADISC
	left join STURMADISCCOMPL	tc	ON tc.CODCOLIGADA = t.CODCOLIGADA AND tc.IDTURMADISC = t.IDTURMADISC			
	INNER JOIN SPROFESSOR			ON SPROFESSOR.CODCOLIGADA = P.CODCOLIGADA AND SPROFESSOR.CODPROF = P.CODPROF
	INNER JOIN PPESSOA				ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
	INNER JOIN SDISCIPLINA		D	ON D.CODCOLIGADA = T.CODCOLIGADA AND D.CODDISC = T.CODDISC
	INNER JOIN SPLETIVO				ON T.IDPERLET = SPLETIVO.IDPERLET 
WHERE 
	SPROFESSOR.CODPROF = :CODPROF";1165;;;;01/08/2022;roan.rossi;1;1;1;1;;;;0;87822b08-9d77-4856-9d84-d3e14300cdea;0;;-25749;mestre;15/06/2021;roan.rossi;01/08/2022;0
S;Filtro.001;Numero de créditos matrícula;"SELECT SUM(SMATRICULA.NUMCREDITOSCOB) [Créditos Cobranca] FROM SMATRICPL
INNER JOIN SMATRICULA ON 
SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
SMATRICULA.IDPERLET = SMATRICPL.IDPERLET AND 
SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
SMATRICULA.RA = SMATRICPL.RA
WHERE SMATRICPL.RA =:RA
AND SMATRICPL.CODCOLIGADA =:CODCOLIGADA
AND SMATRICPL.IDHABILITACAOFILIAL =:IDHABILITACAOFILIAL";421;;;;17/03/2021;mestre;1;1;1;1;;;;0;dc748b21-42b9-40bc-b64b-11c0674d4727;0;;-11526;mestre;17/03/2021;mestre;17/03/2021;0
S;Filtro.0019;Turmas Gerenciadas;"SELECT 
T.CODCOLIGADA , 
T.IDTURMADISC , 
CASE WHEN T.CODFILIAL = 1 THEN 'SP'
     WHEN T.CODFILIAL = 2 THEN 'EC'
     WHEN T.CODFILIAL = 3 THEN 'HT' END AS CAMPUS
 FROM STURMADISC T
INNER JOIN SPLETIVO (NOLOCK)P ON T.CODCOLIGADA = P.CODCOLIGADA AND T.IDPERLET = P.IDPERLET
INNER JOIN SDISCIPLINA (NOLOCK)ON SDISCIPLINA.CODCOLIGADA = T.CODCOLIGADA AND SDISCIPLINA.CODDISC = T.CODDISC
INNER JOIN STURNO (NOLOCK) TR ON TR.CODCOLIGADA=T.CODCOLIGADA AND TR.CODTURNO=T.CODTURNO
WHERE P.CODPERLET =:PeriodoLetivo
AND   SDISCIPLINA.NOME LIKE '%' + :Partedadisciplina + '%'
AND   TR.TIPO = :TipoTurno 
AND   T.CODFILIAL <> 4
AND   T.GERENCIAL <> 'S'
AND   T.CODTIPOCURSO = 1";681;;;;21/06/2021;maycon;1;1;1;1;;;;0;bb83223a-e78e-4414-a5c3-66a42f6faa36;0;;7066;mestre;20/06/2021;maycon;21/06/2021;0
S;Filtro.002;Matriz por nome do curso;"

SELECT CODCURSO FROM SHABILITACAO
WHERE NOME LIKE '%' + :CURSO + '%'";73;;;;24/03/2021;mestre;1;1;1;1;;;;0;d7425a58-eaf8-4092-9a69-9ce3e0917cf0;0;;-27235;mestre;24/03/2021;mestre;24/03/2021;0
S;Filtro.003;Matricula de alunos em turma especial;"SELECT RA FROM SMATRICULA
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
INNER JOIN STURMA ON STURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND STURMA.CODFILIAL = STURMADISC.CODFILIAL AND STURMA.CODTURMA = STURMADISC.CODTURMA AND STURMA.IDPERLET = STURMADISC.IDPERLET
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMA.CODCOLIGADA AND SPLETIVO.IDPERLET = STURMA.IDPERLET
WHERE STURMA.NOME LIKE '%ESPECIAL%'
AND   SPLETIVO.CODPERLET LIKE :PERIODOLETIVO";534;;;;13/04/2021;mestre;1;1;1;1;;;;0;9bde3450-27e6-40d8-9d40-e451cd1c41bc;0;;-9962;mestre;13/04/2021;mestre;13/04/2021;0
S;Filtro.009;Turmas sem centro de custo;"SELECT 
CODTURMA , 
STURMA.NOME,
STURMA.CODFILIAL , 
CASE WHEN STURMA.CODTIPOCURSO = 1 THEN 'GRADUAÃÃO' 
     WHEN STURMA.CODTIPOCURSO = 2 THEN 'POSGRADUAÃÃO'
     WHEN STURMA.CODTIPOCURSO = 1 THEN 'EXT' END AS TIPO


FROM STURMA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMA.CODCOLIGADA AND SPLETIVO.IDPERLET = STURMA.IDPERLET
WHERE CODPERLET LIKE '%' + :Periodoletivo + '%'
AND CODCCUSTO IS NULL";420;;;;26/05/2021;mestre;1;1;1;1;;;;1;68afb02a-040b-4547-b569-8690b2e81ab3;0;;31895;mestre;26/05/2021;mestre;26/05/2021;0
S;Filtro.010;Candidatos sem local de prova;"SELECT SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO FROM SPSINSCRICAOAREAOFERTADA
WHERE SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO NOT IN (SELECT NUMEROINSCRICAO FROM SPSLOGINSCRICAOPS)



";188;;;;10/06/2021;mestre;1;1;1;1;;;;0;8f02348f-3d9f-4614-a281-f3c7dffd8503;0;;-12917;mestre;10/06/2021;mestre;10/06/2021;0
S;Filtro.011;Candidatos sem Classificação;"SELECT 
	ps.IDPS,
	oi.NUMEROINSCRICAO,
	ps.NOME ProcessoSeletivo,
	u.NOME,
	fi.Nome FormaInscricao,
	iao.DATAINSCRICAO DataInscricao,
	c.DESCRICAO Polo,
	ai.Nome AreaInteresse,
	so.DESCRICAO Status,
	n.DESCRICAO Nacionalidade, 
	u.DTNASCIMENTO DataNascimento,
	u.CPF,
	u.TELEFONE1,
	u.TELEFONE2,
	u.CARTIDENTIDADE RG,
	u.NPASSAPORTE Passaporte,
	u.EMAIL,
	m.NomFilial Filial,	m.RA, m.CODCURSO,m.NomCurso, m.CODGRADE CODMATRIZ, m.NomGrade NomMatriz, m.NomTipoMatricula TipoMatricula, m.NomStatus StatusMatricula
FROM 
	SPSOPCAOINSCRITO 						(NOLOCK) oi
	INNER JOIN SPSINSCRICAOAREAOFERTADA		(NOLOCK) iao	ON iao.IDPS=oi.IDPS and iao.NUMEROINSCRICAO=oi.NUMEROINSCRICAO
	left join SPSINSCAREAOFERTACOMPL		(NOLOCK) iaoc	on iaoc.CODCOLIGADA = iao.CODCOLIGADA and iaoc.IDPS = iao.IDPS and iaoc.NUMEROINSCRICAO = iao.NUMEROINSCRICAO
	left join SCAMPUS						(NOLOCK) c		on c.CODCAMPUS = iaoc.CODPOLO
	INNER JOIN SPSUSUARIO					(NOLOCK) u		ON u.CODUSUARIOPS=iao.CODUSUARIOPS
	left  JOIN PCODNACAO					(NOLOCK) n		on n.CODCLIENTE = u.NACIONALIDADE
	left join SPSFORMAINSCRICAOPS			(NOLOCK) fi		on fi.CODCOLIGADA = iao.CODCOLIGADA and fi.IDPS=iao.IDPS and fi.IDFORMAINSCRICAO = iao.IDFORMAINSCRICAO
	left join SPSAREAOFERTADA				(NOLOCK) ao		on ao.CODCOLIGADA = oi.CODCOLIGADA and ao.IDPS = oi.IDPS and ao.IDAREAINTERESSE = oi.IDAREAINTERESSE
	left join SPSAREAINTERESSE				(NOLOCK) ai		on ai.IDAREAINTERESSE = ao.IDAREAINTERESSE
	left join SPSSTATUSOPCAO				(NOLOCK) so		on so.CODFILIAL = 1 and so.CODIGO = oi.STATUS
	left join SPSPROCESSOSELETIVO			(NOLOCK) ps		on ps.CODCOLIGADA = ao.CODCOLIGADA and ps.IDPS = ao.IDPS
	left join v_Unasp_SMATRICPL				(NOLOCK) m		on m.CODCOLIGADA=iao.CODCOLIGADAMAT and m.IDPERLET=iao.IDPERLET and m.IDHABILITACAOFILIAL=iao.IDHABFILIALMAT and m.RA=iao.RAMAT
WHERE 
	oi.IDPS = :IDPS
	AND OI.PONTUACAO IS NULL
order by 
	u.NOME
";1887;;;;07/07/2022;consultor1.totvs;1;1;1;1;;;;0;8f02348f-3d9f-4614-a281-f3c7dffd8503;0;;20161;consultor1.totvs;07/07/2022;consultor1.totvs;07/07/2022;0
S;Filtro.012;Filtro SPS DOC OK NUMEROINSCRICAO;select NUMEROINSCRICAO from SPSARQUIVOSCANDIDATO (nolock) Where DETALHE like '%DOC OK';86;;;;11/06/2021;mestre;1;1;1;1;;;;0;4416bd13-538d-4cc8-b83d-6a15ca97509d;0;;7159;mestre;11/06/2021;mestre;11/06/2021;0
S;Filtro.013;Filtro SPS DOC IDPS;select IDPS from SPSARQUIVOSCANDIDATO (nolock) Where DETALHE like '%DOC';72;;;;11/06/2021;mestre;1;1;1;1;;;;0;ee814df8-f8fb-4a07-aa42-e8fb417fb51c;0;;-5833;mestre;11/06/2021;mestre;11/06/2021;0
S;Filtro.014;Candidatos com Documento;"select 

SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO,
SPSUSUARIO.NOME,
SPSINSCRICAOAREAOFERTADA.IDPS,
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA

from SPSARQUIVOSCANDIDATO (nolock) 

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSARQUIVOSCANDIDATO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO

INNER JOIN SPSUSUARIO ON 
SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS


Where DETALHE like '%DOC'
AND   SPSARQUIVOSCANDIDATO.IDPS =:IDPS
AND   SPSARQUIVOSCANDIDATO.CODCOLIGADA =:CODCOLIGADA";664;;;;14/06/2021;mestre;1;1;1;1;;;;0;a353d780-9f55-40b6-ac10-ee5b8bc8c4b8;0;;-26094;mestre;11/06/2021;mestre;14/06/2021;0
S;Filtro.014.1;Candidatos com Documento;"select 

SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

from SPSARQUIVOSCANDIDATO (nolock) 

INNER JOIN SPSINSCRICAOAREAOFERTADA ON 
SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA AND 
SPSINSCRICAOAREAOFERTADA.IDPS = SPSARQUIVOSCANDIDATO.IDPS AND 
SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO

INNER JOIN SPSUSUARIO ON 
SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS


Where SPSARQUIVOSCANDIDATO.IDPS =:IDPS
AND   SPSARQUIVOSCANDIDATO.CODCOLIGADA =:CODCOLIGADA
AND   SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO =:NUMEROINSCRICAO";614;;;;14/06/2021;mestre;1;1;1;1;;;;0;a353d780-9f55-40b6-ac10-ee5b8bc8c4b8;0;;23028;mestre;14/06/2021;mestre;14/06/2021;0
S;Filtro.016;Filtro SPS DOC ENVIADO NUMEROINSCRICAO;"select 
	NUMEROINSCRICAO 
from 
	SPSARQUIVOSCANDIDATO (nolock) 
Where 
	DETALHE not like '%DOC' and DETALHE not like '%DOC OK'";131;;;;14/06/2021;mestre;1;1;1;1;;;;0;e66d0b74-3195-479a-933e-9d906f1d22b3;0;;-12613;mestre;11/06/2021;mestre;14/06/2021;0
S;Filtro.017;Contratos de Rematrícula;"SELECT CODCONTRATO FROM SCONTRATO
INNER JOIN SMATRICPL ON 
SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
SMATRICPL.RA = SCONTRATO.RA

WHERE SMATRICPL.CODTIPOMAT =:INGRE1REMATRICULA2";305;;;;03/08/2021;mestre;1;1;1;1;;;;0;cea41917-99cd-43cf-b95c-fd57507fbc23;0;;-25868;mestre;11/06/2021;mestre;03/08/2021;0
S;Filtro.018;Alunos por Filial (com matrícula);"SELECT SMATRICPL.RA FROM SMATRICPL 
 INNER JOIN SHABILITACAOFILIAL ON 
 SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
 
 WHERE SHABILITACAOFILIAL.CODFILIAL =:FILIAL	 
 GROUP BY SMATRICPL.RA";276;;;;20/06/2021;mario;1;1;1;1;;;;0;0fa5fabe-43cf-46d7-ba17-b9b5d8576a50;0;;11605;mario;20/06/2021;mario;20/06/2021;0
S;Filtro.020;Alunos por Tipo de Desconto;"SELECT PPESSOA.NOME , SALUNO.RA , SBOLSAALUNO.CODBOLSA, SPLETIVO.CODFILIAL, SPLETIVO.CODPERLET FROM SBOLSAALUNO
INNER JOIN SBOLSA ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA
INNER JOIN SALUNO ON SBOLSAALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SBOLSAALUNO.RA = SALUNO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SBOLSAALUNO.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND SBOLSAALUNO.IDPERLET = SPLETIVO.IDPERLET
WHERE SBOLSA.CODBOLSA =:CODBOLSA
AND   SBOLSA.CODCOLIGADA =:CODCOLIGADA";566;;;;20/06/2021;mestre;1;1;1;1;;;;0;685356aa-1371-4ec7-9b4d-0da1602154b7;0;;-25537;mario;20/06/2021;mestre;20/06/2021;0
S;Filtro.021;Lista de contratos por status;"SELECT codcontrato FROM SMATRICPL
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND SCONTRATO.RA = SMATRICPL.RA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
WHERE SSTATUS.DESCRICAO LIKE '%' + :SituaçãoMatrícula + '%'
AND   SPLETIVO.CODPERLET =:PeriodoLetivo";572;;;;08/07/2021;mestre;1;1;1;1;;;;0;44a349c2-7bd3-422d-8249-86900ffefce4;0;;7572;mestre;08/07/2021;mestre;08/07/2021;0
S;Filtro.022;Contratos sem parcela gerada;"SELECT SCONTRATO.CODCONTRATO  FROM SCONTRATO
INNER JOIN SPARCELA ON 
SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
SPARCELA.RA = SCONTRATO.RA AND 
SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
SPARCELA.IDPERLET = SCONTRATO.IDPERLET AND 
SPARCELA.PARCELA = 1
LEFT JOIN SLAN ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
WHERE SLAN.IDLAN IS NULL

GROUP BY SCONTRATO.CODCONTRATO";430;;;;13/07/2021;mestre;1;1;1;1;;;;0;355ab961-cae0-44c8-93d5-404d5d94424c;0;;23339;mestre;13/07/2021;mestre;13/07/2021;0
S;Filtro.024;ALUNOS 2 CURSOS;"

SELECT SMATRICPL.RA FROM SMATRICPL
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE CODPERLET =:PERIODOLETIVO
AND   SGRADE.CODCURSO IN (SELECT CODCURSO FROM SCURSO 
                          WHERE SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
                                SCURSO.CODCURSO = SGRADE.CODCURSO AND 
                                SCURSO.NOME LIKE '%'+ :CURSO1 +'%')

AND   SMATRICPL.RA IN (

SELECT SMATRICPL.RA FROM SMATRICPL
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE CODPERLET =:PERIODOLETIVO
AND   SGRADE.CODCURSO IN (SELECT CODCURSO FROM SCURSO 
                          WHERE SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
                                SCURSO.CODCURSO = SGRADE.CODCURSO AND 
                                SCURSO.NOME LIKE '%'+ :CURSO2 +'%'))";1768;;;;17/08/2021;mestre;1;1;1;1;;;;0;e504029a-2ba6-4be5-b02a-a447e780aa97;0;;31415;mestre;17/08/2021;mestre;17/08/2021;0
S;Filtro.025;Turmas sem plano de aula;"SELECT STURMADISC.IDTURMADISC FROM STURMADISC
INNER JOIN SPLETIVO ON STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET
LEFT JOIN SPLANOAULA ON SPLANOAULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND SPLANOAULA.IDTURMADISC = STURMADISC.IDTURMADISC
WHERE SPLANOAULA.IDTURMADISC IS NULL
AND   CODPERLET LIKE '%' + :PL + '%'
AND  STURMADISC.IDTURMADISC NOT IN (SELECT IDTURMADISC FROM STURMADISCGERENCIADA) 
AND ISNULL(STURMADISC.TIPO,'P') <> 'D'";484;;;;21/09/2021;lilian.buzetti;1;1;1;1;;;;0;635d03e5-8833-495b-ac55-5c890f4f4750;0;;8983;mestre;26/08/2021;lilian.buzetti;21/09/2021;0
S;Filtro.026;Candidatos sem matrícula;"SELECT SPSUSUARIO.NOME  FROM SPSOPCAOINSCRITO 
INNER JOIN SPSUSUARIO ON SPSOPCAOINSCRITO.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
INNER JOIN SPSINSCRICAOAREAOFERTADA ON SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
WHERE SPSOPCAOINSCRITO.STATUS = 7 AND SPSINSCRICAOAREAOFERTADA.RAMAT IS NULL AND SPSUSUARIO.NOME NOT LIKE '%TEST%'

";416;;;;30/08/2021;mestre;1;1;1;1;;;;0;55d83198-ad52-41b7-95aa-47182e982129;0;;-3141;mestre;30/08/2021;mestre;30/08/2021;0
S;Filtro.027;Lista de Bolsas - TODAS;SELECT CODBOLSA, NOME , CODTIPOCURSO FROM SBOLSA;48;;;;06/09/2021;lilian.buzetti;1;1;1;1;;;;0;4b236522-1d64-46b1-801a-67c540c09918;0;;-1396;lilian.buzetti;06/09/2021;lilian.buzetti;06/09/2021;0
S;Filtro.028;Oferta sem faixa de crédito;"SELECT SHABILITACAOFILIALPL.IDHABILITACAOFILIAL FROM SHABILITACAOFILIALPL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOFILIALPL.IDHABILITACAOFILIAL
LEFT JOIN SFAIXACRED ON SFAIXACRED.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SFAIXACRED.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND SFAIXACRED.IDPERLET = SHABILITACAOFILIALPL.IDPERLET
WHERE SFAIXACRED.IDHABILITACAOFILIAL IS NULL
AND CODPERLET =:PeriodoLetivo";683;;;;08/09/2021;lilian.buzetti;1;1;1;1;;;;0;01dfaf6d-e9e5-4a38-bae1-125ddb5e33c7;0;;19926;lilian.buzetti;08/09/2021;lilian.buzetti;08/09/2021;0
S;Filtro.030;Alunos com bolsa sem habilitacao lançada;"SELECT SCONCESSAOBOLSA.RA FROM SCONCESSAOBOLSA
LEFT JOIN SCONCESSAOBOLSAHABALUNO ON SCONCESSAOBOLSA.RA = SCONCESSAOBOLSAHABALUNO.RA AND SCONCESSAOBOLSA.IDCONCESSAOBOLSA = SCONCESSAOBOLSAHABALUNO.IDCONCESSAOBOLSA
WHERE SCONCESSAOBOLSAHABALUNO.IDHABILITACAOFILIAL IS NULL AND SCONCESSAOBOLSA.RA IN ( SELECT RA FROM SMATRICPL WHERE CODFILIAL =:FILIAL)";350;;;;23/09/2021;lilian.buzetti;1;1;1;1;;;;0;02469902-1e68-412c-aeb6-eb74bd9c56c5;0;;29500;lilian.buzetti;23/09/2021;lilian.buzetti;23/09/2021;0
S;Filtro.031;Alunos sem habilitação - data;"SELECT SCONCESSAOBOLSA.DTINICIO FROM SCONCESSAOBOLSA
LEFT JOIN SCONCESSAOBOLSAHABALUNO ON SCONCESSAOBOLSA.RA = SCONCESSAOBOLSAHABALUNO.RA AND SCONCESSAOBOLSA.IDCONCESSAOBOLSA = SCONCESSAOBOLSAHABALUNO.IDCONCESSAOBOLSA
WHERE SCONCESSAOBOLSAHABALUNO.IDHABILITACAOFILIAL IS NULL";277;;;;23/09/2021;lilian.buzetti;1;1;1;1;;;;0;99dd74a2-b247-448e-8f8f-c8a60d10d2b2;0;;-6307;lilian.buzetti;23/09/2021;lilian.buzetti;23/09/2021;0
S;Filtro.032;Alunos com Disciplinas Cancelados no Período 2021/2;"SELECT DISTINCT
 SMATRICULA.RA
 
FROM
 SMATRICULA (NOLOCK)
 
 INNER JOIN SMATRICPL (NOLOCK)	ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 								   SMATRICPL.IDPERLET = SMATRICULA.IDPERLET AND 
 								   SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND 
 								   SMATRICPL.RA = SMATRICULA.RA
 
 INNER JOIN SPLETIVO (NOLOCK)	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   SPLETIVO.IDPERLET = SMATRICPL.IDPERLET

WHERE	SPLETIVO.CODPERLET = '2021/2'
	AND SMATRICULA.CODSTATUS = 4
	AND SMATRICPL.CODSTATUS <> 4
	/*AND SMATRICPL.CODFILIAL = :CODFILIAL*/";617;;;;01/11/2021;robson.canto;1;1;1;1;;;;0;96508b62-83fc-4943-9d4d-9e35e62642bc;0;;-18062;robson.canto;01/11/2021;robson.canto;01/11/2021;0
S;Filtro.034;Creditos Cobrança;"
SELECT 
SDISCIPLINA.CODDISC,
SDISCIPLINA.NOME,
SMATRICULA.NUMCREDITOSCOB NUMCREDITOS, 
SFAIXACRED.VALCRED FAIXACREDITOS , 
SMATRICULA.NUMCREDITOSCOB * SFAIXACRED.VALCRED TOTALDISC,

/*(SMATRICULA.NUMCREDITOSCOB * SFAIXACRED.VALCRED) /6 VLPARCELA,*/
CASE WHEN SCONTRATO.CODFILIAL <> 4 THEN (SMATRICULA.NUMCREDITOSCOB * SFAIXACRED.VALCRED) / 6
	 ELSE (SMATRICULA.NUMCREDITOSCOB * SFAIXACRED.VALCRED) / 3 END VLPARCELA,

SSTATUS.DESCRICAO,
SMATRICULA.RECMODIFIEDON DATAALTERACAO

FROM SMATRICULA
INNER JOIN SPLETIVO ON SMATRICULA.CODCOLIGADA = SPLETIVO.CODCOLIGADA AND SMATRICULA.IDPERLET = SPLETIVO.IDPERLET 
INNER JOIN SFAIXACRED ON SFAIXACRED.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SFAIXACRED.IDPERLET = SMATRICULA.IDPERLET AND SFAIXACRED.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SCONTRATO.IDPERLET = SMATRICULA.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND SCONTRATO.RA = SMATRICULA.RA 
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
INNER JOIN SDISCIPLINA ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS

WHERE SMATRICULA.RA = :RA
AND   CODPERLET = :CODPERLET
AND   SCONTRATO.CODCONTRATO = :CONTRATO

";1493;;;;09/11/2022;robson.canto;1;1;1;1;;;;0;9464ce18-1d34-43a9-b70e-bb3f9bc0c3ef;0;;-15791;lilian.buzetti;01/11/2021;robson.canto;09/11/2022;0
S;Filtro.035;Alunos pelo e-mail;"SELECT RA FROM SALUNO
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
WHERE PPESSOA.EMAIL = :EMAIL";108;;;;08/11/2021;lilian.buzetti;1;1;1;1;;;;0;6ade1b28-8bda-4bc6-82a9-bb32a6be5ae6;0;;-14055;lilian.buzetti;08/11/2021;lilian.buzetti;08/11/2021;0
S;Filtro.036;Matrícula com Turma Mista;"/*
SELECT
 SMATRICPL.RA
 
FROM
 SMATRICULA (NOLOCK)
 
 INNER JOIN SMATRICPL (NOLOCK)	ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 								   SMATRICPL.IDPERLET = SMATRICULA.IDPERLET AND 
 								   SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND 
 								   SMATRICPL.RA = SMATRICULA.RA
 								   
 INNER JOIN STURMADISC (NOLOCK)	ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 						  		   STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC

 INNER JOIN SPLETIVO (NOLOCK)	ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 								   SPLETIVO.IDPERLET = SMATRICPL.IDPERLET AND
 								   SPLETIVO.CODFILIAL = SMATRICPL.CODFILIAL AND
 								   SPLETIVO.CODTIPOCURSO = STURMADISC.CODTIPOCURSO
 								   
WHERE	SMATRICULA.CODCOLIGADA = 1
	AND STURMADISC.IDHABILITACAOFILIAL IS NULL
	AND SPLETIVO.CODPERLET = :Periodo_Letivo
	*/
	
SELECT DISTINCT
 SMATRICULA.RA
 
FROM
 SMATRICULA (NOLOCK)
 
 INNER JOIN SMATRICPL (NOLOCK)	ON SMATRICPL.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 								   SMATRICPL.IDPERLET = SMATRICULA.IDPERLET AND 
 								   SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL AND 
 								   SMATRICPL.RA = SMATRICULA.RA

 INNER JOIN STURMADISC (NOLOCK)	ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND 
 								   STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC AND
 								   STURMADISC.IDHABILITACAOFILIAL IS NULL
 			 
 INNER JOIN SPLETIVO (NOLOCK)	ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 								   SPLETIVO.IDPERLET = STURMADISC.IDPERLET AND
 								   SPLETIVO.CODFILIAL = STURMADISC.CODFILIAL AND
 								   SPLETIVO.CODTIPOCURSO = STURMADISC.CODTIPOCURSO
/*
 INNER JOIN STURMA 				ON STURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND 
 								   STURMA.CODFILIAL = STURMADISC.CODFILIAL AND 
 								   STURMA.CODTURMA = STURMADISC.CODTURMA AND 
 								   STURMA.IDPERLET = STURMADISC.IDPERLET		
*/
WHERE	SMATRICULA.CODCOLIGADA = 1
	/*AND STURMA.IDHABILITACAOFILIAL IS NULL*/
	AND SPLETIVO.CODPERLET = :Periodo_Letivo
	/*AND SPLETIVO.IDPERLET = 929 /*:Periodo_Letivo*/*/
	AND SPLETIVO.CODFILIAL = :CODFILIAL
	AND SPLETIVO.CODTIPOCURSO = :CODTIPOCURSO";2221;;;;11/11/2021;robson.canto;1;1;1;1;;;;0;42ed0239-ce89-4f37-8b43-86e62057966d;0;;22980;robson.canto;11/11/2021;robson.canto;11/11/2021;0
S;Filtro.037;Filtro para emissao de NF contratos = CURSANDO;"SELECT P.RA/*, P.CODCONTRATO, L.IDBOLETO MODIFICADO EM 07/06/2022 NATHAN - PVT. GERANDO ERRO AO PUXAR OS LANÇAMENTOS*/
FROM   SPARCELA P, SCONTRATO C, SMATRICPL SM, SLAN LP, FLAN L, FBOLETO B, SSTATUS S
WHERE  P.CODCOLIGADA = C.CODCOLIGADA
AND    P.RA = C.RA
AND    P.CODCONTRATO = C.CODCONTRATO
AND    P.IDPERLET = C.IDPERLET
AND    C.CODCOLIGADA = SM.CODCOLIGADA
AND    C.IDPERLET = SM.IDPERLET
AND    C.IDHABILITACAOFILIAL = SM.IDHABILITACAOFILIAL
AND    C.RA = SM.RA
AND    LP.CODCOLIGADA = P.CODCOLIGADA
AND    LP.IDPARCELA = P.IDPARCELA
AND    LP.CODCOLIGADA = L.CODCOLIGADA
AND    LP.IDLAN = L.IDLAN
AND    L.CODCOLIGADA = B.CODCOLIGADA
AND    L.IDBOLETO = B.IDBOLETO
AND SM.CODCOLIGADA = S.CODCOLIGADA
AND SM.CODSTATUS = S.CODSTATUS
AND    L.IDBOLETO = B.IDBOLETO
AND    MONTH(L.DATAVENCIMENTO)=:MES
AND    YEAR(L.DATAVENCIMENTO)=:ANO
AND    SM.CODFILIAL=:FILIAL
AND S.DESCRICAO LIKE '%CURSANDO%'
AND C.STATUS <> 'S'
/*AND    SM.CODSTATUS IN (SELECT CODSTATUS FROM SSTATUS WHERE DESCRICAO LIKE '%CURSANDO%')*/";1018;;;;19/07/2022;consultor1.totvs;1;1;1;1;;;;0;0e70f18f-09f2-4f15-a444-f333eabce0b8;0;;-30138;carla.ozelo;26/01/2022;consultor1.totvs;19/07/2022;0
S;Filtro.038;Filtro para emissao de NF contratos = CURSANDO por RA;"SELECT P.RA
FROM   SPARCELA P, SCONTRATO C, SMATRICPL SM, SLAN LP, FLAN L, FBOLETO B
WHERE  P.CODCOLIGADA = C.CODCOLIGADA
AND    P.RA = C.RA
AND    P.CODCONTRATO = C.CODCONTRATO
AND    P.IDPERLET = C.IDPERLET
AND    C.CODCOLIGADA = SM.CODCOLIGADA
AND    C.IDPERLET = SM.IDPERLET
AND    C.IDHABILITACAOFILIAL = SM.IDHABILITACAOFILIAL
AND    C.RA = SM.RA
AND    LP.CODCOLIGADA = P.CODCOLIGADA
AND    LP.IDPARCELA = P.IDPARCELA
AND    LP.CODCOLIGADA = L.CODCOLIGADA
AND    LP.IDLAN = L.IDLAN
AND    L.CODCOLIGADA = B.CODCOLIGADA
AND    L.IDBOLETO = B.IDBOLETO
AND    MONTH(L.DATAVENCIMENTO)=:MES
AND    YEAR(L.DATAVENCIMENTO)=:ANO
AND    SM.CODFILIAL=:FILIAL
AND    P.RA=:RA
AND    SM.CODSTATUS IN (SELECT CODSTATUS FROM SSTATUS WHERE DESCRICAO LIKE '%CURSANDO%')";760;;;;24/02/2022;carla.ozelo;1;1;1;1;;;;0;0e70f18f-09f2-4f15-a444-f333eabce0b8;0;;-960;carla.ozelo;26/01/2022;carla.ozelo;24/02/2022;0
S;Filtro.039;Filtro para emissao NF boletos Verificando Campo Complementar;"SELECT 
	B.IDBOLETO
	FROM   SPARCELA P
INNER JOIN SCONTRATO C ON  P.CODCOLIGADA = C.CODCOLIGADA
	AND    P.RA = C.RA
	AND    P.CODCONTRATO = C.CODCONTRATO
	AND    P.IDPERLET = C.IDPERLET
INNER JOIN SMATRICPL SM ON C.CODCOLIGADA = SM.CODCOLIGADA
	AND    C.IDPERLET = SM.IDPERLET
	AND    C.IDHABILITACAOFILIAL = SM.IDHABILITACAOFILIAL
	AND    C.RA = SM.RA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SM.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SM.IDPERLET
INNER JOIN SLAN LP ON LP.CODCOLIGADA = P.CODCOLIGADA
	AND    LP.IDPARCELA = P.IDPARCELA
INNER JOIN FLAN L ON LP.CODCOLIGADA = L.CODCOLIGADA
	AND    LP.IDLAN = L.IDLAN
INNER JOIN FCFO ON FCFO.CODCOLIGADA = L.CODCOLCFO
	AND FCFO.CODCFO = L.CODCFO
LEFT JOIN FLANCOMPL ON FLANCOMPL.CODCOLIGADA = L.CODCOLIGADA
	AND FLANCOMPL.IDLAN = L.IDLAN
INNER JOIN FBOLETO B ON L.CODCOLIGADA = B.CODCOLIGADA
	AND    L.IDBOLETO = B.IDBOLETO
INNER JOIN SSTATUS S ON SM.CODCOLIGADA = S.CODCOLIGADA
AND SM.CODSTATUS = S.CODSTATUS
WHERE 	MONTH(L.DATAVENCIMENTO)= :MES 

AND 	YEAR(L.DATAVENCIMENTO)= :ANO  

AND FCFO.NOME NOT LIKE '%CAIXA%'
AND 	SM.CODFILIAL= :FILIAL 
AND C.STATUS <> 'S'
AND B.STATUS <> 2
AND L.STATUSLAN <> 2
AND SPLETIVO.CODTIPOCURSO = :$CODTIPOCURSO

AND S.DESCRICAO LIKE '%CURSANDO%'
AND FLANCOMPL.NFEMITIDA IS NULL

";1291;;;;24/08/2022;consultor1.totvs;1;1;1;1;;;;0;acd4dbd4-fdb7-480a-ac23-780965858ea9;0;;-22723;consultor1.totvs;05/05/2022;consultor1.totvs;24/08/2022;0
S;Filtro.040;Período Letivo 2023;"SELECT 
 SPLETIVO.IDPERLET

FROM 
 SPLETIVO (NOLOCK)
 
WHERE CODPERLET LIKE '2023%'";89;;;;19/10/2022;robson.canto;1;1;1;1;;;;0;14b4b68f-f147-415d-aacb-199d0937721a;0;;24548;robson.canto;19/10/2022;robson.canto;19/10/2022;0
S;Filtro.041;Periodo Letivo 2023 (STURMADISC);"select
	IDTURMADISC
from 
	STURMADISC(nolock) td
	inner join SPLETIVO(nolock) pl on pl.IDPERLET=td.IDPERLET and pl.CODCOLIGADA=td.CODCOLIGADA
where
	pl.CODPERLET like '2023%'";180;;;;20/10/2022;lucas.marques;1;1;1;1;;;;0;5dd59600-f810-4623-aaea-3a8495b7b579;0;;2646;lucas.marques;20/10/2022;lucas.marques;20/10/2022;0
S;Filtro.PensFem;Filtro Pensionato Feminino 2021/2;"Select 
	RA
from 
	v_Unasp_SMATRICPL m
Where
	CODPERLET='2021/2'
	and CODCURSO in ('EC-GPENS','EC-PPENS','HT-GPENS','SP-GPENS') 
	and NomStatus='Cursando'
	and NomGrade like '%Feminino%'";194;;;;27/07/2021;mestre;1;1;1;1;;;;0;3533a8b3-20ca-4bae-a48b-0a6a7f536f1e;0;;-643;mestre;27/07/2021;mestre;27/07/2021;0
S;Filtro.PensMasc;Filtro Pensionato Masculino 2021/2;"Select 
	RA
from 
	v_Unasp_SMATRICPL m
Where
	CODPERLET='2021/2'
	and CODCURSO in ('EC-GPENS','EC-PPENS','HT-GPENS','SP-GPENS') 
	and NomStatus='Cursando'
	and NomGrade like '%Masculino%'";195;;;;27/07/2021;mestre;1;1;1;1;;;;0;3533a8b3-20ca-4bae-a48b-0a6a7f536f1e;0;;-7808;mestre;27/07/2021;mestre;27/07/2021;0
S;Filtro.Quarto;Filtro de RA cursando de um quarto;select RA from v_Unasp_SMATRICPL where Sexo=:Sexo and QUARTO_PENSIONATO=:Quarto and NomStatus='Cursando';104;;;;01/09/2021;mestre;1;1;1;1;;;;0;66662159-ef19-4945-8a91-8747243fa6f3;0;;-22557;mestre;01/09/2021;mestre;01/09/2021;0
S;FiltroProf;Professores com Usuário;"SELECT DISTINCT
	SPROFESSOR.CODPROF	
FROM SPROFESSOR
	JOIN PPESSOA 
		ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA 
	JOIN SPROFESSORTURMA 
		ON SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF 
	JOIN STURMADISC 
		ON STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
	JOIN SPLETIVO 
		ON SPLETIVO.IDPERLET = STURMADISC.IDPERLET 


WHERE 
	PPESSOA.CODUSUARIO IS NOT NULL
	AND SPLETIVO.CODPERLET like '%' + :PERIODOLETIVO + '%'";435;;;;28/07/2021;lucas.ssantos;1;1;1;1;;;;0;650e3e52-7e43-4c73-8c35-9d1a16eee1b8;0;;-28393;lucas.ssantos;28/07/2021;lucas.ssantos;28/07/2021;0
S;FINANCEIRO;Relatórios Financeiros;;0;;;;12/03/2021;lucas.ssantos;1;1;1;1;;;;0;4cc8d2ed-47bc-46cc-8554-770868772a7b;0;;-18493;lucas.ssantos;12/03/2021;lucas.ssantos;12/03/2021;0
S;FINANCEIRO.001;Declaração - Pagamento de Mensalidade;"SELECT 
    FL.IDLAN,
	CT.CODCONTRATO,
	mpl.CODTURMA,
	pl.CODPERLET,
	pc.PARCELA,
	pc.DTVENCIMENTO,
	isnull(fl.VALORORIGINAL,pc.VALOR)  VALORORIGINAL,
	FL.DATAPAG				Parcela_DataPagamento,
	FL.VALORBAIXADO			Parcela_ValorBaixado,
	case STATUSLAN 
		WHEN 0 then 'Em Aberto' 
		WHEN 1 then 'Pago' 
		WHEN 2 then 'Cancelado' 
		WHEN 3 then 'Baixado por acordo' 
		WHEN 4 then 'Baixado parcialmente' 
		WHEN 5 then 'Borderô' 
		else 'Não Gerado' end Status,
	CASE P.SEXO	WHEN 'F' THEN 'a Sra.' WHEN 'M' THEN 'o Sr.' END Gen_SenhorA,
 	F.CGCCFO				RESP_CPF,
 	F.NOME 					RESP_NOME,
	P.NOME					Aluno_Nome,
	P.CPF					Aluno_cpf,
	A.RA							,
	C.NOME					Curso_Nome,
	C.CODCURSO				Curso_codg,
	gf.cgc,
	
	CASE WHEN SSERVICO.NOME LIKE 'MENSALIDADE%' THEN 'Mensalidade'
 	  	 ELSE SSERVICO.NOME END SERVIÇO

FROM 
	SCONTRATO						(nolock) CT
	inner join SMATRICPL			(nolock) mpl on mpl.CODCOLIGADA = ct.CODCOLIGADA and mpl.IDPERLET = ct.IDPERLET and mpl.IDHABILITACAOFILIAL = ct.IDHABILITACAOFILIAL and mpl.RA=ct.RA
	inner join SPLETIVO				(nolock) pl on pl.CODCOLIGADA=mpl.CODCOLIGADA and pl.IDPERLET=mpl.IDPERLET
	LEFT JOIN SALUNO				(nolock) A ON A.CODCOLIGADA = CT.CODCOLIGADA AND A.RA = CT.RA
	LEFT JOIN FCFO					(nolock) F ON F.CODCFO = A.CODCFO AND F.CODCOLIGADA = A.CODCOLCFO	
	LEFT JOIN PPESSOA				(nolock) P	ON P.CODIGO = A.CODPESSOA
	LEFT JOIN SFILIAL				(nolock) SF ON SF.CODCOLIGADA = CT.CODFILIAL AND SF.CODFILIAL = CT.CODFILIAL
	LEFT JOIN SPARCELA				(nolock) PC ON PC.CODCOLIGADA = CT.CODCOLIGADA AND PC.RA = CT.RA AND PC.CODCONTRATO = CT.CODCONTRATO AND PC.IDPERLET = CT.IDPERLET	
	LEFT JOIN SLAN					(nolock) SL ON SL.CODCOLIGADA = PC.CODCOLIGADA AND SL.IDPARCELA = PC.IDPARCELA
	LEFT JOIN FLAN					(nolock) FL ON FL.IDLAN = SL.IDLAN AND FL.CODCOLIGADA = SL.CODCOLIGADA	
	LEFT JOIN GFILIAL				(nolock) GF ON GF.CODCOLIGADA = FL.CODCOLIGADA AND GF.CODFILIAL = FL.CODFILIAL	
	LEFT JOIN SHABILITACAOFILIAL	(nolock) HF	ON HF.CODCOLIGADA = CT.CODCOLIGADA AND HF.IDHABILITACAOFILIAL = CT.IDHABILITACAOFILIAL
	LEFT JOIN SHABILITACAO			(nolock) H ON H.CODCOLIGADA = HF.CODCOLIGADA AND H.CODCURSO = HF.CODCURSO AND H.CODHABILITACAO = HF.CODHABILITACAO	
	LEFT JOIN SCURSO				(nolock) C ON C.CODCOLIGADA = H.CODCOLIGADA AND C.CODCURSO = H.CODCURSO	

    INNER JOIN SSERVICO (NOLOCK)			   ON SSERVICO.CODCOLIGADA = PC.CODCOLIGADA AND 
 											      SSERVICO.CODSERVICO = PC.CODSERVICO


WHERE	
	CT.CODCOLIGADA = :CODCOLIGADA1
	AND CT.RA = :RA3
	AND CT.IDPERLET = :IDPERLET1
	and C.CODCURSO = ( select CODCURSO from SHABILITACAOFILIAL (NOLOCK) where SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1 )
	AND FL.STATUSLAN IN (1, 4)
	and isnull(FL.VALORBAIXADO,0)>0
	
	/*and	CT.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1*/
	/*	AND CT.CODCONTRATO = :CODCONTRATO */
	/* and fl.STATUSLAN in (1,4) */

ORDER BY pc.PARCELA
";2896;;;;06/04/2022;robson.canto;1;1;1;1;;;;0;a53680d4-9845-4480-8ec3-41e54fc263d8;0;;-5539;lucas.ssantos;12/03/2021;robson.canto;06/04/2022;0
S;FINANCEIRO.001.1;Declaração - Pagamento de Mensalidade;"SELECT 
 SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
 FLAN.IDLAN,
 SCONTRATO.CODCONTRATO,
 SMATRICPL.CODTURMA,
 SPLETIVO.CODPERLET,
 SPARCELA.PARCELA,
 SPARCELA.DTVENCIMENTO,
 ISNULL(FLAN.VALORORIGINAL, SPARCELA.VALOR) VALORORIGINAL,
 FLANBAIXA.DATABAIXA Parcela_DataPagamento,
 FLANBAIXA.VALORBAIXA	Parcela_ValorBaixado,
 
 CASE FLAN.STATUSLAN 
	  WHEN 0 THEN 'Em Aberto' 
	  WHEN 1 THEN 'Pago' 
	  WHEN 2 THEN 'Cancelado' 
	  WHEN 3 THEN 'Baixado por acordo' 
	  WHEN 4 THEN 'Baixado parcialmente' 
	  WHEN 5 THEN 'Borderô' 
	  ELSE 'Não Gerado' END STATUS,
 
 CASE PPESSOA.SEXO	
 	  WHEN 'F' THEN 'a Sra.' 
 	  WHEN 'M' THEN 'o Sr.' END Gen_SenhorA,
 	  
 FCFO.CGCCFO RESP_CPF,
 FCFO.NOME RESP_NOME,
 PPESSOA.NOME Aluno_Nome,
 PPESSOA.CPF Aluno_cpf,
 SALUNO.RA							,
 SCURSO.NOME Curso_Nome,
 SCURSO.CODCURSO Curso_codg,
 GFILIAL.CGC,
 
 CASE WHEN SSERVICO.NOME LIKE 'MENSALIDADE%' THEN 'Mensalidade'
 	  ELSE SSERVICO.NOME END SERVIÇO

FROM 
 SCONTRATO (NOLOCK) 
	
 INNER JOIN SMATRICPL (NOLOCK)				ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA and 
											   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET and 
											   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL and 
											   SMATRICPL.RA = SCONTRATO.RA
	
 INNER JOIN SPLETIVO	(NOLOCK)			ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA and 
											   SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	
 INNER JOIN SALUNO (NOLOCK)  				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
											   SALUNO.RA = SCONTRATO.RA
												  
 LEFT JOIN FCFO (NOLOCK)					ON FCFO.CODCFO = SALUNO.CODCFO AND 
											   FCFO.CODCOLIGADA = SALUNO.CODCOLCFO	
												   
 INNER JOIN PPESSOA (NOLOCK)				ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	
	
 INNER JOIN SPARCELA (NOLOCK)				ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
											   SPARCELA.RA = SCONTRATO.RA AND 
											   SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
											   SPARCELA.IDPERLET = SCONTRATO.IDPERLET	
												   
 INNER JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 											   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO

 INNER JOIN SLAN (NOLOCK) 					ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
											   SLAN.IDPARCELA = SPARCELA.IDPARCELA
												   
 INNER JOIN FLAN (NOLOCK)					ON FLAN.IDLAN = SLAN.IDLAN AND 
											   FLAN.CODCOLIGADA = SLAN.CODCOLIGADA
												   
 INNER JOIN FLANBAIXA (NOLOCK)				ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 											   FLANBAIXA.IDLAN = FLAN.IDLAN AND
 											   FLANBAIXA.STATUS <> 1
 											   
 INNER JOIN GFILIAL (NOLOCK)				ON GFILIAL.CODCOLIGADA = FLAN.CODCOLIGADA AND 
											   GFILIAL.CODFILIAL = FLAN.CODFILIAL	
	
 INNER JOIN SHABILITACAOFILIAL (NOLOCK)		ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
												   
 INNER JOIN SHABILITACAO (NOLOCK)			ON SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
											   SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
											   SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO	
												  
 INNER JOIN SCURSO (NOLOCK)					ON SCURSO.CODCOLIGADA = SHABILITACAO.CODCOLIGADA AND 
											   SCURSO.CODCURSO = SHABILITACAO.CODCURSO	

WHERE	SCONTRATO.CODCOLIGADA = :CODCOLIGADA1
	AND SCONTRATO.RA = :RA3
	AND FLAN.STATUSLAN IN (1, 4)
	AND FLANBAIXA.VALORBAIXA > 0
	AND YEAR(FLANBAIXA.DATABAIXA) = :ANO

ORDER BY SPARCELA.PARCELA";3619;;;;06/04/2022;robson.canto;1;1;1;1;;;;0;a53680d4-9845-4480-8ec3-41e54fc263d8;0;;-29317;robson.canto;06/04/2022;robson.canto;06/04/2022;0
S;FINANCEIRO.001.2;Cabeçalho;"SELECT DISTINCT
 FCFO.CGCCFO RESP_CPF,
 FCFO.NOME RESP_NOME

FROM 
 SCONTRATO (NOLOCK) 
	
 INNER JOIN SALUNO (NOLOCK)  				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
											   SALUNO.RA = SCONTRATO.RA
												  
 LEFT JOIN FCFO (NOLOCK)					ON FCFO.CODCFO = SALUNO.CODCFO AND 
											   FCFO.CODCOLIGADA = SALUNO.CODCOLCFO	
												   
WHERE	SCONTRATO.CODCOLIGADA = :CODCOLIGADA1
	AND SCONTRATO.RA = :RA3";442;;;;01/08/2022;robson.canto;1;1;1;1;;;;0;9b7f218c-d04a-4b99-afc2-ab922edfb53b;0;;22678;robson.canto;01/08/2022;robson.canto;01/08/2022;0
S;FINANCEIRO.002;Comprovante de Pagamento;"SELECT
	A.RA					ALUNO_RA,
	P.NOME					ALUNO_NOME,
	F.NOME					RESP_NOME,
	PC.PARCELA				PARC_PARCELA,
	PC.DTVENCIMENTO			PARC_DATA_VENCIMENTO,
	PC.VALOR				PARC_VALOR,
	LBX.DATABAIXA			BAIXA_DATA,
	PG.DESCFORMAPAGTO		BAIXA_FORMA,
	LBX.IDTRANSACAO			BAIXA_TRANSACAO_ID,
	FI.NOME					FILIAL_NOME,
	FI.CIDADE				FILIAL_CIDADE,
	FI.ESTADO				FILIAL_ESTADO
	
FROM	FBOLETO B

	LEFT JOIN FCFO F 
		 ON F.CODCOLIGADA = B.CODCOLSACADO 
		AND F.CODCFO = B.SACADO

	LEFT JOIN SALUNO A 
		 ON A.CODCOLCFO = F.CODCOLIGADA
		AND A.CODCFO = F.CODCFO

	LEFT JOIN PPESSOA P 
		 ON P.CODIGO = A.CODPESSOA

	LEFT JOIN FLANBOLETO LB
		 ON LB.CODCOLIGADA = B.CODCOLIGADA
		AND LB.IDBOLETO = B.IDBOLETO

	LEFT JOIN FLAN FL
		 ON FL.CODCOLIGADA = LB.CODCOLIGADA
		AND FL.IDLAN = LB.IDLAN	

	LEFT JOIN GFILIAL FI
		 ON FI.CODCOLIGADA = FL.CODCOLIGADA
		AND FI.CODFILIAL = FL.CODFILIAL

	LEFT JOIN SLAN SL
		 ON SL.IDLAN = FL.IDLAN
		AND SL.CODCOLIGADA = FL.CODCOLIGADA
			
	LEFT JOIN SPARCELA PC
		 ON PC.CODCOLIGADA = SL.CODCOLIGADA
		AND PC.IDPARCELA = SL.IDPARCELA

	LEFT JOIN FLANBAIXA LBX
		 ON LBX.IDLAN = FL.IDLAN
		AND LBX.CODCOLIGADA = FL.CODCOLIGADA

	LEFT JOIN TFORMAPAGTO PG
		 ON PG.CODCOLIGADA = LBX.CODCOLIGADA
		AND PG.IDFORMAPAGTO = LBX.IDFORMAPAGTO
/*
WHERE	B.IDBOLETO = 1964
	AND LB.IDBOLETO = 1964
	AND FL.IDLAN = 1949
*/

WHERE	B.IDBOLETO = :IDBOLETO1
	AND LB.IDBOLETO = :IDBOLETO2
	AND FL.IDLAN = :IDBOLETO2
";1470;;;;23/06/2021;lucas.ssantos;1;1;1;1;;;;0;3035df80-3fd7-454e-9b4f-01963d0356fa;0;;-3156;lucas.ssantos;16/03/2021;lucas.ssantos;23/06/2021;0
S;FINANCEIRO.003;Inscrição do Processo Seletivo;select * from glinksrel;23;;;;04/05/2021;lucas.ssantos;1;1;1;1;;;;0;369bb3ce-4469-444b-9e29-3f1ee2458b88;0;;4399;lucas.ssantos;04/05/2021;lucas.ssantos;04/05/2021;0
S;FINREL0012;RECIBO BEMATECH;"Select 
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	Sum(RECVALORBAIXA) RECVALORBAIXA,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	dbo.dv_Recibo(RECCODIGO,RECIDSESSAO,RECNUMEROCAIXA,RECCODCXA,replace(replace(convert(varchar(20), VALORTOTAL, 0),'.',''),',',''),convert(varchar(10),getdate(),112)) RECdv_Recibo
from (
	SELECT	
		/*	RECIBO	*/	
		L.IDLAN					RECCODIGO,
		L.HISTORICO				RECHISTORICO,
		F.IDINTEGRACAO			RECENTIDADE,
		l.DATAEMISSAO			RECDATAEMISSAO,
		SC.IDSESSAO				RECIDSESSAO,
		SC.NUMEROCAIXA			RECNUMEROCAIXA,
		SC.CODUSUARIOOPERADOR	RECUSUARIOOPERADOR,
		SC.CODCXA				RECCODCXA,
		cx.DESCRICAO			RECCDESCXA,
		FP.DESCFORMAPAGTO		RECFORMAPAGAMENTO,
		lb.VALORBAIXA			RECVALORBAIXA,
		(SELECT SUM(VALORBAIXA) FROM FLANBAIXA LBX WHERE LBX.IDLAN IN(:IDLAN) AND LBX.CODCOLIGADA = 1 AND LBX.STATUS <> 1) as VALORTOTAL,
	
		/*	FILIAL	*/
		F.CODFILIAL				FILCODG,
		F.NOME					FILNOME,
		F.CGC					FILCNPJ,
		F.RUA					FILENDERECO,
		F.NUMERO				FILENDERECONUMERO,
		F.BAIRRO				FILBAIRRO,
		F.CIDADE				FILCIDADE,
		F.ESTADO				FILESTADO,
		F.CEP					FILCEP,
		F.TELEFONE				FILTELEFONE,
		F.EMAIL					FILEMAIL,
		fx.*
	
	FROM FLAN L
	LEFT JOIN FLANBAIXA         LB  (NOLOCK)    ON L.CODCOLIGADA = LB.CODCOLIGADA AND L.IDLAN = LB.IDLAN 
	LEFT JOIN FCXA				CX	(NOLOCK)	ON cx.CODCOLIGADA = lb.CODCOLCXA and cx.CODCXA = lb.CODCXA
	LEFT JOIN FLOGSESSAOCAIXA   LSC (NOLOCK)    ON LSC.CODCOLIGADA = LB.CODCOLIGADA AND LSC.IDLAN = LB.IDLAN AND LSC.IDBAIXA = LB.IDBAIXA
	LEFT JOIN FSESSAOCAIXA       SC (NOLOCK)    ON SC.CODCOLCXA = CX.CODCOLIGADA AND SC.CODCXA = CX.CODCXA AND SC.IDSESSAO = lsc.IDSESSAO
    LEFT JOIN TFORMAPAGTO        FP (NOLOCK)    ON FP.CODCOLIGADA = LB.CODCOLIGADA AND FP.IDFORMAPAGTO = LB.IDFORMAPAGTO
	LEFT JOIN GFILIAL			 F	(NOLOCK)	ON F.CODCOLIGADA = L.CODCOLIGADA and F.CODFILIAL = L.CODFILIAL 
    LEFT JOIN FXCX				 fx	(NOLOCK)	on fx.CODCOLIGADA = LB.CODCOLIGADA and fx.IDXCX = LB.IDXCX 
	
	WHERE 	
		L.IDLAN IN(:IDLAN)
		AND L.CODCOLIGADA = 1
		AND LB.STATUS <> 1) x
Group by
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL";2572;;;;20/07/2021;mestre;1;1;1;1;;;;0;29ce48f8-3680-429d-82fa-6b2e2e9efe95;0;;-2839;lucas.ssantos;15/06/2021;mestre;20/07/2021;0
S;FINREL00271.1;Dados aceite;"SELECT FACORDO.RECMODIFIEDBY , FACORDO.RECMODIFIEDON FROM FACORDO
LEFT JOIN FACORDOREL ON FACORDOREL.IDACORDO = FACORDO.IDACORDO AND FACORDOREL.CODCOLIGADA = FACORDO.CODCOLIGADA
WHERE IDLAN IN (:IDLAN1)

GROUP BY FACORDO.RECMODIFIEDBY , FACORDO.RECMODIFIEDON
";264;;;;24/08/2021;mestre;1;1;1;1;;;;0;b96fad66-f67a-4ead-8668-b051ac294e9c;0;;17695;mestre;24/08/2021;mestre;24/08/2021;0
S;flt.analise;Prohelp - Analise Curricular Aluno;"SELECT 
	DISTINCT
	ANALISE.CODPERIODO,
	ANALISE.Filial,
	HF.NomTipoCurso,
	ANALISE.Curso,
	HF.CodCurso,
	ANALISE.DISCIPLINA,
	ANALISE.STATUS,
	ANALISE.CODDISC AS 'CodDisc',
	ANALISE.CH,
	ANALISE.NOTA AS 'Media',
	ANALISE.FALTAS AS 'Faltas',
	ANALISE.TIPO AS 'Tipo',
	ANALISE.IDHABILITACAOFILIAL AS IdHabilitacaoFilial,
	HF.CodGrade,
	HF.NomGrade,
	HF.Status AS 'Status Grade'

FROM v_Unasp_AnaliseCurricular ANALISE(NOLOCK)
	INNER JOIN v_Unasp_SHABILITACAOFILIALPL HF (NOLOCK)
		ON ANALISE.IDHABILITACAOFILIAL = HF.IDHABILITACAOFILIAL
			AND ANALISE.CODCOLIGADA = HF.CODCOLIGADA
			AND ANALISE.CODTIPOCURSO = HF.CODTIPOCURSO
WHERE RA = :RA 
ORDER BY ANALISE.CODPERIODO";693;;;;16/11/2022;maik.souza;1;1;1;1;;;;0;3204b1ce-c384-4fbf-a88c-940a40aed2d9;0;;6444;maik.souza;11/11/2022;marccella.belvedere;16/11/2022;0
S;flt.disc.cont;PROHELP - Turmas Disciplinas Sem conteúdo Cadastrado (Relatório);"/*
Formas de Consulta:
    Cod_Periodo = Periodo Letivo
    Ex: 2022/1, 2022/2, etc..
         
	Cod_Nivel_Ensino = Nível de Ensino 
	Ex: 1 (Para Graduação)e 2 (Para Pós-graduação)
	
	Cod_Filial = Filial
	Ex: 1 (SP), 2 (EC), 3 (HT) e 4 (EAD)
*/
SELECT 
	SPLETIVO.CODPERLET AS Periodo,
	STURMADISC.CODFILIAL AS Filial,
	SDISCIPLINA.CODTIPOCURSO AS 'Nível de Ensino',
	STURMADISC.CODTURMA AS 'Código Turma',
	SCURSO.NOME AS 'Curso',
	STURMADISC.IDTURMADISC AS Código,
	SDISCIPLINA.NOME AS Disciplina,
	STURMADISCCOMPL.TIPOTURMADISC AS 'Tipo Turma',
	PPESSOA.NOME AS Professor,
	COUNT(*)  AS 'Sem Conteúdo',
	STURMA_G.IDTURMADISC AS 'ID Gerencial',
	PESSOA_COORDENADOR.NOME AS 'Coordenador'

	
		
FROM   STURMADISC (NOLOCK)
	LEFT JOIN STURMADISCGERENCIADA (NOLOCK) ON
			STURMADISCGERENCIADA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND STURMADISCGERENCIADA.IDTURMADISCGERENCIADA = STURMADISC.IDTURMADISC	
	LEFT JOIN STURMADISC STURMA_G (NOLOCK) ON
			STURMADISCGERENCIADA.CODCOLIGADA = STURMA_G.CODCOLIGADA
			AND STURMADISCGERENCIADA.IDTURMADISC = STURMA_G.IDTURMADISC
	LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
		ON SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
	LEFT JOIN SCURSO (NOLOCK) 
		ON SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	LEFT JOIN SPLANOAULA (NOLOCK)
		ON SPLANOAULA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND SPLANOAULA.IDTURMADISC = STURMADISC.IDTURMADISC
	LEFT JOIN SDISCIPLINA (NOLOCK)
		ON SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	LEFT JOIN SPLETIVO (NOLOCK)
		ON SPLETIVO.IDPERLET = STURMADISC.IDPERLET
	LEFT JOIN SPROFESSORTURMA (NOLOCK)
		ON SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
	LEFT JOIN SPROFESSOR (NOLOCK)
		ON SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
	LEFT JOIN PPESSOA (NOLOCK)
		ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA

	LEFT JOIN SCOORDENADOR (NOLOCK)
		ON SCOORDENADOR.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 
	
	LEFT JOIN PPESSOA PESSOA_COORDENADOR (NOLOCK)
		ON PESSOA_COORDENADOR.CODIGO = SCOORDENADOR.CODPESSOA 
	LEFT JOIN STURMADISCCOMPL (NOLOCK)
		ON STURMADISCCOMPL.IDTURMADISC = STURMADISC.IDTURMADISC

	

WHERE  SPLANOAULA.CONTEUDOEFETIVO IS NULL
       AND SPLETIVO.CODPERLET = :Cod_Periodo
	   AND SDISCIPLINA.CODTIPOCURSO = :Cod_Nivel_Ensino 
	   AND STURMADISC.CODFILIAL = :Cod_Filial 
	   AND SPLANOAULA.DATA <= Getdate() 
	  
	   

GROUP BY 	STURMADISC.CODFILIAL,
	SDISCIPLINA.CODTIPOCURSO,
	SCURSO.NOME,
	SPLETIVO.CODPERLET ,
	STURMADISC.IDTURMADISC ,
	SDISCIPLINA.NOME ,
	STURMADISCCOMPL.TIPOTURMADISC,
	STURMADISC.CODTURMA,
	PPESSOA.NOME,
	STURMA_G.IDTURMADISC,
    PESSOA_COORDENADOR.NOME

ORDER BY SCURSO.NOME";2710;;;;24/10/2022;maik.souza;1;1;1;1;;;;0;4c3a04c6-c8ae-45fa-8fe3-4dfb4ca2005a;0;;6401;maik.souza;24/10/2022;maik.souza;24/10/2022;0
S;flt.disc.cred;Turma Disciplina com Qtd. de Creditos Menores que a Matriz;"/* 
Lista disciplinas com lançamento de créditos errados
*/
SELECT 
STURMADISC.IDTURMADISC 

FROM STURMADISC (NOLOCK)
INNER JOIN SPLETIVO  (NOLOCK) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET
INNER JOIN SHORARIOTURMA (NOLOCK)  ON STURMADISC.IDTURMADISC=  SHORARIOTURMA.IDTURMADISC
LEFT JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODDISC = STURMADISC.CODDISC AND SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
GROUP BY  STURMADISC.IDTURMADISC,SDISCIPLINA.NUMCREDITOS

HAVING 
	COUNT(SHORARIOTURMA.CODHOR) != SDISCIPLINA.NUMCREDITOS 
";545;;;;11/08/2022;maik.souza;1;1;1;1;;;;0;70f24784-6301-4fb7-a9ec-eabc392e1ded;0;;-19520;maik.souza;10/08/2022;maik.souza;11/08/2022;0
S;flt.disc.dia;Disciplinas Por Dia da Semana;"/*
Domingo = 1
Segunda = 2
Terça = 3
Quarta = 4
Quinta = 5
Sexta  = 6
Sábado = 7
*/
SELECT
	STURMADISC.IDTURMADISC
FROM 
	STURMADISC (nolock)
	INNER join STURMA (nolock) t on t.CODCOLIGADA = STURMADISC.CODCOLIGADA and t.CODFILIAL = STURMADISC.CODFILIAL and t.CODTURMA = STURMADISC.CODTURMA and t.IDPERLET = STURMADISC.IDPERLET
	LEFT join SHABILITACAOFILIAL (nolock) hf on hf.CODCOLIGADA = t.CODCOLIGADA and hf.IDHABILITACAOFILIAL = t.IDHABILITACAOFILIAL
	LEFT join GFILIAL (nolock) f on f.CODCOLIGADA=hf.CODCOLIGADA and f.CODFILIAL = hf.CODFILIAL
	LEFT join SCURSO (nolock) c on c.CODCOLIGADA=hf.CODCOLIGADA and c.CODCURSO=hf.CODCURSO
	INNER JOIN SPLETIVO (nolock) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET 
	LEFT JOIN SDISCIPLINA (nolock) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	LEFT JOIN SHORARIOTURMA (nolock) ON STURMADISC.CODCOLIGADA =  SHORARIOTURMA.CODCOLIGADA AND STURMADISC.IDTURMADISC =  SHORARIOTURMA.IDTURMADISC 
	LEFT JOIN SHORARIO (nolock) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR
WHERE 
	(CODPERLET IN (:CODPERLET)
AND SHORARIO.DIASEMANA = :Nº_DIA_SEMANA)
";1208;;;;01/08/2022;maik.souza;1;1;1;1;;;;0;717c6460-2204-4979-b41a-bed339afcce8;0;;-27567;maik.souza;17/06/2022;maik.souza;01/08/2022;0
S;flt.disc.horario;Turma disciplina Sem Horário;"SELECT STURMADISC.IDTURMADISC

FROM STURMADISC (NOLOCK)
INNER JOIN SPLETIVO  (NOLOCK) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET
LEFT JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
LEFT JOIN SHORARIOTURMA (NOLOCK)  ON STURMADISC.CODCOLIGADA =  SHORARIOTURMA.CODCOLIGADA 
LEFT JOIN SHORARIO (NOLOCK)  ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA 
WHERE 
SPROFESSORTURMA.IDPROFESSORTURMA IS NULL OR SPROFESSORTURMA.CODPROF IS NULL



";490;;;;27/06/2022;maik.souza;1;1;1;1;;;;0;c35de1f9-2062-426f-aa64-344632790675;0;;21303;maik.souza;27/06/2022;maik.souza;27/06/2022;0
S;flt.disc.matriz;ProHelp - Disciplinas por matriz ;"SELECT 
	distinct
	HF.CODPERLET PERIODO_LET,
	HF.NomFilial FILIAL,
	HF.NomCurso NOME_CURSO,
	CODCURSO COD_CURSO,
	CODHABILITACAO COD_HABILITACAO,
	SDISCIPLINA.NOME NOME_DISC,
	HF.NomTurno NOME_TURNO,
	HF.NomGrade NOME_GRADE,
	HF.CODGRADE COD_GRADE,
	Status,
	STURMADISC.CODTURMA COD_TURMA,
	STURMADISC.CODDISC COD_DISCIPLINA,
	STURMADISC.IDTURMADISC ID_TURMADISC,
	GERENCIAL,
	STURMADISCGERENCIADA.IDTURMADISC COD_GERENCIAL,
	STURMA.nome NOME_TURMA, [TIPO_TURMA]=

	/*Verifica se uma turma é ESPECIAL, NORMAL, ou TEMPORARIA*/
	CASE
	WHEN STURMA.NOME like '%Especial%' THEN 'Especial'
	WHEN STURMA.NOME like '%Temp%' THEN 'Temporario'
	WHEN STURMA.NOME IS NOT NULL THEN 'Normal'

	END
FROM v_Unasp_SHABILITACAOFILIALPL HF (NOLOCK)
	LEFT JOIN STURMADISC (NOLOCK) ON STURMADISC.IDHABILITACAOFILIAL = HF.IDHABILITACAOFILIAL
		AND STURMADISC.IDPERLET = HF.IDPERLET
	LEFT JOIN STURMADISCGERENCIADA (NOLOCK) ON STURMADISCGERENCIADA.IDTURMADISCGERENCIADA = STURMADISC.IDTURMADISC
	INNER JOIN SDISCIPLINA (NOLOCK) ON SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	INNER JOIN STURMA (NOLOCK) ON STURMA.IDPERLET = STURMADISC.IDPERLET and STURMA.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
WHERE 
	CODPERLET = :PERIODO_LET
	
	
ORDER BY SDISCIPLINA.NOME
";1282;;;;13/10/2022;maik.souza;1;1;1;1;;;;0;047d724a-9815-4b85-ad91-83f6876d2066;0;;-15119;maik.souza;13/10/2022;maik.souza;13/10/2022;0
S;flt.disc.mprof;Disciplinas com mais de um professor;"SELECT IDTURMADISC
	FROM
(SELECT STURMADISC.IDTURMADISC,COUNT(CODPROF)QTDE
	FROM STURMADISC
		INNER JOIN SPROFESSORTURMA (NOLOCK) ON
			SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
			AND SPROFESSORTURMA.TIPOPROF = 'T'
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPLETIVO.CODCOLIGADA = 1
AND SPLETIVO.CODPERLET = :Perletivo_S
GROUP BY STURMADISC.IDTURMADISC
HAVING COUNT(CODPROF) > 1)DISCIPLINAS";569;;;;10/01/2022;consultor1.totvs;1;1;1;1;;;;0;6d060f86-6674-422c-b8fa-5c45559110ba;0;;-26451;consultor1.totvs;10/01/2022;consultor1.totvs;10/01/2022;0
S;flt.disc.mprof2;Disciplinas com mais de um professor2;"/*Filtra Disciplinas com mais de um professor independente do tipo professor*/
SELECT IDTURMADISC
	FROM
(SELECT STURMADISC.IDTURMADISC,COUNT(CODPROF)QTDE
	FROM STURMADISC
		INNER JOIN SPROFESSORTURMA (NOLOCK) ON
			SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
			/*AND SPROFESSORTURMA.TIPOPROF = 'T'*/
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPLETIVO.CODCOLIGADA = 1
AND SPLETIVO.CODPERLET = :Perletivo_S
GROUP BY STURMADISC.IDTURMADISC
HAVING COUNT(CODPROF) > 1)DISCIPLINAS";653;;;;01/08/2022;maik.souza;1;1;1;1;;;;0;c090b94c-b4f7-4548-a190-2acc1d31ad0c;0;;-29225;maik.souza;01/08/2022;maik.souza;01/08/2022;0
S;flt.disc.mprof3;Discilpinas com APENAS um professor ;"SELECT IDTURMADISC
	FROM
(SELECT STURMADISC.IDTURMADISC,COUNT(CODPROF)QTDE
	FROM STURMADISC
		INNER JOIN SPROFESSORTURMA (NOLOCK) ON
			SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
			
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPLETIVO.CODCOLIGADA = 1
AND SPLETIVO.CODPERLET = :Perletivo_S
GROUP BY STURMADISC.IDTURMADISC
HAVING COUNT(CODPROF) = 1)DISCIPLINAS";535;;;;01/08/2022;maik.souza;1;1;1;1;;;;0;b726622b-a136-4df1-b4da-18c0c983b552;0;;-1577;maik.souza;01/08/2022;maik.souza;01/08/2022;0
S;flt.disc.nome;Turma Disciplina por Nome;"/* Lista disciplinas  com ID Canvas e códigos de professores por periodo Letivo*/
SELECT 
	DISTINCT
	A.IDTURMADISC,
	C.CODPERLET,
	A.TIPOTURMADISC,
	B.IDPROFESSORTURMA,
	B.CODPROF,
	C.NOMCURSO,
	C.NOMDISCIPLINA,
	C.NOMTURNO,
	C.CODTURMA,
	C.NOMFILIAL
	
	
	
FROM STURMADISCCOMPL A (NOLOCK) 
LEFT JOIN SPROFESSORTURMA B (NOLOCK) ON A.IDTURMADISC = B.IDTURMADISC    
LEFT JOIN v_Unasp_SMATRICULA C (NOLOCK) ON B.IDTURMADISC = C.IDTURMADISC 
LEFT JOIN STURMADISC D (NOLOCK) ON D.IDTURMADISC = C.IDTURMADISC  


WHERE
C.NOMDISCIPLINA like '%'+(:Disciplina)+'%'";578;;;;13/07/2022;maik.souza;1;1;1;1;;;;0;c876763b-a53b-4ce2-9371-11d84fdf468c;0;;15807;maik.souza;13/07/2022;maik.souza;13/07/2022;0
S;flt.disc.plano;Turma Disciplina Plano de Aula Sem Conteúdo Realizado;"SELECT STURMADISC.IDTURMADISC
FROM   STURMADISC (NOLOCK)
       INNER JOIN SPLETIVO (NOLOCK)
               ON STURMADISC.CODCOLIGADA = SPLETIVO.CODCOLIGADA
                  AND STURMADISC.IDPERLET = SPLETIVO.IDPERLET
       LEFT JOIN SPLANOAULA (NOLOCK)
              ON SPLANOAULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                 AND SPLANOAULA.IDTURMADISC = STURMADISC.IDTURMADISC
WHERE  SPLANOAULA.CONTEUDOEFETIVO IS NULL
       AND CODPERLET LIKE '%' + :PERLET + '%'
       AND SPLANOAULA.DATA <= Getdate() 
";530;;;;05/09/2022;maik.souza;1;1;1;1;;;;0;d9729c57-ab54-4167-a3ec-30bdcd077494;0;;2509;maik.souza;01/09/2022;maik.souza;05/09/2022;0
S;flt.disc.prof;Professor sem Tipo;"SELECT IDTURMADISC
	FROM
(SELECT STURMADISC.IDTURMADISC,COUNT(CODPROF)QTDE
	FROM STURMADISC
		INNER JOIN SPROFESSORTURMA (NOLOCK) ON
			SPROFESSORTURMA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
			AND SPROFESSORTURMA.TIPOPROF IS NULL
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE SPLETIVO.CODCOLIGADA = 1
AND SPLETIVO.CODPERLET = :Perletivo_S
GROUP BY STURMADISC.IDTURMADISC
HAVING COUNT(CODPROF) >= 1)DISCIPLINAS";572;;;;08/06/2022;maik.souza;1;1;1;1;;;;0;3d8a36f6-c415-4ead-9eb5-81f04684b287;0;;-17502;maik.souza;08/06/2022;maik.souza;08/06/2022;0
S;FLT.DISC.PROF01;Disciplina SEM professor;"SELECT STURMADISC.IDTURMADISC

FROM STURMADISC (NOLOCK)
INNER JOIN SPLETIVO  (NOLOCK) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET
LEFT JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC

WHERE 
SPROFESSORTURMA.IDPROFESSORTURMA IS NULL";275;;;;20/06/2022;maik.souza;1;1;1;1;;;;0;705db4eb-0cc8-4f3b-85ba-cdc86b7c0915;0;;9944;maik.souza;20/06/2022;maik.souza;20/06/2022;0
S;flt.disc.profhor;Disciplina com professor fora do horário;"SELECT 
STURMADISC.IDTURMADISC

FROM STURMADISC (NOLOCK)
INNER JOIN SPLETIVO  (NOLOCK) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET
LEFT JOIN SHORARIOTURMA (NOLOCK)  ON STURMADISC.IDTURMADISC=  SHORARIOTURMA.IDTURMADISC
LEFT JOIN SHORARIOPROFESSOR (NOLOCK) ON SHORARIOPROFESSOR.IDHORARIOTURMA = SHORARIOTURMA.IDHORARIOTURMA
WHERE 
SPLETIVO.CODPERLET = :PERIODO_LETIVO
AND SHORARIOPROFESSOR.IDPROFESSORTURMA IS NULL";421;;;;02/08/2022;maik.souza;1;1;1;1;;;;0;f0d1d44b-5e47-4164-93f3-96af9bb39bcd;0;;10238;maik.souza;02/08/2022;maik.souza;02/08/2022;0
S;flt.disc.valorpr;Turma disciplina com Valor de Avaliação Diferente de 10 ;"SELECT 
	STURMADISC.IDTURMADISC
	
FROM STURMADISC (NOLOCK)
	INNER JOIN SPLETIVO  (NOLOCK) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET
		AND SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
	INNER JOIN SETAPAS ON SETAPAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
		AND SETAPAS.IDTURMADISC = STURMADISC.IDTURMADISC
	INNER JOIN SPROVAS (NOLOCK) ON SETAPAS.IDTURMADISC = SPROVAS.IDTURMADISC
		AND SPROVAS.CODCOLIGADA = SETAPAS.CODCOLIGADA
		AND SPROVAS.CODETAPA = SETAPAS.CODETAPA
		AND SPROVAS.TIPOETAPA = SETAPAS.TIPOETAPA
	INNER JOIN SPROVASCOMPL (NOLOCK) ON SPROVAS.IDTURMADISC = SPROVASCOMPL.IDTURMADISC
		AND SPROVAS.CODCOLIGADA = SPROVASCOMPL.CODCOLIGADA
		AND SPROVAS.CODETAPA = SPROVASCOMPL.CODETAPA
		AND SPROVASCOMPL.TIPOETAPA = SPROVAS.TIPOETAPA
		AND SPROVASCOMPL.CODPROVA = SPROVAS.CODPROVA
WHERE
	SPLETIVO.CODPERLET = :PER_LETIVO  
AND SPROVAS.VALOR != 10
AND SPROVASCOMPL.TIPO = 'C' ";906;;;;08/09/2022;consultor1.totvs;1;1;1;1;;;;0;c2a70d00-99c3-4ad9-a9c9-ad1f457a65a1;0;;8957;maik.souza;23/08/2022;consultor1.totvs;08/09/2022;0
S;FLT.EDUCOOD;Coordenadores Por Curso (ProHelp);"/*
Exemplo de consulta:
Periodo = 2022/1, 2022/2, etc..
Sigla_Filial = SP, EC, HT e EAD
*/

select distinct
	
	HF.CODPERLET Periodo,
	HF.NomFilial AS 'Filial',
	ppessoa.nome AS 'Coordenador',
	scoordenador.funcao AS 'Função',
	HF.NomTipoCurso AS 'Nível Ensino',
	HF.NomCurso AS 'Curso',
	HF.CODCURSO AS 'Cod. Curso',
	HF.NomGrade AS 'Matriz', 
	HF.CODGRADE AS 'Cod. Matriz',
	HF.CODHABILITACAO AS 'Cod. Habilitação',
	HF.NomTurno AS 'Turno',
	HF.status AS 'Status'
	 
from v_Unasp_SHABILITACAOFILIALPL HF (NOLOCK)
	left join  scoordenador (NOLOCK)
		ON HF.IDHABILITACAOFILIAL = SCOORDENADOR.IDHABILITACAOFILIAL
	left join ppessoa (NOLOCK) 
		ON scoordenador.codpessoa = ppessoa.codigo
	
where 
		codperlet like  '%' + :Periodo + '%'
		
order by HF.NomCurso


";792;;;;13/10/2022;maik.souza;1;1;1;1;;;;0;271f42d1-9712-49ed-96be-614571bbef7b;0;;1587;maik.souza;15/09/2022;maik.souza;13/10/2022;0
S;FLT.historico;EM TESTE Prohelp - analise curricular alunos;"/*
Mostra as disciplinas que o aluno está reprovado
*/
/*SELECT DISTINCT nome          AS 'Nome',
                Nomstatus     AS 'Status',
                NomDisciplina AS 'Disciplinas',
                nomfilial     AS 'Filial',
                nomtipocurso  AS 'Nível',
                nomcurso      AS 'Curso',
                CODPERLET     AS 'Periodo Letivo',
                CODTURMA      AS 'Turma',
                RA,
                1 AS total 
                
FROM   v_Unasp_SMATRICULA (NOLOCK)
WHERE Nomstatus IN ('Reprovado por Nota','Reprovado','Reprovado por Falta', 'Aproveitamento', 'Concluído','Cursando','Dispensado', 'Dependência','Enriquecimento de Currículo','Extraordinário Aproveitamento','Trancado','')
  Condicional original => Nomstatus = Nomstatus*/
/*
GROUP  BY RA,
          nome,
          Nomstatus,
          NomDisciplina,
          nomturma,
          coddisc,
          nomfilial,
          nomtipocurso,
          nomcurso,
          codturma,
          CODPERLET*/
          
          
          
          SELECT 
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.NOME AS 'CURSO',
	SHABILITACAO.NOME AS 'HABILITACAO',
	STURNO.NOME AS 'TURNO',
	SGRADE.DESCRICAO AS 'GRADE',
	SSTATUS.DESCRICAO AS 'STATUS ALUNO',
	SMATRICPL.RA
FROM SMATRICPL
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN STURNO ON STURNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND STURNO.CODTURNO = SHABILITACAOFILIAL.CODTURNO
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
	AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SCURSO.CODCURSO = SGRADE.CODCURSO
INNER JOIN SHABILITACAO ON SHABILITACAO.CODCOLIGADA = SGRADE.CODCOLIGADA
	AND SHABILITACAO.CODCURSO = SGRADE.CODCURSO
	AND SHABILITACAO.CODHABILITACAO = SGRADE.CODHABILITACAO
	
WHERE 
  SMATRICPL.CODCOLIGADA = :CODCOLIGADA
  AND SMATRICPL.IDPERLET= :IDPERLET
 /* AND SMATRICPL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL*/
 /* AND SMATRICPL.RA = SMATRICPL.RA*/";2798;;;;10/11/2022;marccella.belvedere;1;1;1;1;;;;0;36734c31-48ff-4759-b374-d405608f2d91;0;;-16814;marccella.belvedere;27/09/2022;marccella.belvedere;10/11/2022;0
S;FLT.horadia;prohelp - Horário por Disciplinas e dia de semana;"SELECT
	codperlet Periodo,
	f.nome NomFiial,
	c.CODCURSO,
	c.NOME NomCurso,
	STURMADISC.CODTURMA,
	STURMADISC.idturmadisc,
	STURMADISCCOMPL.TIPOTURMADISC TipoTurma,
	STURMADISCCOMPL.IDCANVAS,
	t.NOME NomTurma,
	SDISCIPLINA.NOME NomDisciplina,
	PPESSOA.NOME Professor,
	SPROFESSORTURMA.TIPOPROF TipoProf,
	SPROFESSORTURMA.CODPROF,
	case isnull(SHORARIO.DIASEMANA, 0)
		when 0 then '_Não Informado'
		when 1 then 'Domingo'
		when 2 then 'Segunda'
		when 3 then 'Terça'
		when 4 then 'Quarta'
		when 5 then 'Quinta'
		when 6 then 'Sexta'
		when 7 then 'Sábado'
	end DIASEMANA,
	isnull(SHORARIO.HORAINICIAL,'00:00') HoraInicial,
	isnull(SHORARIO.HORAFINAL,'00:00') HoraFinal,
	1 AS NomDisciplina/*SDISCIPLINA.NOME NomDisciplina*/
FROM 
	STURMADISC
	inner join STURMA (nolock) t on t.CODCOLIGADA = STURMADISC.CODCOLIGADA and t.CODFILIAL = STURMADISC.CODFILIAL and t.CODTURMA = STURMADISC.CODTURMA and t.IDPERLET = STURMADISC.IDPERLET
	inner join SHABILITACAOFILIAL (nolock) hf on hf.CODCOLIGADA = t.CODCOLIGADA and hf.IDHABILITACAOFILIAL = t.IDHABILITACAOFILIAL
	inner join GFILIAL (nolock) f on f.CODCOLIGADA=hf.CODCOLIGADA and f.CODFILIAL = hf.CODFILIAL
	inner join SCURSO (nolock) c on c.CODCOLIGADA=hf.CODCOLIGADA and c.CODCURSO=hf.CODCURSO
	INNER JOIN SPLETIVO (nolock) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET 
	INNER JOIN SDISCIPLINA (nolock) ON SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	LEFT JOIN SHORARIOTURMA (nolock) ON STURMADISC.CODCOLIGADA =  SHORARIOTURMA.CODCOLIGADA AND STURMADISC.IDTURMADISC =  SHORARIOTURMA.IDTURMADISC 
	LEFT JOIN SHORARIO (nolock) ON SHORARIO.CODCOLIGADA = SHORARIOTURMA.CODCOLIGADA AND SHORARIO.CODHOR = SHORARIOTURMA.CODHOR
	LEFT JOIN SPROFESSORTURMA (nolock) ON SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC
	LEFT JOIN SPROFESSOR (nolock) ON SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
	LEFT JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
	LEFT JOIN STURMADISCCOMPL ON STURMADISCCOMPL.IDTURMADISC = STURMADISC.IDTURMADISC
WHERE 
	CODPERLET IN (:CODPERLET)
	";2079;;;;29/09/2022;maik.souza;1;1;1;1;;;;0;e3635aba-900f-47c8-baf0-debfc677e9de;0;;-27316;marccella.belvedere;27/09/2022;maik.souza;16/11/2022;0
S;flt.prof.disc;Disciplinas do Professor Por Ano;"SELECT 
		v_unasp_STURMADISC.IDTURMADISC
	
	
FROM 
	v_unasp_STURMADISC (NOLOCK) 
	INNER JOIN  SPROFESSORTURMA SPROFESSORTURMA (NOLOCK) 
		ON SPROFESSORTURMA.CODCOLIGADA=v_unasp_STURMADISC.CODCOLIGADA and SPROFESSORTURMA.IDTURMADISC=v_unasp_STURMADISC.IDTURMADISC
	LEFT JOIN SPROFESSOR (NOLOCK)
		ON SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
	LEFT JOIN PPESSOA (NOLOCK)
		ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
	LEFT JOIN STITULACAO (NOLOCK)
		ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO
WHERE
	CODPERLET like '%' + :Ano + '%'
	and PPESSOA.NOME like '%' + :Nome + '%'
	
";601;;;;20/10/2022;maik.souza;1;1;1;1;;;;0;f27dae76-c865-4eb9-8542-be825cd4df6c;0;;9436;maik.souza;20/10/2022;maik.souza;20/10/2022;0
S;flt.profperlet;Professores com atribuição no periodo letivo;"SELECT 
		DISTINCT
		SPROFESSORTURMA.CODPROF,
		PPESSOA.NOME AS NOME,
		NOMFILIAL,
		PPESSOA.EMAIL,
	    PPESSOA.EMAILPESSOAL
	
FROM 
	v_unasp_STURMADISC (NOLOCK) 
	INNER JOIN  SPROFESSORTURMA SPROFESSORTURMA (NOLOCK) 
		ON SPROFESSORTURMA.CODCOLIGADA=v_unasp_STURMADISC.CODCOLIGADA and SPROFESSORTURMA.IDTURMADISC=v_unasp_STURMADISC.IDTURMADISC
	LEFT JOIN SPROFESSOR (NOLOCK)
		ON SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
	LEFT JOIN PPESSOA (NOLOCK)
		ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
	LEFT JOIN STITULACAO (NOLOCK)
		ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO
WHERE
	CODPERLET = :CODPERLET
	";635;;;;06/10/2022;maik.souza;1;1;1;1;;;;0;458a3882-cc43-42ee-b408-715ffcd36c70;0;;30537;maik.souza;06/10/2022;maik.souza;06/10/2022;0
S;flt.tipoturma;Tipos de Turma;"SELECT STURMADISC.IDTURMADISC
FROM STURMADISC
		INNER JOIN STURMADISCCOMPL (NOLOCK) ON
			STURMADISCCOMPL.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND STURMADISCCOMPL.IDTURMADISC = STURMADISC.IDTURMADISC			
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
		INNER JOIN GCONSIST (NOLOCK) ON
			GCONSIST.CODCOLIGADA = STURMADISCCOMPL.CODCOLIGADA
			AND GCONSIST.CODINTERNO = STURMADISCCOMPL.TIPOTURMADISC
			AND GCONSIST.CODTABELA = 'TIPTURMA'
WHERE SPLETIVO.CODPERLET = :Periodo_Letivo
AND GCONSIST.DESCRICAO LIKE '%' + :TipoTurma + '%'";628;;;;16/02/2022;consultor1.totvs;1;1;1;1;;;;0;108e227c-5e01-45f6-9cf8-f17640f0217b;0;;-1812;consultor1.totvs;16/02/2022;consultor1.totvs;16/02/2022;0
S;FLUIG.PROSS002;Consulta Periodo Letivo;select IDPERLET, CODPERLET from SPLETIVO where  year(DTINICIO)>=year(getdate ());80;;;;05/10/2022;gillead.goncalves;1;1;1;1;;;;0;a57b34e6-0ebc-4107-99ee-0eeea940af8e;0;;31831;gillead.goncalves;05/10/2022;gillead.goncalves;05/10/2022;0
S;FORMANDOS;Alunos Formandos;"SELECT 
	P.NOME				Aluno_Nome,
	A.RA				Aluno_RA,
	C.NOME				Curso_Nome,
	m.*

FROM SCURSO C

	LEFT JOIN SHABILITACAO HA
		 ON HA.CODCOLIGADA = C.CODCOLIGADA
		AND HA.CODCURSO = C.CODCURSO

	LEFT JOIN SHABILITACAOFILIAL HF
		 ON HF.CODCOLIGADA = HA.CODCOLIGADA
		AND HF.CODCURSO = HA.CODCURSO
		AND HF.CODHABILITACAO = HA.CODHABILITACAO

	LEFT JOIN SMATRICPL M
		 ON M.CODCOLIGADA = HF.CODCOLIGADA
		AND M.IDHABILITACAOFILIAL = HF.IDHABILITACAOFILIAL

	LEFT JOIN SALUNO A
		 ON A.CODCOLIGADA = M.CODCOLIGADA
		AND A.RA = M.RA

	LEFT JOIN PPESSOA P
		 ON P.CODIGO = A.CODPESSOA
WHERE 
	C.CODCURSO = 'EC-BADMI'

";640;;;;15/04/2021;lucas.ssantos;1;1;1;1;;;;0;4d5cdfd2-ae7c-4703-a769-458c44c7c675;0;;21642;lucas.ssantos;13/04/2021;lucas.ssantos;15/04/2021;0
S;FTL.TESTE;feito para  testar :) prohelp;"SELECT ANALISECURRICULAR.CODDISC,
       ANALISECURRICULAR.DISCIPLINA,
       ANALISECURRICULAR.STATUS,
       ANALISECURRICULAR.PLETIVO,
       ANALISECURRICULAR.NUMCREDITOS,
       ANALISECURRICULAR.CH,
       ANALISECURRICULAR.NOTA,
       ANALISECURRICULAR.FALTAS,
       ANALISECURRICULAR.TIPO,
       ANALISECURRICULAR.CODCOLIGADA,
       ANALISECURRICULAR.IDHABILITACAOFILIAL,
       ANALISECURRICULAR.RA,
       ANALISECURRICULAR.GREQUIV,
       ANALISECURRICULAR.CODPERIODO,
       ANALISECURRICULAR.CONCEITO,
       ANALISECURRICULAR.CONCEITOECTS,
       ANALISECURRICULAR.MINCH,
       ANALISECURRICULAR.MINCREDITOS,
       ANALISECURRICULAR.MINDISCIPLINAS,
       ANALISECURRICULAR.NOME,
       ANALISECURRICULAR.TIPOAVALIACAO,
       PPESSOA.NOME AS NOMEALUNO
FROM   (SELECT SHISTDISCCONCLUIDAS.CODDISC,
               SHISTDISCCONCLUIDAS.DISCIPLINA,
               SHISTDISCCONCLUIDAS.STATUS,
               SHISTDISCCONCLUIDAS.PLETIVO,
               SHISTDISCCONCLUIDAS.NUMCREDITOS,
               SHISTDISCCONCLUIDAS.CH,
               SHISTDISCCONCLUIDAS.NOTA,
               SHISTDISCCONCLUIDAS.FALTAS,
               'CONC' AS TIPO,
               SHISTDISCCONCLUIDAS.CODCOLIGADA,
               SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL,
               SHISTDISCCONCLUIDAS.RA,
               SHISTDISCCONCLUIDAS.GREQUIV,
               SHISTDISCCONCLUIDAS.CODPERIODO,
               SHISTDISCCONCLUIDAS.CONCEITO,
               SHISTDISCCONCLUIDAS.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCCONCLUIDAS (NOLOCK)
       INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL
       WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = :CODCOLIGADA
          AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO
          AND SHISTDISCCONCLUIDAS.CODPERIODO <> 0
        UNION
        SELECT SHISTDISCPENDENTES.CODDISC,
               SHISTDISCPENDENTES.DISCIPLINA,
               SHISTDISCPENDENTES.STATUS,
               SHISTDISCPENDENTES.PLETIVO,
               SHISTDISCPENDENTES.NUMCREDITOS,
               SHISTDISCPENDENTES.CH,
               SHISTDISCPENDENTES.NOTA,
               SHISTDISCPENDENTES.FALTAS,
               'PEND' AS TIPO,
               SHISTDISCPENDENTES.CODCOLIGADA,
               SHISTDISCPENDENTES.IDHABILITACAOFILIAL,
               SHISTDISCPENDENTES.RA,
               SHISTDISCPENDENTES.GREQUIV,
               SHISTDISCPENDENTES.CODPERIODO,
               SHISTDISCPENDENTES.CONCEITO,
               SHISTDISCPENDENTES.CONCEITOECTS,
               NULL   AS MINCH,
               NULL   AS MINCREDITOS,
               NULL   AS MINDISCIPLINAS,
               NULL   AS NOME,
               NULL   AS TIPOAVALIACAO
        FROM   SHISTDISCPENDENTES (NOLOCK)
        INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON SHISTDISCPENDENTES.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
        WHERE  SHISTDISCPENDENTES.CODCOLIGADA = :CODCOLIGADA
           AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO              
           AND SHISTDISCPENDENTES.CODPERIODO <> 0

        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELET.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELET.MINCH,
               SGRUPOOPTELET.MINCREDITOS,
               SGRUPOOPTELET.MINDISCIPLINAS,
               SGRUPOOPTELET.NOME,
               SGRUPOOPTELET.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :CODCOLIGADA )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL 
                      AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO )
               JOIN SGRUPOOPTELET (NOLOCK)
                 ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRUPOOPTELET.CODCOLIGADA
                      AND SHABILITACAOFILIAL.CODCURSO = SGRUPOOPTELET.CODCURSO
                      AND SHABILITACAOFILIAL.CODHABILITACAO = SGRUPOOPTELET.CODHABILITACAO
                      AND SHABILITACAOFILIAL.CODGRADE = SGRUPOOPTELET.CODGRADE )
               JOIN SDISCGRUPOOPTELET (NOLOCK)
                 ON ( SGRUPOOPTELET.CODCOLIGADA = SDISCGRUPOOPTELET.CODCOLIGADA
                      AND SGRUPOOPTELET.CODCURSO = SDISCGRUPOOPTELET.CODCURSO
                      AND SGRUPOOPTELET.CODHABILITACAO = SDISCGRUPOOPTELET.CODHABILITACAO
                      AND SGRUPOOPTELET.CODGRADE = SDISCGRUPOOPTELET.CODGRADE
                      AND SGRUPOOPTELET.IDGRUPO = SDISCGRUPOOPTELET.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELET.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELET.EXIBEANALISE = 'S'
               AND SGRADEALUNO.RA IS NULL
               AND SHISTDISCOPTELETIVAS.RA NOT IN (SELECT SCOMPONENTECURRALUNO.RA
                                                   FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                   WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                          AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                          AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA)
        UNION
        SELECT SHISTDISCOPTELETIVAS.CODDISC,
               SHISTDISCOPTELETIVAS.DISCIPLINA,
               SHISTDISCOPTELETIVAS.STATUS,
               SHISTDISCOPTELETIVAS.PLETIVO,
               SHISTDISCOPTELETIVAS.NUMCREDITOS,
               SHISTDISCOPTELETIVAS.CH,
               SHISTDISCOPTELETIVAS.NOTA,
               SHISTDISCOPTELETIVAS.FALTAS,
               CASE
                 WHEN ( SHISTDISCOPTELETIVAS.CODSTATUSRES IS NOT NULL )
                       OR ( SHISTDISCOPTELETIVAS.STATUS = '*Equiv' ) THEN 'CONC'
                 ELSE 'PEND'
               END AS TIPO,
               SHISTDISCOPTELETIVAS.CODCOLIGADA,
               SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL,
               SHISTDISCOPTELETIVAS.RA,
               SHISTDISCOPTELETIVAS.GREQUIV,
               SGRUPOOPTELETALUNO.CODPERIODO,
               SHISTDISCOPTELETIVAS.CONCEITO,
               SHISTDISCOPTELETIVAS.CONCEITOECTS,
               SGRUPOOPTELETALUNO.MINCH,
               SGRUPOOPTELETALUNO.MINCREDITOS,
               SGRUPOOPTELETALUNO.MINDISCIPLINAS,
               SGRUPOOPTELETALUNO.NOME,
               SGRUPOOPTELETALUNO.TIPOAVALIACAO
        FROM   SPARAM (NOLOCK)
               JOIN SHISTDISCOPTELETIVAS (NOLOCK)
                 ON ( SPARAM.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.CODCOLIGADA = :CODCOLIGADA )
               JOIN SHABILITACAOFILIAL (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
                      AND SHABILITACAOFILIAL.CODCURSO = :CODCURSO )
               JOIN SGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRUPOOPTELETALUNO.RA )
               JOIN SDISCGRUPOOPTELETALUNO (NOLOCK)
                 ON ( SGRUPOOPTELETALUNO.CODCOLIGADA = SDISCGRUPOOPTELETALUNO.CODCOLIGADA
                      AND SGRUPOOPTELETALUNO.IDHABILITACAOFILIAL = SDISCGRUPOOPTELETALUNO.IDHABILITACAOFILIAL
                      AND SGRUPOOPTELETALUNO.RA = SDISCGRUPOOPTELETALUNO.RA
                      AND SGRUPOOPTELETALUNO.IDGRUPO = SDISCGRUPOOPTELETALUNO.IDGRUPO
                      AND SHISTDISCOPTELETIVAS.CODDISC = SDISCGRUPOOPTELETALUNO.CODDISC )
               LEFT JOIN SGRADEALUNO (NOLOCK)
                 ON ( SHISTDISCOPTELETIVAS.CODCOLIGADA = SGRADEALUNO.CODCOLIGADA
                      AND SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL = SGRADEALUNO.IDHABILITACAOFILIAL
                      AND SHISTDISCOPTELETIVAS.RA = SGRADEALUNO.RA )
        WHERE  SPARAM.CODCOLIGADA = :CODCOLIGADA
               AND SPARAM.CODFILIAL = :CODFILIAL
               AND SPARAM.CODTIPOCURSO = :CODTIPOCURSO
               AND SPARAM.ID = 'USAGRUPOOPTELETIVA'
               AND (SPARAM.TEXTO = '1' OR SPARAM.TEXTO = 'S')
               AND SGRUPOOPTELETALUNO.EXIBEANALISE = 'S'
               AND ( SGRADEALUNO.RA IS NOT NULL
                      OR SHISTDISCOPTELETIVAS.RA IN (SELECT SCOMPONENTECURRALUNO.RA
                                                     FROM   SCOMPONENTECURRALUNO (NOLOCK)
                                                     WHERE  SCOMPONENTECURRALUNO.CODCOLIGADA = SHISTDISCOPTELETIVAS.CODCOLIGADA
                                                            AND SCOMPONENTECURRALUNO.IDHABILITACAOFILIAL = SHISTDISCOPTELETIVAS.IDHABILITACAOFILIAL
                                                            AND SCOMPONENTECURRALUNO.RA = SHISTDISCOPTELETIVAS.RA) )) ANALISECURRICULAR
 LEFT JOIN SALUNO ON SALUNO.CODCOLIGADA = ANALISECURRICULAR.CODCOLIGADA AND SALUNO.RA = ANALISECURRICULAR.RA
 INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
ORDER  BY ANALISECURRICULAR.RA,
          ANALISECURRICULAR.CODPERIODO,
          ANALISECURRICULAR.NOME";11436;;;;10/11/2022;maik.souza;1;1;1;1;;;;0;4c0c2dd9-54e0-4b65-8b69-4dd7da3c0cea;0;;-7656;marccella.belvedere;27/09/2022;maik.souza;10/11/2022;0
S;ftr_Prof_semuser;Professores sem usuário;"SELECT DISTINCT
	SPROFESSOR.CODPROF	
FROM SPROFESSOR
	JOIN PPESSOA 
		ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA 
	JOIN SPROFESSORTURMA 
		ON SPROFESSORTURMA.CODPROF = SPROFESSOR.CODPROF 
	JOIN STURMADISC 
		ON STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
	JOIN SPLETIVO 
		ON SPLETIVO.IDPERLET = STURMADISC.IDPERLET 


WHERE 
	PPESSOA.CODUSUARIO IS NULL
	AND SPLETIVO.CODPERLET like '%' + :PERIODOLETIVO + '%'";431;;;;27/07/2021;mestre;1;1;1;1;;;;0;6786c47f-1c0a-4098-9481-a0cb8702d94f;0;;17535;totvs;26/07/2021;mestre;27/07/2021;0
S;ftr_Prof_VFiliai;Professores em mais de uma filial por Periodo Letivo;"
SELECT 
	A.CODPROF
FROM (

SELECT 
	SPROFESSORTURMA.CODCOLIGADA,
	SPROFESSORTURMA.CODPROF,
	SPLETIVO.CODFILIAL
FROM
	SPROFESSORTURMA (NOLOCK)
	INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA = SPROFESSORTURMA.CODCOLIGADA
		AND STURMADISC.IDTURMADISC = SPROFESSORTURMA.IDTURMADISC
	INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
		AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
WHERE
	SPLETIVO.CODPERLET = :CODPERLET
GROUP BY 
	SPROFESSORTURMA.CODCOLIGADA,
	SPROFESSORTURMA.CODPROF,
	SPLETIVO.CODFILIAL) AS A
GROUP BY A.CODCOLIGADA,
	A.CODPROF
HAVING COUNT(A.CODFILIAL) > 1
";635;;;;15/03/2022;consultor1.totvs;1;1;1;1;;;;0;0cdebcbc-6592-43fa-b860-7114f5441c4c;0;;18056;consultor1.totvs;15/03/2022;consultor1.totvs;15/03/2022;0
S;FV.DEL.INSC;Desmatricular e Excluir Inscrição;"SELECT 
	SALUNO.CODCOLCFO,
	SALUNO.CODCFO,
	SMATRICPL.CODFILIAL,
	PAI.CODPESSOAFILIACAO CODPESSOA_PAI,
	MAE.CODPESSOAFILIACAO CODPESSOA_MAE,
	PPESSOA.CODIGO CODPESSOA_ALUNO,
	SALUNO.CODPESSOARACA,
	SMATRICPL.CODSTATUS,
	SHABILITACAOFILIAL.CODTIPOCURSO,
	SMATRICPL.CODTURMA,
	SPSUSUARIO.CODUSUARIOPS,
	CONVERT(VARCHAR(19), ISNULL(SMATRICPL.DTMATRICULA, GETDATE()), 126) DTMATRICULA,
	SMATRICPL.IDHABILITACAOFILIAL,
	SPSUSUARIO.NOME,
	SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO,
	SMATRICPL.PERIODO,
	SMATRICPL.RA,
	SMATRICPL.CODCOLIGADA,
	SPSOPCAOINSCRITO.IDAREAINTERESSE,
	SMATRICPL.IDPERLET,
	SPSINSCRICAOAREAOFERTADA.IDPS,
	SHABILITACAOALUNO.CODSTATUS CODSTATUS_CURSO,
	'false' USANOVOPORTAL,
	SCONTRATO.CODCONTRATO
FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)
LEFT JOIN SPSUSUARIO (NOLOCK)
	ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
LEFT JOIN PPESSOA (NOLOCK) PPESSOA_PS
	ON PPESSOA_PS.CODIGO = SPSINSCRICAOAREAOFERTADA.CODPESSOA
INNER JOIN SPSOPCAOINSCRITO (NOLOCK)
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SMATRICPL (NOLOCK)
	ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
INNER JOIN SHABILITACAOALUNO (NOLOCK)
	ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL (NOLOCK)
	ON SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
LEFT JOIN SCONTRATO (NOLOCK)
	ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SCONTRATO.RA = SMATRICPL.RA
	AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SALUNO (NOLOCK)
	ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (NOLOCK)
	ON PPESSOA.CODIGO = SALUNO.CODPESSOA
OUTER APPLY(
	SELECT 
		CODPESSOAFILIACAO
	FROM VFILIACAO (NOLOCK)
	WHERE VFILIACAO.CODPESSOAFILHO = PPESSOA.CODIGO
		AND VFILIACAO.TIPORELACIONAMENTO = 'P'
)PAI
OUTER APPLY(
	SELECT 
		CODPESSOAFILIACAO
	FROM VFILIACAO (NOLOCK)
	WHERE VFILIACAO.CODPESSOAFILHO = PPESSOA.CODIGO
		AND VFILIACAO.TIPORELACIONAMENTO = 'M'
)MAE
WHERE SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = :CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = :IDPS
	AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = :NUMEROINSCRICAO";2759;;;;16/02/2022;consultor1.totvs;1;1;1;1;;;;0;2acafeec-ac16-4f1c-8591-606c69459f9f;;;5121;consultor1.totvs;16/02/2022;consultor1.totvs;16/02/2022;
S;FV.EDU.PESOS;PESOS;"SELECT SPROVAS.IDTURMADISC,SPROVAS.CODPROVA,SPROVAS.CODETAPA,SPROVASCOMPL.PESO
	FROM SPROVAS
		INNER JOIN SPROVASCOMPL (NOLOCK) ON
			SPROVASCOMPL.CODCOLIGADA = SPROVAS.CODCOLIGADA
			AND SPROVASCOMPL.IDTURMADISC = SPROVAS.IDTURMADISC
			AND SPROVASCOMPL.CODETAPA = SPROVAS.CODETAPA
			AND SPROVASCOMPL.CODPROVA = SPROVAS.CODPROVA
WHERE SPROVAS.IDTURMADISC = :IDTURMADISC
AND SPROVAS.CODPROVA = :CODPROVA
AND SPROVAS.CODETAPA = :CODETAPA";446;;;;12/01/2022;consultor1.totvs;1;1;1;1;;;;0;b45ee7d1-9995-4f67-a1e9-be4550c73796;0;;-1466;consultor1.totvs;12/01/2022;consultor1.totvs;12/01/2022;0
S;FV.GRD.AR.001;Fórmulas - Graduação -  RETORNA DADOS DAS PROVAS 1 Etapa;"SELECT Count(SPROVAS.CODPROVA)                             QTDPROVAS,
       Count(SNOTAS.CODPROVA)                              QTDNOTAS,
       Cast(ISNULL(Sum(SNOTAS.NOTA), 0) AS DECIMAL(10, 2)) MEDIA,
       ISNULL(SGD.CODGRPDISC, 0)                           GRUPO,
       SDISCIPLINA.TIPONOTA,
       SETAPAS.PONTDIST
FROM   SDISCIPLINA(NOLOCK)
       INNER JOIN STURMADISC(NOLOCK)
               ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
                  AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
       INNER JOIN SHABILITACAOFILIAL(NOLOCK) SHF
               ON SHF.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SHF.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL
       LEFT JOIN SDISCGRADE SGD (NOLOCK)
              ON SGD.CODCOLIGADA = SHF.CODCOLIGADA
                 AND SGD.CODCURSO = SHF.CODCURSO
                 AND SGD.CODHABILITACAO = SHF.CODHABILITACAO
                 AND SGD.CODGRADE = SHF.CODGRADE
                 AND SGD.CODDISC = STURMADISC.CODDISC
       INNER JOIN SPROVAS(NOLOCK)
               ON SPROVAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SPROVAS.IDTURMADISC = STURMADISC.IDTURMADISC
                  AND SPROVAS.TIPOETAPA = 'N'
                  AND SPROVAS.CODETAPA = 1
       INNER JOIN SMATRICULA(NOLOCK)
               ON SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC
       INNER JOIN SETAPAS(NOLOCK)
               ON SETAPAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
                  AND SETAPAS.IDTURMADISC = STURMADISC.IDTURMADISC
                  AND SETAPAS.TIPOETAPA = 'N'
                  AND SETAPAS.CODETAPA = 1
                /*  AND SPROVAS.VALOR > 0*/
       LEFT JOIN SNOTAS(NOLOCK)
              ON SNOTAS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                 AND SNOTAS.IDTURMADISC = SMATRICULA.IDTURMADISC
                 AND SNOTAS.CODPROVA = SPROVAS.CODPROVA
                 AND SNOTAS.CODETAPA = SPROVAS.CODETAPA
                 AND SNOTAS.RA = SMATRICULA.RA
                 AND SNOTAS.NOTA IS NOT NULL
                 AND SNOTAS.CODETAPA = 1
WHERE  STURMADISC.CODCOLIGADA = :FRM_GRDCTX02_S
       AND STURMADISC.IDTURMADISC = :FRM_GRDCTX03_S
       AND SMATRICULA.RA = :FRM_GRDCTX01_S
GROUP  BY SGD.CODGRPDISC,
          SDISCIPLINA.TIPONOTA,
          SETAPAS.PONTDIST 
";2412;;;;26/08/2021;mestre;1;1;1;1;;;;0;a297d25f-3e29-4866-99b4-95bed78001a3;0;;-20565;mestre;26/08/2021;mestre;26/08/2021;0
S;FV.GRD.AR.002;Fórmulas - Graduação - CARGA HORÁRIA DA DISCIPLINA;"/*CONSIDERAR O Nº DE ENCONTROS*/
SELECT ( ( Cast(Cast(SDISCIPLINA.CH AS INT) * 60 AS INT) ) / 75 )CH,
       CASE
         WHEN DIBLOQNOTAFALTA = 'N'
              AND DISCIPLINA = 'S' THEN 1
         ELSE 0
       END                                                       PROCESSA
FROM   STURMADISC(NOLOCK)
       INNER JOIN SMATRICULA (NOLOCK)
               ON ( SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                    AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC )
       INNER JOIN SSTATUS (NOLOCK)
               ON ( SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                    AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS )
       INNER JOIN SDISCIPLINA(NOLOCK)
               ON ( SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
                    AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC )
WHERE  STURMADISC.CODCOLIGADA = :FRM_GRDCTX02
       AND STURMADISC.IDTURMADISC = :FRM_GRDCTX03
       AND SMATRICULA.RA = :FRM_GRDCTX01 
";987;;;;26/08/2021;mestre;1;1;1;1;;;;0;dd39040f-7b7b-49b5-95f1-64fd8a28fd35;0;;28854;mestre;26/08/2021;mestre;26/08/2021;0
S;FvDadosMatricpl;Dados do aluno;"SELECT PPESSOA.TELEFONE1  as TELEFONE , SCAMPUS.DESCRICAO AS POLO 
FROM SMATRICPL (nolock)
INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOALUNO (nolock) ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA AND SHABILITACAOALUNO.RA = SALUNO.RA AND  SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
LEFT JOIN SCAMPUS (nolock) ON SHABILITACAOALUNO.CODCAMPUS = SCAMPUS.CODCAMPUS
WHERE SMATRICPL.RA=:RA
AND SMATRICPL.CODCOLIGADA=:CODCOLIGADA 
AND SMATRICPL.IDHABILITACAOFILIAL=:IDHABILITACAOFILIAL
AND SMATRICPL.IDPERLET=:IDPERLET
";701;;;;24/08/2021;mestre;1;1;1;1;;;;0;5a4b39f9-3920-4452-aa35-6a207689d144;0;;19079;mestre;19/08/2021;mestre;24/08/2021;0
S;GeraçãoFinan;Geração Lançamento Financeiro;"SELECT    DISTINCT  SCONTRATO.RA , SCONTRATO.CODCOLIGADA , PPESSOA.NOME

FROM SCONTRATO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE SCONTRATO.CODTIPOCURSO =:Tipocurso
AND   SPLETIVO.CODPERLET =:PeriodoLetivo
AND   SCONTRATO.CODFILIAL =:Filial
AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'

/*AND   SCONTRATO.CODCONTRATO NOT IN ( SELECT SPARCELA.CODCONTRATO FROM SPARCELA
								 INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
								 INNER JOIN SLAN ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
								 WHERE month(SPARCELA.DTVENCIMENTO) =:MES
								 AND   year(SPARCELA.DTVENCIMENTO)=:ANO)
 AND  (SELECT COUNT(RA) FROM SMATRICULA 
            INNER JOIN SSTATUS S ON S.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND S.CODSTATUS = SMATRICULA.CODSTATUS
            WHERE RA = SMATRICPL.RA 
  			  AND SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
  			  AND IDPERLET = SMATRICPL.IDPERLET 
  			  AND IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
  			  AND S.DESCRICAO <> 	SSTATUS.DESCRICAO
  			   )  < 1
  			   
 AND (SELECT COUNT( C.RA)  FROM SCONTRATO C 
      WHERE C.RA = SMATRICPL.RA 
      AND IDPERLET = SMATRICPL.IDPERLET  
      AND CODCOLIGADA = SMATRICPL.CODCOLIGADA) = 1*/
  			   
    
";1898;;;;01/08/2022;robson.canto;1;1;1;1;;;;0;29a99665-4795-4868-81f2-b92851cca776;0;;-9347;mestre;08/07/2021;robson.canto;01/08/2022;0
S;GeraçãoFinan.1;Geração Lançamento Financeiro (POS GRADUAÇÃO);"SELECT    distinct  SCONTRATO.RA , SCONTRATO.CODCOLIGADA , PPESSOA.NOME 

FROM SCONTRATO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE SCONTRATO.CODTIPOCURSO =:Tipocurso
AND   SPLETIVO.CODPERLET =:PeriodoLetivo
AND   SCONTRATO.CODFILIAL =:Filial
AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
AND   SCONTRATO.CODCONTRATO NOT IN ( SELECT SPARCELA.CODCONTRATO FROM SPARCELA
								 INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
								 INNER JOIN SLAN ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
								 WHERE month(SPARCELA.DTVENCIMENTO) =:MES
								 AND   year(SPARCELA.DTVENCIMENTO)=:ANO)
			   
    
 ";1283;;;;30/08/2021;mestre;1;1;1;1;;;;0;29a99665-4795-4868-81f2-b92851cca776;0;;-29139;mestre;30/08/2021;mestre;30/08/2021;0
S;GeraçãoFinan.2;Geração Lançamento Financeiro (ALUNOS COM MAIS DE 1 CONTRATO);"SELECT    DISTINCT  SCONTRATO.RA , SCONTRATO.CODCOLIGADA , PPESSOA.NOME 

FROM SCONTRATO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE SCONTRATO.CODTIPOCURSO =:Tipocurso
AND   SPLETIVO.CODPERLET =:PeriodoLetivo
AND   SCONTRATO.CODFILIAL =:Filial
AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
AND   SCONTRATO.CODCONTRATO NOT IN ( SELECT SPARCELA.CODCONTRATO FROM SPARCELA
								 INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
								 INNER JOIN SLAN ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
								 WHERE month(SPARCELA.DTVENCIMENTO) =:MES
								 AND   year(SPARCELA.DTVENCIMENTO)=:ANO)
 AND  (SELECT COUNT(RA) FROM SMATRICULA 
            INNER JOIN SSTATUS S ON S.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND S.CODSTATUS = SMATRICULA.CODSTATUS
            WHERE RA = SMATRICPL.RA 
  			  AND SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
  			  AND IDPERLET = SMATRICPL.IDPERLET 
  			  AND IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
  			  AND S.DESCRICAO <> 	SSTATUS.DESCRICAO
  			   )  < 1
  			   
 AND (SELECT COUNT( C.RA)  FROM SCONTRATO C 
      WHERE C.RA = SMATRICPL.RA 
      AND IDPERLET = SMATRICPL.IDPERLET  
      AND CODCOLIGADA = SMATRICPL.CODCOLIGADA) > 1
  			   
    
";1893;;;;30/08/2021;mestre;1;1;1;1;;;;0;29a99665-4795-4868-81f2-b92851cca776;0;;9016;mestre;30/08/2021;mestre;30/08/2021;0
S;GeraçãoFinan.3;Geração Lançamento Financeiro (ALUNOS COM DISCIPLINAS <> CURSANDO);"SELECT    DISTINCT  SCONTRATO.RA , SCONTRATO.CODCOLIGADA , PPESSOA.NOME 

FROM SCONTRATO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE SCONTRATO.CODTIPOCURSO =:Tipocurso
AND   SPLETIVO.CODPERLET =:PeriodoLetivo
AND   SCONTRATO.CODFILIAL =:Filial
AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
AND   SCONTRATO.CODCONTRATO NOT IN ( SELECT SPARCELA.CODCONTRATO FROM SPARCELA
								 INNER JOIN SCONTRATO ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO
								 INNER JOIN SLAN ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA
								 WHERE month(SPARCELA.DTVENCIMENTO) =:MES
								 AND   year(SPARCELA.DTVENCIMENTO)=:ANO)
 AND  (SELECT COUNT(RA) FROM SMATRICULA 
            INNER JOIN SSTATUS S ON S.CODCOLIGADA = SMATRICULA.CODCOLIGADA AND S.CODSTATUS = SMATRICULA.CODSTATUS
            WHERE RA = SMATRICPL.RA 
  			  AND SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
  			  AND IDPERLET = SMATRICPL.IDPERLET 
  			  AND IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
  			  AND S.DESCRICAO <> 	SSTATUS.DESCRICAO
  			   )  >= 1
  			   
 
  			   
    
";1722;;;;30/08/2021;mestre;1;1;1;1;;;;0;29a99665-4795-4868-81f2-b92851cca776;0;;17170;mestre;30/08/2021;mestre;30/08/2021;0
S;GERENCIALURANIA;Turmas Gerenciais para Urania;"SELECT sturma.codcoligada , sturma.CODFILIAL , sturma.codtipocurso, sturma.codturma , sturma.NOME,  sturma.NOMERED ,  sturma.CODHORARIOAGRUPURANIA ,STURNO.CODTURNO
FROM STURMA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = STURMA.CODCOLIGADA AND SPLETIVO.IDPERLET = STURMA.IDPERLET
INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = STURMA.CODCOLIGADA AND STURMADISC.CODFILIAL = STURMA.CODFILIAL AND STURMADISC.CODTURMA = STURMA.CODTURMA AND STURMADISC.IDPERLET = STURMA.IDPERLET AND STURMADISC.GERENCIAL = 'S'
INNER JOIN STURNO ON STURMADISC.CODCOLIGADA = STURNO.CODCOLIGADA AND STURMADISC.CODTURNO = STURNO.CODTURNO 

/*WHERE sturma.CODTURMA = 'GEAJC3LBS'*/

/*WHERE*/ /*AND*/";684;;;;07/10/2021;lilian.buzetti;1;1;1;1;;;;0;2a49598d-9add-40f2-bd29-2e9802857541;0;;4168;lilian.buzetti;07/10/2021;lilian.buzetti;07/10/2021;0
S;GRAFICO.001;TESTE;"SELECT NOME , COUNT(NOME) INSCRITOS FROM SPSINSCRICAOAREAOFERTADA
INNER JOIN  SPSOPCAOINSCRITO ON SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
INNER JOIN  SPSAREAINTERESSE ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE

GROUP BY NOME
ORDER BY COUNT(NOME)";372;;;;14/05/2021;mestre;1;1;1;1;;;;0;2fbb805e-5694-438d-ba90-f4f4984360b2;0;;2812;mestre;14/05/2021;mestre;14/05/2021;0
S;GS;GeradorDeSaida;select * from v_unasp_smatricpl where ra = '0';46;;;;05/04/2022;lucas.ssantos;1;1;1;1;;;;0;6e633acc-b18e-4bfd-94a5-be832a030abf;0;;29576;lucas.ssantos;05/04/2022;lucas.ssantos;05/04/2022;0
S;GS.001;TesteAluno;"Select
*
from v_unasp_smatricpl smp

where
	codfilial = :codfilial
	And codperlet = :codperlet
	And nomstatus = :status";126;;;;05/04/2022;lucas.ssantos;1;1;1;1;;;;0;282bbbb0-45f0-480d-8771-6cb2de5c5b79;0;;7819;lucas.ssantos;05/04/2022;lucas.ssantos;05/04/2022;0
S;H.002;Resumo de Atendimentos;"SELECT
	ab.CODATENDIMENTO, 
	ab.ABERTURA,
	YEAR(ab.ABERTURA) Ano,
	Month(ab.ABERTURA) Mes,
	a.RA,
	pp.NOME NOMECLIENTE,
	ta.NOME 'TIPO ATENDIMENTO',
	t.NOME ETAPA,
	case ab.CODSTATUS 
	when 'A' then 'Em andamento'
	when 'R' then 'Concluído a responder'
	when 'O' then 'Concluído respondido'
	when 'F' then 'Concluído confirmado'
	when 'U' then 'Concluído automático(pelo sistema)'
	when 'V' then 'Avaliado'
	when 'G' then 'Agendado a responder'
	when 'E' then 'Agendado respondido'
	when 'T' then 'Aguardando terceiros'
	when 'C' then 'Cancelado'
	when 'D' then 'Despertado'
	end Status,
	(select max(DATA) DataStatus from HSTATUSATEND at where at.CODATENDIMENTO=ab.CODATENDIMENTO and CODSTATUS = ab.CODSTATUS) DataStatus,	
	par.Parametros,
	l.DESLOCAL LocalEntrega,
	fl.IDLAN,
	fl.DATABAIXA 'DATA BAIXA',
	s.TEXTOSOLICITACAO,
	CURSOAB.NOME AS 'NomeCurso',
	ISNULL(DTCONCLUSAO.DTCONCLUSAO,'') AS 'DTCONCLUSAO',
	1 Contagem
FROM 
	HATENDIMENTOBASE				(NOLOCK) ab
	INNER JOIN HATENDIMENTOEXT		(NOLOCK) ae ON ab.CODCOLIGADA = ae.CODCOLIGADA AND ab.CODLOCAL = ae.CODLOCAL AND ab.CODATENDIMENTO = ae.CODATENDIMENTO
	LEFT JOIN SALUNO			    (NOLOCK) a	ON ae.COLIGADAALUNO = a.CODCOLIGADA AND ae.RAALUNO = a.RA
	LEFT JOIN PPESSOA				(NOLOCK) pp	ON pp.CODIGO = a.CODPESSOA OR pp.CODIGO = ae.CODPESSOA
	LEFT JOIN HTIPOATENDIMENTO		(NOLOCK) ta ON ta.CODCOLIGADA = ab.CODCOLIGADA AND ta.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO
	LEFT JOIN HTAREFA				(NOLOCK) t  ON t.CODCOLIGADA = ab.CODCOLIGADA AND t.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO AND t.CODTAREFA = ab.CODTAREFA              
	LEFT JOIN SPARCELASOLICITACAO	(NOLOCK) ps ON ps.CODCOLIGADAATEND = ab.CODCOLIGADA AND ps.CODATENDIMENTO = ab.CODATENDIMENTO AND ps.CODLOCAL = ab.CODLOCAL
	LEFT JOIN SPARCELA				(NOLOCK) p	ON p.CODCOLIGADA = ps.CODCOLIGADA AND p.IDPARCELA = ps.IDPARCELA              
	LEFT JOIN SLAN					(NOLOCK) sl ON sl.CODCOLIGADA = p.CODCOLIGADA AND sl.IDPARCELA = p.IDPARCELA              
	LEFT JOIN FLAN					(NOLOCK) fl ON fl.CODCOLIGADA = sl.CODCOLIGADA AND fl.IDLAN = sl.IDLAN              
	LEFT JOIN HLOCALENTREGA			(NOLOCK) le ON le.CODCOLIGADA = ab.CODCOLIGADA AND le.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO AND le.CODLOCALENTREGA = ab.CODLOCALENTREGA
	LEFT JOIN HLOCALIDADE			(NOLOCK) l  ON l.CODLOCAL = le.CODLOCAL  
	left join HSOLICITACAO					 s	on s.CODATENDIMENTO = ab.CODATENDIMENTO
	left join (select CODATENDIMENTO, STRING_AGG(VALOR, ' - ') Parametros from HPARAMATENDIMENTO group by CODATENDIMENTO) par on par.CODATENDIMENTO = ab.CODATENDIMENTO


	OUTER APPLY(

SELECT SCURSO.NOME, HATENDIMENTOBASE.CODCOLIGADA, HATENDIMENTOBASE.CODATENDIMENTO
FROM HATENDIMENTOBASE (NOLOCK)
INNER JOIN HPARAMTIPOATEND (NOLOCK) ON HPARAMTIPOATEND.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HPARAMTIPOATEND.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
INNER JOIN HPARAMATENDIMENTO (NOLOCK) ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
	AND HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
	AND HPARAMTIPOATEND.CODPARAMETRO = HPARAMATENDIMENTO.CODPARAMETRO
INNER JOIN HPARAM (NOLOCK) ON HPARAM.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA
	AND HPARAM.CODPARAMETRO = HPARAMATENDIMENTO.CODPARAMETRO
	AND HPARAM.NOME LIKE '%CURSO%'
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA
	AND SCURSO.CODCURSO = HPARAMATENDIMENTO.VALOR
WHERE HATENDIMENTOBASE.CODCOLIGADA=AB.CODCOLIGADA
AND HATENDIMENTOBASE.CODATENDIMENTO= AB.CODATENDIMENTO
	) AS CURSOAB


OUTER APPLY (

SELECT CONVERT(VARCHAR,HSTATUSATEND.DATA,103) AS DTCONCLUSAO, HATENDIMENTOBASE.CODCOLIGADA, HATENDIMENTOBASE.CODATENDIMENTO
FROM HATENDIMENTOBASE (NOLOCK)
INNER JOIN HSTATUSATEND (NOLOCK) ON HSTATUSATEND.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
AND HSTATUSATEND.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
AND HSTATUSATEND.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
AND HSTATUSATEND.CODSTATUS = 'F'
WHERE HATENDIMENTOBASE.CODCOLIGADA=AB.CODCOLIGADA
AND HATENDIMENTOBASE.CODATENDIMENTO= AB.CODATENDIMENTO
) AS DTCONCLUSAO

WHERE 
	ab.CODSTATUS != 'M' 
	AND ab.CODCOLIGADARESP = 1
	and ab.CODATENDIMENTO>101
order by CODATENDIMENTO";4237;;;;22/08/2022;isaldo;1;1;1;1;;;;0;0231935b-26f9-4a0c-9ce8-290043149458;0;;-22297;isaldo;30/03/2022;isaldo;22/08/2022;0
S;H.002.1;Resumo de Atendimentos;"
SELECT 
	ab.CODATENDIMENTO, 
	ab.ABERTURA,
	YEAR(ab.ABERTURA) Ano,
	Month(ab.ABERTURA) Mes,
	a.RA,
	pp.NOME NOMECLIENTE,
	ta.NOME 'TIPO ATENDIMENTO',
	t.NOME ETAPA,
	case ab.CODSTATUS 
	when 'A' then 'Em andamento'
	when 'R' then 'Concluído a responder'
	when 'O' then 'Concluído respondido'
	when 'F' then 'Concluído confirmado'
	when 'U' then 'Concluído automático(pelo sistema)'
	when 'V' then 'Avaliado'
	when 'G' then 'Agendado a responder'
	when 'E' then 'Agendado respondido'
	when 'T' then 'Aguardando terceiros'
	when 'C' then 'Cancelado'
	when 'D' then 'Despertado'
	end Status,
	(select max(DATA) DataStatus from HSTATUSATEND at where at.CODATENDIMENTO=ab.CODATENDIMENTO and CODSTATUS = ab.CODSTATUS) DataStatus,	
	par.Parametros,
	l.DESLOCAL LocalEntrega,
	fl.IDLAN,
	fl.DATABAIXA 'DATA BAIXA',
	s.TEXTOSOLICITACAO,
	CURSOAB.CODCURSO,
	CURSOAB.NOME AS 'NomeCurso',
	ISNULL(DTCONCLUSAO.DTCONCLUSAO,'') AS 'DTCONCLUSAO'
FROM 
	HATENDIMENTOBASE				(NOLOCK) ab
	INNER JOIN HATENDIMENTOEXT		(NOLOCK) ae ON ab.CODCOLIGADA = ae.CODCOLIGADA AND ab.CODLOCAL = ae.CODLOCAL AND ab.CODATENDIMENTO = ae.CODATENDIMENTO
	LEFT JOIN SALUNO			    (NOLOCK) a	ON ae.COLIGADAALUNO = a.CODCOLIGADA AND ae.RAALUNO = a.RA
	LEFT JOIN PPESSOA				(NOLOCK) pp	ON pp.CODIGO = a.CODPESSOA OR pp.CODIGO = ae.CODPESSOA
	LEFT JOIN HTIPOATENDIMENTO		(NOLOCK) ta ON ta.CODCOLIGADA = ab.CODCOLIGADA AND ta.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO
	LEFT JOIN HTAREFA				(NOLOCK) t  ON t.CODCOLIGADA = ab.CODCOLIGADA AND t.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO AND t.CODTAREFA = ab.CODTAREFA              
	LEFT JOIN SPARCELASOLICITACAO	(NOLOCK) ps ON ps.CODCOLIGADAATEND = ab.CODCOLIGADA AND ps.CODATENDIMENTO = ab.CODATENDIMENTO AND ps.CODLOCAL = ab.CODLOCAL
	LEFT JOIN SPARCELA				(NOLOCK) p	ON p.CODCOLIGADA = ps.CODCOLIGADA AND p.IDPARCELA = ps.IDPARCELA              
	LEFT JOIN SLAN					(NOLOCK) sl ON sl.CODCOLIGADA = p.CODCOLIGADA AND sl.IDPARCELA = p.IDPARCELA              
	LEFT JOIN FLAN					(NOLOCK) fl ON fl.CODCOLIGADA = sl.CODCOLIGADA AND fl.IDLAN = sl.IDLAN              
	LEFT JOIN HLOCALENTREGA			(NOLOCK) le ON le.CODCOLIGADA = ab.CODCOLIGADA AND le.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO AND le.CODLOCALENTREGA = ab.CODLOCALENTREGA
	LEFT JOIN HLOCALIDADE			(NOLOCK) l  ON l.CODLOCAL = le.CODLOCAL  
	left join HSOLICITACAO					 s	on s.CODATENDIMENTO = ab.CODATENDIMENTO
	left join (select CODATENDIMENTO, STRING_AGG(VALOR, ' - ') Parametros from HPARAMATENDIMENTO group by CODATENDIMENTO) par on par.CODATENDIMENTO = ab.CODATENDIMENTO
	
	OUTER APPLY(

SELECT SCURSO.CODCURSO, SCURSO.NOME, HATENDIMENTOBASE.CODCOLIGADA, HATENDIMENTOBASE.CODATENDIMENTO
FROM HATENDIMENTOBASE (NOLOCK)
INNER JOIN HPARAMTIPOATEND (NOLOCK) ON HPARAMTIPOATEND.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HPARAMTIPOATEND.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
INNER JOIN HPARAMATENDIMENTO (NOLOCK) ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
	AND HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
	AND HPARAMTIPOATEND.CODPARAMETRO = HPARAMATENDIMENTO.CODPARAMETRO
INNER JOIN HPARAM (NOLOCK) ON HPARAM.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA
	AND HPARAM.CODPARAMETRO = HPARAMATENDIMENTO.CODPARAMETRO
	AND HPARAM.NOME LIKE '%CURSO%'
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA
	AND SCURSO.CODCURSO = HPARAMATENDIMENTO.VALOR
WHERE HATENDIMENTOBASE.CODCOLIGADA=AB.CODCOLIGADA
AND HATENDIMENTOBASE.CODATENDIMENTO= AB.CODATENDIMENTO
	) AS CURSOAB


OUTER APPLY (

SELECT CONVERT(VARCHAR,HSTATUSATEND.DATA,103) AS DTCONCLUSAO, HATENDIMENTOBASE.CODCOLIGADA, HATENDIMENTOBASE.CODATENDIMENTO
FROM HATENDIMENTOBASE (NOLOCK)
INNER JOIN HSTATUSATEND (NOLOCK) ON HSTATUSATEND.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
AND HSTATUSATEND.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
AND HSTATUSATEND.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
AND HSTATUSATEND.CODSTATUS = 'F'
WHERE HATENDIMENTOBASE.CODCOLIGADA=AB.CODCOLIGADA
AND HATENDIMENTOBASE.CODATENDIMENTO= AB.CODATENDIMENTO
) AS DTCONCLUSAO

WHERE 
	ab.CODSTATUS != 'M' 
	AND ab.CODCOLIGADARESP = 1
	and ab.CODATENDIMENTO>101
";4293;;;;22/08/2022;isaldo;1;1;1;1;;;;0;0231935b-26f9-4a0c-9ce8-290043149458;0;;29608;isaldo;22/08/2022;isaldo;22/08/2022;0
S;H.002.2;Resumo de Atendimentos - Cursando;"
SELECT 
	ab.CODATENDIMENTO, 
	ab.ABERTURA,
	YEAR(ab.ABERTURA) Ano,
	Month(ab.ABERTURA) Mes,
	a.RA,
	pp.NOME NOMECLIENTE,
	ta.NOME 'TIPO ATENDIMENTO',
	t.NOME ETAPA,
	case ab.CODSTATUS 
	when 'A' then 'Em andamento'
	when 'R' then 'Concluído a responder'
	when 'O' then 'Concluído respondido'
	when 'F' then 'Concluído confirmado'
	when 'U' then 'Concluído automático(pelo sistema)'
	when 'V' then 'Avaliado'
	when 'G' then 'Agendado a responder'
	when 'E' then 'Agendado respondido'
	when 'T' then 'Aguardando terceiros'
	when 'C' then 'Cancelado'
	when 'D' then 'Despertado'
	end Status,
	(select max(DATA) DataStatus from HSTATUSATEND at where at.CODATENDIMENTO=ab.CODATENDIMENTO and CODSTATUS = ab.CODSTATUS) DataStatus,	
	par.Parametros,
	l.DESLOCAL LocalEntrega,
	fl.IDLAN,
	fl.DATABAIXA 'DATA BAIXA',
	s.TEXTOSOLICITACAO,
	CURSOAB.CODCURSO,
	CURSOAB.NOME AS 'NomeCurso',
	ISNULL(DTCONCLUSAO.DTCONCLUSAO,'') AS 'DTCONCLUSAO',
	case when exists(
		Select 
			1
		from 
			SMATRICPL mpl 
			inner join SPLETIVO pl on pl.IDPERLET=mpl.IDPERLET 
			inner join SSTATUS st on st.CODSTATUS=mpl.CODSTATUS 
			inner join SHABILITACAOFILIAL hf on hf.IDHABILITACAOFILIAL=mpl.IDHABILITACAOFILIAL
		where 
			mpl.ra=a.RA and pl.CODPERLET = :CODPERLET and hf.CODCURSO = CURSOAB.CODCURSO and st.DESCRICAO='Cursando') then 'Sim' else 'Não' end Cursando,
		1 Contagem
FROM 
	HATENDIMENTOBASE				(NOLOCK) ab
	INNER JOIN HATENDIMENTOEXT		(NOLOCK) ae ON ab.CODCOLIGADA = ae.CODCOLIGADA AND ab.CODLOCAL = ae.CODLOCAL AND ab.CODATENDIMENTO = ae.CODATENDIMENTO
	LEFT JOIN SALUNO			    (NOLOCK) a	ON ae.COLIGADAALUNO = a.CODCOLIGADA AND ae.RAALUNO = a.RA
	LEFT JOIN PPESSOA				(NOLOCK) pp	ON pp.CODIGO = a.CODPESSOA OR pp.CODIGO = ae.CODPESSOA
	LEFT JOIN HTIPOATENDIMENTO		(NOLOCK) ta ON ta.CODCOLIGADA = ab.CODCOLIGADA AND ta.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO
	LEFT JOIN HTAREFA				(NOLOCK) t  ON t.CODCOLIGADA = ab.CODCOLIGADA AND t.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO AND t.CODTAREFA = ab.CODTAREFA              
	LEFT JOIN SPARCELASOLICITACAO	(NOLOCK) ps ON ps.CODCOLIGADAATEND = ab.CODCOLIGADA AND ps.CODATENDIMENTO = ab.CODATENDIMENTO AND ps.CODLOCAL = ab.CODLOCAL
	LEFT JOIN SPARCELA				(NOLOCK) p	ON p.CODCOLIGADA = ps.CODCOLIGADA AND p.IDPARCELA = ps.IDPARCELA              
	LEFT JOIN SLAN					(NOLOCK) sl ON sl.CODCOLIGADA = p.CODCOLIGADA AND sl.IDPARCELA = p.IDPARCELA              
	LEFT JOIN FLAN					(NOLOCK) fl ON fl.CODCOLIGADA = sl.CODCOLIGADA AND fl.IDLAN = sl.IDLAN              
	LEFT JOIN HLOCALENTREGA			(NOLOCK) le ON le.CODCOLIGADA = ab.CODCOLIGADA AND le.CODTIPOATENDIMENTO = ab.CODTIPOATENDIMENTO AND le.CODLOCALENTREGA = ab.CODLOCALENTREGA
	LEFT JOIN HLOCALIDADE			(NOLOCK) l  ON l.CODLOCAL = le.CODLOCAL  
	left join HSOLICITACAO					 s	on s.CODATENDIMENTO = ab.CODATENDIMENTO
	left join (select CODATENDIMENTO, STRING_AGG(VALOR, ' - ') Parametros from HPARAMATENDIMENTO group by CODATENDIMENTO) par on par.CODATENDIMENTO = ab.CODATENDIMENTO
	
	OUTER APPLY(

SELECT SCURSO.CODCURSO, SCURSO.NOME, HATENDIMENTOBASE.CODCOLIGADA, HATENDIMENTOBASE.CODATENDIMENTO
FROM HATENDIMENTOBASE (NOLOCK)
INNER JOIN HPARAMTIPOATEND (NOLOCK) ON HPARAMTIPOATEND.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HPARAMTIPOATEND.CODTIPOATENDIMENTO = HATENDIMENTOBASE.CODTIPOATENDIMENTO
INNER JOIN HPARAMATENDIMENTO (NOLOCK) ON HPARAMATENDIMENTO.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
	AND HPARAMATENDIMENTO.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
	AND HPARAMATENDIMENTO.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
	AND HPARAMTIPOATEND.CODPARAMETRO = HPARAMATENDIMENTO.CODPARAMETRO
INNER JOIN HPARAM (NOLOCK) ON HPARAM.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA
	AND HPARAM.CODPARAMETRO = HPARAMATENDIMENTO.CODPARAMETRO
	AND HPARAM.NOME LIKE '%CURSO%'
INNER JOIN SCURSO (NOLOCK) ON SCURSO.CODCOLIGADA = HPARAMATENDIMENTO.CODCOLIGADA
	AND SCURSO.CODCURSO = HPARAMATENDIMENTO.VALOR
WHERE HATENDIMENTOBASE.CODCOLIGADA=AB.CODCOLIGADA
AND HATENDIMENTOBASE.CODATENDIMENTO= AB.CODATENDIMENTO
	) AS CURSOAB


OUTER APPLY (

SELECT CONVERT(VARCHAR,HSTATUSATEND.DATA,103) AS DTCONCLUSAO, HATENDIMENTOBASE.CODCOLIGADA, HATENDIMENTOBASE.CODATENDIMENTO
FROM HATENDIMENTOBASE (NOLOCK)
INNER JOIN HSTATUSATEND (NOLOCK) ON HSTATUSATEND.CODCOLIGADA = HATENDIMENTOBASE.CODCOLIGADA
AND HSTATUSATEND.CODATENDIMENTO = HATENDIMENTOBASE.CODATENDIMENTO
AND HSTATUSATEND.CODLOCAL = HATENDIMENTOBASE.CODLOCAL
AND HSTATUSATEND.CODSTATUS = 'F'
WHERE HATENDIMENTOBASE.CODCOLIGADA=AB.CODCOLIGADA
AND HATENDIMENTOBASE.CODATENDIMENTO= AB.CODATENDIMENTO
) AS DTCONCLUSAO

WHERE 
	ab.CODSTATUS != 'M' 
	AND ab.CODCOLIGADARESP = 1
	and ab.CODATENDIMENTO>101
	and ta.NOME like :TIPO_ATENDIMENTO + '%'
";4772;;;;24/08/2022;isaldo;1;1;1;1;;;;0;0231935b-26f9-4a0c-9ce8-290043149458;0;;15007;isaldo;22/08/2022;isaldo;24/08/2022;0
S;H.002.T;Contagem de atendimentos por Etapa;"Select 
	LocalEntrega, 
	Sum(case when ETAPA = 'Coordenador do Curso' then 1 else 0 end) [Coordenador do Curso],
	Sum(case when ETAPA = 'Secretaria' then 1 else 0 end) [Secretaria],
	Sum(case when ETAPA = 'Coordenador do Curso' or ETAPA = 'Secretaria' then 1 else 0 end) Total
from 
	v_Unasp_Atendimento
Where  
	Ano= :Ano
	and Status like :Status + '%'
	and [TIPO ATENDIMENTO] like :TipoAtendimento + '%'
Group By
	LocalEntrega";429;;;;22/08/2022;isaldo;1;1;1;1;;;;0;03671e96-f2e4-48c2-afe6-6acdbf082d4b;0;;-3627;isaldo;22/08/2022;isaldo;22/08/2022;0
S;IdCanvas;Disciplinas por ID Canvas;"/* Lista disciplinas  com ID Canvas e códigos de professores por periodo Letivo*/
SELECT 
	DISTINCT
	A.IDCANVAS,
	A.IDTURMADISC,
	A.TIPOTURMADISC,
	B.IDPROFESSORTURMA,
	B.CODPROF,
	C.NOMCURSO,
	C.NOMDISCIPLINA,
	C.NOMGRADE,
	C.NOMTURNO,
	C.CODTURMA,
	C.NOMFILIAL,
	C.NOMTIPOCURSO,
	D.NUMAULASEM
	/*achar tabela para nome do professorNOME*/
	
FROM STURMADISCCOMPL A
INNER JOIN SPROFESSORTURMA B ON A.IDTURMADISC = B.IDTURMADISC    
INNER JOIN v_Unasp_SMATRICULA C ON B.IDTURMADISC = C.IDTURMADISC 
INNER JOIN STURMADISC D ON D.IDTURMADISC = C.IDTURMADISC  


WHERE
C.CODPERLET = :PERIODO_LET";615;;;;03/05/2022;maik.souza;1;1;1;1;;;;0;4b8dbc72-5d48-4902-9b40-000f3eb0a7d1;0;;-2088;maik.souza;20/04/2022;maik.souza;03/05/2022;0
S;INFO;Dados do Aluno, Responsável, Curso e Contrato;"SELECT 
	P.CPF				ALUNO_CPF,
	P.DTNASCIMENTO		ALUNO_DATA_NASC,
	P.EMAIL				ALUNO_EMAIL,
	P.RUA				ALUNO_ENDERECO,
	P.BAIRRO			ALUNO_ENDERECO_BAIRRO,
	P.CEP				ALUNO_ENDERECO_CEP,
	P.CIDADE			ALUNO_ENDERECO_CIDADE,	
	P.COMPLEMENTO		ALUNO_ENDERECO_COMPLEMENTO,
	P.ESTADO			ALUNO_ENDERECO_ESTADO,
	P.NUMERO			ALUNO_ENDERECO_NUMERO,
	P.PAIS				ALUNO_ENDERECO_PAIS,	
	P.NATURALIDADE		ALUNO_NATURALIDADE,
	P.ESTADONATAL		ALUNO_NATURALIDADE_ESTADO,
	P.NOME				ALUNO_NOME,
	CASE P.ESTADOCIVIL
		WHEN 'C' THEN 'CASADO'
		WHEN 'D' THEN 'DESQUITADO'
		WHEN 'E' THEN 'UNIÃO ESTÁVEL'
		WHEN 'I' THEN 'DIVORCIADO'
		WHEN 'O' THEN 'OUTROS'
		WHEN 'P' THEN 'SEPARADO'
		WHEN 'S' THEN 'SOLTEIRO'
		WHEN 'V' THEN 'VIÚVO'
						END ALUNO_ESTADO_CIVIL,
	P.CARTIDENTIDADE	ALUNO_RG,
	P.DTEMISSAOIDENT	ALUNO_RG_DATAEMISSAO,
	P.ORGEMISSORIDENT ALUNO_RG_ORG,
	P.UFCARTIDENT		ALUNO_RG_UF,	
	P.SEXO			ALUNO_SEXO_CHAR,
	CASE P.SEXO
		WHEN 'M' THEN 'MASCULINO'
		WHEN 'F' THEN 'FEMININO'
						END ALUNO_SEXO_DESC,
	P.TELEFONE1			ALUNO_TEL1,
	P.TELEFONE2			ALUNO_TEL2,
	P.TELEFONE3			ALUNO_TEL3,
	I.IMAGEM			ALUNO_IMAGEM,
	CN.DESCRICAO		ALUNO_NACIONALIDADE,
	SP.CODPESSOAMAE		ALUNO_NOME_MÃE,
	A.RA				ALUNO_RA,	
	CR.DESCRICAO		ALUNO_RACA,
	CO.DESCRICAO		ALUNO_RELIGIÃO,

	PL.CODPERLET		CONTRATO_ANO_LETIVO,
	CT.CODCONTRATO		CONTRATO_CODIGO,

	C.CODCURSO			CURSO_CODIGO,
	C.NOME				CURSO_NOME,	
	CASE TU.TIPO
		WHEN 'I' THEN 'INTEGRAL'
		WHEN 'M' THEN 'MANHÃ'
		WHEN 'N' THEN 'NOITE'
		WHEN 'V' THEN 'TARDE'
					END CURSO_TURNO,
	
	F.CGCCFO			RESP_CGC,
	F.DTNASCIMENTO		RESP_DATA_NASC,
	F.EMAIL				RESP_EMAIL,	
	F.RUA				RESP_ENDERECO,
	F.BAIRRO			RESP_ENDERECO_BAIRRO,
	F.CEP				RESP_ENDERECO_CEP,	
	F.CIDADE			RESP_ENDERECO_CIDADE,
	F.COMPLEMENTO		RESP_ENDERECO_COMPLEMENTO,
	F.CODETD			RESP_ENDERECO_ESTADO,
	F.NUMERO			RESP_ENDERECO_NUMERO,	
	F.NOME				RESP_NOME,
	F.CIDENTIDADE		RESP_RG,
	F.CI_ORGAO			RESP_RG_ORG_EMISSOR,
	F.CI_UF				RESP_RG_UF,	
	F.TELEFONE			RESP_TELEFONE

FROM SALUNO A
	INNER JOIN PPESSOA P ON P.CODIGO = A.CODPESSOA
	INNER JOIN FCFO F ON F.CODCFO = A.CODCFO AND F.CODCOLIGADA = A.CODCOLCFO
	LEFT JOIN PCORRACA CR ON CR.CODCLIENTE = P.CORRACA
	INNER JOIN SPESSOA SP ON SP.CODIGO = P.CODIGO	
	INNER JOIN SMATRICPL M ON M.RA = A.RA AND M.CODCOLIGADA = A.CODCOLIGADA
	INNER JOIN SHABILITACAOFILIAL HF ON HF.IDHABILITACAOFILIAL = M.IDHABILITACAOFILIAL AND HF.CODCOLIGADA = M.CODCOLIGADA
	INNER JOIN SCURSO C ON C.CODCURSO = HF.CODCURSO	AND C.CODCOLIGADA = HF.CODCOLIGADA
	INNER JOIN STURNO TU ON TU.CODTURNO = HF.CODTURNO AND TU.CODCOLIGADA = HF.CODCOLIGADA
	INNER JOIN SCONTRATO CT ON CT.RA = A.RA AND CT.CODCOLIGADA = A.CODCOLIGADA
	INNER JOIN SPLETIVO PL ON PL.CODCOLIGADA = CT.CODCOLIGADA AND PL.IDPERLET = CT.IDPERLET
	INNER JOIN PCODNACAO CN ON CN.CODCLIENTE = P.NACIONALIDADE	
	LEFT JOIN GIMAGEM I ON I.ID = P.IDIMAGEM	
	INNER JOIN SALUNOCOMPL ACPL ON ACPL.RA = A.RA AND ACPL.CODCOLIGADA = A.CODCOLIGADA
	INNER JOIN GCONSIST CO ON CO.CODINTERNO = ACPL.RELIGIAO AND CO.CODTABELA = 'RELIGIAO'
	
WHERE 
	A.CODCOLIGADA = :CODCOLIGADA2 
	AND A.RA = :RA2";3139;;;;10/03/2021;lucas.ssantos;1;1;1;1;;;;0;118914f5-a388-419d-ba07-6204f2a229a6;0;;4944;lucas.ssantos;01/03/2021;lucas.ssantos;10/03/2021;0
S;InfoCandidatoSPS;Informações dos Candidatos inscritos;select * from v_Unasp_SpsInfoCandidatos where IDPS = :IDPS order by Nome;72;;;;09/11/2021;mestre;1;1;1;1;;;;0;5d3cb9d1-3c76-4fff-adeb-67c2e24024a8;0;;12996;mestre;09/11/2021;isaldo;30/05/2022;0
S;InscritosPorAno;Total de Inscritos por Ano;"Select Campus, AreaInteresse, sum(Inscritos) Inscritos from (
SELECT 
	case 
	when ps.NOME like '%SP%' or ps.NOME like '%São Paulo%' or ai.Nome like '%- SP%'  then 'SP' 
	when ps.NOME like '%EC%' or ps.NOME like '%Engenheiro Coelho%' or ai.Nome like '%- EC%' or ps.NOME like '%Teologia%' then 'EC' 
	when ps.NOME like '%HT%' or ps.NOME like '%Hortolândia%' or ai.Nome like '% - HT%' then 'HT' 
	when ps.NOME like '%EAD%' or ai.Nome like '% - EAD%' then 'EAD' 
	else '' end Campus,
	ltrim(ai.Nome) AreaInteresse,
	Count(*) Inscritos
FROM 
	SPSOPCAOINSCRITO 						(NOLOCK) oi
	INNER JOIN SPSINSCRICAOAREAOFERTADA		(NOLOCK) iao	ON iao.IDPS=oi.IDPS and iao.NUMEROINSCRICAO=oi.NUMEROINSCRICAO
	left join SPSINSCAREAOFERTACOMPL		(NOLOCK) iaoc	on iaoc.CODCOLIGADA = iao.CODCOLIGADA and iaoc.IDPS = iao.IDPS and iaoc.NUMEROINSCRICAO = iao.NUMEROINSCRICAO
	left join SCAMPUS						(NOLOCK) c		on c.CODCAMPUS = iaoc.CODPOLO
	INNER JOIN SPSUSUARIO					(NOLOCK) u		ON u.CODUSUARIOPS=iao.CODUSUARIOPS
	left  JOIN PCODNACAO					(NOLOCK) n		on n.CODCLIENTE = u.NACIONALIDADE
	left join SPSFORMAINSCRICAOPS			(NOLOCK) fi		on fi.CODCOLIGADA = iao.CODCOLIGADA and fi.IDPS=iao.IDPS and fi.IDFORMAINSCRICAO = iao.IDFORMAINSCRICAO
	left join SPSAREAOFERTADA				(NOLOCK) ao		on ao.CODCOLIGADA = oi.CODCOLIGADA and ao.IDPS = oi.IDPS and ao.IDAREAINTERESSE = oi.IDAREAINTERESSE
	left join SPSAREAINTERESSE				(NOLOCK) ai		on ai.IDAREAINTERESSE = ao.IDAREAINTERESSE
	left join SPSSTATUSOPCAO				(NOLOCK) so		on so.CODFILIAL = 1 and so.CODIGO = oi.STATUS
	left join SPSPROCESSOSELETIVO			(NOLOCK) ps		on ps.CODCOLIGADA = ao.CODCOLIGADA and ps.IDPS = ao.IDPS
	left join v_Unasp_SMATRICPL				(NOLOCK) m		on m.CODCOLIGADA=iao.CODCOLIGADAMAT and m.IDPERLET=iao.IDPERLET and m.IDHABILITACAOFILIAL=iao.IDHABFILIALMAT and m.RA=iao.RAMAT
Where
	ps.NOME like '%' + :Ano + '%'
group by
	ps.NOME,
	ai.Nome) x
Group by Campus, AreaInteresse
order by 1, 2



";1952;;;;30/05/2022;isaldo;1;1;1;1;;;;1;a3478eed-e727-4a45-a65e-98e6757c3918;0;;12497;isaldo;30/05/2022;consultor1.totvs;30/05/2022;0
S;isaldo;teste isaldo;select * from v_unasp_aluno_kofax where ra = :RA;48;;;;15/02/2022;isaldo;1;1;1;1;;;;0;bdebe112-2b29-4228-a2cf-9120f029c12a;0;;16417;mestre;26/10/2021;isaldo;15/02/2022;0
S;Link PS;Link PS por curso;"SELECT 
	GF.NOME CAMPUS,
	TC.NOME [TIPO CURSO],
	HF.CODCURSO,
	C.NOME CURSO,
	AI.NOME [AREA DE INTERESSE], 
	PS.NOME [PROCESSO SELETIVO],
	AI.IDAREAINTERESSE,
	AO.IDPS,
	PS.IDCATEGORIAPS,
	('https://institutoadventista118931.rm.cloudtotvs.com.br/FrameHTML/Web/App/Edu/PortalProcessoSeletivo/?c='+CONVERT(VARCHAR (10),HF.CODCOLIGADA)+'&f='+CONVERT(VARCHAR (10),HF.CODFILIAL)+'&ct='+CONVERT(VARCHAR (100),PS.IDCATEGORIAPS)+'&ps='+CONVERT(VARCHAR (100),AO.IDPS)+'&ai='+CONVERT(VARCHAR (1000),AI.IDAREAINTERESSE)+'#/es/inscricoeswizard/dados-basicos') LINK
	
FROM
	SPSAREAINTERESSE (NOLOCK) AI
	INNER JOIN SHABILITACAOFILIAL (NOLOCK) HF ON HF.CODCOLIGADA=AI.CODCOLIGADAHABFILIAL AND HF.IDHABILITACAOFILIAL=AI.IDHABILITACAOFILIAL
	INNER JOIN SPSAREAOFERTADA (NOLOCK) AO ON AO.CODCOLIGADA=AI.CODCOLIGADAHABFILIAL AND AO.IDAREAINTERESSE=AI.IDAREAINTERESSE
	INNER JOIN SPSPROCESSOSELETIVO (NOLOCK) PS ON PS.CODCOLIGADA=AO.CODCOLIGADA AND PS.IDPS=AO.IDPS
	INNER JOIN GFILIAL (NOLOCK) GF ON GF.CODCOLIGADA=HF.CODCOLIGADA AND GF.CODFILIAL=HF.CODFILIAL
	INNER JOIN SCURSO (NOLOCK) C ON C.CODCOLIGADA=HF.CODCOLIGADA AND C.CODCURSO=HF.CODCURSO
	INNER JOIN STIPOCURSO (NOLOCK) TC ON TC.CODCOLIGADA=C.CODCOLIGADA AND TC.CODTIPOCURSO=C.CODTIPOCURSO
WHERE
	PS.STATUS = 'T'
	AND PS.EXIBENOPORTAL = 'T'
	AND GF.CODFILIAL = :FILIAL
	AND C.CODTIPOCURSO = :CODTIPOCURSO
	AND AO.IDPS = :IDPS

ORDER BY
	GF.CODFILIAL, TC.CODTIPOCURSO, PS.NOME,C.NOME";1452;;;;29/07/2021;maycon;1;1;1;1;;;;0;3d69aa49-add9-40fe-b357-eb0a146ded91;0;;2206;maycon;29/07/2021;maycon;29/07/2021;0
S;Link PS Geral;Link PS geral;"SELECT DISTINCT
	GF.NOME CAMPUS,
	TC.NOME [TIPO CURSO],
	PS.NOME [PROCESSO SELETIVO],
	AO.IDPS,
	PS.IDCATEGORIAPS,
	('https://institutoadventista118931.rm.cloudtotvs.com.br/FrameHTML/Web/App/Edu/PortalProcessoSeletivo/?c='+CONVERT(VARCHAR (10),HF.CODCOLIGADA)+'&f='+CONVERT(VARCHAR (10),HF.CODFILIAL)+'&ct='+CONVERT(VARCHAR (100),PS.IDCATEGORIAPS)+'&ps='+CONVERT(VARCHAR (100),AO.IDPS)+'#/es/inscricoeswizard/dados-basicos') LINK
	
FROM
	SPSAREAINTERESSE (NOLOCK) AI
	INNER JOIN SHABILITACAOFILIAL (NOLOCK) HF ON HF.CODCOLIGADA=AI.CODCOLIGADAHABFILIAL AND HF.IDHABILITACAOFILIAL=AI.IDHABILITACAOFILIAL
	INNER JOIN SPSAREAOFERTADA (NOLOCK) AO ON AO.CODCOLIGADA=AI.CODCOLIGADAHABFILIAL AND AO.IDAREAINTERESSE=AI.IDAREAINTERESSE
	INNER JOIN SPSPROCESSOSELETIVO (NOLOCK) PS ON PS.CODCOLIGADA=AO.CODCOLIGADA AND PS.IDPS=AO.IDPS
	INNER JOIN GFILIAL (NOLOCK) GF ON GF.CODCOLIGADA=HF.CODCOLIGADA AND GF.CODFILIAL=HF.CODFILIAL
	INNER JOIN SCURSO (NOLOCK) C ON C.CODCOLIGADA=HF.CODCOLIGADA AND C.CODCURSO=HF.CODCURSO
	INNER JOIN STIPOCURSO (NOLOCK) TC ON TC.CODCOLIGADA=C.CODCOLIGADA AND TC.CODTIPOCURSO=C.CODTIPOCURSO
WHERE
	PS.STATUS = 'T'
	AND PS.EXIBENOPORTAL = 'T'
";1179;;;;29/07/2021;maycon;1;1;1;1;;;;0;3d69aa49-add9-40fe-b357-eb0a146ded91;0;;-8722;maycon;29/07/2021;maycon;29/07/2021;0
S;LOCALPROVA;LOCALPROVA;select * from z_Unasp_AlocacaoCandidato;39;;;;06/07/2021;mestre;1;1;1;1;;;;0;3be30cd9-9495-4e8d-a43f-d3457a009d20;0;;-2846;mestre;06/07/2021;mestre;06/07/2021;0
S;LOGOUNASP;Logo do UNASP;SELECT IMAGEM FROM GIMAGEM WHERE ID = 2;39;;;;28/01/2021;matheus.amaral;1;1;1;1;;;;0;c18de33d-c2f7-4a52-a611-45b12f5abd99;0;;9890;matheus.amaral;28/01/2021;lucas.ssantos;25/02/2021;0
S;Mat.Disciplinas;Matrícula em Disciplinas ;"select 
* 
from 
	v_Unasp_Alunos_Disciplinas 
Where 
	CODFILIAL = :CODFILIAL and PeriodoLetivo = :PeriodoLetivo 
order by 
	NOME";135;;;;25/05/2022;maik.souza;1;1;1;1;;;;1;5624c39f-4283-44ad-b1d7-e9b1daa53161;0;;14036;isaldo;07/02/2022;maik.souza;25/05/2022;0
S;MatricDisciplina;Matricula em Disciplinas;"select 
* 
from 
	v_Unasp_Alunos_Disciplinas 
Where 
	CODFILIAL = :CODFILIAL and PeriodoLetivo = :PeriodoLetivo 
order by 
	NOME";135;;;;01/10/2021;mestre;1;1;1;1;;;;0;09283f4d-f65d-4a7a-ac53-83923383f034;0;;26746;mestre;01/10/2021;mestre;01/10/2021;0
S;MatricDivida;Matrícula X Inadimplência;"select 
	* 
from 
	fn_Unasp_MatriculasInadimplencia
		(
			:CODFILIAL , :CODPERLET_Divida , :CODPERLET_Matricula, :Status
		)";131;;;;27/09/2022;mestre;1;1;1;1;;;;0;c4dc5433-8bd9-4005-a94c-2dec0cc61999;0;;2093;mestre;27/09/2022;mestre;27/09/2022;0
S;MatricPLFin;Matriculas no Período Letivo com filtro por PL e Status - Dados da parcelas;"with fin as (
Select 
	COLIGADA CODCOLIGADA, IDPERLET, IDHABILITACAOFILIAL, RA, Competencia, sum(Bruto) Bruto, 
	Sum(Bolsa) Bolsa, sum(Liquido) Liquido, Sum([VALOR BAIXADO]) VALOR_BAIXADO, 
	sum([SALDO A RECEBER]) Saldo_Receber
from 
	v_Unasp_PBI_FN_Financeiro
where 
	CODPERLET like :CODPERLET
Group by 
	COLIGADA, IDPERLET, IDHABILITACAOFILIAL, RA, Competencia)

Select 
	gf.NOME				NomFilial,
	hf.CODCURSO, 
	c.NOME				NomCurso,
	tu.NOME				NomTurno,
	pl.CODPERLET, 
	t.CODTURMA, 
	t.NOME				NomTurma, 
	mpl.RA, 
	p.NOME NomPessoa, 
	st.DESCRICAO		NomStatus, 
	tm.DESCRICAO		NomTipoMatricula,
	p.EMAIL,
	camp.DESCRICAO		NomCampus,
	p.TELEFONE1,
	p.TELEFONE2,
	p.TELEFONE3,
	f1.Bruto P1_Bruto, f1.Bolsa P1_Bolsa, f1.Liquido P1_Liquido, f1.Valor_Baixado P1_Valor_Baixado, f1.Saldo_Receber P1_Saldo_Receber,
	f2.Bruto P2_Bruto, f2.Bolsa P2_Bolsa, f2.Liquido P2_Liquido, f2.Valor_Baixado P2_Valor_Baixado, f2.Saldo_Receber P2_Saldo_Receber
from 
	SMATRICPL mpl
	left  join STIPOMATRICULA		(nolock) tm		on tm.CODCOLIGADA = mpl.CODCOLIGADA and tm.CODTIPOMAT = mpl.CODTIPOMAT
	inner join SPLETIVO				(nolock) pl		on pl.CODCOLIGADA=mpl.CODCOLIGADA and pl.IDPERLET=mpl.IDPERLET
	inner join SHABILITACAOALUNO	(nolock) ha		on ha.CODCOLIGADA = mpl.CODCOLIGADA and ha.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and ha.RA = mpl.RA
	left join SCAMPUS				(nolock) camp	on camp.CODCAMPUS = ha.CODCAMPUS
	inner join SALUNO				(nolock) a		on a.CODCOLIGADA = ha.CODCOLIGADA and a.RA = ha.RA
	inner join PPESSOA				(nolock) p		on p.CODIGO=a.CODPESSOA
	inner join SSTATUS				(nolock) st		on st.CODCOLIGADA = mpl.CODCOLIGADA and st.CODSTATUS=mpl.CODSTATUS	
	inner join SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = ha.CODCOLIGADA and hf.IDHABILITACAOFILIAL = ha.IDHABILITACAOFILIAL
	inner join SFILIAL				(nolock) sf		on sf.CODCOLIGADA = hf.CODCOLIGADA and sf.CODFILIAL=hf.CODFILIAL
	inner join GFILIAL				(nolock) gf		on gf.CODCOLIGADA = sf.CODCOLIGADA and gf.CODFILIAL=sf.CODFILIAL
	inner join STURNO				(nolock) tu		on tu.CODCOLIGADA = hf.CODCOLIGADA and tu.CODTURNO=hf.CODTURNO
	inner join SGRADE				(nolock) g		on g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO AND G.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE=hf.CODGRADE
	inner join SHABILITACAO			(nolock) h		on h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO AND h.CODHABILITACAO = g.CODHABILITACAO
	inner join SCURSO				(nolock) c		on c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO
	inner join STIPOCURSO			(nolock) tc		on tc.CODCOLIGADA = hf.CODCOLIGADA and tc.CODTIPOCURSO = hf.CODTIPOCURSO
	left join STURMA				(nolock) t		on t.CODCOLIGADA = mpl.CODCOLIGADA and t.CODFILIAL = mpl.CODFILIAL and t.CODTURMA=mpl.CODTURMA and t.IDPERLET=mpl.IDPERLET
	left join fin f1 on f1.CODCOLIGADA = mpl.CODCOLIGADA and f1.IDPERLET = mpl.IDPERLET and f1.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and f1.RA = mpl.RA and f1.COMPETENCIA = :COMPETENCIA1
	left join fin f2 on f2.CODCOLIGADA = mpl.CODCOLIGADA and f2.IDPERLET = mpl.IDPERLET and f2.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and f2.RA = mpl.RA and f2.COMPETENCIA = :COMPETENCIA2
Where 
	pl.CODPERLET like :CODPERLET and st.DESCRICAO like :STATUS
Order by
	pl.CODPERLET, c.NOME, tu.NOME, t.NOME, p.NOME";3298;;;;08/08/2022;isaldo;1;1;1;1;;;;0;157b2972-602e-4b64-b381-fa06f5326483;0;;3365;isaldo;08/08/2022;isaldo;08/08/2022;0
S;MATRICULA;DADOS MATRICULA PL;"SELECT 
	M.CODCOLIGADA,
	M.RA,
	H.CODCURSO [CODIGO DO CURSO],
	C.NOME CURSO,
	H.CODFILIAL,
	F.NOMEFANTASIA FILIAL,
	C.CODTIPOCURSO,
	T.NOME NIVEL,
	P.CODPERLET,
	M.CODSTATUS,
	S.DESCRICAO STATUS,
	M.IDHABILITACAOFILIAL, 
	M.IDPERLET

FROM
	SMATRICPL M (NOLOCK)
	INNER JOIN SHABILITACAOFILIAL H (NOLOCK) ON H.IDHABILITACAOFILIAL=M.IDHABILITACAOFILIAL
	INNER JOIN SCURSO C (NOLOCK) 			 ON C.CODCURSO=H.CODCURSO
	INNER JOIN SSTATUS S (NOLOCK) 		 	 ON S.CODSTATUS=M.CODSTATUS
	INNER JOIN SPLETIVO P (NOLOCK) 			 ON P.IDPERLET=M.IDPERLET
	INNER JOIN GFILIAL F (NOLOCK) 			 ON H.CODCOLIGADA = F.CODCOLIGADA AND
											    H.CODFILIAL = F.CODFILIAL
    INNER JOIN STIPOCURSO T (NOLOCK)		ON	C.CODCOLIGADA = T.CODCOLIGADA AND
    											C.CODTIPOCURSO = T.CODTIPOCURSO
    
WHERE
	M.RA=:RA
	AND M.CODCOLIGADA =:CODCOLIGADA";849;;;;19/05/2021;mestre;1;1;1;1;;;;0;22b0a3d7-63b3-4c7a-934b-c88a50e93e9d;0;;-8090;mestre;17/05/2021;mestre;19/05/2021;0
S;MatriculaRelig;Matriculas por Religião;"with base as (
select CODPERLET, NomFilial, NomCurso, ModalidadeCurso, Religiao, NomTipoMatricula, count(*) Matriculas
from 
	v_Unasp_SMATRICPL where CODPERLET = :CODPERLET and CODTIPOCURSO = :CODTIPOCURSO and NomStatus in ('Concluído','Cursando')
group by 
	CODPERLET, NomFilial, NomCurso, ModalidadeCurso, Religiao, NomTipoMatricula)

Select 
	*, 
	(select Sum(Matriculas) from base bt where bt.CODPERLET = b.CODPERLET and bt.NomFilial=b.NomFilial and bt.NomCurso=b.NomCurso) TotalCurso
from base b";510;;;;08/09/2022;isaldo;1;1;1;1;;;;0;37203b45-5045-4c8b-8eb3-a93c2abe3e1d;0;;-12791;isaldo;08/09/2022;isaldo;08/09/2022;0
S;MATRICULAS;Quantidade por curso;"SELECT DISTINCT
	G.NOMEFANTASIA CAMPUS,
	C.NOME CURSO,
	S.DESCRICAO STATUS,
	P.CODPERLET PERIODO,
	C.CODTIPOCURSO,
	CASE WHEN C.CODTIPOCURSO = 2 THEN (SUM(CASE WHEN M.CODTIPOMAT = 4 THEN 1 else 0 end)) ELSE (SUM(CASE WHEN M.CODTIPOMAT = 1 THEN 1 else 0 end)) END INGRESSANTES,
	CASE WHEN C.CODTIPOCURSO = 2 THEN (SUM(CASE WHEN M.CODTIPOMAT = 5 THEN 1 else 0 end)) ELSE (SUM(CASE WHEN M.CODTIPOMAT = 2 THEN 1 else 0 end)) END VETERENOS
FROM 
	SMATRICPL						(NOLOCK) M
	INNER JOIN SHABILITACAOFILIAL	(NOLOCK) HF	ON HF.IDHABILITACAOFILIAL=M.IDHABILITACAOFILIAL AND HF.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN SHABILITACAO			(NOLOCK) H	ON H.CODHABILITACAO=HF.CODHABILITACAO AND H.CODCOLIGADA=HF.CODCOLIGADA AND H.CODCURSO=HF.CODCURSO
	INNER JOIN SCURSO				(NOLOCK) C	ON C.CODCURSO=H.CODCURSO AND C.CODCOLIGADA=H.CODCOLIGADA
	INNER JOIN SPLETIVO				(NOLOCK) P	ON P.IDPERLET=M.IDPERLET AND P.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN SALUNO				(NOLOCK) A	ON A.RA=M.RA AND A.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN PPESSOA				(NOLOCK) PP	ON PP.CODIGO=A.CODPESSOA
	INNER JOIN SSTATUS				(NOLOCK) S	ON S.CODSTATUS=M.CODSTATUS AND S.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN STIPOCURSO			(NOLOCK) SC	ON SC.CODTIPOCURSO=C.CODTIPOCURSO AND SC.CODCOLIGADA=C.CODCOLIGADA
	LEFT JOIN STIPOMATRICULA		(NOLOCK) TM	ON TM.CODTIPOMAT=M.CODTIPOMAT AND TM.CODCOLIGADA=M.CODCOLIGADA
	INNER JOIN GFILIAL				(NOLOCK) G	ON G.CODCOLIGADA=HF.CODCOLIGADA AND G.CODFILIAL=HF.CODFILIAL
WHERE
	S.DESCRICAO = 'Cursando'
	AND P.CODPERLET IN ('2021/2', '2021/3M')
	AND C.CODTIPOCURSO IN (1,2)
GROUP BY
	G.NOMEFANTASIA,
	C.NOME,
	M.CODSTATUS,
	S.DESCRICAO,
	P.CODPERLET,
	C.CODTIPOCURSO";1637;;;;16/08/2021;maycon;1;1;1;1;;;;0;4991260c-1710-4a32-ad00-01ca2e55c6e4;0;;30010;maycon;16/08/2021;maycon;16/08/2021;0
S;Matriz;Composição da Matriz- DIsciplinas/Optativas-Eletivas/Componestes Curriculares - SDISCGRADE;"select 
	* 
from 
	v_Unasp_SDISCGRADE 
where 
	CODCOLIGADA=1 
	and CODGRADE = :CODMATRIZ 
order by 
	CODPERIODO, NomGrupo, CODDISC
";140;;;;27/10/2021;mestre;1;1;1;1;;;;0;de0398d0-12bc-4607-814c-aea48a80e19c;0;;14993;mestre;27/10/2021;mestre;27/10/2021;0
S;MEC.ES.41;Censo da Educação Superior - Registro 41 - Alunos - V12.1.33.264;"SELECT SALUNOMEC.RA,
                            '41'                                                        R01_TIPO_REGISTRO,
                            COALESCE(CONVERT(VARCHAR,SALUNOMEC.CODINEPALUNO),'')        R02_ID_ALUNO_INEP,
                            PPESSOA.NOME                                                R03_NOME,
                            PPESSOA.CPF                                                 R04_CPF,
                            CASE
                              WHEN SALUNOMEC.SIGLAPAISORIGMEC = 'BRA' THEN ''
                     	      ELSE PPESSOA.NPASSAPORTE
                            END                                                         R05_PASSAPORTE,
                            REPLACE(CONVERT(VARCHAR(10), PPESSOA.DTNASCIMENTO, 103), '/', '') R06_DT_NASCIMENTO,
                            CASE
                              WHEN PPESSOA.CORRACA = 2 THEN '1'  
                              WHEN PPESSOA.CORRACA = 6 THEN '4'  
                              WHEN PPESSOA.CORRACA = 0 THEN '5'  
                              WHEN PPESSOA.CORRACA = 8 THEN '3'  
                              WHEN PPESSOA.CORRACA = 4 THEN '2'  
                              ELSE '0'
                            END                                                         R07_COR_RACA,
                            CASE
                              WHEN SALUNOMEC.SIGLAPAISORIGMEC <> 'BRA' THEN '3'
                              ELSE '1'
                            END                                                         R08_NACIONALIDADE,
                            CASE
                              WHEN SALUNOMEC.SIGLAPAISORIGMEC = 'BRA' THEN(
                              CASE
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='AC' THEN '12'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='AL' THEN '27'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='AP' THEN '16'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='AM' THEN '13'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='BA' THEN '29'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='CE' THEN '23'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='DF' THEN '53'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='ES' THEN '32' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='GO' THEN '52' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='MA' THEN '21' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='MT' THEN '51'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='MS' THEN '50' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='MG' THEN '31' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='PA' THEN '15' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='PB' THEN '25' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='PR' THEN '41'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='PE' THEN '26' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='PI' THEN '22' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='RJ' THEN '33' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='RN' THEN '24' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='RS' THEN '43' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='RO' THEN '11'
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='RR' THEN '14' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='SC' THEN '42' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='SP' THEN '35' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='SE' THEN '28' 
                                WHEN GMUNICIPIO.CODETDMUNICIPIO ='TO' THEN '17' 
                              END)  
                              ELSE ''
                            END                                                         R09_UF_NASCIMENTO,
                            CASE
                              WHEN SALUNOMEC.SIGLAPAISORIGMEC = 'BRA' THEN (
                              CONVERT(VARCHAR, CASE
                                                 WHEN GMUNICIPIO.CODETDMUNICIPIO ='AC' THEN '12' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='AL' THEN '27' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='AP' THEN '16' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='AM' THEN '13' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='BA' THEN '29' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='CE' THEN '23' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='DF' THEN '53' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='ES' THEN '32' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='GO' THEN '52' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='MA' THEN '21' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='MT' THEN '51' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='MS' THEN '50' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='MG' THEN '31' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PA' THEN '15' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PB' THEN '25' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PR' THEN '41' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PE' THEN '26' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PI' THEN '22' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RJ' THEN '33' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RN' THEN '24' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RS' THEN '43' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RO' THEN '11' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RR' THEN '14' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='SC' THEN '42' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='SP' THEN '35' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='SE' THEN '28' 
                     							WHEN GMUNICIPIO.CODETDMUNICIPIO ='TO' THEN '17' 
                     						  END) + CONVERT(VARCHAR,GMUNICIPIO.CODMUNICIPIO))
                            ELSE ''
                            END AS                                                    R10_MUNICIPIO_NASC,
                            CASE
                              WHEN SALUNOMEC.SIGLAPAISORIGMEC IS NOT NULL THEN SALUNOMEC.SIGLAPAISORIGMEC
                              ELSE 'BRA' 
                            END                                                       R11_PAIS_ORIGEM,
                            ISNULL(SALUNOMEC.NECESSIDADEESPEC, 2)                     R12_DEFICIENCIA,
                            SALUNOMEC.CEGUEIRA                                        R13_CEGUEIRA,
                            SALUNOMEC.BAIXAVISAO                                      R14_BAIXA_VISAO,
                            SALUNOMEC.SURDEZ                                          R15_SURDEZ,
                            SALUNOMEC.DEFAUDITIVA                                     R16_DEF_AUDITIVA,
                            SALUNOMEC.DEFFISICA                                       R17_DEF_FISICA,
                            SALUNOMEC.SURDOCEGUEIRA                                   R18_SURDOCEGUEIRA,
                            SALUNOMEC.DEFMENTAL                                       R19_DEF_INTELECTUAL,
                            SALUNOMEC.TGDTEA                                          R20_TGDTEA,
                            SALUNOMEC.SUPERDOTADO                                     R21_SUPERDOTACAO,
                            CASE
                              WHEN SINSTITUICAO.TIPOINST = '2' THEN 0
                              WHEN SINSTITUICAO.TIPOINST = '1' THEN 1
                              ELSE 2
                            END                                                       R22_ESCO_CONCL_ENSINOMEDIO
                     FROM	SALUNOMEC (NOLOCK)
                           JOIN SALUNO (NOLOCK) ON SALUNO.CODCOLIGADA = SALUNOMEC.CODCOLIGADA AND SALUNO.RA = SALUNOMEC.RA
                           JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
                           JOIN SPESSOA (NOLOCK) ON SPESSOA.CODIGO = PPESSOA.CODIGO
                           LEFT JOIN SINSTITUICAO (NOLOCK) ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
                           LEFT JOIN PPESSOA MAE (NOLOCK) ON MAE.CODIGO = SPESSOA.CODPESSOAMAE
                           LEFT JOIN PPESSOA PAI (NOLOCK) ON PAI.CODIGO = SPESSOA.CODPESSOAPAI
                           LEFT JOIN (SELECT MAX(CODMUNICIPIO) CODMUNICIPIO, NOMEMUNICIPIO, CODETDMUNICIPIO
                                      FROM GMUNICIPIO (NOLOCK)
                                      GROUP BY NOMEMUNICIPIO, CODETDMUNICIPIO) GMUNICIPIO ON GMUNICIPIO.NOMEMUNICIPIO = PPESSOA.NATURALIDADE AND GMUNICIPIO.CODETDMUNICIPIO = PPESSOA.ESTADONATAL
                      
                     WHERE 
                          EXISTS
                          (SELECT 1  FROM 
                                     SMATRICPL (NOLOCK), 
                                     SPLETIVO   (NOLOCK), SHABILITACAOFILIAL (NOLOCK),
                                     SCURSOMEC (NOLOCK), SALUNOCURSOMEC (NOLOCK)
                             WHERE SALUNOCURSOMEC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                               AND SALUNOCURSOMEC.RA = SMATRICPL.RA
                               AND SALUNOCURSOMEC.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL               
                               AND SALUNOMEC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                               AND SALUNOMEC.RA = SMATRICPL.RA          
                               AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
                               AND SMATRICPL.IDHABILITACAOFILIAL IS NOT NULL
                               AND SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                               AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
                               AND SHABILITACAOFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
                               AND SHABILITACAOFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
                               AND SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                               AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
                               AND SCURSOMEC.GERACENSO = 1
                               AND SCURSOMEC.CODCOLIGADA = :P_CODCOLIGADA
                               AND SCURSOMEC.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
                               AND SPLETIVO.CODCOLIGADA = SCURSOMEC.CODCOLIGADA
                     		  AND SPLETIVO.DTINICIO IS NOT NULL AND SPLETIVO.DTFIM IS NOT NULL
                               AND ((SPLETIVO.DTINICIO BETWEEN  :DATAREFINI_D AND  :DATAREFFIM_D) OR
                     		       (SPLETIVO.DTFIM BETWEEN  :DATAREFINI_D AND  :DATAREFFIM_D)))";11387;;;;09/06/2022;isaldo;1;1;1;1;1;1;;0;271026ba-60cd-4a9e-98e5-f25f7c08ff9a;0;;-3653;consultor1.totvs;07/06/2022;isaldo;09/06/2022;0
S;MEC.ES.41.Unasp;Censo da Educação Superior - Registro 41 - Alunos - V12.1.33.264;"SELECT 
		SALUNO.RA,
        '41'                                                        R01_TIPO_REGISTRO,
        COALESCE(CONVERT(VARCHAR,SALUNOMEC.CODINEPALUNO),'')        R02_ID_ALUNO_INEP,
        PPESSOA.NOME                                                R03_NOME,
        PPESSOA.CPF                                                 R04_CPF,
        CASE
          WHEN ISNULL(PPESSOA.NACIONALIDADE,'10') in ('10','20') THEN ''
 	      ELSE PPESSOA.NPASSAPORTE
        END                                                         R05_PASSAPORTE,
        REPLACE(CONVERT(VARCHAR(10), PPESSOA.DTNASCIMENTO, 103), '/', '') R06_DT_NASCIMENTO,
        CASE
          WHEN PPESSOA.CORRACA = 2 THEN '1'  
          WHEN PPESSOA.CORRACA = 6 THEN '4'  
          WHEN PPESSOA.CORRACA = 0 THEN '5'  
          WHEN PPESSOA.CORRACA = 8 THEN '3'  
          WHEN PPESSOA.CORRACA = 4 THEN '2'  
          ELSE '0'
        END                                                         R07_COR_RACA,
        CASE
          WHEN ISNULL(PPESSOA.NACIONALIDADE,'10') not in ('10','20') THEN '3'
          ELSE '1'
        END                                                         R08_NACIONALIDADE,
        CASE
          WHEN ISNULL(PPESSOA.NACIONALIDADE,'10') in ('10','20') THEN(
          CASE
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='AC' THEN '12'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='AL' THEN '27'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='AP' THEN '16'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='AM' THEN '13'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='BA' THEN '29'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='CE' THEN '23'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='DF' THEN '53'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='ES' THEN '32' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='GO' THEN '52' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='MA' THEN '21' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='MT' THEN '51'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='MS' THEN '50' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='MG' THEN '31' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='PA' THEN '15' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='PB' THEN '25' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='PR' THEN '41'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='PE' THEN '26' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='PI' THEN '22' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='RJ' THEN '33' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='RN' THEN '24' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='RS' THEN '43' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='RO' THEN '11'
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='RR' THEN '14' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='SC' THEN '42' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='SP' THEN '35' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='SE' THEN '28' 
            WHEN GMUNICIPIO.CODETDMUNICIPIO ='TO' THEN '17' 
          END)  
          ELSE ''
        END                                                         R09_UF_NASCIMENTO,
        CASE
          WHEN ISNULL(PPESSOA.NACIONALIDADE,'10') in ('10','20') THEN (
          CONVERT(VARCHAR, CASE
                             WHEN GMUNICIPIO.CODETDMUNICIPIO ='AC' THEN '12' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='AL' THEN '27' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='AP' THEN '16' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='AM' THEN '13' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='BA' THEN '29' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='CE' THEN '23' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='DF' THEN '53' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='ES' THEN '32' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='GO' THEN '52' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='MA' THEN '21' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='MT' THEN '51' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='MS' THEN '50' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='MG' THEN '31' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PA' THEN '15' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PB' THEN '25' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PR' THEN '41' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PE' THEN '26' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='PI' THEN '22' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RJ' THEN '33' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RN' THEN '24' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RS' THEN '43' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RO' THEN '11' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='RR' THEN '14' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='SC' THEN '42' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='SP' THEN '35' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='SE' THEN '28' 
 							WHEN GMUNICIPIO.CODETDMUNICIPIO ='TO' THEN '17' 
 						  END) + CONVERT(VARCHAR,GMUNICIPIO.CODMUNICIPIO))
        ELSE ''
        END AS                                                    R10_MUNICIPIO_NASC,
        ISNULL(GPAIS.CODPAIS,'BRA')                               R11_PAIS_ORIGEM,
        ISNULL(SALUNOMEC.NECESSIDADEESPEC, 2)                     R12_DEFICIENCIA,
        SALUNOMEC.CEGUEIRA                                        R13_CEGUEIRA,
        SALUNOMEC.BAIXAVISAO                                      R14_BAIXA_VISAO,
        SALUNOMEC.SURDEZ                                          R15_SURDEZ,
        SALUNOMEC.DEFAUDITIVA                                     R16_DEF_AUDITIVA,
        SALUNOMEC.DEFFISICA                                       R17_DEF_FISICA,
        SALUNOMEC.SURDOCEGUEIRA                                   R18_SURDOCEGUEIRA,
        SALUNOMEC.DEFMENTAL                                       R19_DEF_INTELECTUAL,
        SALUNOMEC.TGDTEA                                          R20_TGDTEA,
        SALUNOMEC.SUPERDOTADO                                     R21_SUPERDOTACAO,
        /*
        CASE
          WHEN SINSTITUICAO.TIPOINST = '2' THEN 0
          WHEN SINSTITUICAO.TIPOINST = '1' THEN 1
          ELSE 2
        END                                                       R22_ESCO_CONCL_ENSINOMEDIO*/
        Case 
        	when SPESSOA.CODINST2GRAU=2 then 1 		/*Publica*/
			when SPESSOA.CODINST2GRAU=3 then 0 		/*Privada*/
        	else 
        		CASE
		          WHEN SINSTITUICAO.TIPOINST = '1' THEN 1 /*Publica*/
		          WHEN SINSTITUICAO.TIPOINST = '2' THEN 0 /*Privada*/
		          ELSE 2
		        END
        	END R22_ESCO_CONCL_ENSINOMEDIO   
 FROM	
	SALUNO (NOLOCK) 
	left join SALUNOMEC (NOLOCK) ON SALUNO.CODCOLIGADA = SALUNOMEC.CODCOLIGADA AND SALUNO.RA = SALUNOMEC.RA       
	JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	JOIN SPESSOA (NOLOCK) ON SPESSOA.CODIGO = PPESSOA.CODIGO
	LEFT JOIN SINSTITUICAO (NOLOCK) ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
	LEFT JOIN PPESSOA MAE (NOLOCK) ON MAE.CODIGO = SPESSOA.CODPESSOAMAE
	LEFT JOIN PPESSOA PAI (NOLOCK) ON PAI.CODIGO = SPESSOA.CODPESSOAPAI
	LEFT JOIN (SELECT MAX(CODMUNICIPIO) CODMUNICIPIO, NOMEMUNICIPIO, CODETDMUNICIPIO
	          FROM GMUNICIPIO (NOLOCK)
	          GROUP BY NOMEMUNICIPIO, CODETDMUNICIPIO) GMUNICIPIO ON GMUNICIPIO.NOMEMUNICIPIO = PPESSOA.NATURALIDADE AND GMUNICIPIO.CODETDMUNICIPIO = PPESSOA.ESTADONATAL
	LEFT JOIN PCODNACAO N ON N.CODCLIENTE = PPESSOA.NACIONALIDADE
	LEFT JOIN GPAIS ON GPAIS.IDPAIS = N.IDPAIS
 WHERE 
	/*SALUNO.RA = '162021' and*/
 	PPESSOA.CPF is not null and	
 	PPESSOA.NOME NOT LIKE 'Unaspense%' and
 	PPESSOA.NOME NOT LIKE '%TESTE%' and
 	
 	  EXISTS ( /*tem avaliação em qualquer período no curso*/
		SELECT 1  
		FROM
			SMATRICPL						(NOLOCK)	mpl 
	        inner join SPLETIVO				(NOLOCK)	pl	on pl.CODCOLIGADA = mpl.CODCOLIGADA and pl.IDPERLET = mpl.IDPERLET 
			inner join SHABILITACAOFILIAL	(NOLOCK)	hf	on hf.CODCOLIGADA = mpl.CODCOLIGADA and hf.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL
			inner join SCURSO				(NOLOCK)	c	on c.CODCOLIGADA = hf.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
	        inner join SCURSOMEC			(NOLOCK)	cm	on cm.CODCOLIGADA = hf.CODCOLIGADA and cm.IDCURSOMEC = hf.IDCURSOMEC and cm.GERACENSO = 1
	        inner join SSTATUS				(NOLOCK)	st	on st.CODCOLIGADA=mpl.CODCOLIGADA and st.CODSTATUS = mpl.CODSTATUS
			inner join SMATRICULA			(NOLOCK)	m	on m.CODCOLIGADA = mpl.CODCOLIGADA and m.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and m.RA = mpl.RA
			inner join SSTATUS				(NOLOCK)	stm	on stm.CODCOLIGADA=m.CODCOLIGADA and stm.CODSTATUS = m.CODSTATUS
			inner join SNOTAETAPA			(NOLOCK)	ne	on ne.CODCOLIGADA = m.CODCOLIGADA and ne.IDTURMADISC = m.IDTURMADISC and ne.RA = m.RA
	    WHERE 
			mpl.CODCOLIGADA=:P_CODCOLIGADA
			and cm.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
			and c.CODCURSO not in ('EAD-LFOPL','EAD-LFOPE','EAD-LSELP','EAD-LSELI')
			AND SALUNO.CODCOLIGADA = mpl.CODCOLIGADA
			AND SALUNO.RA = mpl.RA  
			and mpl.DTMATRICULA is not null
			and stm.DESCRICAO<>'Cancelamento de Disciplinas'
	
	        AND pl.DTINICIO IS NOT NULL AND pl.DTFIM IS NOT NULL
	        AND ((pl.DTINICIO BETWEEN  :DATAREFINI_D AND  :DATAREFFIM_D) OR
	            (pl.DTFIM BETWEEN  :DATAREFINI_D AND  :DATAREFFIM_D)))

 	and PPESSOA.CPF in 
 	(
		SELECT distinct
			PPESSOA.CPF
		FROM
			SALUNOCURSOMEC (NOLOCK)
			JOIN SHABILITACAOFILIAL (NOLOCK)
			  ON SHABILITACAOFILIAL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
			     AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL
		    JOIN SCURSOMEC (NOLOCK)
		        ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		            AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
		            AND SCURSOMEC.GERACENSO = 1
		    JOIN SINSTITUICAOMEC (NOLOCK)
		        ON ( SINSTITUICAOMEC.CODCOLIGADA = SCURSOMEC.CODCOLIGADA
		            AND SINSTITUICAOMEC.IDINSTITUICAOMEC = SCURSOMEC.IDINSTITUICAOMEC )
		    LEFT JOIN SHABILITACAOMEC (NOLOCK)
		            ON SHABILITACAOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		                AND SHABILITACAOMEC.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		                AND SHABILITACAOMEC.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
		    JOIN SHABILITACAOALUNO (NOLOCK)
		        ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		            AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		            AND SHABILITACAOALUNO.RA = SALUNO.RA
		    JOIN SALUNO (NOLOCK)
		        ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
		            AND SALUNO.RA = SHABILITACAOALUNO.RA
		    LEFT JOIN SPESSOA (NOLOCK)
		            ON SALUNO.CODPESSOA = SPESSOA.CODIGO
		                            
		    LEFT JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SPESSOA.CODIGO
		                                   
		    LEFT JOIN SINSTITUICAO (NOLOCK)
		            ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
		    LEFT JOIN SCURSO (NOLOCK)
		            ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		                AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		    LEFT JOIN STURNO (NOLOCK)
		            ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
		                AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
		    LEFT JOIN SMATRICPL (NOLOCK)
		            ON ( SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		                AND SMATRICPL.RA = SALUNO.RA
		                AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL )
		    LEFT JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
				AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
		    LEFT JOIN SMATRICPLMEC (NOLOCK)
		            ON ( SMATRICPLMEC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
		                AND SMATRICPLMEC.RA = SMATRICPL.RA
		                AND SMATRICPLMEC.IDPERLET = SMATRICPL.IDPERLET
		                AND SMATRICPLMEC.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL )
		    LEFT JOIN SGRADE (NOLOCK)
		            ON ( SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		                AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		                AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
		                AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE )
		    LEFT JOIN SCAMPUS (NOLOCK)
		            ON SHABILITACAOALUNO.CODCAMPUS = SCAMPUS.CODCAMPUS
		WHERE  
			PPESSOA.CPF is not null and	
			PPESSOA.CPF NOT IN (Select CPF from z_Unasp_NaoEnviarCensoCPF) and
			PPESSOA.NOME NOT LIKE 'Unaspense%' and
			PPESSOA.NOME NOT LIKE '%TESTE%' and 
		                     		
		    SALUNO.CODCOLIGADA = :P_CODCOLIGADA
		    AND SCURSOMEC.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
		    AND SMATRICPL.DTMATRICULA = (SELECT MAX(DTMATRICULA)
		                                    FROM   SMATRICPL (NOLOCK),
		                                        SPLETIVO (NOLOCK),
		                                        SCURSOMEC SCURSOMEC2 (NOLOCK),
		                                        SHABILITACAOFILIAL (NOLOCK)
		                                    WHERE  SALUNO.CODCOLIGADA = :P_CODCOLIGADA
		                                        AND SCURSOMEC2.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
		                                        AND SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		                                        AND SCURSOMEC2.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		                                        AND SCURSOMEC2.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
		                                        AND SCURSOMEC2.GERACENSO = 1
		                                        AND SPLETIVO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		                                        AND SPLETIVO.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
		                                        AND SPLETIVO.DTINICIO IS NOT NULL
		                                        AND SPLETIVO.DTFIM IS NOT NULL
		                                        AND ( ( SPLETIVO.DTINICIO BETWEEN :DATAREFINI_D AND :DATAREFFIM_D )
		                                                OR ( SPLETIVO.DTFIM BETWEEN :DATAREFINI_D AND :DATAREFFIM_D ) )
		                                        AND SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
		                                        AND SMATRICPL.RA = SALUNO.RA
		                                        AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
		                                        AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
		                                        AND SCURSOMEC2.CODINEPCURSO = SCURSOMEC.CODINEPCURSO)
		    and EXISTS 
		    (
				SELECT 1  
				FROM
					SMATRICPL						(NOLOCK)	mpl 
					inner join SPLETIVO				(NOLOCK)	pl	on pl.CODCOLIGADA = mpl.CODCOLIGADA and pl.IDPERLET = mpl.IDPERLET 
					inner join SHABILITACAOFILIAL	(NOLOCK)	hf	on hf.CODCOLIGADA = mpl.CODCOLIGADA and hf.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL
					inner join SCURSO				(NOLOCK)	c	on c.CODCOLIGADA = hf.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
					inner join SCURSOMEC			(NOLOCK)	cm	on cm.CODCOLIGADA = hf.CODCOLIGADA and cm.IDCURSOMEC = hf.IDCURSOMEC and cm.GERACENSO = 1
					inner join SSTATUS				(NOLOCK)	st	on st.CODCOLIGADA=mpl.CODCOLIGADA and st.CODSTATUS = mpl.CODSTATUS
					inner join SMATRICULA			(NOLOCK)	m	on m.CODCOLIGADA = mpl.CODCOLIGADA and m.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and m.RA = mpl.RA
					inner join SSTATUS				(NOLOCK)	stm	on stm.CODCOLIGADA=m.CODCOLIGADA and stm.CODSTATUS = m.CODSTATUS
					inner join SNOTAETAPA			(NOLOCK)	ne	on ne.CODCOLIGADA = m.CODCOLIGADA and ne.IDTURMADISC = m.IDTURMADISC and ne.RA = m.RA
				WHERE 
					mpl.CODCOLIGADA=:P_CODCOLIGADA
					and hf.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
					and cm.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
					and c.CODCURSO not in ('EAD-LFOPL','EAD-LFOPE','EAD-LSELP','EAD-LSELI')
					AND SALUNO.CODCOLIGADA = mpl.CODCOLIGADA
					AND SALUNO.RA = mpl.RA  
					and mpl.DTMATRICULA is not null
					and stm.DESCRICAO<>'Cancelamento de Disciplinas'				
					and ne.NOTAFALTA is not null
									
					AND pl.DTINICIO IS NOT NULL AND pl.DTFIM IS NOT NULL
					AND ((pl.DTINICIO BETWEEN  :DATAREFINI_D AND  :DATAREFFIM_D) OR
						(pl.DTFIM BETWEEN  :DATAREFINI_D AND  :DATAREFFIM_D)))
									    
					and not exists (Select 1 
									from 
										z_Unasp_NaoEnviarCenso z 
									where 
										z.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
										AND z.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
										AND z.RA = SHABILITACAOALUNO.RA)
	)
Order by 
	PPESSOA.NOME";16663;;;;19/08/2022;isaldo;1;1;1;1;1;1;;0;271026ba-60cd-4a9e-98e5-f25f7c08ff9a;0;;18020;isaldo;08/06/2022;isaldo;19/08/2022;0
S;MEC.ES.42;Censo da Educação Superior - Registro 42 - Cursos dos Alunos - V12.1.33.264;"SELECT SALUNOCURSOMEC.RA,
                            '42'                                                                              R01_TIPO_REGISTRO,
                            SALUNOMEC.RALIMPO                                                                 R02_ID_ALUNO_IES,
                            SALUNOCURSOMEC.SEMESTREREF                                                        R03_SEMESTRE_REFERENCIA,
                            SCURSOMEC.CODINEPCURSO                                                            R04_COD_CURSO,
                            CASE
                              WHEN SCURSO.CURPRESDIST = 'P' THEN NULL
                              ELSE SCAMPUS.CAMPUSMEC
                            END                                                                               R05_COD_POLO_EAD,
                            CASE
                              WHEN SCURSO.CURPRESDIST = 'D' THEN NULL
                              WHEN UPPER(STURNO.TIPO) = 'M' THEN 1
                              WHEN UPPER(STURNO.TIPO) = 'V' THEN 2
                              WHEN UPPER(STURNO.TIPO) = 'I' THEN 4
                              ELSE 3
                            END                                                                               R06_TURNO,
                            SALUNOCURSOMEC.VINCULO                                                            R07_SIT_VINCULO,
                            CASE
                              WHEN SALUNOCURSOMEC.CURSOINEPORIGEM = 'NULL' THEN NULL
                              ELSE SALUNOCURSOMEC.CURSOINEPORIGEM
                            END                                                                               R08_CURSO_ORIGEM,
                            CASE
                              WHEN ( SALUNOCURSOMEC.VINCULO = '6' )
                                   AND NOT ( ( SINSTITUICAOMEC.DEPADMIN = 1 )
                                             AND ( SINSTITUICAOMEC.ORGANIZACAOACADEMICA = 3 ) ) THEN
                                CASE
                                  WHEN MONTH(SHABILITACAOALUNO.DTCONCLUSAOCURSO) < 7 THEN '1'
                                  ELSE '2'
                                END
                              ELSE NULL
                            END                                                                               R09_SEMESTRE_CONCLUSAO,
                            CASE
                              WHEN SCURSOMEC.LICENCIATURA = 1 THEN COALESCE(SALUNOCURSOMEC.PARFOR, 0)
                              ELSE NULL
                            END                                                                               R10_PARFOR,
                            CASE 
                              WHEN SCURSOMEC.LICENCIATURA = 0 THEN  NULL
                              ELSE SALUNOCURSOMEC.SEGUNLICENCIFORMACPEDAG 
                            END                                                                               R11_SEGUNLICE_FORMAPEDAG,
                            CASE
                              WHEN (SCURSOMEC.LICENCIATURA = 0) 
                                    OR (SALUNOCURSOMEC.SEGUNLICENCIFORMACPEDAG <> 1) 
                                        OR (SALUNOCURSOMEC.TIPOSEGUNLICENCIFORMACPEDAG = 0) THEN NULL
                              ELSE SALUNOCURSOMEC.TIPOSEGUNLICENCIFORMACPEDAG
                            END                                                                               R12_TIPSEGUNLICE_FORMAPEDAG,
                            CASE
                              WHEN SHABILITACAOALUNO.DTINGRESSO IS NOT NULL THEN
                                CASE
                                  WHEN MONTH(SHABILITACAOALUNO.DTINGRESSO) < 7 THEN RTRIM(LTRIM('01'
                                                                                                + CAST(YEAR(SHABILITACAOALUNO.DTINGRESSO) AS CHAR)))
                                  ELSE RTRIM(LTRIM('02'
                                                   + CAST(YEAR(SHABILITACAOALUNO.DTINGRESSO) AS CHAR)))
                                END
                              ELSE (SELECT CASE
                                             WHEN MONTH(MIN(SPLETIVO.DTINICIO)) < 7 THEN '01'
                                             ELSE '02'
                                           END
                                           + CONVERT(VARCHAR(4), YEAR(MIN(SPLETIVO.DTINICIO))) AS SEMESTREINGRESSO
                                    FROM SMATRICPL (NOLOCK)
                                         JOIN SPLETIVO (NOLOCK)
                                           ON ( SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                                                AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET )
                                    WHERE SMATRICPL.RA = SALUNOCURSOMEC.RA
                                          AND SMATRICPL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
                                          AND SMATRICPL.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL)
                            END                                                                               R13_SEMESTRE_INGRESSO,
                            SALUNOCURSOMEC.INGRVESTIBULAR                                                     R14_FORMA_INGR_VESTIBULAR,
                            SALUNOCURSOMEC.INGRENEM                                                           R15_FORMA_INGR_ENEM,
                            SALUNOCURSOMEC.INGRSERIADA                                                        R16_FORMA_INGR_SERIADA,
                            SALUNOCURSOMEC.INGRSIMPLIFICADA                                                   R17_FORMA_INGR_SIMPLIFICADA,
                            SALUNOCURSOMEC.INGREGRESSOBILI                                                    R18_FORMA_INGR_EGRESSOBILI,
                            SALUNOCURSOMEC.INGRPECG                                                           R19_FORMA_INGR_PECG,
                            SALUNOCURSOMEC.INGREXOFICIO                                                       R20_FORMA_INGR_EXOFFICIO,
                            SALUNOCURSOMEC.INGRJUDICIAL                                                       R21_FORMA_INGR_JUDICIAL,
                            SALUNOCURSOMEC.INGRREMANESCENTES                                                  R22_FORMA_INGR_REMANESCENTES,
                            SALUNOCURSOMEC.INGRESPECIAIS                                                      R23_FORMA_INGR_ESPECIAIS,
                            CASE
                              WHEN ( SINSTITUICAOMEC.DEPADMIN = 1 )
                                   AND ( SINSTITUICAOMEC.ORGANIZACAOACADEMICA = 3 )
                                   AND ( SALUNOCURSOMEC.VINCULO <> '2' ) THEN NULL
                              ELSE ISNULL(SMATRICPLMEC.MOBILIDADEACAD, 0)
                            END                                                                               R24_MOBILIDADE_ACADEMICA,
                            CASE
                              WHEN SMATRICPLMEC.MOBILIDADEACAD = 1
                              THEN SMATRICPLMEC.TIPOMOBILIDADEACAD
                              ELSE NULL
                            END                                                                               R25_TIPO_MOBILIDADE_ACADEMICA,
                            CASE
                              WHEN SMATRICPLMEC.MOBILIDADEACAD = 1 AND SMATRICPLMEC.TIPOMOBILIDADEACAD = 1
                              THEN SMATRICPLMEC.IESDESTINO
                              ELSE NULL
                            END                                                                               R26_IES_DESTINO,
                            CASE
                              WHEN SMATRICPLMEC.MOBILIDADEACAD = 1 AND SMATRICPLMEC.TIPOMOBILIDADEACAD = 2
                              THEN SMATRICPLMEC.PAISDESTINO
                              ELSE NULL
                            END                                                                               R27_PAIS_DESTINO,
                            CASE
                              WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA IS NULL THEN '0'
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.BENEFICIARIOCOTA)
                            END                                                                               R28_RESERVA_VAGAS,
                            CASE
                              WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTAETNICA)
                            END                                                                               R29_RESERVA_VAGAS_ETNICO,
                            CASE
                              WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTAPESSOADEFICIENTE)
                            END                                                                               R30_RESERVA_VAGAS_DEFICIENCIA,
                            CASE
                              WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTAENSINOPUBLICO)
                            END                                                                               R31_RESERVA_VAGAS_PUBLICA,
                            CASE
                              WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTASOCIAL)
                            END                                                                               R32_RESERVA_VAGAS_SOCIAL,
                            CASE
                              WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTAOUTROS)
                            END                                                                               R33_RESERVA_VAGAS_OUTROS,
                            CASE
                              WHEN ( ( SINSTITUICAOMEC.DEPADMIN = 1 )
                                      OR ( SINSTITUICAOMEC.DEPADMIN = 2
                                           AND SINSTITUICAOMEC.ORGANIZACAOACADEMICA = 3 ) ) THEN NULL
                              ELSE
                                CASE
                                  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO IS NULL THEN '0'
                                  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.TEMFINANCIAMENTO)
                                END
                            END                                                                               R34_FINANCIAMENTO_ESTUDANTIL,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBFIES)
                            END                                                                               R35_FINANC_REEMB_FIES,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBGOVESTADUAL)
                            END                                                                               R36_FINANC_REEMB_ESTADUAL,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBGOVMUNICIPAL)
                            END                                                                               R37_FINANC_REEMB_MUNICIPAL,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBIES)
                            END                                                                               R38_FINANC_REEMB_IES,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBEXTERNO)
                            END                                                                               R39_FINANC_REEMB_EXTERNAS,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRPROUNI)
                            END                                                                               R40_FINANC_N_RE_PROUNI_INTEG,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRPROUNIPARCIAL)
                            END                                                                               R41_FINANC_N_RE_PROUNI_PARC,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINREXTERNO)
                            END                                                                               R42_FINANC_N_RE_EXTERNAS,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRGOVESTADUAL)
                            END                                                                               R43_FINANC_N_RE_ESTADUAL,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRIES)
                            END                                                                               R44_FINANC_N_RE_IES,
                            CASE
                              WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRGOVMUNICIPAL)
                            END                                                                               R45_FINANC_N_RE_MUNICIPAL,
                            CASE
                              WHEN SALUNOCURSOMEC.APOIOSOCIAL IS NULL THEN '0'
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.APOIOSOCIAL)
                            END                                                                               R46_APOIO_SOCIAL,
                            CASE
                              WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ALIMENTACAO)
                            END                                                                               R47_APOIO_SOCIAL_ALIMENTACAO,
                            CASE
                              WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.MORADIA)
                            END                                                                               R48_APOIO_SOCIAL_MORADIA,
                            CASE
                              WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.TRANSPORTE)
                            END                                                                               R49_APOIO_SOCIAL_TRANSPORTE,
                            CASE
                              WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.MATERIALDIDATICO)
                            END                                                                               R50_APOIO_SOCIAL_MATERIAL,
                            CASE
                              WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.BOLSATRABALHAO)
                            END                                                                               R51_APOIO_SOCIAL_TRABALHO,
                            CASE
                              WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.BOLSAPERMANENCIA)
                            END                                                                               R52_APOIO_SOCIAL_PERMANENCIA,
                            CASE
                              WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR IS NULL THEN '0'
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVCOMPLEMENTAR)
                            END                                                                               R53_ATIVIDADE_EXTRACURRICULAR,
                            CASE
                              WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVPESQUISA)
                            END                                                                               R54_ATIV_EXTRA_PESQUISA,
                            CASE
                              WHEN ( SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0
                                      OR SALUNOCURSOMEC.ATVPESQUISA IS NULL
                                      OR SALUNOCURSOMEC.ATVPESQUISA = 0 ) THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVPESQUISAREM)
                            END                                                                               R55_BOLSA_ATIV_EXTRA_PESQUISA,
                            CASE
                              WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVEXTENSAO)
                            END                                                                               R56_ATIV_EXTRA_EXTENSAO,
                            CASE
                              WHEN ( SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0
                                      OR SALUNOCURSOMEC.ATVEXTENSAO IS NULL
                                      OR SALUNOCURSOMEC.ATVEXTENSAO = 0 ) THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVEXTENSAOREM)
                            END                                                                               R57_BOLSA_ATIV_EXTRA_EXTENSAO,
                            CASE
                              WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVMONITORIA)
                            END                                                                               R58_ATIV_EXTRA_MONITORIA,
                            CASE
                              WHEN ( SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0
                                      OR SALUNOCURSOMEC.ATVMONITORIA IS NULL
                                      OR SALUNOCURSOMEC.ATVMONITORIA = 0 ) THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVMONITORIAREM)
                            END                                                                               R59_BOLSA_ATIV_EXTRA_MONITORIA,
                            CASE
                              WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0 THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVESTAGIO)
                            END                                                                               R60_ATIV_EXTRA_ESTAGIO,
                            CASE
                              WHEN ( SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0
                                      OR SALUNOCURSOMEC.ATVESTAGIO IS NULL
                                      OR SALUNOCURSOMEC.ATVESTAGIO = 0 ) THEN NULL
                              ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVESTAGIOREM)
                            END                                                                               R61_BOLSA_ATIV_EXTRA_ESTAGIO,
                            CONVERT(VARCHAR, CONVERT(INTEGER, ROUND(SGRADE.CARGAHORARIA, 0)))                 R62_CARGA_HORARIA_CURSO,
                            CONVERT(VARCHAR, CONVERT(INTEGER, ROUND(SALUNOCURSOMEC.CARGAHORARIACUMPRIDA, 0))) R63_CARGA_HORARIA_ALUNO,
                            CASE
                              WHEN (SALUNOMEC.JUSTIFICATIVA IS NULL) THEN ''
                              WHEN (SALUNOMEC.JUSTIFICATIVA = 0) THEN ''
                              WHEN (SALUNOMEC.JUSTIFICATIVA < 10) THEN CONCAT('0', CONVERT(VARCHAR, SALUNOMEC.JUSTIFICATIVA))
                              ELSE CONVERT(VARCHAR, SALUNOMEC.JUSTIFICATIVA)
                            END R64_JUSTIFICATIVA
                     FROM   SALUNOCURSOMEC (NOLOCK)
                            JOIN SHABILITACAOFILIAL (NOLOCK)
                              ON SHABILITACAOFILIAL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
                                 AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL
                            JOIN SCURSOMEC (NOLOCK)
                              ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                 AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
                                 AND SCURSOMEC.GERACENSO = 1
                            JOIN SINSTITUICAOMEC (NOLOCK)
                              ON ( SINSTITUICAOMEC.CODCOLIGADA = SCURSOMEC.CODCOLIGADA
                                   AND SINSTITUICAOMEC.IDINSTITUICAOMEC = SCURSOMEC.IDINSTITUICAOMEC )
                            LEFT JOIN SHABILITACAOMEC (NOLOCK)
                                   ON SHABILITACAOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                      AND SHABILITACAOMEC.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                                      AND SHABILITACAOMEC.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
                            JOIN SHABILITACAOALUNO (NOLOCK)
                              ON SHABILITACAOALUNO.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
                                 AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL
                                 AND SHABILITACAOALUNO.RA = SALUNOCURSOMEC.RA
                            JOIN SALUNO (NOLOCK)
                              ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
                                 AND SALUNO.RA = SHABILITACAOALUNO.RA
                            JOIN SALUNOMEC (NOLOCK)
                              ON SALUNOMEC.CODCOLIGADA = SALUNO.CODCOLIGADA
                                 AND SALUNOMEC.RA = SALUNO.RA
                            LEFT JOIN SPESSOA (NOLOCK)
                                   ON SALUNO.CODPESSOA = SPESSOA.CODIGO
                            LEFT JOIN SINSTITUICAO (NOLOCK)
                                   ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
                            LEFT JOIN SCURSO (NOLOCK)
                                   ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                      AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                            LEFT JOIN STURNO (NOLOCK)
                                   ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
                                      AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
                            LEFT JOIN SMATRICPL (NOLOCK)
                                   ON ( SMATRICPL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
                                        AND SMATRICPL.RA = SALUNOCURSOMEC.RA
                                        AND SMATRICPL.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL )
                            LEFT JOIN SMATRICPLMEC (NOLOCK)
                                   ON ( SMATRICPLMEC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
                                        AND SMATRICPLMEC.RA = SMATRICPL.RA
                                        AND SMATRICPLMEC.IDPERLET = SMATRICPL.IDPERLET
                                        AND SMATRICPLMEC.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL )
                            LEFT JOIN SGRADE (NOLOCK)
                                   ON ( SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                        AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
                                        AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
                                        AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE )
                            LEFT JOIN SCAMPUS (NOLOCK)
                                   ON SHABILITACAOALUNO.CODCAMPUS = SCAMPUS.CODCAMPUS
                     WHERE  SALUNOCURSOMEC.CODCOLIGADA = :P_CODCOLIGADA
                            AND SCURSOMEC.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
                            AND SMATRICPL.DTMATRICULA = (SELECT MAX(DTMATRICULA)
                                                         FROM   SMATRICPL (NOLOCK),
                                                                SPLETIVO (NOLOCK),
                                                                SCURSOMEC SCURSOMEC2 (NOLOCK),
                                                                SHABILITACAOFILIAL (NOLOCK)
                                                         WHERE  SALUNOCURSOMEC.CODCOLIGADA = :P_CODCOLIGADA
                                                                AND SCURSOMEC2.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
                                                                AND SHABILITACAOFILIAL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
                                                                AND SCURSOMEC2.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                                                AND SCURSOMEC2.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
                                                                AND SCURSOMEC2.GERACENSO = 1
                                                                AND SPLETIVO.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
                                                                AND SPLETIVO.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
                                                                AND SPLETIVO.DTINICIO IS NOT NULL
                                                                AND SPLETIVO.DTFIM IS NOT NULL
                                                                AND ( ( SPLETIVO.DTINICIO BETWEEN :DATAREFINI_D AND :DATAREFFIM_D )
                                                                       OR ( SPLETIVO.DTFIM BETWEEN :DATAREFINI_D AND :DATAREFFIM_D ) )
                                                                AND SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
                                                                AND SMATRICPL.RA = SALUNOCURSOMEC.RA
                                                                AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
                                                                AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
                                                                AND SCURSOMEC2.CODINEPCURSO = SCURSOMEC.CODINEPCURSO)";27969;;;;08/06/2022;consultor1.totvs;1;1;1;1;1;1;;0;34fc7fa8-29f3-4c22-8b37-e84bf181848e;0;;17814;consultor1.totvs;07/06/2022;consultor1.totvs;08/06/2022;0
S;MEC.ES.42.Unasp;Censo da Educação Superior - Registro 42 - Cursos dos Alunos - V12.1.33.264;"Select 
	
	RA,R01_TIPO_REGISTRO,R02_ID_ALUNO_IES	,R03_SEMESTRE_REFERENCIA	,R04_COD_CURSO	,R05_COD_POLO_EAD	,R06_TURNO	,R07_SIT_VINCULO	,R08_CURSO_ORIGEM	,R09_SEMESTRE_CONCLUSAO	,R10_PARFOR	,R11_SEGUNLICE_FORMAPEDAG	,R12_TIPSEGUNLICE_FORMAPEDAG,R13_SEMESTRE_INGRESSO,R14_FORMA_INGR_VESTIBULAR,R15_FORMA_INGR_ENEM,R16_FORMA_INGR_SERIADA,R17_FORMA_INGR_SIMPLIFICADA,R18_FORMA_INGR_EGRESSOBILI,R19_FORMA_INGR_PECG,R20_FORMA_INGR_EXOFFICIO,R21_FORMA_INGR_JUDICIAL,R22_FORMA_INGR_REMANESCENTES,R23_FORMA_INGR_ESPECIAIS,R24_MOBILIDADE_ACADEMICA,R25_TIPO_MOBILIDADE_ACADEMICA,R26_IES_DESTINO,R27_PAIS_DESTINO,R28_RESERVA_VAGAS,R29_RESERVA_VAGAS_ETNICO,R30_RESERVA_VAGAS_DEFICIENCIA,R31_RESERVA_VAGAS_PUBLICA,R32_RESERVA_VAGAS_SOCIAL,R33_RESERVA_VAGAS_OUTROS,R34_FINANCIAMENTO_ESTUDANTIL,R35_FINANC_REEMB_FIES,R36_FINANC_REEMB_ESTADUAL,R37_FINANC_REEMB_MUNICIPAL,R38_FINANC_REEMB_IES,R39_FINANC_REEMB_EXTERNAS,R40_FINANC_N_RE_PROUNI_INTEG,R41_FINANC_N_RE_PROUNI_PARC,R42_FINANC_N_RE_EXTERNAS,R43_FINANC_N_RE_ESTADUAL,R44_FINANC_N_RE_IES,R45_FINANC_N_RE_MUNICIPAL,R46_APOIO_SOCIAL,R47_APOIO_SOCIAL_ALIMENTACAO,R48_APOIO_SOCIAL_MORADIA,R49_APOIO_SOCIAL_TRANSPORTE,R50_APOIO_SOCIAL_MATERIAL,R51_APOIO_SOCIAL_TRABALHO,R52_APOIO_SOCIAL_PERMANENCIA,R53_ATIVIDADE_EXTRACURRICULAR,R54_ATIV_EXTRA_PESQUISA,R55_BOLSA_ATIV_EXTRA_PESQUISA,R56_ATIV_EXTRA_EXTENSAO,R57_BOLSA_ATIV_EXTRA_EXTENSAO,R58_ATIV_EXTRA_MONITORIA,R59_BOLSA_ATIV_EXTRA_MONITORIA,R60_ATIV_EXTRA_ESTAGIO,R61_BOLSA_ATIV_EXTRA_ESTAGIO,R62_CARGA_HORARIA_CURSO,case when R07_SIT_VINCULO=6 and R63_CARGA_HORARIA_ALUNO<R62_CARGA_HORARIA_CURSO then R62_CARGA_HORARIA_CURSO else R63_CARGA_HORARIA_ALUNO end R63_CARGA_HORARIA_ALUNO,R64_JUSTIFICATIVA

from(	
SELECT 
	SALUNOCURSOMEC.RA,
	'42'                                                                              R01_TIPO_REGISTRO,
	SALUNOMEC.RALIMPO                                                                 R02_ID_ALUNO_IES,
	SALUNOCURSOMEC.SEMESTREREF                                                        R03_SEMESTRE_REFERENCIA,
	SCURSOMEC.CODINEPCURSO                                                            R04_COD_CURSO,
	CASE
	  WHEN SCURSO.CURPRESDIST = 'P' THEN NULL
	  ELSE SCAMPUS.CAMPUSMEC
	END                                                                               R05_COD_POLO_EAD,
	CASE
	  WHEN SCURSO.CURPRESDIST = 'D' THEN NULL
	  WHEN UPPER(STURNO.TIPO) = 'M' THEN 1
	  WHEN UPPER(STURNO.TIPO) = 'V' THEN 2
	  WHEN UPPER(STURNO.TIPO) = 'I' THEN 4
	  ELSE 3
	END                                                                               R06_TURNO,


	case when SALUNOCURSOMEC.VINCULO=5 then 2 else SALUNOCURSOMEC.VINCULO end         R07_SIT_VINCULO,
	CASE
	  WHEN SALUNOCURSOMEC.CURSOINEPORIGEM = 'NULL' THEN NULL
	  ELSE SALUNOCURSOMEC.CURSOINEPORIGEM
	END                                                                               R08_CURSO_ORIGEM,
	CASE
	  WHEN ( SALUNOCURSOMEC.VINCULO = '6' )
	       AND NOT ( ( SINSTITUICAOMEC.DEPADMIN = 1 )
	                 AND ( SINSTITUICAOMEC.ORGANIZACAOACADEMICA = 3 ) ) THEN
	    CASE
	      WHEN MONTH(SHABILITACAOALUNO.DTCONCLUSAOCURSO) < 7 THEN '1'
	      ELSE '2'
	    END
	  ELSE NULL
	END                                                                               R09_SEMESTRE_CONCLUSAO,
	CASE
	  WHEN SCURSOMEC.LICENCIATURA = 1 THEN COALESCE(SALUNOCURSOMEC.PARFOR, 0)
	  ELSE NULL
	END                                                                               R10_PARFOR,
	CASE 
	  WHEN SCURSOMEC.LICENCIATURA = 0 THEN  NULL
	  ELSE SALUNOCURSOMEC.SEGUNLICENCIFORMACPEDAG 
	END                                                                               R11_SEGUNLICE_FORMAPEDAG,
	CASE
	  WHEN (SCURSOMEC.LICENCIATURA = 0) 
	        OR (SALUNOCURSOMEC.SEGUNLICENCIFORMACPEDAG <> 1) 
	            OR (SALUNOCURSOMEC.TIPOSEGUNLICENCIFORMACPEDAG = 0) THEN NULL
	  ELSE SALUNOCURSOMEC.TIPOSEGUNLICENCIFORMACPEDAG
	END                                                                               R12_TIPSEGUNLICE_FORMAPEDAG,
	CASE
	  WHEN SHABILITACAOALUNO.DTINGRESSO IS NOT NULL THEN
	    CASE
	      WHEN MONTH(SHABILITACAOALUNO.DTINGRESSO) < 7 THEN RTRIM(LTRIM('01'
	                                                                    + CAST(YEAR(SHABILITACAOALUNO.DTINGRESSO) AS CHAR)))
	      ELSE RTRIM(LTRIM('02'
	                       + CAST(YEAR(SHABILITACAOALUNO.DTINGRESSO) AS CHAR)))
	    END
	  ELSE (SELECT CASE
	                 WHEN MONTH(MIN(SPLETIVO.DTINICIO)) < 7 THEN '01'
	                 ELSE '02'
	               END
	               + CONVERT(VARCHAR(4), YEAR(MIN(SPLETIVO.DTINICIO))) AS SEMESTREINGRESSO
	        FROM SMATRICPL (NOLOCK)
	             JOIN SPLETIVO (NOLOCK)
	               ON ( SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	                    AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET )
	        WHERE SMATRICPL.RA = SALUNOCURSOMEC.RA
	              AND SMATRICPL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
	              AND SMATRICPL.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL
				  and SPLETIVO.CODPERLET<>'SIGA')
	END                                                                               R13_SEMESTRE_INGRESSO,

	SALUNOCURSOMEC.INGRVESTIBULAR                                                     R14_FORMA_INGR_VESTIBULAR,
	SALUNOCURSOMEC.INGRENEM                                                           R15_FORMA_INGR_ENEM,
	SALUNOCURSOMEC.INGRSERIADA                                                        R16_FORMA_INGR_SERIADA,
	SALUNOCURSOMEC.INGRSIMPLIFICADA                                                   R17_FORMA_INGR_SIMPLIFICADA,
	SALUNOCURSOMEC.INGREGRESSOBILI                                                    R18_FORMA_INGR_EGRESSOBILI,
	SALUNOCURSOMEC.INGRPECG                                                           R19_FORMA_INGR_PECG,
	SALUNOCURSOMEC.INGREXOFICIO                                                       R20_FORMA_INGR_EXOFFICIO,
	SALUNOCURSOMEC.INGRJUDICIAL                                                       R21_FORMA_INGR_JUDICIAL,
	SALUNOCURSOMEC.INGRREMANESCENTES                                                  R22_FORMA_INGR_REMANESCENTES,
	SALUNOCURSOMEC.INGRESPECIAIS                                                      R23_FORMA_INGR_ESPECIAIS,
	CASE
	  WHEN ( SINSTITUICAOMEC.DEPADMIN = 1 )
	       AND ( SINSTITUICAOMEC.ORGANIZACAOACADEMICA = 3 )
	       AND ( SALUNOCURSOMEC.VINCULO <> '2' ) THEN NULL
	  ELSE ISNULL(SMATRICPLMEC.MOBILIDADEACAD, 0)
	END                                                                               R24_MOBILIDADE_ACADEMICA,
	CASE
	  WHEN SMATRICPLMEC.MOBILIDADEACAD = 1
	  THEN SMATRICPLMEC.TIPOMOBILIDADEACAD
	  ELSE NULL
	END                                                                               R25_TIPO_MOBILIDADE_ACADEMICA,
	CASE
	  WHEN SMATRICPLMEC.MOBILIDADEACAD = 1 AND SMATRICPLMEC.TIPOMOBILIDADEACAD = 1
	  THEN SMATRICPLMEC.IESDESTINO
	  ELSE NULL
	END                                                                               R26_IES_DESTINO,
	CASE
	  WHEN SMATRICPLMEC.MOBILIDADEACAD = 1 AND SMATRICPLMEC.TIPOMOBILIDADEACAD = 2
	  THEN SMATRICPLMEC.PAISDESTINO
	  ELSE NULL
	END                                                                               R27_PAIS_DESTINO,
	CASE
	  WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA IS NULL THEN '0'
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.BENEFICIARIOCOTA)
	END                                                                               R28_RESERVA_VAGAS,
	CASE
	  WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTAETNICA)
	END                                                                               R29_RESERVA_VAGAS_ETNICO,
	CASE
	  WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTAPESSOADEFICIENTE)
	END                                                                               R30_RESERVA_VAGAS_DEFICIENCIA,
	CASE
	  WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTAENSINOPUBLICO)
	END                                                                               R31_RESERVA_VAGAS_PUBLICA,
	CASE
	  WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTASOCIAL)
	END                                                                               R32_RESERVA_VAGAS_SOCIAL,
	CASE
	  WHEN SALUNOCURSOMEC.BENEFICIARIOCOTA = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.COTAOUTROS)
	END                                                                               R33_RESERVA_VAGAS_OUTROS,
	CASE
	  WHEN ( ( SINSTITUICAOMEC.DEPADMIN = 1 )
	          OR ( SINSTITUICAOMEC.DEPADMIN = 2
	               AND SINSTITUICAOMEC.ORGANIZACAOACADEMICA = 3 ) ) THEN NULL
	  ELSE
	    CASE
	      WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO IS NULL THEN '0'
	      ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.TEMFINANCIAMENTO)
	    END
	END                                                                               R34_FINANCIAMENTO_ESTUDANTIL,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBFIES)
	END                                                                               R35_FINANC_REEMB_FIES,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBGOVESTADUAL)
	END                                                                               R36_FINANC_REEMB_ESTADUAL,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBGOVMUNICIPAL)
	END                                                                               R37_FINANC_REEMB_MUNICIPAL,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBIES)
	END                                                                               R38_FINANC_REEMB_IES,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FIRBEXTERNO)
	END                                                                               R39_FINANC_REEMB_EXTERNAS,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRPROUNI)
	END                                                                               R40_FINANC_N_RE_PROUNI_INTEG,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRPROUNIPARCIAL)
	END                                                                               R41_FINANC_N_RE_PROUNI_PARC,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINREXTERNO)
	END                                                                               R42_FINANC_N_RE_EXTERNAS,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRGOVESTADUAL)
	END                                                                               R43_FINANC_N_RE_ESTADUAL,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRIES)
	END                                                                               R44_FINANC_N_RE_IES,
	CASE
	  WHEN SALUNOCURSOMEC.TEMFINANCIAMENTO = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.FINRGOVMUNICIPAL)
	END                                                                               R45_FINANC_N_RE_MUNICIPAL,
	CASE
	  WHEN SALUNOCURSOMEC.APOIOSOCIAL IS NULL THEN '0'
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.APOIOSOCIAL)
	END                                                                               R46_APOIO_SOCIAL,
	CASE
	  WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ALIMENTACAO)
	END                                                                               R47_APOIO_SOCIAL_ALIMENTACAO,
	CASE
	  WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.MORADIA)
	END                                                                               R48_APOIO_SOCIAL_MORADIA,
	CASE
	  WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.TRANSPORTE)
	END                                                                               R49_APOIO_SOCIAL_TRANSPORTE,
	CASE
	  WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.MATERIALDIDATICO)
	END                                                                               R50_APOIO_SOCIAL_MATERIAL,
	CASE
	  WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.BOLSATRABALHAO)
	END                                                                               R51_APOIO_SOCIAL_TRABALHO,
	CASE
	  WHEN SALUNOCURSOMEC.APOIOSOCIAL = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.BOLSAPERMANENCIA)
	END                                                                               R52_APOIO_SOCIAL_PERMANENCIA,
	CASE
	  WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR IS NULL THEN '0'
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVCOMPLEMENTAR)
	END                                                                               R53_ATIVIDADE_EXTRACURRICULAR,
	CASE
	  WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVPESQUISA)
	END                                                                               R54_ATIV_EXTRA_PESQUISA,
	CASE
	  WHEN ( SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0
	          OR SALUNOCURSOMEC.ATVPESQUISA IS NULL
	          OR SALUNOCURSOMEC.ATVPESQUISA = 0 ) THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVPESQUISAREM)
	END                                                                               R55_BOLSA_ATIV_EXTRA_PESQUISA,
	CASE
	  WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVEXTENSAO)
	END                                                                               R56_ATIV_EXTRA_EXTENSAO,
	CASE
	  WHEN ( SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0
	          OR SALUNOCURSOMEC.ATVEXTENSAO IS NULL
	          OR SALUNOCURSOMEC.ATVEXTENSAO = 0 ) THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVEXTENSAOREM)
	END                                                                               R57_BOLSA_ATIV_EXTRA_EXTENSAO,
	CASE
	  WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVMONITORIA)
	END                                                                               R58_ATIV_EXTRA_MONITORIA,
	CASE
	  WHEN ( SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0
	          OR SALUNOCURSOMEC.ATVMONITORIA IS NULL
	          OR SALUNOCURSOMEC.ATVMONITORIA = 0 ) THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVMONITORIAREM)
	END                                                                               R59_BOLSA_ATIV_EXTRA_MONITORIA,
	CASE
	  WHEN SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0 THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVESTAGIO)
	END                                                                               R60_ATIV_EXTRA_ESTAGIO,
	CASE
	  WHEN ( SALUNOCURSOMEC.ATVCOMPLEMENTAR = 0
	          OR SALUNOCURSOMEC.ATVESTAGIO IS NULL
	          OR SALUNOCURSOMEC.ATVESTAGIO = 0 ) THEN NULL
	  ELSE CONVERT(VARCHAR, SALUNOCURSOMEC.ATVESTAGIOREM)
	END                                                                               R61_BOLSA_ATIV_EXTRA_ESTAGIO,
	CONVERT(VARCHAR, CONVERT(INTEGER, ROUND(SGRADE.CARGAHORARIA, 0)))                 R62_CARGA_HORARIA_CURSO,
	CONVERT(VARCHAR, CONVERT(INTEGER, ROUND(SALUNOCURSOMEC.CARGAHORARIACUMPRIDA, 0))) R63_CARGA_HORARIA_ALUNO,
	CASE
	  WHEN (SALUNOMEC.JUSTIFICATIVA IS NULL) THEN ''
	  WHEN (SALUNOMEC.JUSTIFICATIVA = 0) THEN ''
	  WHEN (SALUNOMEC.JUSTIFICATIVA < 10) THEN CONCAT('0', CONVERT(VARCHAR, SALUNOMEC.JUSTIFICATIVA))
	  ELSE CONVERT(VARCHAR, SALUNOMEC.JUSTIFICATIVA)
	END R64_JUSTIFICATIVA
FROM   
	SALUNOCURSOMEC (NOLOCK)
	JOIN SHABILITACAOFILIAL (NOLOCK)
	  ON SHABILITACAOFILIAL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
	     AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL
	JOIN SCURSOMEC (NOLOCK)
	  ON SCURSOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	     AND SCURSOMEC.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
	     AND SCURSOMEC.GERACENSO = 1
	JOIN SINSTITUICAOMEC (NOLOCK)
	  ON ( SINSTITUICAOMEC.CODCOLIGADA = SCURSOMEC.CODCOLIGADA
	       AND SINSTITUICAOMEC.IDINSTITUICAOMEC = SCURSOMEC.IDINSTITUICAOMEC )
	LEFT JOIN SHABILITACAOMEC (NOLOCK)
	       ON SHABILITACAOMEC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	          AND SHABILITACAOMEC.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	          AND SHABILITACAOMEC.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	JOIN SHABILITACAOALUNO (NOLOCK)
	  ON SHABILITACAOALUNO.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
	     AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL
	     AND SHABILITACAOALUNO.RA = SALUNOCURSOMEC.RA
	JOIN SALUNO (NOLOCK)
	  ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	     AND SALUNO.RA = SHABILITACAOALUNO.RA
	JOIN SALUNOMEC (NOLOCK)
	  ON SALUNOMEC.CODCOLIGADA = SALUNO.CODCOLIGADA
	     AND SALUNOMEC.RA = SALUNO.RA
	LEFT JOIN SPESSOA (NOLOCK)
	       ON SALUNO.CODPESSOA = SPESSOA.CODIGO
	
	LEFT JOIN PPESSOA (NOLOCK) ON PPESSOA.CODIGO = SPESSOA.CODIGO
	       
	LEFT JOIN SINSTITUICAO (NOLOCK)
	       ON SINSTITUICAO.CODINST = SPESSOA.CODINST2GRAU
	LEFT JOIN SCURSO (NOLOCK)
	       ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	          AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	LEFT JOIN STURNO (NOLOCK)
	       ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
	          AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
	LEFT JOIN SMATRICPL (NOLOCK)
	       ON ( SMATRICPL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
	            AND SMATRICPL.RA = SALUNOCURSOMEC.RA
	            AND SMATRICPL.IDHABILITACAOFILIAL = SALUNOCURSOMEC.IDHABILITACAOFILIAL)
	LEFT JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
		AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
	LEFT JOIN SMATRICPLMEC (NOLOCK)
	       ON ( SMATRICPLMEC.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	            AND SMATRICPLMEC.RA = SMATRICPL.RA
	            AND SMATRICPLMEC.IDPERLET = SMATRICPL.IDPERLET
	            AND SMATRICPLMEC.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL )
	LEFT JOIN SGRADE (NOLOCK)
	       ON ( SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	            AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	            AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO
	            AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE )
	LEFT JOIN SCAMPUS (NOLOCK)
	       ON SHABILITACAOALUNO.CODCAMPUS = SCAMPUS.CODCAMPUS

	WHERE  
	PPESSOA.CPF is not null and	
	PPESSOA.CPF NOT IN (Select CPF from z_Unasp_NaoEnviarCensoCPF) and
	PPESSOA.NOME NOT LIKE 'Unaspense%' and
	PPESSOA.NOME NOT LIKE '%TESTE%' and 
	
	SALUNOCURSOMEC.CODCOLIGADA = :P_CODCOLIGADA
	AND SCURSOMEC.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
	AND SMATRICPL.DTMATRICULA = (SELECT MAX(DTMATRICULA)
	                             FROM   SMATRICPL (NOLOCK),
	                                    SPLETIVO (NOLOCK),
	                                    SCURSOMEC SCURSOMEC2 (NOLOCK),
	                                    SHABILITACAOFILIAL (NOLOCK)
	                             WHERE  SALUNOCURSOMEC.CODCOLIGADA = :P_CODCOLIGADA
	                                    AND SCURSOMEC2.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
	                                    AND SHABILITACAOFILIAL.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
	                                    AND SCURSOMEC2.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	                                    AND SCURSOMEC2.IDCURSOMEC = SHABILITACAOFILIAL.IDCURSOMEC
	                                    AND SCURSOMEC2.GERACENSO = 1
	                                    AND SPLETIVO.CODCOLIGADA = SALUNOCURSOMEC.CODCOLIGADA
	                                    AND SPLETIVO.CODFILIAL = SHABILITACAOFILIAL.CODFILIAL
	                                    AND SPLETIVO.DTINICIO IS NOT NULL
	                                    AND SPLETIVO.DTFIM IS NOT NULL
	                                    AND ( ( SPLETIVO.DTINICIO BETWEEN :DATAREFINI_D AND :DATAREFFIM_D )
	                                           OR ( SPLETIVO.DTFIM BETWEEN :DATAREFINI_D AND :DATAREFFIM_D ) )
	                                    AND SMATRICPL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	                                    AND SMATRICPL.RA = SALUNOCURSOMEC.RA
	                                    AND SMATRICPL.IDPERLET = SPLETIVO.IDPERLET
	                                    AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	                                    AND SCURSOMEC2.CODINEPCURSO = SCURSOMEC.CODINEPCURSO)
	and EXISTS ( /*tem avaliação em qualquer período no curso*/
	SELECT 1  
	FROM
		SMATRICPL						(NOLOCK)	mpl 
	    inner join SPLETIVO				(NOLOCK)	pl	on pl.CODCOLIGADA = mpl.CODCOLIGADA and pl.IDPERLET = mpl.IDPERLET 
		inner join SHABILITACAOFILIAL	(NOLOCK)	hf	on hf.CODCOLIGADA = mpl.CODCOLIGADA and hf.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL
	    inner join SCURSO				(NOLOCK)	c	on c.CODCOLIGADA = hf.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
	    inner join SCURSOMEC			(NOLOCK)	cm	on cm.CODCOLIGADA = hf.CODCOLIGADA and cm.IDCURSOMEC = hf.IDCURSOMEC and cm.GERACENSO = 1
		inner join SALUNOCURSOMEC		(NOLOCK)	acm on acm.CODCOLIGADA = mpl.CODCOLIGADA AND acm.RA = mpl.RA and acm.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL
	    inner join SSTATUS				(NOLOCK)	st	on st.CODCOLIGADA=mpl.CODCOLIGADA and st.CODSTATUS = mpl.CODSTATUS
		inner join SMATRICULA			(NOLOCK)	m	on m.CODCOLIGADA = mpl.CODCOLIGADA and m.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and m.RA = mpl.RA
		inner join SSTATUS				(NOLOCK)	stm	on stm.CODCOLIGADA=m.CODCOLIGADA and stm.CODSTATUS = m.CODSTATUS
		inner join SNOTAETAPA			(NOLOCK)	ne	on ne.CODCOLIGADA = m.CODCOLIGADA and ne.IDTURMADISC = m.IDTURMADISC and ne.RA = m.RA
	WHERE 
		mpl.CODCOLIGADA=:P_CODCOLIGADA
		and hf.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		and cm.IDINSTITUICAOMEC = :P_IDINSTITUICAOMEC
		and c.CODCURSO not in ('EAD-LFOPL','EAD-LFOPE','EAD-LSELP','EAD-LSELI')
		AND SALUNOMEC.CODCOLIGADA = mpl.CODCOLIGADA
		AND SALUNOMEC.RA = mpl.RA  
		and mpl.DTMATRICULA is not null
		and stm.DESCRICAO<>'Cancelamento de Disciplinas'					
		and ne.NOTAFALTA is not null

	
	    AND pl.DTINICIO IS NOT NULL AND pl.DTFIM IS NOT NULL
	    AND ((pl.DTINICIO BETWEEN  :DATAREFINI_D AND  :DATAREFFIM_D) OR
	        (pl.DTFIM BETWEEN  :DATAREFINI_D AND  :DATAREFFIM_D)))
	
	and not exists (Select 1 
					from 
						z_Unasp_NaoEnviarCenso z 
					where 
						z.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
						AND z.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
						AND z.RA = SHABILITACAOALUNO.RA)
) x
";23350;;;;19/08/2022;isaldo;1;1;1;1;1;1;;0;34fc7fa8-29f3-4c22-8b37-e84bf181848e;0;;5117;isaldo;08/06/2022;isaldo;19/08/2022;0
S;MENS.001;Mensagem boletos em aberto  por vencimento;"with emails as (select CAST(GMAILSEND.TOADDR AS VARCHAR(100)) email from GMAILSEND where SUBJECT = :Assunto)
Select * from 
(
SELECT distinct 	
	PPESSOA.CODUSUARIO , 
	PPESSOA.EMAIL 
FROM FLAN (nolock)
	INNER JOIN SLAN (nolock) ON SLAN.IDLAN = FLAN.IDLAN AND SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	INNER JOIN FLANBOLETO (nolock) ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
	INNER JOIN FBOLETO (nolock) ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
	INNER JOIN SPARCELA (nolock) ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
	INNER JOIN SCONTRATO (nolock) ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SMATRICPL (nolock) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	INNER JOIN SSTATUS (nolock) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE FLAN.STATUSLAN = '0'
	AND   MONTH(FBOLETO.VENCIMENTO) =:mes
	AND   YEAR (FBOLETO.VENCIMENTO) =:ano
	AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
	AND   SALUNO.RA LIKE '%' + :RA + '%'
GROUP BY SALUNO.RA , 
	FLAN.CODCOLIGADA , 
	PPESSOA.CODUSUARIO , 
	PPESSOA.EMAIL ,  
	PPESSOA.NOME ) x
/*Where 
	EMAIL not in (select email from Emails)*/";1728;;;;09/08/2021;mestre;1;1;1;1;;;;0;7117d59d-d4db-4499-a81a-9ab5790a235c;0;;32728;mestre;05/08/2021;mestre;09/08/2021;0
S;MENS.001.1;Mensagem geral - todos os alunos;"SELECT distinct 	
	PPESSOA.CODUSUARIO , 
	PPESSOA.EMAIL 
FROM  SCONTRATO (nolock) 
	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SMATRICPL (nolock) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	INNER JOIN SSTATUS (nolock) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
	INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
WHERE   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
	AND   SALUNO.RA LIKE '%' + :RA + '%'
	AND   SPLETIVO.CODPERLET =:PeriodoLetivo	
	AND   SCONTRATO.CODTIPOCURSO =:TipoCurso
GROUP BY SALUNO.RA , 	 
	PPESSOA.CODUSUARIO , 
	PPESSOA.EMAIL ,  
	PPESSOA.NOME
";978;;;;23/09/2021;lilian.buzetti;1;1;1;1;;;;0;7117d59d-d4db-4499-a81a-9ab5790a235c;0;;5519;mestre;11/08/2021;lilian.buzetti;23/09/2021;0
S;MENS.001.2;Mensagem boletos em aberto  por dia do vencimento sem EAD;"/*with emails as (select CAST(GMAILSEND.TOADDR AS VARCHAR(100)) email from GMAILSEND where SUBJECT = :Assunto)*/
Select DISTINCT
	CODCOLIGADA,
  CODUSUARIO,
  EMAIL,
  RA,
  NOME,
  NOME NOMEDESTINATARIO,
  FILIAL,
  NIVEL,
  /*IDBOLETO,*/
  /*Curso,*/
  STRING_AGG(convert(varchar,DTVENCIMENTO ,3),',') AS Vencimentos
from (
SELECT distinct
	FLAN.CODCOLIGADA, 	
  FLAN.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  PPESSOA.CODUSUARIO ,
  PPESSOA.EMAIL,
  SMATRICPL.RA,
  PPESSOA.NOME,
FBOLETO.IDBOLETO,
  /*c.NOME Curso,*/
  SPARCELA.DTVENCIMENTO
 FROM 
  FLAN (nolock)
 
  INNER JOIN SLAN (nolock) 			ON SLAN.IDLAN = FLAN.IDLAN AND 	
 									   SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
 
  INNER JOIN FLANBOLETO (nolock) 	ON FLANBOLETO.IDLAN = FLAN.IDLAN AND 
 									   FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA

  INNER JOIN FBOLETO (nolock) 		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND 
 									   FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
 									   
  INNER JOIN SPARCELA (nolock) 		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 									   SPARCELA.IDPARCELA = SLAN.IDPARCELA 
 									   
  INNER JOIN SCONTRATO (nolock) 		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   SCONTRATO.RA = SPARCELA.RA AND 
 									   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 									   SCONTRATO.IDPERLET = SPARCELA.IDPERLET
 									   
  INNER JOIN SALUNO (nolock) 		ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SALUNO.RA = SCONTRATO.RA
 									   
  INNER JOIN PPESSOA (nolock) 		ON PPESSOA.CODIGO = SALUNO.CODPESSOA

  INNER JOIN SMATRICPL (nolock) 		ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SMATRICPL.RA = SCONTRATO.RA AND 
 									   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  
 									   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

  INNER JOIN SHABILITACAOFILIAL	(nolock) HF ON HF.CODCOLIGADA=SMATRICPL.CODCOLIGADA AND HF.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
  inner join SGRADE				(nolock) g	on	g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
  inner join SHABILITACAO		(nolock) h	on	h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
  inner join SCURSO				(nolock) c	on	c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO

  INNER JOIN SSTATUS (nolock) 		ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 									   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

  LEFT JOIN SBOLSAALUNO (NOLOCK)		ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 									   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 									   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
  LEFT JOIN SBOLSA (NOLOCK)			ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  									   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA										   

 LEFT JOIN SHABILITACAOALUNO (NOLOCK)		ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 										   	   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 										   	   SHABILITACAOALUNO.RA = SMATRICPL.RA

 LEFT JOIN SHABILITACAOALUNOCOMPL (NOLOCK)	ON SHABILITACAOALUNOCOMPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
 											   SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
 											   SHABILITACAOALUNOCOMPL.RA = SHABILITACAOALUNO.RA

 WHERE FLAN.STATUSLAN = '0'
	AND   YEAR (FBOLETO.VENCIMENTO) LIKE :ano
	AND   MONTH(FBOLETO.VENCIMENTO) between :MesInicial and :MesFinal
	AND   FBOLETO.VENCIMENTO <= :vencimento_D
	AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
	AND   SALUNO.RA LIKE '%' + :RA + '%'

	AND   FLAN.CODTDO IN (/*'ACORD_EXT', 'CHQ_DEV',*/ 'INTER', 'MENS', 'PENS', 'EXTENSAO')
	AND   SCONTRATO.CODTIPOCURSO IN (1, 2, 3)
	AND	  isnull(SBOLSA.FIES,0) <> 2

	/*AND  FLAN.CODFILIAL <> 4*/ 
	AND (   SHABILITACAOALUNOCOMPL.FIES IS NULL
 	     OR SHABILITACAOALUNOCOMPL.FIES = 'F')
	

) x
Group by
	CODCOLIGADA,
  CODUSUARIO,
  EMAIL,
  RA,
  NOME,
  FILIAL,
  NIVEL,
  IDBOLETO
  /*,  Curso*/
 

/*
with emails as (select CAST(GMAILSEND.TOADDR AS VARCHAR(100)) email from GMAILSEND where SUBJECT = :Assunto)
Select * from 
(
SELECT distinct 	
	PPESSOA.CODUSUARIO , 
	PPESSOA.EMAIL 
FROM FLAN (nolock)
	INNER JOIN SLAN (nolock) ON SLAN.IDLAN = FLAN.IDLAN AND SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	INNER JOIN FLANBOLETO (nolock) ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
	INNER JOIN FBOLETO (nolock) ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
	INNER JOIN SPARCELA (nolock) ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
	INNER JOIN SCONTRATO (nolock) ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SMATRICPL (nolock) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	INNER JOIN SSTATUS (nolock) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE FLAN.STATUSLAN = '0'
	--AND   DAY(FBOLETO.VENCIMENTO) =:dia
	AND   MONTH(FBOLETO.VENCIMENTO) LIKE :mes
	AND   YEAR (FBOLETO.VENCIMENTO) LIKE :ano
	AND   FBOLETO.VENCIMENTO <= :vencimento
	AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
	AND   SALUNO.RA LIKE '%' + :RA + '%'

	AND   FLAN.CODTDO IN (--'ACORD_EXT', 'CHQ_DEV', 'INTER',-- 'MENS', 'PENS')
	AND   SCONTRATO.CODTIPOCURSO IN (1, 2)
	
GROUP BY SALUNO.RA , 
	FLAN.CODCOLIGADA , 
	PPESSOA.CODUSUARIO , 
	PPESSOA.EMAIL ,  
	PPESSOA.NOME ) x
*/
/*Where 
	EMAIL not in (select email from Emails)*/";6209;;;;31/05/2022;robson.canto;1;1;1;1;;;;0;7117d59d-d4db-4499-a81a-9ab5790a235c;0;;-19042;robson.canto;11/11/2021;robson.canto;31/05/2022;0
S;MENS.001.3;Mensagem boletos em aberto  por dia do vencimento EAD Graduação;"/*with emails as (select CAST(GMAILSEND.TOADDR AS VARCHAR(100)) email from GMAILSEND where SUBJECT = :Assunto)*/
Select DISTINCT
	CODCOLIGADA,
  CODUSUARIO,
  EMAIL,
  RA,
  NOME,
  NOME NOMEDESTINATARIO,
  FILIAL,
  NIVEL,
  /*IDBOLETO,*/
  /*Curso,*/
  STRING_AGG(convert(varchar,DTVENCIMENTO ,3),',') AS Vencimentos
from (
SELECT distinct 
FLAN.CODCOLIGADA,	FBOLETO.IDBOLETO,
  FLAN.CODFILIAL FILIAL,
  SCONTRATO.CODTIPOCURSO NIVEL,
  PPESSOA.CODUSUARIO ,
  PPESSOA.EMAIL,
  SMATRICPL.RA,
  PPESSOA.NOME,
  /*c.NOME Curso,*/
  SPARCELA.DTVENCIMENTO
 FROM 
  FLAN (nolock)
 
  INNER JOIN SLAN (nolock) 			ON SLAN.IDLAN = FLAN.IDLAN AND 	
 									   SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
 
  INNER JOIN FLANBOLETO (nolock) 	ON FLANBOLETO.IDLAN = FLAN.IDLAN AND 
 									   FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA

  INNER JOIN FBOLETO (nolock) 		ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND 
 									   FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
 									   
  INNER JOIN SPARCELA (nolock) 		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 									   SPARCELA.IDPARCELA = SLAN.IDPARCELA 
 									   
  INNER JOIN SCONTRATO (nolock) 		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   SCONTRATO.RA = SPARCELA.RA AND 
 									   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 									   SCONTRATO.IDPERLET = SPARCELA.IDPERLET
 									   
  INNER JOIN SALUNO (nolock) 		ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SALUNO.RA = SCONTRATO.RA
 									   
  INNER JOIN PPESSOA (nolock) 		ON PPESSOA.CODIGO = SALUNO.CODPESSOA

  INNER JOIN SMATRICPL (nolock) 		ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SMATRICPL.RA = SCONTRATO.RA AND 
 									   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  
 									   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

  INNER JOIN SHABILITACAOFILIAL	(nolock) HF ON HF.CODCOLIGADA=SMATRICPL.CODCOLIGADA AND HF.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
  inner join SGRADE				(nolock) g	on	g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
  inner join SHABILITACAO		(nolock) h	on	h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
  inner join SCURSO				(nolock) c	on	c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO

  INNER JOIN SSTATUS (nolock) 		ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 									   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

  LEFT JOIN SBOLSAALUNO (NOLOCK)		ON SBOLSAALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SBOLSAALUNO.RA = SCONTRATO.RA AND 
 									   SBOLSAALUNO.CODCONTRATO = SCONTRATO.CODCONTRATO AND 
 									   SBOLSAALUNO.IDPERLET = SCONTRATO.IDPERLET
 
  LEFT JOIN SBOLSA (NOLOCK)			ON SBOLSA.CODCOLIGADA = SBOLSAALUNO.CODCOLIGADA AND 
  									   SBOLSA.CODBOLSA = SBOLSAALUNO.CODBOLSA										   

 LEFT JOIN SHABILITACAOALUNO (NOLOCK)		ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 										   	   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 										   	   SHABILITACAOALUNO.RA = SMATRICPL.RA

 LEFT JOIN SHABILITACAOALUNOCOMPL (NOLOCK)	ON SHABILITACAOALUNOCOMPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
 											   SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
 											   SHABILITACAOALUNOCOMPL.RA = SHABILITACAOALUNO.RA

 WHERE FLAN.STATUSLAN = '0'
	AND   YEAR (FBOLETO.VENCIMENTO) LIKE :ano
	AND   MONTH(FBOLETO.VENCIMENTO) between :MesInicial and :MesFinal
	AND   FBOLETO.VENCIMENTO <= :vencimento_D
	AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
	AND   SALUNO.RA LIKE '%' + :RA + '%'

	AND   FLAN.CODTDO IN (/*'ACORD_EXT', 'CHQ_DEV', 'INTER',*/ 'MENS', 'PENS', 'EXTENSAO')
	AND   SCONTRATO.CODTIPOCURSO IN (1, 2)
	AND	  isnull(SBOLSA.FIES,0) <> 2

	AND  FLAN.CODFILIAL = 4 
	AND (   SHABILITACAOALUNOCOMPL.FIES IS NULL
 	     OR SHABILITACAOALUNOCOMPL.FIES = 'F')
	

) x
Group by
	CODCOLIGADA,
  CODUSUARIO,
  EMAIL,
  RA,
  NOME,
  FILIAL,
  NIVEL,
  IDBOLETO
  /*,  Curso*/
 

/*
with emails as (select CAST(GMAILSEND.TOADDR AS VARCHAR(100)) email from GMAILSEND where SUBJECT = :Assunto)
Select * from 
(
SELECT distinct 	
	PPESSOA.CODUSUARIO , 
	PPESSOA.EMAIL 
FROM FLAN (nolock)
	INNER JOIN SLAN (nolock) ON SLAN.IDLAN = FLAN.IDLAN AND SLAN.CODCOLIGADA = FLAN.CODCOLIGADA
	INNER JOIN FLANBOLETO (nolock) ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
	INNER JOIN FBOLETO (nolock) ON FBOLETO.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND FBOLETO.IDBOLETO = FLANBOLETO.IDBOLETO
	INNER JOIN SPARCELA (nolock) ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND SPARCELA.IDPARCELA = SLAN.IDPARCELA 
	INNER JOIN SCONTRATO (nolock) ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SCONTRATO.RA = SPARCELA.RA AND SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND SCONTRATO.IDPERLET = SPARCELA.IDPERLET
	INNER JOIN SALUNO (nolock) ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SALUNO.RA = SCONTRATO.RA
	INNER JOIN PPESSOA (nolock) ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SMATRICPL (nolock) ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SMATRICPL.RA = SCONTRATO.RA AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
	INNER JOIN SSTATUS (nolock) ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE FLAN.STATUSLAN = '0'
	--AND   DAY(FBOLETO.VENCIMENTO) =:dia
	AND   MONTH(FBOLETO.VENCIMENTO) LIKE :mes
	AND   YEAR (FBOLETO.VENCIMENTO) LIKE :ano
	AND   FBOLETO.VENCIMENTO <= :vencimento
	AND   SSTATUS.DESCRICAO LIKE '%' + :Status + '%'
	AND   SALUNO.RA LIKE '%' + :RA + '%'

	AND   FLAN.CODTDO IN (--'ACORD_EXT', 'CHQ_DEV', 'INTER',-- 'MENS', 'PENS')
	AND   SCONTRATO.CODTIPOCURSO IN (1, 2)
	
GROUP BY SALUNO.RA , 
	FLAN.CODCOLIGADA , 
	PPESSOA.CODUSUARIO , 
	PPESSOA.EMAIL ,  
	PPESSOA.NOME ) x
*/
/*Where 
	EMAIL not in (select email from Emails)*/";6198;;;;20/05/2022;robson.canto;1;1;1;1;;;;0;7117d59d-d4db-4499-a81a-9ab5790a235c;0;;16847;robson.canto;28/02/2022;robson.canto;20/05/2022;0
S;MENS.001.4;Mensagem boletos em aberto por Dia de Vencimento;"SELECT DISTINCT
 FBOLETO.CODFILIAL,
 FBOLETO.SACADO,
 FCFO.NOME,
 FCFO.EMAIL,
 FCFO.CODUSUARIOACESSO CODUSUARIO,
 /*FBOLETO.IDBOLETO,
 FBOLETO.VALOR,*/
 SCONTRATO.CODTIPOCURSO NIVEL,
 SSTATUS.DESCRICAO STATUS,
 SPARCELA.RA
 
FROM
 FBOLETO (NOLOCK)
 
 INNER JOIN FCFO (NOLOCK)			ON FCFO.CODCOLIGADA = FBOLETO.CODCOLSACADO AND 
 								   	   FCFO.CODCFO = FBOLETO.SACADO 								   

 INNER JOIN FLANBOLETO (nolock) 	ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO AND 
 									   FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA

 INNER JOIN FLAN (nolock) 			ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND 
 									   FLAN.IDLAN = FLANBOLETO.IDLAN
 									   
 INNER JOIN SLAN (NOLOCK)			ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									   SLAN.IDLAN = FLAN.IDLAN
 									    									   
 INNER JOIN SPARCELA (nolock) 		ON SPARCELA.CODCOLIGADA = SLAN.CODCOLIGADA AND 
 									   SPARCELA.IDPARCELA = SLAN.IDPARCELA 
 									   
 INNER JOIN SCONTRATO (nolock) 		ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   SCONTRATO.RA = SPARCELA.RA AND 
 									   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 									   SCONTRATO.IDPERLET = SPARCELA.IDPERLET

 INNER JOIN SMATRICPL (nolock) 		ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 									   SMATRICPL.RA = SCONTRATO.RA AND 
 									   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND  
 									   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL

 INNER JOIN SSTATUS (nolock) 		ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 									   SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS

 LEFT JOIN SHABILITACAOALUNO (NOLOCK)		ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 										   	   SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL AND 
 										   	   SHABILITACAOALUNO.RA = SMATRICPL.RA

 LEFT JOIN SHABILITACAOALUNOCOMPL (NOLOCK)	ON SHABILITACAOALUNOCOMPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA AND 
 											   SHABILITACAOALUNOCOMPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL AND 
 											   SHABILITACAOALUNOCOMPL.RA = SHABILITACAOALUNO.RA
WHERE	FBOLETO.CODCOLIGADA = 1
	AND FLAN.STATUSLAN = 0
	AND FBOLETO.VENCIMENTO >= :Data_Início_D
	AND FBOLETO.VENCIMENTO <= :Data_Fim_D
	AND SCONTRATO.CODTIPOCURSO LIKE :Nível_Ensino + '%'
    AND SSTATUS.DESCRICAO LIKE '%' + :Status + '%' 
	AND SPARCELA.RA LIKE '%' + :RA + '%'
	/*AND FLAN.CODFILIAL <> 4*/
	AND FLAN.CODTDO NOT IN ('TAX_APRO', 'TAX_EXT')
	AND (   SHABILITACAOALUNOCOMPL.FIES IS NULL
 	     OR SHABILITACAOALUNOCOMPL.FIES = 'F')
	AND FLAN.CODFILIAL LIKE :Filial_S	     

/*
SELECT DISTINCT
 FBOLETO.CODFILIAL,
 FBOLETO.SACADO,
 FCFO.NOME,
 FCFO.EMAIL,
 FCFO.CODUSUARIOACESSO CODUSUARIO,
 FBOLETO.IDBOLETO,
 FBOLETO.VALOR
 
FROM
 FBOLETO (NOLOCK)
 
 INNER JOIN FCFO (NOLOCK)		ON FCFO.CODCOLIGADA = FBOLETO.CODCOLSACADO AND 
 								   FCFO.CODCFO = FBOLETO.SACADO 								   

WHERE	FBOLETO.CODCOLIGADA = 1
	AND FBOLETO.STATUS = 0
	AND FBOLETO.VENCIMENTO >= :Data_Início
	AND FBOLETO.VENCIMENTO <= :Data_Fim
	*/";3134;;;;21/06/2022;robson.canto;1;1;1;1;;;;0;a761c38e-0814-404a-a901-dd13a1ffb4ad;0;;18890;robson.canto;04/03/2022;robson.canto;21/06/2022;0
S;NFHT;Valor nota fiscal de HT;"
SELECT (FLAN.VALORORIGINAL - SUM(FLANINTEGRACAO.VALOR)) AS VALOR  FROM FBOLETO
INNER JOIN FLANBOLETO ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA AND FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
INNER JOIN FLAN ON FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA AND FLANBOLETO.IDLAN = FLAN.IDLAN
LEFT JOIN FLANINTEGRACAO ON FLANINTEGRACAO.IDLAN = FLAN.IDLAN AND FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA AND IDCAMPO = 48 
WHERE FBOLETO.IDBOLETO =:IDBOLETO
AND   FBOLETO.CODCOLIGADA =:CODCOLIGADA
GROUP BY FLAN.VALORORIGINAL";526;;;;29/07/2021;mestre;1;1;1;1;;;;0;078c959d-dd65-4b00-85c4-a8a2c5985cde;0;;-30708;mestre;29/07/2021;mestre;29/07/2021;0
S;OFERTA;Cursos ofertados no processo seletivo X Matriz Educacional;"SELECT 
SGRADE.CODGRADE MATRIZ , 
SGRADE.DESCRICAO NOMEMATRIZ, 
GFILIAL.NOMEFANTASIA , 
SPSAREAINTERESSE.NOME NOMEOFERTA ,
SPSPROCESSOSELETIVO.NOME

FROM SPSAREAINTERESSE

INNER JOIN SHABILITACAOFILIAL ON 
SHABILITACAOFILIAL.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL AND 
SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SPSAREAINTERESSE.IDHABILITACAOFILIAL

INNER JOIN SGRADE ON 
SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND 
SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND 
SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE

INNER JOIN SCURSO ON 
SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO 

INNER JOIN GFILIAL ON 
SHABILITACAOFILIAL.CODFILIAL = GFILIAL.CODFILIAL

INNER JOIN SPSAREAOFERTADA ON 
SPSAREAOFERTADA.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE

INNER JOIN SPSPROCESSOSELETIVO ON 
SPSPROCESSOSELETIVO.CODCOLIGADA = SPSAREAOFERTADA.CODCOLIGADA AND 
SPSPROCESSOSELETIVO.IDPS = SPSAREAOFERTADA.IDPS";1080;;;;14/06/2021;mestre;1;1;1;1;;;;1;53267182-d49a-4862-98db-a9f08aacc98e;0;;-12020;mestre;14/06/2021;mestre;14/06/2021;0
S;OfertaOptativas;Confere Oferta de Optativas nas Turmas;"select 
	t.CODCURSO,
	t.CODHABILITACAO,
	t.CODGRADE,
	t.NomGrade,
	t.CODTURMA,
	t.NomTurma,
	t.CODPERIODO,
	gol.IDGRUPO,
	gol.NOME,
	gol.MINCREDITOS,
	dg.TOTCREDITOS
from 
	v_Unasp_TURMA t
	inner join SGRUPOOPTELET gol on gol.CODCOLIGADA = t.CODCOLIGADA and gol.CODCURSO = t.CODCURSO and gol.CODHABILITACAO = t.CODHABILITACAO	and gol.CODGRADE = t.CODGRADE and gol.CODPERIODO=t.CODPERIODO
	left join (
		Select 
			td.CODCOLIGADA, CODFILIAL, CODTURMA, IDPERLET, dgol.IDGRUPO, td.CODDISC, sum(d.NUMCREDITOS) TOTCREDITOS
		from 
			v_Unasp_STURMADISC td
			inner join SDISCIPLINA d on d.CODCOLIGADA=td.CODCOLIGADA and d.CODDISC=td.CODDISC
			inner join SDISCGRUPOOPTELET dgol on dgol.CODCOLIGADA = td.CODCOLIGADA and dgol.CODCURSO = td.CODCURSO and dgol.CODHABILITACAO = td.CODHABILITACAO and dgol.CODGRADE = td.CODGRADE and td.CODDISC = dgol.CODDISC
		Group by 
			td.CODCOLIGADA, CODFILIAL, CODTURMA, IDPERLET, dgol.IDGRUPO, td.CODDISC
		) dg on 
			dg.CODCOLIGADA=t.CODCOLIGADA and 
			dg.CODFILIAL=t.CODFILIAL and 
			dg.CODTURMA=t.CODTURMA and 
			dg.IDPERLET = t.IDPERLET and 
			dg.IDGRUPO=gol.IDGRUPO
where 
	CODTIPOCURSO = :CODTIPOCURSO
	AND CODPERLET = :CODPERLET
";1204;;;;28/09/2021;isaldo;1;1;1;1;;;;0;5f46a400-e8f5-4212-a7a2-740b568d58f8;0;;23214;isaldo;28/09/2021;isaldo;28/09/2021;0
S;Parcela Gerada;Resumo de Parcelas Geradas por Mês de Vencimento;"Select 
	x.RA, 
	p.NOME,
	x.IDHABILITACAOFILIAL, 
	hf.NomFilial,
	hf.NomTipoCurso,
	hf.NomCurso,
	hf.NomTurno,
	SUM(x.VALORBRUTO)		Bruto,
	SUM(x.BolsaFuncionario) BolsaFuncionario,
	SUM(x.BolsaFilantropia) BolsaFilantropia,
	SUM(x.OutrosDescontos)	OutrosDescontos,
	SUM(x.VALORBRUTO) - isnull(Sum(TotalBolsa),0) Líquido
from (
		SELECT 
			p.CODCOLIGADA,
			p.IDPERLET,
			pl.CODPERLET,
			hf.IDHABILITACAOFILIAL,
			p.RA,
			hf.CODCURSO,
			m.CODTURMA,
			m.CODTIPOMAT,
			m.PERIODO,
			p.PARCELA, 
			s.CODSERVICO,
			s.NOME SERVICO , 
			CASE WHEN fl.VALORORIGINAL IS NULL AND ct.STATUS = 'N' THEN ISNULL(p.VALOR,0) ELSE ISNULL(fl.VALORORIGINAL,0) END AS VALORBRUTO ,				
			bl.BolsaFuncionario,
			bl.BolsaFilantropia,
			bl.OutrosDescontos,
			bl.TotalBolsa,
			st.DESCRICAO STATUS,
			p.IDPARCELA, 1 item
		FROM 
			SPARCELA 						(NOLOCK) p	
			inner JOIN SLAN 				(NOLOCK) sl	ON p.CODCOLIGADA = sl.CODCOLIGADA AND p.IDPARCELA = sl.IDPARCELA
			inner JOIN FLAN 				(NOLOCK) fl	ON sl.CODCOLIGADA = fl.CODCOLIGADA AND sl.IDLAN = fl.IDLAN
			inner JOIN SCONTRATO			(NOLOCK) ct	ON ct.CODCOLIGADA = p.CODCOLIGADA AND ct.RA = p.RA AND ct.CODCONTRATO = p.CODCONTRATO AND ct.IDPERLET = p.IDPERLET
			inner JOIN SMATRICPL			(NOLOCK) m	ON m.CODCOLIGADA = ct.CODCOLIGADA AND m.IDPERLET = ct.IDPERLET AND m.IDHABILITACAOFILIAL = ct.IDHABILITACAOFILIAL AND m.RA = ct.RA
			inner join SHABILITACAOFILIAL	(NOLOCK) hf	on hf.CODCOLIGADA=m.CODCOLIGADA and hf.IDHABILITACAOFILIAL = m.IDHABILITACAOFILIAL
			inner join SCURSO				(NOLOCK) c	on hf.CODCOLIGADA=c.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
			inner JOIN SPLETIVO 			(NOLOCK) pl	ON pl.CODCOLIGADA = ct.CODCOLIGADA AND pl.IDPERLET = ct.IDPERLET
			inner JOIN SSERVICO 			(NOLOCK) s	ON s.CODCOLIGADA = p.CODCOLIGADA AND s.CODSERVICO = p.CODSERVICO
			inner JOIN SSTATUS 				(NOLOCK) st	ON st.CODCOLIGADA = m.CODCOLIGADA AND st.CODSTATUS = m.CODSTATUS        
			left join	(
							Select 
								CODCOLIGADA, IDLAN, 
								SUM(case when CODBOLSA IN (141,143,144) then bl.valor end)				BolsaFuncionario,
								SUM(case when CODBOLSA IN (1,2,3,4) then bl.valor end)					BolsaFilantropia,
								SUM(case when CODBOLSA not IN (1,2,3,4,141,143,144) then bl.valor end)	OutrosDescontos,
								SUM(bl.valor)															TotalBolsa
							from 
								SBOLSALAN (NOLOCK) bl 
							group by 
								CODCOLIGADA, IDLAN
						) bl on bl.CODCOLIGADA = sl.CODCOLIGADA and	bl.IDLAN = sl.IDLAN
		WHERE
			st.CODSTATUS in (Select Valor from z_config where Grupo='Status' and Item='Cursando')
			and pl.CODPERLET in (select Id from dbo.splitStringToTable( :Periodo ,',')) and year(p.DTVENCIMENTO) = :Ano and MONTH(p.DTVENCIMENTO)= :Mes
			and ct.TIPOCONTRATO <> 'A' 
	) x
	inner join v_Unasp_SHABILITACAOFILIAL hf on hf.IDHABILITACAOFILIAL=x.IDHABILITACAOFILIAL
	inner join SALUNO a on a.CODCOLIGADA = hf.CODCOLIGADA and a.RA=x.RA
	inner join PPESSOA p on p.CODIGO = a.CODPESSOA
Group by
	x.RA, 
	p.NOME,
	x.IDHABILITACAOFILIAL, 
	hf.NomFilial,
	hf.NomTipoCurso,
	hf.NomCurso,
	hf.NomTurno
order by 
	RA";3118;;;;07/03/2022;isaldo;1;1;1;1;;;;1;307b0707-68ec-4083-801e-a88a912c9a07;0;;-31956;isaldo;07/03/2022;isaldo;07/03/2022;0
S;PARCELA_FLAN;Parcela / FLAN;"Select 
	* 
from 
	v_Unasp_SPARCELA 
Where 
	CODPERLET in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' ))
order by 
	Filial, Aluno, Curso, DATAVENCIMENTO";172;;;;27/09/2022;mestre;1;1;1;1;;;;0;ed432bf0-1a36-4cd2-bb8d-bdc485d39b6c;0;;28739;mestre;27/09/2022;mestre;27/09/2022;0
S;Parcelas_PL;Lista de Parcelas do Periodo Letivo;Select * from v_Unasp_SPARCELA where CODPERLET LIKE :CODPERLET AND STATUSLAN = :STATUSLAN AND VENCIDO = 1;105;;;;24/10/2022;dhessyca.knupfer;1;1;1;1;;;;0;e8fbd93f-dddb-420b-a53f-f5683b6078d5;0;;29889;isaldo;24/10/2022;dhessyca.knupfer;24/10/2022;0
S;PENSIONATO;PENSIONADO - APROVA ALUNOS;"SELECT 
SMATRICPL.CODCOLIGADA,
SMATRICPL.IDHABILITACAOFILIAL,
SMATRICPL.RA,
SMATRICPL.IDPERLET



FROM SMATRICPL
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL AND SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN SALUNO ON SMATRICPL.CODCOLIGADA = SALUNO.CODCOLIGADA AND SMATRICPL.RA = SALUNO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SGRADE ON SGRADE.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SGRADE.CODCURSO = SHABILITACAOFILIAL.CODCURSO AND SGRADE.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO AND SGRADE.CODGRADE = SHABILITACAOFILIAL.CODGRADE
INNER JOIN SMATRICULA ON SMATRICULA.CODCOLIGADA = SALUNO.CODCOLIGADA AND SMATRICULA.RA = SALUNO.RA AND SMATRICPL.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL

WHERE SCURSO.NOME LIKE '%PENSIO%'
AND   SPLETIVO.CODPERLET =:PERIODOLETIVO
AND   PPESSOA.NOME LIKE '%' + :ALUNO + '%'";1197;;;;15/07/2021;mestre;1;1;1;1;;;;0;4e0a9467-2963-4e83-abd4-fd429bb64c37;0;;-21323;mestre;15/07/2021;mestre;15/07/2021;0
S;PeopleRouter;Sincronização com People/Router EdcuaAdventista.org;"Select * 
from 
	v_Unasp_PeopleRouter 
where 
	DataMatricula >= :DataMatricula
order by 
	DataMatricula desc";114;;;;08/08/2022;joshua;1;1;1;1;;;;0;6c10791d-a0ca-4e46-99bc-8d862d0fa5d2;0;;-28593;isaldo;21/09/2021;joshua;08/08/2022;0
S;PeopleRouterTest;Teste People Router;"Select * 
from 
	v_Unasp_PeopleRouter 
where 
	Chave = :Chave
order by 
	DataMatricula";92;;;;03/05/2022;isaldo;1;1;1;1;;;;0;7ff77cec-f901-46da-bcb9-f229fd2dcb43;0;;-20309;isaldo;03/05/2022;isaldo;03/05/2022;0
S;Peso;Calculo de Peso;"SELECT 
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 1
) AS PESO1,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 2
) AS PESO2,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 3
) AS PESO3,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 4
) AS PESO4,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 5
) AS PESO5,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 6
) AS PESO6,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 7
) AS PESO7,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 8
) AS PESO8,

(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 9
) AS PESO9,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 10
) AS PESO10,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 11
) AS PESO11,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 12
) AS PESO12,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 13
) AS PESO13,
(SELECT ISNULL(PESO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 14
) AS PESO14,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 15
) AS PESO15,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 16
) AS PESO16,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 17
) AS PESO17,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 18
) AS PESO18,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 19
) AS PESO19,
(SELECT ISNULL(PESO,-1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 20
) AS PESO20




FROM SETAPAS
WHERE TIPOETAPA = 'N'
AND   CODETAPA = 1
AND IDTURMADISC =:FRM_IDTD
/*AND IDTURMADISC = 308527*/";3852;;;;11/01/2022;consultor1.totvs;1;1;1;1;;;;0;052ad2ad-97f3-473d-932f-39ddb98085d7;0;;22088;mestre;27/01/2021;consultor1.totvs;11/01/2022;0
S;pesq.Disc;Pesquisa disciplinas em matriz;select * from v_unasp_sdiscgrade where coddisc = :coddisc;57;;;;07/10/2022;sandra.malvino;1;1;1;1;;;;0;86c14cdc-33b3-42f2-9051-ccd3dc3fd66c;0;;22305;sandra.malvino;07/10/2022;sandra.malvino;07/10/2022;0
S;prof.disc.prof02;Professor por TURNO Turma Disciplinas ;"SELECT SPROFESSORTURMA.CODPROF

FROM STURMADISC (NOLOCK)
INNER JOIN SPLETIVO  (NOLOCK) ON STURMADISC.IDPERLET = SPLETIVO.IDPERLET
LEFT JOIN SPROFESSORTURMA (NOLOCK) ON SPROFESSORTURMA.IDTURMADISC = STURMADISC.IDTURMADISC

WHERE 
STURMADISC.CODTURNO = :CODTURNO
AND SPLETIVO.CODPERLET = :PERIODO_LET
";308;;;;20/06/2022;maik.souza;1;1;1;1;;;;0;63143417-a605-4a4c-bac6-14386bece37b;0;;10806;maik.souza;20/06/2022;maik.souza;20/06/2022;0
S;PROF_ANO;Professores do Ano;"Select 
	DISTINCT
	pt.CODPROF
	
from 
	SPROFESSORTURMA pt
	inner join STURMADISC td on td.CODCOLIGADA=pt.CODCOLIGADA and pt.IDTURMADISC=td.IDTURMADISC
	inner join SPLETIVO pl on pl.CODCOLIGADA=td.CODCOLIGADA and pl.IDPERLET=td.IDPERLET
Where
	pl.CODPERLET like :ANO + '%' 
";283;;;;17/05/2022;maik.souza;1;1;1;1;;;;0;dccbbaa8-73c4-40ee-b738-6d63b8ff1543;0;;-22104;mestre;30/09/2021;maik.souza;17/05/2022;0
S;PROF_ANO_ATUAL;Professores de Ano 2022;"/*Busca professores do ano de 2022 nas 4 filiais:
Filiais Buscadas:
EC
EAD
HT
SP 
*/
Select 
	DISTINCT
	pt.CODPROF
	
from 
	SPROFESSORTURMA pt
	inner join STURMADISC td on td.CODCOLIGADA=pt.CODCOLIGADA and pt.IDTURMADISC=td.IDTURMADISC
	inner join SPLETIVO pl on pl.CODCOLIGADA=td.CODCOLIGADA and pl.IDPERLET=td.IDPERLET
Where
pt.DTINICIO >= '20220207 00:00:00.000'
AND pt.DTFIM <= '20221216 00:00:00.000'";422;;;;17/05/2022;maik.souza;1;1;1;1;;;;0;d0aaaca1-faf9-4b30-912e-5079fe4dfce4;0;;-22716;maik.souza;17/05/2022;maik.souza;17/05/2022;0
S;Professor01;Prohelp - Profesores por Diciplina/Curso (E-mail,Celular,CPF,Titulação );"
SELECT 
		DISTINCT
	v_unasp_STURMADISC.CODPERLET AS 'Periodo Letivo',
	NOMFILIAL AS 'Filial', 
	NOMTIPOCURSO AS 'Tipo Curso',
	NOMCURSO AS 'Curso',
	v_unasp_STURMADISC.NomDisciplina AS 'Disciplina',
	v_unasp_STURMADISC.IDTURMADISC AS 'IDTURMADISC', 
	PPESSOA.NOME AS 'Nome',
	PPESSOA.CPF AS CPF,
	STITULACAO.NOME AS 'Titulação',
	PPESSOA.EMAIL AS 'E-mail Comercial',
	PPESSOA.EMAILPESSOAL AS 'E-mail Pessoal',
	PPESSOA.TELEFONE1 AS 'Celular',
	PPESSOA.TELEFONE2 AS 'Residencial',
	PPESSOA.TELEFONE3 AS 'Comercial'
	
	
FROM 
	v_unasp_STURMADISC (NOLOCK) 
	INNER JOIN  SPROFESSORTURMA SPROFESSORTURMA (NOLOCK) 
		ON SPROFESSORTURMA.CODCOLIGADA=v_unasp_STURMADISC.CODCOLIGADA and SPROFESSORTURMA.IDTURMADISC=v_unasp_STURMADISC.IDTURMADISC
	LEFT JOIN SPROFESSOR (NOLOCK)
		ON SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
	LEFT JOIN PPESSOA (NOLOCK)
		ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
	LEFT JOIN STITULACAO (NOLOCK)
		ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO
WHERE
	CODPERLET like '%' + :CodPerlet + '%'
	and NOMCURSO  IS NOT NULL

GROUP BY v_unasp_STURMADISC.CODPERLET ,
	NOMFILIAL, 
	NOMTIPOCURSO ,
	v_unasp_STURMADISC.NomDisciplina,
	v_unasp_STURMADISC.IDTURMADISC,
	NOMCURSO,
	PPESSOA.NOME ,
	PPESSOA.CPF ,
	STITULACAO.NOME,
	PPESSOA.EMAIL,
	PPESSOA.EMAILPESSOAL ,
	PPESSOA.TELEFONE1 ,
	PPESSOA.TELEFONE2 ,
	PPESSOA.TELEFONE3
ORDER BY NomCurso, NOME

	
";1423;;;;18/10/2022;maik.souza;1;1;1;1;;;;0;4d1092c1-f583-40b4-a5a5-c5952211b427;0;;18037;maik.souza;14/07/2022;maik.souza;18/10/2022;0
S;Professor02;Professor por Curso;"select 
	CODPROF
from 
	v_unasp_STURMADISC td (NOLOCK) 
	INNER JOIN  SPROFESSORTURMA pt (NOLOCK) ON pt.CODCOLIGADA=td.CODCOLIGADA and pt.IDTURMADISC=td.IDTURMADISC
	
where 
	CODPERLET = :Periodo_Letivo
AND NOMFILIAL LIKE '%'+(:Sigla_Filial)
AND TD.NOMCURSO LIKE '%'+(:Nome_Curso)+'%'";292;;;;14/07/2022;maik.souza;1;1;1;1;;;;0;a236e274-8922-4f77-98a3-c007a0938d96;0;;-21903;maik.souza;22/06/2022;maik.souza;14/07/2022;0
S;professor03;Disciplins do Professor Por Ano;"/* Lista todas as disciplinas do professor naquele ano*/

SELECT 
		v_unasp_STURMADISC.IDTURMADISC 
	
FROM 
	v_unasp_STURMADISC (NOLOCK) 
	INNER JOIN  SPROFESSORTURMA SPROFESSORTURMA (NOLOCK) 
		ON SPROFESSORTURMA.CODCOLIGADA=v_unasp_STURMADISC.CODCOLIGADA and SPROFESSORTURMA.IDTURMADISC=v_unasp_STURMADISC.IDTURMADISC
	LEFT JOIN SPROFESSOR (NOLOCK)
		ON SPROFESSOR.CODPROF = SPROFESSORTURMA.CODPROF
	LEFT JOIN PPESSOA (NOLOCK)
		ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA
	LEFT JOIN STITULACAO (NOLOCK)
		ON STITULACAO.CODTITULACAO = SPROFESSOR.CODTITULACAO
WHERE
	CODPERLET like '%' + :Ano + '%'/*Apresenta todos os periodos letivos do ano informado*/ 
	and PPESSOA.NOME like '%' + :Nome + '%' /*Nome ou parte do nome do professor*/";750;;;;25/10/2022;maik.souza;1;1;1;1;;;;0;e8a4898b-7851-4eef-8ce1-e88acca2113c;0;;13141;maik.souza;25/10/2022;maik.souza;25/10/2022;0
S;PromoGra2022;Promoção Rematrícula 2022 Graduação;"Select distinct
	v2021.CodCurso, v2021.NomCurso, v2021.RA, v2021.NomPessoa Aluno,
	v2021.NomStatus Status2021_2, v2021.CODTURMA Turma2021, v2022.NomStatus Status2022_1, v2022.CODTURMA Turma2022, v2022.Matriz Matriz2022, v2022.StatusMatriz
from 
	v_Unasp_SMATRICPL v2021
	left join (
		Select 
			CODCURSO, CODTIPOCURSO, RA, CODTURMA, NomStatus, NomGrade Matriz, StatusMatriz
		from 
			v_Unasp_SMATRICPL v2022
		Where
			v2022.codperlet='2022/1' 
			and v2022.nomcurso not like 'Pensionato%') v2022
		on	v2022.CodCurso=v2021.CodCurso
			and v2022.codtipocurso= v2021.codtipocurso
			and v2021.RA=v2022.RA			
where 
	v2021.codperlet	='2021/2' 
	and v2021.codtipocurso=1 
	and v2021.nomstatus='Cursando'
	and v2021.nomcurso not like 'Pensionato%'
order by 
	v2021.CodCurso, v2021.NomPessoa";809;;;;15/11/2021;mestre;1;1;1;1;;;;1;ded3cee0-7262-4b07-9f82-8087ea032e33;0;;11351;mestre;15/11/2021;mestre;15/11/2021;0
S;PS.001;Correções de redação do Processo Seletivo;"SELECT DISTINCT 
	HIS.CODUSUARIOPS			CODUSUARIO, 
	USU.NOME					ALUNO,
	USU.DTNASCIMENTO			DATANASCIMENTO, 
	USU.EMAIL					EMAIL, 
	SPSAREAINTERESSE.NOME		CURSO, 
	F.NOME						CAMPUS, 
	PRT.NOME					TIPOPROVA,
	HIS.DATAHORAFIM				PROVAHORAFINAL, 
	HIS.RECMODIFIEDBY			NOMECORRETOR, 
	HIS.RECMODIFIEDON			DATAALTERACAO,
	
	CASE 
		WHEN DATEDIFF(
				HH, HIS.DATAHORAFIM, HIS.RECMODIFIEDON
			)<0 THEN 0 ELSE DATEDIFF(
				HH, HIS.DATAHORAFIM, HIS.RECMODIFIEDON
					)		END HORASCORRETOR,

	CASE 
		WHEN DATEDIFF(
				HH, HIS.DATAHORAFIM, HIS.RECMODIFIEDON
			)<= 2 THEN 7
		WHEN DATEDIFF(
				HH, HIS.DATAHORAFIM, HIS.RECMODIFIEDON
			)<= 12 THEN 5
		WHEN DATEDIFF(
				HH, HIS.DATAHORAFIM, HIS.RECMODIFIEDON
			)> 12 THEN 3
		ELSE DATEDIFF(
				HH, HIS.DATAHORAFIM, HIS.RECMODIFIEDON
					)		END VALOR


FROM BHISTORICO HIS

	INNER JOIN SPSUSUARIO USU
		ON USU.CODUSUARIOPS = HIS.CODUSUARIOPS

	LEFT JOIN SPSINSCRICAOAREAOFERTADA 
		ON HIS.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS  
    	
	LEFT JOIN SPSOPCAOINSCRITO  
		ON SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS 
		AND	SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	
	LEFT JOIN SPSAREAOFERTADA  
		ON SPSAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE 
		AND	SPSAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS
	
	LEFT JOIN SPSAREAINTERESSE  
		ON SPSAREAINTERESSE.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE

	INNER JOIN SHABILITACAOFILIAL HF 
		ON HF.IDHABILITACAOFILIAL=SPSAREAINTERESSE.IDHABILITACAOFILIAL
		INNER JOIN GFILIAL f on f.CODFILIAL=hf.CODFILIAL

    LEFT JOIN BPROVA PRT (NOLOCK) ON 
    	PRT.CODCOLIGADA = HIS.CODCOLIGADA   AND 
    	PRT.CODPROVA    = HIS.CODPROVA

	LEFT JOIN SPSSTATUSOPCAO SO	
		ON SO.CODIGO=SPSINSCRICAOAREAOFERTADA.STATUS
  
/*
    LEFT JOIN BDEFQUESTAO 	 	  		DEF (NOLOCK) ON 
    PRT.CODCOLIGADA = DEF.CODCOLIGADA AND 
    PRT.CODPROVA    = DEF.CODPROVA   
    
    LEFT JOIN BDEFQUESTAOCONDICIONAL 	COND(NOLOCK) ON 
    COND.CODCOLIGADA = DEF.CODCOLIGADA AND 
    COND.CODPROVA = DEF.CODPROVA AND 
    COND.CODAREA = DEF.CODAREA AND 
    COND.CODMATERIA = DEF.CODMATERIA AND 
    COND.CODQUESTAO = DEF.CODQUESTAO     
     
    LEFT JOIN BQUESTAO    	 			QST (NOLOCK) ON
    QST.CODCOLIGADA = COND.CODCOLIGADA AND 
    QST.CODQUESTAO  = COND.CODQUESTAO  AND 
    QST.CODAREA    = COND.CODAREA AND 
    QST.CODMATERIA = COND.CODMATERIA
    
    LEFT JOIN BHISTRESPPROVA 			RES (NOLOCK) ON 
    RES.CODCOLIGADA = HIS.CODCOLIGADA AND 
    RES.CODPROVA    = HIS.CODPROVA    AND 
    RES.CODQUESTAO = HIS.CODQUESTAO AND 
    RES.CODAREA = HIS.CODAREA AND 
    RES.CODMATERIA = HIS.CODMATERIA AND 
    RES.ID	    = HIS.ID
        
    LEFT JOIN BMEMO                 	AB  (NOLOCK) ON 
    AB.ID = RES.IDMEMORESPABERTA

Where his.CODUSUARIOPS = 645
*/

WHERE	HIS.DATAHORAFIM IS NOT NULL
	AND HIS.RECMODIFIEDBY = :CORRETOR
	AND HIS.RECMODIFIEDON > :DATAINICIAL
	AND HIS.RECMODIFIEDON < :DATAFINAL

ORDER BY USU.NOME";3067;;;;01/06/2021;lucas.ssantos;1;1;1;1;;;;0;51aa3ad0-8988-4176-a407-7f31b5550bef;0;;32121;lucas.ssantos;27/05/2021;lucas.ssantos;01/06/2021;0
S;PS.002;Verificação da documentação;"SELECT 
	SDE.IDPS,
	SDE.CODUSUARIOPS,
	SDE.CODDOCUMENTO,
	SDE.MOTIVO,
	CASE WHEN SDE.ENTREGUE = 'T' THEN 'OK' ELSE 'X' END STATUS,	
	CASE WHEN (SDE.ENTREGUE = 'T' OR SDE.MOTIVO IS NOT NULL) THEN 1 ELSE 0 END TOTAL	
	
FROM SPSDOCUMENTOENTREGUE SDE

WHERE
	SDE.RECMODIFIEDBY = :UsuarioVerificador
	AND SDE.CODDOCUMENTO = :CODDOCUMENTO
	AND SDE.RECMODIFIEDON > :DATAINICIAL
	AND SDE.RECMODIFIEDON < :DATAFINAL		
	AND (SDE.ENTREGUE = 'T' OR SDE.MOTIVO IS NOT NULL)";475;;;;07/10/2021;lucas.ssantos;1;1;1;1;;;;0;d2ce062a-c2ed-43b9-9d57-9293d03d08e1;0;;-5679;lucas.ssantos;06/10/2021;lucas.ssantos;07/10/2021;0
S;PS.REL.COMP;Comprovante - ProcessoSeletivo;"SELECT DISTINCT
	s1.NOME,
	UPPER(s.NUMEROINSCRICAO) [NÚMERO DE INSCRIÇÃO],
	UPPER(s4.NOME) CURSO,
	UPPER(g.NOMEFANTASIA) CAMPUS,
	ISNULL ((s1.CPF + ' - CPF'),(s1.NPASSAPORTE + ' - Passaporte')) [DOCUMENTO DE IDENTIFICAÇÃO],
	UPPER(s6.NOME) [TIPO DE AVALIAÇÃO],
	'go.unasp.br/prova' [PGTO],
	/*CASE WHEN s.status ='1' AND s.IDFORMAINSCRICAO <> 2 THEN  
	'https://go.unasp.br/avaliacao?codigo=' +CAST((b.idexecprova) AS VARCHAR(132) )
    WHEN s.IDFORMAINSCRICAO = 2 THEN 'OPÇÃO ESCOLHIDA : ENEM'
	ELSE  'PENDENTE PAGAMENTO'  
	END*/
	b.idexecprova	[INSCRICAO],
	g.email,
	s4.idareainteresse areaid,
	s4.nome areanome,
	case when s5.nome like '%diploma%' or s5.nome like '%transfer%' then 1 else 0 end diploTransf 
	
FROM 
	SPSINSCRICAOAREAOFERTADA s
	LEFT JOIN SPSUSUARIO s1 ON s.CODUSUARIOPS = s1.CODUSUARIOPS
	LEFT JOIN BEXECPROVA b  ON b.CODUSUARIOPS = s1.CODUSUARIOPS
	LEFT JOIN SPSOPCAOINSCRITO s2 ON s.CODCOLIGADA = s2.CODCOLIGADA AND s.IDPS = s2.IDPS AND s.NUMEROINSCRICAO = s2.NUMEROINSCRICAO
	LEFT JOIN SPSAREAOFERTADA s3 ON s2.CODCOLIGADA = s3.CODCOLIGADA AND s2.IDPS = s3.IDPS AND s2.IDAREAINTERESSE = s3.IDAREAINTERESSE
	LEFT JOIN SPSAREAINTERESSE s4 ON s3.IDAREAINTERESSE = s4.IDAREAINTERESSE
	LEFT JOIN SPSPROCESSOSELETIVO s5 ON s.IDPS=s5.IDPS
	LEFT JOIN GFILIAL g ON s5.CODFILIALLAN=g.CODFILIAL
	LEFT JOIN SPSFORMAINSCRICAOPS s6 ON s.IDFORMAINSCRICAO=s6.IDFORMAINSCRICAO AND s.IDPS = S6.IDPS
	LEFT JOIN PPESSOA S7 ON  s1.CPF = s7.CPF
	LEFT JOIN SALUNO s8 ON s7.CODIGO = s8.CODPESSOA
	
	
WHERE
	s.NUMEROINSCRICAO = :NUMEROINSCRICAO1
	AND s.IDPS = :IDPS1
	";1597;;;;24/09/2021;lucas.ssantos;1;1;1;1;;;;0;ff1c494d-ce34-489b-9813-9e473cb70060;0;;-10691;maycon;21/01/2021;lucas.ssantos;24/09/2021;0
S;PSRELCOMP.001;Valida se aluno é diplomado ou transferencia;"select
	1 retorno
from SPSPROCESSOSELETIVO
where (nome like '%diploma%' or nome like '%transfer%') 
	AND IDPS = :IDPS1
	";125;;;;23/09/2021;lucas.ssantos;1;1;1;1;;;;0;d7d55332-bf86-40bf-9533-862c5b84009d;0;;8714;lucas.ssantos;21/09/2021;lucas.ssantos;23/09/2021;0
S;RankingProva;Ranking da prova por Etapa;"SELECT 
	row_number() over(order by ISNULL(SUM(CONVERT(INT, NOTAOBTIDA)),9999) desc) Ordem,
	oi.NUMEROINSCRICAO,
	u.NOME,
	n.DESCRICAO Nacionalidade,
	ISNULL(SUM(CONVERT(INT, NOTAOBTIDA)),9999) AS NOTA , eao.nome FASE
FROM 
	SPSOPCAOINSCRITO 						(NOLOCK) oi
	INNER JOIN SPSINSCRICAOAREAOFERTADA		(NOLOCK) iao	ON iao.IDPS=oi.IDPS and iao.NUMEROINSCRICAO=oi.NUMEROINSCRICAO
	INNER JOIN SPSUSUARIO					(NOLOCK) u		ON u.CODUSUARIOPS=iao.CODUSUARIOPS
	INNER JOIN SPSETAPAAREAOFERTADA			(NOLOCK) eao	ON oi.CODCOLIGADA = eao.CODCOLIGADA AND oi.IDPS = eao.IDPS AND oi.IDAREAINTERESSE = eao.IDAREAINTERESSE 
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA	(NOLOCK) heao	ON eao.IDETAPA = heao.IDETAPA AND eao.IDAREAINTERESSE = heao.IDAREAINTERESSE AND eao.IDPS = heao.IDPS AND eao.CODCOLIGADA = heao.CODCOLIGADA 
	INNER JOIN SPSPROVAETAPAAREA			(NOLOCK) pea	ON heao.CODCOLIGADA = pea.CODCOLIGADA AND heao.IDPS = pea.IDPS AND heao.IDAREAINTERESSE = pea.IDAREAINTERESSE AND heao.IDETAPA = pea.IDETAPA AND heao.IDHORARIO = pea.IDHORARIO 
	INNER JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK) cdp	ON cdp.CODCOLIGADA = pea.CODCOLIGADA AND cdp.IDPS = pea.IDPS AND cdp.IDAREAINTERESSE = pea.IDAREAINTERESSE AND cdp.IDETAPA = pea.IDETAPA AND cdp.CODCOLIGADAPROVA = pea.CODCOLIGADAPROVA AND cdp.CODPROVA = pea.CODPROVA AND cdp.IDHORARIO = pea.IDHORARIO AND cdp.NUMEROINSCRICAO = oi.NUMEROINSCRICAO
	INNER JOIN BHISTORICO					(NOLOCK) h		ON h.CODCOLIGADA = pea.CODCOLIGADA AND h.CODPROVA = pea.CODPROVA AND h.CODUSUARIOPS = oi.CODUSUARIOPS AND cdp.IDPROVA = h.ID
	left join  PCODNACAO					(NOLOCK) n		on n.CODCLIENTE = u.NACIONALIDADE
WHERE 
	oi.IDPS = :IDPS
	and eao.nome like '%' + :Etapa + '%'
	AND oi.CODCOLIGADA = 1
group by
	oi.NUMEROINSCRICAO,
	u.NOME,
	n.DESCRICAO,
	eao.nome
order by ISNULL(SUM(CONVERT(INT, NOTAOBTIDA)),9999) desc";1835;;;;01/11/2021;lilian.buzetti;1;1;1;1;;;;0;b3ad1e95-9f26-4af1-8b5e-df5268afea6c;0;;9028;mestre;26/10/2021;lilian.buzetti;01/11/2021;0
S;RECEB.SERV;Relatório de Recebimento por Serviço;"SELECT DISTINCT
 FLAN.CODCOLIGADA,
 FLAN.IDLAN,
 SCONTRATO.CODFILIAL FILIAL,
 SCONTRATO.CODTIPOCURSO 'NÍVEL ENSINO',
 SPLETIVO.CODPERLET 'PERÍODO LETIVO',
 SALUNO.RA,
 PPESSOA.NOME ALUNO,
 SCURSO.NOME CURSO,
 STURMA.CODTURMA TURMA,
 SSERVICO.NOME SERVIÇO,
 SPARCELA.PARCELA,
 SPARCELA.VALOR,
 
 CASE WHEN FLAN.STATUSLAN = '0' THEN 'Em Aberto'
 	  WHEN FLAN.STATUSLAN = '1' THEN 'Baixado'
 	  WHEN FLAN.STATUSLAN = '2' THEN 'Cancelado'
 	  WHEN FLAN.STATUSLAN = '3' THEN 'Baixado por Acordo'
 	  WHEN FLAN.STATUSLAN = '4' THEN 'Baixado Parcialmente'
 	  WHEN FLAN.STATUSLAN = '5' THEN 'Borderô' END STATUS,

 FLANBAIXA.DATABAIXA,
 FLANBAIXA.VALORBAIXA

FROM
 SPARCELA (NOLOCK)
 
 INNER JOIN SPLETIVO (NOLOCK)			ON SPLETIVO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND
 									   	   SPLETIVO.IDPERLET = SPARCELA.IDPERLET
 									   
 INNER JOIN SCONTRATO (NOLOCK)			ON SCONTRATO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 									   	   SCONTRATO.RA = SPARCELA.RA AND 
 									   	   SCONTRATO.CODCONTRATO = SPARCELA.CODCONTRATO AND 
 									   	   SCONTRATO.IDPERLET = SPARCELA.IDPERLET

 INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND
 										   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
 
 INNER JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
 										   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO 										   

 INNER JOIN SMATRICPL (NOLOCK)			ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SMATRICPL.IDPERLET = SCONTRATO.IDPERLET AND 
 										   SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL AND 
 										   SMATRICPL.RA = SCONTRATO.RA 										   
 										   
 INNER JOIN STURMA (NOLOCK)				ON STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
 										   STURMA.CODFILIAL = SMATRICPL.CODFILIAL AND
 										   STURMA.CODTURMA = SMATRICPL.CODTURMA AND
 										   STURMA.IDPERLET = SMATRICPL.IDPERLET 

 INNER JOIN SALUNO (NOLOCK)				ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND 
 										   SALUNO.RA = SCONTRATO.RA
 										   
 INNER JOIN PPESSOA (NOLOCK)			ON PPESSOA.CODIGO = SALUNO.CODPESSOA  										   
 
 INNER JOIN SSERVICO (NOLOCK)			ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 										   SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
 
 LEFT JOIN SLAN (NOLOCK)				ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND 
 										   SLAN.IDPARCELA = SPARCELA.IDPARCELA
 										   
 LEFT JOIN FLAN (NOLOCK)				ON FLAN.CODCOLIGADA = SLAN.CODCOLIGADA AND
 										   FLAN.IDLAN = SLAN.IDLAN AND
 										   FLAN.STATUSLAN <> 2
 										   
 LEFT JOIN FLANBAIXA (NOLOCK)			ON FLANBAIXA.CODCOLIGADA = FLAN.CODCOLIGADA AND
 										   FLANBAIXA.IDLAN = FLAN.IDLAN AND
 										   FLANBAIXA.STATUS <> 1
 										    										   
WHERE	SPARCELA.CODCOLIGADA = 1
	AND SPARCELA.DTVENCIMENTO >= :Vencto_Início_D
	AND SPARCELA.DTVENCIMENTO <= :Vencto_Fim_D
	AND SCONTRATO.CODFILIAL LIKE :Filial_S
	AND SSERVICO.NOME LIKE :Serviço_S + '%'
	
ORDER BY SALUNO.RA	";3146;;;;07/06/2022;robson.canto;1;1;1;1;;;;1;9baf3b64-89a1-416b-ad45-2600e752549a;0;;14208;robson.canto;07/06/2022;robson.canto;07/06/2022;0
S;REL.EDU.ESPDIVER;ESPAÇO DIVERSIFICADO;"SELECT DATA,LICAOCASA,SDISCIPLINA.NOME
	FROM SPLANOAULA
		INNER JOIN STURMADISC (NOLOCK) ON
			STURMADISC.IDTURMADISC = SPLANOAULA.IDTURMADISC
		INNER JOIN SDISCIPLINA (NOLOCK) ON
			SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
WHERE SPLANOAULA.IDTURMADISC = :IDTURMADISC
AND LICAOCASA IS NOT NULL 
AND LICAOCASA != ''";379;;;;21/02/2022;consultor1.totvs;1;1;1;1;;;;0;646687d7-9d72-43b7-a1d5-c1d4bfc3fa0b;0;;25240;consultor1.totvs;12/01/2022;consultor1.totvs;21/02/2022;0
S;RelAditamento;Relatório para Aditamento;"Select 
	NomFilial, 
	left(codperlet,4) Ano, 
	CODPERLET,
	NomCurso,
	NomTurno, 
	CodTurma,
	NomTurma,
	NomStatus,
	mpl.RA,
	NomPessoa,
	CPF,
	mpl.DTNASCIMENTO,
	CODINEPALUNO,
	CEBAS100,
	PROUNI100,
	CEBAS50,
	PROUNI50,
	b.Dissidio100,
	b.Dissidio70,
	b.Dissidio50,
	ingresso.Ingresso,
	f.Nome Responsavel,
	f.CGCCFO CPF,
	NomtipoCurso,
	mpl.NomCampus Polo
from 
	v_unasp_Smatricpl mpl	
	inner join SALUNO a on a.CODCOLIGADA = mpl.CODCOLIGADA and a.RA=mpl.RA
	inner join FCFO f on f.CODCFO=a.CODCFO
	left join (
		Select  c.CODCOLIGADA, c.IDPERLET, c.IDHABILITACAOFILIAL, c.RA, 
			sum(case when bl.codbolsa in (1) then bl.VALOR end) CEBAS100,
			sum(case when bl.codbolsa in (3) then bl.VALOR end) PROUNI100,
			sum(case when bl.codbolsa in (2) then bl.VALOR end) CEBAS50,
			sum(case when bl.codbolsa in (4) then bl.VALOR end) PROUNI50,
			sum(case when bl.codbolsa in (10,143,144) then bl.VALOR end) Dissidio100,
			sum(case when bl.codbolsa in (142,145) then bl.VALOR end) Dissidio70,
			sum(case when bl.codbolsa in (141) then bl.VALOR end) Dissidio50

		from SBOLSALAN bl 
			inner join SPLETIVO pl on pl.IDPERLET=bl.IDPERLET 
			inner join sparcela p on p.CODCOLIGADA = bl.CODCOLIGADA and p.IDPARCELA=bl.IDPARCELA
			inner join SCONTRATO c on c.CODCOLIGADA = p.CODCOLIGADA and c.CODCONTRATO = p.CODCONTRATO
		Where 
			bl.codbolsa in (1,2,3,4,10,141,142,143,144,145)
		Group By 
			c.CODCOLIGADA, c.IDPERLET, c.IDHABILITACAOFILIAL, c.RA
		) b on mpl.CODCOLIGADA = b.CODCOLIGADA and mpl.IDPERLET=b.IDPERLET and mpl.IDHABILITACAOFILIAL=b.IDHABILITACAOFILIAL and mpl.RA=b.RA
	left join (	
		Select 
			mpl.CODCOLIGADA, mpl.IDHABILITACAOFILIAL, mpl.RA, min(CODPERLET) Ingresso from SMATRICPL mpl inner join SPLETIVO pl on pl.IDPERLET=mpl.IDPERLET
		group by 
			mpl.CODCOLIGADA, mpl.IDHABILITACAOFILIAL, mpl.RA) Ingresso on Ingresso.CODCOLIGADA=mpl.CODCOLIGADA and Ingresso.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and Ingresso.RA=mpl.RA

 where 
 	codperlet in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' ))
 	and mpl.CODTIPOCURSO = 1 
 	and mpl.nomcurso not like 'Pensionato%'



";2165;;;;28/06/2022;isaldo;1;1;1;1;;;;0;eb5f8758-b58c-42b9-988b-b33eb98fd453;0;;5278;isaldo;20/06/2022;isaldo;28/06/2022;0
S;RELALUNO.10;Carteirinha Estudante;"select
	NomPessoa NOME, 
	NomCurso, 
	mpl.RA, 
	img.IMAGEM imgFundo, 
	img.info,
	gi.IMAGEM imgAluno,
	ValidadeCarteirinha validade,
	mpl.IDHABILITACAOFILIAL,
	mpl.IDPERLET,
	nomStatus Status,
	
	case 
		when mpl.codfilial = 1 then 'São Paulo'
		when mpl.codfilial = 2 then 'Engenheiro Coelho'
		when mpl.codfilial = 3 then 'Hortolândia'
		when mpl.codfilial = 4 then 'EAD'
	end campus,
	
	ac.CODCRACHA,
	upper(:ComBarra) comBarra
	
from 
	v_Unasp_SMATRICPL mpl
	left join SALUNOCOMPL ac on ac.CODCOLIGADA=mpl.CODCOLIGADA and ac.RA = mpl.RA
	inner join SPLETIVO PL ON pl.CODCOLIGADA=mpl.CODCOLIGADA AND pl.IDPERLET=mpl.IDPERLET
	inner join ZMDIMAGEMCARTEIRINHA img on img.CODCOLIGADA = mpl.CODCOLIGADA and img.CODFILIAL = mpl.CODFILIAL
	left join GIMAGEM gi on gi.ID = mpl.IDIMAGEM

where 
	mpl.RA = :RA1
	And mpl.CODCOLIGADA = :CODCOLIGADA1
	AND mpl.IDPERLET = :IDPERLET1
	And mpl.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
	And (NomStatus = 'Cursando' Or NomStatus = 'Trancado')";1015;;;;07/07/2022;isaldo;1;1;1;1;;;;0;bec9e29b-b320-4367-8e92-ee56f097d769;0;;-2244;lucas.ssantos;04/11/2021;isaldo;07/07/2022;0
S;RELALUNO.11;Carteirinha Avulsa Aluno;"Select CODCOLIGADA, RA, Nome from v_unasp_aluno
where 
	RA = :RA";66;;;;11/07/2022;isaldo;1;1;1;1;;;;0;5fa1d27b-47f3-4ec0-b5d5-697197fc2dce;0;;-26454;isaldo;11/07/2022;isaldo;11/07/2022;0
S;Rematric_Inadimp;Lista de Alunos para Rematricula Check Inadimplência;"Select 
	SMATRICPL.CODCOLIGADA, 
	SMATRICPL.IDPERLET, 
	SMATRICPL.CODSTATUS, 
	SALUNO.RA, 
	SMATRICPL.IDHABILITACAOFILIAL, 
	PPESSOA.NOME, 
	SMATRICPL.CODTURMA
from 
	SMATRICPL						(nolock)
	inner join SPLETIVO				(nolock) on SPLETIVO.CODCOLIGADA=SMATRICPL.CODCOLIGADA and SPLETIVO.IDPERLET=SMATRICPL.IDPERLET
	inner join SSTATUS				(nolock) on SSTATUS.CODCOLIGADA=SMATRICPL.CODCOLIGADA and SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
	inner join SALUNO				(nolock) on SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA and SALUNO.RA=SMATRICPL.RA
	inner join PPESSOA				(nolock) on PPESSOA.CODIGO = SALUNO.CODPESSOA
	inner join SHABILITACAOFILIAL	(nolock) on SHABILITACAOFILIAL.CODCOLIGADA = SMATRICPL.CODCOLIGADA and SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	inner join scurso               (NOLOCK) on scurso.codcoligada = SHABILITACAOFILIAL.CODCOLIGADA and scurso.codcurso = SHABILITACAOFILIAL.CODCURSO
	left join	(
					SELECT distinct
						pa.CODCOLIGADA, pa.RA
					FROM 
						FLAN				(nolock) fl
						inner join SLAN		(nolock) sl		on sl.CODCOLIGADA = fl.CODCOLIGADA and sl.IDLAN = fl.IDLAN
						inner join SPARCELA	(nolock) pa		on pa.CODCOLIGADA = sl.CODCOLIGADA and pa.IDPARCELA=sl.IDPARCELA
					Where	
						fl.STATUSLAN in (0,4)
						and fl.CODTDO in ('ACORD_EXT','ACORD_JUD','MENS', 'PENS')
						and fl.DATAVENCIMENTO < convert(date, GETDATE())
				) f on f.CODCOLIGADA=SALUNO.CODCOLIGADA and f.RA = SALUNO.RA
where 
	SMATRICPL.CODFILIAL = :CODFILIAL 
	and SHABILITACAOFILIAL.CODTIPOCURSO = :CODTIPOCURSO
	and SPLETIVO.CODPERLET = :CODPERLET_S
	and SSTATUS.DESCRICAO in ( select Id from dbo.splitStringToTable( :StatusAlunoPL, ',' ))
	and case when f.RA is null then 'N' else 'S' end = :Inadimplente_SN
	and SCURSO.NOME NOT LIKE '%pensionato%'
	and SMATRICPL.RA like :RA";1842;;;;01/11/2022;consultor1.totvs;1;1;1;1;;;;0;c9a1c53e-eb9a-470e-a2b3-098ce2607407;0;;-11480;isaldo;24/10/2022;consultor1.totvs;01/11/2022;0
S;rematricula;Rematricula - alunos cursando (Não Pensionato);"
SELECT DISTINCT
/*TOP 500 (SMATRICPL.RA),*/
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA,
SMATRICPL.IDHABILITACAOFILIAL,
SMATRICPL.CODTURMA,
PPESSOA.NOME

FROM SMATRICPL
INNER JOIN STIPOMATRICULA ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN STURMA ON STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STURMA.CODTURMA = SMATRICPL.CODTURMA
	AND STURMA.IDPERLET = SMATRICPL.IDPERLET
	AND STURMA.CODFILIAL = SMATRICPL.CODFILIAL



OUTER APPLY(

SELECT 
	SP.CODPERLET,
	STPROX.*
FROM STURMA STPROX
INNER JOIN SPLETIVO SP ON SP.CODCOLIGADA = STPROX.CODCOLIGADA
	AND SP.IDPERLET = STPROX.IDPERLET
WHERE 
	STPROX.CODCOLIGADA = STURMA.CODCOLIGADA
	AND STPROX.CODTURMA = STURMA.CODTURMAPROX
	AND SP.IDPERLETANT = SPLETIVO.IDPERLET

	) AS A
	
	
	
	/*Consulta pega pelo Profile que o Sistema executa para pegar as disciplinas para vincular ao aluno*/
OUTER APPLY(

SELECT  STURMADISC.CODCOLIGADA,
                        STURMADISC.IDTURMADISC,
                        STURMADISC.CODTURMA,
                        STURMADISC.IDPERLET,
                        STURMADISC.IDHABILITACAOFILIAL,
                        SDISCIPLINA.CODDISC,
                        SDISCIPLINA.NOME,
                        SDISCIPLINA.NUMCREDITOS,
                        SMATRICULA.CODSTATUS,
                        SMATRICULA.CODSUBTURMA,
                        SMATRICULA.NUMDIARIO,
                        SMATRICULA.TIPOMAT,
                        SDISCGRADE.NUMCREDITOSCOB,
                        0 SELECIONADO,
                        SDISCGRADE.TIPODISC,
                        SDISCIPLINA.CH,
                        STURMADISC.CODFILIAL,
                        SDISCGRADE.CODPERIODO,
                        SPERIODO.DESCRICAO
                FROM    STURMADISC (NOLOCK)
                        JOIN SDISCIPLINA (NOLOCK)
                                ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
                                   AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
                        LEFT    JOIN (SELECT  CODCOLIGADA,
                                      IDTURMADISC,
                                      CODSTATUS,
                                      CODSUBTURMA,
                                      NUMDIARIO,
                                      TIPOMAT,
                                      NUMCREDITOSCOB
                              FROM   SMATRICULA (NOLOCK)
                              WHERE  CODCOLIGADA = 1
                                      AND RA = SMATRICPL.RA) SMATRICULA
                          ON ( STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                              AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC )
                          LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
                            ON ( STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL )
                          LEFT JOIN SGRADE (NOLOCK)
                            ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
                                AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
                                AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
                                AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE )
                          LEFT JOIN SDISCGRADE (NOLOCK)
                            ON ( SGRADE.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
                                AND SGRADE.CODCURSO = SDISCGRADE.CODCURSO
                                AND SGRADE.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
                                AND SGRADE.CODGRADE = SDISCGRADE.CODGRADE
                                AND STURMADISC.CODDISC = SDISCGRADE.CODDISC )                           
                           LEFT JOIN SPERIODO (NOLOCK)
                             ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
			                          AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO
			                          AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
			                          AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE
			                          AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
			                          
			           LEFT JOIN (
					SELECT  SMATRICULA.CODCOLIGADA,
                                      SMATRICULA.IDTURMADISC,
                                      SMATRICULA.CODSTATUS,
                                      CODSUBTURMA,
                                      NUMDIARIO,
                                      TIPOMAT,
									  SMATRICULA.RA,

									  SMATRICULA.IDHABILITACAOFILIAL,
									STURMADISC.CODDISC,
                                      SMATRICULA.NUMCREDITOSCOB
                              FROM   SMATRICULA (NOLOCK)
									INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
										AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
									LEFT JOIN SHISTDISCPENDENTES ON SHISTDISCPENDENTES.CODCOLIGADA = SMATRICULA.CODCOLIGADA
									AND SHISTDISCPENDENTES.RA = SMATRICULA.RA
									AND SHISTDISCPENDENTES.CODDISC = STURMADISC.CODDISC
									AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL		
									LEFT JOIN SHISTDISCCONCLUIDAS ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
									AND SHISTDISCCONCLUIDAS.RA = SMATRICULA.RA
									AND SHISTDISCCONCLUIDAS.CODDISC = STURMADISC.CODDISC
									AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
									
                              WHERE  SMATRICULA.CODCOLIGADA = 1
                                      AND SMATRICULA.RA = SMATRICPL.RA
									   AND (SHISTDISCPENDENTES.CODCOLIGADA IS NOT NULL OR SHISTDISCCONCLUIDAS.CODCOLIGADA IS NOT NULL)
									  
									  ) VALIDACAO
									  ON VALIDACAO.CODCOLIGADA = STURMADISC.CODCOLIGADA
										AND VALIDACAO.CODDISC = STURMADISC.CODDISC  
										
										
						    OUTER APPLY (
					SELECT  SHISTDISCCONCLUIDAS.CODCOLIGADA,
									  SHISTDISCCONCLUIDAS.RA,
									SHISTDISCCONCLUIDAS.CODDISC
                              FROM  SHISTDISCCONCLUIDAS (NOLOCK)
                              WHERE  SHISTDISCCONCLUIDAS.CODCOLIGADA = STURMADISC.CODCOLIGADA
							  AND SHISTDISCCONCLUIDAS.CODDISC = STURMADISC.CODDISC
							  AND SHISTDISCCONCLUIDAS.RA = SMATRICPL.RA
									  
									  ) VALIDACAOCONC
									  
		
			                          
			                          
                WHERE  STURMADISC.CODCOLIGADA = 1
                       AND STURMADISC.CODFILIAL = SMATRICPL.CODFILIAL
                       AND STURMADISC.CODTURMA = STURMA.CODTURMAPROX
                       AND STURMADISC.IDPERLET = A.IDPERLET
                       /*MODIFICADO EM 08/11/2022 NATHAN PVT - ADICIONADO VALIDAÇÃO PARA CONSIDERAR APENAS DAS TURMAS DA HABILITACAO DO ALUNO, 
                       ESTAVA PEGANDO TURMAS COM O MESMO CÓDIGO PORÉM ESTAVA EM HABILITACAO DIFERENTE*/
                       AND STURMADISC.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
                       /**/
                       AND STURMADISC.GERENCIAL <> 'S'
                       AND VALIDACAOCONC.CODCOLIGADA IS NULL
                       AND VALIDACAO.CODCOLIGADA IS NULL
                       AND STURMADISC.ATIVA = 'S'
                       AND (SDISCIPLINA.ITINERARIOFORMATIVO IS NULL OR SDISCIPLINA.ITINERARIOFORMATIVO <> 'S')  AND ((STURMADISC.DTINICIOMATPRES IS NULL AND STURMADISC.DTFIMMATPRES IS NULL) OR
                                          (GETDATE() BETWEEN STURMADISC.DTINICIOMATPRES AND STURMADISC.DTFIMMATPRES)) 

) AS B
	
	
/*
OUTER APPLY(

Select 
	SMATRICPL.CODCOLIGADA, 
	SMATRICPL.IDPERLET, 
	SMATRICPL.CODSTATUS, 
	SALUNO.RA, 
	SMATRICPL.IDHABILITACAOFILIAL, 
	PPESSOA.NOME, 
	SMATRICPL.CODTURMA
from 
	SMATRICPL	SMP		(nolock)
	inner join SPLETIVO	SP			(nolock) on SP.CODCOLIGADA=SMP.CODCOLIGADA and SP.IDPERLET=SMP.IDPERLET
	inner join SSTATUS	SS			(nolock) on SS.CODCOLIGADA=SMP.CODCOLIGADA and SS.CODSTATUS = SMATRICPL.CODSTATUS
	inner join SALUNO	SA			(nolock) on SA.CODCOLIGADA = SMP.CODCOLIGADA and SA.RA=SMP.RA
	inner join PPESSOA	PP			(nolock) on PP.CODIGO = SA.CODPESSOA
	inner join SHABILITACAOFILIAL SHF	(nolock) on SHF.CODCOLIGADA = SMP.CODCOLIGADA and SHF.IDHABILITACAOFILIAL = SMP.IDHABILITACAOFILIAL
	inner join scurso SC              (NOLOCK) on SC.codcoligada = SHF.CODCOLIGADA and SC.codcurso = SHF.CODCURSO
	left join	(
					SELECT distinct
						pa.CODCOLIGADA, pa.RA
					FROM 
						FLAN				(nolock) fl
						inner join SLAN		(nolock) sl		on sl.CODCOLIGADA = fl.CODCOLIGADA and sl.IDLAN = fl.IDLAN
						inner join SPARCELA	(nolock) pa		on pa.CODCOLIGADA = sl.CODCOLIGADA and pa.IDPARCELA=sl.IDPARCELA
					Where	
						fl.STATUSLAN in (0,4)
						and fl.CODTDO in ('ACORD_EXT','ACORD_JUD','MENS', 'PENS')
						and fl.DATAVENCIMENTO < convert(date, GETDATE())
				) f on f.CODCOLIGADA=SALUNO.CODCOLIGADA and f.RA = SALUNO.RA
where 
	SMP.CODFILIAL = :FILIAL
	and SHF.CODTIPOCURSO = :CODTIPOCURSO
	and SP.CODPERLET = :PERIODOLETIVO
	and SS.DESCRICAO in ( select Id from dbo.splitStringToTable( :StatusAlunoPL, ',' ))
	and case when f.RA is null then 'N' else 'S' end = :Inadimplente_SN
	and SC.NOME NOT LIKE '%pensionato%'
	AND SMP.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SMP.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SMP.RA = SMATRICPL.RA
	AND SMP.IDPERLET = SMATRICPL.IDPERLET
) AS C
*/
WHERE SMATRICPL.CODSTATUS IN (2, 23 , 27)
AND SMATRICPL.CODFILIAL =:FILIAL_N
AND SPLETIVO.CODPERLET =:PERIODOLETIVO_S
AND SHABILITACAOFILIAL.CODTIPOCURSO =:CODTIPOCURSO_N
AND SHABILITACAOFILIAL.CODCURSO NOT IN ('EC-GPENS','HT-GPENS','SP-GPENS')
AND A.CODCOLIGADA IS NOT NULL
AND B.CODCOLIGADA IS NOT NULL
AND STIPOMATRICULA.DESCRICAO IN ('Rematrícula','Matrícula')

AND SMATRICPL.RA NOT IN ( SELECT RA FROM SMATRICPL 
						  INNER JOIN SPLETIVO PL ON 
						  PL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
						  PL.IDPERLET = SMATRICPL.IDPERLET
						  INNER JOIN SHABILITACAOFILIAL ON 
						  SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
						  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
						  WHERE PL.IDPERLETANT = SPLETIVO.IDPERLET
						  AND SHABILITACAOFILIAL.CODCURSO NOT IN ('EC-GPENS','HT-GPENS','SP-GPENS', 'SP-LEFIS','SP-BEFIS','SP-BCBIO','SP-LCBIO'))";11112;;;;10/11/2022;consultor1.totvs;1;1;1;1;;;;0;3f36aca7-7aec-4d2e-87f8-7670f3e97583;0;;-3016;mestre;10/06/2021;consultor1.totvs;10/11/2022;0
S;rematricula.1;Rematricula - alunos cursando (Pensionato- Graduação);"
SELECT 
/*TOP 500 (SMATRICPL.RA),*/
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA,
SMATRICPL.IDHABILITACAOFILIAL,
CODTURMA,
NOME

FROM SMATRICPL
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE CODSTATUS IN (2, 23 , 27)
AND SMATRICPL.CODFILIAL =:FILIAL
AND SPLETIVO.CODPERLET =:PERIODOLETIVO
AND SHABILITACAOFILIAL.CODCURSO IN ('EC-GPENS','HT-GPENS','SP-GPENS')

/*AND SMATRICPL.RA NOT IN ( SELECT RA FROM SMATRICPL 
						  INNER JOIN SPLETIVO PL ON 
						  PL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
						  PL.IDPERLET = SMATRICPL.IDPERLET
						  WHERE PL.IDPERLETANT = SPLETIVO.IDPERLET)*/";990;;;;20/06/2021;mestre;1;1;1;1;;;;0;3f36aca7-7aec-4d2e-87f8-7670f3e97583;0;;24386;mestre;14/06/2021;mestre;20/06/2021;0
S;rematricula.2;Rematricula - alunos cursando (Pensionato- Pós Graduação);"
SELECT 
/*TOP 500 (SMATRICPL.RA),*/
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA,
SMATRICPL.IDHABILITACAOFILIAL,
CODTURMA,
NOME

FROM SMATRICPL
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE CODSTATUS IN (2, 23 , 27)
AND SMATRICPL.CODFILIAL =:FILIAL
AND SPLETIVO.CODPERLET =:PERIODOLETIVO
AND SHABILITACAOFILIAL.CODTIPOCURSO=:TIPOCURSO
AND SHABILITACAOFILIAL.CODCURSO IN (
'HT-PPENS',
'EC-PPENS',
'SP-PPENS')

AND SMATRICPL.RA NOT IN ( SELECT RA FROM SMATRICPL 
						  INNER JOIN SPLETIVO PL ON 
						  PL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
						  PL.IDPERLET = SMATRICPL.IDPERLET
						  WHERE PL.IDPERLETANT = SPLETIVO.IDPERLET)";1040;;;;15/06/2021;mestre;1;1;1;1;;;;0;3f36aca7-7aec-4d2e-87f8-7670f3e97583;0;;22853;mestre;15/06/2021;mestre;15/06/2021;0
S;rematricula.3;Rematricula - alunos cursando (Não pensionato) HT;"
SELECT 
/*TOP 500 (SMATRICPL.RA),*/
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA,
SMATRICPL.IDHABILITACAOFILIAL,
CODTURMA,
NOME

FROM SMATRICPL
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
WHERE CODSTATUS IN (2, 23 , 27)
AND SMATRICPL.CODFILIAL =:FILIAL
AND SPLETIVO.CODPERLET =:PERIODOLETIVO
AND SHABILITACAOFILIAL.CODTIPOCURSO =:CODTIPOCURSO
AND SHABILITACAOFILIAL.CODCURSO NOT IN ('EC-GPENS','HT-GPENS','SP-GPENS')

";809;;;;16/06/2021;mestre;1;1;1;1;;;;0;3f36aca7-7aec-4d2e-87f8-7670f3e97583;0;;28347;mestre;16/06/2021;mestre;16/06/2021;0
S;rematricula.4;Rematricula - alunos cursando (EAD);"
SELECT DISTINCT
/*TOP 500 (SMATRICPL.RA),*/
SMATRICPL.RA,
SMATRICPL.CODCOLIGADA,
SMATRICPL.IDHABILITACAOFILIAL,
SMATRICPL.CODTURMA,
PPESSOA.NOME

FROM SMATRICPL
INNER JOIN STIPOMATRICULA ON STIPOMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STIPOMATRICULA.CODTIPOMAT = SMATRICPL.CODTIPOMAT
INNER JOIN SHABILITACAOFILIAL ON SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SALUNO.RA = SMATRICPL.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN STURMA ON STURMA.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND STURMA.CODTURMA = SMATRICPL.CODTURMA
	AND STURMA.IDPERLET = SMATRICPL.IDPERLET
	AND STURMA.CODFILIAL = SMATRICPL.CODFILIAL



OUTER APPLY(

SELECT 
	SP.CODPERLET,
	STPROX.*
FROM STURMA STPROX
INNER JOIN SPLETIVO SP ON SP.CODCOLIGADA = STPROX.CODCOLIGADA
	AND SP.IDPERLET = STPROX.IDPERLET
WHERE 
	STPROX.CODCOLIGADA = STURMA.CODCOLIGADA
	AND STPROX.CODTURMA = STURMA.CODTURMAPROX
	AND SP.IDPERLETANT = SPLETIVO.IDPERLET

	) AS A
	
	
	
	/*Consulta pega pelo Profile que o Sistema executa para pegar as disciplinas para vincular ao aluno*/
OUTER APPLY(

SELECT  STURMADISC.CODCOLIGADA,
                        STURMADISC.IDTURMADISC,
                        STURMADISC.CODTURMA,
                        STURMADISC.IDPERLET,
                        STURMADISC.IDHABILITACAOFILIAL,
                        SDISCIPLINA.CODDISC,
                        SDISCIPLINA.NOME,
                        SDISCIPLINA.NUMCREDITOS,
                        SMATRICULA.CODSTATUS,
                        SMATRICULA.CODSUBTURMA,
                        SMATRICULA.NUMDIARIO,
                        SMATRICULA.TIPOMAT,
                        SDISCGRADE.NUMCREDITOSCOB,
                        0 SELECIONADO,
                        SDISCGRADE.TIPODISC,
                        SDISCIPLINA.CH,
                        STURMADISC.CODFILIAL,
                        SDISCGRADE.CODPERIODO,
                        SPERIODO.DESCRICAO
                FROM    STURMADISC (NOLOCK)
                        JOIN SDISCIPLINA (NOLOCK)
                                ON STURMADISC.CODCOLIGADA = SDISCIPLINA.CODCOLIGADA
                                   AND STURMADISC.CODDISC = SDISCIPLINA.CODDISC
                        LEFT    JOIN (SELECT  CODCOLIGADA,
                                      IDTURMADISC,
                                      CODSTATUS,
                                      CODSUBTURMA,
                                      NUMDIARIO,
                                      TIPOMAT,
                                      NUMCREDITOSCOB
                              FROM   SMATRICULA (NOLOCK)
                              WHERE  CODCOLIGADA = 1
                                      AND RA = SMATRICPL.RA) SMATRICULA
                          ON ( STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
                              AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC )
                          LEFT JOIN SHABILITACAOFILIAL (NOLOCK)
                            ON ( STURMADISC.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
                                AND STURMADISC.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL )
                          LEFT JOIN SGRADE (NOLOCK)
                            ON ( SHABILITACAOFILIAL.CODCOLIGADA = SGRADE.CODCOLIGADA
                                AND SHABILITACAOFILIAL.CODCURSO = SGRADE.CODCURSO
                                AND SHABILITACAOFILIAL.CODHABILITACAO = SGRADE.CODHABILITACAO
                                AND SHABILITACAOFILIAL.CODGRADE = SGRADE.CODGRADE )
                          LEFT JOIN SDISCGRADE (NOLOCK)
                            ON ( SGRADE.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
                                AND SGRADE.CODCURSO = SDISCGRADE.CODCURSO
                                AND SGRADE.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
                                AND SGRADE.CODGRADE = SDISCGRADE.CODGRADE
                                AND STURMADISC.CODDISC = SDISCGRADE.CODDISC )                           
                           LEFT JOIN SPERIODO (NOLOCK)
                             ON SPERIODO.CODCOLIGADA = SDISCGRADE.CODCOLIGADA
			                          AND SPERIODO.CODCURSO = SDISCGRADE.CODCURSO
			                          AND SPERIODO.CODHABILITACAO = SDISCGRADE.CODHABILITACAO
			                          AND SPERIODO.CODGRADE = SDISCGRADE.CODGRADE
			                          AND SPERIODO.CODPERIODO = SDISCGRADE.CODPERIODO
			                          
			           LEFT JOIN (
					SELECT  SMATRICULA.CODCOLIGADA,
                                      SMATRICULA.IDTURMADISC,
                                      SMATRICULA.CODSTATUS,
                                      CODSUBTURMA,
                                      NUMDIARIO,
                                      TIPOMAT,
									  SMATRICULA.RA,

									  SMATRICULA.IDHABILITACAOFILIAL,
									STURMADISC.CODDISC,
                                      SMATRICULA.NUMCREDITOSCOB
                              FROM   SMATRICULA (NOLOCK)
									INNER JOIN STURMADISC ON STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
										AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
									LEFT JOIN SHISTDISCPENDENTES ON SHISTDISCPENDENTES.CODCOLIGADA = SMATRICULA.CODCOLIGADA
									AND SHISTDISCPENDENTES.RA = SMATRICULA.RA
									AND SHISTDISCPENDENTES.CODDISC = STURMADISC.CODDISC
									AND SHISTDISCPENDENTES.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL		
									LEFT JOIN SHISTDISCCONCLUIDAS ON SHISTDISCCONCLUIDAS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
									AND SHISTDISCCONCLUIDAS.RA = SMATRICULA.RA
									AND SHISTDISCCONCLUIDAS.CODDISC = STURMADISC.CODDISC
									AND SHISTDISCCONCLUIDAS.IDHABILITACAOFILIAL = SMATRICULA.IDHABILITACAOFILIAL
									
                              WHERE  SMATRICULA.CODCOLIGADA = 1
                                      AND SMATRICULA.RA = SMATRICPL.RA
									   AND (SHISTDISCPENDENTES.CODCOLIGADA IS NOT NULL OR SHISTDISCCONCLUIDAS.CODCOLIGADA IS NOT NULL)
									  
									  ) VALIDACAO
									  ON VALIDACAO.CODCOLIGADA = STURMADISC.CODCOLIGADA
										AND VALIDACAO.CODDISC = STURMADISC.CODDISC   
			                          
			                          
                WHERE  STURMADISC.CODCOLIGADA = 1
                       AND STURMADISC.CODFILIAL = SMATRICPL.CODFILIAL
                       AND STURMADISC.CODTURMA = STURMA.CODTURMAPROX
                       AND STURMADISC.IDPERLET = A.IDPERLET
                       AND STURMADISC.GERENCIAL <> 'S'
                       AND VALIDACAO.CODCOLIGADA IS NULL
                       AND STURMADISC.ATIVA = 'S'
                       AND (SDISCIPLINA.ITINERARIOFORMATIVO IS NULL OR SDISCIPLINA.ITINERARIOFORMATIVO <> 'S')  AND ((STURMADISC.DTINICIOMATPRES IS NULL AND STURMADISC.DTFIMMATPRES IS NULL) OR
                                          (GETDATE() BETWEEN STURMADISC.DTINICIOMATPRES AND STURMADISC.DTFIMMATPRES)) 

) AS B
	
	

OUTER APPLY(

Select 
	SMATRICPL.CODCOLIGADA, 
	SMATRICPL.IDPERLET, 
	SMATRICPL.CODSTATUS, 
	SALUNO.RA, 
	SMATRICPL.IDHABILITACAOFILIAL, 
	PPESSOA.NOME, 
	SMATRICPL.CODTURMA
from 
	SMATRICPL	SMP		(nolock)
	inner join SPLETIVO	SP			(nolock) on SP.CODCOLIGADA=SMP.CODCOLIGADA and SP.IDPERLET=SMP.IDPERLET
	inner join SSTATUS	SS			(nolock) on SS.CODCOLIGADA=SMP.CODCOLIGADA and SS.CODSTATUS = SMATRICPL.CODSTATUS
	inner join SALUNO	SA			(nolock) on SA.CODCOLIGADA = SMP.CODCOLIGADA and SA.RA=SMP.RA
	inner join PPESSOA	PP			(nolock) on PP.CODIGO = SA.CODPESSOA
	inner join SHABILITACAOFILIAL SHF	(nolock) on SHF.CODCOLIGADA = SMP.CODCOLIGADA and SHF.IDHABILITACAOFILIAL = SMP.IDHABILITACAOFILIAL
	inner join scurso SC              (NOLOCK) on SC.codcoligada = SHF.CODCOLIGADA and SC.codcurso = SHF.CODCURSO
	left join	(
					SELECT distinct
						pa.CODCOLIGADA, pa.RA
					FROM 
						FLAN				(nolock) fl
						inner join SLAN		(nolock) sl		on sl.CODCOLIGADA = fl.CODCOLIGADA and sl.IDLAN = fl.IDLAN
						inner join SPARCELA	(nolock) pa		on pa.CODCOLIGADA = sl.CODCOLIGADA and pa.IDPARCELA=sl.IDPARCELA
					Where	
						fl.STATUSLAN in (0,4)
						and fl.CODTDO in ('ACORD_EXT','ACORD_JUD','MENS', 'PENS')
						and fl.DATAVENCIMENTO < convert(date, GETDATE())
				) f on f.CODCOLIGADA=SALUNO.CODCOLIGADA and f.RA = SALUNO.RA
where 
	SMP.CODFILIAL = 4
	and SHF.CODTIPOCURSO = :CODTIPOCURSO
	and SP.CODPERLET = :PERIODOLETIVO
	and SS.DESCRICAO in ( select Id from dbo.splitStringToTable( :StatusAlunoPL, ',' ))
	and case when f.RA is null then 'N' else 'S' end = :Inadimplente_SN
	and SC.NOME NOT LIKE '%pensionato%'
	AND SMP.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SMP.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	AND SMP.RA = SMATRICPL.RA
	AND SMP.IDPERLET = SMATRICPL.IDPERLET
) AS C


WHERE SMATRICPL.CODSTATUS IN (2, 23 , 27)
AND SMATRICPL.CODFILIAL =4
AND SPLETIVO.CODPERLET =:PERIODOLETIVO_S
AND SHABILITACAOFILIAL.CODTIPOCURSO =:CODTIPOCURSO_N
AND SHABILITACAOFILIAL.CODCURSO NOT IN ('EC-GPENS','HT-GPENS','SP-GPENS')
AND A.CODCOLIGADA IS NOT NULL
AND B.CODCOLIGADA IS NOT NULL
AND C.CODCOLIGADA IS NOT NULL
AND STIPOMATRICULA.DESCRICAO IN ('Rematrícula','Matrícula')

AND SMATRICPL.RA NOT IN ( SELECT RA FROM SMATRICPL 
						  INNER JOIN SPLETIVO PL ON 
						  PL.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND 
						  PL.IDPERLET = SMATRICPL.IDPERLET
						  INNER JOIN SHABILITACAOFILIAL ON 
						  SMATRICPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND 
						  SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
						  WHERE PL.IDPERLETANT = SPLETIVO.IDPERLET
						  AND SHABILITACAOFILIAL.CODCURSO NOT IN ('EC-GPENS','HT-GPENS','SP-GPENS', 'SP-LEFIS','SP-BEFIS','SP-BCBIO','SP-LCBIO'))";10192;;;;08/11/2022;consultor1.totvs;1;1;1;1;;;;0;3f36aca7-7aec-4d2e-87f8-7670f3e97583;0;;-30692;consultor1.totvs;08/11/2022;consultor1.totvs;08/11/2022;0
S;ResHistParcial;Resumo Historico Parcial;"Select 
	v.NomFilial Filial, v.NomCurso Curso, v.NomGrade Matriz, v.RA, v.NomPessoa Aluno, 
	Count(*) Disciplinas,
	Sum(case when DESCRICAO='Aprovado' then 1 else 0 end)		Aprovado,
	Sum(case when DESCRICAO='Cursando' then 1 else 0 end)		Cursando,
	Sum(case when DESCRICAO='Aproveitamento' then 1 else 0 end) Aproveitamento,	
	Sum(case when DESCRICAO not in ('Aprovado','Cursando','Aproveitamento') then 1 else 0 end) [A Cursar]
from 
	v_Unasp_SMATRICPL v
	left join Z_HISTORICOPARCIAL h on h.CODCOLIGADA = v.CODCOLIGADA and h.IDHABILITACAOFILIAL = v.IDHABILITACAOFILIAL and h.RA = v.RA and h.CODPERIODO<>99
Where 
	v.CODPERLET in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' ))
	and v.CODFILIAL in (select ID from dbo.SplitIntToTable( :CODFILIAL ,',')) 	 
	and v.CODTIPOCURSO in (select ID from dbo.SplitIntToTable( :CODTIPOCURSO ,',')) 
	and v.NomStatus='Cursando'
Group by
	v.NomFilial, v.NomCurso, v.NomGrade, v.RA, v.NomPessoa";958;;;;01/11/2022;isaldo;1;1;1;1;;;;0;8c4b01fb-6bca-4622-8fb5-de8696310481;0;;-6742;isaldo;01/11/2022;isaldo;01/11/2022;0
S;Result;tabela z_Result;Select * from z_Result;22;;;;08/08/2022;isaldo;1;1;1;1;;;;0;31c4fc19-4061-45f7-9b56-07f3d8ff4046;0;;14998;isaldo;08/08/2022;isaldo;08/08/2022;0
S;ResumoAlunos;Resumo de Alunos por Curso;"Select 
	Campus, 
	Curso, 
	COUNT(*) Total,
	sum(case when Sexo='M' then 1 else 0 end) homens,
	sum(case when Sexo='F' then 1 else 0 end) Mulheres,
	sum(case when Sexo is null then 1 else 0 end) SexoNãoInformado,

	SUM(case when Religiao = 'Adventista do Sétimo Dia' then 1 else 0 end) Adventista,
	SUM(case when Religiao <> 'Adventista do Sétimo Dia' then 1 else 0 end) NãoAdventista,
	SUM(case when Religiao is null then 1 else 0 end) ReligiaoNaoInformada,

	SUM(case when PaisNatal = 'Brasil' then 1 else 0 end) Brasileiro,
	SUM(case when PaisNatal <> 'Brasil' then 1 else 0 end) Estrangeiro,
	SUM(case when PaisNatal is null then 1 else 0 end) NacionalidadeNãoInformada
from 
	v_Alunos
Where 
	Periodo = :Periodo and 
	Campus like '%' + :Campus + '%' and
	Curso like '%' + :Curso + '%' and 
	Status like '%' + :Status + '%'
Group By
	Campus, 
	Curso";877;;;;04/11/2021;mestre;1;1;1;1;;;;1;3a1cbbea-73aa-40cb-bc5c-9ebab8148c1c;0;;-26180;mestre;04/11/2021;mestre;04/11/2021;0
S;ResumoBoleto;Resumo de lançamentos Boleto;"SELECT
	B.IDBOLETO,
	1 Ordem,
	T.DESCRICAO + case when mpl.CODTURMA is null then '' else concat(' Turma:',mpl.CODTURMA) end Descricao,  
    FL.VALORORIGINAL Valor,
    
    CASE WHEN SSERVICO.NOME IS NOT NULL THEN SSERVICO.NOME + ' ' + SCURSO.NOME + CASE WHEN MPL.CODTURMA IS NULL THEN ''
    										 										  ELSE CONCAT(' - Turma: ',MPL.CODTURMA) END 
		 ELSE T.DESCRICAO END DESCR

FROM 
	FBOLETO					(nolock) B
    LEFT JOIN FLANBOLETO	(nolock) LB	ON LB.CODCOLIGADA = B.CODCOLIGADA AND LB.IDBOLETO = B.IDBOLETO 		
	LEFT JOIN FLAN			(nolock) FL	ON FL.CODCOLIGADA = LB.CODCOLIGADA AND FL.IDLAN = LB.IDLAN          
	LEFT JOIN FTDO			(nolock) T	ON T.CODCOLIGADA = FL.CODCOLIGADA AND T.CODTDO = FL.CODTDO  
    LEFT JOIN SLAN			(nolock) L	ON L.CODCOLIGADA = FL.CODCOLIGADA AND L.IDLAN = FL.IDLAN  
	LEFT JOIN SPARCELA		(nolock) PC	ON PC.CODCOLIGADA = L.CODCOLIGADA AND PC.IDPARCELA = L.IDPARCELA 
	left join SCONTRATO		(nolock) cont ON cont.CODCOLIGADA=pc.CODCOLIGADA and cont.RA=pc.RA and cont.CODCONTRATO=pc.CODCONTRATO and cont.IDPERLET=pc.IDPERLET
	left join SMATRICPL		(nolock) mpl ON mpl.CODCOLIGADA = cont.CODCOLIGADA and mpl.IDPERLET = cont.IDPERLET and mpl.IDHABILITACAOFILIAL = cont.IDHABILITACAOFILIAL and mpl.RA = cont.RA

	LEFT JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = CONT.CODCOLIGADA AND
											   SHABILITACAOFILIAL.IDHABILITACAOFILIAL = CONT.IDHABILITACAOFILIAL
											   
	LEFT JOIN SCURSO (NOLOCK)				ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA AND
											   SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO											   
	
	LEFT JOIN SSERVICO (NOLOCK)				ON SSERVICO.CODCOLIGADA = PC.CODCOLIGADA AND 
											   SSERVICO.CODSERVICO = PC.CODSERVICO

WHERE 
    B.CODCOLIGADA = :CODCOLIGADA
	and B.IDBOLETO = :IDBOLETO
	
union 

SELECT
	B.IDBOLETO,
	2 Ordem,
	SBOLSA.NOME + case when SBOLSA.VALIDADELIMITADA=0 then ' (Válido até ' + convert(varchar(10),B.VENCIMENTO,103) + ')' else '' end DESCRICAO,
	BL.VALOR * -1,
	SBOLSA.NOME + case when SBOLSA.VALIDADELIMITADA=0 then ' (Válido até ' + convert(varchar(10),B.VENCIMENTO,103) + ')' else '' end DESCR
	
FROM 
	FBOLETO 				(nolock) B
    LEFT JOIN FLANBOLETO 	(nolock) LB ON LB.CODCOLIGADA = B.CODCOLIGADA AND LB.IDBOLETO = B.IDBOLETO 		
	LEFT JOIN FLAN 			(nolock) FL ON FL.CODCOLIGADA = LB.CODCOLIGADA AND FL.IDLAN = LB.IDLAN          
	LEFT JOIN SLAN 			(nolock) L  ON L.CODCOLIGADA = FL.CODCOLIGADA AND L.IDLAN = FL.IDLAN  
	LEFT JOIN SPARCELA 		(nolock) PC ON PC.CODCOLIGADA = L.CODCOLIGADA AND PC.IDPARCELA = L.IDPARCELA 
	LEFT JOIN SBOLSALAN 	(nolock) BL ON BL.CODCOLIGADA = L.CODCOLIGADA AND BL.IDLAN = L.IDLAN
	LEFT JOIN SBOLSA 		(nolock)    ON bl.CODBOLSA = SBOLSA.CODBOLSA 
	Where
		B.CODCOLIGADA = :CODCOLIGADA
		and B.IDBOLETO = :IDBOLETO
		and isnull(BL.VALOR,0) > 0
 
 union 

 SELECT 
	FLANBOLETO.IDBOLETO,
	3 Ordem,
	concat('Cupom de desconto ',ZSVOUCHERDESCONTO.NUMEROVOUCHER) DESCRICAO,
	CASE WHEN ZSVOUCHERDESCONTO.PERCOUVALOR = 'P' THEN (FLAN.VALORORIGINAL * (ZSVOUCHERDESCONTO.PERCDESCONTO/100)) * -1 ELSE (ZSVOUCHERDESCONTO.VALORDESCONTO * -1) END AS Valor,
	concat('Cupom de desconto ',ZSVOUCHERDESCONTO.NUMEROVOUCHER) DESCR
	
FROM 
	SPSINSCAREAOFERTACOMPL
	INNER JOIN SPSINSCRICAOAREAOFERTADA (nolock)  ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSINSCAREAOFERTACOMPL.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSINSCAREAOFERTACOMPL.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO
	INNER JOIN SPSOPCAOINSCRITO (nolock) ON  SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSOPCAOINSCRITO.IDPS AND SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	INNER JOIN SPSAREAINTERESSE (nolock) ON SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE AND SPSOPCAOINSCRITO.CODCOLIGADA = SPSAREAINTERESSE.CODCOLIGADAHABFILIAL
	INNER JOIN SHABILITACAOFILIAL (nolock)  ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL 
	LEFT JOIN SMATRICPL (nolock) ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AND SMATRICPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS AND SMATRICPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	LEFT JOIN SCONTRATO (nolock) ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA AND SCONTRATO.RA = SMATRICPL.RA AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	LEFT JOIN SPARCELA (nolock) ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA AND SPARCELA.RA = SCONTRATO.RA AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
	LEFT JOIN SLAN (nolock) ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
	LEFT JOIN FLAN (nolock) ON SLAN.CODCOLIGADA = FLAN.CODCOLIGADA AND SLAN.IDLAN = FLAN.IDLAN
	LEFT JOIN FLAN (nolock) L ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = L.CODCOLIGADA AND SPSINSCRICAOAREAOFERTADA.IDLAN = L.IDLAN
	LEFT JOIN FLANBOLETO (nolock) ON FLANBOLETO.IDLAN = FLAN.IDLAN AND FLANBOLETO.CODCOLIGADA = FLAN.CODCOLIGADA
	INNER JOIN  ZSVOUCHERDESCONTO (nolock) ON SPSINSCAREAOFERTACOMPL.VOUCHER = ZSVOUCHERDESCONTO.NUMEROVOUCHER 
WHERE 
	FLANBOLETO.CODCOLIGADA = :CODCOLIGADA
	and FLANBOLETO.IDBOLETO = :IDBOLETO
	and SPSINSCAREAOFERTACOMPL.VOUCHER is not null

UNION ALL

SELECT
 FBOLETO.IDBOLETO,
 4 Ordem,
 CASE WHEN FLANINTEGRACAO.IDCAMPO = 52 THEN 'Aproveitamento de Débito de Conta Corrente' 
 		   ELSE 'Aproveitamento de Crédito de Conta Corrente' END DESCRICAO,

 CASE WHEN FLANINTEGRACAO.IDCAMPO = 52 THEN  FLANINTEGRACAO.VALOR 
 		   ELSE  FLANINTEGRACAO.VALOR * -1 END DESCRICAO,
 		   
 CASE WHEN FLANINTEGRACAO.IDCAMPO = 52 THEN 'Aproveitamento de Débito de Conta Corrente' 
 		   ELSE 'Aproveitamento de Crédito de Conta Corrente' END DESCR 		   
 
FROM 
 FBOLETO (NOLOCK)
 
 INNER JOIN FLANBOLETO (NOLOCK)		 ON FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA AND 
 										FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO 		
 
 INNER JOIN FLAN (NOLOCK)			 ON FLAN.CODCOLIGADA = FLANBOLETO.CODCOLIGADA AND 
 									    FLAN.IDBOLETO = FBOLETO.IDBOLETO
	
 INNER JOIN FLANINTEGRACAO (NOLOCK)	 ON FLANINTEGRACAO.CODCOLIGADA = FLAN.CODCOLIGADA AND
 									    FLANINTEGRACAO.IDLAN = FLAN.IDLAN AND
 									    FLANINTEGRACAO.IDCAMPO IN (52, 53)
 									    
WHERE FBOLETO.CODCOLIGADA = :CODCOLIGADA
  AND FBOLETO.IDBOLETO = :IDBOLETO

UNION ALL

SELECT
 FBOLETO.IDBOLETO,
 5 Ordem,
 'Desconto' DESCRICAO,

 FBOLETO.DESCONTO DESCRICAO,
 'Desconto' DESCR 		   
 
FROM 
 FBOLETO (NOLOCK)

WHERE FBOLETO.CODCOLIGADA = :CODCOLIGADA
  AND FBOLETO.IDBOLETO = :IDBOLETO
  AND FBOLETO.DESCONTO > 0

order by 1, 2";6865;;;;11/08/2022;robson.canto;1;1;1;1;;;;0;f7c86c74-ac32-4254-b2fa-9094d60abc70;0;;17163;isaldo;08/07/2021;robson.canto;11/08/2022;0
S;ResumoBolsa;Resumo de Bolsas por Período Letivo;"select 
	Filial,
	TipoCurso,
	TipoMatricula,
	RA, 
	Aluno,
	Curso,
	Vencimento,
	VALORORIGINAL,
	Sum(case when CODCLASSIFICACAO=1 then ValorDesconto end) 'CEBAS 100%',
	Sum(case when CODCLASSIFICACAO=2 then ValorDesconto end) 'CEBAS 50%',
	Sum(case when CODCLASSIFICACAO=3 then ValorDesconto end) 'PROUNI 100%',
	Sum(case when CODCLASSIFICACAO=4 then ValorDesconto end) 'Prouni 50%',
	Sum(case when CODCLASSIFICACAO=5 then ValorDesconto end) 'FIES',
	Sum(case when CODCLASSIFICACAO=6 then ValorDesconto end) 'Aux. Funcionário',
	Sum(case when CODCLASSIFICACAO=7 then ValorDesconto end) 'Desconto Comercal',
	Sum(case when CODCLASSIFICACAO=8 then ValorDesconto end) 'Aux. Associações',
	Sum(case when CODCLASSIFICACAO=9 then ValorDesconto end) 'Desconto Colportagem',
	Sum(case when isnull(CODCLASSIFICACAO,999) not between 1 and 9 then ValorDesconto end) 'Outros'
from 
	v_Unasp_SBOLSALAN 
Where 
	CODPERLET  in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' ))
	and Parcela like :Parcela
Group by
	Filial,
	TipoCurso,
	TipoMatricula,
	RA, 
	Aluno,
	Curso,
	Vencimento,
	VALORORIGINAL";1126;;;;06/10/2022;isaldo;1;1;1;1;;;;0;c47e309f-02d5-43cf-b13e-3a94c88457cd;0;;-6988;mestre;30/09/2022;isaldo;06/10/2022;0
S;ResumoBolsa.001;Resumo de Bolsas por Período Letivo - Cursando;"select 
	Filial, TipoCurso,TipoMatricula,RA,Aluno,Curso,Parcela,Vencimento,VALORORIGINAL,[CEBAS 100%],[CEBAS 50%],[PROUNI 100%],[Prouni 50%],[FIES],[Aux. Funcionário],[Desconto Comercial],[Aux. Associações],[Desconto Colportagem],[Outros],TotalBolsa 
from 
	v_Unasp_SPARCELA 
where 
	CODPERLET in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' ) ) 
	and Parcela like :Parcela";391;;;;06/10/2022;isaldo;1;1;1;1;;;;0;bbb89b05-fc93-4d79-8a35-ad7ba6a909b8;0;;14260;isaldo;04/10/2022;isaldo;06/10/2022;0
S;ResumoBolsa.002;Resumo de Bolsas por Período Letivo - Bolsas;"Select 
	Filial, TipoCurso, CODPERLET Período, CODCURSO, Curso, Turno, RA, Aluno, CodContrato, Status, TipoMatricula, Parcela, Vencimento, ValorOriginal, StatusLan, CodServico, Servico, CodBolsa, Bolsa, ValorDesconto, Classsificacao 
from 
	v_Unasp_SBOLSALAN 
Where 
	CODPERLET in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' )) 
	and Parcela like :Parcela
order by 
	Filial, TipoCurso, CODPERLET, CODCURSO, Curso, Turno, Aluno";447;;;;05/10/2022;isaldo;1;1;1;1;;;;0;0b2e76ab-d96c-471e-a678-7991f4880410;0;;-7076;isaldo;04/10/2022;isaldo;05/10/2022;0
S;ResumoCursando;Resumo de Alunos Cursando por Ano;"Select 
	CODPERLET,
	NomFilial, NomTipoCurso, 
	sum(case when NomStatus='Cursando' and NomTipoMatricula = 'Matricula'					and NomCurso not like 'pensionato%' then 1 else 0 end)	Matricula,
	sum(case when NomStatus='Cursando' and NomTipoMatricula = 'Rematricula' 				and NomCurso not like 'pensionato%' then 1 else 0 end)	Rematricula,	
	sum(case when NomStatus='Cursando' and NomTipoMatricula in ('Matricula','Rematricula') 	and NomCurso not like 'pensionato%' then 1 else 0 end) 	Total,
	sum(case when NomStatus='Cursando' and NomTipoMatricula = 'DIAP' 						and NomCurso not like 'pensionato%' then 1 else 0 end)	DIAP,	
	sum(case when NomStatus='Cursando' and NomTipoMatricula = 'Matricula' 					and NomCurso like 'pensionato%'		then 1 else 0 end)	PensionatoMatricula,
	sum(case when NomStatus='Cursando' and NomTipoMatricula = 'Rematricula' 				and NomCurso like 'pensionato%'		then 1 else 0 end)	PensionatoRematricula
from 
	v_Unasp_SMATRICPL 
Where 
	NomStatus='Cursando' 
	and CODPERLET like :ANO + '%'
Group by 
	CODPERLET, NomFilial, NomTipoCurso
order by 
	1, 2, 3
";1090;;;;01/09/2022;isaldo;1;1;1;1;;;;0;f1b46e9a-a4a0-4e76-a3eb-440466d6df3c;0;;-24183;isaldo;01/09/2022;isaldo;01/09/2022;0
S;RP001;PROVA ;"	 SELECT * FROM BEXECPROVA
";28;;;;12/05/2021;mestre;1;1;1;1;;;;0;70b3bbca-7466-4742-989e-791ecd92e9e3;0;;-2985;mestre;12/05/2021;mestre;12/05/2021;0
S;RP01;Consulta Tabela ;SELECT  * FROM SPSINSCRICAOAREAOFERTADA ;40;;;;12/05/2021;mestre;1;1;1;1;;;;0;eccbf161-1a7c-4cf0-a472-1c3d3494df12;0;;9060;mestre;12/05/2021;mestre;12/05/2021;0
S;SDISCGRADE;PROHELP SDISCGRADE;SELECT * FROM v_Unasp_SDISCGRADE;32;;;;16/11/2022;rafael.marques;1;1;1;1;;;;0;240fc998-efb7-46ed-a9d0-c0f6207963bd;0;;12330;rafael.marques;16/11/2022;rafael.marques;16/11/2022;0
S;Secretaria.6;Matriz;"select 
	*,
	case when CODPERIODO = 99 then 'Componentes  Curriculares'
	else NomPeriodo
	end DESCPERIODO

from 
	v_unasp_sdiscgrade

WHERE 
	CODGRADE = :CODGRADE2
	and CODCOLIGADA = :CODCOLIGADA2
	and CODCURSO = :CODCURSO2
	AND CODHABILITACAO = :CODHABILITACAO2

order by CODPERIODO, IDGRUPO, CODDISC";316;;;;26/11/2021;lucas.ssantos;1;1;1;1;;;;0;53d67092-0f0c-4e59-8659-adbe94655111;0;;-8139;lucas.ssantos;16/11/2021;lucas.ssantos;26/11/2021;0
S;Secretaria.6.1;Matriz Totalizador;"select distinct 
	CODGRADE, 
	CODPERIODO, 
	TotNumCreditosPeriodo, 
	TotCHPeriodo 
from 
	v_Unasp_SDISCGRADE 
WHERE 
	CODGRADE = :CODGRADE2
	AND CODPERIODO <> '99' 
	/*and CODCOLIGADA = :CODCOLIGADA2
	and CODCURSO = :CODCURSO2
	AND CODHABILITACAO = :CODHABILITACAO2*/

order by 
	CODPERIODO";305;;;;16/05/2022;consultor1.totvs;1;1;1;1;;;;0;67e761a0-6e9a-4c63-b32b-1fd0b5240881;0;;-19862;lucas.ssantos;17/11/2021;consultor1.totvs;16/05/2022;0
S;Secretaria.6.1.1;Matriz Totalizador;"
	select distinct 
	v_Unasp_SDISCGRADE.CODGRADE, 
	v_Unasp_SDISCGRADE.CODPERIODO, 
	v_Unasp_SDISCGRADE.TotNumCreditosPeriodo, 
	v_Unasp_SDISCGRADE.TotCHPeriodo,
	SHABILITACAOALUNO.RA,
	PPESSOA.NOME AS 'ALUNO'
from 
	v_Unasp_SDISCGRADE 

INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = v_unasp_sdiscgrade.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = v_unasp_sdiscgrade.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = v_unasp_sdiscgrade.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = v_unasp_sdiscgrade.CODGRADE
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SALUNO.RA = SHABILITACAOALUNO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA

WHERE 
	SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA3
	AND SHABILITACAOALUNO.RA = :RA1
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
	AND CODPERIODO <> '99' 
	/*and CODCOLIGADA = :CODCOLIGADA2
	and CODCURSO = :CODCURSO2
	AND CODHABILITACAO = :CODHABILITACAO2*/

order by 
	CODPERIODO";1216;;;;01/06/2022;consultor1.totvs;1;1;1;1;;;;0;03bcbe02-2559-4a2a-99a9-03dfc6aeb1ea;0;;3499;consultor1.totvs;23/05/2022;consultor1.totvs;01/06/2022;0
S;Secretaria.6.1.2;Componentes;"select distinct 
	CODGRADE, 
	CODPERIODO, 
	TotNumCreditosPeriodo, 
	TotCHPeriodo 
from 
	v_Unasp_SDISCGRADE 
WHERE 
	CODGRADE = :CODGRADE2
	AND CODPERIODO = '99' 
	/*and CODCOLIGADA = :CODCOLIGADA2
	and CODCURSO = :CODCURSO2
	AND CODHABILITACAO = :CODHABILITACAO2*/

order by 
	CODPERIODO";304;;;;16/05/2022;consultor1.totvs;1;1;1;1;;;;0;a109966b-c693-46cf-91c3-c55484f69a87;0;;13181;consultor1.totvs;16/05/2022;consultor1.totvs;16/05/2022;0
S;Secretaria.6.1.3;Componentes;"

	select distinct 
	v_Unasp_SDISCGRADE.CODGRADE, 
	v_Unasp_SDISCGRADE.CODPERIODO, 
	v_Unasp_SDISCGRADE.TotNumCreditosPeriodo, 
	v_Unasp_SDISCGRADE.TotCHPeriodo 
from 
	v_Unasp_SDISCGRADE 

	INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = v_unasp_sdiscgrade.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = v_unasp_sdiscgrade.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = v_unasp_sdiscgrade.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = v_unasp_sdiscgrade.CODGRADE
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL

WHERE 
		SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA3
	AND SHABILITACAOALUNO.RA = :RA1
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
	AND CODPERIODO = '99' 
	/*and CODCOLIGADA = :CODCOLIGADA2
	and CODCURSO = :CODCURSO2
	AND CODHABILITACAO = :CODHABILITACAO2*/

order by 
	CODPERIODO";1000;;;;23/05/2022;consultor1.totvs;1;1;1;1;;;;0;651544f2-f66e-440e-bdc2-ca0a5e67b4a2;0;;1769;consultor1.totvs;23/05/2022;consultor1.totvs;23/05/2022;0
S;Secretaria.6.1.4;Total CH;"SELECT SUM(TOTALCH) AS 'TOTALCH' 
FROM (
select SUM(v_Unasp_SDISCGRADE.CH) AS 'TOTALCH'
from 
	v_Unasp_SDISCGRADE 
WHERE 
	CODGRADE = :CODGRADE2
	AND CODPERIODO <> '99' 
	AND v_Unasp_SDISCGRADE.IDGRUPO = 0

UNION ALL

select 
	(SUM(DISTINCT v_Unasp_SDISCGRADE.CH) * SGRUPOOPTELET.MINDISCIPLINAS) AS 'TOTALCH'
from 
	v_Unasp_SDISCGRADE 
	INNER JOIN SGRUPOOPTELET ON SGRUPOOPTELET.CODCOLIGADA = v_Unasp_SDISCGRADE.CODCOLIGADA
		AND SGRUPOOPTELET.CODHABILITACAO = v_Unasp_SDISCGRADE.CODHABILITACAO
		AND SGRUPOOPTELET.CODCURSO = v_Unasp_SDISCGRADE.CODCURSO
		AND SGRUPOOPTELET.CODGRADE = v_Unasp_SDISCGRADE.CODGRADE
WHERE 
	v_Unasp_SDISCGRADE.CODGRADE = :CODGRADE2
	AND v_Unasp_SDISCGRADE.CODPERIODO <> '99' 
	AND v_Unasp_SDISCGRADE.IDGRUPO <> 0
GROUP BY SGRUPOOPTELET.MINDISCIPLINAS,v_Unasp_SDISCGRADE.IDGRUPO
) AS T

";843;;;;03/08/2022;consultor1.totvs;1;1;1;1;;;;0;67e761a0-6e9a-4c63-b32b-1fd0b5240881;0;;-28182;consultor1.totvs;03/08/2022;consultor1.totvs;03/08/2022;0
S;Secretaria.6.2;Matriz - Periodos;"select distinct	
	case when CODPERIODO = 99 then 'Componentes  Curriculares'
		 else NomPeriodo
		 end PERIODO,
	CODPERIODO,
	TemEletiva = (select distinct 1 from  v_unasp_sdiscgrade x where x.CODGRADE = v.CODGRADE and x.CODPERIODO = v.CODPERIODO and IDGRUPO != 0)

from 
	v_unasp_sdiscgrade v
WHERE 
	CODGRADE = :CODGRADE2
	and CODCOLIGADA = :CODCOLIGADA2
	and CODCURSO = :CODCURSO2
	AND CODHABILITACAO = :CODHABILITACAO2

";439;;;;26/11/2021;lucas.ssantos;1;1;1;1;;;;0;cb3f7121-05c9-4d0f-bef3-670d49131883;0;;-21305;lucas.ssantos;22/11/2021;lucas.ssantos;26/11/2021;0
S;Secretaria.6.2.1;Matriz - Periodos;"select distinct	
	case when v.CODPERIODO = 99 then 'Componentes  Curriculares'
		 else v.NomPeriodo
		 end PERIODO,
	v.CODPERIODO,
	TemEletiva = (select distinct 1 from  v_unasp_sdiscgrade x where x.CODGRADE = v.CODGRADE and x.CODPERIODO = v.CODPERIODO and IDGRUPO != 0)

from 
	v_unasp_sdiscgrade v
	
	INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = v.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = v.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = v.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = v.CODGRADE
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	
WHERE 
	SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA3
	AND SHABILITACAOALUNO.RA = :RA1
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1

";891;;;;18/05/2022;consultor1.totvs;1;1;1;1;;;;0;cb3f7121-05c9-4d0f-bef3-670d49131883;0;;-28818;consultor1.totvs;18/05/2022;consultor1.totvs;18/05/2022;0
S;Secretaria.6.3;Matriz - Materias Base;"select 	
	CODPERIODO,
	CODDISC,
	NOME,
	NUMCREDITOS,
	CH

from v_unasp_sdiscgrade

WHERE 
	CODGRADE = :CODGRADE2
	and CODCOLIGADA = :CODCOLIGADA2
	and CODCURSO = :CODCURSO2
	AND CODHABILITACAO = :CODHABILITACAO2
	And IDGRUPO = 0
	and codperiodo = :codperiodo1";274;;;;26/11/2021;lucas.ssantos;1;1;1;1;;;;0;0c965bf9-eaf2-430a-b552-929a14436e2c;0;;-13621;lucas.ssantos;22/11/2021;lucas.ssantos;26/11/2021;0
S;Secretaria.6.3.1;Matriz - Disciplinas Aproveitamento Aluno;"select 	
	v_unasp_sdiscgrade.CODPERIODO,
	v_unasp_sdiscgrade.CODDISC,
	v_unasp_sdiscgrade.NOME,
	v_unasp_sdiscgrade.NUMCREDITOS,
	v_unasp_sdiscgrade.CH,
	A.NOMEDISC,
	A.PROF,
	A.CODPERLET,
	A.NOTA,
	A.STATUS

from v_unasp_sdiscgrade

INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = v_unasp_sdiscgrade.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = v_unasp_sdiscgrade.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = v_unasp_sdiscgrade.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = v_unasp_sdiscgrade.CODGRADE
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
OUTER APPLY(SELECT 
	SHISTDISCFAC.OBS AS 'NOMEDISC',
	CAST(SHISTDISCFAC.NOTA AS DECIMAL(10,2)) AS 'NOTA',
	SPLETIVO.CODPERLET,
	SSTATUS.DESCRICAO AS 'STATUS',
	PPESSOA.NOME AS 'PROF'
from SHISTDISCFAC 

LEFT JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHISTDISCFAC.CODSTATUS
	/*
LEFT JOIN SHISTDISCFACEXT ON SHISTDISCFACEXT.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SHISTDISCFACEXT.RA = SHISTDISCFAC.RA
	AND SHISTDISCFACEXT.IDPERLET = SHISTDISCFAC.IDPERLET
	AND SHISTDISCFACEXT.CODDISC = SHISTDISCFAC.CODDISC
	AND SHISTDISCFACEXT.IDHABILITACAOFILIAL = SHISTDISCFAC.IDHABILITACAOFILIAL*/
	
LEFT JOIN SHISTDISCFACPROF ON SHISTDISCFACPROF.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SHISTDISCFACPROF.RA = SHISTDISCFAC.RA
	AND SHISTDISCFACPROF.CODDISC = SHISTDISCFAC.CODDISC
	AND SHISTDISCFACPROF.IDPERLET = SHISTDISCFAC.IDPERLET
	AND SHISTDISCFACPROF.IDHABILITACAOFILIAL = SHISTDISCFAC.IDHABILITACAOFILIAL
LEFT JOIN SPROFESSOR ON SPROFESSOR.CODCOLIGADA = SHISTDISCFACPROF.CODCOLIGADA
	AND SPROFESSOR.CODPROF = SHISTDISCFACPROF.CODPROF
LEFT JOIN PPESSOA ON PPESSOA.CODIGO = SPROFESSOR.CODPESSOA

INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SHISTDISCFAC.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SHISTDISCFAC.IDPERLET
WHERE SHISTDISCFAC.CODCOLIGADA = :CODCOLIGADA3
AND SHISTDISCFAC.RA = :RA1
AND SHISTDISCFAC.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
AND SHISTDISCFAC.CODDISC = v_unasp_sdiscgrade.CODDISC
) AS A


WHERE 
	SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA3
	AND SHABILITACAOALUNO.RA = :RA1
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1
	And IDGRUPO = 0
	and v_unasp_sdiscgrade.codperiodo = :codperiodo1";2445;;;;27/06/2022;consultor1.totvs;1;1;1;1;;;;0;0c965bf9-eaf2-430a-b552-929a14436e2c;0;;-11914;consultor1.totvs;18/05/2022;consultor1.totvs;27/06/2022;0
S;Secretaria.6.4;Matriz - EletivasOptativas;"select 	
	CODPERIODO,
	CODDISC,
	NOME,
	NUMCREDITOS,
	CH,
	IDGRUPO Eletiva

from 
	v_unasp_sdiscgrade
WHERE 
	CODGRADE = :CODGRADE2
	and CODCOLIGADA = :CODCOLIGADA2
	and CODCURSO = :CODCURSO2
	AND CODHABILITACAO = :CODHABILITACAO2
	And IDGRUPO != 0
	and codperiodo = :codperiodo1

";299;;;;26/11/2021;lucas.ssantos;1;1;1;1;;;;0;fa8f2974-3a45-49e2-8a4f-305e71405887;0;;-6313;lucas.ssantos;22/11/2021;lucas.ssantos;26/11/2021;0
S;Secretaria.61;Matriz;"select 
	v_unasp_sdiscgrade.*,
	case when v_unasp_sdiscgrade.CODPERIODO = 99 then 'Componentes  Curriculares'
	else v_unasp_sdiscgrade.NomPeriodo
	end DESCPERIODO,
	v_unasp_sdiscgrade.CODCURSO + ' - ' + NomCurso AS CURSO,
	v_unasp_sdiscgrade.CODGRADE + ' - ' + NomGrade AS GRADE

from 
	v_unasp_sdiscgrade


INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = v_unasp_sdiscgrade.CODCOLIGADA
	AND SHABILITACAOFILIAL.CODCURSO = v_unasp_sdiscgrade.CODCURSO
	AND SHABILITACAOFILIAL.CODHABILITACAO = v_unasp_sdiscgrade.CODHABILITACAO
	AND SHABILITACAOFILIAL.CODGRADE = v_unasp_sdiscgrade.CODGRADE
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL

WHERE 
	SHABILITACAOALUNO.CODCOLIGADA = :CODCOLIGADA3
	AND SHABILITACAOALUNO.RA = :RA1
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL1

order by CODPERIODO, IDGRUPO, CODDISC

";1006;;;;23/05/2022;consultor1.totvs;1;1;1;1;;;;0;7daea8e7-cb58-4e13-a562-b752e5a3aa89;0;;32181;consultor1.totvs;23/05/2022;consultor1.totvs;23/05/2022;0
S;secretaria.7;expedição/registro do diploma;"select 
	p.nome,
	concat (f.CIDADE ,'-',	f.ESTADO) cidade,
	'13 de julho de 2022.' data,
	
	CASE WHEN :DATA LIKE 'HOJE' THEN CONVERT(VARCHAR,GETDATE(),103) 
	ELSE CONVERT(VARCHAR,:DATA,103) END AS data2,
	case when p.sexo = 'F' then 'da aluna' else 'do aluno' end genAluno


from shabilitacaoaluno ha
	inner join shabilitacaofilial hf on hf.codcoligada = ha.codcoligada and hf.idhabilitacaofilial = ha.idhabilitacaofilial
	inner join gfilial f on f.codcoligada = hf.codcoligada and f.codfilial = hf.codfilial
	inner join saluno a on a.codcoligada = ha.codcoligada and a.ra = ha.ra
	inner join ppessoa p on p.CODIGO = a.CODPESSOA

where 
	ha.ra = :RA1
	and ha.codcoligada = :CODCOLIGADA1
	and ha.idhabilitacaofilial = :IDHABILITACAOFILIAL1

";761;;;;01/09/2022;consultor1.totvs;1;1;1;1;;;;0;4028821c-46e7-46c0-a33a-d5cf6862d9a8;0;;18434;lucas.ssantos;15/02/2022;consultor1.totvs;01/09/2022;0
S;SMATRICULA;Alunos matriculados SMATRICULA;"select 
	* 
from 
	v_Unasp_SMATRICULA
Where 
	CODCOLIGADA=:CODCOLIGADA
	and IDTURMADISC=:IDTURMADISC
Order by
	Nome";123;1;;;16/08/2021;mestre;1;1;1;1;;;;1;37c5715c-7ad8-42a7-be11-486d7731c17e;0;;-21937;mestre;09/08/2021;mestre;16/08/2021;0
S;SMATRICULA Turma;Alunos Matriculados SMATRICULA - Turma;"select 
	* 
from 
	v_Unasp_SMATRICULA
Where 
	CODCOLIGADA = :CODCOLIGADA 
	and CODFILIAL = :CODFILIAL
	and	CODTURMA = :CODTURMA
	and IDPERLET = :IDPERLET";161;;;;02/03/2022;isaldo;1;1;1;1;;;;0;988577b1-b82e-4b92-9274-0c3dd363b06f;0;;7964;isaldo;02/03/2022;isaldo;02/03/2022;0
S;SMATRICULA.1;Matricula em Disciplinas;"select 
	* 
from 
	v_Unasp_SMATRICULA
Where 
	RA=:RA
Order by
	Nome";74;1;;;09/08/2021;isaldo;1;1;1;1;;;;1;37c5715c-7ad8-42a7-be11-486d7731c17e;0;;26452;isaldo;09/08/2021;mestre;09/08/2021;0
S;SPARCELA;Parcelas Financeiro;"Select 
	m.RA, 
	m.NomPessoa Aluno, 
	m.NomCurso Curso,
	m.CODPERLET,
	p.Parcela,
	serv.NOME Serviço,
	p.Valor,
	p.DTVENCIMENTO Vencimento,
	case when l.IDPARCELA is null then 'N' else 'S' end Financeiro,
	convert(money, isnull(Saldo.SaldoDevedor,0)) SaldoDevedor,
	m.CODCURSO, 
	c.CODCONTRATO,
	c.CODPLANOPGTO,
	pp.NOME PlanoPagamento,
	p.IDPARCELA,
	p.CODCOLIGADA,
	p.IDPERLET,
	m.IDHABILITACAOFILIAL,
	m.CODGRADE,
	serv.CODSERVICO,
	p.RECCREATEDBY,
	p.RECCREATEDON
from 
	SPARCELA						(nolock)	p
	inner join SSERVICO				(nolock)	serv on serv.CODCOLIGADA = p.CODCOLIGADA and serv.CODSERVICO=p.CODSERVICO
	inner join SCONTRATO			(nolock)	c on c.CODCOLIGADA = p.CODCOLIGADA and c.RA = p.RA and c.CODCONTRATO = p.CODCONTRATO and c.IDPERLET = p.IDPERLET
	left join SPLANOPGTO			(nolock)	pp on pp.CODCOLIGADA = c.CODCOLIGADA and pp.IDPERLET = c.IDPERLET and pp.CODPLANOPGTO=c.CODPLANOPGTO
	inner join v_Unasp_SMATRICPL	(nolock)	m on m.CODCOLIGADA = c.CODCOLIGADA and m.IDPERLET = c.IDPERLET and m.IDHABILITACAOFILIAL = c.IDHABILITACAOFILIAL and m.RA = c.RA
	left join (Select distinct CODCOLIGADA, IDPARCELA from SLAN (nolock)) l on l.CODCOLIGADA = p.CODCOLIGADA and l.IDPARCELA=p.IDPARCELA
	left join (
				SELECT DISTINCT
					p.CODCOLIGADA,
					p.IDPARCELA,
					Sum(CASE WHEN f.STATUSLAN = 0 OR f.VALORBAIXADO IS NULL THEN f.VALORORIGINAL ELSE f.VALORORIGINAL - f.VALORBAIXADO END) AS SaldoDevedor
				FROM 
					SPARCELA			(NOLOCK) p
					INNER JOIN SLAN		(NOLOCK) l 		ON p.CODCOLIGADA = l.CODCOLIGADA		AND p.IDPARCELA = l.IDPARCELA
					INNER JOIN FLAN		(NOLOCK) f		ON f.CODCOLIGADA = l.CODCOLIGADA 		AND f.IDLAN = l.IDLAN
				WHERE 
					f.STATUSLAN IN (0,4)
				Group By
					p.CODCOLIGADA,
					p.IDPARCELA) Saldo on saldo.CODCOLIGADA=p.CODCOLIGADA and saldo.IDPARCELA=p.IDPARCELA
Where 
	m.CODPERLET = :CODPERLET
order by 
	m.NomPessoa,
	m.CODPERLET,
	p.PARCELA";1919;;;;19/12/2021;isaldo;1;1;1;1;;;;1;160f0bf0-1c49-4cf9-8042-d7493efcade4;0;;1685;isaldo;19/12/2021;isaldo;19/12/2021;0
S;SPS.002;Alunos Sem Local de Prova;"SELECT 
	SPSUSUARIO.*,
	*
FROM SPSINSCRICAOAREAOFERTADA
INNER JOIN SPSUSUARIO ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
LEFT JOIN SPSLOCALETAPAINSCRITO ON SPSLOCALETAPAINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSLOCALETAPAINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSLOCALETAPAINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
WHERE 
	SPSINSCRICAOAREAOFERTADA.IDPS = :IDPS
	AND SPSLOCALETAPAINSCRITO.CODCOLIGADA IS NULL";505;;;;13/04/2022;consultor1.totvs;1;1;1;1;;;;0;9016db9b-6ab3-4dfb-bf77-c0eb0684f06e;0;;28972;consultor1.totvs;13/04/2022;consultor1.totvs;13/04/2022;0
S;SPSDOC_Entregue;Documentos entregues do processo seletivo;"select 
	de.CODCOLIGADA, de.IDPS, de.NUMEROINSCRICAO Numero, u.NOME Candidato, i.NOME AreaInteresse, d.DESCRICAO Documento, case when isnull(de.ENTREGUE,'F')='F' then 'Não' else 'Sim' end Entregue, Motivo,
	st.DESCRICAO Status, iao.DATAINSCRICAO
From 
	SPSPROCESSOSELETIVO					(nolock) ps
	inner join SPSINSCRICAOAREAOFERTADA (nolock) iao on iao.CODCOLIGADA = ps.CODCOLIGADA and iao.IDPS = ps.IDPS	
	inner JOIN SPSOPCAOINSCRITO			(nolock) oi ON oi.CODCOLIGADA = iao.CODCOLIGADA AND oi.IDPS = iao.IDPS AND oi.NUMEROINSCRICAO = iao.NUMEROINSCRICAO
	inner join SPSAREAOFERTADA			(nolock) ao	on ao.CODCOLIGADA = ps.CODCOLIGADA and ao.IDPS = ps.IDPS AND oi.IDAREAINTERESSE = ao.IDAREAINTERESSE
	inner join SPSAREAINTERESSE			(nolock) i	on i.IDAREAINTERESSE = ao.IDAREAINTERESSE
	inner join SHABILITACAOFILIAL		(nolock) hf on hf.CODCOLIGADA = i.CODCOLIGADAHABFILIAL and hf.IDHABILITACAOFILIAL = i.IDHABILITACAOFILIAL
	left join SPSSTATUSOPCAO			(nolock) st	on st.CODCOLIGADA=oi.CODCOLIGADA and st.CODFILIAL = hf.CODFILIAL and st.CODIGO = oi.STATUS
	inner join SPSUSUARIO				(nolock) u	on u.CODUSUARIOPS = iao.CODUSUARIOPS 
	inner join SPSDOCUMENTOENTREGUE		(nolock) de	on de.CODCOLIGADA = iao.CODCOLIGADA and de.IDPS = iao.IDPS and de.NUMEROINSCRICAO = iao.NUMEROINSCRICAO
	inner join SDOCUMENTO				(nolock) d	on d.CODDOCUMENTO = de.CODDOCUMENTO
where 
	ps.IDPS = :IDPS
order by 
	u.NOME";1398;;;;23/08/2022;isaldo;1;1;1;1;;;;0;c80126bc-3631-4965-a7ee-be80e922876a;0;;-12871;isaldo;26/01/2022;isaldo;23/08/2022;0
S;SPSDOC_Entregue1;Documentos entregues do processo seletivo - Não Entregue, sem motivo e Status Inscrito para seleção;"Select * from (
select 
	de.CODCOLIGADA, de.IDPS, de.NUMEROINSCRICAO Numero, u.NOME Candidato, i.NOME AreaInteresse, d.DESCRICAO Documento, case when isnull(de.ENTREGUE,'F')='F' then 'Não' else 'Sim' end Entregue, Motivo,
	st.DESCRICAO Status, iao.DATAINSCRICAO
From 
	SPSPROCESSOSELETIVO					(nolock) ps
	inner join SPSINSCRICAOAREAOFERTADA (nolock) iao on iao.CODCOLIGADA = ps.CODCOLIGADA and iao.IDPS = ps.IDPS	
	inner JOIN SPSOPCAOINSCRITO			(nolock) oi ON oi.CODCOLIGADA = iao.CODCOLIGADA AND oi.IDPS = iao.IDPS AND oi.NUMEROINSCRICAO = iao.NUMEROINSCRICAO
	inner join SPSAREAOFERTADA			(nolock) ao	on ao.CODCOLIGADA = ps.CODCOLIGADA and ao.IDPS = ps.IDPS AND oi.IDAREAINTERESSE = ao.IDAREAINTERESSE
	inner join SPSAREAINTERESSE			(nolock) i	on i.IDAREAINTERESSE = ao.IDAREAINTERESSE
	inner join SHABILITACAOFILIAL		(nolock) hf on hf.CODCOLIGADA = i.CODCOLIGADAHABFILIAL and hf.IDHABILITACAOFILIAL = i.IDHABILITACAOFILIAL
	left join SPSSTATUSOPCAO			(nolock) st	on st.CODCOLIGADA=oi.CODCOLIGADA and st.CODFILIAL = hf.CODFILIAL and st.CODIGO = oi.STATUS
	inner join SPSUSUARIO				(nolock) u	on u.CODUSUARIOPS = iao.CODUSUARIOPS 
	inner join SPSDOCUMENTOENTREGUE		(nolock) de	on de.CODCOLIGADA = iao.CODCOLIGADA and de.IDPS = iao.IDPS and de.NUMEROINSCRICAO = iao.NUMEROINSCRICAO
	inner join SDOCUMENTO				(nolock) d	on d.CODDOCUMENTO = de.CODDOCUMENTO
where 
	ps.IDPS = :IDPS
	) x
Where 
	Entregue='Não'
	and isnull(Motivo,'')=''
	and Status='Inscrito para seleção'
order by 
	Candidato";1513;;;;23/08/2022;isaldo;1;1;1;1;;;;0;c80126bc-3631-4965-a7ee-be80e922876a;0;;4286;isaldo;23/08/2022;isaldo;23/08/2022;0
S;sqltesteraphael;sql teste;"SELECT saluno.codcoligada,
       saluno.ra,
       saluno.codtipocurso,
       stipocurso.nome                                           nivelensino,
       ppessoa.nome                                              nomealuno,
       CONVERT(VARCHAR, ppessoa.dtnascimento, 103)               dtnascimento,
       ppessoa.pais                                              paisaluno,
       ppessoa.naturalidade,
       getd.nome as estadonatal,
       ppessoa.nacionalidade,
       pcodnacao.descricao
       nomenacionalidade,
       case when ppessoa.nacionalidade = '10' then 'RG:. ' + ppessoa.cartidentidade else 'RNM:. ' + ppessoa.nroreggeral end as cartidentidade,
       case when ppessoa.orgemissorident is not null then ppessoa.orgemissorident + ' -' else null end as orgemissorident,
       case when ppessoa.nacionalidade = '10' then ppessoa.ufcartident else ppessoa.orgemissorrne end as ufcartident,
       ppessoa.cpf,
       scurso.nome                                               nomecurso,
       scurso.codcurso,
       shabilitacaofilial.codhabilitacao,
       shabilitacaofilial.descricaocurso,
       shabilitacaofilial.descricaohabilitacao,
       shabilitacaofilial.idhabilitacaofilial,
       shabilitacao.nome                                         habilitacao,
       CONVERT(VARCHAR, shabilitacaoaluno.dtconclusaocurso, 103) dtconclusaocurso,
       CONVERT(VARCHAR, shabilitacaoaluno.dtcolacaograu, 103)	 dtcolacaograu,
       CONVERT(VARCHAR, shabilitacaoaluno.dtingresso, 103)       dtingresso,
       gfilial.cidade                                            cidadefilial,
       ppessoasecretario.nome                                    nomesec1filial,
       gsec1.imagem
       assinaturasec1filial,
       CASE
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'M' THEN 'Bacharel'
         WHEN Lower(smodalidadecurso.descricao) = 'bacharelado'
              AND ppessoa.sexo = 'F' THEN 'Bacharela'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'M' THEN 'Licenciado'
         WHEN Lower(smodalidadecurso.descricao) = 'licenciatura'
              AND ppessoa.sexo = 'F' THEN 'Licenciada'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'M' THEN 'Tecnólogo'
         WHEN Lower(smodalidadecurso.descricao) = 'tecnólogo'
              AND ppessoa.sexo = 'F' THEN 'Tecnóloga'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'M' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) = 'pós-graduação lato sensu'
              AND ppessoa.sexo = 'F' THEN 'Especialista'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'M' THEN 'Mestre'
         WHEN Lower(smodalidadecurso.descricao) =
              'pós-graduação stricto sensu'
              AND ppessoa.sexo = 'F' THEN 'Mestra'
       END                                                       AS modalidade,
       ppessoa.sexo,
       CASE 
       	WHEN ppessoa.sexo = 'M' then 'masculino'
       	ELSE 'feminino'
       END desc_sexo,
       CASE
         WHEN ppessoa.sexo = 'm' THEN 'nascido'
         ELSE 'nascida'
       END                                                       AS nascido,
       CONVERT(VARCHAR(10), Getdate(), 103)                      AS dataatual,
       assinsecretario.imagem                                    AS assin_sec1,
       CASE WHEN PPESSOA.SEXO = 'M' then ZMDNACIONALIDADE.NOMEMASCULINO
            ELSE ZMDNACIONALIDADE.NOMEFEMININO END AS DESC_NACIONALIDADE,
       scursocompl.autorizacao
FROM   shabilitacaofilial (nolock)
       JOIN shabilitacaoaluno (nolock)
         ON ( shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada
              AND shabilitacaoaluno.idhabilitacaofilial =
                  shabilitacaofilial.idhabilitacaofilial )
       JOIN saluno (nolock)
         ON ( saluno.codcoligada = shabilitacaoaluno.codcoligada
              AND saluno.ra = shabilitacaoaluno.ra )
       JOIN ppessoa (nolock)
         ON ( ppessoa.codigo = saluno.codpessoa )
       JOIN getd (nolock)
         ON ( ppessoa.estadonatal = getd.codetd )
       LEFT JOIN pcodnacao (nolock)
              ON ( ppessoa.nacionalidade = pcodnacao.codcliente )
       JOIN gfilial (nolock)
         ON ( gfilial.codcoligada = shabilitacaofilial.codcoligada
              AND gfilial.codfilial = shabilitacaofilial.codfilial )
       LEFT JOIN sfilial (nolock)
              ON ( gfilial.codcoligada = sfilial.codcoligada
                   AND gfilial.codfilial = sfilial.codfilial )
       LEFT JOIN sdirecaofilial (nolock)
              ON ( sfilial.codcoligada = sdirecaofilial.codcoligada
                   AND sfilial.codfilial = sdirecaofilial.codfilial )
       LEFT JOIN ppessoa ppessoadirecao (nolock)
              ON ( sdirecaofilial.codpessoa = ppessoadirecao.codigo )
       LEFT JOIN ppessoa ppessoasecretario (nolock)
              ON ( sdirecaofilial.codpessoasec1 = ppessoasecretario.codigo )
       LEFT JOIN ppessoa ppessoacoordenadorregdip (nolock)
              ON ( sdirecaofilial.codpessoasec2 =
                   ppessoacoordenadorregdip.codigo )
       LEFT JOIN zmdassinaturas assinsecretario (nolock)
              ON ( ppessoasecretario.codigo = assinsecretario.codpessoa )
       LEFT JOIN gimagem gsec1(nolock)
              ON sdirecaofilial.idassinaturasec1 = gsec1.id
       LEFT JOIN gimagem (nolock)
              ON gfilial.idimagem = gimagem.id
       JOIN stipocurso (nolock)
         ON ( shabilitacaofilial.codcoligada = stipocurso.codcoligada
              AND shabilitacaofilial.codtipocurso = stipocurso.codtipocurso )
       JOIN shabilitacao (nolock)
         ON ( shabilitacaofilial.codcoligada = shabilitacao.codcoligada
              AND shabilitacaofilial.codcurso = shabilitacao.codcurso
              AND shabilitacaofilial.codhabilitacao =
                  shabilitacao.codhabilitacao )
       JOIN sgrade (nolock)
         ON shabilitacaofilial.codcoligada = sgrade.codcoligada
            AND shabilitacaofilial.codcurso = sgrade.codcurso
            AND shabilitacaofilial.codhabilitacao = sgrade.codhabilitacao
            AND shabilitacaofilial.codgrade = sgrade.codgrade
       JOIN scurso (nolock)
         ON ( shabilitacaofilial.codcoligada = scurso.codcoligada
              AND shabilitacaofilial.codcurso = scurso.codcurso )
       LEFT JOIN scursocompl (nolock)
	     on (scurso.codcoligada = scursocompl.codcoligada 
	     and scurso.codcurso = scursocompl.codcurso)
       LEFT JOIN smodalidadecurso (nolock)
              ON ( scurso.codcoligada = smodalidadecurso.codcoligada
                   AND scurso.codmodalidadecurso =
                 smodalidadecurso.codmodalidadecurso )
       LEFT JOIN sinstituicao (nolock)
              ON shabilitacaoaluno.codinstdiploma = sinstituicao.codinst
       LEFT JOIN zmdnacionalidade (nolock)
              ON pcodnacao.codcliente = zmdnacionalidade.CODNACAO
WHERE  shabilitacaoaluno.codcoligada = 1
       AND shabilitacaoaluno.ra = :RA
       AND shabilitacaoaluno.dtconclusaocurso IS NOT NULL
       AND scurso.codtipocurso = 1 
       and shabilitacaofilial.ativo = 'S'";7452;;;;10/12/2021;raphael.muzy;1;1;1;1;;;;0;40faa8d2-4b70-4e53-bf46-adaab0be4e8a;0;;-26937;raphael.muzy;10/12/2021;raphael.muzy;10/12/2021;0
S;SyncCanvas.1;Totvs->Canvas - Disciplinas não Gerenciadas;"select 
	cfg.Valor NomFilial, 
	tc.NOME NomTipoCurso, 
	CODPERLET, 
	c.CODCURSO CodCurso,
	c.NOME NomCurso, 
	t.CODTURMA, 
	td.IDTURMADISC,
	cfgSub.Valor SubConta,
	IdCanvas, 
	d.NOME NomDisciplina
from 
	STURMADISC						(nolock) td
	inner join STURMADISCCOMPL		(nolock) tdcompl	on tdcompl.CODCOLIGADA = td.CODCOLIGADA and tdcompl.IDTURMADISC = td.IDTURMADISC
	inner join STURMA				(nolock) t		on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET=td.IDPERLET
	inner join GFILIAL				(nolock) f		on f.CODCOLIGADA = t.CODCOLIGADA and f.CODFILIAL=t.CODFILIAL
	inner join SDISCIPLINA			(nolock) d		on d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
	inner join SPLETIVO				(nolock) pl		on pl.CODCOLIGADA = t.CODCOLIGADA and pl.IDPERLET=t.IDPERLET	
	inner join SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = td.CODCOLIGADA and hf.IDHABILITACAOFILIAL = td.IDHABILITACAOFILIAL
	inner join SHABILITACAOFILIALPL	(nolock) hfpl	on hfpl.CODCOLIGADA = td.CODCOLIGADA and hfpl.IDHABILITACAOFILIAL = td.IDHABILITACAOFILIAL and hfpl.IDPERLET=pl.IDPERLET
	inner join STIPOCURSO			(nolock) tc		on tc.CODTIPOCURSO = hf.CODTIPOCURSO
	inner join SGRADE				(nolock) g		on g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
	inner join SHABILITACAO			(nolock) h		on h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
	inner join SCURSO				(nolock) c		on c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO
	inner join z_Config				(nolock) cfg		on cfg.Grupo = 'Campus' and cfg.Item=td.CODFILIAL
	inner join z_Config				(nolock) cfgSub	on cfgSub.Grupo = concat('Canvas_Filial_',td.CODFILIAL) and cfgsub.Item=convert(varchar(50),td.CODTIPOCURSO)
Where
	((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	and td.IDTURMADISC not in (Select IDTURMADISCGERENCIADA from STURMADISCGERENCIADA (nolock))
	and tdcompl.CANVAS='T' and tdcompl.IDCANVAS is null
	and c.NOME not like 'pensionato%'
order by
	c.NOME";2155;;;;25/07/2022;roan.rossi;1;1;1;1;;;;0;69227a42-0611-4063-91d5-0b521a6ca653;0;;18812;isaldo;16/05/2022;roan.rossi;25/07/2022;0
S;SyncCanvas.10;Totvs->Canvas - Matriculas da Ressincronização;"Select mc.ra  Codigo, 'aluno'  Tipo, m.codstatus ,null IDPROFESSORTURMAGERENCIAL
from SMATRICULACOMPL mc 
inner join smatricula m on m.IDTURMADISC = mc.IDTURMADISC and m.ra = mc.RA
where mc.IDTURMADISC = :idturmadisc and mc.IDCANVAS is not null

union

select convert(varchar(20),pt.idprofessorturma)  Codigo, 'prof'  Tipo, null ,ptgl.IDPROFESSORTURMA IDPROFESSORTURMAGERENCIAL
from sprofessorturma pt 
inner join sprofessorturmacompl ptc on ptc.IDPROFESSORTURMA = pt.IDPROFESSORTURMA
left join STURMADISCGERENCIADA tdgda on tdgda.IDTURMADISCGERENCIADA = pt.IDTURMADISC
left join SPROFESSORTURMA ptgl on ptgl.IDTURMADISC = tdgda.IDTURMADISC and ptgl.CODPROF = pt.CODPROF
where pt.IDTURMADISC = :idturmadisc and ptc.IDCANVAS is not null";747;;;;05/09/2022;roan.rossi;1;1;1;1;;;;0;5ce7e9a3-a86a-4b1a-ae67-2e92d6ef9a8e;0;;16602;roan.rossi;16/08/2022;roan.rossi;05/09/2022;0
S;SyncCanvas.11;Totvs->Canvas - Card Extra;"select 
	m.id IdMatriculaCard ,m.IdCanvasUsuario, c.IDCANVAS, c.IDCANVASSECAO
from 
	ZMDMATRICULACARDEXTRA m
	inner join ZMDCARDEXTRA c on c.ID = m.IDCARD
where 
	IDCANVASENROLLMENT=0
	and c.ACTIVE=1
order by 
	IDCARD, IDCANVASUSUARIO";243;;;;31/08/2022;roan.rossi;1;1;1;1;;;;0;666f146b-db0e-41a5-9b64-63e7217507de;0;;24294;isaldo;23/08/2022;roan.rossi;31/08/2022;0
S;SyncCanvas.12;Totvs->Canvas Notas;"select 
	m.RA,m.IDTURMADISC, mc.IDCANVAS IDCANVASMatricula , tdc.IDCANVAS IDCANVASDisciplina, ne.NOTAFALTA Nota, e.CODETAPA CodEtapa, ne.tipoetapa Validador

FROM
	STURMADISC						(nolock) td
	INNER JOIN STURMA				(nolock) t		on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET = td.IDPERLET
	INNER JOIN STURMADISCCOMPL		(nolock) tdc	on tdc.CODCOLIGADA = td.CODCOLIGADA and tdc.IDTURMADISC = td.IDTURMADISC
	left join  STURMADISCGERENCIADA	(nolock) tdgda	on tdgda.IDTURMADISC = td.IDTURMADISC
	left join  STURMADISCCOMPL		(nolock) tdgdac	on tdgdac.IDTURMADISC = tdgda.IDTURMADISCGERENCIADA

	INNER JOIN SMATRICULA			(nolock) m		on 
		m.CODCOLIGADA = td.CODCOLIGADA 
		and m.IDTURMADISC = case when td.GERENCIAL='S' then tdgda.IDTURMADISCGERENCIADA else td.IDTURMADISC end

	inner JOIN SMATRICULACompl		(nolock) mc		on mc.CODCOLIGADA = m.CODCOLIGADA and mc.IDTURMADISC = m.IDTURMADISC and mc.RA = m.RA
	INNER JOIN SMATRICPL			(nolock) mpl	on mpl.CODCOLIGADA = m.CODCOLIGADA and mpl.IDPERLET = m.IDPERLET and mpl.IDHABILITACAOFILIAL = m.IDHABILITACAOFILIAL and mpl.RA = m.RA
	INNER JOIN SPLETIVO				(nolock) pl		on pl.CODCOLIGADA = mpl.CODCOLIGADA and pl.IDPERLET = mpl.IDPERLET	
	inner join SETAPAS				(nolock) e		on e.CODCOLIGADA = m.CODCOLIGADA AND e.IDTURMADISC = m.IDTURMADISC
	left  join SNOTAETAPA			(nolock) ne		on ne.CODCOLIGADA = e.CODCOLIGADA AND ne.IDTURMADISC = e.IDTURMADISC AND ne.CODETAPA = e.CODETAPA and ne.TIPOETAPA = e.TIPOETAPA and ne.RA = m.RA
WHERE
	td.CODCOLIGADA = 1 
	and ((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	AND mpl.CODSTATUS in (2,23,27)
	and m.CODSTATUS in (2,23,27)
	and case when td.GERENCIAL='S' then tdgdac.IDSESSAO else tdc.IDSESSAO end is not null
	and mc.IDCANVAS is not null
	AND e.TIPOETAPA = 'N' 
	AND e.ETAPAFINAL = 'S'
	and tdc.CANVASNOTAS = 'T'

	";1905;;;;07/09/2022;roan.rossi;1;1;1;1;;;;0;e9bad640-040c-4060-bb8d-f38a5777e334;0;;18505;roan.rossi;05/09/2022;roan.rossi;07/09/2022;0
S;SyncCanvas.13;Totvs->Canvas - Desabilitar Usuários;"with usu as (
	Select distinct IDCANVAS from v_Unasp_SyncCanvas_4 Where IDCANVAS is not null)
Select distinct uc.Id
from 
	z_Unasp_UsuarioCanvas uc 
	left join usu on usu.IDCANVAS = uc.Id
Where 
	usu.IDCANVAS is null 
	and uc.Admin is null";247;;;;09/11/2022;isaldo;1;1;1;1;;;;0;106e0583-f9c3-4ed7-9848-972f7ef8935a;0;;13601;isaldo;09/11/2022;isaldo;09/11/2022;0
S;SyncCanvas.2;Totvs->Canvas - Disciplinas Gerenciais;"select distinct
	cfg.Valor NomFilial, 
	tc.NOME NomTipoCurso, 
	CODPERLET, 
	t.CODTURMA, 
	td.IDTURMADISC,
	cfgtt.Valor SubConta,
	tdcompl.IdCanvas, d.NOME NomDisciplina
from 
	STURMADISC						(nolock) td
	inner join STURMADISCGERENCIADA (nolock) tdg		on tdg.CODCOLIGADA = td.CODCOLIGADA and tdg.IDTURMADISC=td.IDTURMADISC
	inner join STURMADISCCOMPL		(nolock) tdcompl	on tdcompl.CODCOLIGADA = td.CODCOLIGADA and tdcompl.IDTURMADISC = td.IDTURMADISC
	inner join STURMA				(nolock) t			on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET=td.IDPERLET
	inner join GFILIAL				(nolock) f			on f.CODCOLIGADA = t.CODCOLIGADA and f.CODFILIAL=t.CODFILIAL
	inner join SDISCIPLINA			(nolock) d			on d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
	inner join SPLETIVO				(nolock) pl			on pl.CODCOLIGADA = t.CODCOLIGADA and pl.IDPERLET=t.IDPERLET	
	inner join STIPOCURSO			(nolock) tc			on tc.CODCOLIGADA = td.CODCOLIGADA and tc.CODTIPOCURSO = td.CODTIPOCURSO
	inner join z_Config				(nolock) cfg		on cfg.Grupo='Campus' and cfg.Item=td.CODFILIAL
	inner join GCONSIST				(nolock) tt			on tt.CODTABELA='TIPTURMA' and tt.CODCLIENTE = tdcompl.TIPOTURMADISC
	inner join z_Config				(nolock) cfgtt		on cfgtt.Grupo='Canvas_SubConta_Junção' and cfgtt.Item = tdcompl.TIPOTURMADISC
Where
	((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	and tdcompl.CANVAS='T' and tdcompl.IDCANVAS is null
order by
	IDCANVAS";1526;;;;06/07/2022;roan.rossi;1;1;1;1;;;;0;d32a1069-ce49-4ac1-bba7-abef1d1ffee8;0;;25342;isaldo;16/05/2022;roan.rossi;06/07/2022;0
S;SyncCanvas.3;Totvs->Canvas - Sessões;"select 
	pl.CODPERLET,
	'Normal' Tipo,
	tdcompl.IDCANVAS, 
	tdcompl.IDSESSAO,
	concat(f.NomeFantasia,' - ', c.NOME, ' - ', t.CODTURMA) NomSessao,
	td.IDTURMADISC
from 
	STURMADISC						(nolock) td
	inner join STURMADISCCOMPL		(nolock) tdcompl	on tdcompl.CODCOLIGADA = td.CODCOLIGADA and tdcompl.IDTURMADISC = td.IDTURMADISC
	inner join STURMA				(nolock) t		on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET=td.IDPERLET
	inner join GFILIAL				(nolock) f		on f.CODCOLIGADA = t.CODCOLIGADA and f.CODFILIAL=t.CODFILIAL
	inner join SDISCIPLINA			(nolock) d		on d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
	inner join SPLETIVO				(nolock) pl		on pl.CODCOLIGADA = t.CODCOLIGADA and pl.IDPERLET=t.IDPERLET	
	inner join SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = td.CODCOLIGADA and hf.IDHABILITACAOFILIAL = td.IDHABILITACAOFILIAL
	inner join SHABILITACAOFILIALPL	(nolock) hfpl	on hfpl.CODCOLIGADA = td.CODCOLIGADA and hfpl.IDHABILITACAOFILIAL = td.IDHABILITACAOFILIAL and hfpl.IDPERLET=pl.IDPERLET
	inner join STIPOCURSO			(nolock) tc		on tc.CODTIPOCURSO = hf.CODTIPOCURSO
	inner join SGRADE				(nolock) g		on g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
	inner join SHABILITACAO			(nolock) h		on h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
	inner join SCURSO				(nolock) c		on c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO
Where
	((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	and Canvas='T' and tdcompl.IDCANVAS is not null and tdcompl.IDSESSAO is null
	and td.IDTURMADISC not in (Select IDTURMADISCGERENCIADA from STURMADISCGERENCIADA(nolock))
	

union
select distinct
	pl.CODPERLET,
	'Gerenciadas' Tipo,
	tdcomplgl.IDCANVAS, tdcompl.IDSESSAO,
	concat(f.NomeFantasia,' - ',c.NOME, ' - ', t.CODTURMA) NomSessao,
	td.IDTURMADISC
from 
	STURMADISC						(nolock) tdgl
	inner join STURMADISCGERENCIADA (nolock) tdg		on tdg.CODCOLIGADA = tdgl.CODCOLIGADA and tdg.IDTURMADISC=tdgl.IDTURMADISC
	inner join STURMADISCCOMPL		(nolock) tdcomplgl	on tdcomplgl.CODCOLIGADA = tdg.CODCOLIGADA and tdcomplgl.IDTURMADISC = tdg.IDTURMADISC
	inner join STURMADISC			(nolock) td		on td.CODCOLIGADA = tdg.CODCOLIGADA and td.IDTURMADISC = tdg.IDTURMADISCGERENCIADA
	inner join STURMADISCCOMPL		(nolock) tdcompl	on tdcompl.CODCOLIGADA = td.CODCOLIGADA and tdcompl.IDTURMADISC = td.IDTURMADISC
	inner join STURMA				(nolock) t		on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET=td.IDPERLET
	inner join GFILIAL				(nolock) f		on f.CODCOLIGADA = t.CODCOLIGADA and f.CODFILIAL=t.CODFILIAL
	inner join SDISCIPLINA			(nolock) d		on d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
	inner join SPLETIVO				(nolock) pl		on pl.CODCOLIGADA = t.CODCOLIGADA and pl.IDPERLET=t.IDPERLET	
	inner join STIPOCURSO			(nolock) tc		on tc.CODCOLIGADA = td.CODCOLIGADA and tc.CODTIPOCURSO = td.CODTIPOCURSO	
	inner join SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = tdg.CODCOLIGADA and hf.IDHABILITACAOFILIAL = td.IDHABILITACAOFILIAL
	inner join SHABILITACAOFILIALPL	(nolock) hfpl	on hfpl.CODCOLIGADA = hf.CODCOLIGADA and hfpl.IDHABILITACAOFILIAL = hf.IDHABILITACAOFILIAL and hfpl.IDPERLET=pl.IDPERLET
	inner join SGRADE				(nolock) g		on g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
	inner join SHABILITACAO			(nolock) h		on h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
	inner join SCURSO				(nolock) c		on c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO
Where
	((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	and tdcomplgl.Canvas='T' and tdcomplgl.IDCANVAS is not null and tdcompl.IDSESSAO is null
	
order by
	IDCANVAS";4079;;;;25/07/2022;roan.rossi;1;1;1;1;;;;0;bdabc2e0-04fc-41ac-a43c-f16d13fac35c;0;;-7515;isaldo;16/05/2022;roan.rossi;25/07/2022;0
S;SyncCanvas.4;Totvs->Canvas - Novos Usuários;"Select distinct
	NOME,
	EMAIL,
	Password,
	CODIGO,
	CPF,
	Tipo,
	CODFILIAL,
	CODTIPOCURSO,
	CODPESSOA
From 
	v_Unasp_SyncCanvas_4
Where 
	IDCANVAS is null";167;;;;23/08/2022;isaldo;1;1;1;1;;;;0;02b9483a-bce5-4286-86a4-7519f9f27c20;0;;-30814;isaldo;06/07/2022;isaldo;23/08/2022;0
S;SyncCanvas.5;Totvs->Canvas - Matrícula;"SELECT
	case when tdcg.IDTURMADISC is null then tdc.IDCANVAS else tdcg.IDCANVAS end	IDCANVAS_Disciplina,
	 tdc.IDSESSAO,
	ac.IDCANVAS		IDCANVASUsuario,
	'Aluno'			perfil,
	td.Idturmadisc  IDTURMADISC,
	a.ra			RA,
	m.CODSTATUS	StatusMatricula,
	f.CODFILIAL,
	c.codTipoCurso,
	null IDPROFESSORTURMA
FROM
	SALUNO							(nolock) a
	left join SALUNOCOMPL			(nolock) ac		on ac.CODCOLIGADA = a.CODCOLIGADA and ac.RA=a.RA
	INNER JOIN PPESSOA				(nolock) p		on p.CODIGO = a.CODPESSOA
	INNER JOIN SMATRICPL			(nolock) mpl	on mpl.CODCOLIGADA = a.CODCOLIGADA and mpl.RA = a.RA
	INNER JOIN SPLETIVO				(nolock) pl		on pl.CODCOLIGADA = mpl.CODCOLIGADA and pl.IDPERLET = mpl.IDPERLET
	INNER JOIN SMATRICULA			(nolock) m		on m.CODCOLIGADA = mpl.CODCOLIGADA and m.IDPERLET = mpl.IDPERLET and m.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and m.RA = mpl.RA
	left JOIN SMATRICULACompl		(nolock) mc		on mc.CODCOLIGADA = m.CODCOLIGADA and mc.IDTURMADISC = m.IDTURMADISC and mc.RA = m.RA
	INNER JOIN STURMADISC			(nolock) td		on td.CODCOLIGADA = m.CODCOLIGADA and td.IDTURMADISC = m.IDTURMADISC
	INNER JOIN STURMA				(nolock) t		on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET = td.IDPERLET
	INNER JOIN STURMADISCCOMPL		(nolock) tdc	on tdc.CODCOLIGADA = td.CODCOLIGADA and tdc.IDTURMADISC = td.IDTURMADISC
	INNER JOIN SDISCIPLINA			(nolock) d		on d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
	INNER JOIN SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = mpl.CODCOLIGADA and hf.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL
	INNER JOIN SGRADE				(nolock) g		on g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
	INNER JOIN SHABILITACAO			(nolock) h		on h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
	INNER JOIN SCURSO				(nolock) c		on c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO
	INNER JOIN GFILIAL				(nolock) f		on f.CODCOLIGADA = hf.CODCOLIGADA and f.CODFILIAL = hf.CODFILIAL
	left join STURMADISCGERENCIADA	(nolock) tdg on tdg.IDTURMADISCGERENCIADA = td.IDTURMADISC
	left join STURMADISCCOMPL		(nolock) tdcg on tdcg.IDTURMADISC = tdg.IDTURMADISC
WHERE
	a.CODCOLIGADA = 1 
	and ((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	AND mpl.CODSTATUS in (2,23,27)
	and m.CODSTATUS in (2,23,27)
	AND case when tdcg.IDTURMADISC is null then tdc.CANVAS   else tdcg.CANVAS  end = 'T' 
	AND case when tdcg.IDTURMADISC is null then tdc.IDCANVAS else tdcg.IDCANVAS end IS NOT NULL
	and tdc.IDSESSAO is not null
	and c.NOME not like 'pensionato%'
	and ac.IDCANVAS is not null
	and mc.IDCANVAS is null

union	

SELECT
	tdglc.IDCANVAS		IDCANVAS_Disciplina,
	tdgac.IDSESSAO		IDSESSAO,
	profc.IDCANVAS		IDCANVASUsuario,
	case when tdgl.CODFILIAL = 4 then 'Tutor' else 'Professor' end Perfil,
	tdgl.IDTURMADISC	IDTURMADISC,
	null				RA,
	NULL				Status_da_Matricula,
	tdgl.CODFILIAL,
	tdgl.CODTIPOCURSO,
	pt.IDPROFESSORTURMA

FROM
	STURMADISC						(nolock) tdgl		
	INNER JOIN SPROFESSORTURMA		(nolock) pt		on	pt.CODCOLIGADA = tdgl.CODCOLIGADA AND pt.IDTURMADISC = tdgl.IDTURMADISC
	INNER JOIN SPROFESSORTURMACOMPL	(nolock) ptc	on	ptc.CODCOLIGADA = pt.CODCOLIGADA AND ptc.IDPROFESSORTURMA = pt.IDPROFESSORTURMA
	inner join SPROFESSOR			(nolock) prof	on	prof.CODCOLIGADA = pt.CODCOLIGADA and prof.CODPROF = pt.CODPROF
	left join  SPROFESSORCOMPL		(nolock) profc	on	profc.CODCOLIGADA = prof.CODCOLIGADA and profc.CODPROF = prof.CODPROF
	INNER JOIN PPESSOA				(nolock) p		on	p.CODIGO = prof.CODPESSOA 	
	inner join STURMADISCCOMPL		(nolock) tdglc	on  tdglc.CODCOLIGADA = tdgl.CODCOLIGADA AND tdglc.IDTURMADISC = tdgl.IDTURMADISC
	inner join STURMADISCGERENCIADA	(nolock) tdger	on	tdger.CODCOLIGADA = tdgl.CODCOLIGADA AND tdger.IDTURMADISC = tdgl.IDTURMADISC
	INNER JOIN STURMADISC			(nolock) tdga	on tdga.CODCOLIGADA = tdger.CODCOLIGADA AND tdga.IDTURMADISC = tdger.IDTURMADISCGERENCIADA
	INNER JOIN STURMADISCCOMPL		(nolock) tdgac	on tdgac.CODCOLIGADA = tdga.CODCOLIGADA AND tdgac.IDTURMADISC = tdga.IDTURMADISC	
	INNER JOIN SPLETIVO				(nolock) pl		on pl.CODCOLIGADA=tdgl.CODCOLIGADA AND pl.IDPERLET=tdgl.IDPERLET
WHERE
	prof.CODCOLIGADA = 1 
	and ((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	AND tdglc.CANVAS = 'T' and tdglc.IDCANVAS IS NOT NULL
	and tdgac.IDSESSAO is not null
	and profc.IDCANVAS is not null
	and ptc.idcanvas is null

union

SELECT
	tdc.IDCANVAS	IDCANVAS_Disciplina,
	tdc.IDSESSAO	IDSESSAO,
	profc.IDCANVAS	IDCANVASUsuario,
	case when f.CODFILIAL = 4 then 'Tutor' else 'Professor' end Perfil,
	td.Idturmadisc  IDTURMADISC,
	null			RA,
	NULL	Status_da_Matricula,
	t.CODFILIAL,
	c.codTipoCurso,
	pt.IDPROFESSORTURMA
FROM
	SPROFESSOR						(nolock) prof
	left join SPROFESSORCOMPL		(nolock) profc on profc.CODCOLIGADA=prof.CODCOLIGADA and profc.CODPROF = prof.CODPROF
	INNER JOIN PPESSOA				(nolock) p	ON p.CODIGO = prof.CODPESSOA 
	INNER JOIN SPROFESSORTURMA		(nolock) pt	ON pt.CODCOLIGADA=prof.CODCOLIGADA AND pt.CODPROF=prof.CODPROF
	left join sprofessorturmacompl	(nolock) ptc	ON ptc.CODCOLIGADA=pt.CODCOLIGADA and ptc.IDPROFESSORTURMA = pt.IDPROFESSORTURMA
	INNER JOIN STURMADISC			(nolock) td	ON td.CODCOLIGADA = pt.CODCOLIGADA AND td.IDTURMADISC = pt.IDTURMADISC
	INNER JOIN SDISCIPLINA			(nolock) d	ON d.CODDISC = td.CODDISC AND d.CODCOLIGADA = td.CODCOLIGADA
	INNER JOIN STURMA				(nolock) t	ON t.CODCOLIGADA = td.CODCOLIGADA AND t.CODFILIAL = td.CODFILIAL AND td.CODTURMA=t.CODTURMA AND t.IDPERLET=td.IDPERLET 
	inner join SHABILITACAOFILIAL	(nolock) hf	on hf.CODCOLIGADA=t.CODCOLIGADA and hf.IDHABILITACAOFILIAL=t.IDHABILITACAOFILIAL
	inner join SCURSO				(nolock) c	on c.CODCOLIGADA = hf.CODCOLIGADA and c.CODCURSO=hf.CODCURSO
	INNER JOIN STURMADISCCOMPL		(nolock) tdc ON tdc.CODCOLIGADA = td.CODCOLIGADA AND tdc.IDTURMADISC = td.IDTURMADISC
	INNER JOIN SPLETIVO				(nolock) pl	ON pl.CODCOLIGADA=t.CODCOLIGADA AND pl.IDPERLET=t.IDPERLET
	INNER JOIN GFILIAL				(nolock) f	ON  f.CODCOLIGADA = hf.CODCOLIGADA AND f.CODFILIAL = hf.CODFILIAL
WHERE
	prof.CODCOLIGADA = 1 
	and ((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	AND tdc.CANVAS = 'T' 
	AND tdc.IDCANVAS IS NOT NULL
	and tdc.IDSESSAO is not null
	and c.NOME not like 'pensionato%'
	and profc.IDCANVAS is not null
	and td.IDTURMADISC not in (Select IDTURMADISCGERENCIADA from STURMADISCGERENCIADA (nolock))
	and ptc.idcanvas is null";6662;;;;18/08/2022;roan.rossi;1;1;1;1;;;;0;3cd95846-995c-4ab4-bf5d-6738cd965f35;0;;-27844;isaldo;06/07/2022;roan.rossi;18/08/2022;0
S;SyncCanvas.6;Totvs->Canvas - Lista de Sessões para excluir;"select distinct IDSESSAO from (
select 
	pl.CODPERLET,
	'Normal' Tipo,
	tdcompl.IDCANVAS, 
	tdcompl.IDSESSAO,
	concat(c.NOME, ' - ', t.CODTURMA) NomSessao,
	td.IDTURMADISC
from 
	STURMADISC						(nolock) td
	inner join STURMADISCCOMPL		(nolock) tdcompl	on tdcompl.CODCOLIGADA = td.CODCOLIGADA and tdcompl.IDTURMADISC = td.IDTURMADISC
	inner join STURMA				(nolock) t		on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET=td.IDPERLET
	inner join GFILIAL				(nolock) f		on f.CODCOLIGADA = t.CODCOLIGADA and f.CODFILIAL=t.CODFILIAL
	inner join SDISCIPLINA			(nolock) d		on d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
	inner join SPLETIVO				(nolock) pl		on pl.CODCOLIGADA = t.CODCOLIGADA and pl.IDPERLET=t.IDPERLET	
	inner join SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = td.CODCOLIGADA and hf.IDHABILITACAOFILIAL = td.IDHABILITACAOFILIAL
	inner join SHABILITACAOFILIALPL	(nolock) hfpl	on hfpl.CODCOLIGADA = td.CODCOLIGADA and hfpl.IDHABILITACAOFILIAL = td.IDHABILITACAOFILIAL and hfpl.IDPERLET=pl.IDPERLET
	inner join STIPOCURSO			(nolock) tc		on tc.CODTIPOCURSO = hf.CODTIPOCURSO
	inner join SGRADE				(nolock) g		on g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
	inner join SHABILITACAO			(nolock) h		on h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
	inner join SCURSO				(nolock) c		on c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO
Where
	((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	and Canvas='T' and tdcompl.IDCANVAS is not null and tdcompl.IDSESSAO is not null
	and td.IDTURMADISC not in (Select IDTURMADISCGERENCIADA from STURMADISCGERENCIADA(nolock))
	

union
select distinct
	pl.CODPERLET,
	'Gerenciadas' Tipo,
	tdcomplgl.IDCANVAS, tdcompl.IDSESSAO,
	concat(c.NOME, ' - ', t.CODTURMA) NomSessao,
	td.IDTURMADISC
from 
	STURMADISC						(nolock) tdgl
	inner join STURMADISCGERENCIADA (nolock) tdg		on tdg.CODCOLIGADA = tdgl.CODCOLIGADA and tdg.IDTURMADISC=tdgl.IDTURMADISC
	inner join STURMADISCCOMPL		(nolock) tdcomplgl	on tdcomplgl.CODCOLIGADA = tdg.CODCOLIGADA and tdcomplgl.IDTURMADISC = tdg.IDTURMADISC
	inner join STURMADISC			(nolock) td		on td.CODCOLIGADA = tdg.CODCOLIGADA and td.IDTURMADISC = tdg.IDTURMADISCGERENCIADA
	inner join STURMADISCCOMPL		(nolock) tdcompl	on tdcompl.CODCOLIGADA = td.CODCOLIGADA and tdcompl.IDTURMADISC = td.IDTURMADISC
	inner join STURMA				(nolock) t		on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET=td.IDPERLET
	inner join GFILIAL				(nolock) f		on f.CODCOLIGADA = t.CODCOLIGADA and f.CODFILIAL=t.CODFILIAL
	inner join SDISCIPLINA			(nolock) d		on d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
	inner join SPLETIVO				(nolock) pl		on pl.CODCOLIGADA = t.CODCOLIGADA and pl.IDPERLET=t.IDPERLET	
	inner join STIPOCURSO			(nolock) tc		on tc.CODCOLIGADA = td.CODCOLIGADA and tc.CODTIPOCURSO = td.CODTIPOCURSO	
	inner join SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = tdg.CODCOLIGADA and hf.IDHABILITACAOFILIAL = td.IDHABILITACAOFILIAL
	inner join SHABILITACAOFILIALPL	(nolock) hfpl	on hfpl.CODCOLIGADA = hf.CODCOLIGADA and hfpl.IDHABILITACAOFILIAL = hf.IDHABILITACAOFILIAL and hfpl.IDPERLET=pl.IDPERLET
	inner join SGRADE				(nolock) g		on g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
	inner join SHABILITACAO			(nolock) h		on h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
	inner join SCURSO				(nolock) c		on c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO
Where
	((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	and tdcomplgl.Canvas='T' and tdcomplgl.IDCANVAS is not null and tdcompl.IDSESSAO is not null
) x
order by
	IDSESSAO";4079;;;;25/07/2022;roan.rossi;1;1;1;1;;;;0;23602226-3215-4232-b749-b709c40bb177;0;;-26445;roan.rossi;25/07/2022;isaldo;09/11/2022;0
S;SyncCanvas.7;Totvs->Canvas - Desmatrícula ;"SELECT
	case when tdcg.IDTURMADISC is null then tdc.IDCANVAS else tdcg.IDCANVAS end	IDCANVAS_Disciplina,
	td.Idturmadisc  IDTURMADISC,
	a.ra			RA,
	m.CODSTATUS	StatusMatricula,
	f.CODFILIAL,
	c.codTipoCurso,
	mc.IDCANVAS IdEnroll
FROM
	SALUNO							(nolock) a
	left join SALUNOCOMPL			(nolock) ac		on ac.CODCOLIGADA = a.CODCOLIGADA and ac.RA=a.RA
	INNER JOIN PPESSOA				(nolock) p		on p.CODIGO = a.CODPESSOA
	INNER JOIN SMATRICPL			(nolock) mpl	on mpl.CODCOLIGADA = a.CODCOLIGADA and mpl.RA = a.RA
	INNER JOIN SPLETIVO				(nolock) pl		on pl.CODCOLIGADA = mpl.CODCOLIGADA and pl.IDPERLET = mpl.IDPERLET
	INNER JOIN SMATRICULA			(nolock) m		on m.CODCOLIGADA = mpl.CODCOLIGADA and m.IDPERLET = mpl.IDPERLET and m.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and m.RA = mpl.RA
	left JOIN SMATRICULACompl		(nolock) mc		on mc.CODCOLIGADA = m.CODCOLIGADA and mc.IDTURMADISC = m.IDTURMADISC and mc.RA = m.RA
	INNER JOIN STURMADISC			(nolock) td		on td.CODCOLIGADA = m.CODCOLIGADA and td.IDTURMADISC = m.IDTURMADISC
	INNER JOIN STURMA				(nolock) t		on t.CODCOLIGADA = td.CODCOLIGADA and t.CODFILIAL = td.CODFILIAL and t.CODTURMA = td.CODTURMA and t.IDPERLET = td.IDPERLET
	INNER JOIN STURMADISCCOMPL		(nolock) tdc	on tdc.CODCOLIGADA = td.CODCOLIGADA and tdc.IDTURMADISC = td.IDTURMADISC
	INNER JOIN SDISCIPLINA			(nolock) d		on d.CODCOLIGADA = td.CODCOLIGADA and d.CODDISC = td.CODDISC
	INNER JOIN SHABILITACAOFILIAL	(nolock) hf		on hf.CODCOLIGADA = mpl.CODCOLIGADA and hf.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL
	INNER JOIN SGRADE				(nolock) g		on g.CODCOLIGADA = hf.CODCOLIGADA and g.CODCURSO = hf.CODCURSO and g.CODHABILITACAO = hf.CODHABILITACAO and g.CODGRADE = hf.CODGRADE
	INNER JOIN SHABILITACAO			(nolock) h		on h.CODCOLIGADA = g.CODCOLIGADA and h.CODCURSO = g.CODCURSO and h.CODHABILITACAO = g.CODHABILITACAO
	INNER JOIN SCURSO				(nolock) c		on c.CODCOLIGADA = h.CODCOLIGADA and c.CODCURSO = h.CODCURSO
	INNER JOIN GFILIAL				(nolock) f		on f.CODCOLIGADA = hf.CODCOLIGADA and f.CODFILIAL = hf.CODFILIAL
	left join STURMADISCGERENCIADA	(nolock) tdg on tdg.IDTURMADISCGERENCIADA = td.IDTURMADISC
	left join STURMADISCCOMPL		(nolock) tdcg on tdcg.IDTURMADISC = tdg.IDTURMADISC
WHERE
	a.CODCOLIGADA = 1 
	and ((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
	AND m.CODSTATUS in (3,4,5,6,7,13,14,16,20,28,32,33,38,47,50,52,59,60,61,66)
	AND case when tdcg.IDTURMADISC is null then tdc.CANVAS   else tdcg.CANVAS  end = 'T' 
	AND case when tdcg.IDTURMADISC is null then tdc.IDCANVAS else tdcg.IDCANVAS end IS NOT NULL
	and tdc.IDSESSAO is not null
	and c.NOME not like 'pensionato%'
	and ac.IDCANVAS is not null
	and mc.IDCANVAS is not null
	";2731;;;;18/08/2022;roan.rossi;1;1;1;1;;;;0;40934c02-3464-4621-984a-724f4e92622d;0;;-20589;roan.rossi;03/08/2022;roan.rossi;18/08/2022;0
S;SyncCanvas.8;Totvs->Canvas - Desmatrícula sem registro no totvs ;"Select id,idcanvas  from ZMDLOGSINCCANVAS where tabela = 'smatricula' and DATAEXCLUSAO = 0 and idtotvs not in (
	select 
		concat(m.codcoligada,'|',m.idturmadisc,'|',m.ra) 
	from 
		smatricula m
		inner join SMATRICULACOMPL mpl on mpl.CODCOLIGADA = m.CODCOLIGADA and mpl.IDTURMADISC = m.IDTURMADISC and mpl.RA=m.RA
		inner join STURMADISC td on td.CODCOLIGADA = m.CODCOLIGADA and td.IDTURMADISC = m.IDTURMADISC
		inner join SPLETIVO pl on pl.CODCOLIGADA = td.CODCOLIGADA and pl.IDPERLET = td.IDPERLET)
union
Select id,idcanvas  from ZMDLOGSINCCANVAS where tabela = 'sprofessorturma' and DATAEXCLUSAO = 0  and idtotvs not in (
	select idprofessorturma from sprofessorturma)
";684;;;;10/08/2022;roan.rossi;1;1;1;1;;;;0;0b9b9398-64e7-453b-842d-6ba69e1e65e1;0;;8320;roan.rossi;09/08/2022;roan.rossi;10/08/2022;0
S;SyncCanvas.9;Totvs->Canvas - Ressincronizar;"Select td.idturmadisc,td.CODTIPOCURSO,td.CODFILIAL,tdc.IDSESSAO
from sturmadisc					(nolock) td 
inner join sturmadisccompl		(nolock) tdc on td.idturmadisc = tdc.IDTURMADISC
INNER JOIN SPLETIVO				(nolock) pl	 on pl.CODCOLIGADA = td.CODCOLIGADA and pl.IDPERLET = td.IDPERLET
Where ((getdate() between pl.DTINICIO and pl.DTFIM) or (getdate() > pl.DTINICIO and pl.DTFIM is null))
and tdc.RESSINCRONIZAR = 'T'
and td.GERENCIAL = 'N'";435;;;;30/08/2022;roan.rossi;1;1;1;1;;;;0;94e49fc2-5478-4df8-b2a5-7ddfa0b6c08a;0;;-24081;roan.rossi;16/08/2022;roan.rossi;30/08/2022;0
S;TERMO RESPONSABI;TERMO DE RESPONSABILIDADE ACADEMICA;"SELECT SALUNO.CODCOLIGADA,
       SALUNO.RA,
       B.NOME         RESPONSAVELACADEMICO,
       PPESSOA.NOME   NOMEALUNO,
       GCOLIGADA.NOME NOMEINSTITUICAO,
       GIMAGEM.IMAGEM,
       GCOLIGADA.CIDADE
FROM   SALUNO (NOLOCK)
       INNER JOIN SPESSOA
         ON SALUNO.CODPESSOA = SPESSOA.CODIGO
       INNER JOIN PPESSOA
         ON SPESSOA.CODIGO = PPESSOA.CODIGO
       INNER JOIN SPESSOA C (NOLOCK)
         ON SALUNO.CODPESSOARACA = C.CODIGO
       INNER JOIN PPESSOA B (NOLOCK)
         ON C.CODIGO = B.CODIGO
       INNER JOIN GCOLIGADA (NOLOCK)
         ON SALUNO.CODCOLIGADA = GCOLIGADA.CODCOLIGADA
       LEFT JOIN GIMAGEM (NOLOCK)
         ON GCOLIGADA.IDIMAGEM = GIMAGEM.ID ";;;;;;;1;1;1;1;;;;;;;;22796;RM;30/05/2012;RM;30/05/2012;
S;TESTE;Cartão de Identificação;"SELECT 
	s1.NOME,
	s.NUMEROINSCRICAO [NÚMERO DE INSCRIÇÃO],
	s4.NOME CURSO,
	g.NOME CAMPUS,
	ISNULL ((s1.CPF + ' - CPF'),(s1.NPASSAPORTE + ' - Passaporte')) [DOCUMENTO DE IDENTIFICAÇÃO]
	

FROM 
	SPSINSCRICAOAREAOFERTADA s
	INNER JOIN SPSUSUARIO s1 ON s.CODUSUARIOPS = s1.CODUSUARIOPS
	INNER JOIN SPSOPCAOINSCRITO s2 ON s.CODCOLIGADA = s2.CODCOLIGADA AND s.IDPS = s2.IDPS AND s.NUMEROINSCRICAO = s2.NUMEROINSCRICAO
	INNER JOIN SPSAREAOFERTADA s3 ON s2.CODCOLIGADA = s3.CODCOLIGADA AND s2.IDPS = s3.IDPS AND s2.IDAREAINTERESSE = s3.IDAREAINTERESSE
	INNER JOIN SPSAREAINTERESSE s4 ON s3.IDAREAINTERESSE = s4.IDAREAINTERESSE
	INNER JOIN SPSPROCESSOSELETIVO s5 ON s.IDPS=s5.IDPS
	INNER JOIN GFILIAL g ON s5.CODFILIAL=g.CODFILIAL
	
	WHERE s.NUMEROINSCRICAO = :NUMEROINSCRICAO OR :NUMEROINSCRICAO = 0
   ";801;;;;20/01/2021;mestre;1;1;1;1;;;;0;644e4e24-d26a-412f-809d-69e74851e108;0;;-29892;mestre;20/01/2021;mestre;20/01/2021;0
S;TESTE 01;TESTE 01 DEVs;"SELECT DESCRICAO, CODCLIENTE FROM

(SELECT
  CAST(GCONSIST.CODCLIENTE AS INT) AS CODCLIENTE,
  GCONSIST.DESCRICAO
 
 FROM
  GCONSIST (NOLOCK)
  
   OUTER APPLY(
 SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 FROM
  SCURSO (NOLOCK)
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
											   AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
 WHERE	SCURSO.CODCOLIGADA = 1
 	/*AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL*/

)
TABELA 
) AS A

  
 
 WHERE	GCONSIST.APLICACAO = 'H'
	AND GCONSIST.CODTABELA = 'QDESEM'
	AND A.CODCURSO LIKE '%EAD%'
	
	
	/*
UNION ALL

SELECT
  CAST(GCONSIST.CODCLIENTE AS INT) AS CODCLIENTE,
  GCONSIST.DESCRICAO
 
 FROM
  GCONSIST (NOLOCK)
  
   OUTER APPLY(
 SELECT CURSO, CODCURSO FROM

(SELECT
  SCURSO.CODCURSO,
  SCURSO.NOME CURSO
 FROM
  SCURSO (NOLOCK)
  INNER JOIN SHABILITACAOFILIAL (NOLOCK)	ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA AND
  											   SHABILITACAOFILIAL.CODTIPOCURSO = SCURSO.CODTIPOCURSO
											   AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
 WHERE	SCURSO.CODCOLIGADA = :CODCOLIGADA
 	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = :IDHABILITACAOFILIAL

)
TABELA 
) AS A

  
 
 WHERE	GCONSIST.APLICACAO = 'H'
	AND GCONSIST.CODTABELA = 'QDESEM'
	AND A.CODCURSO NOT LIKE '%EAD%'
	AND CAST(GCONSIST.CODCLIENTE AS INT) <=10
*/)

TABELA /*WHERE*/

ORDER BY 2
";1580;;;;10/08/2022;consultor1.totvs;1;1;1;1;;;;0;6769bc54-7c83-4f26-8854-849acb7087cb;0;;-16362;sergio;19/01/2021;consultor1.totvs;10/08/2022;0
S;teste Contab;teste contabilidade;SP_UNASP_LOTECONTABIL_test 2, '01/01/2022 00:00:00', '04/01/2022 00:00:00', 'BR', 1, 2, 0, 0;92;;;;16/03/2022;isaldo;1;1;1;1;;;;0;6ded7266-eb53-4f7f-96a6-4da8576d99d9;0;;-9646;isaldo;16/03/2022;isaldo;16/03/2022;0
S;teste.novo;novo teste;"with base as (
select CODPERLET, NomFilial, NomCurso, ModalidadeCurso, Religiao, NomTipoMatricula, count(*) Matriculas
from 
	v_Unasp_SMATRICPL where CODPERLET > :CODPERLET and CODTIPOCURSO = :CODTIPOCURSO and NomStatus in ('Concluído','Cursando')
group by 
	CODPERLET, NomFilial, NomCurso, ModalidadeCurso, Religiao, NomTipoMatricula)

Select 
	*, 
	(select Sum(Matriculas) from base bt where bt.CODPERLET = b.CODPERLET and bt.NomFilial=b.NomFilial and bt.NomCurso=b.NomCurso) Totalalunos
from base b";511;;;;08/09/2022;marccella.belvedere;1;1;1;1;;;;0;10b2932f-13fd-4363-ba87-cb2ba252ca3a;0;;24592;marccella.belvedere;08/09/2022;marccella.belvedere;08/09/2022;0
S;TESTE01;teste;"select shabilitacaoaluno.*
  from shabilitacaoaluno (NOLOCK)
 inner join shabilitacaofilial on shabilitacaoaluno.codcoligada = shabilitacaofilial.codcoligada and shabilitacaoaluno.idhabilitacaofilial = shabilitacaofilial.idhabilitacaofilial
 where shabilitacaoaluno.dtcolacaograu >= :dtcolacaograu_D
   and shabilitacaoaluno.codcoligada = :$CODCOLIGADA
   and shabilitacaofilial.codfilial = :$CODFILIAL";407;;;;02/05/2022;edison.pitoli;1;1;1;1;;;;0;28a0e135-d00b-4e20-b538-b2ba23f91839;0;;-23128;maik.souza;02/05/2022;edison.pitoli;02/05/2022;0
S;TESTE1;TESTE;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'Filial',
	SCURSO.NOME AS 'CURSO',
	SALUNO.RA,
	PPESSOA.NOME,
	PPESSOA.NOMESOCIAL,
	SSTATUS.DESCRICAO,
	PPESSOA.EMAIL,
	PPESSOA.TELEFONE1,
	PPESSOA.TELEFONE2
FROM SALUNO
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SALUNO.RA
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SMATRICPL.RA = SHABILITACAOALUNO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
WHERE PPESSOA.NOMESOCIAL IS NOT NULL
	AND SPLETIVO.CODPERLET = '2022/1'
	AND SSTATUS.DESCRICAO NOT LIKE '%CANCELADO%'";1356;;;;15/03/2022;consultor1.totvs;1;1;1;1;;;;0;4128bbe4-db56-477c-bbd1-83d16cd97b2a;0;;-22565;mestre;05/05/2021;consultor1.totvs;15/03/2022;0
S;TESTE11;TESTE11;"select *
from saluno";21;;;;21/01/2021;lucas.biagio;1;1;1;1;;;;0;a414f3c7-9ac2-4db5-99df-bc9246494002;0;;10817;lucas.biagio;21/01/2021;lucas.biagio;21/01/2021;0
S;TesteEmail;Teste Email Isaldo;"Select 'isaldo.pacheco@gmail.com' Email
from GCOLIGADA Where codcoligada=1
union
Select 'isaldo.pacheco@ucb.org.br' Email
from GCOLIGADA Where codcoligada=1";160;;;;15/09/2021;isaldo;1;1;1;1;;;;0;f7cc3f8e-0f30-4fe4-9903-1ce41b981ed2;0;;22956;isaldo;15/09/2021;isaldo;15/09/2021;0
S;testehoje;teste hoje;select * from gconssql;22;;;;17/11/2022;maik.souza;1;1;1;1;;;;0;23ebaecd-1b8b-4056-a230-492e22f89497;0;;11534;maik.souza;03/05/2022;maik.souza;17/11/2022;0
S;testehoje1;Teste Quantidade Curso no Periodo Letivo;"select 
	
	spletivo.codperlet AS 'Periodo Letivo',
	gfilial.nome AS 'Filial',
	scurso.nome AS 'Curso',
	stipocurso.nome AS 'Nível de Ensino',
	COUNT(distinct scurso.codcurso) AS 'Qtd. Cursos'
	

	

from smatricpl (nolock)
INNER JOIN spletivo (NOLOCK) 
		ON spletivo.idperlet = smatricpl.idperlet
INNER JOIN sstatus (NOLOCK)
		ON sstatus.codstatus = smatricpl.codstatus 		
INNER JOIN shabilitacaofilial (NOLOCK)
		ON shabilitacaofilial.idhabilitacaofilial = smatricpl.idhabilitacaofilial
inner JOIN scurso (NOLOCK)
		ON scurso.codcurso = shabilitacaofilial.codcurso
INNER JOIN gfilial (NOLOCK)
		ON gfilial.codfilial = shabilitacaofilial.codfilial
INNER JOIN stipocurso (NOLOCK)
		ON stipocurso.codtipocurso = scurso.codtipocurso
INNER JOIN salunocompl (NOLOCK)
 		ON salunocompl.ra = smatricpl.ra

			
Where
	spletivo.codperlet like '%' + :Ano_PerLet + '%'
	and scurso.complemento like '%' + :BacharelOuLicencia + '%'
	and scurso.complemento not like '%' + 'Pensionato' + '%'
	and sstatus.descricao in ('Concluído', 'Cursando', 'Contrato Assinado')
	
	
group by spletivo.codperlet ,
	gfilial.nome,
	scurso.nome,
	stipocurso.nome ";1167;;;;08/09/2022;maik.souza;1;1;1;1;;;;0;a034dd2e-721d-4ced-ab72-b08e10f4e245;0;;-15520;maik.souza;07/09/2022;maik.souza;08/09/2022;0
S;testehoje2;Teste Matricula Por Religião;"with base as (
select CODPERLET, NomFilial, NomCurso, ModalidadeCurso, Religiao, NomTipoMatricula, count(*) Matriculas
from 
	v_Unasp_SMATRICPL where CODTIPOCURSO = :CODTIPOCURSO and NomStatus in ('Concluído','Cursando')
group by 
	CODPERLET, NomFilial, NomCurso, ModalidadeCurso, Religiao, NomTipoMatricula)

Select 
	*, 
	(select Sum(Matriculas) from base bt where bt.CODPERLET = b.CODPERLET and bt.NomFilial=b.NomFilial and bt.NomCurso=b.NomCurso) TotalCurso
from base b";483;;;;08/09/2022;maik.souza;1;1;1;1;;;;0;a813b95b-c1a3-4921-882d-6415b5bd6ad2;0;;17795;maik.souza;12/05/2022;maik.souza;08/09/2022;0
S;testehoje3;Quantidade de Alunos por Turma Por Turma;"select 
	
	smatricpl.codturma AS 'Turma',
	sstatus.descricao AS 'Status',
	spletivo.codperlet AS 'Periodo Letivo',
	scurso.nome AS 'Curso',
	gfilial.nome AS 'Filial',
	stipocurso.nome AS 'Nível de Ensino',
	scurso.complemento AS 'Modalidade',
	COUNT(distinct smatricpl.codturma)  AS 'Qtd. Turmas',
	COUNT(distinct scurso.codcurso) AS 'Qtd. Cursos',
	COUNT(distinct smatricpl.ra) AS 'Qtd. Matriculas'
	
	
	

from smatricpl (nolock)
INNER JOIN spletivo (NOLOCK) 
		ON spletivo.idperlet = smatricpl.idperlet
INNER JOIN sstatus (NOLOCK)
		ON sstatus.codstatus = smatricpl.codstatus 		
INNER JOIN shabilitacaofilial (NOLOCK)
		ON shabilitacaofilial.idhabilitacaofilial = smatricpl.idhabilitacaofilial
inner JOIN scurso (NOLOCK)
		ON scurso.codcurso = shabilitacaofilial.codcurso
INNER JOIN gfilial (NOLOCK)
		ON gfilial.codfilial = shabilitacaofilial.codfilial
INNER JOIN stipocurso (NOLOCK)
		ON stipocurso.codtipocurso = scurso.codtipocurso
INNER JOIN salunocompl (NOLOCK)
 		ON salunocompl.ra = smatricpl.ra
			
Where
	spletivo.codperlet like '%' + :Ano_PerLet + '%'
	and scurso.complemento like '%' + :BacharelOuLicencia + '%'

GROUP BY smatricpl.codturma ,
	sstatus.descricao ,
	spletivo.codperlet ,
	scurso.nome ,
	gfilial.nome ,
	stipocurso.nome,
	scurso.complemento";1310;;;;07/09/2022;maik.souza;1;1;1;1;;;;0;93a159f3-a8c3-44d5-a8ad-f94104beef4c;0;;1153;maik.souza;07/09/2022;maik.souza;07/09/2022;0
S;testeIPL;TESTE SQL;select * from flanboletobaixa where idlan = 6226;48;;;;23/08/2021;mestre;1;1;1;1;;;;0;bb48de0d-9943-4d70-a138-9f09f2598539;0;;22343;mestre;23/08/2021;mestre;23/08/2021;0
S;testeIPL12;teste;select * from getd;18;;;;08/12/2021;raphael.muzy;1;1;1;1;;;;0;3e3d81de-8758-4a63-86de-b8b43301f7c4;0;;23574;raphael.muzy;08/12/2021;raphael.muzy;08/12/2021;0
S;testembm;;"SELECT STURMADISC.IDTURMADISC
	FROM STURMADISC (NOLOCK)
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMADISC.IDPERLET
			AND SPLETIVO.CODFILIAL = STURMADISC.CODFILIAL
			AND SPLETIVO.CODTIPOCURSO = STURMADISC.CODTIPOCURSO
		INNER JOIN SDISCIPLINA (NOLOCK) ON
			SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	    OUTER APPLY (SELECT COUNT(AULA)QTDE
						FROM SPLANOAULA
      				 WHERE IDTURMADISC = STURMADISC.IDTURMADISC)AULAS
WHERE STURMADISC.CODCOLIGADA = :$CODCOLIGADA
AND STURMADISC.CODFILIAL = :$CODFILIAL
AND STURMADISC.CODTIPOCURSO = :$CODTIPOCURSO
AND SPLETIVO.CODPERLET = :CODPERLET_S
AND SDISCIPLINA.NUMCREDITOS = :CREDITOS_N
AND AULAS.QTDE < (SDISCIPLINA.NUMCREDITOS * 18)";824;;;;17/06/2022;marccella.belvedere;1;1;1;1;;;;0;547a40b7-7d47-4c57-8688-2495af8d864b;0;;-11673;marccella.belvedere;17/06/2022;marccella.belvedere;17/06/2022;0
S;thiago.teste;teste;"SELECT 
	GFILIAL.NOMEFANTASIA AS 'UNIDADE',
	STIPOCURSO.NOME AS 'NIVEL ENSINO',
	SCONTRATO.CODCONTRATO,
	PPESSOA.NOME AS 'ALUNO',
	SCURSO.NOME AS 'CURSO',
	SCONTRATO.RA,
	SSTATUS.DESCRICAO AS 'STATUS CURSO',
	SMATRICPL.CODTURMA,
	SPLETIVO.CODFILIAL,
	SPLETIVO.CODTIPOCURSO,
	SSERVICO.NOME AS 'SERVICO',
	SPARCELA.PARCELA,
	SPARCELA.DTVENCIMENTO,
	SCONTRATO.CODCOLIGADA,
	SCONTRATO.CODCONTRATO,
	SCONTRATO.RA,
	SCONTRATO.IDPERLET,
	SCONTRATO.IDHABILITACAOFILIAL
FROM SCONTRATO
INNER JOIN SMATRICPL ON SMATRICPL.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SMATRICPL.IDPERLET = SCONTRATO.IDPERLET
	AND SMATRICPL.RA = SCONTRATO.RA
	AND SMATRICPL.IDHABILITACAOFILIAL = SCONTRATO.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOALUNO ON SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
INNER JOIN SHABILITACAOFILIAL ON SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
INNER JOIN SCURSO ON SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
	AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
INNER JOIN SSTATUS ON SSTATUS.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
	AND SSTATUS.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
INNER JOIN SPARCELA ON SPARCELA.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPARCELA.RA = SCONTRATO.RA
	AND SPARCELA.CODCONTRATO = SCONTRATO.CODCONTRATO
	AND SPARCELA.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN SSERVICO ON SSERVICO.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SSERVICO.CODSERVICO = SPARCELA.CODSERVICO
INNER JOIN SPLETIVO ON SPLETIVO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SPLETIVO.IDPERLET = SCONTRATO.IDPERLET
INNER JOIN STIPOCURSO ON STIPOCURSO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND STIPOCURSO.CODTIPOCURSO = SPLETIVO.CODTIPOCURSO
INNER JOIN GFILIAL ON GFILIAL.CODCOLIGADA = SPLETIVO.CODCOLIGADA
	AND GFILIAL.CODFILIAL = SPLETIVO.CODFILIAL
INNER JOIN SALUNO ON SALUNO.CODCOLIGADA = SCONTRATO.CODCOLIGADA
	AND SALUNO.RA = SCONTRATO.RA
INNER JOIN PPESSOA ON PPESSOA.CODIGO = SALUNO.CODPESSOA
LEFT JOIN SLAN ON SLAN.CODCOLIGADA = SPARCELA.CODCOLIGADA
	AND SLAN.IDPARCELA = SPARCELA.IDPARCELA
WHERE SLAN.CODCOLIGADA IS NULL
AND SPLETIVO.CODPERLET = :CODPERLET
AND SPARCELA.DTVENCIMENTO BETWEEN :DTVENCINI_D AND :DTVENCFIN_D
AND SCONTRATO.STATUS = 'N'";2436;;;;27/04/2022;consultor1.totvs;1;1;1;1;;;;0;8df62f42-56e8-4c9c-bfb5-ac5c4dfde007;0;;-28399;consultor1.totvs;17/11/2021;consultor1.totvs;27/04/2022;0
S;thiago.teste2;teste;"/****
	Função: Toda vez que o candidato logar ele executa logo em seguida essa consulta para buscar dados no TOTVS e sincronizar no Inscrições e Matrículas, ou seja, 
	todos dados que precisam ser sincronizados entre as bases precisam estar nessa consulta.
****/
WITH DOCUMENTOS(NOMEARQUIVO,CODDOCUMENTO,OBRIGATORIO,ENTREGUE,MOTIVO) AS (
SELECT /*DISTINCT	*/
	SPSARQUIVOSCANDIDATO.NOMEARQUIVO AS NOMEARQUIVO,
	SPSDOCUMENTOEXIGIDO.CODDOCUMENTO AS CODDOCUMENTO,
	SPSDOCUMENTOEXIGIDO.OBRIGATORIO AS OBRIGATORIO,
	SPSDOCUMENTOENTREGUE.ENTREGUE AS ENTREGUE,
	SPSDOCUMENTOENTREGUE.MOTIVO AS MOTIVO
FROM SPSINSCRICAOAREAOFERTADA (NOLOCK)

INNER JOIN SPSUSUARIO (NOLOCK) ON
  	SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
  	
INNER JOIN SPSUSUARIO AS OUTROUSUARIO(NOLOCK) ON
  	ISNULL(SPSUSUARIO.CPF, SPSUSUARIO.CODUSUARIOPS) = ISNULL(OUTROUSUARIO.CPF, OUTROUSUARIO.CODUSUARIOPS)
  	
INNER JOIN SPSOPCAOINSCRITO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO

INNER JOIN  SPSDOCUMENTOEXIGIDO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE
		
INNER JOIN  SDOCUMENTO (NOLOCK) 
	ON SDOCUMENTO.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
	  
LEFT JOIN SPSDOCUMENTOENTREGUE (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSDOCUMENTOEXIGIDO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSDOCUMENTOEXIGIDO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
	AND SPSDOCUMENTOENTREGUE.CODDOCUMENTO = SPSDOCUMENTOEXIGIDO.CODDOCUMENTO
  
LEFT JOIN SPSARQUIVOSCANDIDATO (NOLOCK) 
	ON SPSDOCUMENTOENTREGUE.CODCOLIGADA = SPSARQUIVOSCANDIDATO.CODCOLIGADA
	AND SPSDOCUMENTOENTREGUE.IDPS = SPSARQUIVOSCANDIDATO.IDPS
	AND SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO = SPSARQUIVOSCANDIDATO.NUMEROINSCRICAO
	AND SPSARQUIVOSCANDIDATO.NOMEARQUIVO LIKE '%' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODCOLIGADA) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.IDPS) + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.NUMEROINSCRICAO)  + '-' + CONVERT(VARCHAR, SPSDOCUMENTOENTREGUE.CODDOCUMENTO) + '.%'

WHERE
		CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.NUMEROINSCRICAO) = :CODINSCRICAO
)

SELECT

	/*DEFAULT*/
	CURSO.NOME AS 'CURSO',
	/*IIF(SPSPROCESSOSELETIVO.NOME LIKE '%EAD%','EAD','Presencial') AS 'MODALIDADE',*/
	CASE WHEN 	CURSO.NOME LIKE '%EAD%'
		THEN 'EAD'
		ELSE CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%'
			 THEN 'EAD'
			 ELSE 'Presencial'
			 END
	END AS 'MODALIDADE',
		
	SCAMPUS.DESCRICAO AS 'CAMPUS',
	SPSPROCESSOSELETIVO.NOME AS 'FORMADEINGRESSO',
	/*DEFAULT*/
	
	/*DADOS CONTATO*/
	SPSUSUARIO.CODUSUARIOPS AS 'SPSUSUARIO.CODUSUARIOPS',
	SPSUSUARIO.NPASSAPORTE AS 'SPSUSUARIO.NPASSAPORTE',
	SPSUSUARIO.NACIONALIDADE AS 'SPSUSUARIO.NACIONALIDADE',
	NACIONALIDADE.DESCRICAO AS 'SPSUSUARIO.NOMENACIONALIDADE',
	SPSUSUARIO.NOME AS 'SPSUSUARIO.NOME',
	SPSUSUARIO.EMAIL AS 'SPSUSUARIO.EMAIL',
	SPSUSUARIO.TELEFONE2 AS 'SPSUSUARIO.TELEFONE2',
	SPSUSUARIO.CPF AS 'SPSUSUARIO.CPF',
	REPLACE(CONVERT(VARCHAR,SPSUSUARIO.DTNASCIMENTO,103),'/','') AS 'SPSUSUARIO.DTNASCIMENTOSENHA',
	SPSUSUARIO.DTNASCIMENTO AS 'SPSUSUARIO.DTNASCIMENTO',
	SPSUSUARIO.SEXO AS 'SPSUSUARIO.SEXO',
	SPSUSUARIO.NOMESOCIAL AS 'SPSUSUARIO.NOMESOCIAL',
	IIF(ISNULL(SPSUSUARIO.NOMESOCIAL,'')='','F','T') AS 'SPSUSUARIO.POSSUINOMESOCIAL',
	CASE 
        WHEN MONTH(GETDATE()) > MONTH(SPSUSUARIO.DTNASCIMENTO) OR (MONTH(GETDATE()) = MONTH(SPSUSUARIO.DTNASCIMENTO) AND DAY(GETDATE()) >= DAY(SPSUSUARIO.DTNASCIMENTO)) THEN DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) 
    ELSE DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) -1 END AS 'SPSUSUARIO.IDADE',
    
    CASE 
		WHEN (SPSOPCAOINSCRITO.STATUS = 5 OR SPSOPCAOINSCRITO.STATUS = 7) AND SPSUSUARIO.IDADE >= 18 THEN 'T'
		WHEN (SPSOPCAOINSCRITO.STATUS = 5 OR SPSOPCAOINSCRITO.STATUS = 7) AND SPSUSUARIO.IDADE < 18 AND ISNULL(SPSUSUARIOTIPORELAC.CODUSUARIOTIPORELAC,0) > 0 THEN 'T'
		ELSE 'F'
	END AS 'PREMATRICULA.DISPONIVEL',
	ISNULL(SPSUSUARIOTIPORELAC.CODUSUARIOTIPORELAC,0) AS 'FINANCEIRO.CODUSUARIOPS',
	/*DADOS CONTATO*/
	SPSINSCRICAOAREAOFERTADA.CODCOLIGADA AS 'SPSINSCRICAOAREAOFERTADA.CODCOLIGADA',
	SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO AS 'SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO',
	IIF(SPSOPCAOINSCRITO.STATUS IN (5,11),5,SPSOPCAOINSCRITO.STATUS) AS 'SPSOPCAOINSCRITO.STATUS',	
	/*	SPSOPCAOINSCRITO.STATUS AS 'SPSOPCAOINSCRITO.STATUS',*/
	SPSINSCRICAOAREAOFERTADA.STATUS	AS 'SPSINSCRICAOAREAOFERTADA.STATUS',
	CURSO.NOMEAREAINTERESSE AS 'SPSAREAINTERESSE.NOME',
	SPSOPCAOINSCRITO.IDAREAINTERESSE AS 'SPSAREAINTERESSE.IDAREAINTERESSE',
	SPSOPCAOINSCRITO.IDAREAINTERESSE AS 'OPORTUNIDADE.IDAREAINTERESSE',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',CURSO.CODCURSO) AS 'SCURSO.CODCURSO',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',CURSO.CODCURSO) AS 'OPORTUNIDADE.CODCURSO',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'SPSOPCAOINSCRITO.CODOFERTA',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SPSOPCAOINSCRITO.IDPS,'-',SPSOPCAOINSCRITO.IDAREAINTERESSE) AS 'OPORTUNIDADE.CODOFERTA',
	CONCAT(SPSOPCAOINSCRITO.CODCOLIGADA,'-',SCAMPUS.CODCAMPUS) AS 'SCAMPUS.CODCAMPUS',
	SPSINSCAREAOFERTACOMPL.CODPOLO AS 'SPSINSCAREAOFERTACOMPL.CODPOLO',
	SPSPROCESSOSELETIVO.IDPS AS 'SPSPROCESSOSELETIVO.IDPS',
	ISNULL(CURSO.CODETD,'PRESENCIAL') AS 'COD.SCAMPUS.UF',
	CURSO.NOME AS 'SCURSO.DESCRICAO',
	CURSO.IDHABILITACAOFILIAL AS 'SHABILITACAOFILIAL.IDHABILITACAOFILIAL',
	SPLETIVO.CODPERLET AS 'SPLETIVO.CODPERLET',
	CURSO.IDPERLET AS 'SPLETIVO.IDPERLET',
	CURSO.CODFILIAL AS 'GFILIAL.CODFILIAL',
	CASE
		WHEN FLAN.IDLAN IS NULL THEN 'Sem pagamento'
		WHEN FLAN.STATUSLAN = 0  AND FLAN.VALORORIGINAL - ISNULL(FLAN.VALORDESCONTO,0) > 0 THEN 'Pendente'
		WHEN FLAN.STATUSLAN IN (1,3)  OR SPSINSCRICAOAREAOFERTADA.STATUS = 1 THEN 'Confirmado'		
	END AS 'SPSINSCRICAOAREAOFERTADA.STATUSPAGAMENTO',
	DOCUMENTOS.POSSUIDOCUMENTO AS 'SPSDOCUMENTOEXIGIDO.POSSUIDOCUMENTO',
	SPSOPCAOINSCRITO.CLASSIFICACAO AS 'SPSOPCAOINSCRITO.CLASSIFICACAO',
	ISNULL(SPSOPCAOINSCRITO.PONTUACAO,0) AS 'SPSOPCAOINSCRITO.PONTUACAO',
	ISNULL(SPSINSCAREAOFERTACOMPL.VALINTER,'F') AS 'SPSINSCAREAOFERTACOMPL.VALINTER',
	SPSINSCAREAOFERTACOMPL.PENSIONATO AS 'SPSINSCAREAOFERTACOMPL.PENSIONATO',
	CURSO.CODTURMA AS 'STURMA.CODTURMA',
	CURSO.CODTIPOCURSO AS 'STIPOCURSOFILIAL.CODTIPOCURSO',
	CASE 
		WHEN SPSUSUARIO.NACIONALIDADE  = 10 OR SPSUSUARIO.NACIONALIDADE  = 20 THEN 'T'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 OR SPSUSUARIO.NACIONALIDADE != 20 THEN 'F'
	END AS 'PREMATRICULA.ESTRANGEIRO',
	CASE 
		WHEN SPSUSUARIO.NACIONALIDADE = 10 THEN 'T'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 AND SPSINSCAREAOFERTACOMPL.VALINTER = 'F' THEN 'F'
		WHEN SPSUSUARIO.NACIONALIDADE != 10 AND SPSINSCAREAOFERTACOMPL.VALINTER = 'T' THEN 'T'
	END AS 'SPSINSCAREAOFERTACOMPL.INSCRICAOVALIDADA',	
	
	/*PROVA*/
	
	/** FEEDBACK PROVA TEOLOGIA **/
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS = 3 THEN 'Reprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (5,7) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 4 THEN 'Aprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (5,7) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 3 THEN 'Aprovado'
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS IN (0,16) AND SPSOPCAOINSCRITO.ULTIMAETAPA = 3 THEN 'Aguardando entrevista'		
		WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND SPSOPCAOINSCRITO.STATUS = 16 AND SPSOPCAOINSCRITO.ULTIMAETAPA >= 2 THEN 'Aprovado 1º Fase'		
	END AS 'BPROVA.STATUS',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS1,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS1',
	ISNULL(SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS2,'') AS 'SPSPROCSELCOMPL.TOKENAPPPROVARUBEUS2',
	PROVA.NOME AS 'BPROVA.NOME',
	PROVA.CODPROVA AS 'BPROVA.CODPROVA',
	PROVA.IDEXECPROVA AS 'BEXECPROVA.IDEXECPROVA',
	PROVA.IDEXECPROVA1 AS 'BEXECPROVA.IDEXECPROVA1',
	PROVA.IDEXECPROVA2 AS 'BEXECPROVA.IDEXECPROVA2',
	PROVA.IDPROVA AS 'BEXECPROVA.IDPROVA',
	PROVA.IDPROVAINSCRITO AS 'BPROVA.IDPROVAINSCRITO',
	PROVA.HORAINICIOETAPA,
	PROVA.HORAFIMETAPA,
	
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' AND PROVA.IDEXECPROVA IS NOT NULL THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1, PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL',
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1,PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL1',
	CASE
		WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 'T'
		ELSE IIF((GETDATE() BETWEEN DATEADD(MINUTE, PROVA.HORAINICIOAGENDA - 1, PROVA.DATAAGENDAMENTO) AND DATEADD(DAY, 1, PROVA.DATAAGENDAMENTO)), 'T', 'F')
	END AS 'BPROVA.DISPONIVEL2',
	CONVERT(VARCHAR(10),PROVA.DATAAGENDAMENTO,120) AS 'SPSAGENDARECURSOPS.DATAAGENDAMENTO',
	PROVA.HORAINICIOAGENDA AS 'SPSAGENDARECURSOPS.HORAINICIO',
	PROVA.HORAFIMAGENDA AS 'SPSAGENDARECURSOPS.HORAFIM',
	IIF(ISNULL(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,103),'') = '','',CONCAT(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,103),' de ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAINICIOAGENDA,0))),' às ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAFIMAGENDA,0))))) AS 'SPSAGENDARECURSOPS.DATAHORAAGENDAMENTO',
	IIF(ISNULL(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,23),'') = '','',CONCAT(CONVERT(VARCHAR,PROVA.DATAAGENDAMENTO,23),' ',CONVERT(VARCHAR(5),CONVERT(TIME, DATEADD(MINUTE, PROVA.HORAINICIOAGENDA,0))), ':00')) AS 'SPSAGENDARECURSOPS.AGENDAMENTOCRM',
	
	/*FIM PROVA*/
	
	/*IIF(GETDATE() < ISNULL(SPSPROCSELCOMPL.DTLIMITEALTINSCRICAO, GETDATE() +1),'T','F') AS 'SPSPROCSELCOMPL.DTLIMITEALTINSCRICAO',*/
	
	/*DADOS MATRICULA*/
	MATRICULA.CODCONTRATO AS 'SCONTRATO.CODCONTRATO',
	CASE WHEN MATRICULA.RA IS NULL THEN NULL ELSE MATRICULA.RA END AS 'SALUNO.RA',
	MATRICULA.CODCFO AS 'FCFO.CODCFO',
	IIF(ISNULL(MATRICULA.CONTRATOASSINADO,'N') = 'N', 0, 1) AS 'SCONTRATO.ASSINADO',
	CONTRATODTASSINATURA AS 'SCONTRATO.DTASSINATURA',
	MATRICULA.MATRICULADO AS 'SMATRICPL.MATRICULADO',
	/** DOCUMENTOS DE INSCRICAO **/
	CASE 
		/** PENDENTE ENVIO **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NULL AND ISNULL(ENTREGUE,'F') = 'F') > 0 THEN 'Pendente envio'
		/** PENDENTE ENVIO (RECUSADO) **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ISNULL(ENTREGUE,'F') = 'F' AND MOTIVO IS NOT NULL) > 0 THEN 'Pendente envio (Recusado)'
		/** EM ANALISE **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ISNULL(ENTREGUE,'F') = 'F' AND ISNULL(MOTIVO,'') = '') > 0 THEN 'Em analise'
		/** ENTREGUES **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS WHERE NOMEARQUIVO IS NOT NULL AND ENTREGUE = 'T' AND ISNULL(MOTIVO,'') = '') > 0 THEN 'Documentos entregues'
		/** SE NÃO TIVER DOCUMENTOS **/
		WHEN (SELECT COUNT(CODDOCUMENTO) FROM DOCUMENTOS) <= 0 THEN 'Documentos entregues'
	END AS 'DOCUMENTOS.STATUS',
	

	/** DOCUMENTOS DE MATRICULA **/
	CASE        
		/**Se todos ja foram aceitos, retornar que os docs foram aceitos**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO	
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 3
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Documentos entregues'
       
		/**Se tiver 1 documento faltando envio, precisa retornar que existe doc pendente envio**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 0
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Pendente envio'
       
       /**Se tiver algum doc recusado, precisa retornar q tem doc pendente**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1			
		WHERE SDOCALUNO.STATUS = 2
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Pendente envio (Recusado)'
       
       /**Se todos ja tiverem sido enviados mais ainda nao foram aceitos, precisa retornar que esta em analise**/
		WHEN (SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO
			/** VALIDAÇÃO DOCUMENTOS POR NACIONALIDADE E TIPO DE INGRESSO **/
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1		
		WHERE SDOCALUNO.STATUS = 1
       GROUP BY SDOCALUNO.RA) > 0 THEN 'Em analise' 
       	
       	/**Se não houver documentos**/
		WHEN ISNULL((SELECT COUNT(SDOCALUNO.RA) AS QTD
	      FROM SDOCEXIGIDOS (NOLOCK)
          INNER JOIN  SDOCALUNO (NOLOCK) 
			ON SDOCALUNO.CODCOLIGADA = MATRICULA.CODCOLIGADA
			AND SDOCALUNO.RA = MATRICULA.RA
			AND SDOCALUNO.CODDOCUMENTO = SDOCEXIGIDOS.CODDOCUMENTO	
			AND (CASE 
					WHEN ISNULL(MATRICULA.NACIONALIDADE,10) IN (10,20) AND SDOCALUNO.CODDOCUMENTO = 105 AND (SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Transferência%' AND SPSPROCESSOSELETIVO.NOME NOT LIKE '%- Diplomados%') THEN 1
					WHEN MATRICULA.NACIONALIDADE NOT IN (10,20) AND SDOCALUNO.CODDOCUMENTO IN (11,107,108) THEN 1	
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Transferência%' AND SDOCEXIGIDOS.CODDOCUMENTO = 218 THEN 1
					WHEN SPSPROCESSOSELETIVO.NOME LIKE '%- Diplomados%' AND SDOCEXIGIDOS.CODDOCUMENTO = 3 THEN 1
				ELSE 0 END) = 1
		LEFT JOIN SARQUIVOS (NOLOCK) ON
			SARQUIVOS.CHAVERM =  CONVERT(VARCHAR, SDOCALUNO.CODCOLIGADA) + ';' + CONVERT(VARCHAR, SDOCALUNO.IDPERLET) + ';' + CONVERT(VARCHAR, SDOCALUNO.RA)  + ';' + CONVERT(VARCHAR, SDOCALUNO.CODDOCUMENTO)	  
		INNER JOIN SDOCUMENTO AS SDOCUMENTOMATRICULA (NOLOCK)
			ON SDOCUMENTOMATRICULA.CODDOCUMENTO = SDOCALUNO.CODDOCUMENTO 			
		WHERE SDOCEXIGIDOS.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA    
           AND SDOCEXIGIDOS.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL
       GROUP BY SDOCALUNO.RA),0) = 0 THEN 'Documentos entregues'
       END AS 'SMATRICPL.DOCUMENTOMATRICULA'
	
FROM SPSPROCESSOSELETIVO(NOLOCK)
INNER JOIN SPSPROCSELCOMPL (NOLOCK) 
	ON SPSPROCSELCOMPL.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSPROCSELCOMPL.IDPS = SPSPROCESSOSELETIVO.IDPS
	
INNER JOIN SPSINSCRICAOAREAOFERTADA (NOLOCK) 
	ON SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSPROCESSOSELETIVO.CODCOLIGADA
	AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSPROCESSOSELETIVO.IDPS

LEFT JOIN SPSINSCAREAOFERTACOMPL (NOLOCK) 
	ON SPSINSCAREAOFERTACOMPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSINSCAREAOFERTACOMPL.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSINSCAREAOFERTACOMPL.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	
INNER JOIN SCAMPUS (NOLOCK)
    ON SCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO
    
    
/*INNER JOIN SPSUSUARIO (NOLOCK) 
	ON SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS*/
CROSS APPLY 
(
	SELECT SPSUSUARIO.*, 
	CASE
        WHEN MONTH(GETDATE()) > MONTH(SPSUSUARIO.DTNASCIMENTO) OR (MONTH(GETDATE()) = MONTH(SPSUSUARIO.DTNASCIMENTO) AND DAY(GETDATE()) >= DAY(SPSUSUARIO.DTNASCIMENTO)) THEN DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) 
    ELSE DATEDIFF(YEAR, SPSUSUARIO.DTNASCIMENTO, GETDATE()) -1 END AS 'IDADE'
	FROM SPSUSUARIO (NOLOCK) 
	WHERE
		SPSUSUARIO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
) AS SPSUSUARIO	

CROSS APPLY(
	SELECT 
		PCODNACAO.CODCLIENTE,
		PCODNACAO.DESCRICAO
	FROM PCODNACAO(NOLOCK) 
	WHERE CODCLIENTE = SPSUSUARIO.NACIONALIDADE) AS NACIONALIDADE

LEFT JOIN SPSUSUARIOTIPORELAC (NOLOCK)
	ON SPSUSUARIOTIPORELAC.CODUSUARIOPS = SPSUSUARIO.CODUSUARIOPS
	AND SPSUSUARIOTIPORELAC.TIPORELAC = 3	

INNER JOIN SPSOPCAOINSCRITO (NOLOCK) 
	ON SPSOPCAOINSCRITO.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	AND SPSOPCAOINSCRITO.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS
	AND SPSOPCAOINSCRITO.CODUSUARIOPS = SPSINSCRICAOAREAOFERTADA.CODUSUARIOPS
	AND SPSOPCAOINSCRITO.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
	
/** DADOS CURSO **/
CROSS APPLY(		
	SELECT 
		SPSAREAINTERESSE.IDAREAINTERESSE,
		SPSAREAINTERESSE.NOME AS NOMEAREAINTERESSE,
		SCURSO.CODCURSO,
		SCURSO.NOME,
		SCURSO.CURPRESDIST,
		SCURSO.CODMODALIDADECURSO AS MODALIDADE,
		STURNO.NOME AS TURNO,
		SHABILITACAOFILIAL.IDHABILITACAOFILIAL,
		STURMA.CODTURMA AS CODTURMA,
		SHABILITACAOFILIALPL.IDPERLET,
		SHABILITACAOFILIAL.CODTIPOCURSO,
		SHABILITACAOFILIALPL.CODFILIAL AS CODFILIAL,
		STURMA.NOME AS NOMETURMA,
		GETD.CODETD AS CODETD,
		GETD.NOME AS NOMEETD
	FROM SPSAREAINTERESSE (NOLOCK)
	INNER JOIN SHABILITACAOFILIAL (NOLOCK)
		ON SPSAREAINTERESSE.CODCOLIGADAHABFILIAL = SHABILITACAOFILIAL.CODCOLIGADA
  		AND SPSAREAINTERESSE.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
	INNER JOIN SCURSO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = SCURSO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODCURSO = SCURSO.CODCURSO
	INNER JOIN STURNO (NOLOCK)
		ON SHABILITACAOFILIAL.CODCOLIGADA = STURNO.CODCOLIGADA
		AND SHABILITACAOFILIAL.CODTURNO = STURNO.CODTURNO
	LEFT JOIN SHABILITACAOFILIALPL(NOLOCK)
		ON SHABILITACAOFILIALPL.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND SHABILITACAOFILIALPL.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		AND SHABILITACAOFILIALPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
	LEFT JOIN STURMA(NOLOCK)
		ON STURMA.CODCOLIGADA = SHABILITACAOFILIALPL.CODCOLIGADA
		AND STURMA.IDHABILITACAOFILIAL = SHABILITACAOFILIALPL.IDHABILITACAOFILIAL
		AND STURMA.IDPERLET  = SHABILITACAOFILIALPL.IDPERLET
		AND STURMA.NOME LIKE CASE
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-BADMI' THEN 'Administração - Módulo 1'								
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TADSI' THEN 'Análise e Desenvolvimento de Sistemas Tecnologia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-BCCON' THEN 'Ciências Contábeis - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TCINS' THEN 'Comunicação Institucional - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-BCSPP' THEN 'Comunicação Social Publicidade e Propaganda - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TDGRA' THEN 'Design Gráfico - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-LFOPE' THEN 'Formação Pedagógica Pedagogia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TFOTO' THEN 'Fotografia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TGETI' THEN 'Gestão da Tecnologia da Informação Tecnologia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TRHUM' THEN 'Gestão de Recursos Humanos - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TEGEF' THEN 'Gestão Financeira Tecnologia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TJODI' THEN 'Jogos Digitais Tecnologia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-BJORN' THEN 'Jornalismo - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-LLPOR' THEN 'Letras Português - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TEMAR' THEN 'Marketing - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-LPEDA' THEN 'Pedagogia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TPGER' THEN 'Processos Gerenciais - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TPAUD' THEN 'Produção Audiovisual - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TPMUL' THEN 'Produção Multimídia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TPPUB' THEN 'Produção Publicitária - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-TSECR' THEN 'Secretariado - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCURSO.CODCURSO = 'EAD-LSELI' THEN 'Segunda Licenciatura Pedagogia - Módulo 1'
								WHEN SPSPROCESSOSELETIVO.IDPS = 61 AND SCURSO.CODCURSO = 'SP-BCSPP' THEN 'Comunicação Social - Publicidade e Propaganda 3ª Etapa'
								WHEN SPSPROCESSOSELETIVO.IDPS = 61 AND SCURSO.CODCURSO = 'HT-BCSPP' THEN 'Comunicação Social - Publicidade e Propaganda 3ª Etapa'
								WHEN SPSPROCESSOSELETIVO.IDPS = 61 AND SCURSO.CODCURSO = 'SP-BAURB' THEN 'Arquitetura e Urbanismo 3ª Etapa'
							ELSE '%1ª Etapa%' END
	/**VINCULO DE CAMPUS COM HABILITACAO PARA PEGAR CAMPUS x MATRIZ APLICADA**/
	INNER JOIN SHABILITACAOFILIALCAMPUS(NOLOCK)
		ON SHABILITACAOFILIALCAMPUS.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
		AND SHABILITACAOFILIALCAMPUS.IDHABILITACAOFILIAL = SHABILITACAOFILIAL.IDHABILITACAOFILIAL
		AND SHABILITACAOFILIALCAMPUS.CODCAMPUS = SPSINSCAREAOFERTACOMPL.CODPOLO
	INNER JOIN SCAMPUS(NOLOCK)
		ON SCAMPUS.CODCAMPUS = SHABILITACAOFILIALCAMPUS.CODCAMPUS
		AND ISNULL(SCAMPUS.ATIVO, 'N') = 'S'	
		AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%EAD%' AND SCAMPUS.UF IS NOT NULL THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%EAD%' THEN 1 
			ELSE 0 END) = 1
	LEFT JOIN GETD (NOLOCK)
	  	ON GETD.CODETD = SCAMPUS.UF		
WHERE SPSOPCAOINSCRITO.IDAREAINTERESSE = SPSAREAINTERESSE.IDAREAINTERESSE) AS CURSO

LEFT JOIN SPLETIVO (NOLOCK)
	ON SPLETIVO.CODCOLIGADA = SPSPROCSELCOMPL.CODCOLIGADA
	AND SPLETIVO.IDPERLET = CURSO.IDPERLET
	
/** DADOS LANCAMENTO/BOLETO INSCRICAO **/
OUTER APPLY(
	SELECT 
		FLAN.IDLAN,
		FLAN.CODCOLIGADA,
		FLAN.CODCFO,
		FLAN.CODCOLCFO,
		FLAN.CODCXA,
		FBOLETO.CNABSTATUS,
		FBOLETO.NOSSONUMERO AS NUMERODOCUMENTO,
		FLAN.CODCOLCXA,	
		FLAN.VALORORIGINAL,
		FLAN.VALORDESCONTO,
		FLAN.STATUSLAN,
		FLAN.IDBOLETO
	FROM FLAN(NOLOCK)
	INNER JOIN FLANBOLETO (NOLOCK) 
		ON FLAN.IDLAN = FLANBOLETO.IDLAN
		AND FLAN.IDBOLETO = FLANBOLETO.IDBOLETO
		AND FLAN.CODCOLIGADA = dbo.FLANBOLETO.CODCOLIGADA	
	INNER JOIN FBOLETO (NOLOCK) 
		ON FLANBOLETO.IDBOLETO = FBOLETO.IDBOLETO
		AND FLANBOLETO.CODCOLIGADA = FBOLETO.CODCOLIGADA
		AND FBOLETO.STATUS <> 2
	WHERE FLAN.IDLAN = SPSINSCRICAOAREAOFERTADA.IDLAN
	AND FLAN.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADALAN
	AND FLAN.STATUSLAN = 0
) AS FLAN

/**DADOS PROVA**/
OUTER APPLY(
	SELECT
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVAINSCRITO AS 'IDPROVAINSCRITO',
		SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA AS 'IDPROVA',
		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 1,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA',
		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 2,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA1',
		IIF(SPSETAPAAREAOFERTADA.ORDEMETAPA = 3,BEXECPROVA.IDEXECPROVA,NULL) AS 'IDEXECPROVA2',
		BPROVA.CODPROVA AS 'CODPROVA',
		BPROVA.NOME AS 'NOME',
		ISNULL(SPSAGENDARECURSOPS.HORAINICIO,SPSHORARIOETAPAAREAOFERTADA.HORAINICIO) AS 'HORAINICIOAGENDA',
		ISNULL(SPSAGENDARECURSOPS.HORAFIM,SPSHORARIOETAPAAREAOFERTADA.HORAFIM) AS 'HORAFIMAGENDA',
		SPSHORARIOETAPAAREAOFERTADA.HORAINICIO AS 'HORAINICIOETAPA',
		SPSHORARIOETAPAAREAOFERTADA.HORAFIM AS 'HORAFIMETAPA',
		ISNULL(SPSAGENDARECURSOPS.DATAAGENDAMENTO,SPSHORARIOETAPAAREAOFERTADA.DATAETAPA) AS 'DATAAGENDAMENTO', 
		SPSHORARIOETAPAAREAOFERTADA.DATAETAPA AS 'DATAETAPA',
		CONVERT(VARCHAR,ISNULL(SPSAGENDARECURSOPS.DATAAGENDAMENTO, SPSHORARIOETAPAAREAOFERTADA.DATAETAPA), 103) AS 'DATAPROVA'
	
	FROM SPSETAPAAREAOFERTADA AS SPSETAPAAREAOFERTADA (NOLOCK)
	INNER JOIN SPSHORARIOETAPAAREAOFERTADA AS SPSHORARIOETAPAAREAOFERTADA (NOLOCK)
		ON SPSETAPAAREAOFERTADA.IDETAPA = SPSHORARIOETAPAAREAOFERTADA.IDETAPA
		AND SPSETAPAAREAOFERTADA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
		AND SPSETAPAAREAOFERTADA.IDPS = SPSHORARIOETAPAAREAOFERTADA.IDPS
		AND SPSETAPAAREAOFERTADA.CODCOLIGADA = SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA
	INNER JOIN SPSPROVAETAPAAREA (NOLOCK) 
		ON SPSHORARIOETAPAAREAOFERTADA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND SPSHORARIOETAPAAREAOFERTADA.IDPS = SPSPROVAETAPAAREA.IDPS
		AND SPSHORARIOETAPAAREAOFERTADA.IDAREAINTERESSE = SPSPROVAETAPAAREA.IDAREAINTERESSE
		AND SPSHORARIOETAPAAREAOFERTADA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA
		AND SPSHORARIOETAPAAREAOFERTADA.IDHORARIO = SPSPROVAETAPAAREA.IDHORARIO	
	INNER JOIN BPROVA (NOLOCK)
		ON BPROVA.CODCOLIGADA = SPSPROVAETAPAAREA.CODCOLIGADA
		AND BPROVA.CODPROVA = SPSPROVAETAPAAREA.CODPROVA	
	INNER JOIN SPSCONTROLEDISTRIBUICAOPROVA (NOLOCK)
		ON SPSCONTROLEDISTRIBUICAOPROVA.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSCONTROLEDISTRIBUICAOPROVA.NUMEROINSCRICAO = SPSOPCAOINSCRITO.NUMEROINSCRICAO
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDETAPA = SPSPROVAETAPAAREA.IDETAPA		
	LEFT JOIN BEXECPROVA (NOLOCK) 
		ON SPSPROVAETAPAAREA.CODCOLIGADA = BEXECPROVA.CODCOLIGADA
		AND SPSPROVAETAPAAREA.CODPROVA = BEXECPROVA.CODPROVA
		AND SPSOPCAOINSCRITO.CODUSUARIOPS = BEXECPROVA.CODUSUARIOPS	
		AND SPSCONTROLEDISTRIBUICAOPROVA.IDPROVA = BEXECPROVA.ID
	LEFT JOIN SPSAGENDARECURSOPS AS SPSAGENDARECURSOPS (NOLOCK)
		ON SPSAGENDARECURSOPS.NUMEROINSCRICAO = SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO
		AND SPSAGENDARECURSOPS.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
		AND SPSAGENDARECURSOPS.IDPS = SPSINSCRICAOAREAOFERTADA.IDPS			
	WHERE 
			SPSINSCRICAOAREAOFERTADA.CODCOLIGADA = SPSETAPAAREAOFERTADA.CODCOLIGADA
		AND SPSINSCRICAOAREAOFERTADA.IDPS = SPSETAPAAREAOFERTADA.IDPS
		AND CURSO.IDAREAINTERESSE = SPSETAPAAREAOFERTADA.IDAREAINTERESSE
		/** VALIDACOES TEOLOGIA **/
		AND (CASE WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103) = CONVERT(VARCHAR(10),GETDATE(),103) THEN 0 ELSE 1 END) = 1
		/*AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),GETDATE(),103) <= CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103)
				AND (SPSHORARIOETAPAAREAOFERTADA.HORAFIM/60) <= LEFT(CONVERT(TIME,GETDATE()),2) THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 1
			ELSE 0 END) = 1*/
		/*AND (CASE 
				WHEN SPSPROCESSOSELETIVO.NOME LIKE '%TEOLOGIA%' AND CONVERT(VARCHAR(10),SPSHORARIOETAPAAREAOFERTADA.DATAETAPA,103) = CONVERT(VARCHAR(10),GETDATE(),103)
				AND LEFT(CONVERT(TIME,GETDATE()),2) BETWEEN (SPSHORARIOETAPAAREAOFERTADA.HORAINICIO/60) AND (SPSHORARIOETAPAAREAOFERTADA.HORAFIM/60) THEN 1 
				WHEN SPSPROCESSOSELETIVO.NOME NOT LIKE '%TEOLOGIA%' THEN 1
			ELSE 0 END) = 1*/
) AS PROVA

OUTER APPLY(
	SELECT 
		IIF(COUNT(SPSDOCUMENTOEXIGIDO.CODDOCUMENTO) > 0,'T','F') AS POSSUIDOCUMENTO
	FROM 
		SPSDOCUMENTOEXIGIDO (NOLOCK)
	WHERE
		SPSDOCUMENTOEXIGIDO.CODCOLIGADA = SPSOPCAOINSCRITO.CODCOLIGADA
		AND SPSDOCUMENTOEXIGIDO.IDPS = SPSOPCAOINSCRITO.IDPS
		AND SPSDOCUMENTOEXIGIDO.IDAREAINTERESSE = SPSOPCAOINSCRITO.IDAREAINTERESSE
) AS DOCUMENTOS

/****/

/*Matricula*/
OUTER APPLY (
	SELECT 
		SCONTRATO.CODCOLIGADA,
		SMATRICPL.IDPERLET,	
	    'T' AS 'MATRICULADO',
	    SCONTRATO.CODCONTRATO AS 'CODCONTRATO',
	    SMATRICPL.RA AS 'RA',
	    SALUNO.CODCFO AS 'CODCFO',
	    SCONTRATO.ASSINADO AS 'CONTRATOASSINADO',
	    CONVERT(VARCHAR,SCONTRATO.DTASSINATURA,103) AS 'CONTRATODTASSINATURA',
	    PPESSOA.NACIONALIDADE
	FROM SALUNO(NOLOCK)
	INNER JOIN PPESSOA (NOLOCK)
		ON PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SHABILITACAOALUNO(NOLOCK)
		ON SHABILITACAOALUNO.CODCOLIGADA = SALUNO.CODCOLIGADA
		AND SHABILITACAOALUNO.RA = SALUNO.RA
		AND SHABILITACAOALUNO.RECCREATEDON >= SPSINSCRICAOAREAOFERTADA.RECCREATEDON
	INNER JOIN SMATRICPL (NOLOCK)
		ON SMATRICPL.CODCOLIGADA = SPSINSCRICAOAREAOFERTADA.CODCOLIGADA
	    AND SMATRICPL.RA = SALUNO.RA
	    AND SMATRICPL.IDHABILITACAOFILIAL = CURSO.IDHABILITACAOFILIAL
	    AND SMATRICPL.IDPERLET IN (SPSPROCSELCOMPL.IDPERLET,SPSPROCSELCOMPL.IDPERLET1,SPSPROCSELCOMPL.IDPERLET2,SPSPROCSELCOMPL.IDPERLET3)
		AND SMATRICPL.RA = SHABILITACAOALUNO.RA
		AND SMATRICPL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	INNER JOIN SCONTRATO (NOLOCK) 
	    ON SCONTRATO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	    AND SCONTRATO.RA = SMATRICPL.RA
	    AND SCONTRATO.IDPERLET = SMATRICPL.IDPERLET
	    AND SCONTRATO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
	    AND SCONTRATO.DTCANCELAMENTO IS NULL
	    
	LEFT JOIN SSTATUS (NOLOCK) 
	    ON SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA
	    AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
	    
	WHERE COALESCE(PPESSOA.CPF,PPESSOA.NPASSAPORTE) = COALESCE(SPSUSUARIO.CPF,SPSUSUARIO.NPASSAPORTE)
) AS MATRICULA
WHERE CONCAT(SPSINSCRICAOAREAOFERTADA.CODCOLIGADA,'-',SPSINSCRICAOAREAO";;;;;;;;;;;;;;;;;;;;;;;
"ERTADA.IDPS,'-',SPSINSCRICAOAREAOFERTADA.NUMEROINSCRICAO) = :CODINSCRICAO	";;;;;;;;;;;;;;;;;;;;;;;;;;
AND SPSPROCSELCOMPL.PSRUBEUS = 'T';;;;;;;;;;;;;;;;;;;;;;;;;;
/*AND SPSPROCESSOSELETIVO.IDPS IN (60,61,62,63,64,69,70,71,72,76)*/;;;;;;;;;;;;;;;;;;;;;;;;;;
ORDER BY  SPSINSCRICAOAREAOFERTADA.DATAINSCRICAO,PROVA.IDPROVA DESC;";33009;;;;09/02/2022;consultor1.totvs;1;1;1;1;;;;0;f3ea192f-cc6c-4083-9127-48872ef10ffa;0;;-31924;consultor1.totvs;10/01/2022;consultor1.totvs;09/02/2022;0
S;TicketMedio.Alu;Ticket Médio por Aluno;Select ";;;;;;;;;;;;;;;;;;;;;;;;;
"	hf.NomFilial Filial, hf.NomTipoCurso Nivel, v.CODPERLET, hf.NomCurso Curso, hf.NomTurno Turno, v.CODCURSO, v.CODTURMA, v.Status, TipoMatricula,";;;;;;;;;;;;;;;;;;;;;;;;;;
"	a.RA, p.Nome, v.Parcelas, v.BRUTO_Medio, v.[DESC+BOLSA_Medio], v.VALORLIQ_Medio, v.Pagante";;;;;;;;;;;;;;;;;;;;;;;;;;
from ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	v_Unasp_TicketMedioAluno v ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	inner join SALUNO a on a.CODCOLIGADA=v.CODCOLIGADA and a.RA=v.RA";;;;;;;;;;;;;;;;;;;;;;;;;;
"	inner join PPESSOA p on p.CODIGO = a.CODPESSOA ";;;;;;;;;;;;;;;;;;;;;;;;;;
"	inner join v_Unasp_SHABILITACAOFILIAL hf on hf.CODCOLIGADA=v.CODCOLIGADA and hf.IDHABILITACAOFILIAL = v.IDHABILITACAOFILIAL";;;;;;;;;;;;;;;;;;;;;;;;;;
Where ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	CODPERLET = :CODPERLET";;;;;;;;;;;;;;;;;;;;;;;;;;
ORDER BY ;;;;;;;;;;;;;;;;;;;;;;;;;;
"	hf.NomFilial, hf.NomTipoCurso, v.CODPERLET, hf.NomCurso, hf.NomTurno, v.CODTURMA, v.Status, RA""";667;;;;11/05/2022;isaldo;1;1;1;1;;;;0;bfe9103b-0700-4978-b116-85fdfb100812;0;;-26980;isaldo;28/01/2022;isaldo;11/05/2022;0;;;
S;TicketMedio.Camp;Ticket Médio por Campus/Nivel;"With reg as (Select * from v_Unasp_TicketMedioAluno Where CODPERLET like :CODPERLET + '%')
	Select hf.NomFilial Filial, hf.NomTipoCurso Nivel, r.CODPERLET, r.Status, COUNT(*) Alunos, Sum(Pagante) Pagantes, AVG(r.BRUTO_Medio) BRUTO_Medio, avg(r.[DESC+BOLSA_Medio]) [DESC+BOLSA_Medio], AVG(r.VALORLIQ_Medio) VALORLIQ_Medio 
	from reg r inner join v_Unasp_SHABILITACAOFILIAL hf on hf.CODCOLIGADA=r.CODCOLIGADA and hf.IDHABILITACAOFILIAL = r.IDHABILITACAOFILIAL
	Group by hf.NomFilial, hf.NomTipoCurso, r.CODPERLET, r.Status
	ORDER BY hf.NomFilial, hf.NomTipoCurso, r.Status";574;;;;01/02/2022;isaldo;1;1;1;1;;;;0;af7c3ee1-1966-401e-be00-72b3f32cdc26;0;;25444;isaldo;28/01/2022;isaldo;01/02/2022;0
S;TicketMedio.Curs;Ticket Médio por Curso;"With reg as (Select * from v_Unasp_TicketMedioAluno Where CODPERLET like :CODPERLET + '%' )
	Select 
		hf.NomFilial Filial, hf.NomTipoCurso Nivel, r.CODPERLET, hf.NomCurso Curso, hf.NomTurno Turno, r.CODCURSO, r.Status, COUNT(*) Alunos, Sum(Pagante) Pagantes, 
		AVG(r.BRUTO_Medio) BRUTO_Medio, avg(r.[DESC+BOLSA_Medio]) [DESC+BOLSA_Medio], AVG(r.VALORLIQ_Medio) VALORLIQ_Medio 
	from reg r inner join v_Unasp_SHABILITACAOFILIAL hf on hf.CODCOLIGADA=r.CODCOLIGADA and hf.IDHABILITACAOFILIAL = r.IDHABILITACAOFILIAL
	Group by hf.NomFilial, hf.NomTipoCurso, r.CODPERLET, hf.NomCurso, hf.NomTurno, r.CODCURSO, r.Status
	ORDER BY hf.NomFilial, hf.NomTipoCurso, r.CODPERLET, hf.NomCurso, hf.NomTurno, r.CODCURSO, r.Status";722;;;;01/02/2022;isaldo;1;1;1;1;;;;0;8ca152f6-3423-4839-a7c6-a9ef6d8d4434;0;;-27465;isaldo;28/01/2022;isaldo;01/02/2022;0
S;TicketMedio.Turm;Ticket Médio por Turma;"With reg as (Select * from v_Unasp_TicketMedioAluno Where CODPERLET like :CODPERLET + '%')
	Select hf.NomFilial Filial, hf.NomTipoCurso Nivel, r.CODPERLET, hf.NomCurso Curso, hf.NomTurno Turno, r.CODCURSO,r.CODTURMA, r.Status, COUNT(*) Alunos, Sum(Pagante) Pagantes, AVG(r.BRUTO_Medio) BRUTO_Medio, avg(r.[DESC+BOLSA_Medio]) [DESC+BOLSA_Medio], AVG(r.VALORLIQ_Medio) VALORLIQ_Medio 
	from reg r inner join v_Unasp_SHABILITACAOFILIAL hf on hf.CODCOLIGADA=r.CODCOLIGADA and hf.IDHABILITACAOFILIAL = r.IDHABILITACAOFILIAL
	Group by hf.NomFilial, hf.NomTipoCurso, r.CODPERLET, hf.NomCurso, hf.NomTurno, r.CODCURSO, r.CODTURMA, r.Status
	ORDER BY hf.NomFilial, hf.NomTipoCurso, r.CODPERLET, hf.NomCurso, hf.NomTurno, r.CODTURMA
";728;;;;01/02/2022;isaldo;1;1;1;1;;;;0;26b9fed4-d5ee-4392-8c36-baa1cfc3851f;0;;16507;isaldo;28/01/2022;isaldo;01/02/2022;0
S;TicketSLAN.Alu;Ticket médio por Aluno (Parcela Gerada);"Select 
		hf.NomFilial Filial, hf.NomTipoCurso Nivel, v.CODPERLET, hf.NomCurso Curso, hf.NomTurno Turno, v.CODCURSO, v.CODTURMA, TipoMatricula, v.Status,
		a.RA, p.Nome, 
		v.Parcelas,
		BRUTO_Media,
		BolsaFuncionario_Media,
		BolsaFilantropia_Media,
		OutrosDescontos_Media,
		VALORLIQ_Media,
		Pagante	
	from 
		v_Unasp_TicketMedioAluno_SLAN v 
		inner join SALUNO a on a.CODCOLIGADA=v.CODCOLIGADA and a.RA=v.RA
		inner join PPESSOA p on p.CODIGO = a.CODPESSOA 
		inner join v_Unasp_SHABILITACAOFILIAL hf on hf.CODCOLIGADA=v.CODCOLIGADA and hf.IDHABILITACAOFILIAL = v.IDHABILITACAOFILIAL
	Where 
		CODPERLET in ( select Id from dbo.splitStringToTable( :CODPERLET, ',' )) 
		and v.Status='Cursando' and v.CODTIPOCURSO=1
	ORDER BY 
		hf.NomFilial, hf.NomTipoCurso, v.CODPERLET, hf.NomCurso, hf.NomTurno, v.CODTURMA, v.Status, RA";848;;;;07/03/2022;isaldo;1;1;1;1;;;;0;0ee9312d-4485-47c1-bac3-a4a357f9275a;0;;-19709;isaldo;07/03/2022;isaldo;07/03/2022;0
S;Tipo;Tipo de Calculo de Prova;"

SELECT 
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 1
) AS TIPO1,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 2
) AS TIPO2,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 3
) AS TIPO3,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 4
) AS TIPO4,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 5
) AS TIPO5,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 6
) AS TIPO6,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 7
) AS TIPO7,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 8
) AS TIPO8,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 9
) AS TIPO9,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 10
) AS TIPO10,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 11
) AS TIPO11,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 12
) AS TIPO12,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 13
) AS TIPO13,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 14
) AS TIPO14,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 15
) AS TIPO15,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 16
) AS TIPO16,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 17
) AS TIPO17,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 18
) AS TIPO18,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 19
) AS TIPO19,
(SELECT ISNULL(TIPO,1) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 20
) AS TIPO20


FROM SETAPAS
WHERE TIPOETAPA = 'N'
AND   CODETAPA = 1
AND IDTURMADISC =:FRM_IDTD";3801;;;;10/01/2022;consultor1.totvs;1;1;1;1;;;;0;a9d93246-b38d-4bb4-a465-ecb24077cede;0;;16418;mestre;27/01/2021;consultor1.totvs;10/01/2022;0
S;TipoRec;Tipo de Recuperação;"SELECT 
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 1
) AS TIPOREC1,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 2
) AS TIPOREC2,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 3
) AS TIPOREC3,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 4
) AS TIPOREC4,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 5
) AS TIPOREC5,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 6
) AS TIPOREC6,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 7
) AS TIPOREC7,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 8
) AS TIPOREC8,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 9
) AS TIPOREC9,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 10
) AS TIPOREC10,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 11
) AS TIPOREC11,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 12
) AS TIPOREC12,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 13
) AS TIPOREC13,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 14
) AS TIPOREC14,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 15
) AS TIPOREC15,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 16
) AS TIPOREC16,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 17
) AS TIPOREC17,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 18
) AS TIPOREC18,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 19
) AS TIPOREC19,
(SELECT ISNULL(TIPORC,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 20
) AS TIPOREC20,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 1
) AS AVAL1,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 2
) AS AVAL2,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 3
) AS AVAL3,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 4
) AS AVAL4,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 5
) AS AVAL5,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 6
) AS AVAL6,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 7
) AS AVAL7,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 8
) AS AVAL8,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 9
) AS AVAL9,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 10
) AS AVAL10,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 11
) AS AVAL11,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 12
) AS AVAL12,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 13
) AS AVAL13,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 14
) AS AVAL14,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 15
) AS AVAL15,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 16
) AS AVAL16,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 17
) AS AVAL17,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 18
) AS AVAL18,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 19
) AS AVAL19,
(SELECT ISNULL(AVSUBST,0) FROM SPROVASCOMPL
WHERE TIPOETAPA = SETAPAS.TIPOETAPA
AND   CODETAPA = SETAPAS.CODETAPA
AND IDTURMADISC = SETAPAS.IDTURMADISC
AND CODPROVA = 20
) AS AVAL20

FROM SETAPAS
WHERE TIPOETAPA = 'N'
AND   CODETAPA = 3
AND IDTURMADISC =:FRM_IDTD
/*AND IDTURMADISC = 308527*/
";7689;;;;11/01/2022;consultor1.totvs;1;1;1;1;;;;0;af2a1e6f-b166-4e35-a0b9-634d22b065d5;0;;29294;consultor1.totvs;10/01/2022;consultor1.totvs;11/01/2022;0
S;TotalAlunosTurma;Total de Alunos por Turma;"select
	NomFilial			Filial, 
	NomTipoCurso		Nível, 
	NomCurso			Curso, 
	dbo.fn_CODPERIODO_Turma(CodTurma, IDPERLET) Etapa, 
	NomTurno,
	CODTURMA, 
	NomTurma			Turma,	
	Sum(case when NomTipoMatricula='Matrícula' then 1 else 0 end)	Matrícula,
	Sum(case when NomTipoMatricula='Rematrícula' then 1 else 0 end)	Rematrícula,
	Sum(case when NomTipoMatricula='DIAP' then 1 else 0 end)		DIAP
from 
	v_unasp_SMATRICPL 
where 
	codperlet in (select Id from dbo.splitStringToTable( :Periodo,',')) and NomStatus='Cursando'
Group by
	NomFilial, 
	NomTipoCurso, 
	NomCurso, 
	dbo.fn_CODPERIODO_Turma(CodTurma, IDPERLET), 
	NomTurno,
	CODTURMA, 
	NomTurma
Order by 
	1,2,3,4,5,6";687;;;;13/03/2022;isaldo;1;1;1;1;;;;0;b95ba539-1694-4f74-a3c4-8b7abe6c0b54;0;;-6811;isaldo;13/03/2022;isaldo;13/03/2022;0
S;TOTVS022;Relatório Matrículas;"SELECT 
DISTINCT
1 total,
SMATRICPL.CODTURMA,
SMATRICPL.RA,
PPESSOA.NOME ALUNO,
SCURSO.NOME CURSO,
SDISCIPLINA.NOME,
SSTATUS.DESCRICAO,
SCAMPUS.DESCRICAO POLO

FROM SHABILITACAOALUNO
	LEFT JOIN SCAMPUS ON 
		SCAMPUS.CODCAMPUS = SHABILITACAOALUNO.CODCAMPUS
	INNER JOIN SMATRICPL ON 
		SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
		AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
		AND SHABILITACAOALUNO.RA = SMATRICPL.RA
	INNER JOIN SMATRICULA ON 
		SMATRICULA.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
		AND SMATRICULA.IDPERLET = SMATRICPL.IDPERLET 
		AND SMATRICULA.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL 
		AND SMATRICULA.RA = SMATRICPL.RA
	INNER JOIN SALUNO ON 
		SALUNO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA 
		AND SALUNO.RA = SHABILITACAOALUNO.RA
	INNER JOIN PPESSOA ON 
		PPESSOA.CODIGO = SALUNO.CODPESSOA
	INNER JOIN SPLETIVO ON 
		SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
		AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
	INNER JOIN SHABILITACAOFILIAL ON 
		SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA 
		AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
	INNER JOIN SCURSO ON 
		SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA 
		AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
	INNER JOIN STURMADISC ON 
		SMATRICULA.CODCOLIGADA = STURMADISC.CODCOLIGADA 
		AND SMATRICULA.IDTURMADISC = STURMADISC.IDTURMADISC 
		AND SMATRICULA.IDPERLET = STURMADISC.IDPERLET
	INNER JOIN SDISCIPLINA ON 
		SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA 
		AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
	INNER JOIN SSTATUS ON 
		SSTATUS.CODCOLIGADA = SMATRICPL.CODCOLIGADA 
		AND SSTATUS.CODSTATUS = SMATRICPL.CODSTATUS
WHERE SPLETIVO.CODPERLET =:PL
AND   SMATRICPL.CODFILIAL =:FILIAL
AND   SHABILITACAOFILIAL.CODTIPOCURSO =:TIPOCURSO
AND   SSTATUS.DESCRICAO LIKE '%' + :STATUS + '%'
AND   SCURSO.NOME LIKE '%' + :CURSO + '%'
AND   SMATRICPL.CODTURMA LIKE  '%' + :CODTURMA + '%'

/*AND   SDISCIPLINA.NOME LIKE '%' + :DISCIPLINA + '%'*/


ORDER BY SMATRICPL.CODTURMA , PPESSOA.NOME";2140;;;;16/05/2022;consultor1.totvs;1;1;1;1;;;;0;a886a6a4-63ec-44a7-93c9-89e725759177;0;;-7982;mestre;28/07/2021;consultor1.totvs;16/05/2022;0
S;Totvsip.001;Axexo matricula - aluno;Select * from saluno where ra=:ra and codcoligada =:codcoligada;63;;;;15/02/2021;mestre;1;1;1;1;;;;0;5222b5e2-0221-45c9-864d-6cf8410ef978;0;;19582;mestre;15/02/2021;mestre;15/02/2021;0
S;Trancados;Alunos com status Trancado entre uma data do período letivo;"Select 
	mpl.NomFilial,mpl.CODCURSO,mpl.NomCurso,mpl.NomTurno,mpl.NomGrade,PeriodosDaMatriz,CODPERLET UltimoPeriodoLetivo,PeriodosComMatricula, NomStatus StatusPeriodoLetivo,NomStatusCurso StatusCurso,mpl.RA,NomPessoa,NomTipoCurso,DTNASCIMENTO,EMAIL,SEXO,Cidade,CODCAMPUS,NomCampus,EstadoCivil,Religiao,RUA,NUMERO,BAIRRO,COMPLEMENTO,TELEFONE1,TELEFONE2,TELEFONE3,StatusMatriz,CodStatusGrade,Idade,CPF,CARTIDENTIDADE,Nacionalidade
from (
	Select
		*, 		
		ROW_NUMBER() OVER(PARTITION BY NomFilial,CodCurso,NomGrade, ra ORDER BY codperlet DESC) Item
	from v_Unasp_SMATRICPL mpl 
	where 
		NomStatusCurso='Trancado' 
		and DTFIM_SPLETIVO< :DataFinal and DTINICIO_SPLETIVO> :DataInicial
		and not exists(Select 1 from v_Unasp_SMATRICPL mplx where mplx.RA=mpl.RA and mplx.NomStatusCurso<>'Trancado' and mplx.idperlet>mpl.Idperlet and mplx.CodCurso=mpl.Codcurso) 
	) mpl
	left join (Select CODCOLIGADA,IDHABILITACAOFILIAL, RA, Count(*) PeriodosComMatricula from SMATRICPL group by CODCOLIGADA, IDHABILITACAOFILIAL, RA) pcm
		on pcm.CODCOLIGADA = mpl.CODCOLIGADA and pcm.IDHABILITACAOFILIAL = mpl.IDHABILITACAOFILIAL and pcm.RA = mpl.RA
	Left join (Select CODCOLIGADA, CODCURSO, CODHABILITACAO, CODGRADE, Count(*) PeriodosDaMatriz
		from SPERIODO Where CODPERIODO>0
		group by CODCOLIGADA, CODCURSO, CODHABILITACAO, CODGRADE) pdm on pdm.CODCOLIGADA = mpl.CODCOLIGADA and pdm.CODCURSO = mpl.CODCURSO and pdm.CODHABILITACAO = mpl.CODHABILITACAO and pdm.CODGRADE = mpl.CODGRADE
where 
	mpl.Item=1
order by 
	NomFilial, CodCurso, NomPessoa desc";1553;;;;26/07/2022;isaldo;1;1;1;1;;;;0;83cda553-79b1-49cc-8fb3-5e545ae6e0f8;0;;-14002;isaldo;26/07/2022;isaldo;26/07/2022;0
S;TURMA;Relatorios das Turmas;;0;;;;29/03/2021;lucas.ssantos;1;1;1;1;;;;0;87fb4509-04fd-4534-9220-c75e431034e6;0;;23949;lucas.ssantos;29/03/2021;lucas.ssantos;29/03/2021;0
S;TURMA.001;Alunos Novos e Veteranos;"SELECT 
*,

CASE WHEN Aluno_status = 'Ingressante' THEN 1 ELSE 0 END Aluno_Ingressantes,
CASE WHEN Aluno_status = 'Veterano' THEN 1 ELSE 0 END Aluno_Veteranos

FROM (

SELECT DISTINCT
	P.NOME				Aluno_Nome,	
	A.RA				Aluno_RA,
	
	CASE M.CODTIPOMAT
		WHEN '1' THEN 'Ingressante'
		WHEN '3' THEN 'Ingressante'
		WHEN '4' THEN 'Ingressante'
		WHEN '2' THEN 'Veterano'
		WHEN '5' THEN 'Veterano'
					END Aluno_Status,
	
	T.NOME				Turma_Nome,
	T.CODTURMA			Turma_CodTurma,
	PL.DESCRICAO		Turma_PeriodoLetivo,
	M.DTMATRICULA		Aluno_DataMatricula,
	ST.DESCRICAO		Aluno_StatusTurma
	
FROM 
	SHABILITACAOALUNO HA

	LEFT JOIN SALUNO A
		 ON A.CODCOLIGADA = HA.CODCOLIGADA
		AND A.RA = HA.RA

	LEFT JOIN PPESSOA P
	 	 ON P.CODIGO = A.CODPESSOA

	LEFT JOIN SMATRICPL M
		 ON M.CODCOLIGADA = HA.CODCOLIGADA
		AND M.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL
		AND M.RA = HA.RA

	LEFT JOIN SSTATUS ST
		 ON ST.CODCOLIGADA = M.CODCOLIGADA
		AND ST.CODSTATUS = M.CODSTATUS

	LEFT JOIN STIPOMATRICULA TM
		 ON TM.CODCOLIGADA = M.CODCOLIGADA
		AND TM.CODTIPOMAT = M.CODTIPOMAT

	LEFT JOIN STURMA T
		 ON T.CODCOLIGADA = M.CODCOLIGADA
		AND T.CODFILIAL = M.CODFILIAL
		AND T.CODTURMA = M.CODTURMA
		AND T.IDPERLET = M.IDPERLET

	LEFT JOIN SPLETIVO PL
		 ON PL.CODCOLIGADA = T.CODCOLIGADA
		AND PL.IDPERLET = T.IDPERLET
WHERE
	PL.CODPERLET = :CODPERLET
	AND M.CODTURMA = :CODTURMA
	/*Modificado em 07/03/2022 Nathan PVT - Adicionado verificação para trazer por filial*/
	AND PL.CODFILIAL = :$CODFILIAL
)X
ORDER BY Aluno_Status";1574;;;;07/03/2022;consultor1.totvs;1;1;1;1;;;;0;f0c3d3e2-b611-4ae7-88fc-0b44c535d58c;0;;-26415;lucas.ssantos;29/03/2021;consultor1.totvs;07/03/2022;0
S;TURMA.002;Alunos Novos e Veteranos - Totalizador;"SELECT DISTINCT	
	ST.DESCRICAO		Aluno_StatusTurma,
	COUNT (ST.DESCRICAO) TOTAL
	
	
FROM 
	SHABILITACAOALUNO HA

	LEFT JOIN SALUNO A
		 ON A.CODCOLIGADA = HA.CODCOLIGADA
		AND A.RA = HA.RA

	LEFT JOIN PPESSOA P
	 	 ON P.CODIGO = A.CODPESSOA

	LEFT JOIN SMATRICPL M
		 ON M.CODCOLIGADA = HA.CODCOLIGADA
		AND M.IDHABILITACAOFILIAL = HA.IDHABILITACAOFILIAL
		AND M.RA = HA.RA

	LEFT JOIN SSTATUS ST
		 ON ST.CODCOLIGADA = M.CODCOLIGADA
		AND ST.CODSTATUS = M.CODSTATUS

	LEFT JOIN STIPOMATRICULA TM
		 ON TM.CODCOLIGADA = M.CODCOLIGADA
		AND TM.CODTIPOMAT = M.CODTIPOMAT

	LEFT JOIN STURMA T
		 ON T.CODCOLIGADA = M.CODCOLIGADA
		AND T.CODFILIAL = M.CODFILIAL
		AND T.CODTURMA = M.CODTURMA
		AND T.IDPERLET = M.IDPERLET

	LEFT JOIN SPLETIVO PL
		 ON PL.CODCOLIGADA = T.CODCOLIGADA
		AND PL.IDPERLET = T.IDPERLET
WHERE
	PL.CODPERLET = :CODPERLET
	AND M.CODTURMA = :CODTURMA
	/*Modificado em 07/03/2022 Nathan PVT - Adicionado verificação para trazer por filial*/
	AND PL.CODFILIAL = :$CODFILIAL

GROUP BY ST.DESCRICAO";1056;;;;07/03/2022;consultor1.totvs;1;1;1;1;;;;0;4563994c-7c8e-4ef4-bc76-e67c6d0c36d2;0;;23337;lucas.ssantos;07/04/2021;consultor1.totvs;07/03/2022;0
S;TurmasAtivas;Turmas em períodos letivos abertos;select * from v_Unasp_TURMA where ((getdate() between DTINICIO and DTFIM) or (getdate() > DTINICIO and DTFIM is null));118;;;;04/08/2022;isaldo;1;1;1;1;;;;0;e782fc8a-4086-44b1-a749-ec10eca15585;0;;-1665;isaldo;04/08/2022;isaldo;04/08/2022;0
S;Unasp_SMATRICPL;Matrículas no Período Letivo;"Select 
	* 
from 
	v_Unasp_SMATRICPL
Where 
	CODTIPOCURSO = :CODTIPOCURSO
	and NomStatus like :STATUS
	and CODPERLET = :CODPERLET
	and NomFilial like '%' + :CAMPUS
";173;;;;22/10/2021;mestre;1;1;1;1;;;;0;6570b26c-de1e-4f42-babc-f08d7413a460;0;;32341;mestre;20/07/2021;mestre;22/10/2021;0
S;URANIA;Teste para exportação Urania;"SELECT 
	STURMA.CODCOLIGADA,
	STURMA.CODFILIAL,
	STURMA.CODTIPOCURSO,
	STURMA.CODTURMA,
	STURMA.NOME,
	STURMA.NOMERED,
	STURMA.CODHORARIOAGRUPURANIA,
	STURMA.IDPERLET
FROM
	STURMA
	INNER JOIN STURMADISC (NOLOCK) ON STURMADISC.CODCOLIGADA=STURMA.CODCOLIGADA AND STURMADISC.CODTURMA=STURMA.CODTURMA AND STURMADISC.IDPERLET=STURMA.IDPERLET AND STURMADISC.CODFILIAL=STURMA.CODFILIAL
	INNER JOIN STURNO (NOLOCK) ON STURNO.CODCOLIGADA=STURMA.CODCOLIGADA AND STURNO.CODTURNO=STURMADISC.CODTURNO
	INNER JOIN SPLETIVO (NOLOCK) ON SPLETIVO.CODCOLIGADA=STURMA.CODCOLIGADA AND SPLETIVO.IDPERLET=STURMA.IDPERLET
WHERE 
	STURMA.CODFILIAL= :CODFILIAL
	AND STURMA.CODTIPOCURSO = :CODTIPOCURSO
	AND SPLETIVO.CODPERLET = :CODPERLET";730;;;;17/06/2021;maycon;1;1;1;1;;;;0;f8dba125-379f-4d55-b3ca-9e4acece878f;0;;18090;maycon;17/06/2021;maycon;17/06/2021;0
S;V_Alteracao_indv;Alteração de Status Indevida;"SELECT SLOGPLETIVO.CODFILIAL,SPLETIVO.CODPERLET,OPERACAO,SALUNO.RA,PPESSOA.NOME ALUNO,USUARIO,PERIODO,CODTURMA,
	   'RESERVA DE VAGA' STATUS_ANTERIOR, 'CURSANDO' STATUS_ATUAL,CODSTATUS,convert(varchar, DTALTERACAO, 103) DATA_ALTERACAO
	FROM SLOGPLETIVO
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = SLOGPLETIVO.CODCOLIGADA
			AND SPLETIVO.CODFILIAL = SLOGPLETIVO.CODFILIAL
			AND SPLETIVO.IDPERLET = SLOGPLETIVO.IDPERLET
		INNER JOIN SALUNO (NOLOCK) ON
			SALUNO.CODCOLIGADA = SLOGPLETIVO.CODCOLIGADA
			AND SALUNO.RA = SLOGPLETIVO.RA
		INNER JOIN PPESSOA (NOLOCK) ON
			PPESSOA.CODIGO = SALUNO.CODPESSOA
WHERE SPLETIVO.CODTIPOCURSO = 1
AND CODSTATUSANT = 1
AND CODSTATUS = 2
AND CODPERLET = :CODPERLET
ORDER BY CODFILIAL,RA";754;;;;10/02/2022;consultor1.totvs;1;1;1;1;;;;1;53a4a110-7dfe-4942-a5b0-9b2264d3405a;0;;-20349;consultor1.totvs;10/02/2022;consultor1.totvs;10/02/2022;0
S;V_DISC_ALUNOS;Visão de disciplinas com alunos Status = Concluído;"SELECT SHABILITACAOFILIAL.CODCOLIGADA,
	   SHABILITACAOFILIAL.CODFILIAL,
	   SHABILITACAOFILIAL.CODTIPOCURSO,
	   SHABILITACAOFILIAL.CODCURSO,
	   STURMADISC.CODTURMA,
	   SDISCIPLINA.CODDISC,
	   SDISCIPLINA.NOME DISCIPLINA,
	   SSTATUS.DESCRICAO STATUS,
	   COUNT(SMATRICULA.RA)QTDE_ALUNOS
	FROM SMATRICULA
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICULA.IDPERLET
		INNER JOIN STURMADISC (NOLOCK) ON
			STURMADISC.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			AND STURMADISC.IDTURMADISC = SMATRICULA.IDTURMADISC
		    AND STURMADISC.IDPERLET = SMATRICULA.IDPERLET
		INNER JOIN SDISCIPLINA (NOLOCK) ON
			SDISCIPLINA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SDISCIPLINA.CODDISC = STURMADISC.CODDISC
		INNER JOIN SSTATUS (NOLOCK) ON
			SSTATUS.CODCOLIGADA = SMATRICULA.CODCOLIGADA
			AND SSTATUS.CODSTATUS = SMATRICULA.CODSTATUS
		INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON
			SHABILITACAOFILIAL.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = STURMADISC.IDHABILITACAOFILIAL

WHERE SPLETIVO.CODPERLET = :Periodo_Letivo
AND SSTATUS.DESCRICAO LIKE '%CONCLU%'
GROUP BY SHABILITACAOFILIAL.CODCOLIGADA,
	   SHABILITACAOFILIAL.CODFILIAL,
	   SHABILITACAOFILIAL.CODTIPOCURSO,
	   SHABILITACAOFILIAL.CODCURSO,
	   STURMADISC.CODTURMA,
	   SDISCIPLINA.CODDISC,
	   SDISCIPLINA.NOME,
	   SSTATUS.DESCRICAO ";1438;;;;03/02/2022;consultor1.totvs;1;1;1;1;;;;1;a75b2fa5-92b9-4352-b684-a2bbc9438c38;0;;27332;consultor1.totvs;03/02/2022;consultor1.totvs;03/02/2022;0
S;V_DISC_GERENCIAL;Visualizar Disciplina Gerencial a Partir da Gerenciada;"SELECT STURMADISC.CODCOLIGADA,
	   CODPERLET,
	   STURMA_G.IDTURMADISC, 
	   SDISCIPLINA.CODDISC, 
	   SDISCIPLINA.NOME DISCIPLINA, 
	   STURNO.NOME TURNO
FROM STURMADISC
		LEFT JOIN STURMADISCGERENCIADA (NOLOCK) ON
			STURMADISCGERENCIADA.CODCOLIGADA = STURMADISC.CODCOLIGADA
			AND STURMADISCGERENCIADA.IDTURMADISCGERENCIADA = STURMADISC.IDTURMADISC	            
		LEFT JOIN STURMADISC STURMA_G (NOLOCK) ON
			STURMADISCGERENCIADA.CODCOLIGADA = STURMA_G.CODCOLIGADA
			AND STURMADISCGERENCIADA.IDTURMADISC = STURMA_G.IDTURMADISC
		INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = STURMA_G.CODCOLIGADA
			AND SPLETIVO.IDPERLET = STURMA_G.IDPERLET
            AND SPLETIVO.CODFILIAL = STURMA_G.CODFILIAL
        INNER JOIN SDISCIPLINA (NOLOCK)ON
            SDISCIPLINA.CODCOLIGADA = STURMA_G.CODCOLIGADA
            AND SDISCIPLINA.CODDISC = STURMA_G.CODDISC
        INNER JOIN STURNO (NOLOCK)ON
            STURNO.CODCOLIGADA = SPLETIVO.CODCOLIGADA
            AND STURNO.CODFILIAL = SPLETIVO.CODFILIAL
            AND STURNO.CODTURNO = STURMA_G.CODTURNO
WHERE STURMADISC.CODCOLIGADA = :CODCOLIGADA
AND SPLETIVO.CODPERLET = :CODPERLET
AND STURMADISC.IDTURMADISC = :IDTURMADISC";1213;;;;08/02/2022;consultor1.totvs;1;1;1;1;;;;0;bd914712-faff-4e6d-bb82-f752d6a92b62;0;;-9155;consultor1.totvs;08/02/2022;consultor1.totvs;08/02/2022;0
S;V_Matriculas;Visão de Alunos Cursando Período Letivo e com status diferente no curso;"SELECT SHABILITACAOFILIAL.CODFILIAL,
	   SHABILITACAOFILIAL.CODTIPOCURSO,
	   SMATRICPL.RA,
	   PPESSOA.NOME,
	   SCURSO.NOME CURSO,
	   SHABILITACAO.NOME HABILITACAO,
	   STATUS_CURSO.DESCRICAO STATUS_CURSO,
	   STATUS_PERLETIVO.DESCRICAO STATUS_PERLETIVO
	FROM SMATRICPL		
		INNER JOIN SHABILITACAOALUNO (NOLOCK) ON
			SHABILITACAOALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SHABILITACAOALUNO.IDHABILITACAOFILIAL = SMATRICPL.IDHABILITACAOFILIAL
			AND SHABILITACAOALUNO.RA = SMATRICPL.RA
		INNER JOIN SHABILITACAOFILIAL (NOLOCK) ON
			SHABILITACAOFILIAL.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
			AND SHABILITACAOFILIAL.IDHABILITACAOFILIAL = SHABILITACAOALUNO.IDHABILITACAOFILIAL
		INNER JOIN SSTATUS STATUS_CURSO (NOLOCK) ON
			STATUS_CURSO.CODCOLIGADA = SHABILITACAOALUNO.CODCOLIGADA
			AND STATUS_CURSO.CODSTATUS = SHABILITACAOALUNO.CODSTATUS
		INNER JOIN SSTATUS STATUS_PERLETIVO (NOLOCK) ON
			STATUS_PERLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND STATUS_PERLETIVO.CODSTATUS = SMATRICPL.CODSTATUS
	    INNER JOIN SPLETIVO (NOLOCK) ON
			SPLETIVO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SPLETIVO.IDPERLET = SMATRICPL.IDPERLET
			AND SPLETIVO.CODFILIAL = SMATRICPL.CODFILIAL
			AND SPLETIVO.CODTIPOCURSO = SHABILITACAOFILIAL.CODTIPOCURSO
		INNER JOIN SALUNO (NOLOCK) ON
			SALUNO.CODCOLIGADA = SMATRICPL.CODCOLIGADA
			AND SALUNO.RA = SMATRICPL.RA
		INNER JOIN PPESSOA (NOLOCK) ON	
			PPESSOA.CODIGO = SALUNO.CODPESSOA
		INNER JOIN SCURSO (NOLOCK) ON
			SCURSO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SCURSO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
		INNER JOIN SHABILITACAO (NOLOCK) ON
			SHABILITACAO.CODCOLIGADA = SHABILITACAOFILIAL.CODCOLIGADA
			AND SHABILITACAO.CODCURSO = SHABILITACAOFILIAL.CODCURSO
			AND SHABILITACAO.CODHABILITACAO = SHABILITACAOFILIAL.CODHABILITACAO			

WHERE 1 = 1
AND SPLETIVO.CODPERLET = :PERIODO_LETIVO
AND STATUS_PERLETIVO.DESCRICAO LIKE 'CURSANDO%'
AND STATUS_CURSO.CODSTATUS != STATUS_PERLETIVO.CODSTATUS";2015;;;;25/01/2022;consultor1.totvs;1;1;1;1;;;;1;a75b2fa5-92b9-4352-b684-a2bbc9438c38;0;;-22736;consultor1.totvs;25/01/2022;consultor1.totvs;25/01/2022;0
S;V_SMATRICULA;V_Unasp_SMATRICULA;"select 
	* 
from 
	v_Unasp_SMATRICULA 
Where 
	CODFILIAL = :CODFILIAL 
	and CODTURMA = :CODTURMA 
	and IDPERLET = :IDPERLET 
order by 
	NomDisciplina, NOME";164;;;;10/09/2021;mestre;1;1;1;1;;;;0;a248c4c6-f5f3-4564-a52e-82026049caee;0;;5983;mestre;10/09/2021;mestre;10/09/2021;0
S;v_Unasp_SMATRICP;Matrícula no Período Letivo;Select * from v_Unasp_SMATRICPL Where RA=:RA order by CODPERLET desc;68;;;;16/08/2021;mestre;1;1;1;1;;;;0;13003483-68f1-4367-ae53-9097a0178182;0;;-27362;mestre;16/08/2021;mestre;16/08/2021;0
S;ValorParcelaMes;Valor da Parcela por Mês ;"Select 
	x.RA, 
	p.NOME,
	x.IDHABILITACAOFILIAL, 
	hf.NomFilial,
	hf.NomTipoCurso,
	hf.NomCurso,
	hf.NomTurno,
	SUM(x.VALORBRUTO) VALORBRUTO,
	SUM(x.VALORBOLSA) VALORBOLSA,
	SUM(x.VALORLIQ)	VALORLIQ
from (
SELECT 
	'com SLAN' Orig,
	p.CODCOLIGADA,
	p.IDPERLET,
	pl.CODPERLET,
	hf.IDHABILITACAOFILIAL,
	p.RA,
	hf.CODCURSO,
	m.CODTURMA,
	m.CODTIPOMAT,
	m.PERIODO,
	p.PARCELA, 
	s.CODSERVICO,
	s.NOME SERVICO , 
	CASE WHEN fl.VALORORIGINAL IS NULL AND ct.STATUS = 'N' THEN ISNULL(p.VALOR,0) ELSE ISNULL(fl.VALORORIGINAL,0) END AS VALORBRUTO ,				
	0										DESCFINANCEIRO ,
	ISNULL(bl.Bolsa,0)						VALORBOLSA,
	fl.VALORORIGINAL - ISNULL(bl.Bolsa,0)	VALORLIQ,
	st.DESCRICAO STATUS,
	p.IDPARCELA, 1 item
FROM 
	SPARCELA 						(NOLOCK) p	
	inner JOIN SLAN 				(NOLOCK) sl	ON p.CODCOLIGADA = sl.CODCOLIGADA AND p.IDPARCELA = sl.IDPARCELA
	inner JOIN FLAN 				(NOLOCK) fl	ON sl.CODCOLIGADA = fl.CODCOLIGADA AND sl.IDLAN = fl.IDLAN
	inner JOIN SCONTRATO			(NOLOCK) ct	ON ct.CODCOLIGADA = p.CODCOLIGADA AND ct.RA = p.RA AND ct.CODCONTRATO = p.CODCONTRATO AND ct.IDPERLET = p.IDPERLET
	inner JOIN SMATRICPL			(NOLOCK) m	ON m.CODCOLIGADA = ct.CODCOLIGADA AND m.IDPERLET = ct.IDPERLET AND m.IDHABILITACAOFILIAL = ct.IDHABILITACAOFILIAL AND m.RA = ct.RA
	inner join SHABILITACAOFILIAL	(NOLOCK) hf	on hf.CODCOLIGADA=m.CODCOLIGADA and hf.IDHABILITACAOFILIAL = m.IDHABILITACAOFILIAL
	inner join SCURSO				(NOLOCK) c	on hf.CODCOLIGADA=c.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
	inner JOIN SPLETIVO 			(NOLOCK) pl	ON pl.CODCOLIGADA = ct.CODCOLIGADA AND pl.IDPERLET = ct.IDPERLET
	inner JOIN SSERVICO 			(NOLOCK) s	ON s.CODCOLIGADA = p.CODCOLIGADA AND s.CODSERVICO = p.CODSERVICO
	inner JOIN SSTATUS 				(NOLOCK) st	ON st.CODCOLIGADA = m.CODCOLIGADA AND st.CODSTATUS = m.CODSTATUS        
	left join (Select CODCOLIGADA, IDLAN, SUM(bl.valor) Bolsa from SBOLSALAN (NOLOCK) bl group by CODCOLIGADA, IDLAN) bl on bl.CODCOLIGADA = sl.CODCOLIGADA and	bl.IDLAN = sl.IDLAN
WHERE
	st.CODSTATUS in (Select Valor from z_config where Grupo='Status' and Item='Cursando')
	and pl.CODPERLET in (select Id from dbo.splitStringToTable( :Periodo,',')) and year(p.DTVENCIMENTO) = :Ano and MONTH(p.DTVENCIMENTO)= :Mes
	and ct.TIPOCONTRATO <> 'A' 

union 

SELECT 
	'Sem SLAN' Orig,
	p.CODCOLIGADA,
	p.IDPERLET,
	pl.CODPERLET,
	hf.IDHABILITACAOFILIAL,
	p.RA,
	hf.CODCURSO,
	m.CODTURMA,
	m.CODTIPOMAT,
	m.PERIODO,
	p.PARCELA, 
	s.CODSERVICO,
	s.NOME SERVICO , 
	ISNULL(p.VALOR,0)																			VALORBRUTO ,
	0																							DESCFINANCEIRO ,
	case when isnull(ba.DESCONTO,0)=0 then 0 else round(p.VALOR * (ba.DESCONTO / 100),2) end	VALORBOLSA,
	ISNULL(p.VALOR,0) - ISNULL(p.DESCONTO,0) - (case when isnull(ba.DESCONTO,0)=0 then 0 else round(p.VALOR * (ba.DESCONTO / 100),2) end)	VALORLIQ,
	st.DESCRICAO STATUS,
	p.IDPARCELA,
	ROW_NUMBER() over (partition by m.CODCOLIGADA,m.IDPERLET,m.IDHABILITACAOFILIAL,m.RA order by ISNULL(p.VALOR,0)) Item
FROM 
	SPARCELA 						(NOLOCK) p	
	INNER JOIN SCONTRATO			(NOLOCK) ct	ON ct.CODCOLIGADA = p.CODCOLIGADA AND ct.RA = p.RA AND ct.CODCONTRATO = p.CODCONTRATO AND ct.IDPERLET = p.IDPERLET
	INNER JOIN SMATRICPL			(NOLOCK) m	ON m.CODCOLIGADA = ct.CODCOLIGADA AND m.IDPERLET = ct.IDPERLET AND m.IDHABILITACAOFILIAL = ct.IDHABILITACAOFILIAL AND m.RA = ct.RA
	inner join SHABILITACAOFILIAL	(NOLOCK) hf	on hf.CODCOLIGADA=m.CODCOLIGADA and hf.IDHABILITACAOFILIAL = m.IDHABILITACAOFILIAL
	inner join SCURSO				(NOLOCK) c	on hf.CODCOLIGADA=c.CODCOLIGADA and c.CODCURSO = hf.CODCURSO
	INNER JOIN SPLETIVO 			(NOLOCK) pl	ON pl.CODCOLIGADA = ct.CODCOLIGADA AND pl.IDPERLET = ct.IDPERLET
	INNER JOIN SSERVICO 			(NOLOCK) s	ON s.CODCOLIGADA = p.CODCOLIGADA AND s.CODSERVICO = p.CODSERVICO
	INNER JOIN SSTATUS 				(NOLOCK) st	ON st.CODCOLIGADA = m.CODCOLIGADA AND st.CODSTATUS = m.CODSTATUS        
	LEFT JOIN SBOLSAALUNO			(NOLOCK) ba ON ba.CODSERVICO = p.CODSERVICO AND ba.RA = ct.RA AND ba.CODCONTRATO = ct.CODCONTRATO 
											AND ((ba.PARCELAINICIAL >= p.PARCELA  AND ba.PARCELAFINAL <= p.PARCELA) OR (ba.DTINICIO >= p.DTVENCIMENTO AND ba.DTFIM <= p.DTVENCIMENTO) )											
WHERE 
	not exists (Select 1 from SLAN (NOLOCK) sl where sl.CODCOLIGADA = p.CODCOLIGADA AND sl.IDPARCELA = p.IDPARCELA) 
	and st.CODSTATUS in (Select Valor from z_config where Grupo='Status' and Item='Cursando')
	and pl.CODPERLET in (select Id from dbo.splitStringToTable( :Periodo,',')) and year(p.DTVENCIMENTO)= :Ano and MONTH(p.DTVENCIMENTO)= :Mes
	and ct.TIPOCONTRATO <> 'A'
) x
	inner join v_Unasp_SHABILITACAOFILIAL hf on hf.IDHABILITACAOFILIAL=x.IDHABILITACAOFILIAL
	inner join SALUNO a on a.CODCOLIGADA = hf.CODCOLIGADA and a.RA=x.RA
	inner join PPESSOA p on p.CODIGO = a.CODPESSOA
Group by
	x.RA, 
	p.NOME,
	x.IDHABILITACAOFILIAL, 
	hf.NomFilial,
	hf.NomTipoCurso,
	hf.NomCurso,
	hf.NomTurno
order by 
	RA

";4903;;;;24/02/2022;isaldo;1;1;1;1;;;;0;97211799-6e5d-472a-9e24-89d68b088aa1;0;;31260;isaldo;24/02/2022;isaldo;24/02/2022;0
T;FINREL0040;SQL Recibo;"Select 
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	Sum(RECVALORBAIXA) RECVALORBAIXA,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	numerodocumento,
	dbo.dv_Recibo(RECCODIGO,RECIDSESSAO,RECNUMEROCAIXA,RECCODCXA,replace(replace(convert(varchar(20), VALORTOTAL, 0),'.',''),',',''),convert(varchar(10),getdate(),112)) RECdv_Recibo
from (
	SELECT	
		/*	RECIBO	*/	
		L.IDLAN					RECCODIGO,
		L.HISTORICO				RECHISTORICO,
		F.IDINTEGRACAO			RECENTIDADE,
		l.DATAEMISSAO			RECDATAEMISSAO,
		SC.IDSESSAO				RECIDSESSAO,
		SC.NUMEROCAIXA			RECNUMEROCAIXA,
		SC.CODUSUARIOOPERADOR	RECUSUARIOOPERADOR,
		SC.CODCXA				RECCODCXA,
		cx.DESCRICAO			RECCDESCXA,
		FP.DESCFORMAPAGTO		RECFORMAPAGAMENTO,
		lb.VALORBAIXA			RECVALORBAIXA,
		(SELECT SUM(VALORBAIXA) FROM FLANBAIXA LBX WHERE LBX.IDLAN IN(:IDLAN) AND LBX.CODCOLIGADA = 1 AND LBX.STATUS <> 1) as VALORTOTAL,
	
		/*	FILIAL	*/
		F.CODFILIAL				FILCODG,
		F.NOME					FILNOME,
		F.CGC					FILCNPJ,
		F.RUA					FILENDERECO,
		F.NUMERO				FILENDERECONUMERO,
		F.BAIRRO				FILBAIRRO,
		F.CIDADE				FILCIDADE,
		F.ESTADO				FILESTADO,
		F.CEP					FILCEP,
		F.TELEFONE				FILTELEFONE,
		F.EMAIL					FILEMAIL,
		fx.numerodocumento
	FROM 
		FSESSAOCAIXA				SC	(NOLOCK)
		INNER JOIN FLOGSESSAOCAIXA	LSC (NOLOCK)	ON LSC.CODCOLIGADA = SC.CODCOLIGADA AND LSC.IDSESSAO = SC.IDSESSAO
		INNER JOIN FLANBAIXA		LB	(NOLOCK) 	ON LB.CODCOLIGADA = LSC.CODCOLIGADA AND LB.IDBAIXA = LSC.IDBAIXA AND LB.IDLAN = LSC.IDLAN       
		INNER JOIN TFFORMAPAGTO		FP	(NOLOCK)	ON FP.CODCOLIGADA = LB.CODCOLIGADA AND FP.IDFORMAPAGTO = LB.IDFORMAPAGTO
		left join FCXA				CX	(NOLOCK)	ON cx.CODCOLIGADA = lb.CODCOLCXA and cx.CODCXA = lb.CODCXA
		INNER JOIN FLAN				L	(NOLOCK)	ON L.CODCOLIGADA = SC.CODCOLIGADA AND L.IDLAN = LB.IDLAN 
		LEFT JOIN GFILIAL			F	(NOLOCK)	ON F.CODCOLIGADA = L.CODCOLIGADA and F.CODFILIAL = L.CODFILIAL 

		left join FXCX				fx	(NOLOCK)	on fx.CODCOLIGADA = lb.CODCOLIGADA and fx.IDXCX = lb.IDXCX 
	WHERE 	
		L.IDLAN IN(:IDLAN)
		AND FP.DESCFORMAPAGTO = :FORMAPGTO
		AND L.CODCOLIGADA = 1
		AND LB.STATUS <> 1) x
Group by
	RECCODIGO,
	RECHISTORICO,
	RECENTIDADE,
	RECDATAEMISSAO,
	RECIDSESSAO,
	RECNUMEROCAIXA,
	RECUSUARIOOPERADOR,
	RECCODCXA,
	RECCDESCXA,
	RECFORMAPAGAMENTO,
	VALORTOTAL,
	FILCODG,
	FILNOME,
	FILCNPJ,
	FILENDERECO,
	FILENDERECONUMERO,
	FILBAIRRO,
	FILCIDADE,
	FILESTADO,
	FILCEP,
	FILTELEFONE,
	FILEMAIL,
	numerodocumento";2624;;;;21/07/2021;mestre;1;1;1;1;;;;0;fcdbac45-ac88-4186-935f-1d50464aba1b;0;;17485;mestre;21/07/2021;mestre;21/07/2021;0
T;FLT002;Livro Fiscal Teste;"SELECT /*NF.Numeronfse,
       NF.PROTOCOLO,*/
       L.IDLAN,
       T.IDMOV,
       L.HISTORICO,
       L.VALORORIGINAL,                            
       L.codfilial,
       L.CODTDO,
       L.MESDECOMPETENCIA,                          
       L.VALORDESCONTO,                             
       I.valor,                                    
       TM.STATUS,
       L.VALORORIGINAL - I.valor - L.VALORDESCONTO AS 'Previsão'
FROM   Flan L (NOLOCK)
       INNER JOIN Flanintegracao I (NOLOCK)
               ON I.IDLAN = L.IDLAN
       INNER JOIN TMOVLAN T (NOLOCK)
               ON T.IDLAN = L.IDLAN
       INNER JOIN TMOV TM (NOLOCK)
               ON TM.idmov = T.idmov
       INNER JOIN TNFEMUNICIPAL NF
               ON NF.IDMOV = TM.IDMOV
WHERE  L.MESDECOMPETENCIA >= :DataIni_D
       AND L.MESDECOMPETENCIA <= :DataFIm_D
       AND L.CODFILIAL = :CODFILIAL
       AND TM.STATUS = 'F' 
";924;;;;29/08/2022;joel.silvano;1;1;1;1;;;;0;6faba1eb-e255-443c-943d-38644b697f16;0;;30052;joel.silvano;29/08/2022;joel.silvano;29/08/2022;0
T;NUCWKF0003;Retorna o valor de um campo complementar do movimento;"SELECT OBSRESTRINGE
FROM TMOVCOMPL (NOLOCK)
WHERE TMOVCOMPL.CODCOLIGADA = :CODCOLIGADA AND TMOVCOMPL.IDMOV = :IDMOV";117;;;;14/06/2021;mestre;1;1;1;1;;;;0;274837df-0b32-452e-9453-55cf769e4555;;12.1.1;-6710;mestre;14/06/2021;mestre;14/06/2021;
T;PLNORC_001;Nome/CNPJ Empresa;"SELECT GCOLIGADA.NOMEFANTASIA || ' (' || CAST(GCOLIGADA.CODCOLIGADA AS VARCHAR(15)) || ')' AS NOMEFANTASIA,
       GCOLIGADA.CGC,
       GCOLIGADA.TELEFONE,
       GCOLIGADA.RUA || ', ' || 
       GCOLIGADA.NUMERO || ' - ' || 
       GCOLIGADA.BAIRRO || ' - ' || 
       GCOLIGADA.CIDADE || '/' || 
       GCOLIGADA.ESTADO || 
       ' (' || GCOLIGADA.CEP || ')' AS ENDERECO,
       GCOLIGADA.EMAIL
FROM GCOLIGADA (NOLOCK)
JOIN TCCOTACAO (NOLOCK)
ON TCCOTACAO.CODCOLIGADA = GCOLIGADA.CODCOLIGADA AND TCCOTACAO.CODFILIAL IS NULL
WHERE CODCOTACAO = :CODCOTACAO_S
UNION ALL
SELECT GFILIAL.NOMEFANTASIA || ' (' || CAST(GFILIAL.CODCOLIGADA AS VARCHAR(15)) || ')' AS NOMEFANTASIA,
       GFILIAL.CGC,
       GFILIAL.TELEFONE,
       GFILIAL.RUA || ', ' || 
       GFILIAL.NUMERO || ' - ' || 
       GFILIAL.BAIRRO || ' - ' || 
       GFILIAL.CIDADE || '/' || 
       GFILIAL.ESTADO || 
       ' (' || GFILIAL.CEP || ')' AS ENDERECO,
       GFILIAL.EMAIL
FROM GFILIAL (NOLOCK)
JOIN TCCOTACAO (NOLOCK)
ON TCCOTACAO.CODCOLIGADA = GFILIAL.CODCOLIGADA AND TCCOTACAO.CODFILIAL = GFILIAL.CODFILIAL
WHERE CODCOTACAO = :CODCOTACAO_S";1145;;;;25/02/2021;mestre;1;1;1;1;;;;0;23ea4498-2ab9-4446-a5b3-00c52e08a352;;;-28550;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_002;Dados Cotação;"SELECT DATCOTACAO,
       DATLIMRESPTA,
       TVEN.NOME
FROM   TCCOTACAO (NOLOCK)
       LEFT JOIN TVEN (NOLOCK)
         ON ( TCCOTACAO.CODCOLIGADA = TVEN.CODCOLIGADA
              AND CODCOMPRADOR = CODVEN )
WHERE  CODCOTACAO = :CODCOTACAO_S
       AND TCCOTACAO.CODCOLIGADA = :CODCOLIGADA_N
";304;;;;25/02/2021;mestre;1;1;1;1;;;;0;41369eff-f802-46d7-9fbd-91826de26397;;;-22613;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_003;Dados Fornecedor;"SELECT NOMEFANTASIA,
       CGCCFO,
       CONTATO,
       TELEFONE,
       EMAIL
FROM   FCFO (NOLOCK)
WHERE  CODCOLIGADA = :CODCOLCFO_N
       AND CODCFO = :CODCFO_S 
";176;;;;25/02/2021;mestre;1;1;1;1;;;;0;32263cb5-d157-4e89-a758-8bd51a77b4b5;;;-12763;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_005;Dados Orçamento;"SELECT CASE
         WHEN TCORCAMENTO.VALTRB < 0 THEN 0
         ELSE TCORCAMENTO.VALTRB
       END                                             AS VALTRB,
       TCORCAMENTO.VALICMSST,
       TCORCAMENTO.CODMOVIMENTOCFO,
       TCORCAMENTO.CODMOEDA || ' | ' || GMOEDA.DESCRICAO AS CODMOEDA,
       TCORCAMENTO.CODCPG || ' | ' || TCPG.NOME          AS CODCPG,
       TCORCAMENTO.VALFRETE,
       TCORCAMENTO.VALORFRETE,
       TCORCAMENTO.FRETECIFOUFOB,
       TCORCAMENTO.CODTRA || ' | ' || TTRA.NOME          AS CODTRA,
       TCORCAMENTO.VALORDESOCRC,
       TCORCAMENTO.PERCDESCORC,
       TCORCAMENTO.VALORDESCNEG,
       TCORCAMENTO.PERCDESCNEG,
       TCORCAMENTO.DESPESA,
       CASE
         WHEN TCORCAMENTO.VALPRAZOVALIDADE < 0 THEN 0
         ELSE TCORCAMENTO.VALPRAZOVALIDADE
       END                                             AS VALPRAZOVALIDADE,
       TCORCAMENTO.VALPRAZOENTREGA
FROM   TCORCAMENTO (NOLOCK)
       LEFT JOIN TCCOTACAO (NOLOCK)
         ON ( TCORCAMENTO.CODCOLIGADA = TCCOTACAO.CODCOLIGADA
              AND TCORCAMENTO.CODCOTACAO = TCCOTACAO.CODCOTACAO )
       LEFT JOIN GMOEDA (NOLOCK)
         ON ( TCORCAMENTO.CODMOEDA = GMOEDA.SIMBOLO )
       LEFT JOIN TCPG (NOLOCK)
         ON ( TCORCAMENTO.CODCPG = TCPG.CODCPG
              AND TCORCAMENTO.CODCOLIGADA = TCPG.CODCOLIGADA )
       LEFT JOIN TTRA (NOLOCK)
         ON ( TCORCAMENTO.CODTRA = TTRA.CODTRA
              AND TCORCAMENTO.CODCOLIGADA = TTRA.CODCOLIGADA )
WHERE  TCORCAMENTO.CODCOTACAO = :CODCOTACAO_S
       AND TCORCAMENTO.CODCOLIGADA = :CODCOLIGADA_N
       AND TCORCAMENTO.CODCFO = :CODCFO_S 
	   AND TCORCAMENTO.CODCOLCFO = :CODCOLCFO_N";1682;;;;25/02/2021;mestre;1;1;1;1;;;;0;d366aa0d-430b-45d4-9e76-80a68b9a243c;;;-23954;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_007;Dados Chave;"SELECT DISTINCT CODCOLIGADA,
                CODCOLCFO,
                CODCFO,
                CODCOTACAO
FROM   TCITMORCAMENTO (NOLOCK)
WHERE  CODCOTACAO = :CODCOTACAO_S
	   AND CODCOLIGADA = :CODCOLIGADA_N
       AND CODCOLCFO = :CODCOLCFO_N
       AND CODCFO = :CODCFO_S 
";285;;;;25/02/2021;mestre;1;1;1;1;;;;0;acfc7b7a-86c8-45ca-a6c7-3db5093bd51d;;;18704;mestre;25/02/2021;mestre;25/02/2021;
T;PLNORC_03V2;Itens Cotação/Negociação;"SELECT TCITMORCAMENTO.IDMOV,
       TCITMORCAMENTO.CODCOLMOV,
       TCITMORCAMENTO.NSEQITMMOV,
       TPRODUTO.CODIGOPRD,
       TPRODUTO.NOMEFANTASIA,
	   CAST(TMARCA.IDMARCA AS VARCHAR(5)) || ' | ' || TMARCA.DESCMARCA AS CODMARCA,
	   CAST(MARCANEG.IDMARCA AS VARCHAR(5))  || ' | ' || MARCANEG.DESCMARCA AS MARCANEG,       
       TCITMORCAMENTO.CODUND
        || ' | '
        || TUND.DESCRICAO                                                                                                                                                          AS CODUND,
       TCITMORCAMENTO.CODUNDORC
        || ' | '
        || TUND2.DESCRICAO                                                                                                                                                         AS CODUNDORC,
       TITMMOV.QUANTIDADE,
       TCITMORCAMENTO.QUANTIDADEORC,
       TCITMORCAMENTO.CODCPG
        || ' | '
        || TCPG.NOME                                                                                                                                                               AS CODCPG,
       TCITMORCAMENTO.VALCOTACAO,
       TCITMORCAMENTO.VALTOTCOTACAO,
       TCITMORCAMENTO.CODMOEDA
        || ' | '
        || GMOEDA.DESCRICAO                                                                                                                                                        AS CODMOEDA,
       TCITMORCAMENTO.VALTRB,
       TCITMORCAMENTO.PERCICMSITMORC,
       TCITMORCAMENTO.VALICMSST,
       TCITMORCAMENTO.MARGEMICMSST,
       TCITMORCAMENTO.DESCONTO,
       TCITMORCAMENTO.PERCDESCONTO,
       TCITMORCAMENTO.DESPESA,
       TCITMORCAMENTO.VALORDESPITMORC,
       TCITMORCAMENTO.DATAENTREGA,
       TCITMORCAMENTO.OBSERVACAO,
       TCITMORCAMENTO.CODUNDNEG
        || ' | '
        || TUND3.DESCRICAO                                                                                                                                                         AS CODUNDNEG,
       TCITMORCAMENTO.QUANTIDADENEG,
       TCITMORCAMENTO.CODCPGNEGOCIADA
        || ' | '
        || TCPG.NOME                                                                                                                                                               AS CODCPGNEGOCIADA,
       TCITMORCAMENTO.VALNEGOCIADO,
       TCITMORCAMENTO.VALTOTCOTACAONEG,
       TCITMORCAMENTO.VALORDESPITMNEG,
       TCITMORCAMENTO.PERCDESPITMNEG,
       TCITMORCAMENTO.DESCONTONEGOCIADO,
       TCITMORCAMENTO.PERCDESCONTONEGOCIADO,
       0 INDISPONIVEL,
       TCITMORCAMENTO.IDPRD
FROM   TCITMORCAMENTO (NOLOCK)
       LEFT JOIN TPRODUTO (NOLOCK)
         ON ( TCITMORCAMENTO.IDPRD = TPRODUTO.IDPRD )
       LEFT JOIN TCCOTACAOITMMOV (NOLOCK)
         ON ( TCITMORCAMENTO.CODCOTACAO = TCCOTACAOITMMOV.CODCOTACAO
              AND TCITMORCAMENTO.IDMOV = TCCOTACAOITMMOV.IDMOV
              AND TCITMORCAMENTO.NSEQITMMOV = TCCOTACAOITMMOV.NSEQITMMOV
              AND TCITMORCAMENTO.CODCOLIGADA = TCCOTACAOITMMOV.CODCOLIGADA
              AND TCITMORCAMENTO.CODCOLMOV = TCCOTACAOITMMOV.CODCOLMOV )
       LEFT JOIN TITMMOV (NOLOCK)
         ON ( TCCOTACAOITMMOV.CODCOLMOV = TITMMOV.CODCOLIGADA
              AND TCCOTACAOITMMOV.IDMOV = TITMMOV.IDMOV
              AND TCCOTACAOITMMOV.NSEQITMMOV = TITMMOV.NSEQITMMOV )
       LEFT JOIN TUND (NOLOCK)
         ON ( TCITMORCAMENTO.CODUND = TUND.CODUND )
       LEFT JOIN TUND TUND2 (NOLOCK)
         ON ( TCITMORCAMENTO.CODUNDORC = TUND2.CODUND )
       LEFT JOIN TUND TUND3 (NOLOCK)
         ON ( TCITMORCAMENTO.CODUNDNEG = TUND3.CODUND )
       LEFT JOIN TCPG (NOLOCK)
         ON ( TCITMORCAMENTO.CODCPG = TCPG.CODCPG
              AND TCITMORCAMENTO.CODCOLIGADA = TCPG.CODCOLIGADA )
       LEFT JOIN GMOEDA (NOLOCK)
         ON ( TCITMORCAMENTO.CODMOEDA = GMOEDA.SIMBOLO )
	   LEFT JOIN TMARCA (NOLOCK) 
	     ON	TMARCA.CODCOLIGADA = TITMMOV.CODCOLMARCA AND
			TMARCA.IDMARCA = TITMMOV.IDMARCA
	   LEFT JOIN TMARCA MARCANEG(NOLOCK) 
	     ON MARCANEG.CODCOLIGADA = TCITMORCAMENTO.CODCOLMARCANEG AND
			MARCANEG.IDMARCA = TCITMORCAMENTO.IDMARCANEG         
WHERE  TCITMORCAMENTO.CODCOTACAO = :CODCOTACAO_S
       AND TCITMORCAMENTO.CODCOLCFO = :CODCOLCFO_N
       AND TCITMORCAMENTO.CODCFO = :CODCFO_S
       AND TCITMORCAMENTO.CODCOLIGADA = :CODCOLIGADA_N
       AND STSITEM BETWEEN :STSITEMINI_S AND :STSITEMFIM_S
ORDER  BY TPRODUTO.CODIGOPRD,
          TCITMORCAMENTO.NSEQITMMOV 
";4518;;;;25/02/2021;mestre;1;1;1;1;;;;0;4d5ce425-eeb2-4bf6-8243-c549be7a20e6;;;30764;mestre;25/02/2021;mestre;25/02/2021;
T;teste;teste;"/*Select * from fcfo Where RECCREATEDBY='Robson'*/
/*select count(fcfo.codcfo) from fcfo (nolock)*/
select * from fcxacont";124;;;;15/03/2021;mestre;1;1;1;1;;;;0;1963e676-673a-408a-bb62-bce9ecea39af;0;;16100;mestre;11/03/2021;mestre;15/03/2021;0
T;ZZZ;Selects Diversos;select IDLAN from flan where idlan in (304488,304487,302732,331511,329837);74;;;;04/11/2022;carla.ozelo;1;1;1;1;;;;0;50037241-6805-488e-b273-fc5b1d354410;0;;31782;carla.ozelo;15/02/2022;carla.ozelo;04/11/2022;0
Y;filtro.user;Usuários de um perfil e sistema;SELECT CODUSUARIO FROM GUSRPERFIL WHERE  CODSISTEMA =:SISTEMA AND CODPERFIL =:PERFIL;84;;;;27/07/2021;mestre;1;1;1;1;;;;0;eee2de87-a552-48cd-a343-cef844627118;0;;-27947;mestre;27/07/2021;mestre;27/07/2021;0
